/*! For license information please see main.cbca6cd6.js.LICENSE.txt */
(function(){var __webpack_modules__={7228:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports},2858:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},3646:function(e,t,r){var n=r(7228);e.exports=function(e){if(Array.isArray(e))return n(e)},e.exports.__esModule=!0,e.exports.default=e.exports},1506:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},4575:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},9100:function(e,t,r){var n=r(9489),i=r(7067);function o(t,r,a){return i()?(e.exports=o=Reflect.construct,e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=o=function(e,t,r){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return r&&n(o,r.prototype),o},e.exports.__esModule=!0,e.exports.default=e.exports),o.apply(null,arguments)}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},3913:function(e){function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},3269:function(e,t,r){var n=r(379);e.exports=function(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}},e.exports.__esModule=!0,e.exports.default=e.exports},9842:function(e,t,r){var n=r(9754),i=r(7067),o=r(8585);e.exports=function(e){var t=i();return function(){var r,i=n(e);if(t){var a=n(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return o(this,r)}},e.exports.__esModule=!0,e.exports.default=e.exports},9754:function(e){function t(r){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},2205:function(e,t,r){var n=r(9489);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},430:function(e){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports},7067:function(e){e.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},6860:function(e){e.exports=function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},3884:function(e){e.exports=function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(l){s=!0,i=l}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}},e.exports.__esModule=!0,e.exports.default=e.exports},521:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},8206:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},8585:function(e,t,r){var n=r(8).default,i=r(1506);e.exports=function(e,t){if(t&&("object"===n(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},9489:function(e){function t(r,n){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},3038:function(e,t,r){var n=r(2858),i=r(3884),o=r(379),a=r(521);e.exports=function(e,t){return n(e)||i(e,t)||o(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},319:function(e,t,r){var n=r(3646),i=r(6860),o=r(379),a=r(8206);e.exports=function(e){return n(e)||i(e)||o(e)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},8:function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},379:function(e,t,r){var n=r(7228);e.exports=function(e,t){if(e){if("string"===typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},5957:function(e,t,r){var n=r(9754),i=r(9489),o=r(430),a=r(9100);function s(t){var r="function"===typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!o(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return a(e,arguments,n(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,s(t)}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports},7757:function(e,t,r){e.exports=r(9727)},1694:function(e,t){var r;!function(){"use strict";var n={}.hasOwnProperty;function i(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var o=typeof r;if("string"===o||"number"===o)e.push(r);else if(Array.isArray(r)){if(r.length){var a=i.apply(null,r);a&&e.push(a)}}else if("object"===o)if(r.toString===Object.prototype.toString)for(var s in r)n.call(r,s)&&r[s]&&e.push(s);else e.push(r.toString())}}return e.join(" ")}e.exports?(i.default=i,e.exports=i):void 0===(r=function(){return i}.apply(t,[]))||(e.exports=r)}()},2176:function(e){"use strict";e.exports=function(e,t,r,n,i,o,a,s){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var d=[r,n,i,o,a,s],u=0;(l=new Error(t.replace(/%s/g,(function(){return d[u++]})))).name="Invariant Violation"}throw l.framesToPop=1,l}}},3093:function(e,t,r){e=r.nmd(e),function(n){n||("object"===typeof self?n=self:"object"===typeof window&&window&&window.document?n=window:"object"===typeof r.g&&(n=r.g)),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){t||(t=0);var r=this.length;for(t<0&&(t=r+t);t<r;t++)if(this[t]===e)return t;return-1});var i=n.document;i||"undefined"!==typeof window&&(i=window.document);var o,a,s="undefined"!==typeof navigator&&"undefined"!==typeof window&&"undefined"!==typeof i,l="object"===typeof process&&"object"===typeof process.versions&&"undefined"!==typeof process.versions.node,d=l,u="function"===typeof r,c="undefined"!==typeof t;if(!d)i&&i.readyState,window.attachEvent&&window.opera;d&&"undefined"!==typeof r.g&&(n=r.g);var h=[];function p(e,t,r){if(h.indexOf(t)>=0)r&&r(null);else{if(d){var n=function(e){if(d)try{var t=o.readFileSync(e,"utf8");return(void 0).runInThisContext(t,{filename:e}),!0}catch(r){return r}}(t);return r&&r(!0===n?null:n),n}try{var i=e.createElement("script");return i.src=t,i.onerror=function(e){r&&r(new Error("Loading script file "+t+" failed"))},i.onload=i.onreadystatechange=function(e){if(!i._loaded){var n=i.readyState;void 0!==n&&"loaded"!==n&&"complete"!==n||(i._loaded=!0,i.onload=i.onreadystatechange=null,h.push(t),r&&r(null))}},(e.getElementsByTagName("head")[0]||e.body).appendChild(i),i}catch(a){r&&r(a)}}}function g(e,t,r){f(e,[].concat(t),r,[])}function f(e,t,r,n){if(t.length<=0)r&&(n.length?r(new Error(n.join(", "))):r(null));else{var i=t.shift();p(e,i,(function(i){i&&n.push(i?i.message||i:""),f(e,t,r,n)}))}}function m(e,t,r){if(d)g(i,e,(function(e){(this.Kekule||a.Kekule)._loaded(),r&&r(e)}));else if(function(){if(d)return!0;var e=i&&i.readyState,t=window.attachEvent&&!window.opera;return"complete"===e||"loaded"===e||"interactive"===e&&!t}()||t)g(i,e,(function(e){e||Kekule._loaded(),r&&r(e)}));else try{for(var n=0,o=e.length;n<o;++n)s=i,l=e[n],s.write('<script type="text/javascript" src="'+l+'"><\/script>');i.write('<script type="text/javascript">if (this.Kekule) Kekule._loaded();<\/script>'),r&&r(null)}catch(u){r(u)}var s,l}var C={lan:{files:["lan/classes.js","lan/xmlJsons.js","lan/serializations.js"],category:"lan",minFile:"root.min.js"},root:{files:["core/kekule.root.js"],category:"root",minFile:"root.min.js"},localization:{requires:["lan","root"],files:["localization/kekule.localizations.js"],category:"localization",minFile:"localization.min.js"},localizationData:{requires:["localization"],files:["localization/en/kekule.localize.general.en.js","localization/en/kekule.localize.widget.en.js","localization/en/kekule.localize.objDefines.en.js"],category:"localization",minFile:"localization.min.js"},"localizationData.zh":{requires:["localization"],files:["localization/zh/kekule.localize.general.zh.js","localization/zh/kekule.localize.widget.zh.js"],category:"localizationData.zh",autoCompress:!1},common:{requires:["lan","root","localization"],files:["core/kekule.common.js","core/kekule.exceptions.js","utils/kekule.utils.js","utils/kekule.domHelper.js","utils/kekule.domUtils.js","core/kekule.externalResMgr.js","core/kekule.metrics.js"],category:"common",minFile:"common.min.js"},core:{requires:["lan","root","common","data"],files:["core/kekule.configs.js","core/kekule.elements.js","core/kekule.electrons.js","core/kekule.valences.js","core/kekule.structures.js","core/kekule.structureBuilder.js","core/kekule.reactions.js","core/kekule.chemUtils.js","chemdoc/kekule.glyph.base.js","chemdoc/kekule.glyph.utils.js","chemdoc/kekule.glyph.pathGlyphs.js","chemdoc/kekule.glyph.lines.js","chemdoc/kekule.glyph.chemGlyphs.js","chemdoc/kekule.contentBlocks.js","chemdoc/kekule.attachedMarkers.js","chemdoc/kekule.commonChemMarkers.js"],category:"core"},html:{requires:["lan","root","common"],files:["xbrowsers/kekule.x.js","html/kekule.nativeServices.js","html/kekule.predefinedResLoaders.js","utils/kekule.htmlDomUtils.js"],category:"core"},io:{requires:["lan","root","common","core"],files:["utils/kekule.textHelper.js","io/kekule.io.js","io/cml/kekule.io.cml.js","io/mdl/kekule.io.mdlBase.js","io/mdl/kekule.io.mdl2000.js","io/mdl/kekule.io.mdl3000.js","io/mdl/kekule.io.mdlIO.js","io/smiles/kekule.io.smiles.js","io/native/kekule.io.native.js"],category:"io"},render:{requires:["lan","root","common","core","html"],files:["render/kekule.render.extensions.js","render/kekule.render.base.js","render/kekule.render.renderColorData.js","render/kekule.render.utils.js","render/kekule.render.configs.js","render/kekule.render.baseTextRender.js","render/kekule.render.boundInfoRecorder.js","render/2d/kekule.render.renderer2D.js","render/2d/kekule.render.glyphRender2D.js","render/2d/kekule.render.canvasRenderer.js","render/2d/kekule.render.raphaelRenderer.js","render/3d/kekule.render.renderer3D.js","render/3d/kekule.render.threeRenderer.js","render/kekule.render.painter.js"],category:"render"},widget:{requires:["lan","root","common","html"],files:["lib/hammer.js/hammer.min.js","widgets/operation/kekule.operations.js","widgets/operation/kekule.actions.js","widgets/kekule.widget.root.js","widgets/kekule.widget.bindings.js","widgets/kekule.widget.events.js","widgets/kekule.widget.base.js","widgets/kekule.widget.sys.js","widgets/kekule.widget.keys.js","widgets/kekule.widget.clipboards.js","widgets/kekule.widget.helpers.js","widgets/kekule.widget.styleResources.js","widgets/kekule.widget.autoLaunchers.js","widgets/transitions/kekule.widget.transitions.js","widgets/transitions/kekule.widget.transMgr.js","widgets/commonCtrls/kekule.widget.resizers.js","widgets/commonCtrls/kekule.widget.movers.js","widgets/commonCtrls/kekule.widget.images.js","widgets/commonCtrls/kekule.widget.containers.js","widgets/commonCtrls/kekule.widget.menus.js","widgets/commonCtrls/kekule.widget.buttons.js","widgets/commonCtrls/kekule.widget.formControls.js","widgets/commonCtrls/kekule.widget.nestedContainers.js","widgets/commonCtrls/kekule.widget.treeViews.js","widgets/commonCtrls/kekule.widget.listViews.js","widgets/commonCtrls/kekule.widget.dialogs.js","widgets/commonCtrls/kekule.widget.msgPanels.js","widgets/commonCtrls/kekule.widget.tabViews.js","widgets/advCtrls/kekule.widget.valueListEditors.js","widgets/advCtrls/kekule.widget.colorPickers.js","widgets/advCtrls/kekule.widget.textEditors.js","widgets/advCtrls/kekule.widget.widgetGrids.js","widgets/advCtrls/objInspector/kekule.widget.objInspectors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.propEditors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.operations.js","widgets/advCtrls/kekule.widget.configurators.js","widgets/advCtrls/grids/kekule.widget.dataSets.js","widgets/advCtrls/grids/kekule.widget.dataGrids.js","widgets/sys/kekule.widget.sysMsgs.js","widgets/operation/kekule.operHistoryTreeViews.js"],category:"widget"},chemWidget:{requires:["lan","root","common","core","html","io","render","algorithm","widget"],files:["widgets/chem/kekule.chemWidget.base.js","widgets/chem/kekule.chemWidget.dialogs.js","widgets/chem/periodicTable/kekule.chemWidget.periodicTables.js","widgets/chem/kekule.chemWidget.chemObjDisplayers.js","widgets/chem/structureTreeView/kekule.chemWidget.structureTreeViews.js","widgets/chem/uiMarker/kekule.chemWidget.uiMarkers.js","widgets/chem/viewer/kekule.chemWidget.viewers.js","widgets/chem/viewer/kekule.chemWidget.viewerGrids.js","widgets/chem/viewer/kekule.chemWidget.chemObjInserters.js","widgets/chem/editor/kekule.chemEditor.extensions.js","widgets/chem/editor/kekule.chemEditor.baseEditors.js","widgets/chem/editor/kekule.chemEditor.operations.js","widgets/chem/editor/kekule.chemEditor.editorUtils.js","widgets/chem/editor/kekule.chemEditor.configs.js","widgets/chem/editor/kekule.chemEditor.repositoryData.js","widgets/chem/editor/kekule.chemEditor.repositories.js","widgets/chem/editor/kekule.chemEditor.utilWidgets.js","widgets/chem/editor/kekule.chemEditor.chemSpaceEditors.js","widgets/chem/editor/kekule.chemEditor.nexus.js","widgets/chem/editor/kekule.chemEditor.actions.js","widgets/chem/editor/kekule.chemEditor.trackParser.js","widgets/chem/editor/kekule.chemEditor.objModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.styleModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.textModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.structureModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.glyphModifiers.js","chemdoc/issueCheckers/kekule.issueCheckers.js","widgets/chem/editor/issueInspectors/kekule.chemEditor.issueCheckers.js","widgets/chem/editor/issueInspectors/kekule.chemEditor.issueInspectors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.chemPropEditors.js","widgets/chem/editor/kekule.chemEditor.composers.js"],category:"chemWidget"},webComponent:{requires:["lan","root","common","core","html","io","render","algorithm","widget","chemWidget"],files:["webComponents/kekule.webComponent.base.js","webComponents/kekule.webComponent.widgetWrappers.js"]},algorithm:{requires:["lan","root","common","core"],files:["algorithm/kekule.graph.js","algorithm/kekule.structures.helpers.js","algorithm/kekule.structures.canonicalizers.js","algorithm/kekule.structures.ringSearches.js","algorithm/kekule.structures.aromatics.js","algorithm/kekule.structures.standardizers.js","algorithm/kekule.structures.searches.js","algorithm/kekule.structures.stereos.js"],category:"algorithm"},calculation:{requires:["lan","root","common","core","algorithm"],files:["calculation/kekule.calc.base.js"]},data:{requires:["root"],files:["data/kekule.chemicalElementsData.js","data/kekule.isotopesData.organSet.js","data/kekule.structGenAtomTypesData.js","data/kekule.dataUtils.js"]},emscripten:{requires:["root","common"],files:["_extras/kekule.emscriptenUtils.js"],category:"extra"},openbabel:{requires:["lan","root","core","emscripten","io"],files:["localization/en/kekule.localize.extras.openbabel.en.js","_extras/OpenBabel/kekule.openbabel.base.js","_extras/OpenBabel/kekule.openbabel.io.js","_extras/OpenBabel/kekule.openbabel.structures.js"],category:"extra"},indigo:{requires:["lan","root","core","emscripten","io"],files:["_extras/Indigo/kekule.indigo.base.js","_extras/Indigo/kekule.indigo.io.js","_extras/Indigo/kekule.indigo.structures.js"],category:"extra"},inchi:{requires:["lan","root","core","emscripten","io"],files:["_extras/InChI/kekule.inchi.js"],category:"extra"}},y=["lan","root","localization","localizationData","common"],_=y.concat(["core","html","io","render","widget","chemWidget","algorithm","calculation","data"]),E=(_.concat(["emscripten","inchi","openbabel","indigo"]),y.concat(["core","io","algorithm","calculation","data"])),T=[];function O(e){for(var t=e||_,r=[],n=function e(t,r){if(t.indexOf(r)<0){var n=C[r];if(n&&n.requires)for(var i=0,o=n.requires.length;i<o;++i){e(t,n.requires[i])}t.push(r)}},i=0,o=(t=y.concat(t)).length;i<o;++i){n(r,t[i])}return r}function v(e,t,r,n,i){"undefined"!==typeof Kekule&&Kekule.LOADED&&(Kekule.LOADED=!1);for(var o=n.modules||[],a=[],s=0,l=e.length;s<l;++s)o.indexOf(e[s])<0&&a.push(e[s]);var d=function(e,t){for(var r=O(e),n=[],i=0,o=r.length;i<o;++i){var a=r[i],s=C[a];if(s&&s.files)if(t){var l=s.minFile||a+".min.js";n.indexOf(l)<0&&n.push(l)}else n=n.concat(s.files)}return n}(a,t),u=[],c=r,h=n.fileUrls||[],p=[];for(s=0,l=d.length;s<l;++s){var g=c+d[s];h.indexOf(g)<0&&(p.push(g),u.push(d[s]))}return p.push(c+"kekule.loaded.js"),m(p,null,(function(e){n.modules=n.modules.concat(a),n.files=n.files.concat(u),n.fileUrls=n.fileUrls.concat(p),i&&i(e)})),{modules:a,files:u,fileUrls:p}}u?e.exports=r(6987):function(){var u;if(s){u=function(e){var t,r=/^(.*\/?)kekule(.min)?\.js(\?.*)?$/,n=/^domloader\=(.+)$/,i=/^min\=(.+)$/,o=/^modules\=(.+)$/,a=/^locals\=(.+)$/,s=/^language\=(.+)$/;if(!c)if(e&&e.currentScript&&e.currentScript.src)(u=decodeURIComponent(e.currentScript.src))&&(t=u.match(/^(.*[\/\\])([^\/\\]*)\.js(\?.*)?$/));else for(var l=e.getElementsByTagName("script"),d=l.length-1;d>=0;--d){var u,h=l[d];if((u=decodeURIComponent(h.src))&&(t=u.match(r)))break}if(t){t[2];var p=t[3];p&&(p=p.substr(1));var g={src:u,path:t[1],paramStr:p,useMinFile:!0};if(g.paramStr){for(var f=g.paramStr.split("&"),m=0,C=f.length;m<C;++m){var y=f[m].match(i);if(y){var E=y[1].toLowerCase(),O=["false","no","f","n"].indexOf(E)<0;g.useMinFile=O}else{var v=f[m].match(o);if(v)var S=v[1].split(",");else{var b=f[m].match(n);if(b)E=b[1].toLowerCase(),O=["false","no","f","n"].indexOf(E)<0,g.forceDomLoader=O;else{var A=f[m].match(a);if(A){var I=A[1].split(",");g.locals=I}else{var R=f[m].match(s);R&&(E=R[1],g.language=E)}}}}}if(g.modules=S||_,g.locals||(g.locals=T),g.locals||g.language){var D=[].concat(g.locals||[]);if(g.language&&D.indexOf(g.language)<0&&D.push(g.language),D.length){var N=g.modules.indexOf("localizationData");for(N<0&&(N=-1),m=0,C=D.length;m<C;++m){var P=D[m];"en"!==P&&g.modules.splice(N+1,0,"localizationData."+P)}}}}return g}return{src:"",path:"",modules:_,useMinFile:!0}}(i);var h=u.src&&u.path;h&&(d=!1),!h&&l&&(u.src=this.__filename||"",u.path="//",d=!0)}else d&&(u={src:this.__filename||"",path:"//",modules:s?_:E,useMinFile:!0,nodeModule:e,nodeRequire:(r(5398),r(5398))});if(d){var f=u.path+C.root.minFile,m=!1;try{m=o.existsSync(f)}catch(S){m=!1}m||(u.useMinFile=!1)}u.singleMinBundle=n&&n.__$kekule_single_min_bundle__,u.explicitModules=u.modules;var y=O(u.modules);u.modules=[],u.files=[],u.fileUrls=[],u.allModuleStructures=C,n.__$kekule_load_info__=u,n.__$kekule_scriptfile_utils__={appendScriptFile:p,appendScriptFiles:g,loadModuleScriptFiles:v},u.singleMinBundle&&"undefined"!==typeof u.singleMinBundle||v(y,u.useMinFile,u.path,u,(function(e){t.Kekule=this.Kekule||a.Kekule,t.Class=this.Class||a.Class,t.ClassEx=this.ClassEx||a.ClassEx,t.ObjectEx=this.ObjectEx||a.ObjectEx,t.DataType=this.DataType||a.DataType,this.Class=t.Class,this.ClassEx=t.ClassEx,this.ObjectEx=t.ObjectEx,this.DataType=t.DataType,this.Kekule.scriptSrcInfo=u}))}()}(this)},2962:function(e,t,r){var n;e=r.nmd(e);var i=r(4575).default,o=r(3913).default,a=r(2205).default,s=r(9842).default,l=r(5957).default;!function(){var e;"object"==typeof self?e=self:"object"==typeof window&&window&&window.document?e=window:"object"==typeof r.g&&(e=r.g),e.__$kekule_single_min_bundle__=!0}(),function(n){n||("object"==typeof self?n=self:"object"==typeof window&&window&&window.document?n=window:"object"==typeof r.g&&(n=r.g)),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){t||(t=0);var r=this.length;for(t<0&&(t=r+t);t<r;t++)if(this[t]===e)return t;return-1});var i=n.document;i||"undefined"!=typeof window&&(i=window.document);var o,a,s="undefined"!=typeof navigator&&"undefined"!=typeof window&&void 0!==i,l="object"==typeof process&&"object"==typeof process.versions&&void 0!==process.versions.node,u=l,c="function"==typeof r,h="undefined"!=typeof t;u||(i&&i.readyState,window.attachEvent&&window.opera),u&&"undefined"!=typeof r.g&&(n=r.g);var p=[];function g(e,t,r){if(p.indexOf(t)>=0)r&&r(null);else{if(u){var n=function(e){if(u)try{var t=o.readFileSync(e,"utf8");return undefined.runInThisContext(t,{filename:e}),!0}catch(e){return e}}(t);return r&&r(!0===n?null:n),n}try{var i=e.createElement("script");return i.src=t,i.onerror=function(e){r&&r(new Error("Loading script file "+t+" failed"))},i.onload=i.onreadystatechange=function(e){if(!i._loaded){var n=i.readyState;void 0!==n&&"loaded"!==n&&"complete"!==n||(i._loaded=!0,i.onload=i.onreadystatechange=null,p.push(t),r&&r(null))}},(e.getElementsByTagName("head")[0]||e.body).appendChild(i),i}catch(e){r&&r(e)}}}function f(e,t,r){!function e(t,r,n,i){if(r.length<=0)n&&(i.length?n(new Error(i.join(", "))):n(null));else{var o=r.shift();g(t,o,(function(o){o&&i.push(o?o.message||o:""),e(t,r,n,i)}))}}(e,[].concat(t),r,[])}function m(e,t,r){if(u)f(i,e,(function(e){(this.Kekule||a.Kekule)._loaded(),r&&r(e)}));else if(function(){if(u)return!0;var e=i&&i.readyState,t=window.attachEvent&&!window.opera;return"complete"===e||"loaded"===e||"interactive"===e&&!t}()||t)f(i,e,(function(e){e||d._loaded(),r&&r(e)}));else try{for(var n=0,o=e.length;n<o;++n)s=i,l=e[n],s.write('<script type="text/javascript" src="'+l+'"><\/script>');i.write('<script type="text/javascript">if (this.Kekule) Kekule._loaded();<\/script>'),r&&r(null)}catch(e){r(e)}var s,l}var C={lan:{files:["lan/classes.js","lan/xmlJsons.js","lan/serializations.js"],category:"lan",minFile:"root.min.js"},root:{files:["core/kekule.root.js"],category:"root",minFile:"root.min.js"},localization:{requires:["lan","root"],files:["localization/kekule.localizations.js"],category:"localization",minFile:"localization.min.js"},localizationData:{requires:["localization"],files:["localization/en/kekule.localize.general.en.js","localization/en/kekule.localize.widget.en.js","localization/en/kekule.localize.objDefines.en.js"],category:"localization",minFile:"localization.min.js"},"localizationData.zh":{requires:["localization"],files:["localization/zh/kekule.localize.general.zh.js","localization/zh/kekule.localize.widget.zh.js"],category:"localizationData.zh",autoCompress:!1},common:{requires:["lan","root","localization"],files:["core/kekule.common.js","core/kekule.exceptions.js","utils/kekule.utils.js","utils/kekule.domHelper.js","utils/kekule.domUtils.js","core/kekule.externalResMgr.js","core/kekule.metrics.js"],category:"common",minFile:"common.min.js"},core:{requires:["lan","root","common","data"],files:["core/kekule.configs.js","core/kekule.elements.js","core/kekule.electrons.js","core/kekule.valences.js","core/kekule.structures.js","core/kekule.structureBuilder.js","core/kekule.reactions.js","core/kekule.chemUtils.js","chemdoc/kekule.glyph.base.js","chemdoc/kekule.glyph.utils.js","chemdoc/kekule.glyph.pathGlyphs.js","chemdoc/kekule.glyph.lines.js","chemdoc/kekule.glyph.chemGlyphs.js","chemdoc/kekule.contentBlocks.js","chemdoc/kekule.attachedMarkers.js","chemdoc/kekule.commonChemMarkers.js"],category:"core"},html:{requires:["lan","root","common"],files:["xbrowsers/kekule.x.js","html/kekule.nativeServices.js","html/kekule.predefinedResLoaders.js","utils/kekule.htmlDomUtils.js"],category:"core"},io:{requires:["lan","root","common","core"],files:["utils/kekule.textHelper.js","io/kekule.io.js","io/cml/kekule.io.cml.js","io/mdl/kekule.io.mdlBase.js","io/mdl/kekule.io.mdl2000.js","io/mdl/kekule.io.mdl3000.js","io/mdl/kekule.io.mdlIO.js","io/smiles/kekule.io.smiles.js","io/native/kekule.io.native.js"],category:"io"},render:{requires:["lan","root","common","core","html"],files:["render/kekule.render.extensions.js","render/kekule.render.base.js","render/kekule.render.renderColorData.js","render/kekule.render.utils.js","render/kekule.render.configs.js","render/kekule.render.baseTextRender.js","render/kekule.render.boundInfoRecorder.js","render/2d/kekule.render.renderer2D.js","render/2d/kekule.render.glyphRender2D.js","render/2d/kekule.render.canvasRenderer.js","render/2d/kekule.render.raphaelRenderer.js","render/3d/kekule.render.renderer3D.js","render/3d/kekule.render.threeRenderer.js","render/kekule.render.painter.js"],category:"render"},widget:{requires:["lan","root","common","html"],files:["lib/hammer.js/hammer.min.js","widgets/operation/kekule.operations.js","widgets/operation/kekule.actions.js","widgets/kekule.widget.root.js","widgets/kekule.widget.bindings.js","widgets/kekule.widget.events.js","widgets/kekule.widget.base.js","widgets/kekule.widget.sys.js","widgets/kekule.widget.keys.js","widgets/kekule.widget.clipboards.js","widgets/kekule.widget.helpers.js","widgets/kekule.widget.styleResources.js","widgets/kekule.widget.autoLaunchers.js","widgets/transitions/kekule.widget.transitions.js","widgets/transitions/kekule.widget.transMgr.js","widgets/commonCtrls/kekule.widget.resizers.js","widgets/commonCtrls/kekule.widget.movers.js","widgets/commonCtrls/kekule.widget.images.js","widgets/commonCtrls/kekule.widget.containers.js","widgets/commonCtrls/kekule.widget.menus.js","widgets/commonCtrls/kekule.widget.buttons.js","widgets/commonCtrls/kekule.widget.formControls.js","widgets/commonCtrls/kekule.widget.nestedContainers.js","widgets/commonCtrls/kekule.widget.treeViews.js","widgets/commonCtrls/kekule.widget.listViews.js","widgets/commonCtrls/kekule.widget.dialogs.js","widgets/commonCtrls/kekule.widget.msgPanels.js","widgets/commonCtrls/kekule.widget.tabViews.js","widgets/advCtrls/kekule.widget.valueListEditors.js","widgets/advCtrls/kekule.widget.colorPickers.js","widgets/advCtrls/kekule.widget.textEditors.js","widgets/advCtrls/kekule.widget.widgetGrids.js","widgets/advCtrls/objInspector/kekule.widget.objInspectors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.propEditors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.operations.js","widgets/advCtrls/kekule.widget.configurators.js","widgets/advCtrls/grids/kekule.widget.dataSets.js","widgets/advCtrls/grids/kekule.widget.dataGrids.js","widgets/sys/kekule.widget.sysMsgs.js","widgets/operation/kekule.operHistoryTreeViews.js"],category:"widget"},chemWidget:{requires:["lan","root","common","core","html","io","render","algorithm","widget"],files:["widgets/chem/kekule.chemWidget.base.js","widgets/chem/kekule.chemWidget.dialogs.js","widgets/chem/periodicTable/kekule.chemWidget.periodicTables.js","widgets/chem/kekule.chemWidget.chemObjDisplayers.js","widgets/chem/structureTreeView/kekule.chemWidget.structureTreeViews.js","widgets/chem/uiMarker/kekule.chemWidget.uiMarkers.js","widgets/chem/viewer/kekule.chemWidget.viewers.js","widgets/chem/viewer/kekule.chemWidget.viewerGrids.js","widgets/chem/viewer/kekule.chemWidget.chemObjInserters.js","widgets/chem/editor/kekule.chemEditor.extensions.js","widgets/chem/editor/kekule.chemEditor.baseEditors.js","widgets/chem/editor/kekule.chemEditor.operations.js","widgets/chem/editor/kekule.chemEditor.editorUtils.js","widgets/chem/editor/kekule.chemEditor.configs.js","widgets/chem/editor/kekule.chemEditor.repositoryData.js","widgets/chem/editor/kekule.chemEditor.repositories.js","widgets/chem/editor/kekule.chemEditor.utilWidgets.js","widgets/chem/editor/kekule.chemEditor.chemSpaceEditors.js","widgets/chem/editor/kekule.chemEditor.nexus.js","widgets/chem/editor/kekule.chemEditor.actions.js","widgets/chem/editor/kekule.chemEditor.trackParser.js","widgets/chem/editor/kekule.chemEditor.objModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.styleModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.textModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.structureModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.glyphModifiers.js","chemdoc/issueCheckers/kekule.issueCheckers.js","widgets/chem/editor/issueInspectors/kekule.chemEditor.issueCheckers.js","widgets/chem/editor/issueInspectors/kekule.chemEditor.issueInspectors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.chemPropEditors.js","widgets/chem/editor/kekule.chemEditor.composers.js"],category:"chemWidget"},webComponent:{requires:["lan","root","common","core","html","io","render","algorithm","widget","chemWidget"],files:["webComponents/kekule.webComponent.base.js","webComponents/kekule.webComponent.widgetWrappers.js"]},algorithm:{requires:["lan","root","common","core"],files:["algorithm/kekule.graph.js","algorithm/kekule.structures.helpers.js","algorithm/kekule.structures.canonicalizers.js","algorithm/kekule.structures.ringSearches.js","algorithm/kekule.structures.aromatics.js","algorithm/kekule.structures.standardizers.js","algorithm/kekule.structures.searches.js","algorithm/kekule.structures.stereos.js"],category:"algorithm"},calculation:{requires:["lan","root","common","core","algorithm"],files:["calculation/kekule.calc.base.js"]},data:{requires:["root"],files:["data/kekule.chemicalElementsData.js","data/kekule.isotopesData.organSet.js","data/kekule.structGenAtomTypesData.js","data/kekule.dataUtils.js"]},emscripten:{requires:["root","common"],files:["_extras/kekule.emscriptenUtils.js"],category:"extra"},openbabel:{requires:["lan","root","core","emscripten","io"],files:["localization/en/kekule.localize.extras.openbabel.en.js","_extras/OpenBabel/kekule.openbabel.base.js","_extras/OpenBabel/kekule.openbabel.io.js","_extras/OpenBabel/kekule.openbabel.structures.js"],category:"extra"},indigo:{requires:["lan","root","core","emscripten","io"],files:["_extras/Indigo/kekule.indigo.base.js","_extras/Indigo/kekule.indigo.io.js","_extras/Indigo/kekule.indigo.structures.js"],category:"extra"},inchi:{requires:["lan","root","core","emscripten","io"],files:["_extras/InChI/kekule.inchi.js"],category:"extra"}},y=["lan","root","localization","localizationData","common"],_=y.concat(["core","html","io","render","widget","chemWidget","algorithm","calculation","data"]),E=(_.concat(["emscripten","inchi","openbabel","indigo"]),y.concat(["core","io","algorithm","calculation","data"])),T=[];function O(e){for(var t=e||_,r=[],n=function e(t,r){if(t.indexOf(r)<0){var n=C[r];if(n&&n.requires)for(var i=0,o=n.requires.length;i<o;++i){e(t,n.requires[i])}t.push(r)}},i=0,o=(t=y.concat(t)).length;i<o;++i){n(r,t[i])}return r}function v(e,t,r,n,i){void 0!==d&&d.LOADED&&(d.LOADED=!1);for(var o=n.modules||[],a=[],s=0,l=e.length;s<l;++s)o.indexOf(e[s])<0&&a.push(e[s]);var u=function(e,t){for(var r=O(e),n=[],i=0,o=r.length;i<o;++i){var a=r[i],s=C[a];if(s&&s.files)if(t){var l=s.minFile||a+".min.js";n.indexOf(l)<0&&n.push(l)}else n=n.concat(s.files)}return n}(a,t),c=[],h=r,p=n.fileUrls||[],g=[];for(s=0,l=u.length;s<l;++s){var f=h+u[s];p.indexOf(f)<0&&(g.push(f),c.push(u[s]))}return g.push(h+"kekule.loaded.js"),m(g,null,(function(e){n.modules=n.modules.concat(a),n.files=n.files.concat(c),n.fileUrls=n.fileUrls.concat(g),i&&i(e)})),{modules:a,files:c,fileUrls:g}}c?e.exports=r(6987):function(){var d;if(s){var c=(d=function(e){var t,r=/^(.*\/?)kekule(.min)?\.js(\?.*)?$/,n=/^domloader\=(.+)$/,i=/^min\=(.+)$/,o=/^modules\=(.+)$/,a=/^locals\=(.+)$/,s=/^language\=(.+)$/;if(!h)if(e&&e.currentScript&&e.currentScript.src)(u=decodeURIComponent(e.currentScript.src))&&(t=u.match(/^(.*[\/\\])([^\/\\]*)\.js(\?.*)?$/));else for(var l=e.getElementsByTagName("script"),d=l.length-1;d>=0;--d){var u,c=l[d];if((u=decodeURIComponent(c.src))&&(t=u.match(r)))break}if(t){t[2];var p=t[3];p&&(p=p.substr(1));var g={src:u,path:t[1],paramStr:p,useMinFile:!0};if(g.paramStr){for(var f=g.paramStr.split("&"),m=0,C=f.length;m<C;++m){var y=f[m].match(i);if(y){var E=y[1].toLowerCase(),O=["false","no","f","n"].indexOf(E)<0;g.useMinFile=O}else{var v=f[m].match(o);if(v)var S=v[1].split(",");else{var b=f[m].match(n);if(b)E=b[1].toLowerCase(),O=["false","no","f","n"].indexOf(E)<0,g.forceDomLoader=O;else{var A=f[m].match(a);if(A){var I=A[1].split(",");g.locals=I}else{var R=f[m].match(s);R&&(E=R[1],g.language=E)}}}}}if(g.modules=S||_,g.locals||(g.locals=T),g.locals||g.language){var D=[].concat(g.locals||[]);if(g.language&&D.indexOf(g.language)<0&&D.push(g.language),D.length){var N=g.modules.indexOf("localizationData");for(N<0&&(N=-1),m=0,C=D.length;m<C;++m){var P=D[m];"en"!==P&&g.modules.splice(N+1,0,"localizationData."+P)}}}}return g}return{src:"",path:"",modules:_,useMinFile:!0}}(i)).src&&d.path;c&&(u=!1),!c&&l&&(d.src=this.__filename||"",d.path="//",u=!0)}else u&&(d={src:this.__filename||"",path:"//",modules:s?_:E,useMinFile:!0,nodeModule:e,nodeRequire:(r(5398),r(5398))});if(u){var p=d.path+C.root.minFile,m=!1;try{m=o.existsSync(p)}catch(n){m=!1}m||(d.useMinFile=!1)}d.singleMinBundle=n&&n.__$kekule_single_min_bundle__,d.explicitModules=d.modules;var y=O(d.modules);d.modules=[],d.files=[],d.fileUrls=[],d.allModuleStructures=C,n.__$kekule_load_info__=d,n.__$kekule_scriptfile_utils__={appendScriptFile:g,appendScriptFiles:f,loadModuleScriptFiles:v},d.singleMinBundle&&void 0!==d.singleMinBundle||v(y,d.useMinFile,d.path,d,(function(e){t.Kekule=this.Kekule||a.Kekule,t.Class=this.Class||a.Class,t.ClassEx=this.ClassEx||a.ClassEx,t.ObjectEx=this.ObjectEx||a.ObjectEx,t.DataType=this.DataType||a.DataType,this.Class=t.Class,this.ClassEx=t.ClassEx,this.ObjectEx=t.ObjectEx,this.DataType=t.DataType,this.Kekule.scriptSrcInfo=d}))}()}(this),function(e){function t(){}function n(e){if(!e)return[];if(e.toArray)return e.toArray();for(var t=e.length||0,r=new Array(t);t--;)r[t]=e[t];return r}"object"==typeof self?e=self:"object"==typeof window&&window.document?e=window:"object"==typeof r.g&&(e=r.g);var i={createCore:function(){var e=null,r=n(arguments),o=r.length>1?r[1]:r[0],a=o&&o.CLASS_NAME;if(!r[0]&&r.length>1)throw"Can not create new class"+(a?" "+a:"")+" , base class not found";function s(){this.initialize.apply(this,arguments)}if(Object.isFunction(r[0])&&(e=r.shift()),Object.extend(s,i.Methods),s.superclass=e,s.subclasses=[],e){var l=function(){};l.prototype=e.prototype,s.prototype=new l,e.subclasses.push(s)}for(var d=0;d<r.length;d++)s.addMethods(r[d]);return s.prototype.initialize||(s.prototype.initialize=t),s.prototype.constructor=s,a&&(i._named_classes[a]=s),s},create:function(){return i.createCore.apply(this,arguments)},free:function(e){e.finalize&&e.finalize(),e=null},findClass:function(e,t){var r=i._named_classes[e];if(!r){var n=Object.getCascadeFieldValue(e,t);r=n&&Object.isFunction(n)&&(n.superclass||n.subclasses)?n:null}return r},_named_classes:{}};i.Methods={addMethods:function(e){if(!e)return this;var t=this.superclass&&this.superclass.prototype,r=Object.keys(e);Object.keys({toString:!0}).length||r.push("toString","valueOf");for(var n=function(){},i=0,a=r.length;i<a;i++){var s=r[i],l=e[s],d=Object.isFunction(l);if(t&&d&&"$super"===o.argumentNames(l)[0]){var u=l;(l=function(e){return function(){return(t[e]||n).apply(this,arguments)}}(s).wrap(u)).valueOf=u.valueOf.bind(u),l.toString=u.toString.bind(u)}this.prototype[s]=l}return this}},Object.extend=function(e,t,r,n){if(r||n)for(var i in t){var o=t[i];r&&null==o||n&&""===o||(e[i]=o)}else for(var i in t)e[i]=t[i];return e},Object.extendEx=function(e,t,r){var n=r||{};for(var i in t){var o=t[i];if((!n.ignoreUnsetValue||null!=o)&&(!n.ignoreEmptyString||""!==o)){var a=e[i];if(!r.preserveExisted||!a){var s=a&&a.constructor&&a.constructor.prototype,l=o&&o.constructor&&o.constructor.prototype;a&&"object"==typeof a&&s===l?Object.extendEx(a,o,r):e[i]=o}}}return e},Object._extendSupportMethods=function(e,t){return Object.extendEx(e,t,{ignoreUnsetValue:!0,preserveExisted:!0})},Object.getCascadeFieldValue=function(t,r){var n,i;i=t.length&&t.splice?t:t.split("."),r||(r=e||this);for(var o=0,a=i.length;o<a&&(n=r[i[o]]);++o)r=n;return n},Object.setCascadeFieldValue=function(e,t,r,n){for(var i,o=r,a=0,s=(i=e.length&&e.splice?e:e.split(".")).length;a<s;++a){var l=i[a];if(a===s-1)return o[l]=t,t;var d=o[l];if(!d&&n&&(d={},o[l]=d),!d)return!1;o=d}},Object._inherit=function(e){null===e&&(e={});var t=typeof e;if(!s.isFunctionType(t)&&!s.isObjectType(t))throw TypeError();function r(){}return r.prototype=e,new r},Object.create||(Object.create=Object._inherit),Object.copyValues=function(e,t,r){if(r){for(var n=0,i=r.length;n<i;++n){var o=r[n],a=t[o];void 0!==a&&(e[o]=a)}return e}return Object.extend(e,t)},Object._extendSupportMethods(Object,{keys:function(e){var t=[];for(var r in e)t.push(r);return t},isFunction:function(e){return"function"==typeof e},isUndefined:function(e){return void 0===e}}),Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t});var o={argumentNames:function(e){var t=((e.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)||[])[1]||"").replace(/\s+/g,"").split(",");return 1!=t.length||t[0]?t:[]}};Object._extendSupportMethods(Function.prototype,{argumentNames:function(){var e=this.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1].replace(/\s+/g,"").split(",");return 1!=e.length||e[0]?e:[]},wrap:function(e){var t=this;return function(){return e.apply(this,[t.bind(this)].concat(n(arguments)))}},methodize:function(){if(this._methodized)return this._methodized;var e=this;return this._methodized=function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),e.apply(null,t)}},bind:function(){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var e=this,t=n(arguments),r=t.shift();return function(){return e.apply(r,t.concat(n(arguments)))}},delay:function(){var t=this,r=n(arguments),i=r.shift();return e.setTimeout((function(){return t.apply(t,r)}),i)},defer:function(){var t=this,r=n(arguments);return r.shift(),e.setTimeout((function(){return t.apply(t,r)}),10)}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){t||(t=0);var r=this.length;for(t<0&&(t=r+t);t<r;t++)if(this[t]===e)return t;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e,t){t=isNaN(t)?this.length:(t<0?this.length+t:t)+1;var r=this.slice(0,t).reverse().indexOf(e);return r<0?r:t-r-1}),Array.prototype.map&&(Array.prototype.map=function(e){var t,r,n;if(null==this)throw new TypeError("this is null or not defined");var i=Object(this),o=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=arguments[1]),r=new Array(o),n=0;n<o;){var a,s;n in i&&(a=i[n],s=e.call(t,a,n,i),r[n]=s),n++}return r}),Object._extendSupportMethods(String.prototype,{gsub:function(e,t){for(var r="",n=this;n.length>0;)void 0===n.match(e)?(r+=n.slice(0,(void 0).index),r+=t,n=n.slice((void 0).index+(void 0)[0].length)):(r+=n,n="");return r},sub:function(e,t,r){return r=Object.isUndefined(r)?1:r,this.gsub(e,(function(e){return--r<0?e[0]:t(e)}))},scan:function(e,t){return this.gsub(e,t),String(this)},truncate:function(e,t){return e=e||30,t=Object.isUndefined(t)?"...":t,this.length>e?this.slice(0,e-t.length)+t:String(this)},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var e=new RegExp(Prototype.ScriptFragment,"img"),t=new RegExp(Prototype.ScriptFragment,"im");return(this.match(e)||[]).map((function(e){return(e.match(t)||["",""])[1]}))},escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />")},unescapeHTML:function(){return this.replace(/\<br \/\>/g,"\n").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},toQueryParams:function(e){var t=this.strip().match(/([^?#]*)(#.*)?$/);return t?t[1].split(e||"&").inject({},(function(e,t){if((t=t.split("="))[0]){var r=decodeURIComponent(t.shift()),n=t.length>1?t.join("="):t[0];null!=n&&(n=decodeURIComponent(n)),r in e?(Object.isArray(e[r])||(e[r]=[e[r]]),e[r].push(n)):e[r]=n}return e})):{}},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(e){return e<1?"":new Array(e+1).join(this)},camelize:function(){var e=this.split("-"),t=e.length;if(1==t)return e[0];for(var r="-"==this.charAt(0)?e[0].charAt(0).toUpperCase()+e[0].substring(1):e[0],n=1;n<t;n++)r+=e[n].charAt(0).toUpperCase()+e[n].substring(1);return r},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},capitalizeFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},underscore:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()},dasherize:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1-$2").replace(/([a-z\d])([A-Z])/g,"$1-$2").replace(/-/g,"-").toLowerCase()},inspect:function(e){var t=this.gsub(/[\x00-\x1f\\]/,(function(e){return String.specialChar[e[0]]||"\\u00"+e[0].charCodeAt().toPaddedString(2,16)}));return e?'"'+t.replace(/"/g,'\\"')+'"':"'"+t.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(!0)},unfilterJSON:function(e){return this.sub(e||Prototype.JSONFilter,"#{1}")},isJSON:function(){var e=this;return!e.blank()&&(e=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""),/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/.test(e))},include:function(e){return this.indexOf(e)>-1},startsWith:function(e){return 0===this.indexOf(e)},endsWith:function(e){var t=this.length-e.length;return t>=0&&this.lastIndexOf(e)===t},empty:function(){return""==this},blank:function(){return/^\s*$/.test(this)},interpolate:function(e,t){return new Template(this,t).evaluate(e)}}),Object._extendSupportMethods(String.prototype,{upperFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},format:function(){for(var e=this,t=0;t<arguments.length;t++){var r=new RegExp("\\{"+t+"\\}","gi");e=e.replace(r,arguments[t])}return e},trim:function(){return this.replace(/^\s*|\s*$/g,"")},ltrim:function(){return this.replace(/^\s+/,"")},rtrim:function(){return this.replace(/\s+$/,"")},trimLeft:function(){return this.ltrim()},trimRight:function(){return this.rtrim()},pad:function(e,t,r){for(var n=t||" ",i=[],o=0,a=e-this.length;o<a;++o)i.push(n);return r?this+i.join(""):i.join("")+this},lpad:function(e,t){return this.pad(e,t,!1)},rpad:function(e,t){return this.pad(e,t,!0)},reverse:function(){for(var e=[],t=this.length-1;t>=0;--t)e.push(this.charAt(t));return e.join("")},toCharArray:function(){for(var e=[],t=0,r=this.length;t<r;++t)e.push(this.charAt(t));return e},hyphenize:function(e){e||(e="-");for(var t=this.length,r=[],n=0;n<t;++n){var i=this.charAt(n);0!==n&&i>="A"&&i<="Z"?r.push(e+i.toLowerCase()):r.push(i)}return r.join("")}});var a={STRUE:"$TRUE",SFALSE:"$FALSE",SUNDEFINED:"$UNDEFINED",SNULL:"$NULL",SNAN:"$NAN",SPOSITIVE:"+",SNEGATIVE:"-",SDATEPREFIX:"@",isAllDigitalChar:function(e){for(var t=0,r=e.length;t<r;++t){var n=e.charAt(t);if(!(n>="0"&&n<="9")&&"."!=n)return!1}return!0},isNumbericStr:function(e){var t=Number(e);return!isNaN(t)},serializeValue:function(e,t){var r=t||[],n=s.getType(e);if(r.indexOf(n)>=0)return e.toString();if(null===e)return a.SNULL;if(void 0===e)return a.SUNDEFINED;if(e!=e)return a.SNAN;switch(n){case"boolean":return e?a.STRUE:a.SFALSE;case"number":case s.INT:case s.FLOAT:return(e>=0?a.SPOSITIVE:"")+e;case s.DATE:return a.SDATEPREFIX+e.toString();default:return e.toString()}},deserializeValue:function(e,t){if("string"!=typeof e)return e;switch(e){case a.STRUE:return!0;case a.SFALSE:return!1;case a.SNULL:return null;case a.SUNDEFINED:return;case a.SNAN:return NaN;default:if(t){if(!e&&[s.NUMBER,s.INT,s.FLOAT].indexOf(t)>=0)return;switch(t){case s.FLOAT:return parseFloat(e);case s.INT:return parseInt(e);case"number":return parseFloat(e);case"boolean":return!!e;default:return e}}else switch(e.charAt(0)){case a.SPOSITIVE:case a.SNEGATIVE:var r=e.substring(1);return a.isNumbericStr(r)?parseFloat(e):e;case a.SDATEPREFIX:r=e.substr(1);try{var n=new Date(r);return isNaN(n.getTime())?e:n}catch(t){return e}default:return e}}}};Object.extend(Date.prototype,{copyFrom:function(e){this.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),this.setTime(e.getTime())}}),Date.now||(Date.now=function(){return(new Date).getTime()}),Math.sqr||(Math.sqr=function(e){return e*e}),Math.sign||(Math.sign=function(e){return e>0?1:e<0?-1:0}),void 0===e.Node&&(e.Node=function(){}),e.Node.ELEMENT_NODE||Object.extend(e.Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}),i.PropertyScope={DEFAULT:3,PUBLISHED:3,PUBLIC:2,PRIVATE:1},i.PropList=function(){this.props=[]},i.PropList.prototype={addProperty:function(e,t){var r;return t||(t={}),(r=this.getPropInfo(e))||(r={},this.props.push(r)),void 0===(r=Object.extend(r,t)).serializable&&(r.serializable=!0),r.name=e,r},removeProperty:function(e){var t=this.indexOf(e);t>=0&&this.props.splice(t,1)},removePropAt:function(e){e>=0&&this.props[e]&&this.props.splice(e,1)},getLength:function(){return this.props.length},indexOf:function(e){for(var t=0,r=this.props.length;t<r;++t)if(this.props[t].name===e)return t;return-1},getPropInfoAt:function(e){return e>=0?this.props[e]:null},getPropInfo:function(e){var t=this.indexOf(e);return this.getPropInfoAt(t)},hasProperty:function(e){return this.indexOf(e)>=0},clear:function(){this.props.clear()},clone:function(){var e=new i.PropList;return e.props=this.props.slice(),e},appendList:function(e){for(var t=0,r=e.props.length;t<r;++t)this.props.push(e.props[t])}},i.PropList.prototype.constructor=i.PropList,i.EventHandlerList=function(){this.handlers=[],this._$flag_="KekuleEventList"},i.EventHandlerList.prototype={add:function(e,t){t||(t=null),this.handlers.push({thisArg:t,handler:e})},remove:function(e,t){var r=this.indexesOf(e,t);if(r.length>0)for(var n=r.length-1;n>=0;--n)this.removeAt(r[n])},removeAt:function(e){for(var t=e,r=this.handlers.length;t<r;++t)this.handlers[t]=this.handlers[t+1];this.handlers.length=this.handlers.length-1},clear:function(){this.handlers=[]},getHandlerInfo:function(e){return this.handlers[e]},indexOf:function(e,t){for(var r=0,n=this.handlers.length;r<n;++r)if(this.handlers[r].handler==e){if(void 0!==t&&this.handlers[r].thisArg===t)return r;if(void 0===t)return r}return-1},indexesOf:function(e,t){for(var r=[],n=0,i=this.handlers.length;n<i;++n)this.handlers[n].handler==e&&(void 0!==t&&this.handlers[n].thisArg===t||void 0===t)&&r.push(n);return r},getLength:function(){return this.handlers.length}},i.EventHandlerList.constructor=i.EventHandlerList;var s={UNKNOWN:null,VARIANT:null,PRIMARY:"primary",UNDEFINED:"undefined",BOOL:"boolean",BOOLEAN:"boolean",NUMBER:"number",INT:"int",INTEGER:"int",FLOAT:"float",STRING:"string",ARRAY:"array",FUNCTION:"function",DATE:"date",HASH:"object",OBJECT:"object",OBJECTEX:"objectex",CLASS:"class",isSimpleType:function(e){return e==s.STRING||e==s.NUMBER||e==s.INT||e==s.FLOAT||e==s.BOOL||e==s.UNDEFINED||e==s.PRIMARY},isComplexType:function(e){return!(s.isSimpleType(e)||s.isFunctionType(e))},isFunctionType:function(e){return e==s.FUNCTION},isObjectType:function(e){return e==s.OBJECT},isDateType:function(e){return e==s.DATE},isObjectExType:function(e){var t=s.isComplexType(e)&&!s.isObjectType(e)&&!s.isDateType(e);if(t){var r=d.findClass(e);t=r&&d.isOrIsDescendantOf(r,u)}return t},getType:function(e){var t=typeof e;switch(t){case"undefined":return s.UNDEFINED;case"function":return s.FUNCTION;case"boolean":return s.BOOL;case"string":return s.STRING;case"number":return Math.floor(e)==e?s.INT:s.FLOAT;case"object":return this.isDateValue(e)?s.DATE:s.isArrayValue(e)?s.ARRAY:d.isClass(e)?s.CLASS:s.isObjectExValue(e)&&e.getClassName?e.getClassName():s.OBJECT;default:return t}},isSimpleValue:function(e){return s.isSimpleType(typeof e)},isUndefinedValue:function(e){return void 0===e},isNullValue:function(e){return null===e},isFunctionValue:function(e){return"function"==typeof e},isObjectValue:function(e){return!!e&&"object"==typeof e&&!s.isArrayValue(e)&&!s.isDateValue(e)},isDateValue:function(e){return!!e&&"object"==typeof e&&void 0!==e.getFullYear},isArrayValue:function(e){return!!e&&"object"==typeof e&&void 0!==e.length},isObjectExValue:function(e){return e instanceof u},createInstance:function(e){switch(e){case s.UNDEFINED:return;case s.DATE:return new Date;case s.ARRAY:return new Array;case s.OBJECT:return new Object;case s.FUNCTION:return function(){};default:return new(d.findClass(e.capitalizeFirst()))}}},l=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}(),d={isClass:function(e){return!!e&&!(!e.superclass&&!e.subclasses)},findClass:function(t,r){return i.findClass(t,r||e)},getClassName:function(e){return e?e.prototype.CLASS_NAME:null},getClassLocalName:function(e){var t=d.getClassName(e),r=t.lastIndexOf(".");return r>=0?t.substring(r+1):t},getPrototype:function(e){return e.prototype},getSuperClass:function(e){return e.superclass||e.constructor.superclass},getSuperClassPrototype:function(e){return e.superclass?e.superclass.prototype:null},_getCommonSuperClass2:function(e,t){for(var r=e;r&&!d.isOrIsDescendantOf(t,r);)r=d.getSuperClass(r);return r},getCommonSuperClass:function(e){if(!e||!e.length)return null;var t=e[0].getClass?e[0].getClass():null;if(!t)return null;for(var r=1,n=e.length;r<n;++r){var i=e[r].getClass?e[r].getClass():null;if(!i)return null;t=d._getCommonSuperClass2(t,i)}return t},isDescendantOf:function(e,t){for(var r=d.getSuperClass(e);r&&r!==t;)r=d.getSuperClass(r);return!!r},isOrIsDescendantOf:function(e,t){return e===t||d.isDescendantOf(e,t)},isOrIsDescendantOfClasses:function(e,t){for(var r=0,n=t.length;r<n;++r)if(d.isOrIsDescendantOf(e,t[r]))return!0;return!1},_ensurePropertySystem:function(e){var t=d.getPrototype(e);if(t&&!t.hasOwnProperty("properties")){var r=d.getSuperClass(e);r&&d._ensurePropertySystem(r),d._createPropertyList(e),d._remapPropGetters(e),t.hasOwnProperty("initProperties")&&t.initProperties.apply(t)}},_createPropertyList:function(e){d.getPrototype(e).hasOwnProperty("properties")||(d.getPrototype(e).properties=new i.PropList)},_remapPropGetters:function(e,t){for(var r=d.getPrototype(e),n=t||Object.getOwnPropertyNames(r),i=0,o=n.length;i<o;++i){var a=n[i];if(a.length>5&&a.startsWith("doGet")){var s=r[a];if("function"==typeof s){var u=a.charAt(5).toLowerCase()+a.substr(6);if(r.hasDirectProperty(u))continue;var c=d.getPropInfo(e,u);if(c&&c.getter&&(r["get"+u.capitalizeFirst()]=s,l)){var h=Object.extend({},c.descriptor);h.get=s;try{Object.defineProperty(r,u,h)}catch(e){throw e}}}}}},getOwnPropList:function(e){var t=d.getPrototype(e);return t?(t._initPropertySystem(),t.properties):null},getAllPropList:function(e){var t,r=d.getSuperClassPrototype(e);return r?(t=r.getAllPropList().clone()).appendList(d.getOwnPropList(e)):t=d.getOwnPropList(e),t},getPropListOfScopes:function(e,t){var r,n=function(e,t){var r=d.getOwnPropList(e).clone();if(r)for(var n=r.getLength()-1;n>=0;--n){var o=r.getPropInfoAt(n).scope||i.PropertyScope.DEFAULT;t.indexOf(o)<0&&r.removePropAt(n)}return r},o=d.getSuperClass(e);return o?(r=d.getPropListOfScopes(o,t).clone()).appendList(n(e,t)):r=n(e,t),r},defineProp:function(e,t,r){return d._ensurePropertySystem(e),d.getPrototype(e).defineProp(t,r)},defineProps:function(e,t){d._ensurePropertySystem(e);for(var r=d.getPrototype(e),n=0,i=t.length;n<i;++n){var o=t[n],a=o.name,s=o;r.defineProp(a,s)}},getPropInfo:function(e,t,r){return d.getPrototype(e).getPropInfo(t,r)},defineEvent:function(e,t){return d.getPrototype(e).defineEvent(t)},getUnusedMethodName:function(e,t,r){for(var n=r||0,i=d.getPrototype(e),o=t+Number(n).toString();i[o];)++n,o=t+Number(n).toString();return o},extendMethod:function(e,t,r){var n=d.getPrototype(e),i=n[t],o=d.getUnusedMethodName(e,"__$changed$_"+t+"__");n[o]=i;var a,s=(a=o,function(){return n[a].apply(this,arguments)}).wrap(r);n[t]=s,s.valueOf=r.valueOf.bind(r),s.toString=r.toString.bind(r)},extend:function(e,t){var r=d.getPrototype(e),n=d.getSuperClassPrototype(e),i=Object.keys(t);Object.keys({toString:!0}).length||i.push("toString","valueOf");for(var a=0,s=i.length;a<s;a++){var l=i[a],u=t[l];if("function"==typeof u){var c=o.argumentNames(u),h=c[0];if("$origin"==h){var p=u,g=r[l],f=d.getUnusedMethodName(e,"__$changed$_"+l+"__");r[f]=g,(u=function(e){return function(){return r[e].apply(this,arguments)}}(f).wrap(p)).valueOf=p.valueOf.bind(p),u.toString=p.toString.bind(p),c.shift(),h=c.first()}"$super"==h&&(p=u,(u=function(e){return function(){return n[e].apply(this,arguments)}}(l).wrap(p)).valueOf=p.valueOf.bind(p),u.toString=p.toString.bind(p))}r[l]=u}return d._remapPropGetters(e,i),e}},u=i.create({CLASS_NAME:"ObjectEx",EVENT_HANDLERS_FIELD:"__$__k__eventhandlers__$__",initialize:function(){this._initPropertySystem(),this._updateStatus=0,this._childChangeEventSuppressed=!1,this._modifiedProps=[],this._finalized=!1,this.beginUpdate();try{this.initPropValues()}finally{this.endUpdate()}this.afterInitialization()},afterInitialization:function(){},finalize:function(){this._finalized||(this.doFinalize(),this.invokeEvent("finalize",{obj:this}),this[this.EVENT_HANDLERS_FIELD]=null,this._finalized=!0)},doFinalize:function(){},initProperties:function(){this.defineProp("enablePropValueGetEvent",{dataType:s.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("enablePropValueSetEvent",{dataType:s.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("enableObjectChangeEvent",{dataType:s.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("bubbleEvent",{dataType:s.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("suppressChildChangeEventInUpdating",{dataType:s.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("eventHandlers",{dataType:s.HASH,serializable:!1,scope:i.PropertyScope.PRIVATE,setter:null,getter:function(){var e=this[this.EVENT_HANDLERS_FIELD];return e||(e={},this[this.EVENT_HANDLERS_FIELD]=e),e}})},initPropValues:function(){},getHigherLevelObj:function(){return null},saved:function(){},loaded:function(){},_initPropertySystem:function(){d._ensurePropertySystem(this.getClass())},_createPropertyList:function(){d._createPropertyList(this.getClass())},_remapPropGetters:function(){d._remapPropGetters(this.getClass())},getClass:function(){return this.constructor},getSuperClass:function(){return this.getClass().superclass},getClassName:function(){return this.getPrototype().CLASS_NAME},getClassLocalName:function(){return d.getClassLocalName(this.getClass())},getSerializationName:function(){return this.getClassName()},getPrototype:function(){return this.prototype?this.prototype:this.constructor.prototype},getSuperClassPrototype:function(){return this.constructor&&this.constructor.superclass?this.constructor.superclass.prototype:null},$super:function(e,t){var r=this.getSuperClassPrototype();return e?this.tryCallSuper.apply(this,arguments):r},applySuper:function(e,t,r){var n=this.__getLastSuperMethodCallTarget__(e),i=this.__getMethodBelongedPrototype__(e,n),o=this.__getMethodBelongedPrototype__(e,n.getSuperClassPrototype());o&&o===i&&(o=this.__getMethodBelongedPrototype__(e,o.getSuperClassPrototype()));var a=o&&o[e];if(a){var s;try{this.__pushSuperMethodCallTargetStack__(e,o),s=t?a.apply(this,t):a.apply(this)}finally{this.__popSuperMethodCallTargetStack__(e)}return s}if(!r)throw"Super method not found: "+e},tryApplySuper:function(e,t){return this.applySuper(e,t,!0)},tryCallSuper:function(){var e=n(arguments),t=e.shift();return this.tryApplySuper(t,e)},__getMethodBelongedPrototype__:function(e,t){if(!t)return null;if(t.hasOwnProperty(e))return t;var r=t.getSuperClassPrototype&&t.getSuperClassPrototype();return r&&r.__getMethodBelongedPrototype__?r.__getMethodBelongedPrototype__(e,r):null},__getSuperMethodCallTargetStack__:function(e){var t=this.__$superMethodCallTargetStacks__;t||(t={},this.__$superMethodCallTargetStacks__=t);var r=t[e];return r||(r=[],t[e]=r),r},__getLastSuperMethodCallTarget__:function(e){var t=this.__getSuperMethodCallTargetStack__(e);return t.length?t[t.length-1]:this.getPrototype()},__pushSuperMethodCallTargetStack__:function(e,t){this.__getSuperMethodCallTargetStack__(e).push(t)},__popSuperMethodCallTargetStack__:function(e){var t=null,r=this.__$superMethodCallTargetStacks__,n=r&&r[e];return n&&(t=n.pop(),n.length||delete r[e]),t},__changeClass__:function(e){var t=d.getPrototype(e);return this.prototype=t,this.__proto__=t,this.constructor=e,this.objectChange(["__proto__"]),this},getOwnPropList:function(){return this._initPropertySystem(),this.getPrototype().properties},getAllPropList:function(){var e,t=this.getSuperClassPrototype();return t?(e=t.getAllPropList().clone()).appendList(this.getOwnPropList()):e=this.getOwnPropList().clone(),e},getPropListOfScopes:function(e){return d.getPropListOfScopes(this.getClass(),e)},getPropInfoHashKey:function(e){return u._PROPINFO_HASHKEY_PREFIX+e},getDefPropStoreFieldName:function(e){return u._PROP_STOREFIELD_PREFIX+e},defineProp:function(e,t){var r;void 0===(r=t?Object.extend({},t):{}).serializable&&(r.serializable=!0),r.storeField=this.getDefPropStoreFieldName(e);var n,i,o=this.getOwnPropList().addProperty(e,r);if(null!==r.getter&&!1!==r.getter&&(n=this.createPropGetter(o,r.getter),o.getter=n.doGetterName),null!==r.setter&&!1!==r.setter&&(i=this.createPropSetter(o,r.setter),o.setter=i.doSetterName),this[this.getPropInfoHashKey(e)]=o,l){var a={enumerable:r.enumerable,configurable:!1};void 0===a.enumerable&&(a.enumerable=!0),n&&(a.get=this[n.getterName]),i&&(a.set=this[i.setterName]),o.descriptor=a;try{Object.defineProperty(this,e,a)}catch(e){throw e}}return o},createPropGetter:function(e,t){var r=e.name.toString().upperFirst(),n="get"+r,i="doGet"+r,o=this[i];if(!o){var a=e.storeField;o=t||function(){return this[a]},this.getPrototype()[i]=o}return this.getPrototype()[n]=o,{getterName:n,doGetterName:i}},createPropSetter:function(e,t){var r=e.name.toString(),n=r.upperFirst(),i="set"+n,o="doSet"+n,a=this[o];if(!this[o]){var s=e.storeField;a=t||function(e){this[s]=e},this.getPrototype()[o]=a}return this.getPrototype()[i]=function(){var e=arguments[0];return this[o].apply(this,arguments),this.notifyPropSet(r,e),this},{setterName:i,doSetterName:o}},hasProperty:function(e){return null!=this.getPropInfo(e)},hasDirectProperty:function(e){return null!=this.getPropInfo(e,!0)},getPropInfo:function(e,t){var r,n=e||"";if(t||(r=this[this.getPropInfoHashKey(n)||""]),!r&&!(r=this.getOwnPropList().getPropInfo(n))&&!t){var i=this.getSuperClassPrototype();r=i&&i.getPropInfo?i.getPropInfo(n):null}return r},getPropertyDataType:function(e){var t=this.getPropInfo(e);return t?t.dataType:null},isPropertySerializable:function(e){var t=this.getPropInfo(e),r=t&&t.serializable;return void 0===r||!!r},getPropStoreFieldValue:function(e){return this[u._PROP_STOREFIELD_PREFIX+e]},getPropValue:function(e){var t,r=this.getPropInfo(e);if(r){if(r.getter){var n=Array.prototype.slice.call(arguments);n.shift(),t=this[r.getter].apply(this,n)}else t=this[r.storeField];return t}return null},getCascadePropValue:function(e){for(var t,r,n=this,i=0,o=(r=e.length&&e.splice?e:e.split(".")).length;i<o&&(t=n.getPropValue(r[i]));++i)n=t;return t},getPropValues:function(e){var t={};if(s.isArrayValue(e))for(var r=0,n=e.length;r<n;++r)t[i=e[r]]=this.getPropValue(i);else if(s.isObjectValue(e))for(var i in e)e.hasOwnProperty(i)&&"function"!=typeof e[i]&&(t[i]=this.getPropValue(i));return t},setPropStoreFieldValue:function(e,t){this[u._PROP_STOREFIELD_PREFIX+e]=t},setPropValue:function(e,t,r){var n=this.getPropInfo(e);return n&&(n.setter?this[n.setter].apply(this,[t]):r&&(this[n.storeField]=t),this.notifyPropSet(e,t)),this},setPropValueX:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),r=this.getPropInfo(t);return r&&(r.setter&&this[r.setter].apply(this,e),this.notifyPropSet(t,this.getPropValue(t))),this},setPropValues:function(e,t){for(var r in e)if(e.hasOwnProperty(r)&&this.hasProperty(r)){var n=e[r];this.setPropValue(r,n,t)}return this},setCascadePropValue:function(e){for(var t,r=Array.prototype.slice.call(arguments),n=this,i=0,o=(t=(e=r.shift()).length&&e.splice?e:e.split(".")).length-1;i<o&&(n=n.getPropValue(t[i]));++i);return n&&(r.unshift(t[o]),n.setPropValueX.apply(n,r)),this},_isPropGetOrSetEvent:function(e){return"propValueGet"==e||"propValueSet"==e},notifyPropSet:function(e,t,r){this.isUpdating()?this._modifiedProps.indexOf(e)<0&&this._modifiedProps.push(e):this._isPropGetOrSetEvent(e)||this.isEventPropName(e)||(this.doPropChanged(e,t),this.getPropStoreFieldValue("enablePropValueSetEvent")&&this.invokeEvent("propValueSet",{propName:e,propValue:t}),r||this.objectChange([e]))},objectChange:function(e){var t=[].concat(e);if(this.doObjectChange(e),this.getEnableObjectChangeEvent()){var r=t.indexOf("enableObjectChangeEvent");r>=0&&t.splice(r,1),this.invokeEvent("change",{changedPropNames:t})}},doObjectChange:function(e){},doPropChanged:function(e,t){},defineEvent:function(e){},eventNameToPropName:function(e){return"__event_"+e},isEventPropName:function(e){return"string"==typeof e&&e.indexOf("__event_")>=0},isEventHandlerList:function(e){return e&&"object"==typeof e&&e instanceof i.EventHandlerList},getEventHandlerList:function(e){var t=this.getEventHandlers(),r=t[e];return r||(r=new i.EventHandlerList,t[e]=r),r},addEventListener:function(e,t,r){var n=this.getEventHandlerList(e);return this.isEventHandlerList(n)?("change"===e&&this.setEnableObjectChangeEvent(!0),n.add(t,r)):null},addOnceEventListener:function(e,t,r){var n=this;return this.addEventListener(e,(function i(o){n.removeEventListener(e,i,r),t(o)}),r)},removeEventListener:function(e,t,r){var n=this.getEventHandlerList(e);if(this.isEventHandlerList(n))return n.remove(t,r)},on:function(e,t,r){return this.addEventListener(e,t,r)},once:function(e,t,r){return this.addOnceEventListener(e,t,r)},off:function(e,t,r){return this.removeEventListener(e,t,r)},invokeEvent:function(e,t){t?(t.name=e,t.target=this):t={name:e,target:this},t.stopImmediatePropagation||(t.stopImmediatePropagation=this._eventStopImmediatePropagation),t.stopPropagation||(t.stopPropagation=this._eventCancelBubble),t.preventDefault||(t.preventDefault=this._eventPreventDefault),this.dispatchEvent(e,t)},_eventStopImmediatePropagation:function(){this._stopImmediatePropagation=!0,this._cancelBubble=!0},_eventCancelBubble:function(){this._cancelBubble=!0},_eventPreventDefault:function(){this._preventDefault=!0},relayEvent:function(e,t){t.currentTarget=this,"change"===e&&this.getSuppressChildChangeEventInUpdating()&&this.isUpdating()?this._childChangeEventSuppressed=!0:this.dispatchEvent(e,t)},dispatchEvent:function(e,t){for(var r=this.getEventHandlerList(e),n=0,i=r.getLength();n<i&&!t._stopImmediatePropagation;++n){var o=r.getHandlerInfo(n);o.handler.apply(o.thisArg,[t])}if(!t._cancelBubble&&this.getBubbleEvent()){var a=this.getHigherLevelObj();a&&a.relayEvent&&a.relayEvent(e,t)}},stopEventPropagation:function(e){e.cancelBubble=!0},overwriteMethod:function(e,t){var r=this,n=this[e];return this[e]=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(n&&n.bind(r)),t.apply(r,e)},this},assign:function(e){return e.assignTo(this)},assignTo:function(e){var t={};this.saveObj(t,"json"),e.loadObj(t,"json")},clone:function(){var e=new(this.getClass());return this.assignTo(e),e},beginUpdate:function(){this.doBeginUpdate()},doBeginUpdate:function(){++this._updateStatus},endUpdate:function(){if(--this._updateStatus,this.checkUpdateStatus(),!this.isUpdating()){var e=this._modifiedProps||[];this._modifiedProps=[],this._childChangeEventSuppressed&&(e.push("[children]"),this._childChangeEventSuppressed=!1),this.doEndUpdate(e)}},doEndUpdate:function(e){if(e.length){if(this.getPropStoreFieldValue("enablePropValueSetEvent"))for(var t=0,r=e.length;t<r;++t){var n=e[t],i=this.getPropValue(n);this.notifyPropSet(n,i,!0)}this.objectChange(e)}},isUpdating:function(){return this._updateStatus>0},isPropUpdated:function(e){return this._modifiedProps.indexOf(e)>=0},checkUpdateStatus:function(){this._updateStatus<=0&&(this._updateStatus=0)},copyPropsTo:function(e){for(var t=this.getAllPropList(),r=0,n=t.getLength();r<n;++r){var i=t.getPropInfoAt(r).name;if(e.hasProperty(i)){var o=this.getPropValue(i);e.setPropValue(i,o,!0)}}}});u._PROPINFO_HASHKEY_PREFIX="__$propInfo__",u._PROP_STOREFIELD_PREFIX="__$__k__p__",e.Class=i,e.ClassEx=d,e.ObjectEx=u,e.DataType=s,s.StringUtils=a}(this),function(e){"use strict";var t={parse:function(e){return JSON.parse(e)},serializeToStr:function(e,t){return t&&t.prettyPrint?JSON.stringify(e,null,t.indentSpaces||2):JSON.stringify(e)}},r={DOM_PARSER:null,DOM_IMPLEMENTATION:null,XML_SERIALIZER:null,DEF_INCLUDE_TAG_NAME:"include",DEF_INCLUDE_SRC_ATTRIB:"src",DEF_LOAD_TIMEOUT:2e4,DEF_BYPASS_ROOT_ELEM:!0,DEF_SERIALIZE_TO_JSCODE_VARNAME:"__xmlStr__",FILE_EXT_XML:".xml",FILE_EXT_XML_JS_WRAPPER:".xmljs",newDocument:function(e,t){if(e||(e=""),t||(t=""),r.DOM_IMPLEMENTATION)return(new r.DOM_IMPLEMENTATION).createDocument(t,e,null);if("undefined"!=typeof document){if(document.implementation&&document.implementation.createDocument)return document.implementation.createDocument(t,e,null);if("undefined"!=typeof ActiveXObject){var n=new ActiveXObject("MSXML2.DOMDocument");if(e){var i="",o=e,a=e.indexOf(":");-1!=a&&(i=e.substring(0,a),o=e.substring(a+1));var s="<"+(i?i+":":"")+o+(t?(i?" xmlns:":" xmlns")+i+'="'+t+'"':"")+"/>";n.loadXML(s)}return n}}},parse:function(e){if(r.DOM_PARSER)return(new r.DOM_PARSER).parseFromString(e,"application/xml");if("undefined"!=typeof document){if("undefined"!=typeof DOMParser)return(new DOMParser).parseFromString(e,"application/xml");if("undefined"!=typeof ActiveXObject){var t=r.newDocument();return t.loadXML(e),t}var n="data:text/xml;charset=utf-8,"+encodeURIComponent(e),i=new XMLHttpRequest;return i.open("GET",n,!1),i.send(null),i.responseXML}},load:function(e,t,n){return r.loadHelper.loadSimple(e,t,(n||{}).timeout)},loadHelper:{loadSimple:function(e,t,n){var i=null!=t;if(null==n&&(n=r.DEF_LOAD_TIMEOUT),document.implementation&&document.implementation.createDocument){var o=new XMLHttpRequest,a=null;n&&(a=setTimeout((function(){s(null,!1)}),n));var s=function(e,r){a&&clearTimeout(a),t&&t(e,r)};i&&(o.onreadystatechange=function(){if(4==o.readyState){var e=o.responseXML;e&&e.documentElement?s(e,!0):s(null,!1)}});try{o.open("get",e,i),o.send(null)}catch(e){s(null,!1)}var l=o.responseXML;return l&&l.documentElement?l:null}return r.loadHelper.loadSimpleViaDoc(e,t)},loadSimpleViaDoc:function(e,t){var n=null!=t,i=r.newDocument("dummy_dummy_dummy_dummy");return i.async=n,n&&(i.onreadystatechange=function(){4==i.readyState&&(i.documentElement&&"dummy_dummy_dummy_dummy"!=i.documentElement.tag?t(i,!0):t(i,!1))}),i.load(e),i}},serializeNode:function(e,t){if(t&&t.prettyPrint)return r.serializeNodePretty(e);if(r.XML_SERIALIZER)return(new r.XML_SERIALIZER).serializeToString(e);if("undefined"!=typeof XMLSerializer)return(new XMLSerializer).serializeToString(e);if(e.xml)return e.xml;throw"XML.serialize is not supported or can't serialize "+e},serializeNodePretty:function(e){try{return r.XML_SERIALIZER?(new r.XML_SERIALIZER).serializeToString(e).toXMLString():(new XMLSerializer).serializeToString(e).toXMLString()}catch(t){return r.serializeNode(e)}},getXmlDocUrl:function(e){return e.url||e.documentURI||e.URL||e.location}};DataType.JsonUtility=t,DataType.XmlUtility=r}(),function(){"use strict";var e=Class.create(ObjectEx,{CLASS_NAME:"ObjSerializer",SERIALIZER_NAME:null,getSerializerName:function(){return this.SERIALIZER_NAME},serializeValue:function(e){return e},deserializeValue:function(e,t){return e},propNameToStorageName:function(e){return e},storageNameToPropName:function(e){return e},getObjCustomSaveMethod:function(e){return e.doSaveObj},getObjCustomLoadMethod:function(e){return e.doLoadObj},getObjCustomPropSaveMethod:function(e){return e.doSaveProp},getObjCustomPropLoadMethod:function(e){return e.doLoadProp},isUndefined:function(e){return DataType.isUndefinedValue(e)},isNull:function(e){return null===e},isNaN:function(e){return e!=e},isFunction:function(e){return DataType.isFunctionValue(e)},isArray:function(e){return DataType.isArrayValue(e)},isDate:function(e){return DataType.isDateValue(e)},isObject:function(e){return DataType.isObjectValue(e)},isObjectEx:function(e){return DataType.isObjectExValue(e)},isSimpleType:function(e){var t=typeof e;return"string"==t||"number"==t||"boolean"==t||"undefined"==t||this.isNull(e)},isComplexType:function(e){return!this.isSimpleType(e)},createChildStorageNode:function(e,t,r){},appendArrayItemStorageNode:function(e,t,r){},getNameForArrayItemStorageNode:function(e){return this.getDefaultArrayItemStorageName()},getChildStorageNode:function(e,t){},getAllArrayItemStorageNodes:function(e){},getAllStoredStorageNames:function(e){},setStorageNodeExplicitType:function(e,t){},getStorageNodeExplicitType:function(e){},getStorageNodeName:function(e){},isComplexStorageNode:function(e){},isComplexArrayItemStorageNode:function(e){},isSimpleStorageNode:function(e){},getValueExplicitType:function(e){return e instanceof ObjectEx?e.getClassName():this.isObject(e)?DataType.OBJECT:this.isArray(e)?DataType.ARRAY:this.isDate(e)?DataType.DATE:typeof e},getDefaultArrayItemStorageName:function(){return"item"},getDefaultDateStorageName:function(){return"date"},save:function(e,t,r){if("object"==typeof e){var n=this.getObjCustomSaveMethod(e);if(n)return n(e,t,this)}var i=this.doSave(e,t,r||{});return i&&this.isFunction(e.saved)&&e.saved(),i},doSave:function(e,t,r){return"object"==typeof e&&(e instanceof ObjectEx?this.doSaveObjectEx(e,t,r):this.isArray(e)?this.doSaveArray(e,t):this.isDate(e)?this.doSaveDate(e,t):this.doSaveSimpleObject(e,t)),this.setStorageNodeExplicitType(t,this.getValueExplicitType(e)),e},doSaveSimpleObject:function(e,t){for(var r in e)if(e.hasOwnProperty(r)){var n,i=e[r];this.isComplexType(i)&&(n=this.getValueExplicitType(i)),this.doSaveFieldValue(e,r,i,t,n)}},doSaveArray:function(e,t){for(var r=0,n=e.length;r<n;++r){var i=e[r],o=this.getNameForArrayItemStorageNode(i);if(this.isComplexType(i)){var a=this.appendArrayItemStorageNode(t,this.propNameToStorageName(o),this.isArray(i));this.setStorageNodeExplicitType(a,this.getValueExplicitType(i)),this.save(i,a)}else this.doAppendArrayItemSimpleValue(this.serializeValue(i),typeof i,t)}},doSaveDate:function(e,t){var r=e.toUTCString();this.doSaveSimpleValue(e,this.propNameToStorageName(this.getDefaultDateStorageName()),this.serializeValue(r),DataType.DATE,t)},doSaveObjectEx:function(e,t,r){for(var n=e.getAllPropList(),i=r.propFilter,o=0,a=n.getLength();o<a;++o){var s=n.getPropInfoAt(o);if(!i||i(s,e)){var l=this.getObjCustomPropSaveMethod(e),d=!1;l&&(d=l(e,s,t,this)),d||s.serializable&&("function"==typeof s.serializable?s.serializable.apply(e):s.serializable)&&this.doSaveObjectExProp(e,s,t,r)}}},doSaveObjectExProp:function(e,t,r,n){var i=t.name,o=t.dataType,a=e.getPropValue(i);if(n.saveDefaultValues||a!==t.defaultValue){var s;a instanceof ObjectEx?a.getClassName()!=o&&(s=a.getClassName()):this.isComplexType(a)&&(s=this.getValueExplicitType(a))==o&&(s=void 0);var l=e.getPropSerializationName(i,this.getSerializerName())||i;this.doSaveFieldValue(e,l,a,r,s)}},doSaveFieldValue:function(e,t,r,n,i){if("function"!=typeof r)if(this.isComplexType(r)){var o=this.createChildStorageNode(n,this.propNameToStorageName(t),this.isArray(r));i&&this.setStorageNodeExplicitType(o,i),this.save(r,o)}else this.doSaveSimpleValue(e,this.propNameToStorageName(t),this.serializeValue(r),this.getValueExplicitType(r),n)},doSaveSimpleValue:function(e,t,r,n,i){},doAppendArrayItemSimpleValue:function(e,t,r){},load:function(e,t){if(!e){var r=this.getStorageNodeExplicitType(t);if(!r)return this.doLoadUntypedNode?this.doLoadUntypedNode(t):null;e=DataType.createInstance(r)}if("object"==typeof e){var n=this.getObjCustomLoadMethod(e);if(n)return n(e,t,this)}var i=this.doLoad(e,t);return i&&this.isFunction(e.loaded)&&e.loaded(),i},doLoad:function(e,t){if(this.getStorageNodeExplicitType(t),"object"==typeof e)if(e instanceof ObjectEx){e.beginUpdate();try{e=this.doLoadObjectEx(e,t)}finally{e.endUpdate()}}else e=this.isArray(e)?this.doLoadArray(e,t):this.isDate(e)?this.doLoadDate(e,t):this.doLoadSimpleObject(e,t);return e},doLoadArray:function(e,t){for(var r=this.getAllArrayItemStorageNodes(t),n=0,i=r.length;n<i;++n){var o=r[n];if(this.isComplexArrayItemStorageNode(o)){var a,s=this.getStorageNodeExplicitType(o)||this.getStorageNodeName(o);s?(a=DataType.createInstance(s),this.load(a,o)):(a={},this.load(a,o)),e.push(a)}else{var l=this.deserializeValue(this.doGetArrayItemSimpleStorageValue(o));e.push(l)}}return e},doLoadDate:function(e,t){var r=this.propNameToStorageName(this.getDefaultDateStorageName()),n=this.doLoadSimpleValue(e,r,DataType.DATE,t);if(n){var i=new Date(n);return e.copyFrom(i),e}},doLoadSimpleObject:function(e,t){for(var r=this.getAllStoredStorageNames(t),n=0,i=r.length;n<i;++n){var o=r[n],a=this.storageNameToPropName(o),s=this.getChildStorageNode(t,o);if(s){var l,d=this.getStorageNodeExplicitType(s);l=d?DataType.createInstance(d):{},this.load(l,s),e[a]=l}else{var u=this.doLoadSimpleValue(e,o,null,t);e[a]=u}}return e},doLoadObjectEx:function(e,t){for(var r=e.getAllPropList(),n=0,i=r.getLength();n<i;++n){var o=r.getPropInfoAt(n);if(o.serializable){var a=this.getObjCustomPropLoadMethod(e),s=!1;a&&(s=a(e,o,t,this)),s||this.doLoadObjectExProp(e,o,t)}}return e},doLoadObjectExProp:function(e,t,r){var n=t.name,i=t.dataType,o=e.getPropSerializationName(n,this.getSerializerName())||n,a=this.doLoadFieldValue(e,o,r,i);null!=a&&e.setPropValue(n,a,!0)},doLoadFieldValue:function(e,t,r,n){var i,o=!1;if(DataType.isComplexType(n)){var a=this.getChildStorageNode(r,this.propNameToStorageName(t));if(a){var s=this.getStorageNodeExplicitType(a);i=s&&s!=n?DataType.createInstance(s):DataType.createInstance(n),this.load(i,a),o=!0}}return!DataType.isSimpleType(n)&&o||(i=this.doLoadSimpleValue(e,this.propNameToStorageName(t),n,r)),i},doLoadSimpleValue:function(e,t,r,n){var i=this.doLoadSimpleStorageValue(t,n);return this.deserializeValue(i,r)},doLoadSimpleStorageValue:function(e,t){},doGetArrayItemSimpleStorageValue:function(e){}}),t=Class.create(e,{CLASS_NAME:"JsonObjSerializer",TYPE_TAG_NAME:"__type__",createChildStorageNode:function(e,t,r){var n=r?[]:{};return e[t]=n,n},appendArrayItemStorageNode:function(e,t,r){var n=r?[]:{};return e.push(n),n},getChildStorageNode:function(e,t){var r=e[t];return this.isSimpleType(r)&&(r=null),r},getAllArrayItemStorageNodes:function(e){return Array.prototype.slice.call(e)},getAllStoredStorageNames:function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&r!=this.TYPE_TAG_NAME&&t.push(r);return t},isComplexStorageNode:function(e){return this.isComplexType(e)},isComplexArrayItemStorageNode:function(e){return this.isComplexStorageNode(e)},isSimpleStorageNode:function(e){return this.isSimpleType(e)},setStorageNodeExplicitType:function(e,t){this.isArray(e)||(e[this.TYPE_TAG_NAME]=t)},getStorageNodeExplicitType:function(e){var t=e[this.TYPE_TAG_NAME]||null;return!t&&this.isArray(e)?DataType.ARRAY:t},doSaveSimpleValue:function(e,t,r,n,i){i[t]=r},doAppendArrayItemSimpleValue:function(e,t,r){return r.push(e)},doLoadSimpleStorageValue:function(e,t){return t[e]},doLoadUntypedNode:function(e){return e},doGetArrayItemSimpleStorageValue:function(e){return e}}),r=Class.create(e,{CLASS_NAME:"XmlObjSerializer",TYPE_TAG_NAME:"dataType",UNSUIT_PROPNAME_PREFIX:"__.",getLocalName:function(e){return e.localName||e.baseName||e.nodeName},getElemTextValue:function(e){for(var t="",r=0,n=e.childNodes.length;r<n;++r)e.childNodes[r].nodeType==Node.TEXT_NODE&&(t+=e.childNodes[r].nodeValue);return t},serializeValue:function(e){return DataType.StringUtils.serializeValue(e)},deserializeValue:function(e,t){return DataType.StringUtils.deserializeValue(e,t)},propNameToStorageName:function(e){var t=e.toString().charAt(0).toLowerCase();return"_"===t||t>="a"&&t<="z"?e:this.UNSUIT_PROPNAME_PREFIX+e},storageNameToPropName:function(e){return"string"!=typeof e?e:0===e.indexOf(this.UNSUIT_PROPNAME_PREFIX)?e.substr(this.UNSUIT_PROPNAME_PREFIX.length):e},createChildStorageNode:function(e,t,r){var n=e.ownerDocument.createElement(t);return e.appendChild(n),n},appendArrayItemStorageNode:function(e,t,r){return this.createChildStorageNode(e,t,r)},getAllArrayItemStorageNodes:function(e){for(var t=[],r=0,n=e.childNodes.length;r<n;++r){var i=e.childNodes[r];i.nodeType==Node.ELEMENT_NODE&&t.push(i)}return t},getAllStoredStorageNames:function(e){for(var t=[],r=0,n=e.childNodes.length;r<n;++r){var i=e.childNodes[r];i.nodeType==Node.ELEMENT_NODE&&this.getLocalName(i)!=this.TYPE_TAG_NAME&&t.push(this.getLocalName(i))}for(r=0,n=e.attributes.length;r<n;++r){var o=e.attributes[r];this.getLocalName(o)!=this.TYPE_TAG_NAME&&t.push(this.getLocalName(o))}return t},getChildStorageNode:function(e,t){for(var r=null,n=0,i=e.childNodes.length;n<i;++n){var o=e.childNodes[n];o.nodeType==Node.ELEMENT_NODE&&this.getLocalName(o)==t&&(r=o)}return r},isComplexStorageNode:function(e){return e.nodeType==Node.ELEMENT_NODE},isComplexArrayItemStorageNode:function(e){return this.isComplexStorageNode(e)&&e.attributes.length&&!this.getElemTextValue(e).trim()},isSimpleStorageNode:function(e){return e.nodeType==Node.ATTRIBUTE_NODE},setStorageNodeExplicitType:function(e,t){e.setAttribute(this.TYPE_TAG_NAME,t)},getStorageNodeExplicitType:function(e){return e.getAttribute(this.TYPE_TAG_NAME)||null},getStorageNodeName:function(e){var t=e.tagName;return t==this.getDefaultArrayItemStorageName()?null:t},doSaveSimpleObject:function(e,t){this.tryApplySuper("doSaveSimpleObject",[e,t])},doSaveArray:function(e,t){this.tryApplySuper("doSaveArray",[e,t])},doSaveSimpleValue:function(e,t,r,n,i){i.setAttribute(t,r)},doAppendArrayItemSimpleValue:function(e,t,r){var n=this.appendArrayItemStorageNode(r,this.propNameToStorageName(this.getDefaultArrayItemStorageName()),!1),i=n.ownerDocument.createTextNode(e);n.appendChild(i)},doLoadSimpleStorageValue:function(e,t){return t.getAttribute(e)||void 0},doGetArrayItemSimpleStorageValue:function(e){return this.getElemTextValue(e)}}),n={_serializerClasses:{},_defaultName:null,registerSerializer:function(e,t,r){var i="string"==typeof t?ClassEx.findClass(t):t;n._serializerClasses[e]=i,r&&(n._defaultName=e),ClassEx.getPrototype(t).SERIALIZER_NAME=e},getSerializer:function(e){var t=e||n._defaultName;if(t){var r=n._serializerClasses[t];return r?new r:null}return null}};n.registerSerializer("json",t,!0),n.registerSerializer("xml",r),Class.ObjSerializerFactory=n,ClassEx.extend(ObjectEx,{getPropSerializationName:function(e,t){return e},saveObj:function(e,t,r){return(t?"string"==typeof t?n.getSerializer(t):t:n.getSerializer()).save(this,e,r)},loadObj:function(e,t){var r,i;r=t?"string"==typeof t?n.getSerializer(t):t:n.getSerializer(),this.beginUpdate();try{i=r.load(this,e)}finally{this.endUpdate()}return i}}),Object.extend(ClassEx,{saveObj:function(e,t,r,i){return(r?"string"==typeof r?n.getSerializer(r):r:n.getSerializer()).save(e,t,i)},loadObj:function(e,t,r){return(r?"string"==typeof r?n.getSerializer(r):r:n.getSerializer()).load(e,t)}}),Object.extend(DataType,{valueToJson:function(e,t){if(DataType.isSimpleValue(e))return JSON.stringify(e);var r=DataType.isArrayValue(e)?[]:{};return ClassEx.saveObj(e,r,"json",t),JSON.stringify(r)},jsonToValue:function(e){var t=JSON.parse(e);return!t||DataType.isSimpleValue(t)?t:ClassEx.loadObj(null,t,"json")}})}();var d={LIBNAME:"Kekule.js",LIBNAME_CORE:"Kekule",VERSION:"0.9.7.21100300",LOADED:!1,_afterLoadSysProcedures:[],_afterLoadUserProcedures:[],PROP_AUTO_TITLE:!0,_loaded:function(){if(!d.LOADED){d.LOADED=!0;for(var e=d._afterLoadSysProcedures;e.length;)(t=e.shift())&&t();for(e=d._afterLoadUserProcedures;e.length;){var t;(t=e.shift())&&t()}var r=d.$jsRoot&&d.$jsRoot.document;if(r&&r.createEvent&&r.body&&r.body.dispatchEvent){var n=r.createEvent("Event");n.initEvent("kekuleload",!0,!0),r.body.dispatchEvent(n)}}},_isLoaded:function(){return d.LOADED},_registerAfterLoadSysProc:function(e){e&&(d.LOADED?e():d._afterLoadSysProcedures.push(e))},_ready:function(e){e&&(d.LOADED?e():d._afterLoadUserProcedures.push(e))}};d._registerAfterLoadProc=d._ready,d.$jsRoot=this,"object"==typeof self?d.$jsRoot=self:"object"==typeof window&&window&&window.document?d.$jsRoot=window:"object"==typeof r.g&&(d.$jsRoot=r.g),d.$jsRoot.Kekule=d,"object"==typeof window&&window&&window.document&&(d.window=window),d.$document=this&&this.document||null,d.scriptSrcInfo||(d.scriptSrcInfo=d.$jsRoot.__$kekule_load_info__),d.scriptSrcInfo&&d.scriptSrcInfo.language&&(d.language=d.scriptSrcInfo.language),!d.scriptSrcInfo&&d.$jsRoot.document&&(d.scriptSrcInfo=function(e){var t,r=/^(.*\/?)kekule\..*\.js(\?.*)?$/;if(e&&e.currentScript&&e.currentScript.src)(t=decodeURIComponent(e.currentScript.src))&&(o=t.match(/^(.*[\/\\])[^\/\\]*\.js(\?.*)?$/));else for(var n=document.getElementsByTagName("script"),i=n.length-1;i>=0;--i){var o,a=n[i];if((t=decodeURIComponent(a.src))&&(o=t.match(r)))break}if(o){var s=o[2];return s&&(s=s.substr(1)),{src:t,path:o[1],paramStr:s,useMinFile:!0}}return null}(d.$jsRoot.document)),d.scriptSrcInfo||(d.scriptSrcInfo={useMinFile:!0}),d.environment={scriptInfo:d.scriptSrcInfo,isNode:!("object"!=typeof process||"object"!=typeof process.versions||void 0===process.versions.node),isWeb:!("object"!=typeof window||!window.document),variables:{},getEnvVar:function(e){return d.environment.variables[e]||d.$jsRoot._kekule_environment_&&d.$jsRoot._kekule_environment_[e]},setEnvVar:function(e,t){d.environment.variables[e]=t}},d.scriptSrcInfo&&(d.environment.nodeModule=d.scriptSrcInfo.nodeModule,d.environment.nodeRequire=d.scriptSrcInfo.nodeRequire,d.environment.setEnvVar("kekule.path",d.scriptSrcInfo.path),d.environment.setEnvVar("kekule.scriptSrc",d.scriptSrcInfo.src),d.environment.setEnvVar("kekule.useMinJs",d.scriptSrcInfo.useMinFile),d.environment.setEnvVar("kekule.language",d.scriptSrcInfo.language)),d.$jsRoot.__$kekule_scriptfile_utils__&&(d._ScriptFileUtils_=d.$jsRoot.__$kekule_scriptfile_utils__,d.ScriptFileUtils=d._ScriptFileUtils_,d.modules=function(e,t){var r;r="string"==typeof e?[e]:e;var n=d.scriptSrcInfo;return n?(d._ScriptFileUtils_.loadModuleScriptFiles(r,d.isUsingMinJs(),d.getScriptPath(),n,(function(e){t&&t(e)})),this):this},d.loadModules=d.modules),d.scriptSrcInfo&&(d.scriptSrcInfo.getValue=function(e){return d.scriptSrcInfo[e]},d.scriptSrcInfo.setValue=function(e,t){d.scriptSrcInfo[e]=t}),d.getScriptPath=function(){return d.environment.getEnvVar("kekule.path")||d.scriptSrcInfo.path},d.getScriptSrc=function(){return d.environment.getEnvVar("kekule.scriptSrc")||d.scriptSrcInfo.src},d.isUsingMinJs=function(){return d.environment.getEnvVar("kekule.useMinJs")||d.scriptSrcInfo.useMinFile},d.getLanguage=function(){return d.environment.getEnvVar("kekule.language")||d.scriptSrcInfo.language},d._getStyleSheetBasePath=function(){return d.isUsingMinJs()?d.getScriptPath():d.getScriptPath()+"widgets/"},d.getStyleSheetUrl=function(){var e=d.environment.getEnvVar("kekule.themeUrl");return e||(e=d._getStyleSheetBasePath()+"themes/default/kekule.css"),e},d.$jsRoot&&d.$jsRoot.addEventListener&&d.$jsRoot.postMessage&&d.$jsRoot.addEventListener("message",(function(e){"kekule-sys-info-query"===e.data&&d.$jsRoot.postMessage({msg:"kekule-sys-info-result",libName:d.LIBNAME,version:d.VERSION},"*")}),!1),d.Dev={},d.Class=Class,d.ClassEx=ClassEx,d.ObjectEx=ObjectEx,d.DataType=DataType,function(e){"use strict";function t(e){var t=e.split(/[-|_]/);return{language:t[0],local:t[1]}}e||(e={});var r=d,n=d.getLanguage()||(e&&e.navigator?navigator.language||navigator.browserLanguage:"en-US");r.language=n;var i=t(n),o=t("en-US"),a=[i.language+"_"+i.local,i.language,o.language+o.local,o.language];d.Localization={},d.LocalizationRes={};var s=d.LocalizationRes;function l(e,t,r){var n=r||s[e];return!n&&t&&(n={},s[e]=n),n}function u(e,t,r){var n=l(t,!1,r);if(n){var i=Object.getCascadeFieldValue(e,n);if(void 0!==i)return i}}function c(e,t,r){for(var n=(t?[t]:[]).concat(a),i=0,o=n.length;i<o;++i){var s=u(e,n[i],r);if(void 0!==s)return s}}function h(e,t,r){var n=c(e,t,r);if(void 0!==n)return n;d.error("Can not find localization resource: "+e)}var p,g=[],f=!!(e||e.window).__kekuleMarkLocalizationModuleInfo__,m={};function C(e,t,r,n){if(r){var i=u(t,e,n);!function(e,t,r,n,i){var o=l(r,true,i);o&&Object.setCascadeFieldValue(e,t,o,true)}(t,i?Object.extendEx(i,r,{cascade:!0}):JSON.parse(JSON.stringify(r)),e,0,n)}}d.$L=h,d.Localization.getLanguages=function(){var e=[];for(var t in s)e.push(t);return e},d.Localization.getValue=h,d.Localization.findValue=c,d.Localization.getModuleInfos=function(){return m},d.Localization.setCurrModule=function(e){p=e,g.indexOf(e)<0&&g.push(e)},d.Localization.getModuleNames=function(){return g},d.Localization.addResource=function(e,t,r){C(e,t,r),f&&C(e,t,r,function(e,t){e=e||"GLOBAL";var r=Object.getCascadeFieldValue(e,m);return!r&&(r=Object.setCascadeFieldValue(e,{},m,!0)),r}(p))}}(this),d.LOCAL_RES=!0,d.Localization.setCurrModule("general"),d.Localization.addResource("en","Texts",{UNNAMED:"unnamed"}),d.Localization.addResource("en","ErrorMsg",{MODULE_NOT_LOADED:"Module {0} is not loaded",UNIT_NOT_FOUND:"Unit not found: {0}",UNABLE_TO_CONVERT_BETWEEN_UNITS:"Unable to convert between units {0} and {1}",NON_OWN_PROPERTY_CANNOT_BE_REPLACED:"Only directly owned property of object can be replaced",EMPTY_DOC:"Document is empty",ELEMENT_NOTSET:"Element not set",EMPTY_RESURI:"Resource URI is empty",CANNOT_LOAD_RES_OF_URI:"Can not load resource of URI: ",LIST_ITEM_CLASS_MISMATCH:"Mismatched item class, can not add to list",CANNOT_CLEAR_WEAKMAP:"Can not clear a weak map",CANNOT_GET_KEY_LIST_IN_WEAKMAP:"Can not get key array from a weak map",CANNOT_GET_VALUE_LIST_IN_WEAKMAP:"Can not get value array from a weak map",INVALID_CHEMELEMENT:"Invalid chemical element",INVALID_ISOTOPE:"Invalid isotope",COORD_STICK_NOT_ALLOWED_ON_CLASS:"Coordinate sticking is not allowed in this type of object",INVALID_STICK_TARGET_OBJ:"Invalid sticking target",UNABLE_TO_STICK_TO_OTHER_OWNER_OBJ:"Unable to stick to object with a different owner",UNABLE_TO_STICK_TO_OBJ_WITHOUT_ABS_COORD:"Unable to stick to object without absolute coordinates",STICK_RECURSION_NOT_ALLOWED:"Stick recursion is not allowed",UNABLE_ADD_MISTYPED_NODE:"Unable to link mistyped node to connector",UNABLE_ADD_DIFF_OWNER_OBJ:"Object with different owner can not be linked to connector",CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH:"Mismatched group item class",SORT_FUNC_UNSET:"Sort function is not set",SOURCE_FRAGMENT_NOT_SET:"Source structure fragment not set",UNABLE_ADD_NONMOLECULE_MAP:"Unable to add non-molecule to reactants or products",CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER:"Can not add object other than node or connector to structure object container",REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND:"Can not find registered canonicalization executor",ERROR_LOADING_FILE:"Error loading file: ",READER_ID_ALREADY_EXISTS:"Can not register reader: id already exists",WRITER_ID_ALREADY_EXISTS:"Can not register writer: id already exists",FAIL_TO_READ_FORMAT:"Fail to load data of format: ",NO_SUITABLE_READER_FOR_FORMAT:"Can not read data of format: ",NO_SUITABLE_READER_FOR_MIMETYPE:"Can not read data of MIME type: ",NO_SUITABLE_READER_FOR_FILEEXT:"Can not read data of file extension: ",NO_SUITABLE_WRITER_FOR_FORMAT:"Can not write data of format: ",NO_SUITABLE_WRITER_FOR_MIMETYPE:"Can not write data of MIME type: ",NO_SUITABLE_WRITER_FOR_FILEEXT:"Can not write data of file extension: ",AJAX_FILELOADER_NOT_FOUND:"AJAX file loader not found, can not load URL",FAIL_TO_LOAD_FILE_URL:"Fail to load file of URL: ",CML_ELEM_READER_NOT_FOUND:"Reader for element <{0}> not found",ATOMID_NOT_EXISTS:"Atom id not exists: ",BONDID_NOT_EXISTS:"Bond id not exists: ",CML_ELEM_WRITER_TYPE_INPROPER:"{0} is not a proper CML element writer for {1}",CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT:"Can not output content to empty element",UNABLE_TO_OUTPUT_AS_CML:"Unable to output object <{0}> to CML data",MDL_CTAB_ATOM_CANNOT_CREATE:"Can not create atom from source MDL format data",MDL_CTAB_BOND_CANNOT_CREATE:"Can not create bond from source MDL format data",CAN_NOT_WRITE_NON_MOLECULE_TO_MOL:"Object is not a molecule and can not be output to connection table",MOLECULE_HAS_NO_CTAB_TO_OUTPUT:"Molecule has no connection table and can not be output to MDL format",NOT_MDL2000_FORMAT_DATA:"Data format wrong: not MDL 2000",NOT_MDL_RXN_DATA:"Not MDL Reaction(RXN) data",MALFORMED_MDL3000_COUNTLINE:"Malformed MDL 3000 count line",MDL3000_ATOMBLOCK_NOT_FOUND:"Atom block not found, malformed MDL 3000 data?",NOT_MDL_FORMAT_DATA:"Data format wrong: not MDL 2000 or 3000",NOT_MDL2000_RXN_DATA:"Not MDL RXN 2000 data",NOT_MDL3000_RXN_DATA:"Not MDL RXN 3000 data",NOT_MDL3000_RXN_COUNTLINE:"Error in reading RXN 3000 count line",MDL_OUTPUT_DATATYPE_NOT_TEXT:"MDL data can not be output to non text format",MDL_INPUT_DATATYPE_NOT_TEXT:"Non text format is not a legal MDL source data",UNABLE_TO_OUTPUT_AS_MDL:"Unable to output object <{0}> to MDL data",KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT:"Non text or JSON format data is not a legal KCJ source",KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT:"Can not output as non text or JSON data",KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT:"Non text or DOM data is not a legal KCX source",KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT:"Can not output as non text or DOM data",JSON_SERIALIZER_NOT_EXISTS:"Serializer for JSON not exists",XML_SERIALIZER_NOT_EXISTS:"Serializer for XML not exists",INAVAILABLE_AUTOSCALE_REF_LENGTH:"Can not determine the length for calculation of auto scale",FORMULA_RENDERER_3D_NOT_AVAILABLE:"3D renderer for molecule formula is not available",CANNOT_FIND_SUITABLE_RENDERER_FOR_OBJ:"Can not find suitable renderer for object",THREEJS_LIB_NOT_UNAVAILABLE:"Three.js not available, try to include it through the <script> tag or import the module by Kekule.externalResourceManager.register method",THREEJS_DRAWING_NOT_UNAVAILABLE:"Webgl, Canvas or SVG is not supported in this browser, please upgrade to a modern one",CANVAS2D_NOT_UNAVAILABLE:"Canvas is not supported in this browser, please upgrade to a modern one",RAPHAEL_LIB_NOT_UNAVAILABLE:"Raphael.js not available, try to import it through the <script> tag",RAPHAEL_SVG_VML_UNAVAILABLE:"SVG or VML is not supported in this browser, please upgrade to a modern one",CALC_TERMINATED_BY_USER:"Calculation terminated by user",CALC_SERVICE_UNAVAILABLE:'Calculation service "{0}" is unavailable'}),d.Localization.addResource("en","ErrorCheckMsg",{GENERAL_ERROR_WITH_CODE:"Error code: {0}",ATOM_VALENCE_ERROR_WITH_SUGGEST:"Abnormal valence {1} of atom {0}, the possible value is {2}",ATOM_VALENCE_ERROR_WITH_SUGGESTS:"Abnormal valence {1} of atom {0}, the possible values are {2}",BOND_ORDER_EXCEED_ALLOWED_WITH_SUGGEST:"The bond order ({0}) exceeds the maximum allowed value ({1})",BOND_WITH_ID_ORDER_EXCEED_ALLOWED_WITH_SUGGEST:"The bond order of {0} ({1}) exceeds the maximum allowed value {2}",NODE_DISTANCE_TOO_CLOSE:"Atoms/subgroups are very close to each other",NODE_DISTANCE_TOO_CLOSE_WITH_LABEL:"Atoms/subgroups ({0}) are very close to each other",TITLE_CHANGE_BOND_ORDER_TO:"Change bond order to {0}",DESCRIPTION_CHANGE_BOND_ORDER_TO:"Change bond order from {0} to {1}",TITLE_MERGE_TO:"Merge {0} to {1}",DESCRIPTION_MERGE_TO:"Merge node {0} to {1}"}),d.LOCAL_RES=!0,d.Localization.setCurrModule("widget"),d.Localization.addResource("en","WidgetTexts",{CAPTION_OK:"OK",CAPTION_CANCEL:"Cancel",CAPTION_YES:"Yes",CAPTION_NO:"No",CAPTION_BROWSE_COLOR:"Browse colors",HINT_BROWSE_COLOR:"Browse more colors",S_COLOR_UNSET:"(unset)",S_COLOR_DEFAULT:"(default)",S_COLOR_MIXED:"(mixed)",S_COLOR_TRANSPARENT:"(transparent)",S_OBJECT_UNSET:"(none)",S_ITEMS:"item(s)",S_OBJECT:"object",S_VALUE_UNSET:"(Unset)",CAPTION_MENU:"Menu",HINT_MENU:"Open menu",S_INSPECT_NONE:"(none)",S_INSPECT_OBJECTS:"({0} objects)",S_INSPECT_ID_OBJECT:"{0}: {1}",S_INSPECT_ANONYMOUS_OBJECT:"({0})",CAPTION_TOGGLE_TEXTWRAP:"Toggle text wrapping",CAPTION_INC_TEXT_SIZE:"Increase text size",CAPTION_DEC_TEXT_SIZE:"Decrease text size",HINT_TOGGLE_TEXTWRAP:"Toggle the state of text wrapping",HINT_INC_TEXT_SIZE:"Increase text size",HINT_DEC_TEXT_SIZE:"Decrease text size",HINT_CHOOSE_FONT_FAMILY:"Choose font family",CAPTION_FIRST_PAGE:"First",CAPTION_LAST_PAGE:"Last",CAPTION_PREV_PAGE:"Prev",CAPTION_NEXT_PAGE:"Next",HINT_FIRST_PAGE:"First page",HINT_LAST_PAGE:"Last page",HINT_PREV_PAGE:"Previous page",HINT_NEXT_PAGE:"Next page",HINT_CURR_PAGE:"Current page",MSG_RETRIEVING_DATA:"Loading data...",CAPTION_DATATABLE_EDIT:"Edit",CAPTION_DATATABLE_DELETE:"Delete",CAPTION_DATATABLE_INSERT:"Insert",HINT_DATATABLE_EDIT:"Edit",HINT_DATATABLE_DELETE:"Delete",HINT_DATATABLE_INSERT:"Insert",CAPTION_ADD_CELL:"+",HINT_ADD_CELL:"Add new cell",CAPTION_REMOVE_CELL:"Remove",HINT_REMOVE_CELL:"Remove cell",CAPTION_CONFIG:"Settings...",HINT_CONFIG:"Change settings",TITLE_IMG_FORMAT_PNG:"PNG format image",TITLE_IMG_FORMAT_JPG:"Jpeg format image",TITLE_IMG_FORMAT_GIF:"GIF format image",TITLE_IMG_FORMAT_SVG:"SVG format image"}),d.Localization.addResource("en","ChemWidgetTexts",{CAPTION_CLEAROBJS:"Clear",CAPTION_LOADFILE:"Load...",CAPTION_LOADDATA:"Load...",CAPTION_SAVEFILE:"Save...",CAPTION_ZOOMIN:"Zoom In",CAPTION_ZOOMOUT:"Zoom Out",CAPTION_RESETZOOM:"Reset Zoom",CAPTION_RESETVIEW:"Reset",CAPTION_ROTATE:"Rotate",CAPTION_ROTATELEFT:"Left Rotate",CAPTION_ROTATERIGHT:"Right Rotate",CAPTION_ROTATEX:"X Rotate",CAPTION_ROTATEY:"Y Rotate",CAPTION_ROTATEZ:"Z Rotate",CAPTION_MOL_DISPLAY_TYPE:"Molecule Display Style",CAPTION_SKELETAL:"Skeletal",CAPTION_CONDENSED:"Condensed",CAPTION_WIRE:"Wire Frame",CAPTION_STICKS:"Sticks",CAPTION_BALLSTICK:"Ball Stick",CAPTION_SPACEFILL:"Space Fill",CAPTION_HIDEHYDROGENS:"Show/hide hydrogens",CAPTION_OPENEDITOR:"Edit...",CAPTION_EDITOR_DONE:"Done",CAPTION_EDITOR_CANCEL:"Cancel",CAPTION_EDIT_OBJ:"Edit",HINT_CLEAROBJS:"Clear objects",HINT_LOADFILE:"Load from file",HINT_LOADDATA:"Load data",HINT_SAVEFILE:"Save to file",HINT_ZOOMIN:"Zoom in",HINT_ZOOMOUT:"Zoom out",HINT_RESETZOOM:"Reset zoom",HINT_RESETVIEW:"Reset zoom and rotation",HINT_ROTATE:"Rotate",HINT_ROTATELEFT:"Rotate in anticlockwise direction",HINT_ROTATERIGHT:"Rotate in clockwise direction",HINT_ROTATEX:"Rotate around X axis",HINT_ROTATEY:"Rotate around Y axis",HINT_ROTATEZ:"Rotate around Z axis",HINT_MOL_DISPLAY_TYPE:"Change molecule display style",HINT_SKELETAL:"Show molecule in skeletal style",HINT_CONDENSED:"Show molecule in condensed style",HINT_WIRE:"Show molecule in wire frame style",HINT_STICKS:"Show molecule in sticks style",HINT_BALLSTICK:"Show molecule in ball-stick style",HINT_SPACEFILL:"Show molecule in space-fill style",HINT_HIDEHYDROGENS:"Show/hide hydrogen atoms in model",HINT_OPENEDITOR:"Open an editor to modify displayed object",HINT_EDITOR_DONE:"Save the modification",HINT_EDITOR_CANCEL:"Discard the modification",CAPTION_NEWDOC:"New",CAPTION_UNDO:"Undo",CAPTION_REDO:"Redo",CAPTION_COPY:"Copy",CAPTION_COPY_WHOLE:"Copy",CAPTION_CUT:"Cut",CAPTION_PASTE:"Paste",CAPTION_TOGGLE_SELECT:"Toggle select",CAPTION_SELECT_ALL:"Select all",CAPTION_CLONE_SELECTION:"Clone selection",CAPTION_TOGGLE_OBJ_INSPECTOR:"Object inspector",CAPTION_TOGGLE_ISSUE_INSPECTOR:"Issue inspector",CAPTION_TOGGLE_SHOW_ISSUE_MARKERS:"Toggle issue markers",CAPTION_ERASE_SELECTION:"Erase selection",CAPTION_RECHECK_ISSUES:"Recheck issues",CAPTION_MANIPULATE:"Select",CAPTION_MANIPULATE_MARQUEE:"Marquee select",CAPTION_MANIPULATE_LASSO:"Lasso select",CAPTION_MANIPULATE_BRUSH:"Brush select",CAPTION_MANIPULATE_ANCESTOR:"Select molecule",CAPTION_CLIENT_DRAGSCROLL:"Scroll",CAPTION_ERASE:"Erase",CAPTION_TRACK_INPUT:"Track",CAPTION_MOL_BOND:"Bond",CAPTION_MOL_BOND_SINGLE:"Single bond",CAPTION_MOL_BOND_DOUBLE:"Double bond",CAPTION_MOL_BOND_TRIPLE:"Triple bond",CAPTION_MOL_BOND_QUAD:"Quad bond",CAPTION_MOL_BOND_EXPLICIT_AROMATIC:"Aromatic bond",CAPTION_MOL_BOND_WEDGEUP:"Wedge up bond",CAPTION_MOL_BOND_WEDGEUP_INVERTED:"Wedge up bond 2",CAPTION_MOL_BOND_WEDGEDOWN:"Wedge down bond",CAPTION_MOL_BOND_WEDGEDOWN_INVERTED:"Wedge down bond 2",CAPTION_MOL_BOND_CLOSER:"Outer bond",CAPTION_MOL_BOND_WAVY:"Wavy bond",CAPTION_MOL_BOND_DOUBLE_EITHER:"Double Either bond",CAPTION_MOL_BOND_IONIC:"Ionic bond",CAPTION_MOL_BOND_COORDINATE:"Coordinate bond",CAPTION_MOL_BOND_METALLIC:"Metallic bond",CAPTION_MOL_BOND_HYDROGEN:"Hydrogen bond",CAPTION_MOL_BOND_KEKULIZE:"Kekulize",CAPTION_MOL_BOND_HUCKLIZE:"Hucklize",CAPTION_MOL_ATOM:"Atom",CAPTION_MOL_FORMULA:"Formula",CAPTION_MOL_ATOM_AND_FORMULA:"Atom & formula",CAPTION_MOL_CHARGE:"Charge",CAPTION_MOL_CHARGE_CLEAR:"Charge clear",CAPTION_MOL_CHARGE_POSITIVE:"Positive charge",CAPTION_MOL_CHARGE_NEGATIVE:"Negative charge",CAPTION_MOL_CHARGE_SINGLET:"Singlet radical",CAPTION_MOL_CHARGE_DOUBLET:"Monoradical",CAPTION_MOL_CHARGE_TRIPLET:"Triplet radical",CAPTION_MOL_ELECTRON_LONEPAIR:"Lone pair",CAPTION_TEXT_BLOCK:"Text block",CAPTION_IMAGE_BLOCK:"Image block",CAPTION_TEXT_IMAGE:"Text & image",CAPTION_MOL_FLEXCHAIN:"Flex chain",CAPTION_MOL_FLEXRING:"Flex ring",CAPTION_REPOSITORY_RING:"Rings",CAPTION_REPOSITORY_RING_3:"Cyclopropane",CAPTION_REPOSITORY_RING_4:"Cyclobutane",CAPTION_REPOSITORY_RING_5:"Cyclopentane",CAPTION_REPOSITORY_RING_6:"Cyclohexane",CAPTION_REPOSITORY_RING_7:"Cycloheptane",CAPTION_REPOSITORY_RING_8:"Cyclooctane",CAPTION_REPOSITORY_RING_AR_6:"Benzene",CAPTION_REPOSITORY_RING_AR_5:"Cyclopentadiene",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1:"Cyclohexane chair 1",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2:"Cyclohexane chair 2",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1:"Cyclohexane Haworth 1",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2:"Cyclohexane Haworth 2",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1:"Cyclopentane Haworth 1",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2:"Cyclopentane Haworth 2",CAPTION_REPOSITORY_METHANE:"Methane",CAPTION_REPOSITORY_FISCHER1:"Fischer projection 1",CAPTION_REPOSITORY_FISCHER2:"Fischer projection 2",CAPTION_REPOSITORY_FISCHER3:"Fischer projection 3",CAPTION_REPOSITORY_SAWHORSE_STAGGERED:"Sawhorse staggered",CAPTION_REPOSITORY_SAWHORSE_ECLIPSED:"Sawhorse eclipsed",CAPTION_REPOSITORY_SUBBOND_MARK:"Substituent bond",CAPTION_REPOSITORY_ARROWLINE:"Arrows & symbols",CAPTION_REPOSITORY_GLYPH:"Glyphs",CAPTION_REPOSITORY_GLYPH_LINE:"Line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"Open arrow line",CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"Triangle arrow line",CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"Bidirectional open arrow line",CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"Bidirectional triangle arrow line",CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE:"Reversible arrow line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"Open arrow double line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_ARC:"Open arrow arc",CAPTION_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC:"Single side open arrow arc",CAPTION_ELECTRON_PUSHING_ARROW:"Electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_DOUBLE:"Double electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_SINGLE:"Single electron pushing arrow",CAPTION_REPOSITORY_HEAT_SYMBOL:"Heat symbol",CAPTION_REPOSITORY_ADD_SYMBOL:"Add symbol",CAPTION_TEXT_FORMAT:"Text format",CAPTION_PICK_COLOR:"Color",CAPTION_FONTNAME:"Font name",CAPTION_FONTSIZE:"Font size",CAPTION_TEXT_DIRECTION:"Text direction",CAPTION_TEXT_DIRECTION_DEFAULT:"Default",CAPTION_TEXT_DIRECTION_LTR:"Left to right",CAPTION_TEXT_DIRECTION_RTL:"Right to left",CAPTION_TEXT_DIRECTION_TTB:"Top to bottom",CAPTION_TEXT_DIRECTION_BTT:"Bottom to top",CAPTION_TEXT_HORIZONTAL_ALIGN:"Text horizontal alignment",CAPTION_TEXT_VERTICAL_ALIGN:"Text vertical alignment",CAPTION_TEXT_ALIGN_DEFAULT:"Default",CAPTION_TEXT_ALIGN_LEADING:"Leading",CAPTION_TEXT_ALIGN_TRAILING:"Trailing",CAPTION_TEXT_ALIGN_CENTER:"Center",CAPTION_TEXT_ALIGN_LEFT:"Left",CAPTION_TEXT_ALIGN_RIGHT:"Right",CAPTION_TEXT_ALIGN_TOP:"Top",CAPTION_TEXT_ALIGN_BOTTOM:"Bottom",CAPTION_NODE_LABEL_DISPLAY_MODE:"Atom label display mode",CAPTION_NODE_LABEL_DISPLAY_MODE_DEFAULT:"Default",CAPTION_NODE_LABEL_DISPLAY_MODE_SHOWN:"Show label",CAPTION_NODE_LABEL_DISPLAY_MODE_HIDDEN:"Hide label",CAPTION_NODE_LABEL_DISPLAY_MODE_SMART:"Smart",CAPTION_ATOM_MODIFIER:"Atom",CAPTION_ATOM_MODIFIER_MIXED:"[A]",CAPTION_BOND_MODIFIER:"Bond",CAPTION_CHARGE_MODIFIER:"Charge",CAPTION_GLYPH_PATH_MODIFIER:"Path",CAPTION_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER:"Reaction arrow & segment",CAPTION_ARC_PATH_MODIFIER:"Arc",CAPTION_MULTI_ARC_PATH_MODIFIER:"Multi-Arc",CAPTION_ELECTRON_PUSHING_ARROW_MODIFIER:"Electron pushing arrow",CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER:"Bond forming arrow",TEXT_CHARGE_POSITIVE:"+",TEXT_CHARGE_NEGATIVE:"-",TEXT_CHARGE_UNKNOWN:"<sup>+</sup>/<sub>-</sub>",TEXT_CHARGE_NONE:"&#8709;",HINT_NEWDOC:"Create new document",HINT_UNDO:"Undo",HINT_REDO:"Redo",HINT_COPY_WHOLE:"Copy objects to internal clipboard",HINT_COPY:"Copy selection to internal clipboard",HINT_CUT:"Cut selection to internal clipboard",HINT_PASTE:"Paste from internal clipboard",HINT_CLONE_SELECTION:"Clone selection",HINT_SELECT_ALL:"Select all",HINT_TOGGLE_SELECT:"Toggle select",HINT_TOGGLE_OBJ_INSPECTOR:"Show or hide object inspector panel",HINT_TOGGLE_ISSUE_INSPECTOR:"Show or hide error inspector panel",HINT_TOGGLE_SHOW_ISSUE_MARKERS:"Show or hide issue markers",HINT_ERASE_SELECTION:"Delete all selected objects",HINT_RECHECK_ISSUES:"Recheck objects in editor for issues",HINT_MANIPULATE:"Select tool",HINT_MANIPULATE_MARQUEE:"Marquee select",HINT_MANIPULATE_LASSO:"Lasso select",HINT_MANIPULATE_BRUSH:"Brush select",HINT_MANIPULATE_ANCESTOR:"Select molecule",HINT_CLIENT_DRAGSCROLL:"Scroll",HINT_ERASE:"Erase tool",HINT_TRACK_INPUT:"Track tool",HINT_MOL_BOND:"Bond tool",HINT_MOL_BOND_SINGLE:"Single bond",HINT_MOL_BOND_DOUBLE:"Double bond",HINT_MOL_BOND_TRIPLE:"Triple bond",HINT_MOL_BOND_QUAD:"Quad bond",HINT_MOL_BOND_EXPLICIT_AROMATIC:"Explicit aromatic bond",HINT_MOL_BOND_WEDGEUP:"Wedge up bond",HINT_MOL_BOND_WEDGEUP_INVERTED:"Wedge up bond 2",HINT_MOL_BOND_WEDGEDOWN:"Wedge down bond",HINT_MOL_BOND_WEDGEDOWN_INVERTED:"Wedge down bond 2",HINT_MOL_BOND_CLOSER:"Outer bond",HINT_MOL_BOND_WAVY:"Wavy bond",HINT_MOL_BOND_DOUBLE_EITHER:"Double either bond",HINT_MOL_BOND_IONIC:"Ionic bond",HINT_MOL_BOND_COORDINATE:"Coordinate bond",HINT_MOL_BOND_METALLIC:"Metallic bond",HINT_MOL_BOND_HYDROGEN:"Hydrogen bond",HINT_MOL_BOND_KEKULIZE:"Kekulize, convert explicit aromatic bonds to compartmental single and double ones",HINT_MOL_BOND_HUCKLIZE:"Hucklize, mark bonds on aromatic rings as explicit aromatic ones",HINT_MOL_ATOM:"Atom tool",HINT_MOL_FORMULA:"Formula tool",HINT_MOL_ATOM_AND_FORMULA:"Atom and formula tool",HINT_MOL_CHARGE:"Charge tool",HINT_MOL_CHARGE_CLEAR:"Clear charge and radical",HINT_MOL_CHARGE_POSITIVE:"Positive charge",HINT_MOL_CHARGE_NEGATIVE:"Negative charge",HINT_MOL_CHARGE_SINGLET:"Singlet radical",HINT_MOL_CHARGE_DOUBLET:"Monoradical",HINT_MOL_CHARGE_TRIPLET:"Triplet radical",HINT_MOL_ELECTRON_LONEPAIR:"Lone pair electrons",HINT_TEXT_BLOCK:"Text block tool",HINT_IMAGE_BLOCK:"Image block tool",HINT_TEXT_IMAGE:"Text and image tool",HINT_MOL_FLEXCHAIN:"Flex carbon chain",HINT_MOL_FLEXRING:"Flex carbon ring",HINT_REPOSITORY_RING:"Ring structures tool",HINT_REPOSITORY_RING_3:"Cyclopropane",HINT_REPOSITORY_RING_4:"Cyclobutane",HINT_REPOSITORY_RING_5:"Cyclopentane",HINT_REPOSITORY_RING_6:"Cyclohexane",HINT_REPOSITORY_RING_7:"Cycloheptane",HINT_REPOSITORY_RING_8:"Cyclooctane",HINT_REPOSITORY_RING_AR_6:"Benzene",HINT_REPOSITORY_RING_AR_5:"Cyclopentadiene",HINT_REPOSITORY_CYCLOHEXANE_CHAIR1:"Cyclohexane chair 1",HINT_REPOSITORY_CYCLOHEXANE_CHAIR2:"Cyclohexane chair 2",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1:"Cyclohexane Haworth 1",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2:"Cyclohexane Haworth 2",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1:"Cyclopentane Haworth 1",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2:"Cyclopentane Haworth 2",HINT_REPOSITORY_SUBBOND_MARK:"Substituent bond",HINT_REPOSITORY_METHANE:"Methane",HINT_REPOSITORY_FISCHER1:"Fischer projection with one chiral center",HINT_REPOSITORY_FISCHER2:"Fischer projection with two chiral centers",HINT_REPOSITORY_FISCHER3:"Fischer projection with three chiral centers",HINT_REPOSITORY_SAWHORSE_STAGGERED:"Sawhorse staggered",HINT_REPOSITORY_SAWHORSE_ECLIPSED:"Sawhorse eclipsed",HINT_REPOSITORY_ARROWLINE:"Arrows and symbols tool",HINT_REPOSITORY_GLYPH:"Glyphs",HINT_REPOSITORY_GLYPH_LINE:"Line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"Open arrow line",HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"Triangle arrow line",HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"Bidirectional open arrow line",HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"Bidirectional triangle arrow line",HINT_REPOSITORY_GLYPH_REV_ARROW_LINE:"Reversible arrow line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"Open arrow double line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_ARC:"Open arrow arc",HINT_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC:"Single side open arrow arc",HINT_REPOSITORY_HEAT_SYMBOL:"Heat symbol",HINT_REPOSITORY_ADD_SYMBOL:"Add symbol",HINT_ELECTRON_PUSHING_ARROW:"Electron pushing arrow",HINT_NODE_LABEL_DISPLAY_MODE:"Atom label display mode",HINT_TEXT_FORMAT:"Set text format",HINT_FONTNAME:"Set font name",HINT_FONTSIZE:"Set font size",HINT_PICK_COLOR:"Select color",HINT_TEXT_DIRECTION:"Set text direction",HINT_TEXT_HORIZONTAL_ALIGN:"Set text horizontal alignment",HINT_TEXT_VERTICAL_ALIGN:"Set text vertical alignment",HINT_CHARGE_NONE:"No charge",HINT_ATOM_MODIFIER:"Set atom",HINT_BOND_MODIFIER:"Set bond",HINT_CHARGE_MODIFIER:"Set charge",HINT_GLYPH_PATH_MODIFIER:"Set path properties",HINT_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER:"Set reaction arrow and segment properties",HINT_ARC_PATH_MODIFIER:"Set arc properties",HINT_MULTI_ARC_PATH_MODIFIER:"Set multi-arc properties",HINT_ELECTRON_PUSHING_ARROW_MODIFIER:"Set electron pushing arrow properties",HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER:"Set bond forming arrow properties",HINT_USE_ATOM_CUSTOM_COLOR:"(use atom custom color)",CAPTION_LOADDATA_DIALOG:"Load data",CAPTION_LOADDATA_DIALOG_APPENDMODE:"Append to current",CAPTION_SAVEDATA_DIALOG:"Save data",CAPTION_DATA_FORMAT:"Data format:",CAPTION_DATA_SRC:"Input or paste data below:",CAPTION_LOADDATA_FROM_FILE:"Load from file",CAPTION_CHOOSEFILEFORMAT:"Choose file format",CAPTION_SELECT_FORMAT:"Select format:",CAPTION_PREVIEW_FILE_CONTENT:"Preview: ",S_DEF_SAVE_FILENAME:"Unnamed",CAPTION_ATOMLIST_PERIODIC_TABLE:"more...",CAPTION_RGROUP:"Sub group",CAPTION_VARIABLE_ATOM:"Variable Atom (list)",CAPTION_VARIABLE_NOT_ATOM:"Variable Atom (not list)",CAPTION_PSEUDOATOM:"Pseudoatom",CAPTION_DUMMY_ATOM:"Dummy Atom",CAPTION_HETERO_ATOM:"Hetero Atom",CAPTION_ANY_ATOM:"Any Atom",CAPTION_ATOM:"Atom",CAPTION_SUBGROUP:"Subgroup",CAPTION_PERIODIC_TABLE_DIALOG:"Periodic table",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM:"Select element",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEMS:"Select elements",CAPTION_TEXTBLOCK_INIT:"Enter text here",CAPTION_WIDTH:"Width",CAPTION_LENGTH:"Length",CAPTION_PATH_INDEX:"Path {0}",HINT_PATH_INDEX:"Path {0}",CAPTION_REACTION_ARROW_UNSET:"(Unset)",CAPTION_REACTION_ARROW_CUSTOM:"Custom",CAPTION_REACTION_ARROW_NORMAL:"Normal",CAPTION_REACTION_ARROW_RESONANCE:"Resonance",CAPTION_REACTION_ARROW_REVERSIBLE:"Reversible",CAPTION_REACTION_ARROW_RETROSYNTHESIS:"Retrosynthesis",HINT_REACTION_ARROW_UNSET:"Unset",HINT_REACTION_ARROW_CUSTOM:"Custom",HINT_REACTION_ARROW_NORMAL:"Normal arrow",HINT_REACTION_ARROW_RESONANCE:"Resonance arrow",HINT_REACTION_ARROW_REVERSIBLE:"Reversible arrow",HINT_REACTION_ARROW_RETROSYNTHESIS:"Retrosynthesis arrow",CAPTION_LINE_COUNT:"Line count",CAPTION_LINE_GAP:"Line gap",CAPTION_LINE:"Line",CAPTION_STARTING_ARROW:"Starting arrow",CAPTION_ENDING_ARROW:"Ending arrow",CAPTION_REACTION_ARROW_TYPE:"Reaction arrow type",CAPTION_ELECTRON_PUSHING_ARROW_TYPE:"Arrow type",CAPTION_OPPOSITE_ARROW_SIDES:"Opposite arrow sides",CAPTION_SAME_ARROW_SIDES:"Same arrow sides",CAPTION_ELECTRON_PUSHING_ARROW_1:"Single electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_1_ABBR:"Single",HINT_ELECTRON_PUSHING_ARROW_1:"Single electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_2:"Double electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_2_ABBR:"Double",HINT_ELECTRON_PUSHING_ARROW_2:"Double electron pushing arrow",CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_1:"Bond forming electron pushing arrow",HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_1:"Bond forming electron pushing arrow",LEGEND_CAPTION:"Legend",LEGEND_ELEM_SYMBOL:"Symbol",LEGEND_ELEM_NAME:"name",LEGEND_ATOMIC_NUM:"atomic number",LEGEND_ATOMIC_WEIGHT:"atomic weight",CAPTION_2D:"2D",CAPTION_3D:"3D",CAPTION_AUTOSIZE:"Autosize",CAPTION_AUTOFIT:"Autofit",CAPTION_SHOWSIZEINFO:"Show size info",CAPTION_LABEL_SIZE:"Size: ",CAPTION_BACKGROUND_COLOR:"Background color: ",CAPTION_WIDTH_HEIGHT:"width: {0}, height: {1}",PLACEHOLDER_WIDTH:"width",PLACEHOLDER_HEIGHT:"height",HINT_AUTOSIZE:"Whether graph size is determined by object automatically",HINT_AUTOFIT:"Whether object is zoomed to fullfill the whole graph",S_VALUE_DEFAULT:"(Default)"}),d.Localization.addResource("en","ErrorMsg",{WIDGET_CLASS_NOT_FOUND:"Widget class not found",WIDGET_CAN_NOT_BIND_TO_ELEM:"Widget {0} can not be binded to element <{1}>",LOAD_CHEMDATA_FAILED:"Failed to load data",FILE_API_NOT_SUPPORTED:"File operations are not supported by your current web browser. Please update it.",DRAW_BRIDGE_NOT_SUPPORTED:"It seems that your web browser is not modern enough to support the drawing function. Please update it.",COMMAND_NOT_REVERSIBLE:"Command can not be undone",PAGE_INDEX_OUTOF_RANGE:"Page index out of range",FETCH_DATA_TIMEOUT:"Time out to fetch data",RENDER_TYPE_CHANGE_NOT_ALLOWED:"It is not allowed to change render type",CAN_NOT_CREATE_EDITOR:"Creating editor failed",CAN_NOT_SET_COORD_OF_CLASS:"Can not set coordinate of instance of {0}.",CAN_NOT_SET_DIMENSION_OF_CLASS:"Can not set dimension of instance of {0}.",CAN_NOT_MERGE_CONNECTORS:"Specified connectors can not be merged.",NOT_A_VALID_ATOM:"Not a valid atom",INVALID_ATOM_SYMBOL:"Invalid atom symbol",INVALID_OR_EMPTY_IMAGE:"Image is empty or invalidate"}),d.LOCAL_RES=!0,d.Localization.setCurrModule("objDefines"),d.OBJDEF_TEXTS={},d.Localization.addResource("en","OBJDEF_TEXTS",{TITLE_PREFIX:"TITLE_",DESCRIPTION_PREFIX:"DES_",DES_ID:"Unique ID for object.",Render:{GeneralConfigs:{TITLE_drawOpacity:"Opacity",DES_drawOpacity:"Opacity (between 0-1) to draw objects"},Render2DConfigs:{TITLE_generalConfigs:"General render settings",DES_generalConfigs:"General render settings",TITLE_moleculeDisplayConfigs:"Molecule display settings",DES_moleculeDisplayConfigs:"Settings about molecule display styles",TITLE_displayLabelConfigs:"Display label settings",DES_displayLabelConfigs:"Settings of displayed label in molecule/chem object",TITLE_textFontConfigs:"Text and font settings",DES_textFontConfigs:"Settings about text and font of display",TITLE_lengthConfigs:"Lengths settings",DES_lengthConfigs:"Lengths to display molecule/chem object",TITLE_colorConfigs:"Color settings",DES_colorConfigs:"Color settings to display molecule/chem object"},MoleculeDisplayConfigs:{TITLE_defMoleculeDisplayType:"Default molecule display mode",DES_defMoleculeDisplayType:"Default display type of molecule: in skeletal or in condensed mode",TITLE_defNodeDisplayMode:"Default atom display mode",DES_defNodeDisplayMode:"Default mode to display atom in molecule",TITLE_defHydrogenDisplayLevel:"Default hydrogen display level",DES_defHydrogenDisplayLevel:"How to display explicit or implicit hydrogens of atom",TITLE_defChargeMarkType:"Default charge mark type",DES_defChargeMarkType:null,TITLE_partialChargeDecimalsLength:"Decimal length of partial charge",DES_partialChargeDecimalsLength:"If an atom has a partical charge (e.g., +1.5), how many digits after decimal point should be displayed",TITLE_distinguishSingletAndTripletRadical:"Distinguish singlet/triplet radical",DES_distinguishSingletAndTripletRadical:"Whether use different mark to distinguish singlet(..) and triplet(^^) radical",TITLE_bondLineCap:"Bond line cap style",TITLE_bondLineJoin:"Bond line join style",TITLE_glyphLineCap:"Glyph line cap style",TITLE_glyphLineJoin:"Glyph line join style"},DisplayLabelConfigs:{TITLE_enableIsotopeAlias:"Enable isotope alias",DES_enableIsotopeAlias:"Whether isotope alias (e.g. D for 2H) is used to display atom label.",TITLE_unsetElement:"Unset element",DES_unsetElement:"Label for unset or unknown element",TITLE_dummyAtom:"Dummy atom",DES_dummyAtom:"Label for dummy atom",TITLE_heteroAtom:"Hetero atom",DES_heteroAtom:"Label for general hetero atom",TITLE_anyAtom:"Any atom",DES_anyAtom:"Label for atom wildcard",TITLE_variableAtom:"Variable atom",DES_variableAtom:"Label for variable atom or atom list",TITLE_rgroup:"RGroup",DES_rgroup:"Label for RGroup",TITLE_isoListLeadingBracket:"Atom list leading bracket",TITLE_isoListTailingBracket:"Atom list tailing bracket",TITLE_isoListDelimiter:"Atom delimiter in list",TITLE_isoListDisallowPrefix:"Prefix of not-atom list"},TextFontConfigs:{TITLE_labelFontFamily:"Label font",DES_labelFontFamily:"Font to draw general label",TITLE_atomFontFamily:"Atom font",DES_atomFontFamily:"Font to draw atom label",TITLE_supFontSizeRatio:"Superscript font size ratio",DES_supFontSizeRatio:"Ratio of Superscript text size to normal text size",TITLE_subFontSizeRatio:"Subscript font size ratio",DES_subFontSizeRatio:"Ratio of Subscript text size to normal text size",TITLE_superscriptOverhang:"Superscript text overhang",DES_superscriptOverhang:null,TITLE_subscriptOversink:"Subscript text oversink",DES_subscriptOversink:null,TITLE_textCharDirection:"Text direction",DES_textCharDirection:"Default text direction",TITLE_textHorizontalAlign:"Horizontal text alignment",DES_textHorizontalAlign:"Default horizontal text alignment of label",TITLE_textVerticalAlign:"Vertical text alignment",DES_textVerticalAlign:"Default vertical text alignment of label"},LengthConfigs:{TITLE_labelFontSize:"Label text size",DES_labelFontSize:"Size of general label text",TITLE_atomFontSize:"Atom text size",DES_atomFontSize:"Size of atom label text",TITLE_chemMarkerFontSize:"Chem marker text size",DES_chemMarkerFontSize:"Size of text in chem marker",TITLE_chemMarkerMargin:"Chem marker margin",DES_chemMarkerMargin:"Margin of chem marker to main object",TITLE_allenCenterAtomRadius:"Allen center radius",DES_allenCenterAtomRadius:"Radius to draw dot on center carbon atom in allen",TITLE_chargeMarkFontSize:"Charge mark size",DES_chargeMarkFontSize:"Font size of charge mark",TITLE_chargeMarkMargin:"Charge mark margin",DES_chargeMarkMargin:"Margin between charge mark and atom",TITLE_defBondLength:"Default bond length",DES_defBondLength:"Default length of a chemical bond",TITLE_bondLineWidth:"Bond line width",DES_bondLineWidth:"Line width to draw a chemical bond",TITLE_hashSpacing:"Hash spacing",DES_hashSpacing:"Spacing between small lines in hash bond",TITLE_multipleBondSpacingRatio:"Multiple bond spacing ratio",DES_multipleBondSpacingRatio:"Ratio of spacing between two lines in double or triple bond to bond length.",TITLE_multipleBondMaxAbsSpacing:"Max multiple bond spacing",DES_multipleBondMaxAbsSpacing:"Maximum spacing between multiple bond",TITLE_bondArrowLength:"Bond arrow length",DES_bondArrowLength:"The length of end triangle in arrow bond",TITLE_bondArrowWidth:"Bond arrow width",DES_bondArrowWidth:"The width of end triangle in arrow bond",TITLE_bondWedgeWidth:"Bond wedge max width",DES_bondWedgeWidth:"The width of ending point in wedge bond",TITLE_bondWedgeHashMinWidth:"Bond wedge min width",DES_bondWedgeHashMinWidth:"The width of starting point in wedge bond",TITLE_bondWavyRadius:"Bond wavy radius",DES_bondWavyRadius:"Radius to draw arc of wavy bond",TITLE_glyphStrokeWidth:"Glyph stroke width",DES_glyphStrokeWidth:"The default width of glyph strokes",TITLE_autofitContextPadding:"Autofit context padding",DES_autofitContextPadding:"Padding of autofit widget edge and drawn object",TITLE_glyphStickOffsetRelLength:"Glyph stick offset relative length",DES_glyphStickOffsetRelLength:"Glyph stick offset relative length",TITLE_defScaleRefLength:"Default scale reference length",DES_defScaleRefLength:"Length for calculating the auto-scale"},ColorConfigs:{TITLE_useAtomSpecifiedColor:"Use element specified color",DES_useAtomSpecifiedColor:"Whether use different color on different element",TITLE_labelColor:"Label color",DES_labelColor:"Default color of general label",TITLE_atomColor:"Atom color",DES_atomColor:"Default color of atom label",TITLE_bondColor:"Bond color",DES_bondColor:"Default color of bond",TITLE_glyphStrokeColor:"Glyph stroke color",DES_glyphStrokeColor:"Default stroke color of glyph",TITLE_glyphFillColor:"Glyph fill color",DES_glyphFillColor:"Default fill color of glyph"},Render3DConfigs:{TITLE_generalConfigs:"General render settings",DES_generalConfigs:"General render settings",TITLE_moleculeDisplayConfigs:"Molecule display settings",DES_moleculeDisplayConfigs:"Settings about molecule display styles",TITLE_environmentConfigs:"3D environment settings",DES_environmentConfigs:"Settings of 3D environment",TITLE_modelConfigs:"3D model settings",DES_modelConfigs:"Settings to render a 3D molecule model",TITLE_lengthConfigs:"Lengths settings",DES_lengthConfigs:"Lengths to display molecule"},Render3DEnvironmentConfigs:{TITLE_graphicQuality:"Graphic quality",DES_graphicQuality:"Quality of 3D graphic"},Molecule3DDisplayConfigs:{TITLE_defMoleculeDisplayType:"Default molecule display type",DES_defMoleculeDisplayType:"Draw molecule in wire, stick, ball stick or space fill mode",TITLE_defBondSpliceMode:"Bond splice mode",DES_defBondSpliceMode:"How to draw a splice mode between two atoms with different color",TITLE_defDisplayMultipleBond:"Display multiple bond",DES_defDisplayMultipleBond:"Whether draw multiple bond lines for double or triple bond",TITLE_defBondColor:"Default bond color",DES_defBondColor:"Default bond color",TITLE_defAtomColor:"Default atom color",DES_defAtomColor:"Default atom color",TITLE_useAtomSpecifiedColor:"Use element specified color",DES_useAtomSpecifiedColor:"Whether use different color on different element"},Model3DConfigs:{TITLE_hideHydrogens:"Hide hydrogens",DES_hideHydrogens:"Whether hide all hydrogen atoms in 3D model",TITLE_useVdWRadius:"Use von dar Waals radius",DES_useVdWRadius:"Whether use atom's von dar Waals radius to draw 3D model",TITLE_multiConnectorRadiusRatio:"Multi-bond radius ratio",DES_multiConnectorRadiusRatio:"If use multi-cylinder for multibond, this value is the radius ratio between multi and single bond",TITLE_multiConnectorMarginRatio:"Multi-bond margin ratio",DES_multiConnectorMarginRatio:"If multi-cylinder is used for multibond, ratio of margin between cylinders and radius of cylinder"},Length3DConfigs:{TITLE_fixedNodeRadius:"Fixed atom radius",DES_fixedNodeRadius:"If vdW radius of atom is not used, this value will be used for all atom's radius",TITLE_connectorRadius:"Bond radius",DES_connectorRadius:"Bond will be draw based on this radius in stick or ball_stick mode",TITLE_connectorLineWidth:"Bond line width",DES_connectorLineWidth:"Bond will be draw on this width in wire mode"}},Widget:{BaseWidget:{TITLE_settingFacade:"General settings",DES_settingFacade:"General settings"}},ChemWidget:{ChemObjDisplayer:{TITLE_enableLoadNewFile:"Enable load data",DES_enableLoadNewFile:"Whether loading new data is enabled"},ChemObjDisplayerConfigs:{TITLE_ioConfigs:"I/O settings",DES_ioConfigs:"Settings of input/output",TITLE_environment2DConfigs:"2D environment settings",DES_environment2DConfigs:"Settings of 2D drawing environment",TITLE_environment3DConfigs:"3D environment settings",DES_environment3DConfigs:"Settings of 3D drawing environment"},ChemObjDisplayerIOConfigs:{TITLE_canonicalizeBeforeSave:"Canonicalize before save",DES_canonicalizeBeforeSave:"Whether canonicalize molecule before saving it",TITLE_autoGenerateCoordsAfterLoad:"Auto generate coordinates after loading molecule",DES_autoGenerateCoordsAfterLoad:"Whether coordinates of atoms are automatically generated when loading a molecule without explicit coordinate information"},ChemObjDisplayerEnvironmentConfigs:{TITLE_antialias:"Antialias",DES_antialias:"Whether enable extra antialias strategy additional to the default one of browser",TITLE_antialiasBlurRatio:"Antialias blur ratio",DES_antialiasBlurRatio:"Antialias blur ratio",TITLE_overSamplingRatio:"Over sampling ratio",DES_overSamplingRatio:"Over sampling ratio of the drawing context"},Viewer:{TITLE_enableDirectInteraction:"Enable direct interaction",DES_enableDirectInteraction:"Whether interaction with chem object in viewer is enabled",TITLE_enableTouchInteraction:"Enable touch interaction",DES_enableTouchInteraction:"Whether touch interaction is enabled",TITLE_enableToolbar:"Enable toolbar",DES_enableToolbar:"Whether toolbar of viewer is displayed",TITLE_toolbarPos:"Toolbar Position",DES_toolbarPos:"Position of toolbar in viewer",TITLE_toolbarMarginHorizontal:"Toolbar horizontal margin",DES_toolbarMarginHorizontal:"Horizontal margin of toolbar to viewer edge",TITLE_toolbarMarginVertical:"Toolbar vertical margin",DES_toolbarMarginVertical:"Vertical margin of toolbar to viewer edge",TITLE_enableEdit:"Enable editing",DES_enableEdit:"Whether edit chem object in viewer is enabled",TITLE_modalEdit:"Modal editing",DES_modalEdit:"Using modal dialog or popup dialog to edit chem object"},ViewerConfigs:{TITLE_hotKeyConfigs:"Hot key settings",DES_hotKeyConfigs:"Setting of the hot key and action map"},ViewerHotKeyConfigs:{TITLE_hotKeys:"Hot keys",DES_hotKeys:"Hot key and action settings"}},Editor:{BaseEditorConfigs:{TITLE_uiMarkerConfigs:"UI marker settings",DES_uiMarkerConfigs:"Settings of interaction marker",TITLE_interactionConfigs:"Interaction settings",DES_interactionConfigs:"Settings about interaction of editor",TITLE_structureConfigs:"Structure settings",DES_structureConfigs:"Settings about creating molecule structure",TITLE_hotKeyConfigs:"Hot key settings",DES_hotKeyConfigs:"Setting of the hot key and action map"},ChemSpaceEditorConfigs:{TITLE_chemSpaceConfigs:"Chem space settings",DES_chemSpaceConfigs:"Settings about chem space/chem document",TITLE_styleSetterConfigs:"Style setter settings",DES_styleSetterConfigs:"Settings of style toolbar of editor"},InteractionConfigs:{TITLE_enableTrackOnNearest:"Enale track on nearest",DES_enableTrackOnNearest:"If setting to true, hot track or selection will focus on nearest object to current position, otherwise, the topmost object around will be focused.",TITLE_enableHotTrack:"Enable hot track",DES_enableHotTrack:"Whether highlighting objects under mouse position",TITLE_scrollToObjAfterLoading:"Scroll to object after loading",DES_scrollToObjAfterLoading:"Whether scroll to the newly loaded object after opening data",TITLE_autoExpandClientSizeAfterLoading:"Auto expand client size after loading",DES_autoExpandClientSizeAfterLoading:"Whether expand the client size automatically after loading a large object out of boundary",TITLE_autoExpandClientSizeAfterManipulation:"Auto expand client size after manipulation",DES_autoExpandClientSizeAfterManipulation:"Whether expand the client size automatically when moving a object out of the boundary of editor",TITLE_autoSelectNewlyInsertedObjects:"Auto select new inserted objects",DES_autoSelectNewlyInsertedObjects:"Whether select objects newly inserted or modified in editor automatically",TITLE_autoSelectNewlyInsertedObjectsOnTouch:"Auto select new inserted objects in touch device",DES_autoSelectNewlyInsertedObjectsOnTouch:"Whether select objects newly inserted or modified in editor automatically in touch device",TITLE_objBoundTrackMinInflation:"Object bound minimal inflation (default)",DES_objBoundTrackMinInflation:"The default minimal inflation of the bound of object to make it easier to select",TITLE_objBoundTrackMinInflationMouse:"Object bound minimal inflation (mouse)",DES_objBoundTrackMinInflationMouse:"The minimal inflation of the bound of object to make it easier to select when using mouse as pointer device",TITLE_objBoundTrackMinInflationTouch:"Object bound minimal inflation (touch)",DES_objBoundTrackMinInflationTouch:"The minimal inflation of the bound of object to make it easier to select when touching on screen",TITLE_objBoundTrackMinInflationPen:"Object bound minimal inflation (pen)",DES_objBoundTrackMinInflationPen:"The minimal inflation of the bound of object to make it easier to select when using pen as pointer device",TITLE_objBoundTrackInflationRatio:"Object bound inflation ratio (default)",DES_objBoundTrackInflationRatio:"The default inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select",TITLE_objBoundTrackInflationRatioMouse:"Object bound inflation ratio (mouse)",DES_objBoundTrackInflationRatioMouse:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when using mouse as pointer device",TITLE_objBoundTrackInflationRatioPen:"Object bound inflation ratio (pen)",DES_objBoundTrackInflationRatioPen:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when using pen as pointer device",TITLE_objBoundTrackInflationRatioTouch:"Object bound inflation ratio (touch)",DES_objBoundTrackInflationRatioTouch:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when touching on screen",TITLE_selectionMarkerInflation:"Selection marker inflation",DES_selectionMarkerInflation:"Inflation of object selection mark, makes it easier to see the containing objects",TITLE_selectionMarkerEdgeInflation:"Selection edge inflation",DES_selectionMarkerEdgeInflation:"Inflation when judging if a coord is on selection mark edge",TITLE_followPointerCoordOnDirectManipulatingSingleObj:"Follow pointer coordinate on direct manipulating object",DES_followPointerCoordOnDirectManipulatingSingleObj:"If true, the new coordinate of manipulating object will be set directly by the position of pointer (rather than the delta coordinate to the original position)",TITLE_followPointerCoordOnDirectManipulatingSingleObjDistanceThreshold:"Threshold of following pointer coordinate on direct manipulating object",DES_followPointerCoordOnDirectManipulatingSingleObjDistanceThreshold:"Threshold when following pointer coordinate on direct manipulating object",TITLE_constrainedResizeStep:"Constrained resize step",DES_constrainedResizeStep:"Constrained resize step",TITLE_constrainedRotateStep:"Constrained rotation step",DES_constrainedRotateStep:"Constrained rotation step, in arc",TITLE_rotationLocationPointDistanceThreshold:"Rotation starting min distance",DES_rotationLocationPointDistanceThreshold:"Rotation will occur only when mouse point distance (from rotation center) larger than this value",TITLE_directedMoveDistanceThreshold:"Direct move min distance",DES_directedMoveDistanceThreshold:"Direct moving will only be done if moved distance large than this value",TITLE_enablePartialAreaSelecting:"Enable partial selecting",DES_enablePartialAreaSelecting:"If this value is true, when drag a selecting rubber band, object partly in the band will be totally selected",TITLE_selectingBrushWidth:"Brush selecting Width",DES_selectingBrushWidth:"Width of brush in brush selecting",TITLE_enableOffSelectionManipulation:"Enable off-selection manipulation",DES_enableOffSelectionManipulation:"When setting to true, you can still move, resize or rotate selected objects by holding mouse or touch outside selection for a while",TITLE_offSelectionManipulationActivatingTimeThreshold:"Off-selection manipulation hold time",DES_offSelectionManipulationActivatingTimeThreshold:"The minimal time (in ms) need for holding mouse or touch to invoke off-selection manipulation",TITLE_selectionMarkerDefPulseDuration:"Default selection mark pulse duration",DES_selectionMarkerDefPulseDuration:"The duration (in ms) of selection mark pulse when the selection is been emphasised",TITLE_selectionMarkerDefPulseCount:"Default selection mark pulse count",DES_selectionMarkerDefPulseCount:"The pulse count when the selection is been emphasised",TITLE_rotationRegionInflation:"Rotation region inflation",DES_rotationRegionInflation:"User can rotate the selected objects by pressing and move mouse in this inflated region outside selection",TITLE_enableMergePreview:"Enable merge preview",DES_enableMergePreview:"Whether a preview operation is used rather then the actual merge operation when merge two objects in editor during manipulation. Turn on this option may improve the performance of object manipulation.",TITLE_enableGestureManipulation:"Enable gesture manipulation",DES_enableGestureManipulation:"Whether user can use touch gestures (e.g. pinch) to scale or rotate selected objects in editor",TITLE_enableGestureZoomOnEditor:"Enable gesture zoom on editor",DES_enableGestureZoomOnEditor:"Whether user can use pinch gesture to zoom in or out the editor when there is no selection existed",TITLE_trackSimplifierDistanceThreshold:"Track-input curve simplification threshold",DES_trackSimplifierDistanceThreshold:"Distance threshold in simplifying curve drawn by track-input tool",TITLE_trackSimplifierIgnoreSegmentThreshold:"Track-input ignored segment threshold",DES_trackSimplifierIgnoreSegmentThreshold:"Segment length less than this threshold drawn by track-input will be ignored in parsing",TITLE_trackMergeDistanceThreshold:"Track-input merge distance threshold",DES_trackMergeDistanceThreshold:"If a joint or end point of line segment drawn by track-inpu tool is close to another line segment (less than this threshold), it will be regarded on that line.",TITLE_trackOptimizationAngleConstraint:"Track-input optimization line cross angle constraint",DES_trackOptimizationAngleConstraint:null,TITLE_trackOptimizationDistanceConstraints:"Track-input optimization line length constraint",DES_trackOptimizationDistanceConstraints:null,TITLE_trackOptimizationPrimaryDistanceConstraint:"Track-input optimization primary line length",DES_trackOptimizationPrimaryDistanceConstraint:null,TITLE_autoAdjustZoomLevelOnTrackTouching:null,DES_autoAdjustZoomLevelOnTrackTouching:null,TITLE_editorInitialZoom:"Editor initial zoom level",DES_editorInitialZoom:"The initial zoom level of editor",TITLE_atomSetterFontSize:"Atom setter font size",DES_atomSetterFontSize:"Font size of atom setter",TITLE_allowUnknownAtomSymbol:"Allow unknown atom symbol",DES_allowUnknownAtomSymbol:"Allow inputting unknown symbol and handle it as pseudo atom in atom setter",TITLE_clonedObjectScreenOffset:"Copied object coord offset",DES_clonedObjectScreenOffset:"The distance between copied objects and origin objects when doing paste selection action in editor",TITLE_enableBondKekulizeHucklize:"Enable Kekulize and Hucklize function of bond",DES_enableBondKekulizeHucklize:"Whether Kekulize and Hucklize buttons are shown in bond modifier of editor",TITLE_enableHotKey:"Enable hot keys",DES_enableHotKey:"Whether shortcut with key pressing is enabled in editor"},UiMarkerConfigs:{TITLE_hotTrackerColor:"Hot track mark color",DES_hotTrackerColor:"Color of hot track mark",TITLE_hotTrackerOpacity:"Hot track mark opacity",DES_hotTrackerOpacity:"Opacity of hot track marker, value from 0 to 1",TITLE_selectionMarkerStrokeColor:"Selection mark stroke color",DES_selectionMarkerStrokeColor:"Stroke color of selection mark",TITLE_selectionMarkerStrokeWidth:"Selection mark stroke width",DES_selectionMarkerStrokeWidth:"Width of selection mark stroke",TITLE_selectionMarkerFillColor:"Selection mark fill color",DES_selectionMarkerFillColor:"Fill color of selection mark.",TITLE_selectionMarkerOpacity:"Selection mark opacity",DES_selectionMarkerOpacity:"Opacity of selection mark, value from 0 to 1",TITLE_selectionMarkerEmphasisOpacity:"Emphasised selection mark opacity",DES_selectionMarkerEmphasisOpacity:"Opacity of emphasised selection marker, value from 0 to 1",TITLE_selectingMarkerStrokeColor:"Selecting mark stroke color",DES_selectingMarkerStrokeColor:"Stroke color of selecting rubber band mark",TITLE_selectingMarkerStrokeWidth:"Selecting mark stroke width",DES_selectingMarkerStrokeWidth:"Stroke width of selection rubber band",TITLE_selectingMarkerStrokeDash:"Selecting mark dash style",DES_selectingMarkerStrokeDash:"Dash style of selecting rubber band",TITLE_selectingMarkerFillColor:"Selecting mark fill color",DES_selectingMarkerFillColor:"Fill color of selecting mark. Usually this value should be left blank (not filled)",TITLE_selectingMarkerOpacity:"Selecting mark opacity",DES_selectingMarkerOpacity:"Opacity of selecting mark, value from 0 to 1",TITLE_selectingBrushMarkerStrokeColor:"Brush selecting mark stroke color",DES_selectingBrushMarkerStrokeColor:"Stroke color of brush selecting mark",TITLE_selectingBrushMarkerStrokeDash:"Brush selecting mark dash style",DES_selectingBrushMarkerStrokeDash:"Dash style of brush selecting track",TITLE_selectingBrushMarkerStrokeLineCap:"Brushing selecting mark line-cap style",DES_selectingBrushMarkerStrokeLineCap:"Line-cap style of both ends of brush selecting track",TITLE_selectingBrushMarkerStrokeLineJoin:"Brushing selecting mark join point style",DES_selectingBrushMarkerStrokeLineJoin:"Join style of brush selection track segments",TITLE_selectingBrushMarkerOpacity:"Brush selecting mark opacity",DES_selectingBrushMarkerOpacity:"Opacity of brush selecting mark, value from 0 to 1",TITLE_trackMarkerStrokeColor:"Track-input mark stroke color",DES_trackMarkerStrokeColor:"Stroke color of track mark when using track-input tool to draw a structure",TITLE_trackMarkerStrokeWidth:"Track-input mark stroke width",DES_trackMarkerStrokeWidth:"Stroke width of track mark when using track-input tool to draw a structure",TITLE_trackMarkerStrokeDash:"Track-input mark dash style",DES_trackMarkerStrokeDash:"Dash style of track mark when using track-input tool to draw a structure",TITLE_trackMarkerOpacity:"Track-input mark opacity",DES_trackMarkerOpacity:"Opacity of track mark when using track-input tool to draw a structure",TITLE_flexStructureAssocMarkerColor:"Flex structure association mark color",DES_flexStructureAssocMarkerColor:"Color of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerOpacity:"Flex structure association mark opacity",DES_flexStructureAssocMarkerOpacity:"Opacity of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerFontSize:"Flex structure association mark font size",DES_flexStructureAssocMarkerFontSize:"Font size of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerFontFamily:"Flex structure association mark font family",DES_flexStructureAssocMarkerFontFamily:"Font family of mark showing atom count of flex ring/chain tool",TITLE_issueCheckMarkerColors:"Issue check markers color",DES_issueCheckMarkerColors:"Color of issue check markers, different colors are used for different issue levels",TITLE_issueCheckMarkerStrokeWidth:"Issue check marker stroke width",DES_issueCheckMarkerStrokeWidth:"Stroke width of issue check marker outline",TITLE_issueCheckActiveMarkerStrokeWidth:"Active issue check marker stroke width",DES_issueCheckActiveMarkerStrokeWidth:"Stroke width of active issue check marker outline",TITLE_issueCheckMarkerOpacity:"Issue check marker opacity",DES_issueCheckMarkerOpacity:"Opacity of issue check marker",TITLE_issueCheckActiveMarkerOpacity:"Active Issue check marker opacity",DES_issueCheckActiveMarkerOpacity:"Opacity of active issue check marker"},StructureConfigs:{TITLE_defBondType:"Default bond type",DES_defBondType:"Default type of bond",TITLE_defBondOrder:"Default bond order",DES_defBondOrder:"Default bond order",TITLE_defBondLength:"Default bond length",DES_defBondLength:"Default bond length",TITLE_defIsotopeId:"Default isotope",DES_defIsotopeId:"Default isotope when adding a new atom",TITLE_maxFlexChainAtomCount:"Maximum flex chain atom count",DES_maxFlexChainAtomCount:"Maximum atom count when inputting with flex chain tool",TITLE_minFlexChainAtomCount:"Minimal flex chain atom count",DES_minFlexChainAtomCount:"Minimal atom count when inputting with flex chain tool",TITLE_maxFlexRingAtomCount:"Maximum flex ring atom count",DES_maxFlexRingAtomCount:"Maximum atom count when inputting with flex ring tool",TITLE_minFlexRingAtomCount:"Minimal flex ring atom count",DES_minFlexRingAtomCount:"Minimal atom count when inputting with flex ring tool",TITLE_enabledNonAtomNodeTypes:"Available non-atom structure node types",DES_enabledNonAtomNodeTypes:"Non-atom structure node types available in editor",TITLE_enabledBondForms:"Available bond forms",DES_enabledBondForms:"Bond forms available in editor"},ChemSpaceConfigs:{TITLE_defScreenSize2D:"Default 2D screen size",TITLE_defScreenSize3D:"Default 3D screen size",TITLE_autoExpandScreenSize2D:"Auto expanding size 2D",DES_autoExpandScreenSize2D:"The size used when automatically expanding editor client in 2D mode",TITLE_autoExpandScreenSize3D:"Auto expanding size 3D",DES_autoExpandScreenSize3D:"The size used when automatically expanding editor client in 3D mode",TITLE_defPadding:"Default padding",DES_defPadding:"Padding on top when adding an unpositioned object to container chem space"},HotKeyConfigs:{TITLE_hotKeys:"Hot keys",DES_hotKeys:"Hot key and action settings"},BaseEditor:{TITLE_enableCreateNewDoc:"Enable create new document",DES_enableCreateNewDoc:"Whether creating a new document is allowed",TITLE_initOnNewDoc:"Starts with a new document",DES_initOnNewDoc:"Whether create a new document automatically when composer is initialized",TITLE_enableOperHistory:"Enable undo",DES_enableOperHistory:"Whether undo/redo is enabled",TITLE_enableIssueCheck:"Enable issue check",DES_enableIssueCheck:"Whether enable issue checker to detect errors and warning among objects in editor"},ChemSpaceEditor:{TITLE_allowAppendDataToCurr:"Allow appending data",DES_allowAppendDataToCurr:"Whether allow appending data to current document"},Composer:{TITLE_enableStyleToolbar:"Enable style toolbar",DES_enableStyleToolbar:"Whether display style toolbar to set color, font and size of objects",TITLE_enableObjModifierToolbar:"Enable object modifier toolbar",DES_enableObjModifierToolbar:"Whether display toolbar with a series of object modification tools",TITLE_allowCreateNewChild:"Enable create new child object",DES_allowCreateNewChild:"Whether new direct child of document can be created",TITLE_allowAppendDataToCurr:"Allow appending data",DES_allowAppendDataToCurr:"Whether allow appending data to current document"}}}),d.Localization.setCurrModule("general"),d.Localization.addResource("zh","Texts",{UNNAMED:"\u672a\u547d\u540d"}),d.Localization.addResource("zh","ErrorMsg",{MODULE_NOT_LOADED:"\u6a21\u5757{0}\u672a\u8f7d\u5165",NON_OWN_PROPERTY_CANNOT_BE_REPLACED:"\u53ea\u80fd\u66ff\u6362\u5bf9\u8c61\u7684\u76f4\u63a5\u5c5e\u6027",EMPTY_DOC:"\u6587\u6863\u65e0\u5185\u5bb9",ELEMENT_NOTSET:"\u672a\u8bbe\u7f6e\u5143\u7d20",EMPTY_RESURI:"\u8d44\u6e90URI\u65e0\u5185\u5bb9",CANNOT_LOAD_RES_OF_URI:"\u65e0\u6cd5\u8f7d\u5165\u8d44\u6e90URI\uff1a",LIST_ITEM_CLASS_MISMATCH:"\u6761\u76ee\u7c7b\u578b\u9519\u8bef\uff0c\u65e0\u6cd5\u52a0\u5165\u5217\u8868",CANNOT_CLEAR_WEAKMAP:"Can not clear a weak map",CANNOT_GET_KEY_LIST_IN_WEAKMAP:"Can not get key array from a weak map",CANNOT_GET_VALUE_LIST_IN_WEAKMAP:"Can not get value array from a weak map",INVALID_CHEMELEMENT:"\u65e0\u6548\u7684\u5316\u5b66\u5143\u7d20",INVALID_ISOTOPE:"\u65e0\u6548\u7684\u540c\u4f4d\u7d20",COORD_STICK_NOT_ALLOWED_ON_CLASS:"Coordinate sticking is not allowed in this type of object",INVALID_STICK_TARGET_OBJ:"Invalid sticking target",UNABLE_TO_STICK_TO_OTHER_OWNER_OBJ:"Unable to stick to object with a different owner",UNABLE_TO_STICK_TO_OBJ_WITHOUT_ABS_COORD:"Unable to stick to object without absolute coordinates",STICK_RECURSION_NOT_ALLOWED:"Stick recursion is not allowed",UNABLE_ADD_MISTYPED_NODE:"\u65e0\u6cd5\u5411\u952e/\u8fde\u63a5\u7b26\u4e0a\u8fde\u63a5\u9519\u8bef\u7684\u539f\u5b50/\u9876\u70b9",UNABLE_ADD_DIFF_OWNER_OBJ:"\u5bf9\u8c61\u6709\u7740\u4e0d\u540c\u7684\u5bbf\u4e3b\uff0c\u65e0\u6cd5\u8fde\u63a5\u5728\u540c\u4e00\u952e/\u8fde\u63a5\u7b26\u4e0a",CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH:"\u6761\u76ee\u7c7b\u578b\u4e0d\u7b26",SORT_FUNC_UNSET:"\u6392\u5e8f\u51fd\u6570\u672a\u8bbe\u7f6e",SOURCE_FRAGMENT_NOT_SET:"\u672a\u6307\u5b9a\u6e90\u5206\u5b50",UNABLE_ADD_NONMOLECULE_MAP:"\u4ec5\u80fd\u5411\u53cd\u5e94\u7269\u6216\u751f\u6210\u7269\u4e2d\u6dfb\u52a0\u5206\u5b50",CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER:"\u4ec5\u80fd\u5411\u7ed3\u6784\u4e2d\u6dfb\u52a0\u539f\u5b50\u3001\u952e\u6216\u9876\u70b9\u3001\u8fde\u63a5\u7b26",REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND:"\u65e0\u6cd5\u627e\u5230\u6ce8\u518c\u7684\u5f52\u4e00\u5316\u6267\u884c\u5668",ERROR_LOADING_FILE:"\u6587\u4ef6\u8f7d\u5165\u9519\u8bef\uff1a",READER_ID_ALREADY_EXISTS:"Can not register reader: id already exists",WRITER_ID_ALREADY_EXISTS:"Can not register writer: id already exists",FAIL_TO_READ_FORMAT:"\u8bfb\u5165\u6570\u636e\u5931\u8d25\uff0c\u683c\u5f0f\uff1a",NO_SUITABLE_READER_FOR_FORMAT:"\u65e0\u6cd5\u8bfb\u5165\u6570\u636e\uff0c\u683c\u5f0f\uff1a",NO_SUITABLE_READER_FOR_MIMETYPE:"\u65e0\u6cd5\u8bfb\u5165\u6570\u636e\uff0cMIME\u7c7b\u578b\uff1a",NO_SUITABLE_READER_FOR_FILEEXT:"\u65e0\u6cd5\u8bfb\u5165\u6570\u636e\uff0c\u6587\u4ef6\u540e\u7f00\uff1a",NO_SUITABLE_WRITER_FOR_FORMAT:"\u65e0\u6cd5\u5199\u5165\u6570\u636e\uff0c\u683c\u5f0f\uff1a",NO_SUITABLE_WRITER_FOR_MIMETYPE:"\u65e0\u6cd5\u5199\u5165\u6570\u636e\uff0cMIME\u7c7b\u578b\uff1a",NO_SUITABLE_WRITER_FOR_FILEEXT:"\u65e0\u6cd5\u5199\u5165\u6570\u636e\uff0c\u6587\u4ef6\u540e\u7f00\uff1a",AJAX_FILELOADER_NOT_FOUND:"AJAX file loader not found, can not load URL",FAIL_TO_LOAD_FILE_URL:"\u8f7d\u5165\u6587\u4ef6\u6216\u94fe\u63a5\u5931\u8d25\uff1a",CML_ELEM_READER_NOT_FOUND:"CML\u5143\u7d20<{0}>\u8bfb\u5165\u5668\u4e0d\u5b58\u5728",ATOMID_NOT_EXISTS:"\u539f\u5b50\u6807\u8bc6(ID)\u4e0d\u5b58\u5728\uff1a",BONDID_NOT_EXISTS:"\u952e\u6807\u8bc6(ID)\u4e0d\u5b58\u5728\uff1a",CML_ELEM_WRITER_TYPE_INPROPER:"{0}\u4e0d\u662f\u5408\u9002\u7684CML\u5143\u7d20{1}\u7684\u5199\u5165\u5668",CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT:"\u65e0\u6cd5\u5411\u7a7a\u7684CML\u5143\u7d20\u4e2d\u8f93\u51fa\u5185\u5bb9",UNABLE_TO_OUTPUT_AS_CML:"\u65e0\u6cd5\u5c06\u5bf9\u8c61<{0}>\u8f93\u51fa\u81f3CML",MDL_CTAB_ATOM_CANNOT_CREATE:"\u65e0\u6cd5\u4ece\u6e90MDL\u683c\u5f0f\u6570\u636e\u4e2d\u521b\u5efa\u539f\u5b50",MDL_CTAB_BOND_CANNOT_CREATE:"\u65e0\u6cd5\u4ece\u6e90MDL\u683c\u5f0f\u6570\u636e\u4e2d\u521b\u5efa\u5316\u5b66\u952e",CAN_NOT_WRITE_NON_MOLECULE_TO_MOL:"\u5bf9\u8c61\u5e76\u975e\u5206\u5b50\uff0c\u65e0\u6cd5\u8f93\u51fa\u81f3\u5206\u5b50\u8fde\u63a5\u8868",MOLECULE_HAS_NO_CTAB_TO_OUTPUT:"\u5206\u5b50\u65e0\u8fde\u63a5\u8868\uff0c\u65e0\u6cd5\u8f93\u51fa\u81f3MDL\u683c\u5f0f\u6570\u636e",NOT_MDL2000_FORMAT_DATA:"\u6570\u636e\u683c\u5f0f\u9519\u8bef\uff1a\u5e76\u975eMDL 2000",NOT_MDL_RXN_DATA:"\u5e76\u975eMDL\u53cd\u5e94(RXN)\u6570\u636e",MALFORMED_MDL3000_COUNTLINE:"MDL 3000\u8ba1\u6570\u884c\u683c\u5f0f\u9519\u8bef",MDL3000_ATOMBLOCK_NOT_FOUND:"\u65e0\u6cd5\u627e\u5230\u539f\u5b50\u5757\uff0c\u9519\u8bef\u7684MDL 3000\u6570\u636e\uff1f",NOT_MDL_FORMAT_DATA:"\u6570\u636e\u683c\u5f0f\u9519\u8bef\uff1a\u5e76\u975eMDL 2000\u62163000",NOT_MDL2000_RXN_DATA:"\u5e76\u975eMDL RXN 2000\u6570\u636e",NOT_MDL3000_RXN_DATA:"\u5e76\u975eMDL RXN 3000\u6570\u636e",NOT_MDL3000_RXN_COUNTLINE:"\u8bfb\u5165RXN 3000\u8ba1\u6570\u884c\u9519\u8bef",MDL_OUTPUT_DATATYPE_NOT_TEXT:"MDL\u6570\u636e\u65e0\u6cd5\u8f93\u51fa\u4e3a\u975e\u6587\u672c\u683c\u5f0f",MDL_INPUT_DATATYPE_NOT_TEXT:"\u975e\u6587\u672c\u683c\u5f0f\u6570\u636e\uff0c\u975e\u6cd5\u7684MDL\u6e90\u6570\u636e",UNABLE_TO_OUTPUT_AS_MDL:"\u65e0\u6cd5\u5c06\u5bf9\u8c61<{0}>\u8f93\u51fa\u81f3MDL\u683c\u5f0f\u6570\u636e",KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT:"\u975e\u6587\u672c\u6216JSON\u683c\u5f0f\u6570\u636e\uff0c\u975e\u6cd5\u7684KCJ\u6e90\u6570\u636e",KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT:"\u65e0\u6cd5\u8f93\u51fa\u4e3a\u975e\u6587\u672c\u6216JSON\u683c\u5f0f",KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT:"\u975e\u6587\u672c\u6216DOM\u683c\u5f0f\u6570\u636e\uff0c\u975e\u6cd5\u7684KCX\u6e90\u6570\u636e",KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT:"\u65e0\u6cd5\u8f93\u51fa\u4e3a\u975e\u6587\u672c\u6216DOM\u683c\u5f0f",JSON_SERIALIZER_NOT_EXISTS:"JSON\u5e8f\u5217\u5316\u5668\u4e0d\u5b58\u5728",XML_SERIALIZER_NOT_EXISTS:"XML\u5e8f\u5217\u5316\u5668\u4e0d\u5b58\u5728",INAVAILABLE_AUTOSCALE_REF_LENGTH:"\u65e0\u6cd5\u8ba1\u7b97\u81ea\u52a8\u7f29\u653e\u6240\u9700\u7684\u957f\u5ea6",FORMULA_RENDERER_3D_NOT_AVAILABLE:"\u5206\u5b50\u5f0f3D\u6e32\u67d3\u5668\u6682\u4e0d\u53ef\u7528",CANNOT_FIND_SUITABLE_RENDERER_FOR_OBJ:"\u65e0\u6cd5\u627e\u5230\u5408\u9002\u7684\u6e32\u67d3\u5668",THREEJS_LIB_NOT_UNAVAILABLE:"Three.js\u4e0d\u53ef\u7528\uff0c\u8bf7\u4f7f\u7528<script>\u6807\u7b7e\u5c06\u5176\u5f15\u5165\u6216\u4f7f\u7528Kekule.externalResourceManager.register\u65b9\u6cd5\u6307\u5b9aThree\u5b9e\u4f8b",THREEJS_DRAWING_NOT_UNAVAILABLE:"\u6d4f\u89c8\u5668\u4e0d\u652f\u6301Webgl\u3001Canvas\u6216SVG\uff0c\u8bf7\u5c06\u5176\u5347\u7ea7\u6216\u66f4\u6362",CANVAS2D_NOT_UNAVAILABLE:"\u6d4f\u89c8\u5668\u4e0d\u652f\u6301Canvas\uff0c\u8bf7\u5c06\u5176\u5347\u7ea7\u6216\u66f4\u6362",RAPHAEL_LIB_NOT_UNAVAILABLE:"Raphael.js\u4e0d\u53ef\u7528\uff0c\u8bf7\u4f7f\u7528<script>\u6807\u7b7e\u5c06\u5176\u5f15\u5165",RAPHAEL_SVG_VML_UNAVAILABLE:"\u6d4f\u89c8\u5668\u4e0d\u652f\u6301SVG\u6216VML\uff0c\u8bf7\u5c06\u5176\u5347\u7ea7\u6216\u66f4\u6362\u3002",CALC_TERMINATED_BY_USER:"\u8ba1\u7b97\u8fc7\u7a0b\u88ab\u7528\u6237\u4e2d\u65ad",CALC_SERVICE_UNAVAILABLE:"\u8ba1\u7b97\u670d\u52a1\u201c{0}\u201d\u4e0d\u53ef\u7528"}),d.Localization.addResource("zh","ErrorCheckMsg",{GENERAL_ERROR_WITH_CODE:"\u9519\u8bef\u4ee3\u7801: {0}",ATOM_VALENCE_ERROR_WITH_SUGGEST:"{0}\u539f\u5b50\u4ef7\u6570\uff08{1}\uff09\u5f02\u4e8e\u5e38\u89c1\u503c\uff08{2}\uff09",ATOM_VALENCE_ERROR_WITH_SUGGESTS:"{0}\u539f\u5b50\u4ef7\u6570\uff08{1}\uff09\u5f02\u4e8e\u5e38\u89c1\u503c\uff08{2}\uff09",BOND_ORDER_EXCEED_ALLOWED_WITH_SUGGEST:"\u5171\u4ef7\u952e\u952e\u7ea7\uff08{0}\uff09\u8d85\u51fa\u5141\u8bb8\u503c\uff08{1}\uff09\u8303\u56f4",BOND_WITH_ID_ORDER_EXCEED_ALLOWED_WITH_SUGGEST:"{0}\u952e\u952e\u7ea7\uff08{1}\uff09\u8d85\u51fa\u5141\u8bb8\u503c\uff08{2}\uff09\u8303\u56f4",NODE_DISTANCE_TOO_CLOSE:"\u539f\u5b50\u6216\u57fa\u56e2\u4f4d\u7f6e\u8fc7\u4e8e\u63a5\u8fd1",NODE_DISTANCE_TOO_CLOSE_WITH_LABEL:"\u539f\u5b50\u6216\u57fa\u56e2\uff08{0}\uff09\u4f4d\u7f6e\u8fc7\u4e8e\u63a5\u8fd1",TITLE_CHANGE_BOND_ORDER_TO:"\u5c06\u952e\u7ea7\u4fee\u6539\u4e3a{0}",DESCRIPTION_CHANGE_BOND_ORDER_TO:"\u5c06\u952e\u7ea7\u7531{0}\u4fee\u6539\u4e3a{1}",TITLE_MERGE_TO:"\u5c06{0}\u4e0e{1}\u5408\u5e76",DESCRIPTION_MERGE_TO:"\u5c06\u8282\u70b9{0}\u4e0e{1}\u5408\u5e76"}),d.Localization.setCurrModule("widget"),d.Localization.addResource("zh","WidgetTexts",{CAPTION_OK:"\u786e\u5b9a",CAPTION_CANCEL:"\u53d6\u6d88",CAPTION_YES:"\u662f",CAPTION_NO:"\u5426",CAPTION_BROWSE_COLOR:"\u6d4f\u89c8\u989c\u8272",HINT_BROWSE_COLOR:"\u6d4f\u89c8\u66f4\u591a\u989c\u8272",S_COLOR_UNSET:"(\u672a\u8bbe\u7f6e)",S_COLOR_DEFAULT:"(\u7f3a\u7701\u503c)",S_COLOR_MIXED:"(\u591a\u4e2a\u503c)",S_COLOR_TRANSPARENT:"(\u900f\u660e)",S_OBJECT_UNSET:"(\u65e0)",S_ITEMS:"\u6761\u76ee",S_OBJECT:"\u5bf9\u8c61",S_VALUE_UNSET:"(\u672a\u8bbe\u7f6e)",CAPTION_MENU:"\u83dc\u5355",HINT_MENU:"\u6253\u5f00\u83dc\u5355",S_INSPECT_NONE:"(\u65e0)",S_INSPECT_OBJECTS:"({0}\u4e2a\u5bf9\u8c61)",S_INSPECT_ID_OBJECT:"{0}: {1}",S_INSPECT_ANONYMOUS_OBJECT:"({0})",CAPTION_TOGGLE_TEXTWRAP:"\u5207\u6362\u6587\u672c\u6362\u884c",CAPTION_INC_TEXT_SIZE:"\u589e\u5927\u5b57\u53f7",CAPTION_DEC_TEXT_SIZE:"\u51cf\u5c0f\u5b57\u53f7",HINT_TOGGLE_TEXTWRAP:"\u5207\u6362\u6587\u672c\u662f\u5426\u81ea\u52a8\u6362\u884c",HINT_INC_TEXT_SIZE:"\u589e\u5927\u5b57\u53f7",HINT_DEC_TEXT_SIZE:"\u51cf\u5c0f\u5b57\u53f7",HINT_CHOOSE_FONT_FAMILY:"\u9009\u62e9\u5b57\u4f53",CAPTION_FIRST_PAGE:"\u9996\u9875",CAPTION_LAST_PAGE:"\u672b\u9875",CAPTION_PREV_PAGE:"\u524d\u4e00\u9875",CAPTION_NEXT_PAGE:"\u540e\u4e00\u9875",HINT_FIRST_PAGE:"\u9996\u9875",HINT_LAST_PAGE:"\u672b\u9875",HINT_PREV_PAGE:"\u524d\u4e00\u9875",HINT_NEXT_PAGE:"\u540e\u4e00\u9875",HINT_CURR_PAGE:"\u5f53\u524d\u9875",MSG_RETRIEVING_DATA:"\u8f7d\u5165\u6570\u636e\u2026",CAPTION_DATATABLE_EDIT:"\u7f16\u8f91",CAPTION_DATATABLE_DELETE:"\u5220\u9664",CAPTION_DATATABLE_INSERT:"\u63d2\u5165",HINT_DATATABLE_EDIT:"\u7f16\u8f91\u6570\u636e",HINT_DATATABLE_DELETE:"\u5220\u9664\u6570\u636e",HINT_DATATABLE_INSERT:"\u63d2\u5165\u6570\u636e",CAPTION_ADD_CELL:"+",HINT_ADD_CELL:"\u6dfb\u52a0\u65b0\u5355\u5143\u683c",CAPTION_REMOVE_CELL:"\u79fb\u9664",HINT_REMOVE_CELL:"\u79fb\u9664\u5355\u5143\u683c",CAPTION_CONFIG:"\u8bbe\u7f6e\u2026",HINT_CONFIG:"\u4fee\u6539\u8bbe\u7f6e",TITLE_IMG_FORMAT_PNG:"PNG\u683c\u5f0f\u56fe\u50cf",TITLE_IMG_FORMAT_JPG:"Jpeg\u683c\u5f0f\u56fe\u50cf",TITLE_IMG_FORMAT_GIF:"GIF\u683c\u5f0f\u56fe\u50cf",TITLE_IMG_FORMAT_SVG:"SVG\u683c\u5f0f\u56fe\u50cf"}),d.Localization.addResource("zh","ChemWidgetTexts",{CAPTION_CLEAROBJS:"\u6e05\u9664",CAPTION_LOADFILE:"\u8f7d\u5165\u2026",CAPTION_LOADDATA:"\u8f7d\u5165\u2026",CAPTION_SAVEFILE:"\u4fdd\u5b58\u2026",CAPTION_ZOOMIN:"\u653e\u5927",CAPTION_ZOOMOUT:"\u7f29\u5c0f",CAPTION_RESETZOOM:"\u91cd\u7f6e\u7f29\u653e",CAPTION_RESETVIEW:"\u91cd\u7f6e",CAPTION_ROTATE:"\u65cb\u8f6c",CAPTION_ROTATELEFT:"\u5411\u5de6\u65cb\u8f6c",CAPTION_ROTATERIGHT:"\u5411\u53f3\u65cb\u8f6c",CAPTION_ROTATEX:"\u6cbfX\u8f74\u65cb\u8f6c",CAPTION_ROTATEY:"\u6cbfY\u8f74\u65cb\u8f6c",CAPTION_ROTATEZ:"\u6cbfZ\u8f74\u65cb\u8f6c",CAPTION_MOL_DISPLAY_TYPE:"\u5206\u5b50\u663e\u793a\u6837\u5f0f",CAPTION_SKELETAL:"\u952e\u7ebf\u5f0f",CAPTION_CONDENSED:"\u7f29\u5199\u5f0f",CAPTION_WIRE:"\u5355\u7ebf\u6a21\u578b",CAPTION_STICKS:"\u68cd\u5f0f\u6a21\u578b",CAPTION_BALLSTICK:"\u7403\u68cd\u6a21\u578b",CAPTION_SPACEFILL:"\u6bd4\u4f8b\u6a21\u578b",CAPTION_HIDEHYDROGENS:"\u663e\u793a/\u9690\u85cf\u6c22\u539f\u5b50",CAPTION_OPENEDITOR:"\u7f16\u8f91\u2026",CAPTION_EDITOR_DONE:"\u5b8c\u6210",CAPTION_EDITOR_CANCEL:"\u53d6\u6d88",CAPTION_EDIT_OBJ:"\u7f16\u8f91",HINT_CLEAROBJS:"\u6e05\u9664\u5bf9\u8c61",HINT_LOADFILE:"\u81ea\u6587\u4ef6\u8f7d\u5165",HINT_LOADDATA:"\u8f7d\u5165\u6570\u636e",HINT_SAVEFILE:"\u5b58\u50a8\u5230\u6587\u4ef6",HINT_ZOOMIN:"\u653e\u5927",HINT_ZOOMOUT:"\u7f29\u5c0f",HINT_RESETZOOM:"\u91cd\u7f6e\u7f29\u653e",HINT_RESETVIEW:"\u91cd\u7f6e\u7f29\u653e\u4e0e\u65cb\u8f6c",HINT_ROTATE:"\u65cb\u8f6c",HINT_ROTATELEFT:"\u9006\u65f6\u9488\u65cb\u8f6c",HINT_ROTATERIGHT:"\u987a\u65f6\u9488\u65cb\u8f6c",HINT_ROTATEX:"\u6cbfX\u8f74\u65cb\u8f6c",HINT_ROTATEY:"\u6cbfY\u8f74\u65cb\u8f6c",HINT_ROTATEZ:"\u6cbfZ\u8f74\u65cb\u8f6c",HINT_MOL_DISPLAY_TYPE:"\u6539\u53d8\u5206\u5b50\u663e\u793a\u6837\u5f0f",HINT_SKELETAL:"\u4ee5\u952e\u7ebf\u5f0f\u663e\u793a",HINT_CONDENSED:"\u4ee5\u7f29\u5199\u5f0f\u663e\u793a",HINT_WIRE:"\u4ee5\u5355\u7ebf\u6a21\u578b\u663e\u793a",HINT_STICKS:"\u4ee5\u68cd\u5f0f\u6a21\u578b\u663e\u793a",HINT_BALLSTICK:"\u4ee5\u7403\u68cd\u6a21\u578b\u663e\u793a",HINT_SPACEFILL:"\u4ee5\u6bd4\u4f8b\u6a21\u578b\u663e\u793a",HINT_HIDEHYDROGENS:"\u6a21\u578b\u4e2d\u663e\u793a/\u9690\u85cf\u6c22\u539f\u5b50",HINT_OPENEDITOR:"\u7f16\u8f91\u5f53\u524d\u5bf9\u8c61",HINT_EDITOR_DONE:"\u5173\u95ed\u5e76\u4fdd\u5b58\u7f16\u8f91\u5668\u4e2d\u7684\u4fee\u6539",HINT_EDITOR_CANCEL:"\u5173\u95ed\u5e76\u53d6\u6d88\u7f16\u8f91\u5668\u4e2d\u7684\u4fee\u6539",CAPTION_NEWDOC:"\u65b0\u5efa",CAPTION_UNDO:"\u64a4\u9500",CAPTION_REDO:"\u91cd\u505a",CAPTION_COPY:"\u590d\u5236",CAPTION_COPY_WHOLE:"\u590d\u5236",CAPTION_CUT:"\u526a\u5207",CAPTION_PASTE:"\u7c98\u8d34",CAPTION_TOGGLE_SELECT:"\u53e0\u52a0\u9009\u62e9",CAPTION_SELECT_ALL:"\u5168\u9009",CAPTION_CLONE_SELECTION:"\u514b\u9686\u9009\u533a",CAPTION_TOGGLE_OBJ_INSPECTOR:"\u5bf9\u8c61\u68c0\u89c6\u5668",CAPTION_TOGGLE_ISSUE_INSPECTOR:"\u95ee\u9898\u68c0\u89c6\u5668",CAPTION_TOGGLE_SHOW_ISSUE_MARKERS:"\u663e\u793a\u95ee\u9898\u6807\u8bb0",CAPTION_RECHECK_ISSUES:"\u91cd\u65b0\u68c0\u67e5\u95ee\u9898",CAPTION_MANIPULATE:"\u9009\u53d6",CAPTION_MANIPULATE_MARQUEE:"\u77e9\u5f62\u9009\u6846",CAPTION_MANIPULATE_LASSO:"\u5957\u7d22\u9009\u62e9",CAPTION_MANIPULATE_BRUSH:"\u9009\u62e9\u5237",CAPTION_MANIPULATE_ANCESTOR:"\u9009\u62e9\u5206\u5b50",CAPTION_CLIENT_DRAGSCROLL:"\u79fb\u52a8\u753b\u5e03",CAPTION_ERASE:"\u5220\u9664",CAPTION_TRACK_INPUT:"\u624b\u5199\u8f93\u5165",CAPTION_MOL_BOND:"\u952e",CAPTION_MOL_BOND_SINGLE:"\u5355\u952e",CAPTION_MOL_BOND_DOUBLE:"\u53cc\u952e",CAPTION_MOL_BOND_TRIPLE:"\u4e09\u952e",CAPTION_MOL_BOND_QUAD:"\u56db\u952e",CAPTION_MOL_BOND_EXPLICIT_AROMATIC:"\u82b3\u9999\u952e",CAPTION_MOL_BOND_WEDGEUP:"\u5b9e\u6954\u7ebf\u952e",CAPTION_MOL_BOND_WEDGEUP_INVERTED:"\u5b9e\u6954\u7ebf\u952e2",CAPTION_MOL_BOND_WEDGEDOWN:"\u865a\u6954\u7ebf\u952e",CAPTION_MOL_BOND_WEDGEDOWN_INVERTED:"\u865a\u6954\u7ebf\u952e2",CAPTION_MOL_BOND_CLOSER:"\u7a81\u51fa(\u52a0\u7c97)\u952e",CAPTION_MOL_BOND_WAVY:"\u6ce2\u6d6a\u952e",CAPTION_MOL_BOND_DOUBLE_EITHER:"\u987a\u6216\u53cd\u5f0f\u53cc\u952e",CAPTION_MOL_BOND_IONIC:"\u79bb\u5b50\u952e",CAPTION_MOL_BOND_COORDINATE:"\u914d\u4f4d\u952e",CAPTION_MOL_BOND_METALLIC:"\u91d1\u5c5e\u952e",CAPTION_MOL_BOND_HYDROGEN:"\u6c22\u952e",CAPTION_MOL_BOND_KEKULIZE:"Kekulize",CAPTION_MOL_BOND_HUCKLIZE:"Hucklize",CAPTION_MOL_ATOM:"\u539f\u5b50",CAPTION_MOL_FORMULA:"\u5206\u5b50\u5f0f",CAPTION_MOL_ATOM_AND_FORMULA:"\u539f\u5b50\u4e0e\u5206\u5b50\u5f0f",CAPTION_MOL_CHARGE:"\u7535\u8377",CAPTION_MOL_CHARGE_CLEAR:"\u6e05\u9664\u7535\u8377",CAPTION_MOL_CHARGE_POSITIVE:"\u6b63\u7535\u8377",CAPTION_MOL_CHARGE_NEGATIVE:"\u8d1f\u7535\u8377",CAPTION_MOL_CHARGE_SINGLET:"\u5355\u7ebf\u6001",CAPTION_MOL_CHARGE_DOUBLET:"\u53cc\u7ebf\u6001\u81ea\u7531\u57fa",CAPTION_MOL_CHARGE_TRIPLET:"\u4e09\u7ebf\u6001",CAPTION_MOL_ELECTRON_LONEPAIR:"\u5b64\u5bf9\u7535\u5b50",CAPTION_TEXT_BLOCK:"\u6587\u5b57",CAPTION_IMAGE_BLOCK:"\u56fe\u50cf",CAPTION_TEXT_IMAGE:"\u6587\u5b57\u4e0e\u56fe\u50cf",CAPTION_MOL_FLEXCHAIN:"\u53ef\u53d8\u78b3\u94fe",CAPTION_MOL_FLEXRING:"\u53ef\u53d8\u78b3\u73af",CAPTION_REPOSITORY_RING:"\u73af",CAPTION_REPOSITORY_RING_3:"\u73af\u4e19\u70f7",CAPTION_REPOSITORY_RING_4:"\u73af\u4e01\u70f7",CAPTION_REPOSITORY_RING_5:"\u73af\u620a\u70f7",CAPTION_REPOSITORY_RING_6:"\u73af\u5df1\u70f7",CAPTION_REPOSITORY_RING_7:"\u73af\u5e9a\u70f7",CAPTION_REPOSITORY_RING_8:"\u73af\u8f9b\u70f7",CAPTION_REPOSITORY_RING_AR_6:"\u82ef",CAPTION_REPOSITORY_RING_AR_5:"\u73af\u620a\u4e8c\u70ef",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1:"\u73af\u5df1\u70f7\u6905\u5f0f1",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2:"\u73af\u5df1\u70f7\u6905\u5f0f2",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1:"\u73af\u5df1\u70f7Haworth\u5f0f1",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2:"\u73af\u5df1\u70f7Haworth\u5f0f2",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1:"\u73af\u620a\u70f7Haworth\u5f0f1",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2:"\u73af\u620a\u70f7Haworth\u5f0f2",CAPTION_REPOSITORY_METHANE:"\u7532\u70f7",CAPTION_REPOSITORY_FISCHER1:"\u5355\u624b\u6027\u4e2d\u5fc3Fischer\u6295\u5f71\u5f0f",CAPTION_REPOSITORY_FISCHER2:"\u53cc\u624b\u6027\u4e2d\u5fc3Fischer\u6295\u5f71\u5f0f",CAPTION_REPOSITORY_FISCHER3:"\u4e09\u624b\u6027\u4e2d\u5fc3Fischer\u6295\u5f71\u5f0f",CAPTION_REPOSITORY_SAWHORSE_STAGGERED:"\u4ea4\u53c9\u5f0f\u952f\u67b6\u5f0f",CAPTION_REPOSITORY_SAWHORSE_ECLIPSED:"\u91cd\u53e0\u5f0f\u952f\u67b6\u5f0f",CAPTION_REPOSITORY_SUBBOND_MARK:"\u53d6\u4ee3\u57fa\u952e",CAPTION_REPOSITORY_ARROWLINE:"\u7ebf\u6bb5\u4e0e\u7bad\u5934",CAPTION_REPOSITORY_GLYPH:"\u56fe\u7b26",CAPTION_REPOSITORY_GLYPH_LINE:"\u76f4\u7ebf",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"\u5f00\u653e\u7bad\u5934\u7ebf",CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"\u4e09\u89d2\u7bad\u5934\u7ebf",CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"\u53cc\u5411\u5f00\u653e\u7bad\u5934\u7ebf",CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"\u53cc\u5411\u4e09\u89d2\u7bad\u5934\u7ebf",CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE:"\u53ef\u9006\u7bad\u5934\u7ebf",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"\u5f00\u653e\u7bad\u5934\u53cc\u7ebf",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_ARC:"\u5f00\u653e\u7bad\u5934\u5f27\u7ebf",CAPTION_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC:"\u5355\u4fa7\u5f00\u653e\u7bad\u5934\u5f27\u7ebf",CAPTION_ELECTRON_PUSHING_ARROW:"\u7535\u5b50\u8f6c\u79fb\u7bad\u5934",CAPTION_ELECTRON_PUSHING_ARROW_DOUBLE:"\u53cc\u7535\u5b50\u8f6c\u79fb\u7bad\u5934",CAPTION_ELECTRON_PUSHING_ARROW_SINGLE:"\u5355\u7535\u5b50\u8f6c\u79fb\u7bad\u5934",CAPTION_REPOSITORY_HEAT_SYMBOL:"\u52a0\u70ed\u7b26\u53f7",CAPTION_REPOSITORY_ADD_SYMBOL:"\u52a0\u53f7",CAPTION_TEXT_FORMAT:"\u6587\u5b57\u683c\u5f0f",CAPTION_PICK_COLOR:"\u989c\u8272",CAPTION_FONTNAME:"\u5b57\u4f53",CAPTION_FONTSIZE:"\u5b57\u53f7",CAPTION_TEXT_DIRECTION:"\u6587\u5b57\u65b9\u5411",CAPTION_TEXT_DIRECTION_DEFAULT:"\u7f3a\u7701",CAPTION_TEXT_DIRECTION_LTR:"\u7531\u5de6\u81f3\u53f3",CAPTION_TEXT_DIRECTION_RTL:"\u7531\u53f3\u81f3\u5de6",CAPTION_TEXT_DIRECTION_TTB:"\u7531\u4e0a\u81f3\u4e0b",CAPTION_TEXT_DIRECTION_BTT:"\u7531\u4e0b\u81f3\u4e0a",CAPTION_TEXT_HORIZONTAL_ALIGN:"\u6587\u5b57\u6c34\u5e73\u5bf9\u9f50",CAPTION_TEXT_VERTICAL_ALIGN:"\u6587\u5b57\u5782\u76f4\u5bf9\u9f50",CAPTION_TEXT_ALIGN_DEFAULT:"\u7f3a\u7701",CAPTION_TEXT_ALIGN_LEADING:"\u9996\u5bf9\u9f50",CAPTION_TEXT_ALIGN_TRAILING:"\u5c3e\u5bf9\u9f50",CAPTION_TEXT_ALIGN_CENTER:"\u5c45\u4e2d\u5bf9\u9f50",CAPTION_TEXT_ALIGN_LEFT:"\u5de6\u5bf9\u9f50",CAPTION_TEXT_ALIGN_RIGHT:"\u53f3\u5bf9\u9f50",CAPTION_TEXT_ALIGN_TOP:"\u4e0a\u5bf9\u9f50",CAPTION_TEXT_ALIGN_BOTTOM:"\u4e0b\u5bf9\u9f50",CAPTION_NODE_LABEL_DISPLAY_MODE:"\u539f\u5b50\u6807\u7b7e\u663e\u793a\u6a21\u5f0f",CAPTION_NODE_LABEL_DISPLAY_MODE_DEFAULT:"\u9ed8\u8ba4",CAPTION_NODE_LABEL_DISPLAY_MODE_SHOWN:"\u663e\u793a\u6587\u672c",CAPTION_NODE_LABEL_DISPLAY_MODE_HIDDEN:"\u9690\u85cf\u6587\u672c",CAPTION_NODE_LABEL_DISPLAY_MODE_SMART:"\u667a\u80fd",CAPTION_ATOM_MODIFIER:"\u539f\u5b50",CAPTION_ATOM_MODIFIER_MIXED:"[A]",CAPTION_BOND_MODIFIER:"\u952e",CAPTION_CHARGE_MODIFIER:"\u7535\u8377",CAPTION_GLYPH_PATH_MODIFIER:"\u7ebf\u6bb5",CAPTION_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER:"\u53cd\u5e94\u7bad\u5934\u4e0e\u7ebf\u6bb5",CAPTION_ARC_PATH_MODIFIER:"\u5f27\u7ebf",CAPTION_MULTI_ARC_PATH_MODIFIER:"\u591a\u5f27\u7ebf",CAPTION_ELECTRON_PUSHING_ARROW_MODIFIER:"\u7535\u5b50\u8f6c\u79fb\u7bad\u5934",CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER:"\u7535\u5b50\u8f6c\u79fb\u6210\u952e\u7bad\u5934",TEXT_CHARGE_POSITIVE:"+",TEXT_CHARGE_NEGATIVE:"-",TEXT_CHARGE_UNKNOWN:"<sup>+</sup>/<sub>-</sub>",TEXT_CHARGE_NONE:"&#8709;",HINT_NEWDOC:"\u521b\u5efa\u65b0\u6587\u6863",HINT_UNDO:"\u64a4\u9500",HINT_REDO:"\u91cd\u505a",HINT_COPY_WHOLE:"\u5c06\u5bf9\u8c61\u590d\u5236\u81f3\u5185\u90e8\u526a\u8d34\u677f",HINT_COPY:"\u5c06\u9009\u5b9a\u5bf9\u8c61\u590d\u5236\u81f3\u5185\u90e8\u526a\u8d34\u677f",HINT_CUT:"\u5c06\u9009\u5b9a\u5bf9\u8c61\u526a\u5207\u81f3\u5185\u90e8\u526a\u8d34\u677f",HINT_PASTE:"\u81ea\u5185\u90e8\u526a\u8d34\u677f\u590d\u5236",HINT_CLONE_SELECTION:"\u514b\u9686\u5f53\u524d\u9009\u533a",HINT_SELECT_ALL:"\u9009\u62e9\u5168\u90e8\u5bf9\u8c61",HINT_TOGGLE_SELECT:"\u53e0\u52a0\u9009\u62e9",HINT_TOGGLE_OBJ_INSPECTOR:"\u663e\u793a\u6216\u9690\u85cf\u5bf9\u8c61\u68c0\u89c6\u5668",HINT_TOGGLE_ISSUE_INSPECTOR:"\u663e\u793a\u6216\u9690\u85cf\u95ee\u9898\u68c0\u89c6\u5668",HINT_TOGGLE_SHOW_ISSUE_MARKERS:"\u663e\u793a\u6216\u9690\u85cf\u95ee\u9898\u6807\u8bb0",HINT_RECHECK_ISSUES:"\u91cd\u65b0\u68c0\u67e5\u7f16\u8f91\u5185\u5bb9\u4e2d\u7684\u95ee\u9898",HINT_MANIPULATE:"\u9009\u62e9\u5de5\u5177",HINT_MANIPULATE_MARQUEE:"\u77e9\u5f62\u9009\u6846",HINT_MANIPULATE_LASSO:"\u5957\u7d22\u9009\u62e9",HINT_MANIPULATE_BRUSH:"\u9009\u62e9\u5237",HINT_MANIPULATE_ANCESTOR:"\u9009\u62e9\u5206\u5b50",HINT_CLIENT_DRAGSCROLL:"\u79fb\u52a8\u753b\u5e03",HINT_ERASE:"\u5220\u9664\u5de5\u5177",HINT_TRACK_INPUT:"\u624b\u5199\u8f93\u5165\u5de5\u5177",HINT_MOL_BOND:"\u5316\u5b66\u952e\u5de5\u5177",HINT_MOL_BOND_SINGLE:"\u5355\u952e",HINT_MOL_BOND_DOUBLE:"\u53cc\u952e",HINT_MOL_BOND_TRIPLE:"\u53c1\u952e",HINT_MOL_BOND_QUAD:"\u56db\u952e",HINT_MOL_BOND_EXPLICIT_AROMATIC:"\u663e\u5f0f\u82b3\u9999\u952e",HINT_MOL_BOND_WEDGEUP:"\u5b9e\u6954\u7ebf\u952e",HINT_MOL_BOND_WEDGEUP_INVERTED:"\u5b9e\u6954\u7ebf\u952e2",HINT_MOL_BOND_WEDGEDOWN:"\u865a\u6954\u7ebf\u952e",HINT_MOL_BOND_WEDGEDOWN_INVERTED:"\u865a\u6954\u7ebf\u952e2",HINT_MOL_BOND_CLOSER:"\u7a81\u51fa(\u52a0\u7c97)\u952e",HINT_MOL_BOND_WAVY:"\u6ce2\u6d6a\u952e",HINT_MOL_BOND_DOUBLE_EITHER:"\u987a\u6216\u53cd\u5f0f\u53cc\u952e",HINT_MOL_BOND_IONIC:"\u79bb\u5b50\u952e",HINT_MOL_BOND_COORDINATE:"\u914d\u4f4d\u952e",HINT_MOL_BOND_METALLIC:"\u91d1\u5c5e\u952e",HINT_MOL_BOND_HYDROGEN:"\u6c22\u952e",HINT_MOL_BOND_KEKULIZE:"Kekulize, \u5c06\u663e\u5f0f\u7684\u82b3\u9999\u952e\u8f6c\u6362\u4e3a\u5355\u53cc\u952e\u95f4\u9694\u5f62\u5f0f",HINT_MOL_BOND_HUCKLIZE:"Hucklize, \u5c06\u82b3\u73af\u4e0a\u7684\u952e\u8f6c\u6362\u4e3a\u663e\u5f0f\u7684\u82b3\u9999\u952e",HINT_MOL_ATOM:"\u539f\u5b50\u5de5\u5177",HINT_MOL_FORMULA:"\u5206\u5b50\u5f0f\u5de5\u5177",HINT_MOL_ATOM_AND_FORMULA:"\u539f\u5b50\u4e0e\u5206\u5b50\u5f0f\u5de5\u5177",HINT_MOL_CHARGE:"\u7535\u8377\u5de5\u5177",HINT_MOL_CHARGE_CLEAR:"\u6e05\u9664\u7535\u8377\u6216\u81ea\u7531\u57fa",HINT_MOL_CHARGE_POSITIVE:"\u6b63\u7535\u8377",HINT_MOL_CHARGE_NEGATIVE:"\u8d1f\u7535\u8377",HINT_MOL_CHARGE_SINGLET:"\u5355\u7ebf\u6001\u81ea\u7531\u57fa",HINT_MOL_CHARGE_DOUBLET:"\u53cc\u7ebf\u6001\u81ea\u7531\u57fa",HINT_MOL_CHARGE_TRIPLET:"\u4e09\u7ebf\u6001\u81ea\u7531\u57fa",HINT_MOL_ELECTRON_LONEPAIR:"\u5b64\u5bf9\u7535\u5b50",HINT_TEXT_BLOCK:"\u6587\u5b57\u5de5\u5177",HINT_IMAGE_BLOCK:"\u56fe\u50cf\u5de5\u5177",HINT_TEXT_IMAGE:"\u6587\u5b57\u4e0e\u56fe\u50cf\u5de5\u5177",HINT_MOL_FLEXCHAIN:"\u53ef\u53d8\u78b3\u94fe",HINT_MOL_FLEXRING:"\u53ef\u53d8\u78b3\u73af",HINT_REPOSITORY_RING:"\u73af\u5de5\u5177",HINT_REPOSITORY_RING_3:"\u73af\u4e19\u70f7",HINT_REPOSITORY_RING_4:"\u73af\u4e01\u70f7",HINT_REPOSITORY_RING_5:"\u73af\u620a\u70f7",HINT_REPOSITORY_RING_6:"\u73af\u5df1\u70f7",HINT_REPOSITORY_RING_7:"\u73af\u5e9a\u70f7",HINT_REPOSITORY_RING_8:"\u73af\u8f9b\u70f7",HINT_REPOSITORY_RING_AR_6:"\u82ef",HINT_REPOSITORY_RING_AR_5:"\u73af\u620a\u4e8c\u70ef",HINT_REPOSITORY_CYCLOHEXANE_CHAIR1:"\u73af\u5df1\u70f7\u6905\u5f0f1",HINT_REPOSITORY_CYCLOHEXANE_CHAIR2:"\u73af\u5df1\u70f7\u6905\u5f0f2",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1:"\u73af\u5df1\u70f7Haworth\u5f0f1",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2:"\u73af\u5df1\u70f7Haworth\u5f0f2",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1:"\u73af\u620a\u70f7Haworth\u5f0f1",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2:"\u73af\u620a\u70f7Haworth\u5f0f2",HINT_REPOSITORY_SUBBOND_MARK:"\u53d6\u4ee3\u57fa\u952e",HINT_REPOSITORY_METHANE:"\u7532\u70f7",HINT_REPOSITORY_FISCHER1:"\u5355\u624b\u6027\u4e2d\u5fc3Fischer\u6295\u5f71\u5f0f",HINT_REPOSITORY_FISCHER2:"\u53cc\u624b\u6027\u4e2d\u5fc3Fischer\u6295\u5f71\u5f0f",HINT_REPOSITORY_FISCHER3:"\u4e09\u624b\u6027\u4e2d\u5fc3Fischer\u6295\u5f71\u5f0f",HINT_REPOSITORY_SAWHORSE_STAGGERED:"\u4ea4\u53c9\u5f0f\u952f\u67b6\u5f0f",HINT_REPOSITORY_SAWHORSE_ECLIPSED:"\u91cd\u53e0\u5f0f\u952f\u67b6\u5f0f",HINT_REPOSITORY_ARROWLINE:"\u7ebf\u6bb5\u4e0e\u7bad\u5934",HINT_REPOSITORY_GLYPH:"\u56fe\u7b26",HINT_REPOSITORY_GLYPH_LINE:"\u76f4\u7ebf",HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"\u5f00\u653e\u7bad\u5934\u7ebf",HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"\u4e09\u89d2\u7bad\u5934\u7ebf",HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"\u53cc\u5411\u5f00\u653e\u7bad\u5934\u7ebf",HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"\u53cc\u5411\u4e09\u89d2\u7bad\u5934\u7ebf",HINT_REPOSITORY_GLYPH_REV_ARROW_LINE:"\u53ef\u9006\u7bad\u5934\u7ebf",HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"\u5f00\u653e\u7bad\u5934\u53cc\u7ebf",HINT_REPOSITORY_GLYPH_OPEN_ARROW_ARC:"\u5f00\u653e\u7bad\u5934\u5f27\u7ebf",HINT_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC:"\u5355\u4fa7\u5f00\u653e\u7bad\u5934\u5f27\u7ebf",HINT_REPOSITORY_HEAT_SYMBOL:"\u52a0\u70ed\u7b26\u53f7",HINT_REPOSITORY_ADD_SYMBOL:"\u52a0\u53f7",HINT_ELECTRON_PUSHING_ARROW:"\u7535\u5b50\u8f6c\u79fb\u7bad\u5934",HINT_NODE_LABEL_DISPLAY_MODE:"\u539f\u5b50\u6807\u7b7e\u663e\u793a\u6a21\u5f0f",HINT_TEXT_FORMAT:"\u8bbe\u7f6e\u6587\u5b57\u683c\u5f0f",HINT_FONTNAME:"\u8bbe\u7f6e\u5b57\u4f53",HINT_FONTSIZE:"\u8bbe\u7f6e\u5b57\u53f7",HINT_PICK_COLOR:"\u9009\u62e9\u989c\u8272",HINT_TEXT_DIRECTION:"\u8bbe\u7f6e\u6587\u5b57\u65b9\u5411",HINT_TEXT_HORIZONTAL_ALIGN:"\u8bbe\u7f6e\u6587\u5b57\u6c34\u5e73\u5bf9\u9f50\u65b9\u5f0f",HINT_TEXT_VERTICAL_ALIGN:"\u8bbe\u7f6e\u6587\u5b57\u6c34\u5e73\u5782\u76f4\u65b9\u5f0f",HINT_CHARGE_NONE:"\u65e0\u7535\u8377",HINT_ATOM_MODIFIER:"\u8bbe\u7f6e\u539f\u5b50",HINT_BOND_MODIFIER:"\u8bbe\u7f6e\u952e",HINT_CHARGE_MODIFIER:"\u8bbe\u7f6e\u7535\u8377",HINT_GLYPH_PATH_MODIFIER:"\u8bbe\u7f6e\u7ebf\u6bb5",HINT_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER:"\u8bbe\u7f6e\u53cd\u5e94\u7bad\u5934\u4e0e\u7ebf\u6bb5",HINT_ARC_PATH_MODIFIER:"\u8bbe\u7f6e\u5f27\u7ebf",HINT_MULTI_ARC_PATH_MODIFIER:"\u8bbe\u7f6e\u591a\u91cd\u5f27\u7ebf",HINT_ELECTRON_PUSHING_ARROW_MODIFIER:"\u8bbe\u7f6e\u7535\u5b50\u8f6c\u79fb\u7bad\u5934",HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER:"\u8bbe\u7f6e\u7535\u5b50\u8f6c\u79fb\u6210\u952e\u7bad\u5934",HINT_USE_ATOM_CUSTOM_COLOR:"(\u4f7f\u7528\u539f\u5b50\u7279\u5f81\u989c\u8272)",CAPTION_LOADDATA_DIALOG:"\u8f7d\u5165\u6570\u636e",CAPTION_LOADDATA_DIALOG_APPENDMODE:"\u9644\u52a0\u5230\u5f53\u524d\u6587\u6863",CAPTION_SAVEDATA_DIALOG:"\u4fdd\u5b58\u6570\u636e",CAPTION_DATA_FORMAT:"\u6570\u636e\u683c\u5f0f\uff1a",CAPTION_DATA_SRC:"\u5728\u4e0b\u65b9\u8f93\u5165\u6216\u7c98\u8d34\u6570\u636e\uff1a",CAPTION_LOADDATA_FROM_FILE:"\u8f7d\u5165\u6587\u4ef6",CAPTION_CHOOSEFILEFORMAT:"\u9009\u62e9\u6587\u4ef6\u683c\u5f0f",CAPTION_SELECT_FORMAT:"\u9009\u62e9\u683c\u5f0f\uff1a",CAPTION_PREVIEW_FILE_CONTENT:"\u9884\u89c8\u6587\u4ef6\u5185\u5bb9\u2026",S_DEF_SAVE_FILENAME:"Unnamed",CAPTION_ATOMLIST_PERIODIC_TABLE:"\u66f4\u591a\u2026",CAPTION_RGROUP:"\u53d6\u4ee3\u57fa",CAPTION_VARIABLE_ATOM:"(\u5305\u542b)\u539f\u5b50\u5217\u8868",CAPTION_VARIABLE_NOT_ATOM:"(\u4e0d\u5305\u542b)\u539f\u5b50\u5217\u8868",CAPTION_PSEUDOATOM:"\u8d5d\u539f\u5b50(Pseudoatom)",CAPTION_DUMMY_ATOM:"\u865a\u539f\u5b50(Dummy atom)",CAPTION_HETERO_ATOM:"\u6742\u539f\u5b50",CAPTION_ANY_ATOM:"\u4efb\u610f\u539f\u5b50",CAPTION_ATOM:"\u539f\u5b50",CAPTION_SUBGROUP:"\u57fa\u56e2",CAPTION_PERIODIC_TABLE_DIALOG:"\u5143\u7d20\u5468\u671f\u8868",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM:"\u9009\u62e9\u5143\u7d20",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEMS:"\u9009\u62e9\u591a\u4e2a\u5143\u7d20",CAPTION_TEXTBLOCK_INIT:"\u5728\u6b64\u8f93\u5165\u6587\u5b57",CAPTION_WIDTH:"\u5bbd",CAPTION_LENGTH:"\u957f",CAPTION_PATH_INDEX:"Path {0}",HINT_PATH_INDEX:"Path {0}",CAPTION_REACTION_ARROW_UNSET:"(\u672a\u8bbe\u7f6e)",CAPTION_REACTION_ARROW_CUSTOM:"\u81ea\u5b9a\u4e49",CAPTION_REACTION_ARROW_NORMAL:"\u666e\u901a\u53cd\u5e94\u7bad\u5934",CAPTION_REACTION_ARROW_RESONANCE:"\u5171\u632f\u5f0f\u7bad\u5934",CAPTION_REACTION_ARROW_REVERSIBLE:"\u53ef\u9006\u53cd\u5e94\u7bad\u5934",CAPTION_REACTION_ARROW_RETROSYNTHESIS:"\u9006\u5408\u6210\u5206\u6790\u7bad\u5934",HINT_REACTION_ARROW_UNSET:"\u672a\u8bbe\u7f6e",HINT_REACTION_ARROW_CUSTOM:"\u81ea\u5b9a\u4e49",HINT_REACTION_ARROW_NORMAL:"\u666e\u901a\u53cd\u5e94\u7bad\u5934",HINT_REACTION_ARROW_RESONANCE:"\u5171\u632f\u5f0f\u7bad\u5934",HINT_REACTION_ARROW_REVERSIBLE:"\u53ef\u9006\u53cd\u5e94\u7bad\u5934",HINT_REACTION_ARROW_RETROSYNTHESIS:"\u9006\u5408\u6210\u5206\u6790\u7bad\u5934",CAPTION_LINE_COUNT:"\u76f4\u7ebf\u6570\u76ee",CAPTION_LINE_GAP:"\u76f4\u7ebf\u95f4\u9699",CAPTION_LINE:"\u76f4\u7ebf",CAPTION_STARTING_ARROW:"\u8d77\u59cb\u7bad\u5934",CAPTION_ENDING_ARROW:"\u7ec8\u6b62\u7bad\u5934",CAPTION_REACTION_ARROW_TYPE:"\u53cd\u5e94\u7bad\u5934\u7c7b\u578b",CAPTION_ELECTRON_PUSHING_ARROW_TYPE:"\u7535\u5b50\u8f6c\u79fb\u7bad\u5934\u7c7b\u578b",CAPTION_OPPOSITE_ARROW_SIDES:"\u7bad\u5934\u4f4d\u7f6e\u76f8\u53cd",CAPTION_SAME_ARROW_SIDES:"\u7bad\u5934\u4f4d\u7f6e\u76f8\u540c",CAPTION_ELECTRON_PUSHING_ARROW_1:"\u5355\u7535\u5b50\u8f6c\u79fb\u7bad\u5934",CAPTION_ELECTRON_PUSHING_ARROW_1_ABBR:"\u5355\u7535\u5b50",HINT_ELECTRON_PUSHING_ARROW_1:"\u5355\u7535\u5b50\u8f6c\u79fb\u7bad\u5934",CAPTION_ELECTRON_PUSHING_ARROW_2:"\u53cc\u7535\u5b50\u8f6c\u79fb\u7bad\u5934",CAPTION_ELECTRON_PUSHING_ARROW_2_ABBR:"\u53cc\u7535\u5b50",HINT_ELECTRON_PUSHING_ARROW_2:"\u53cc\u7535\u5b50\u8f6c\u79fb\u7bad\u5934",CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_1:"\u7535\u5b50\u8f6c\u79fb\u6210\u952e\u7bad\u5934",HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_1:"\u7535\u5b50\u8f6c\u79fb\u6210\u952e\u7bad\u5934",LEGEND_CAPTION:"\u56fe\u4f8b",LEGEND_ELEM_SYMBOL:"\u5143\u7d20\u7b26\u53f7",LEGEND_ELEM_NAME:"\u540d\u79f0",LEGEND_ATOMIC_NUM:"\u539f\u5b50\u5e8f\u6570",LEGEND_ATOMIC_WEIGHT:"\u539f\u5b50\u91cf",CAPTION_2D:"2D",CAPTION_3D:"3D",CAPTION_AUTOSIZE:"\u81ea\u52a8\u5c3a\u5bf8",CAPTION_AUTOFIT:"\u81ea\u52a8\u7f29\u653e",CAPTION_SHOWSIZEINFO:"\u663e\u793a\u5c3a\u5bf8\u4fe1\u606f",CAPTION_LABEL_SIZE:"\u5c3a\u5bf8\uff1a",CAPTION_BACKGROUND_COLOR:"\u80cc\u666f\u989c\u8272\uff1a",CAPTION_WIDTH_HEIGHT:"\u5bbd\uff1a{0}\u3001\u9ad8\uff1a{1}",PLACEHOLDER_WIDTH:"\u5bbd",PLACEHOLDER_HEIGHT:"\u9ad8",HINT_AUTOSIZE:"\u56fe\u5f62\u5c3a\u5bf8\u662f\u5426\u7531\u5bf9\u8c61\u5927\u5c0f\u81ea\u52a8\u8c03\u6574",HINT_AUTOFIT:"\u5bf9\u8c61\u662f\u5426\u586b\u6ee1\u56fe\u5f62\u533a\u57df",S_VALUE_DEFAULT:"(\u7f3a\u7701)",CAPTION_TOGGLE_INSPECTOR:"\u5bf9\u8c61\u68c0\u89c6\u5668",HINT_TOGGLE_INSPECTOR:"\u663e\u793a\u6216\u9690\u85cf\u5bf9\u8c61\u68c0\u89c6\u5668"}),d.Localization.addResource("zh","ErrorMsg",{WIDGET_CLASS_NOT_FOUND:"\u63a7\u4ef6\u7c7b\u4e0d\u5b58\u5728",WIDGET_CAN_NOT_BIND_TO_ELEM:"\u63a7\u4ef6{0}\u65e0\u6cd5\u7ed1\u5b9a\u5230HTML\u5143\u7d20<{1}>",LOAD_CHEMDATA_FAILED:"\u8f7d\u5165\u6570\u636e\u5931\u8d25",FILE_API_NOT_SUPPORTED:"\u60a8\u5f53\u524d\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301HTML\u6587\u4ef6\u64cd\u4f5c\uff0c\u8bf7\u5347\u7ea7\u6d4f\u89c8\u5668\u3002",DRAW_BRIDGE_NOT_SUPPORTED:"\u60a8\u5f53\u524d\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u8be5\u7ed8\u56fe\u529f\u80fd\uff0c\u8bf7\u5347\u7ea7\u6d4f\u89c8\u5668\u3002",COMMAND_NOT_REVERSIBLE:"\u547d\u4ee4\u65e0\u6cd5\u64a4\u9500",PAGE_INDEX_OUTOF_RANGE:"\u9875\u9762\u8d85\u51fa\u8303\u56f4",FETCH_DATA_TIMEOUT:"\u52a0\u8f7d\u6570\u636e\u8d85\u65f6",RENDER_TYPE_CHANGE_NOT_ALLOWED:"\u6e32\u67d3\u7c7b\u578b\u65e0\u6cd5\u6539\u53d8",CAN_NOT_CREATE_EDITOR:"\u521b\u5efa\u7f16\u8f91\u5668\u5931\u8d25",CAN_NOT_SET_COORD_OF_CLASS:"\u65e0\u6cd5\u8bbe\u7f6e\u5bf9\u8c61{0}\u5b9e\u4f8b\u7684\u5750\u6807",CAN_NOT_SET_DIMENSION_OF_CLASS:"\u65e0\u6cd5\u8bbe\u7f6e\u5bf9\u8c61{0}\u5b9e\u4f8b\u7684\u5c3a\u5bf8",CAN_NOT_MERGE_CONNECTORS:"\u5316\u5b66\u952e\u6216\u8fde\u63a5\u7b26\u65e0\u6cd5\u5408\u5e76",NOT_A_VALID_ATOM:"\u65e0\u6548\u7684\u539f\u5b50",INVALID_ATOM_SYMBOL:"\u539f\u5b50\u7b26\u53f7\u65e0\u6548",INVALID_OR_EMPTY_IMAGE:"\u7a7a\u767d\u6216\u4e0d\u5408\u6cd5\u7684\u56fe\u50cf"}),function(){if(d.PROP_AUTO_TITLE){var e=ClassEx.getPrototype(ObjectEx).defineProp;ClassEx.getPrototype(ObjectEx).defineProp=function(t,r){if(!r.title&&!r.description){var n=this.getClassName();n.startsWith("Kekule.")&&(n=n.substr(7));var i="TITLE_"+t,o="DES_"+t,a=d.Localization.findValue("OBJDEF_TEXTS."+n+"."+i),s=d.Localization.findValue("OBJDEF_TEXTS."+n+"."+o);r.title=a,r.description=s}return e.apply(this,[t,r])}}d.ExceptionLevel={ERROR:-1,NOT_FATAL_ERROR:-10,WARNING:-2,NOTE:-3,LOG:-4,getAllLevels:function(){var e=d.ExceptionLevel;return[e.ERROR,e.NOT_FATAL_ERROR,e.WARNING,e.NOTE,e.LOG]},levelToString:function(e){var t=d.ExceptionLevel;return e===t.ERROR||e===t.NOT_FATAL_ERROR?"error":e===t.WARNING?"warning":e===t.NOTE?"note":"log"}},d.ErrorLevel=d.ExceptionLevel,d.throwException=function(e,t){if(d.exceptionHandler)return d.exceptionHandler.throwException(e,t);var r=d.ExceptionLevel;if(!t||t===r.ERROR)throw"string"==typeof e&&(e=new d.Exception(e)),e;if("undefined"!=typeof console){"string"!=typeof e&&(e=e.message);var n=t===r.NOT_FATAL_ERROR?console.error:t===r.WARNING?console.warn:t===r.NOTE?console.info:console.log;n?n(e):console.log(e)}},d.getExceptionMsg=function(e){return"string"==typeof e?e:"object"==typeof e?e.message:""},d.raise=d.throwException,d.error=function(e,t){var r=t?d.ExceptionLevel.NOT_FATAL_ERROR:d.ExceptionLevel.ERROR;return d.raise(e,r)},d.chemError=function(e,t){return"string"==typeof e&&(e=new d.ChemError(e)),d.error(e,t)},d.warn=function(e){return d.raise(e,d.ExceptionLevel.WARNING)},d.notify=function(e){return d.raise(e,d.ExceptionLevel.NOTE)},d.log=function(e){return d.raise(e,d.ExceptionLevel.LOG)},d.hasLocalRes=function(){return!!d.LOCAL_RES},d.globalOptions={add:function(e,t){var r=Object.getCascadeFieldValue(e,d.globalOptions);r&&DataType.isObjectValue(r)&&DataType.isObjectValue(t)?Object.extend(r,t):Object.setCascadeFieldValue(e,t,d.globalOptions,!0)},get:function(e,t){var r=Object.getCascadeFieldValue(e,d.globalOptions);return void 0===r&&(r=t),r}},d.HashEx=Class.create({CLASS_NAME:"Kekule.HashEx",PROP_NAME_PREFIX:"__$key$__",initialize:function(){this._map={}},finalize:function(){this._map=null},keyToPropName:function(e){return this.PROP_NAME_PREFIX+e},has:function(e){return this._map.hasOwnProperty(this.keyToPropName(e))},set:function(e,t){return this._map[this.keyToPropName(e)]=t,this},get:function(e,t){var r=this.keyToPropName(e);return this._map.hasOwnProperty(r)?this._map[r]:t},remove:function(e){var t=this.keyToPropName(e);return this._map.hasOwnProperty(t)&&delete this._map[t],this},clear:function(){this._map={}}}),d.MapEx=Class.create({CLASS_NAME:"Kekule.MapEx",initialize:function(e,t){this.isWeak=!e,d.MapEx._inited||d.MapEx._init();var r=e?d.MapEx._implementationNonWeak:d.MapEx._implementationWeak;r?this._implementation=new r:(this._keys=[],this._values=[]),t&&(this._cache={})},finalize:function(){this._implementation||(this._keys=null,this._values=null,this._cache=null)},set:function(e,t){if(this._implementation)this._implementation.set(e,t);else{var r=this._keys.indexOf(e);r>=0?this._values[r]=t:(this._keys.push(e),this._values.push(t))}return this._cache&&this._cache.key===e&&(this._cache.value=t),this},get:function(e,t){if(this._cache&&this._cache.key===e)return this._cache.value;var r,n=!1;if(this._implementation)this._implementation.has(e)&&(r=this._implementation.get(e),n=!0);else{var i=this._keys.indexOf(e);i>=0&&(r=this._values[i],n=!0)}return n&&this._cache&&(this._cache.key=e,this._cache.value=r),n?r:t},has:function(e){return this._implementation?this._implementation.has(e):this._keys.indexOf(e)>=0},remove:function(e){if(this._cache&&this._cache.key===e&&(this._cache={}),this._implementation)return this._implementation[!this._implementation||"delete"](e);var t=this._keys.indexOf(e);return t>=0&&(this._keys.splice(t,1),this._values.splice(t,1)),this},clear:function(){return this._cache&&(this._cache={}),this._implementation&&!this._debug||(this._keys=[],this._values=[]),this._implementation&&(this.isWeak?d.error(d.$L("ErrorMsg.CANNOT_CLEAR_WEAKMAP")):this._implementation.clear()),this},getKeys:function(){if(this._implementation){if(this.isWeak)return d.error(d.$L("ErrorMsg.CANNOT_GET_KEY_LIST_IN_WEAKMAP")),[];var e,t=this._implementation.keys();if(Array.from)e=Array.from(t);else if(t.next){e=[];for(var r=t.next();!r.done;)e.push(r.value),r=t.next()}else for(var n in e=[],t)e.push(n);return e}return[].concat(this._keys)},getValues:function(){if(this._implementation){if(this.isWeak)return d.error(d.$L("ErrorMsg.CANNOT_GET_VALUE_LIST_IN_WEAKMAP")),[];var e,t=this._implementation.values();if(Array.from)e=Array.from(t);else if(t.next){e=[];for(var r=t.next();!r.done;)e.push(r.value),r=t.next()}else for(var n in e=[],t)e.push(n);return e}return this._values},getLength:function(){return this.getKeys().length}}),d.MapEx._init=function(){d.MapEx._implementationWeak=null,d.MapEx._implementationNonWeak=null,d.$jsRoot.WeakMap&&(d.MapEx._implementationWeak=d.$jsRoot.WeakMap),d.$jsRoot.Map&&d.$jsRoot.Map.prototype.keys&&(d.MapEx._implementationNonWeak=d.$jsRoot.Map),d.MapEx._inited=!0},d.MapEx._inited=!1,d.TwoTupleMapEx=Class.create({CLASS_NAME:"Kekule.TwoTupleMapEx",initialize:function(e,t){this.nonWeak=e,this.map=new d.MapEx(e,t),t&&(this._level1Cache={})},finalize:function(){this._level1Cache=null,this.map.finalize()},getSecondLevelMap:function(e,t){if(e&&this._level1Cache&&e===this._level1Cache.key&&this._level1Cache.value)return this._level1Cache.value;var r=this.map.get(e);return!r&&t&&(r=new d.MapEx(this.nonWeak),this.map.set(e,r)),r},set:function(e,t,r){return this.getSecondLevelMap(e,!0).set(t,r),this},get:function(e,t,r){var n=this.getSecondLevelMap(e,!1);return n?n.get(t,r):r},has:function(e,t){var r=this.getSecondLevelMap(e,!1);return!!r&&r.has(t)},remove:function(e,t){var r=this.getSecondLevelMap(e,!1);if(r)return r.remove(t)},clear:function(){this.map.clear(),this._level1Cache&&(this._level1Cache={})}}),d.CoordMode={UNKNOWN:0,COORD2D:2,COORD3D:3},d.ClassDefineUtils={CommonSizeMethods:{getSizeOfMode:function(e,t){return e===d.CoordMode.COORD3D?this.getSize3D(t):this.getSize2D(t)},setSizeOfMode:function(e,t){return t===d.CoordMode.COORD3D?this.setSize3D(e):this.setSize2D(e)},getBoxOfMode:function(e,t){return e===d.CoordMode.COORD3D?this.getBox3D(t):this.getBox2D(t)}},Size2DMethods:{fetchSize2D:function(){var e=this.getPropStoreFieldValue("size2D");return e||(e={},this.setPropStoreFieldValue("size2D",e)),e},notifySize2DChanged:function(e){this.notifyPropSet("size2D",e)},hasSize2D:function(e){var t=this.getPropStoreFieldValue("size2D"),r=t&&(void 0!==t.x||void 0!==t.y);return!r&&e&&(r=!!this.hasSize3D&&this.hasSize3D()),r},getBox2D:function(e){var t=this.getCoord2D(e)||{x:0,y:0},r=this.getSize2D(e);if(r&&(r.x||r.y)){var n={x:r.x,y:-r.y},i=d.CoordUtils.add(t,n);return{x1:t.x,y1:t.y,x2:i.x,y2:i.y}}return{x1:t.x,y1:t.y,x2:t.x,y2:t.y}},get2DSizeX:function(e){var t=this.getSize2D(e);return t&&t.x||0},set2DSizeX:function(e){var t=this.fetchSize2D();t.x!=e&&(t.x=e,this.notifySize2DChanged(t))},get2DSizeY:function(e){var t=this.getSize2D(e);return t&&t.y||0},set2DSizeY:function(e){var t=this.fetchSize2D();t.y!=e&&(t.y=e,this.notifySize2DChanged(t))}},Size3DMethods:{fetchSize3D:function(){var e=this.getPropStoreFieldValue("size3D");return e||(e={},this.setPropStoreFieldValue("size3D",e)),e},notifySize3DChanged:function(e){this.notifyPropSet("size3D",e)},hasSize3D:function(e){var t=this.getPropStoreFieldValue("size3D"),r=t&&(void 0!==t.x||void 0!==t.y||void 0!==t.z);return!r&&e&&(r=!!this.hasSize2D&&this.hasSize2D()),r},getBox3D:function(e){var t=this.getCoord3D(e),r=this.getSize3D(e);if(t&&r){var n=d.CoordUtils.add(t,r);return{x1:t.x,y1:t.y,z1:t.z,x2:n.x,y2:n.y,z2:n.z}}},get3DSizeX:function(e){var t=this.getSize3D(e);return t&&t.x||0},set3DSizeX:function(e){var t=this.fetchSize3D();t.x!=e&&(t.x=e,this.notifySize3DChanged(t))},get3DSizeY:function(e){var t=this.getSize3D(e);return t&&t.y||0},set3DSizeY:function(e){var t=this.fetchSize3D();t.y!=e&&(t.y=e,this.notifySize3DChanged(t))},get3DSizeZ:function(e){var t=this.getSize3D(e);return t&&t.z||0},set3DSizeZ:function(e){var t=this.fetchSize3D();t.z!=e&&(t.z=e,this.notifySize3DChanged(t))}},addStandardSizeSupport:function(e,t){ClassEx.extend(e,d.ClassDefineUtils.CommonSizeMethods),(!t||t.indexOf("size2D")>=0)&&(ClassEx.defineProp(e,"size2D",{dataType:DataType.HASH,getter:function(e,t){var r=this.getPropStoreFieldValue("size2D");!r&&e&&this.hasSize3D()&&(r=this.getSize3D()),!r&&t&&(r={x:0,y:0},this.setPropStoreFieldValue("size2D",r));var n=r?{x:r.x,y:r.y}:void 0;return n&&(n=d.CoordUtils.absValue(n)),n},setter:function(e){var t=this.fetchSize2D();void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),this.notifySize2DChanged(t)}}),ClassEx.extend(e,d.ClassDefineUtils.Size2DMethods)),(!t||t.indexOf("size3D")>=0)&&(ClassEx.defineProp(e,"size3D",{dataType:DataType.HASH,getter:function(e,t){var r=this.getPropStoreFieldValue("size3D");return!r&&e&&this.hasSize2D()&&((r=this.getSize2D()).z=0),!r&&t&&(r={x:0,y:0,z:0},this.setPropStoreFieldValue("size3D",r)),r?{x:r.x,y:r.y,z:r.z}:void 0},setter:function(e){var t=this.fetchSize3D();void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),void 0!==e.z&&(t.z=e.z),this.notifySize3DChanged(t)}}),ClassEx.extend(e,d.ClassDefineUtils.Size3DMethods))},CommonCoordMethods:{getCoordParent:function(e){return this.getParent&&this.getParent()||null},getCoordOfMode:function(e,t){return e===d.CoordMode.COORD3D?this.getCoord3D(t):this.getCoord2D(t)},setCoordOfMode:function(e,t){return t===d.CoordMode.COORD3D?this.setCoord3D(e):this.setCoord2D(e)},getAbsCoordOfMode:function(e,t){return e===d.CoordMode.COORD3D?this.getAbsCoord3D(t):this.getAbsCoord2D(t)},setAbsCoordOfMode:function(e,t){return t===d.CoordMode.COORD3D?this.setAbsCoord3D(e):this.setAbsCoord2D(e)},hasCoordOfMode:function(e,t){return e===d.CoordMode.COORD3D?this.hasCoord3D(t):this.hasCoord2D(t)},getIndirectCoordStorageOfMode:function(e){var t=this.getIndirectCoordStorage&&this.getIndirectCoordStorage();return t&&t[e]},setIndirectCoordStorageOfMode:function(e,t){var r=this.getIndirectCoordStorage&&this.getIndirectCoordStorage();return r&&(r[e]=t),this},calcIndirectCoordValue:function(e,t){var r=["x","y"];e===d.CoordMode.COORD3D&&r.push("z");var n=this.getIndirectCoordStorage()[e],i=this.getIndirectCoordRefCoords(e,t);d.ArrayUtils.isArray(i)&&(i=i[0]);var o=this.getIndirectCoordRefLengths(e,t);if(n&&i&&o){for(var a={},s=d.ObjUtils.notUnset,l=0,u=r.length;l<u;++l){var c,h=r[l],p=n[h],g=i[h],f=o[h];s(p)&&s(g)&&s(f)&&(c=0===f?g:g+f*p,a[h]=c)}return a}return null},calcIndirectCoordStorage:function(e,t,r,n){var i=["x","y"];e===d.CoordMode.COORD3D&&i.push("z");var o=this.getIndirectCoordStorageOfMode(e),a=this.getIndirectCoordRefCoords(e,n);d.ArrayUtils.isArray(a)&&(a=a[0]);var s=this.getIndirectCoordRefLengths(e,n);if(o&&a&&s){for(var l={},u=d.ObjUtils.notUnset,c=0,h=i.length;c<h;++c){var p,g=i[c],f=t[g],m=a[g],C=s[g];if(!(u(f)&&u(m)&&u(C)))return null;p=0!==C?(f-m)/C:1,l[g]=p}return l}return null},saveIndirectCoordValue:function(e,t,r,n){if(t){var i=this.calcIndirectCoordStorage(e,t,r,n);if(i)return this.setIndirectCoordStorageOfMode(e,i),i}return null},getIndirectCoordRefLengths:function(e,t){return null},getIndirectCoordRefCoords:function(e,t){return null}},Coord2DMethods:{fetchCoord2D:function(){var e=this.getPropStoreFieldValue("coord2D");return e||(e={},this.setPropStoreFieldValue("coord2D",e)),e},notifyCoord2DChanged:function(e){this.notifyPropSet("coord2D",e)},hasCoord2D:function(e){var t=this.getPropStoreFieldValue("coord2D"),r=t&&(void 0!==t.x||void 0!==t.y);return!r&&e&&(r=!!this.hasCoord3D&&this.hasCoord3D()),r},get2DX:function(e){var t=this.getCoord2D(e);return t&&t.x||0},set2DX:function(e){var t=this.fetchCoord2D();t.x!=e&&(t.x=e,this.notifyCoord2DChanged(t))},get2DY:function(e){var t=this.getCoord2D(e);return t&&t.y||0},set2DY:function(e){var t=this.fetchCoord2D();t.y!=e&&(t.y=e,this.notifyCoord2DChanged(t))}},Coord3DMethods:{fetchCoord3D:function(){var e=this.getPropStoreFieldValue("coord3D");return e||(e={},this.setPropStoreFieldValue("coord3D",e)),e},notifyCoord3DChanged:function(e){this.notifyPropSet("coord3D",e)},hasCoord3D:function(e){var t=this.getPropStoreFieldValue("coord3D"),r=t&&(void 0!==t.x||void 0!==t.y||void 0!==t.z);return!r&&e&&(r=!!this.hasCoord2D&&this.hasCoord2D()),r},get3DX:function(e){var t=this.getCoord3D(e);return t&&t.x||0},set3DX:function(e){var t=this.fetchCoord3D();t.x!=e&&(t.x=e,this.notifyCoord3DChanged(t))},get3DY:function(e){var t=this.getCoord3D(e);return t&&t.y||0},set3DY:function(e){var t=this.fetchCoord3D();t.y!=e&&(t.y=e,this.notifyCoord3DChanged(t))},get3DZ:function(e){var t=this.getCoord3D(e);return t&&t.z||0},set3DZ:function(e){var t=this.fetchCoord3D();t.z!=e&&(t.z=e,this.notifyCoord3DChanged(t))}},addStandardCoordSupport:function(e,t){ClassEx.extend(e,d.ClassDefineUtils.CommonCoordMethods),(!t||t.indexOf("coord2D")>=0)&&(ClassEx.defineProp(e,"coord2D",{dataType:DataType.HASH,getter:function(e,t){if(this.getEnableIndirectCoord()){var r=this.calcIndirectCoordValue(d.CoordMode.COORD2D,e);if(r)return r}var n=this.getPropStoreFieldValue("coord2D");return!n&&e&&this.hasCoord3D()&&(n=this.getCoord3D()),!n&&t&&(n={x:0,y:0},this.setPropStoreFieldValue("coord2D",n)),n?{x:n.x,y:n.y}:void 0},setter:function(e){var t=this.fetchCoord2D();this.getEnableIndirectCoord()&&this.saveIndirectCoordValue(d.CoordMode.COORD2D,e,t),void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),this.notifyCoord2DChanged(t)}}),ClassEx.extend(e,d.ClassDefineUtils.Coord2DMethods)),(!t||t.indexOf("coord3D")>=0)&&(ClassEx.defineProp(e,"coord3D",{dataType:DataType.HASH,getter:function(e,t){if(this.getEnableIndirectCoord()){var r=this.calcIndirectCoordValue(d.CoordMode.COORD2D,e);if(r)return r}var n=this.getPropStoreFieldValue("coord3D");return!n&&e&&this.hasCoord2D()&&((n=this.getCoord2D()).z=0),!n&&t&&(n={x:0,y:0,z:0},this.setPropStoreFieldValue("coord3D",n)),n?{x:n.x,y:n.y,z:n.z}:void 0},setter:function(e){var t=this.fetchCoord3D();this.getEnableIndirectCoord()&&this.saveIndirectCoordValue(d.CoordMode.COORD3D,e,t),void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),void 0!==e.z&&(t.z=e.z),this.notifyCoord3DChanged(t)}}),ClassEx.extend(e,d.ClassDefineUtils.Coord3DMethods)),(!t||t.indexOf("absCoord2D")>=0)&&ClassEx.defineProp(e,"absCoord2D",{dataType:DataType.HASH,serializable:!1,getter:function(e){var t=this.getCoord2D(e)||{},r=this.getCoordParent(d.CoordMode.COORD2D);return r&&r.getAbsCoord2D?d.CoordUtils.add(t,r.getAbsCoord2D(e)||{}):{x:t.x,y:t.y}},setter:function(e,t){var r=e,n=this.getCoordParent(d.CoordMode.COORD2D);n&&n.getAbsCoord2D&&(r=d.CoordUtils.substract(e,n.getAbsCoord2D(t))),this.setCoord2D(r)}}),(!t||t.indexOf("absCoord3D")>=0)&&ClassEx.defineProp(e,"absCoord3D",{dataType:DataType.HASH,serializable:!1,getter:function(e){var t=this.getCoord3D(e)||{},r=this.getCoordParent(d.CoordMode.COORD3D);return r&&r.getAbsCoord3D?d.CoordUtils.add(t,r.getAbsCoord3D(e)||{}):{x:t.x,y:t.y,z:t.z}},setter:function(e,t){var r=e,n=this.getCoordParent(d.CoordMode.COORD2D);n&&n.getAbsCoord3D&&(r=d.CoordUtils.substract(e,n.getAbsCoord3D(t))),this.setCoord3D(r)}}),(!t||t.indexOf("enableIndirectCoord")>=0)&&ClassEx.defineProp(e,"enableIndirectCoord",{scope:Class.PropertyScope.PUBLIC,dataType:DataType.BOOL,serializable:!0,setter:function(e){if(this.getPropStoreFieldValue("enableIndirectCoord")!=e){if(e){var t=this.getCoord2D(),r=this.getCoord3D();t&&this.saveIndirectCoordValue(d.CoordMode.COORD2D,t,t,!0),r&&this.saveIndirectCoordValue(d.CoordMode.COORD3D,r,r,!0)}this.setPropStoreFieldValue("enableIndirectCoord",e)}}}),(!t||t.indexOf("indirectCoordStorage")>=0)&&ClassEx.defineProp(e,"indirectCoordStorage",{dataType:DataType.HASH,serializable:function(){return!!this.getEnableIndirectCoord()},setter:null,getter:function(){var e=this.getPropStoreFieldValue("indirectCoordStorage");return e||((e={})[d.CoordMode.COORD2D]={},e[d.CoordMode.COORD3D]={},this.setPropStoreFieldValue("indirectCoordStorage",e)),e}})},ExtraObjMapMethods:{getExtraProp:function(e,t){var r=this.getExtraObjMap().get(e);return r?t?r[t]:r:void 0},setExtraProp:function(e,t,r){var n;(n=this.getExtraProp(e))?n[t]=r:((n={})[t]=r,this.getExtraObjMap().set(e,n))},removeExtraProp:function(e,t){if(t){var r=this.getExtraProp(e);r[t]=void 0,delete r[t]}else this.getExtraObjMap().remove(e)}},addExtraObjMapSupport:function(e){ClassEx.defineProp(e,"extraObjMap",{dataType:"Kekule.MapEx",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("extraObjMap");return e||(e=new d.MapEx(!0,!0),this.setPropStoreFieldValue("extraObjMap",e)),e}}),ClassEx.extend(e,d.ClassDefineUtils.ExtraObjMapMethods)},ExtraTwoTupleObjMapMethods:{getExtraProp2:function(e,t,r){var n=(this.__$__k__extraTwoTupleObjMap__$__||this.getExtraTwoTupleObjMap()).get(e,t);return n?r?n[r]:n:void 0},setExtraProp2:function(e,t,r,n){var i;(i=this.getExtraProp2(e,t))?i[r]=n:((i={})[r]=n,(this.__$__k__extraTwoTupleObjMap__$__||this.getExtraTwoTupleObjMap()).set(e,t,i))},removeExtraProp2:function(e,t,r){if(r){var n=this.getExtraProp2(e,t);n[r]=void 0,delete n[r]}else this.getExtraTwoTupleObjMap().remove(e,t)}},addExtraTwoTupleObjMapSupport:function(e){var t="extraTwoTupleObjMap";ClassEx.defineProp(e,t,{dataType:"Kekule.TwoTupleMapEx",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue(t);return e||(e=new d.TwoTupleMapEx(!0,!0),this.setPropStoreFieldValue(t,e),this.__$__k__extraTwoTupleObjMap__$__=e),e}}),ClassEx.extend(e,d.ClassDefineUtils.ExtraTwoTupleObjMapMethods)}},d.ObjPropSettingManager={_items:new d.MapEx(!0),register:function(e,t){d.ObjPropSettingManager._items.set(e,t)},unregister:function(e){d.ObjPropSettingManager._items.remove(e)},getSetting:function(e){return d.ObjPropSettingManager._items.get(e)}},ClassEx.defineProp(ObjectEx,"predefinedSetting",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=d.StrUtils.splitTokens(e||"",",");if(t.length){for(var r=0,n=t.length;r<n;++r){for(var i=this.getClass(),o=t[r],a=null,s="";i&&!a;)s=ClassEx.getClassName(i)+"."+o,a=d.ObjPropSettingManager.getSetting(s),i=ClassEx.getSuperClass(i);a||(a=d.ObjPropSettingManager.getSetting(o)),a&&this.setPropValues(a)}this.setPropStoreFieldValue("predefinedSetting",s)}}}),d.ObjectTreeOperation={MODIFY:0,ADD:1,REMOVE:2},d.ChemObjInteractMode={DEFAULT:0,UNMOVABLE:1,UNSELECTABLE:2,HIDDEN:3},d.ComparisonMethod={DEFAULT:0,PROPERTIES:1,CHEM_STRUCTURE:10},d.ObjComparer={equal:function(e,t,r){return 0===d.ObjComparer.compare(e,t,r)},compare:function(e,t,r){return d.ObjComparer._compareValue(e,t,r)},_compareValue:function(e,t,r){var n=DataType;if(e===t)return 0;if(e<t&&!(e>t))return-1;if(e>t&&!(e<t))return 1;var i=null,o=n.getType(e),a=n.getType(t);if(o!==a){var s=[n.UNKNOWN,n.VARIANT,n.UNDEFINED,n.BOOL,n.NUMBER,n.INT,n.FLOAT,n.STRING,n.ARRAY,n.FUNCTION,n.DATE,n.OBJECT,n.OBJECTEX,n.CLASS],l=s.indexOf(o),u=s.indexOf(a);i=l<0&&u<0?null:l-u}else if(!e&&t)i=-1;else if(e&&!t)i=1;else if(e.doCompare)i=e.doCompare(t,r);else if(t.doCompare)i=-t.doCompare(e,r);else if(o===DataType.ARRAY){if(!(i=e.length-t.length))for(var c=0,h=e.length;c<h&&!(i=d.ObjComparer._compareValue(e[c],t[c],r));++c);}else if(o===DataType.OBJECT){var p,g;i=(p=JSON.toString(e))<(g=JSON.toString(t))?-1:p>g?1:0}else i=null;return null===i&&null===(i=(p=e.toString&&e.toString()||"")<(g=t.toString&&t.toString()||"")?-1:p>g?1:null)&&(i=-1),i}},d.ChemObject=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemObject",initialize:function(e){this.tryApplySuper("initialize"),e&&this.setId(e),this.setBubbleEvent(!0),this.__load_owner_objRef_props__=null,this.__load_parent_objRef_props__=null,this.addEventListener("change",(function(e){var t=this.getPropStoreFieldValue("srcInfo");if(t&&t.data){for(var r=e.target,n=e.changedPropNames,i=!1,o=0,a=n.length;o<a;++o){var s=n[o];if(s&&"srcInfo"!==s&&r.isPropertySerializable(s)){i=!0;break}if("[children]"===s){i=!0;break}}i&&(t.data=null)}}),this)},doFinalize:function(){this.__load_owner_objRef_props__=null,this.__load_parent_objRef_props__=null,this.setPropStoreFieldValue("attachedCoordStickNodes",null),this.removeSelf(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("id",{dataType:DataType.STRING}),this.defineProp("interactMode",{dataType:DataType.INT,enumSource:d.ChemObjInteractMode}),this.defineProp("info",{dataType:DataType.HASH,getter:function(e){var t=this.getPropStoreFieldValue("info");return!t&&e&&(t={},this.setPropStoreFieldValue("info",t)),t}}),this.defineProp("scalarAttribs",{dataType:DataType.ARRAY,setter:null}),this.defineProp("parent",{dataType:"Kekule.ChemObject",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getParent();t!==e&&(t&&t._removeChildObj&&(t._removeChildObj(this),this.invokeEvent("removeFromObjTree",{obj:this,parent:t})),this.setPropStoreFieldValue("parent",e),e&&e._appendChildObj&&(e._appendChildObj(this),this.invokeEvent("addToObjTree",{obj:this,parent:e})),this.parentChanged(e,t))}}),this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getOwner();t!==e&&(t&&(t._removeOwnedObj(this),this.invokeEvent("removeFromSpace",{obj:this,owner:t})),this.setPropStoreFieldValue("owner",e),e&&(e._appendOwnedObj(this),this.invokeEvent("addToSpace",{obj:this,owner:t})),this.ownerChanged(e,t))}}),this.defineProp("srcInfo",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLISHED,getter:function(){var e=this.getPropStoreFieldValue("srcInfo");return e||(e={},this.setPropStoreFieldValue("srcInfo",e)),e}}),this.defineProp("isEditing",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getOwner();return e&&e.getIsEditing?e.getIsEditing():this.getPropStoreFieldValue("isEditing")}}),this.defineProp("attachedCoordStickNodes",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("attachedCoordStickNodes");return e||(e=[],this.setPropStoreFieldValue("attachedCoordStickNodes",e)),e}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableObjectChangeEvent(!0)},getHigherLevelObj:function(){return this.getParent()||this.getOwner()},getAutoIdPrefix:function(){return"o"},_parentObjectLoaded:function(e){this._handleObjRefProps(e,this.__load_parent_objRef_props__)},_ownerObjectLoaded:function(e){this._handleObjRefProps(e,this.__load_owner_objRef_props__)},_handleObjRefProps:function(e,t){var r=t;if(r&&e&&e.getChildAtIndexStack)for(var n=d.ObjUtils.getOwnedFieldNames(r),i=0,o=n.length;i<o;++i){var a=n[i],s=r[a];if(DataType.isArrayValue(s)){var l=[];for(i=0,o=s.length;i<o;++i)if(h=this._doUnwrapObjRefSerializationStr(this,s[i])){var u=e.getChildAtIndexStack(h);l.push(u)}else l.push(void 0);this.setPropValue(a,l)}else{var c,h;(h=this._doUnwrapObjRefSerializationStr(this,s))&&(c=e.getChildAtIndexStack(h)),c&&this.setPropValue(a,c)}try{delete r[a]}catch(e){}}},doSaveProp:function(e,t,r,n){if(t.serializable&&e._doGetObjRefSerializationValue&&t.objRef){var i="parent"===t.objRefRoot?e.getParent():e.getOwner();if(i){var o=e.getPropValue(t.name);if(o){if(d.ArrayUtils.isArray(o)){for(var a=[],s=0,l=o.length;s<l;++s){var u=e._doGetObjRefSerializationValue(i,e,o[s]);u?a.push(u):a.push(o[s])}return n.doSaveFieldValue(e,t.name,a,r,n.getValueExplicitType(a)),!0}var c=e._doGetObjRefSerializationValue(i,e,o);if(c)return n.doSaveFieldValue(e,t.name,c,r,n.getValueExplicitType(c)),!0}}}},_doGetObjRefSerializationValue:function(e,t,r){var n=e.indexStackOfChild(r);return n&&n.length?"@"+JSON.stringify(n):null},doLoadProp:function(e,t,r,n){if(t.serializable&&t.objRef){var i="parent"===t.objRefRoot,o=i?e.__load_parent_objRef_props__:e.__load_owner_objRef_props__;o||(o={},i?e.__load_parent_objRef_props__=o:e.__load_owner_objRef_props__=o);var a=n.doLoadFieldValue(e,t.name,r);if(a){if("string"==typeof a&&a.startsWith("@"))return o[t.name]=a,!0;if(DataType.isArrayValue(a))return o[t.name]=a,!0}}},_doUnwrapObjRefSerializationStr:function(e,t){try{var r=t.substr(1),n=JSON.parse(r);return DataType.isArrayValue(n)?n:null}catch(e){d.error(e)}},loaded:function(){this.tryApplySuper("loaded"),this.notifyParentLoaded()},notifyParentLoaded:function(){for(var e=0,t=this.getChildCount();e<t;++e){var r=this.getChildAt(e);r&&r._parentObjectLoaded&&r._parentObjectLoaded(this)}},isObjRefProperty:function(e){return!(!e||!e.objRef)},notifyPropSet:function(e,t,r){this.tryApplySuper("notifyPropSet",[e,t,r]);var n=this.getPropInfo(e);if(n&&this.isObjRefProperty(n)){var i=this.getOwner();i&&i.modifyObjRefRelation&&i.modifyObjRefRelation(this,n,this.getPropValue(n.name))}},getObjRefProperties:function(){for(var e=[],t=this.getAllPropList(),r=0,n=t.getLength();r<n;++r){var i=t.getPropInfoAt(r);this.isObjRefProperty(i)&&e.push(i)}return e},_registerObjRefRelations:function(e){if(e&&e.modifyObjRefRelation){var t=this.getObjRefProperties();if(t.length)for(var r=0,n=t.length;r<n;++r){var i=t[r],o=this.getPropValue(i.name);e.modifyObjRefRelation(this,i,o)}}},_unregisterObjRefRelations:function(e){if(e&&e.releaseObjRefRelation){var t=this.getObjRefProperties();if(t.length)for(var r=0,n=t.length;r<n;++r){var i=t[r];e.releaseObjRefRelation(this,i)}}},isSelectable:function(){var e=d.ChemObjInteractMode;return!((this.getInteractMode()||e.DEFAULT)&e.UNSELECTABLE)},isMovable:function(){var e=d.ChemObjInteractMode;return!((this.getInteractMode()||e.DEFAULT)&e.UNMOVABLE)},getNearestSelectableObject:function(){return this.isSelectable()?this:this.getParent()?this.getParent().getNearestSelectableObject():null},getNearestMovableObject:function(){return this.isMovable()?this:this.getParent()?this.getParent().getNearestMovableObject():null},getNearestAncestorOfType:function(e){var t=this.getParent();return t?t instanceof e?t:t.getNearestAncestorOfType?t.getNearestAncestorOfType(e):null:null},removeSelf:function(){this.setParent(null),this.setOwner(null)},notifyScalarAttribsChange:function(){this.notifyPropSet("scalarAttribs",this.getPropStoreFieldValue("scalarAttribs"))},notifyInfoChange:function(){this.notifyPropSet("info",this.getPropStoreFieldValue("info"))},_removeChildObj:function(e){this._notifyOwnerObjTreeOperation(e,this,d.ObjectTreeOperation.REMOVE)},_appendChildObj:function(e){this._notifyOwnerObjTreeOperation(e,this,d.ObjectTreeOperation.ADD)},_notifyOwnerObjTreeOperation:function(e,t,r){var n=this.getOwner();n&&n._notifyObjTreeOperation&&n._notifyObjTreeOperation(e,t,r)},objTreeOfOwnerUpdated:function(e,t,r){},objSpaceOfOwnerUpdated:function(e,t,r){},ownerChanged:function(e,t){for(var r=0,n=this.getScalarAttribCount();r<n;++r)this.getScalarAttribAt(r).setOwner(e);for(r=0,n=this.getChildCount();r<n;++r){var i=this.getChildAt(r);i&&i.setOwner&&i.setOwner(e)}},parentChanged:function(e,t){},getParentList:function(){var e=[],t=this.getParent();return t&&(t.getParentList&&(e=t.getParentList()||[]),e.unshift(t)),e},isChildOf:function(e){for(var t=this.getParent();t&&t!==e;)t=t.getParent?t.getParent():null;return!!t},getNextSibling:function(){var e=this.getParent();return e&&e.getNextSiblingOfChild?e.getNextSiblingOfChild(this):null},isSiblingWith:function(e){var t=this.getParent(),r=e.getParent&&e.getParent();return t&&r&&t===r},getChildHolder:function(){return this},getChildSubgroupNames:function(){return[]},getBelongChildSubGroupName:function(e){return null},_getPrevSubgroupChildrenCount:function(e){for(var t=this.getChildSubgroupNames(),r=0,n=0,i=t.length;n<i;++n){if(t[n]===e)return r;var o=this._getSubGroupChildCountMethod(t[n]);r+=o&&o.apply(this)||0}return r},_getSubgroupChildIndexInfoFromChildIndex:function(e){for(var t=this.getChildSubgroupNames(),r=0,n=0,i=t.length;n<i;++n){var o=this._getSubGroupChildCountMethod(t[n]),a=o&&o.apply(this)||0;if(e<r+a)return{name:t[n],index:e-r};r+=a}return null},_getSubGroupChildCountMethod:function(e){return this["get"+e.upperFirst()+"Count"]},_getSubGroupChildAtMethod:function(e){return this["get"+e.upperFirst()+"At"]},_getSubGroupChildIndexOfMethod:function(e){return this["indexOf"+e.upperFirst()]},_getSubGroupChildRemoveMethod:function(e){return this["remove"+e.upperFirst()]},_getSubGroupChildRemoveAtMethod:function(e){return this["remove"+e.upperFirst()+"At"]},_getSubGroupChildAppendMethod:function(e){return this["append"+e.upperFirst()]},_getSubGroupChildInsertBeforeMethod:function(e){return this["insert"+e.upperFirst()+"Before"]},_getSubGroupChildInsertAtMethod:function(e){return this["insert"+e.upperFirst()+"At"]},_ensureSubGroupChildMethodsExist:function(){for(var e=["_getSubGroupChildCountMethod","_getSubGroupChildAtMethod","_getSubGroupChildIndexOfMethod","_getSubGroupChildRemoveMethod","_getSubGroupChildRemoveAtMethod","_getSubGroupChildInsertBeforeMethod","_getSubGroupChildInsertAtMethod"],t=this.getChildSubgroupNames(),r=0,n=t.length;r<n;++r)for(var i=0,o=e.length;i<o;++i)this[e[i]].apply(this,[t[r]])||d.warn("Subgroup child method not exisits: "+e[i]+" / "+this.getClassName())},getChildCount:function(){var e=this.getChildHolder();return e&&e!==this?e.getChildCount():this.doGetChildCount()},doGetChildCount:function(){for(var e=0,t=this.getChildSubgroupNames(),r=0,n=t.length;r<n;++r){var i=this._getSubGroupChildCountMethod(t[r]);i&&(e+=i.apply(this))}return e},getChildAt:function(e){var t=this.getChildHolder();return t&&t!==this?t.getChildAt(e):this.doGetChildAt(e)},doGetChildAt:function(e){var t=this._getSubgroupChildIndexInfoFromChildIndex(e);if(t){var r=this._getSubGroupChildAtMethod(t.name);return r&&r.apply(this,[t.index])}return null},indexOfChild:function(e){var t=this.getChildHolder();return t&&t!==this?t.indexOfChild(e):this.doIndexOfChild(e)},doIndexOfChild:function(e){for(var t=this.getChildSubgroupNames(),r=0,n=t.length;r<n;++r){var i=this._getSubGroupChildIndexOfMethod(t[r]);if(i){var o=i.apply(this,[e]);if(o>=0)return this._getPrevSubgroupChildrenCount(t[r])+o}}return-1},hasChild:function(e){return this.indexOfChild(e)>=0},filterChildren:function(e,t){for(var r=[],n=0,i=this.getChildCount();n<i;++n){var o=this.getChildAt(n);if(o)if(e(o,n))r.push(o);else if(t&&o.filterChildren){var a=o.filterChildren(e,t);a&&a.length&&(r=r.concat(a))}}return r},iterateChildren:function(e,t){for(var r=0,n=this.getChildCount();r<n;++r){var i=this.getChildAt(r);i&&(e(i,r),t&&i.iterateChildren&&i.iterateChildren(e,t))}},removeChildAt:function(e){return this.doRemoveChildAt(e)},doRemoveChildAt:function(e){var t=this._getSubgroupChildIndexInfoFromChildIndex(e);if(t){var r=this._getSubGroupChildRemoveAtMethod(t.name);return r&&r.apply(this,[t.index])}return null},removeChild:function(e){var t=this.getChildHolder();return t&&t!==this?t.removeChild(e):this.doRemoveChild(e)},doRemoveChild:function(e){for(var t,r=this.getChildSubgroupNames(),n=0,i=r.length;n<i;++n){var o=this._getSubGroupChildRemoveMethod(r[n]);if(o&&(t=o.apply(this,[e])))return t}return null},removeChildren:function(e){for(var t=e.length-1;t>=0;--t)this.removeChild(e[t])},insertChildAt:function(e,t){var r=this.getChildHolder();return r&&r!==this?r.insertChildAt(e,t):this.doInsertChildAt(e,t)},doInsertChildAt:function(e,t){if(t>=this.getChildCount())return this.appendChild(e);var r=this._getSubgroupChildIndexInfoFromChildIndex(t);if(r){var n=this._getSubGroupChildInsertAtMethod(r.name);if(n){var i=n.apply(this,[e,r.index]);if(i>=0)return this._getPrevSubgroupChildrenCount(r.name)+i}}return-1},insertBefore:function(e,t){return this.insertChildBefore(e,t)},insertChildBefore:function(e,t){var r=this.getChildHolder();return r&&r!==this?r.insertChildBefore(e,t):this.doInsertChildBefore(e,t)},doInsertChildBefore:function(e,t){var r=this.getBelongChildSubGroupName(e);if(!r)return-1;if(t&&r!==this.getBelongChildSubGroupName(t))return-1;this.getChildSubgroupNames();var n=this._getSubGroupChildInsertBeforeMethod(r);return n?this._getPrevSubgroupChildrenCount(r)+n.apply(this,[e,t]):-1},appendChild:function(e){return this.insertChildBefore(e,null)},appendChildren:function(e){for(var t=0,r=e.length;t<r;++t)this.appendChild(e[t])},cascadeOnChildren:function(e){if(!e)return this;for(var t=0,r=this.getChildCount();t<r;++t){var n=this.getChildAt(t);n.cascadeOnChildren&&n.cascadeOnChildren(e),e(n)}return this},cascade:function(e){return e?(this.cascadeOnChildren(e),e(this),this):this},indexStackOfChild:function(e){var t=e.getParentList&&e.getParentList(),r=-1;if(t&&t.length&&(r=t.indexOf(this)),r<0)return null;for(var n,i=[],o=this,a=r-1;a>=0;--a){var s=t[a];if(!((n=o.indexOfChild(s))>=0))return null;i.push(n),o=s}return(n=o.indexOfChild(e))>=0?(i.push(n),i):null},getChildAtIndexStack:function(e){if(!e)return null;if((e=d.ArrayUtils.toArray(e)).length<=0)return null;for(var t=this.getChildAt(e[0]),r=1,n=e.length;r<n;++r){if(!t||!t.getChildAt)return null;t=t.getChildAt(e[r])}return t},isEmpty:function(){return!1},clearIds:function(){this.setId(void 0);for(var e=0,t=this.getChildCount();e<t;++e){var r=this.getChildAt(e);r.clearIds&&r.clearIds()}},assignTo:function(e,t){var r=this.tryApplySuper("assignTo",[e]);return!t&&e.clearIds&&e.clearIds(),r},assign:function(e,t){return e.assignTo(this,t)},clone:function(e){var t=new(this.getClass());return this.assignTo(t,e),t},getScalarAttribCount:function(){var e=this.getScalarAttribs();return e?e.length:0},getScalarAttribAt:function(e){var t=this.getScalarAttribs();return t?t[e]:null},appendScalarAttrib:function(e){this.getScalarAttribs()||this.setPropStoreFieldValue("scalarAttribs",[]);var t=d.ArrayUtils.pushUniqueEx(this.getScalarAttribs(),e);return t.isPushed&&(e.setParent(this),this.notifyScalarAttribsChange()),t.index},removeScalarAttribAt:function(e){if(this.getScalarAttribs()){var t=d.ArrayUtils.removeAt(this.getScalarAttribs(),e);return t&&(t.setParent(null),this.notifyScalarAttribsChange()),t}return null},removeScalarAttrib:function(e){if(this.getScalarAttribs()){var t=d.ArrayUtils.remove(this.getScalarAttribs(),e);return t&&(t.setParent(null),this.notifyScalarAttribsChange()),t}return null},getInfoKeys:function(){return this.getInfo()?d.ObjUtils.getOwnedFieldNames(this.getInfo()):[]},getInfoValue:function(e){return this.getInfo()?this.getInfo()[e]:null},setInfoValue:function(e,t){this.doGetInfo(!0)[e]=t,this.notifyInfoChange()},getContainerBox:function(e,t){if(this.getAbsCoordOfMode){var r=this.getAbsCoordOfMode(e,t)||{},n=r;if(this.getSizeOfMode){var i=this.getSizeOfMode(e,t)||{};n=e===d.CoordMode.COORD3D?d.CoordUtils.add(r,this.getSizeOfMode(e,t)||{}):{x:r.x+i.x,y:r.y-i.y}}return d.BoxUtils.createBox(r,n)}return null},equal:function(e,t){return 0===this.compare(e,t)},compare:function(e,t){if(e===this)return 0;if(!e)return 1;var r,n=this.doGetActualCompareOptions(t);return 0===(r=n.customMethod?n.customMethod(this,e,n):this.doCompare(e,n))?0:r<0?-1:1},doGetActualCompareOptions:function(e){return e||{}},doCompare:function(e,t){if(e===this)return 0;if(this.getClass()!==(e.getClass&&e.getClass()))return this.getClassName()<(e.getClassName&&e.getClassName()||"")?-1:1;var r=this.doCompareOnProperties(e,t);if(!r&&t.extraComparisonProperties)for(var n=0,i=t.extraComparisonProperties.length;n<i;++n){var o=t.extraComparisonProperties[n];if(this.hasProperty(o)&&e.hasProperty&&e.hasProperty(o)){var a=this.getPropValue(o),s=e.getPropValue(o);if(!(r=this.doCompareOnValue(a,s,t)))break}}return r},doCompareOnProperties:function(e,t){var r;t.properties?r=t.properties:(r=this.doGetComparisonPropNames(t))||(r=this.doGetDefaultComparisonPropNames());for(var n=0,i=0,o=r.length;i<o;++i)if(0!==(n=this.doCompareProperty(e,r[i],t)))return n;return 0},doGetComparisonPropNames:function(e){return null},doGetDefaultComparisonPropNames:function(){for(var e=[],t=this.getPropListOfScopes([Class.PropertyScope.PUBLIC,Class.PropertyScope.PUBLISHED]),r=0,n=t.getLength();r<n;++r){var i=t.getPropInfoAt(r);e.push(i.name)}return e},doCompareProperty:function(e,t,r){var n=e.getPropValue&&e.getPropValue(t),i=this.getPropValue(t);return i===n?0:this.doCompareOnValue(i,n,r)},doCompareOnValue:function(e,t,r){return d.ObjComparer._compareValue(e,t,r)},attachCoordStickNodes:function(e){var t=d.ArrayUtils,r=t.toArray(e),n=this.getAttachedCoordStickNodes();return t.pushUnique(n,r),this},detachCoordStickNodes:function(e){for(var t=d.ArrayUtils,r=t.toArray(e),n=this.getAttachedCoordStickNodes(),i=0,o=r.length;i<o;++i)t.remove(n,r[i]);return this}}),d.Scalar=Class.create(d.ChemObject,{CLASS_NAME:"Kekule.Scalar",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e]),t&&this.setName(t),void 0!==r&&this.setValue(r),n&&this.setUnit(n)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("value",{dataType:DataType.PRIMARY}),this.defineProp("errorValue",{dataType:DataType.PRIMARY}),this.defineProp("unit",{dataType:DataType.STRING}),this.defineProp("title",{dataType:DataType.STRING})}}),d.ChemObjList=Class.create(d.ChemObject,{CLASS_NAME:"Kekule.ChemObjList",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("itemBaseClass",t),this.setPropStoreFieldValue("items",[]),this._transparent=!!r},initProperties:function(){this.defineProp("itemBaseClass",{dataType:DataType.CLASS,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("items",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("items");return!t&&e&&(t=[],this.setPropStoreFieldValue("items",t)),t}})},loaded:function(){this.ownerChanged(this.getOwner()),this.parentChanged(this.getParent()),this.tryApplySuper("loaded")},parentChanged:function(e,t){this.changeAllItemsParent(),this.tryApplySuper("parentChanged",[e,t])},isEmpty:function(){return this.getItemCount()<=0},isValidItemType:function(e){var t=this.getItemBaseClass();return!t||e instanceof t},checkItemType:function(e){var t=this.isValidItemType(e);return t||d.raise(d.$L("ErrorMsg.LIST_ITEM_CLASS_MISMATCH")),t},notifyItemsChange:function(){this.notifyPropSet("items",this.getPropStoreFieldValue("items"))},getItemOwner:function(){return this.getOwner()},changeAllItemsOwner:function(){var e=this.getItems();if(e)for(var t=this.getItemOwner(),r=0,n=e.length;r<n;++r){var i=e[r];i&&i.setOwner&&i.setOwner(t)}},getItemParent:function(){return this._transparent&&this.getParent()||this},changeAllItemsParent:function(){var e=this.getItems();if(e)for(var t=this.getItemParent(),r=0,n=e.length;r<n;++r){var i=e[r];i&&i.setParent&&i.setParent(t)}},getItemCount:function(){var e=this.getPropStoreFieldValue("items");return e?e.length:0},getItemAt:function(e){var t=this.getPropStoreFieldValue("items");return t?t[e]:null},indexOf:function(e){var t=this.getPropStoreFieldValue("items");return t?t.indexOf(e):-1},indexOfItem:function(e){return this.indexOf(e)},getNextSiblingOfChild:function(e){var t=this.indexOf(e);return t>=0?this.getItemAt(t+1):null},getChildSubgroupNames:function(){return["item"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return this.isValidItemType(e)?"item":this.tryApplySuper("getBelongChildSubGroupName",[e])},append:function(e){if(this.checkItemType(e),e){var t=d.ArrayUtils.pushUniqueEx(this.doGetItems(!0),e);return t.isPushed&&(this.notifyItemsChange(),e.setOwner&&e.setOwner(this.getItemOwner()),e.setParent&&e.setParent(this.getItemParent())),t.index}return-1},insert:function(e,t){if(this.checkItemType(e),e){var r=d.ArrayUtils.insertUniqueEx(this.doGetItems(!0),e,t);return r.isInserted&&(this.notifyItemsChange(),e.setOwner&&e.setOwner(this.getItemOwner()),e.setParent&&e.setParent(this.getItemParent())),r.index}return-1},insertItemAt:function(e,t){return this.insert(e,t)},insertItemBefore:function(e,t){if(t){var r=this.indexOfItem(t);return r>=0?this.insertItemAt(e,r):this.appendItem(e)}return this.append(e)},removeAt:function(e){if(this.getItems()){var t=d.ArrayUtils.removeAt(this.getItems(),e);return t&&(t.setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this.notifyItemsChange()),t}},removeItemAt:function(e){return this.removeAt(e)},remove:function(e){if(this.getItems()){var t=d.ArrayUtils.remove(this.getItems(),e);return t&&(t.setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this.notifyItemsChange()),t}},removeItem:function(e){return this.remove(e)},toArray:function(){return this.getItems()||[]},getContainerBox:function(e,t){for(var r,n=this.toArray(),i=0,o=n.length;i<o;++i){var a=n[i],s=a.getContainerBox?a.getContainerBox(e,t):null;s&&(r=r?d.BoxUtils.getContainerBox(r,s):d.BoxUtils.clone(s))}return r}}),d.ChemSpaceElement=Class.create(d.ChemObject,{CLASS_NAME:"Kekule.ChemSpaceElement",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=new d.ChemObjList(null,d.ChemObject,!0);t.setParent(this),t.addEventListener("change",(function(){this.objectChange(["children"])}),this),this.setPropStoreFieldValue("children",t)},initProperties:function(){this.defineProp("children",{dataType:"Kekule.ChemObjList",scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getChildren();t&&t.finalize(),e&&(e.setParent(this),e.setOwner(this.getOwner()),e._transparent=!0),this.setPropStoreFieldValue("children",e)}})},loaded:function(){var e=this.getChildren();e&&(e.parentChanged(this),e.ownerChanged(this.getOwner())),this.tryApplySuper("loaded")},ownerChanged:function(e,t){this.getChildren().setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){var t=this.indexOfChild(e);t>=0&&this.removeChildAt(t),this.tryApplySuper("_removeChildObj",[e])},getChildHolder:function(){return this.getChildren()},getNextSiblingOfChild:function(e){return this.getChildren().getNextSiblingOfChild(e)},insertChild:function(e,t){return this.getChildren().insert(e,t)}}),d.ChemSpace=Class.create(d.ChemObject,{CLASS_NAME:"Kekule.ChemSpace",initialize:function(e){this.tryApplySuper("initialize",[e]),this._autoIdMap={},this._enableObjRefRelations=!0,this._autoUpdateObjRefRelations=!0,this.setPropStoreFieldValue("enableAutoId",!0),this.setPropStoreFieldValue("ownedObjs",[]);var t=new d.ChemSpaceElement;this.setPropStoreFieldValue("root",t),this.setPropStoreFieldValue("objRefRelationManager",new d.ObjRefRelationManager(this)),t.setParent(this),t.setOwner(this)},initProperties:function(){this.defineProp("ownedObjs",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("root",{dataType:"Kekule.ChemSpaceElement",setter:null}),this.defineProp("enableAutoId",{dataType:DataType.BOOL}),this.defineProp("objScreenLengthRatio",{dataType:DataType.FLOAT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("screenSize",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("screenSize")||{};return{x:e.x,y:e.y}},setter:function(e){var t=this.getPropStoreFieldValue("screenSize");t||(t={},this.setPropStoreFieldValue("screenSize",t)),t.x=e.x,t.y=e.y}}),this.defineProp("objRefRelationManager",{dataType:"Kekule.ObjRefRelationManager",serializable:!1,scope:Class.PropertyScope.PRIVATE,setter:null})},loaded:function(){var e=this.getRoot();e&&(e.setParent(this),e.setOwner(this)),this.tryApplySuper("loaded"),this.notifyOwnerLoaded()},notifyOwnedObjsChange:function(){this.notifyPropSet("ownedObjs",this.getPropStoreFieldValue("ownedObjs"))},_notifyOwnedObjsSpaceUpdate:function(e,t,r){for(var n=0,i=this.getOwnedObjCount();n<i;++n){var o=this.getOwnedObjAt(n);o&&o.objSpaceOfOwnerUpdated&&o.objSpaceOfOwnerUpdated(e,t,r)}if(this._enableObjRefRelations&&this._autoUpdateObjRefRelations&&r===d.ObjectTreeOperation.REMOVE){var a=d.ArrayUtils,s=this.findObjRefRelations({dest:e})||[];for(n=0,i=s.length;n<i;++n){var l=s[n];if(l.srcProp.autoUpdate){var u=l.dest,c=a.isArray(u)?a.exclude(u,[e]):null;l.srcObj.setPropValue(l.srcProp.name,c)}}}},notifyOwnerLoaded:function(){for(var e=this.getOwnedObjs()||[],t=0,r=e.length;t<r;++t){var n=e[t];n&&n._ownerObjectLoaded&&n._ownerObjectLoaded(this)}},getChildren:function(){return this.getRoot().getChildren().toArray()},getChildHolder:function(){return this.getRoot()},getNextSiblingOfChild:function(e){return this.getRoot().getNextSiblingOfChild(e)},insertChild:function(e,t){return this.getRoot().insertChild(e,t)},indexStackOfChild:function(e){return this.getRoot().indexStackOfChild(e)},getChildAtIndexStack:function(e){return this.getRoot().getChildAtIndexStack(e)},getObjById:function(e){for(var t=0,r=this.getOwnedObjCount();t<r;++t){var n=this.getOwnedObjAt(t);if(n.getId&&n.getId()===e)return n}return null},getAutoId:function(e,t){e&&e.getAutoIdPrefix&&e.getAutoIdPrefix();var r=e.getAutoIdPrefix?e.getAutoIdPrefix():"o";n=d.ObjUtils.notUnset(t)?t:1;var n=this._getAutoIdIndex(r,n);return this._autoIdMap[r]=n,r+Number(n).toString()},_getAutoIdIndex:function(e,t){for(var r=t||0,n=e+Number(r).toString();this.getObjById(n);)++r,n=e+Number(r).toString();return r},assignAutoIdToObj:function(e){if(e.setId){var t=this.getAutoId(e);e.setId(t)}},getOwnedObjCount:function(){return this.getOwnedObjs().length},getOwnedObjAt:function(e){return this.getOwnedObjs()[e]},indexOfOwnedObj:function(e){return this.getOwnedObjs().indexOf(e)},_appendOwnedObj:function(e){this.indexOfOwnedObj(e)>=0||(this.getEnableAutoId()&&e.getId&&!e.getId()&&this.assignAutoIdToObj(e),this.getOwnedObjs().push(e),e._registerObjRefRelations&&e._registerObjRefRelations(this),this._notifyOwnedObjsSpaceUpdate(e,this,d.ObjectTreeOperation.ADD),this.notifyOwnedObjsChange())},_removeOwnedObjAt:function(e){var t=this.getOwnedObjAt(e);t&&(this.getOwnedObjs().splice(e,1),t._unregisterObjRefRelations&&t._unregisterObjRefRelations(this),this._notifyOwnedObjsSpaceUpdate(t,this,d.ObjectTreeOperation.REMOVE),this.notifyOwnedObjsChange())},_removeOwnedObj:function(e){var t=this.getOwnedObjs().indexOf(e);t>=0&&this._removeOwnedObjAt(t)},_notifyObjTreeOperation:function(e,t,r){for(var n=0,i=this.getOwnedObjCount();n<i;++n){var o=this.getOwnedObjAt(n);o.objTreeOfOwnerUpdated&&o.objTreeOfOwnerUpdated(e,t,r)}},getObjRefRelations:function(){return this._enableObjRefRelations?this.getObjRefRelationManager().getRelations():null},createObjRefRelation:function(e,t,r){return this._enableObjRefRelations?this.getObjRefRelationManager().createRelation(e,t,r):null},modifyObjRefRelation:function(e,t,r){return this._enableObjRefRelations?this.getObjRefRelationManager().modifyRelation(e,t,r):null},getObjRefRelationIndex:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().getRelationIndex(e,t):-1},getObjRefRelation:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().getRelation(e,t):null},releaseObjRefRelation:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().releaseRelation(e,t):null},findObjRefRelations:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().findRelations(e,t):[]}}),d.ClassDefineUtils.addStandardSizeSupport(d.ChemSpace),d.IntermediateChemSpace=Class.create(d.ChemSpace,{CLASS_NAME:"Kekule.IntermediateChemSpace",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("enableAutoId",!1),this._enableObjRefRelations=!1,this._autoUpdateObjRefRelations=!1}}),d.ChemDocument=Class.create(d.ChemSpace,{CLASS_NAME:"Kekule.ChemDocument",initProperties:function(){},getAutoIdPrefix:function(){return"d"}}),d.ObjRefRelationManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ObjRefRelationManager",initialize:function(e){this.tryApplySuper("initialize"),this.setOwner(e),this.setPropStoreFieldValue("relations",[])},initProperties:function(){this.defineProp("owner",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("relations",{dataType:DataType.ARRAY,serializable:!1,setter:null})},createRelation:function(e,t,r){var n={srcObj:e,srcProp:t,dest:r};return this.getRelations().push(n),n},modifyRelation:function(e,t,r){var n=!r||d.ArrayUtils.isArray(r)&&!r.length,i=this.getRelation(e,t);return n?(i&&this.removeRelation(i),null):(i?i.dest=r:i=this.createRelation(e,t,r),i)},getRelationIndex:function(e,t){for(var r=this.getRelations(),n=0,i=r.length;n<i;++n){var o=r[n];if(o.srcObj===e&&o.srcProp===t)return n}return-1},getRelation:function(e,t){var r=this.getRelations(),n=this.getRelationIndex(e,t);return n>=0?r[n]:null},releaseRelation:function(e,t){var r=this.getRelations(),n=this.getRelationIndex(e,t);n>=0&&r.splice(n,1)},removeRelation:function(e){var t=this.getRelations(),r=t.indexOf(e);r>=0&&t.splice(r,1)},findRelations:function(e,t){var r,n=t||{},i=[],o=Object.extend({},e),a=!1;o.dest&&(delete o.dest,a=!0,r=d.ArrayUtils.toArray(e.dest));for(var s=this.getRelations(),l=0,u=s.length;l<u;++l){var c=s[l],h=!1;if((h=d.ObjUtils.match(c,o))&&a){var p=d.ArrayUtils.toArray(c.dest);h=n.checkDestChildren?this._hasChildOrSelfOfParents(p,r):d.ArrayUtils.intersect(p,r).length===r.length}h&&i.push(c)}return i},_hasChildOrSelfOfParents:function(e,t){for(var r=0,n=e.length;r<n;++r)for(var i=e[r],o=0,a=t.length;o<a;++o){var s=t[o];if(i===s||i.isChildOf&&i.isChildOf(s))return!0}return!1}})}(),d.ExceptionHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ExceptionHandler",initProperties:function(){this.defineEvent("exceptionThrown")},notifyExceptionThrown:function(e,t){var r={exception:e,level:t};return this.invokeEvent("exceptionThrown",r),r},throwException:function(e,t){var r=d.ExceptionLevel;if(t||(t=r.ERROR),!this.notifyExceptionThrown(e,t||r.ERROR).stop){if(!t||t===r.ERROR){var n=e;throw"string"==typeof e&&(n=new d.Exception(e)),n}if("undefined"!=typeof console){"string"!=typeof e&&(e=e.message);var i=t===r.NOT_FATAL_ERROR?"error":t===r.WARNING?"warn":t===r.NOTE?"info":"log";i?console[i](e):console.log(e)}}},raise:function(e,t){return this.throwException(e,t||d.ExceptionLevel.ERROR)}}),d.ExceptionHandler.getInstance=function(){return this.instance||(this.instance=new d.ExceptionHandler),this.instance},d.exceptionHandler=d.ExceptionHandler.getInstance(),d.Exception=function(e,t){this.message=e,this.name=t},d.Exception.prototype=new Error,d.Exception.prototype.constructor=d.Exception,Object.extend(d.Exception.prototype,{getMessage:function(){return this.message}}),d.Error=function(e,t){this.message=e,this.name=t},d.Error.prototype=d.Exception.prototype,d.Error.prototype.constructor=d.Error,d.ChemError=function(e,t){this.message=e,this.name=t},d.ChemError.prototype=d.Error.prototype,d.ChemError.prototype.constructor=d.ChemError,"undefined"==typeof console&&(console={log:function(){},warn:function(){},info:function(){},error:function(){}}),d.oneOf=function(){for(var e=arguments,t=d.ObjUtils.notUnset,r=0,n=e.length;r<n;++r)if(t(e[r]))return e[r];return null},d.ClassUtils={getShortClassName:function(e){var t=e.indexOf(".");return t>=0?e.substring(t+1):e},getLastClassName:function(e){var t=e.lastIndexOf(".");return t>=0?e.substring(t+1):e},makeSingleton:function(e){return Object.extend(e,{_instance:null,getInstance:function(t,r,n,i,o,a,s,l,d,u){return e._instance||(e._instance=new e(t,r,n,i,o,a,s,l,d,u)),e._instance}})}},d.NumUtils={isInteger:function(e){return"number"==typeof e&&parseInt(e,10)===parseFloat(e)},toDecimals:function(e,t){if(d.NumUtils.isInteger(e))return e.toString();var r=Math.pow(10,t),n=Math.round(e*r);n/=r;var i=parseInt(n),o=(n-i).toString();return o.length>t+2?(o=o.substr(2,t),i.toString()+"."+o):n.toString()},isFloatEqual:function(e,t,r){return d.ObjUtils.isUnset(r)&&(r=1e-15*Math.min(Math.abs(e),Math.abs(t))),Math.abs(e-t)<=r},compareFloat:function(e,t,r){return d.NumUtils.isFloatEqual(e,t,r)?0:e<t?-1:1},getPrimes:function(e){var t,r,n=[],i=[];for(t=2;t<=e;++t)if(!n[t])for(i.push(t),r=t<<1;r<=e;r+=t)n[r]=!0;return i}},d.ObjUtils={getPrototypeOf:function(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.prototype||e.__proto__},getPropertyDescriptor:function(e,t,r){var n=Object.getOwnPropertyDescriptor;if(n){var i=n(e,t);return!i&&r&&(e.prototype||e.__proto__)&&(i=d.ObjUtils.getPropertyDescriptor(e.prototype||e.__proto__,t,r)),i}return null},getOwnedFieldNames:function(e,t){var r=[];for(var n in e)e.hasOwnProperty(n)&&(t||"function"!=typeof e[n])&&r.push(n);return r},replacePropName:function(e,t,r){return void 0!==e[t]&&(e.hasOwnProperty(t)?(e[r]=e[t],delete e[t]):d.raise(d.$L("ErrorMsg.NON_OWN_PROPERTY_CANNOT_BE_REPLACED"))),e},isUnset:function(e){return null==e},notUnset:function(e){return null!=e},equal:function(e,t,r){var n=[];for(var i in e)if(!(r&&r.indexOf(i)>=0)){if(e[i]!==t[i])return!1;n.push(i)}for(var i in t)if(!(r&&r.indexOf(i)>=0)&&n.indexOf(i)<0)return!1;return!0},match:function(e,t){var r=e instanceof ObjectEx;for(var n in t)if(t.hasOwnProperty(n)&&(r?e.getPropValue(n):e[n])!==t[n])return!1;return!0},isInstanceOf:function(e,t){if(DataType.isArrayValue(t)){for(var r=0,n=t.length;r<n;++r)if(e instanceof t[r])return!0;return!1}return e instanceof t},getLeafFieldCascadeNames:function(e,t){var r=[];return function e(t,r,n,i){for(var o in n)if(n.hasOwnProperty(o)&&(i||"function"!=typeof n[o])){var a=n[o];"object"==typeof a?e(t,r+o+".",a,i):t.push(r+o)}}(r,"",e,t),r}},d.ArrayUtils={isArray:function(e){return!!e&&"object"==typeof e&&void 0!==e.length},toArray:function(e){return d.ArrayUtils.isArray(e)?e:[e]},clone:function(e){return e.slice(0)},filter:function(e,t,r){if(!t)return d.ArrayUtils.clone(e);if(e.filter)return e.filter(t,r);for(var n=[],i=0,o=e.length;i<o;++i){var a=e[i];t.apply(r,[a,i,e])&&n.push(a)}return n},divide:function(e,t){for(var r=[],n=[],i=0,o=0,a=e.length;o<a;++o)n.push(e[o]),++i>=t&&(r.push(n),n=[],i=0);return n.length&&r.push(n),r},pushUnique:function(e,t){var r=d.ArrayUtils.pushUniqueEx(e,t);return r?r.index:null},pushUniqueEx:function(e,t){if(DataType.isArrayValue(t)){for(var r,n=0,i=t.length;n<i;++n)d.ObjUtils.isUnset(r)?r=d.ArrayUtils.pushUniqueEx(e,t[n]):d.ArrayUtils.pushUniqueEx(e,t[n]);return r}if(!t)return{index:-1,isPushed:!1};var o=e.indexOf(t);return o<0?{index:e.push(t),isPushed:!0}:{index:o,isPushed:!1}},insertUnique:function(e,t,r){return d.ArrayUtils.insertUniqueEx(e,t,r).index},insertUniqueEx:function(e,t,r){if(!t)return{index:-1,isInserted:!1};(d.ObjUtils.isUnset(r)||r<0)&&(r=e.length);var n=e.indexOf(t);return n<0?(e.splice(r,0,t),{index:r,isInserted:!0}):n!=r?(e.splice(n,1),e.splice(r,0,t),{index:r,isInserted:!1}):void 0},removeAt:function(e,t){var r=e[t];return void 0!==r?(e.splice(t,1),r):null},remove:function(e,t,r){var n=e.indexOf(t);return n>=0?(d.ArrayUtils.removeAt(e,n),r&&d.ArrayUtils.remove(e,t,r),t):null},replace:function(e,t,r,n){var i=e.indexOf(t);return i>=0?(e[i]=r,n&&d.ArrayUtils.replace(e,t,r,n),t):null},changeIndex:function(e,t,r){if(t>=0&&t<=e.length){var n=e[t];return e.splice(t,1),e.splice(r,0,n),n}return null},changeItemIndex:function(e,t,r){var n=e.indexOf(t);return d.ArrayUtils.changeIndex(e,n,r)},toUnique:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r];t.indexOf(i)<0&&t.push(i)}return t},getUniqueElemCount:function(e){return d.ArrayUtils.toUnique(e).length},reverse:function(e){for(var t=[],r=0,n=e.length;r<n;++r)d.ObjUtils.notUnset(e[r])&&(t[n-r-1]=e[r]);return t},randomize:function(e){if(!e)return null;if(!e.length)return[];for(var t=[],r=e.slice(0);r.length>1;){var n=Math.round(Math.random()*(r.length-1));t.push(r.splice(n,1)[0])}return t.push(r[0]),t},exclude:function(e,t){for(var r=[],n=d.ArrayUtils.toArray(t),i=0,o=e.length;i<o;++i){var a=e[i];n.indexOf(a)<0&&r.push(a)}return r},intersect:function(e,t){for(var r=[],n=0,i=e.length;n<i;++n)t.indexOf(e[n])>=0&&r.push(e[n]);return r},flatten:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r];if(d.ArrayUtils.isArray(i)){var o=d.ArrayUtils.flatten(i);t=t.concat(o)}else t.push(i)}return t},compare:function(e,t,r){r||(r=function(e,t){return e>t?1:e<t?-1:0});for(var n=Math.min(e.length,t.length),i=0;i<n;++i){var o=r(e[i],t[i]);if(0!==o)return o}return e.length>n?1:t.length>n?-1:0},compareNestedArray:function(e,t,r){var n=Math.min(e.length,t.length);r||(r=function(e,t){return e-t});for(var i=0;i<n;++i){var o,a=e[i],s=t[i],l=DataType.isArrayValue(a),u=DataType.isArrayValue(s);if(0!=(o=l&&u?d.ArrayUtils.compareNestedArray(a,s,r):l?1:u?-1:r(a,s)))return o}return e.length>n?1:t.length>n?-1:0},group:function(e,t){t||(t=function(e,t){return e<t?-1:e>t?1:0});var r=d.ArrayUtils.clone(e);r.sort(t);for(var n,i=[],o=0,a=r.length;o<a;++o){var s=r[o];if(n&&0===t(s,n)){var l=i.length?i[i.length-1]:null;d.ArrayUtils.isArray(l)||(i.pop(),l=[n],i.push(l)),l.push(s)}else i.push(s);n=s}return i},indexStackOfElem:function(e,t){for(var r=0,n=t.length;r<n;++r){var i=t[r];if(i===e)return[r];if(d.ArrayUtils.isArray(i)){var o=d.ArrayUtils.indexStackOfElem(e,i);if(o)return o.unshift(r),o}}return null},getElemByIndexStack:function(e,t){var r=d.ArrayUtils.isArray(t)?d.ArrayUtils.clone(t):[t],n=e[r.shift()];return n?r.length?d.ArrayUtils.isArray(n)?d.ArrayUtils.getElemByIndexStack(n,r):null:n:null},getMedian:function(e){var t=[].concat(e),r=t.length;return 0===r?null:r<=1?t[0]:(t.sort((function(e,t){return e-t})),r%2?t[r+1>>1]:(t[r>>1]+t[(r>>1)-1])/2)},sortHashArray:function(e,t){for(var r=[],n=0,i=t.length;n<i;++n){var o={},a=t[n]||"";a.startsWith("!")?(o.field=a.substr(1),o.desc=!0):(o.field=a,o.desc=!1),r.push(o)}return e.sort((function(e,t){for(var n=0,i=0,o=r.length;i<o;++i){var a=r[i].field,s=e[a]||"",l=t[a]||"";if(n=s>l?1:s<l?-1:0,r[i].desc&&(n=-n),0!==n)break}return n})),e}},d.StrUtils={STR_TRUES:["true","yes","t","y"],STR_FALSES:["false","no","f","n"],trim:function(e){return e.replace(/^\s*|\s*$/g,"")},normalizeSpace:function(e){return e.replace(/^\s*|\s(?=\s)|\s*$/g,"")},convertToStr:function(e){return""+e},convertToType:function(e,t){if("string"!=typeof e)return e;switch(t){case DataType.FLOAT:case DataType.NUMBER:return parseFloat(e);case DataType.INT:return parseInt(e);case DataType.BOOL:return d.StrUtils.strToBool(e);default:return e}},boolToStr:function(e){return e?d.StrUtils.STR_TRUES[0]:d.StrUtils.STR_FALSES[0]},strToBool:function(e){for(var t=e.toLowerCase(),r=0,n=d.StrUtils.STR_FALSES.length;r<n;++r)if(t==d.StrUtils.STR_FALSES[r])return!1;return!!e},removeAroundPair:function(e,t,r){return e.startsWith(t)&&e.endsWith(r)?e.substring(t.length,e.length-t.length-r.length+1):e},unquote:function(e){var t=d.StrUtils.removeAroundPair,r=e;return r=t(r,"'","'"),t(r,'"','"')},splitTokens:function(e,t){if(!e)return[];if(DataType.isArrayValue(e))return e;var r=t?new RegExp(t,"g"):/\s+/g;return e.split(r)},hasToken:function(e,t,r){return d.StrUtils.splitTokens(e,r).indexOf(t)>=0},addTokens:function(e,t,r){for(var n=d.StrUtils.splitTokens(e,r),i=d.StrUtils.splitTokens(t,r),o=0,a=i.length;o<a;++o)n.indexOf(i[o])<0&&n.push(i[o]);return n.join(r||" ")},removeTokens:function(e,t,r){for(var n=d.StrUtils.splitTokens(e,r),i=d.StrUtils.splitTokens(t,r),o=0,a=i.length;o<a;++o){var s=n.indexOf(i[o]);s>=0&&n.splice(s,1)}return n.join(r||" ")},toggleTokens:function(e,t,r){for(var n=d.StrUtils.splitTokens(e,r),i=d.StrUtils.splitTokens(t,r),o=[],a=0,s=i.length;a<s;++a){var l=n.indexOf(i[a]);l>=0?n.splice(l,1):o.push(i[a])}return(n=n.concat(o)).join(r||" ")},getLineCount:function(e,t){return t||(t="\n"),e.split(t).length},getMaxLineCharCount:function(e,t){t||(t="\n");for(var r=e.split(t),n=0,i=0,o=r.length;i<o;++i){var a=r[i];n=Math.max(a.length,n)}return n},isNumbericStr:function(e){var t=Number(e);return!isNaN(t)},splitIndexEndingStr:function(e){for(var t=e.length-1,r=e.charAt(t),n="";r&&d.StrUtils.isNumbericStr(r);)--t,n=r+n,r=e.charAt(t);return n?{prefix:e.substring(0,t+1),index:parseInt(n)}:null}},d.RoleMapUtils={KEY_ITEM:"item",KEY_ROLE:"role",NON_EXPLICIT_ROLE:null,createMap:function(e,t){var r={};return t=t||d.RoleMapUtils.NON_EXPLICIT_ROLE,r[d.RoleMapUtils.KEY_ITEM]=e,r[d.RoleMapUtils.KEY_ROLE]=t,r},getItem:function(e){return e[d.RoleMapUtils.KEY_ITEM]},setItem:function(e,t){e[d.RoleMapUtils.KEY_ITEM]=t},getRole:function(e){return e[d.RoleMapUtils.KEY_ROLE]},setRole:function(e,t){e[d.RoleMapUtils.KEY_ROLE]=t}},d.FactoryUtils={MATCH_EXACTLY:0,MATCH_BY_CLASS:1,DEF_ITEM_STORE_FIELD_NAME:"_items",createSimpleFactory:function(e){var t=d.FactoryUtils,r={_items:new d.MapEx(!0),_matchMethod:e||d.FactoryUtils.MATCH_EXACTLY,register:function(e,t){r._items.set(e,t)},unregister:function(e){r._items.remove(e)},getClass:function(e){if(r._matchMethod===t.MATCH_EXACTLY)return r._items.get(e);if(r._matchMethod===t.MATCH_BY_CLASS){var n=r._items.get(e);if(!n){var i=ClassEx.getSuperClass(e);i&&(n=r.getClass(i))}return n}},getInstance:function(e,t,n,i,o,a,s,l,d,u){var c=r.getClass(e);if(c)return new c(t,n,i,o,a,s,l,d,u)}};return r}},d.UrlUtils={PROTOCAL_DELIMITER:"://",EXT_DELIMITER:".",PATH_DELIMITER:"/",SEARCH_DELIMITER:"?",SEARCH_PAIR_DELIMITER:"&",KEY_VALUE_DELIMITER:"=",HASH_DELIMITER:"#",normalizePath:function(e){return e.replace(/\\/g,"/")},extractProtocal:function(e){if(!e)return null;var t=e.indexOf(d.UrlUtils.PROTOCAL_DELIMITER);return t>=0?e.substr(0,t):""},extractFileName:function(e){if(!e)return null;var t=e.lastIndexOf(d.UrlUtils.PATH_DELIMITER);return t>=0?e.substr(t+1):e},extractFileExt:function(e){var t=d.UrlUtils.extractFileName(e);if(t){var r=t.lastIndexOf(d.UrlUtils.EXT_DELIMITER);return r>=0?t.substr(r+1):""}return null},extractFileCoreName:function(e){var t=d.UrlUtils.extractFileName(e);if(t){var r=t.lastIndexOf(d.UrlUtils.EXT_DELIMITER);return r>=0?t.substr(0,r):""}return null},extractSearch:function(e){if(!e)return null;var t=e.lastIndexOf(d.UrlUtils.SEARCH_DELIMITER);return t>=0?e.substr(t):null},analysisSearch:function(e,t){for(var r=d.UrlUtils.extractSearch(e)||"",n=(r=r.substr(1)).split(d.UrlUtils.SEARCH_PAIR_DELIMITER),i=t?{}:[],o=0,a=n.length;o<a;++o){var s=n[o].split(d.UrlUtils.KEY_VALUE_DELIMITER);s[0]&&(t?i[s[0]]=s[1]:i.push({key:s[0],value:s[1]}))}return i},generateSearchString:function(e){for(var t=d.UrlUtils,r=[],n=d.ObjUtils.getOwnedFieldNames(e),i=0,o=n.length;i<o;++i){var a=n[i],s=e[a];d.ObjUtils.notUnset(s)&&(s=encodeURIComponent(""+s),r.push(a+t.KEY_VALUE_DELIMITER+s))}return r.join(t.SEARCH_PAIR_DELIMITER)},generateUrl:function(e,t,r){var n=d.UrlUtils,i=e;if(t){var o=n.generateSearchString(t);i+=n.SEARCH_DELIMITER+o}return r&&(i+=n.HASH_DELIMITER+r),i}},d.MatrixUtils={create:function(e,t,r){var n=!1,i=!1,o=d.ObjUtils;o.notUnset(r)&&(n=!0,d.ArrayUtils.isArray(r)&&(i=!0));for(var a=0,s=new Array(e),l=0,u=s.length;l<u;++l){var c=new Array(t);if(n)for(var h=0,p=c.length;h<p;++h)i&&o.notUnset(r[a])?(c[h]=r[a],++a):c[h]=r;s[l]=c}return s},createIdentity:function(e){for(var t=d.MatrixUtils.create(e,e,0),r=0;r<e-1;++r)t[r][r]=1;return t},getRowCount:function(e){return e.length},getColCount:function(e){return d.MatrixUtils.getRowCount(e)>0?e[0].length:0},getValue:function(e,t,r){return e[t-1][r-1]||0},setValue:function(e,t,r,n){e[t-1][r-1]=n},transpose:function(e){for(var t=d.MatrixUtils,r=t.getColCount(e),n=t.getRowCount(e),i=t.create(r,n),o=1;o<=r;++o)for(var a=i[o-1],s=1;s<=n;++s)a[s-1]=t.getValue(e,s,o);return i},minus:function(e){for(var t=d.MatrixUtils,r=t.getRowCount(e),n=t.getColCount(e),i=this.create(r,n),o=0;o<r;++o)for(var a=i[o],s=e[o],l=0;l<n;++l)a[l]=-(s[l]||0);return i},add:function(e,t){for(var r=d.MatrixUtils,n=r.getRowCount(e),i=r.getColCount(e),o=this.create(n,i),a=1;a<=n;++a)for(var s=1;s<=i;++s)r.setValue(o,a,s,r.getValue(e,a,s)+r.getValue(t,a,s));return o},substract:function(e,t){var r=d.MatrixUtils;return r.add(e,r.minus(t))},multiply:function(e,t){for(var r=d.MatrixUtils,n=r.getRowCount(e),i=r.getColCount(t),o=r.create(n,i),a=1;a<=n;++a)for(var s=1;s<=i;++s){for(var l=0,u=1;u<=n;++u)l+=r.getValue(e,a,u)*r.getValue(t,u,s);r.setValue(o,a,s,l)}return o}},d.CoordUtils={create:function(e,t,r){var n={x:e,y:t};return(r||0===r)&&(n.z=r),n},clone:function(e){var t={x:e.x,y:e.y};return(e.z||0===e.z)&&(t.z=e.z),t},is3D:function(e){return e.z||0===e.z},isEqual:function(e,t){var r=e.x===t.x&&e.y===t.y,n=d.ObjUtils;return r&&(n.notUnset(e.z)||n.notUnset(t.z))&&(r=e.z===t.z),r},isZero:function(e,t){var r=d.ObjUtils.notUnset(t)?t:0;return Math.abs(e.x||0)<=r&&Math.abs(e.y||0)<=r&&Math.abs(e.z||0)<=r},absValue:function(e){if(e){var t={};return d.ObjUtils.isUnset(e.x)||(t.x=Math.abs(e.x)),d.ObjUtils.isUnset(e.y)||(t.y=Math.abs(e.y)),d.ObjUtils.isUnset(e.z)||(t.z=Math.abs(e.z)),t}},add:function(e,t){var r={};return d.ObjUtils.isUnset(e.x)&&d.ObjUtils.isUnset(t.x)||(r.x=(e.x||0)+(t.x||0)),d.ObjUtils.isUnset(e.y)&&d.ObjUtils.isUnset(t.y)||(r.y=(e.y||0)+(t.y||0)),d.ObjUtils.isUnset(e.z)&&d.ObjUtils.isUnset(t.z)||(r.z=(e.z||0)+(t.z||0)),r},substract:function(e,t){var r={};return d.ObjUtils.isUnset(e.x)&&d.ObjUtils.isUnset(t.x)||(r.x=(e.x||0)-(t.x||0)),d.ObjUtils.isUnset(e.y)&&d.ObjUtils.isUnset(t.y)||(r.y=(e.y||0)-(t.y||0)),d.ObjUtils.isUnset(e.z)&&d.ObjUtils.isUnset(t.z)||(r.z=(e.z||0)-(t.z||0)),r},multiply:function(e,t){var r={};return d.ObjUtils.isUnset(e.x)||(r.x=e.x*t),d.ObjUtils.isUnset(e.y)||(r.y=e.y*t),d.ObjUtils.isUnset(e.z)||(r.z=e.z*t),r},divide:function(e,t){return d.CoordUtils.multiply(e,1/t)},standardize:function(e){var t=Math.sqrt(Math.sqr(e.x||0)+Math.sqr(e.y||0)+Math.sqr(e.z||0));return d.CoordUtils.divide(e,t||1)},toArray:function(e){var t=[];t.push(e.x,e.y),d.CoordUtils.is3D(e)&&t.push(e.z)},isSameTransform2DOptions:function(e,t,r){var n=d.ObjUtils.isUnset,i=d.NumUtils.isFloatEqual;r||(r={});var o=r.translate||.01,a=r.scale||.01,s=r.rotate||.01,l=!1,u=e.center,c=t.center;if(l=!(!u||!c)&&i(u.x,c.x,o)&&i(u.y,c.y,o))for(var h=["scale","scaleX","scaleY","rotateAngle","translateX","translateY"],p=0,g=h.length;p<g;++p){var f=h[p],m=e[f],C=t[f];if((!n(m)||!n(C))&&!(l=!n(m)&&!n(C)&&i(m,C,0===f.indexOf("scale")?a:0===f.indexOf("rotate")?s:o)))break}return l},isSameTransform3DOptions:function(e,t,r){var n=d.ObjUtils.isUnset,i=d.NumUtils.isFloatEqual;r||(r={});var o=r.translate||.01,a=r.scale||.01,s=r.rotate||.01,l=!1,u=e.center,c=t.center;if(l=u&&c?i(u.x,c.x,o)&&i(u.y,c.y,o)&&i(u.z,c.z,o):!u&&!c){var h=e.rotateAxisVector,p=t.rotateAxisVector;l=h&&p?i(h.x,p.x,o)&&i(h.y,p.y,o)&&i(h.z,p.z,o):!h&&!p}if(l)for(var g=["scale","scaleX","scaleY","scaleZ","rotateAngle","rotateX","rotateY","rotateZ","translateX","translateY","translateZ"],f=0,m=g.length;f<m;++f){var C=g[f],y=e[C],_=t[C];if((!n(y)||!n(_))&&!(l=!n(y)&&!n(_)&&i(y,_,0===C.indexOf("scale")?a:0===C.indexOf("rotate")?s:o)))break}return l},transform2D:function(e,t){var r=d.CoordUtils.calcTransform2DMatrix(t);return d.CoordUtils.transform2DByMatrix(e,r)},inverseTransform2D:function(e,t){var r=d.CoordUtils.calcInverseTransform2DMatrix(t);return d.CoordUtils.transform2DByMatrix(e,r)},transform2DByMatrix:function(e,t){var r=d.MatrixUtils,n=r.create(3,1,[e.x||0,e.y||0,1]);return{x:(n=r.multiply(t,n))[0][0],y:n[1][0]}},calcTransform2DMatrix:function(e,t){var r=d.MatrixUtils,n=e||{},i=n.center;if(i)var o=r.create(3,3,[1,0,-(i.x||0),0,1,-(i.y||0),0,0,1]),a=r.create(3,3,[1,0,i.x||0,0,1,i.y||0,0,0,1]);if(n.rotateAngle)var s=n.rotateAngle,l=Math.cos(s),u=Math.sin(s),c=r.create(3,3,[l,-u,0,u,l,0,0,0,1]);var h=n.scale,p=n.scaleX,g=n.scaleY,f=h||1;if(h||p||g){var m=r.create(3,3);r.setValue(m,1,1,p||f),r.setValue(m,2,2,g||f),r.setValue(m,3,3,1)}var C=n.translateX,y=n.translateY;if(C||y){var _=r.create(3,3);r.setValue(_,1,1,1),r.setValue(_,2,2,1),r.setValue(_,3,3,1),r.setValue(_,1,3,C||0),r.setValue(_,2,3,y||0)}var E=r.create(3,3,[1,0,0,0,1,0,0,0,1]);return t?(o&&(E=r.multiply(o,E)),_&&(E=r.multiply(_,E)),m&&(E=r.multiply(m,E)),c&&(E=r.multiply(c,E)),a&&(E=r.multiply(a,E))):(o&&(E=r.multiply(o,E)),c&&(E=r.multiply(c,E)),m&&(E=r.multiply(m,E)),_&&(E=r.multiply(_,E)),a&&(E=r.multiply(a,E))),E},calcInverseTransform2DMatrix:function(e){var t=Object.create(e);return e.center&&(t.center={x:e.center.x,y:e.center.y}),t.scale&&(t.scale=1/t.scale),t.scaleX&&(t.scaleX=1/t.scaleX),t.scaleY&&(t.scaleY=1/t.scaleY),t.translateX&&(t.translateX=-t.translateX),t.translateY&&(t.translateY=-t.translateY),t.rotateAngle&&(t.rotateAngle=-t.rotateAngle),d.CoordUtils.calcTransform2DMatrix(t,!0)},transform3D:function(e,t){var r=d.CoordUtils.calcTransform3DMatrix(t);return d.CoordUtils.transform3DByMatrix(e,r)},transform3DByMatrix:function(e,t){var r=d.MatrixUtils,n=r.create(4,1,[e.x||0,e.y||0,e.z||0,1]);return{x:(n=r.multiply(t,n))[0][0],y:n[1][0],z:n[2][0]}},_calcRotateXYZ3DMatrixCore:function(e){var t=d.MatrixUtils,r=t.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),n=[];if(e.rotateAngle&&e.rotateAxisVector){var i=d.CoordUtils.standardize(e.rotateAxisVector);n.push({vector:[i.x,i.y,i.z],angle:-e.rotateAngle})}else{var o=e.rotateX,a=e.rotateY,s=e.rotateZ;o&&n.push({vector:[1,0,0],angle:-o}),a&&n.push({vector:[0,1,0],angle:-a}),s&&n.push({vector:[0,0,1],angle:-s})}for(var l=0,u=n.length;l<u;++l){var c,h=t.create(4,4),p=n[l].angle,g=n[l].vector,f=Math.cos(p),m=Math.sin(p);for(l=1;l<=4;++l)for(var C=1;C<=4;++C){if(l<4&&C<4){for(var y=1;y<=3&&(y===l||y===C);++y);var _=g[l-1]*g[C-1];c=l<C?_*(1-f)-Math.pow(-1,l+C)*g[y-1]*m:l>C?_*(1-f)+Math.pow(-1,l+C)*g[y-1]*m:_+(1-_)*f}else c=l===C?1:0;t.setValue(h,l,C,c)}r=t.multiply(h,r)}return r},calcRotate3DMatrix:function(e){var t=d.MatrixUtils,r=Object.create(e||{});if(r.rotateMatrix)a=r.rotateMatrix;else{var n=r.center;if(n)var i=t.create(4,4,[1,0,0,-(n.x||0),0,1,0,-(n.y||0),0,0,1,-(n.z||0),0,0,0,1]),o=t.create(4,4,[1,0,0,n.x||0,0,1,0,n.y||0,0,0,1,n.z||0,0,0,0,1]);var a=d.CoordUtils._calcRotateXYZ3DMatrixCore(e);i&&(a=t.multiply(i,a)),o&&(a=t.multiply(o,a))}return a},calcTransform3DMatrix:function(e){var t=d.MatrixUtils,r=e||{},n=r.center;if(n)var i=t.create(4,4,[1,0,0,-(n.x||0),0,1,0,-(n.y||0),0,0,1,-(n.z||0),0,0,0,1]),o=t.create(4,4,[1,0,0,n.x||0,0,1,0,n.y||0,0,0,1,n.z||0,0,0,0,1]);var a=Object.copyValues({},r,["rotateX","rotateY","rotateZ","rotateAngle","rotateAxisVector","rotateMatrix"]),s=d.CoordUtils.calcRotate3DMatrix(a),l=r.scale,u=r.scaleX,c=r.scaleY,h=r.scaleZ;if(l||u||c||h){var p=l||1,g=t.create(4,4);t.setValue(g,1,1,u||p),t.setValue(g,2,2,c||p),t.setValue(g,3,3,h||p),t.setValue(g,4,4,1)}var f=r.translateX,m=r.translateY,C=r.translateZ;if(f||m||C){var y=t.create(4,4);t.setValue(y,1,1,1),t.setValue(y,2,2,1),t.setValue(y,3,3,1),t.setValue(y,4,4,1),t.setValue(y,1,4,f||0),t.setValue(y,2,4,m||0),t.setValue(y,3,4,C||0)}var _=t.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);return i&&(_=t.multiply(i,_)),s&&(_=t.multiply(s,_)),g&&(_=t.multiply(g,_)),y&&(_=t.multiply(y,_)),o&&(_=t.multiply(o,_)),_},calcInverseTransform3DMatrix:function(e){var t=Object.create(e);return e.center&&(t.center={x:e.center.x,y:e.center.y,z:e.center.z}),t.scale&&(t.scale=1/t.scale),t.scaleX&&(t.scaleX=1/t.scaleX),t.scaleY&&(t.scaleY=1/t.scaleY),t.scaleZ&&(t.scaleZ=1/t.scaleZ),t.translateX&&(t.translateX=-t.translateX),t.translateY&&(t.translateY=-t.translateY),t.translateZ&&(t.translateZ=-t.translateZ),t.rotateAngle&&(t.rotateAngle=-t.rotateAngle),t.rotateX&&(t.rotateX=-t.rotateX),t.rotateX&&(t.rotateY=-t.rotateY),t.rotateZ&&(t.rotateZ=-t.rotateZ),d.CoordUtils.calcTransform3DMatrix(t,!0)},calcCoordGroup2DTransformParams:function(e,t,r,n){var i=d.CoordUtils,o=i.getDistance(e,t),a=i.substract(t,e),s=Math.atan2(a.y,a.x),l=i.getDistance(r,n),u=i.substract(n,r),c=Math.atan2(u.y,u.x),h=i.substract(r,e);return{translateX:h.x,translateY:h.y,scale:l/o,rotateAngle:c-s,center:e}},getDistance:function(e,t){t||(t={x:0,y:0,z:0});var r=Math.sqr(t.x-e.x)+Math.sqr(t.y-e.y);return d.ObjUtils.notUnset(e.z)&&d.ObjUtils.notUnset(t.z)&&(r+=Math.sqr(t.z-e.z)),Math.sqrt(r)},getCenter:function(e){var t=e.length;if(t<=0)return null;for(var r=Object.extend(e[0]),n=1;n<t;++n)r=d.CoordUtils.add(r,e[n]);return d.CoordUtils.divide(r,t)},insideRect:function(e,t,r){return(e.x-t.x)*(e.x-r.x)<=0&&(e.y-t.y)*(e.y-r.y)<=0},isInsideBox:function(e,t){var r=t,n=Math.sign(e.x-r.x1)*Math.sign(e.x-r.x2)<=0&&Math.sign(e.y-r.y1)*Math.sign(e.y-r.y2)<=0;return d.ObjUtils.notUnset(e.z)&&(n=n&&Math.sign(e.z-r.z1)*Math.sign(e.z-r.z2)<=0),n},getContainerBox:function(e){var t={},r={},n=e.length;if(!(n>0))return null;t=d.CoordUtils.clone(e[0]),r=d.CoordUtils.clone(e[0]);for(var i=1;i<n;++i){var o=e[i];t.x=Math.min(t.x,o.x),t.y=Math.min(t.y,o.y),r.x=Math.max(r.x,o.x),r.y=Math.max(r.y,o.y),d.ObjUtils.notUnset(t.z)&&(t.z=Math.min(t.z,o.z),r.z=Math.max(r.z,o.z))}return d.BoxUtils.createBox(t,r)}},d.GeometryUtils={standardizeAngle:function(e,t,r){return t=t||0,Math.PI,e-Math.floor((e-t)/Math.PI/2)*Math.PI*2},polarToCartesian:function(e,t,r,n){return{x:e+r*Math.cos(n),y:t+r*Math.sin(n)}},getVectorScalarProduct:function(e,t){return(e.x||0)*(t.x||0)+(e.y||0)*(t.y||0)+(e.z||0)*(t.z||0)},getVectorCrossProduct:function(e,t){return{x:(e.y||0)*(t.z||0)-(e.z||0)*(t.y||0),y:(e.z||0)*(t.x||0)-(e.x||0)*(t.z||0),z:(e.x||0)*(t.y||0)-(e.y||0)*(t.x||0)}},getVectorIncludedAngle:function(e,t){var r=d.CoordUtils,n=d.GeometryUtils.getVectorCrossProduct(e,t),i={x:0,y:0,z:0},o=r.getDistance(e,i)*r.getDistance(t,i),a=r.getDistance(n,i)/o;return Math.asin(a)},getVectorIncludedAngle2:function(e,t){return d.GeometryUtils.standardizeAngle(Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x))},getDihedralAngleOfVectors:function(e,t,r){var n=d.CoordUtils,i=d.GeometryUtils,o=i.getVectorCrossProduct(e,t),a=i.getVectorCrossProduct(t,r),s=n.getDistance(t)/1e5;if(n.isZero(o,s)||n.isZero(a,s))return-1;var l=n.standardize(t),u=i.getVectorScalarProduct(i.getVectorCrossProduct(o,a),l),c=i.getVectorScalarProduct(o,a),h=Math.atan2(u,c);return h<0&&(h+=2*Math.PI),h},getDihedralAngleOfPoints:function(e,t,r,n){var i=d.CoordUtils,o=i.substract(t,e),a=i.substract(r,t),s=i.substract(n,r);return d.GeometryUtils.getDihedralAngleOfVectors(o,a,s)},getPerpendicularCrossPointFromCoordToLine:function(e,t,r,n){var i,o={};if(Math.abs(t.x-r.x)<1e-10)o.x=t.x,o.y=e.y;else{var a=(r.y-t.y)/(r.x-t.x);o.x=(a*a*t.x+a*(e.y-t.y)+e.x)/(a*a+1),o.y=a*(o.x-t.x)+t.y}if(n)i=!0;else{var s={x:t.x-r.x,y:t.y-r.y};i=Math.abs(s.y)>Math.abs(s.x)?Math.sign(o.y-t.y)*Math.sign(o.y-r.y)<=0:Math.sign(o.x-t.x)*Math.sign(o.x-r.x)<=0}return i?o:null},getDistanceFromPointToLine:function(e,t,r,n){var i=d.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(e,t,r,n);if(i)return d.CoordUtils.getDistance(e,i);var o=d.CoordUtils.getDistance(e,t),a=d.CoordUtils.getDistance(e,r);return Math.min(o,a)},getCrossPointOfLines:function(e,t,r,n){var i=(e.x-r.x)*(t.y-r.y)-(e.y-r.y)*(t.x-r.x),o=(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x);if(i*o>=0)return null;var a=(r.x-e.x)*(n.y-e.y)-(r.y-e.y)*(n.x-e.x);if(a*(a+i-o)>=0)return null;var s=a/(o-i),l=s*(t.x-e.x),d=s*(t.y-e.y);return{x:e.x+l,y:e.y+d}},getCrossPointOfVectors:function(e,t){return d.GeometryUtils.getCrossPointOfLines(e[0],e[1],t[0],t[1])},getCrossPointsOfVectorToCircle:function(e,t,r,n){var i=[],o=d.CoordUtils,a=d.NumUtils.isFloatEqual,s=n,l=[o.substract(e[0],t),o.substract(e[1],t)],u=l[1].y-l[0].y,c=l[0].x-l[1].x,h=l[1].x*l[0].y-l[0].x*l[1].y,p=r,g=[],f=4*u*u*h*h-4*(u*u+c*c)*(h*h-p*p*c*c);if(a(f,0,s))g=[-u*h/(u*u+c*c)];else if(f<0)g=[];else{var m=Math.sqrt(f);g=[(-2*u*h+m)/(2*(u*u+c*c)),(-2*u*h-m)/(2*(u*u+c*c))]}if(g&&g.length){var C=[];if(1===g.length&&a(c,0,s)){var y=Math.sqrt(p*p-g[0]*g[0]);a(y,0,s)?C=[0]:(C[0]=y,C[1]=-y,g[1]=g[0])}else for(var _=0,E=g.length;_<E;++_)C[_]=-(u*g[_]+h)/c;for(_=0,E=g.length;_<E;++_){var T=(g[_]-l[0].x)*(g[_]-l[1].x),O=(C[_]-l[0].y)*(C[_]-l[1].y);(a(u,0,s)&&T<=0||a(c,0,s)&&O<=0||T<=0&&O<=0)&&i.push(o.add({x:g[_],y:C[_]},t))}}return i},getCrossPointsOfCircles:function(e,t,r,n,i){if(d.CoordUtils.getDistance(e,r)>t+n)return[];for(var o=t,a=n,s=e.x,l=r.x,u=e.y,c=r.y,h=(o*o-a*a+(l*l-s*s)+(c*c-u*u))/(2*(c-u)),p=(l-s)/(c-u),g=1+p*p,f=-(2*s+2*(h-u)*p),m=s*s+Math.sqr(h-u)-o*o,C=Math.sqrt(f*f-4*g*m),y=2*g,_=d.NumUtils.isFloatEqual(C,0,i)?[-f]:[(-f+C)/y,(-f-C)/y],E=[],T=[],O=0,v=_.length;O<v;++O)E[O]=h-p*_[O],T.push({x:_[O],y:E[O]});return T},simplifyCurveToLineSegments:function(e,t){return t?e.length<=2?d.ArrayUtils.clone(e):d.GeometryUtils._simplifyCurvePartToLineSegments(e,0,e.length-1,t):e},_simplifyCurvePartToLineSegments:function(e,t,r,n){var i=d.GeometryUtils,o=e[t],a=e[r];if(r-t<=1)return[o,a];for(var s=n,l=null,u=t+1;u<r;++u){var c=d.GeometryUtils.getDistanceFromPointToLine(e[u],o,a);c>s&&(s=c,l=u)}if(null===l)return[o,a];var h=i._simplifyCurvePartToLineSegments(e,t,l,n),p=i._simplifyCurvePartToLineSegments(e,l,r,n);return p.shift(),[].concat(h).concat(p)}},d.IntersectionState={EQUAL:0,CONTAINING:1,CONTAINED:2,OVERLAPPED:3,SEPARATED:4},d.BoxUtils={createBox:function(e,t){var r={},n=e.x||0,i=e.y||0,o=t.x||0,a=t.y||0;return n<=o?(r.x1=n,r.x2=o):(r.x1=o,r.x2=n),i<=a?(r.y1=i,r.y2=a):(r.y1=a,r.y2=i),d.ObjUtils.notUnset(e.z)&&d.ObjUtils.notUnset(t.z)&&(e.z<=t.z?(r.z1=e.z,r.z2=t.z):(r.z1=t.z,r.z2=e.z)),r},clone:function(e){var t={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2};return d.ObjUtils.notUnset(e.z1)&&d.ObjUtils.notUnset(e.z2)&&(t.z1=e.z1,t.z2=e.z2),t},convertToRect:function(e){var t=d.BoxUtils.normalize(e);return d.RectUtils.createRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1)},normalize:function(e){var t={x1:Math.min(e.x1,e.x2),y1:Math.min(e.y1,e.y2),x2:Math.max(e.x1,e.x2),y2:Math.max(e.y1,e.y2)};return d.ObjUtils.notUnset(e.z1)&&d.ObjUtils.notUnset(e.z2)&&(t.z1=Math.min(e.z1,e.z2),t.z2=Math.max(e.z1,e.z2)),t},shiftBox:function(e,t,r,n){var i=t||0,o=r||0,a=n||0,s={x:e.x1+i,y:e.y1+o},l={x:e.x2+i,y:e.y2+o};return d.ObjUtils.notUnset(e.z1)&&d.ObjUtils.notUnset(e.z2)&&(s.z=e.z1+a,l.z=e.z2+a),d.BoxUtils.createBox(s,l)},inflateBox:function(e,t,r,n){d.ObjUtils.isUnset(r)&&(r=t),d.ObjUtils.isUnset(n)&&(n=t);var i={x1:(i=d.BoxUtils.normalize(e)).x1-t,y1:i.y1-r,x2:i.x2+t,y2:i.y2+r};return d.ObjUtils.notUnset(i.z1)&&d.ObjUtils.notUnset(i.z2)&&(i.z1=i.z1-n,i.z2=i.z2+n),i},getContainerBox:function(e,t){if(!e)return d.BoxUtils.clone(t);if(!t)return d.BoxUtils.clone(e);var r=d.BoxUtils.normalize(e),n=d.BoxUtils.normalize(t),i={x1:Math.min(r.x1,n.x1),y1:Math.min(r.y1,n.y1),x2:Math.max(r.x2,n.x2),y2:Math.max(r.y2,n.y2)};return d.ObjUtils.notUnset(r.z1)&&d.ObjUtils.notUnset(r.z2)&&d.ObjUtils.notUnset(n.z1)&&d.ObjUtils.notUnset(n.z2)&&(i.z1=Math.min(r.z1,n.z1),i.z2=Math.max(r.z2,n.z2)),i},getIntersection:function(e,t){var r=d.BoxUtils.normalize(e),n=d.BoxUtils.normalize(t),i={x1:Math.max(r.x1,n.x1),y1:Math.max(r.y1,n.y1),x2:Math.min(r.x2,n.x2),y2:Math.min(r.y2,n.y2)};return i.x1>i.x2||i.y1>i.y2||d.ObjUtils.notUnset(r.z1)&&d.ObjUtils.notUnset(r.z2)&&d.ObjUtils.notUnset(n.z1)&&d.ObjUtils.notUnset(n.z2)&&(i.z1=Math.max(r.z1,n.z1),i.z2=Math.min(r.z2,n.z2),i.z1>i.z2)?null:i},hasIntersection:function(e,t){return!!d.BoxUtils.getIntersection(e,t)},isEqual:function(e,t){return Math.min(e.x1,e.x2)===Math.min(t.x1,t.x2)&&Math.max(e.x1,e.x2)===Math.max(t.x1,t.x2)&&Math.min(e.y1,e.y2)===Math.min(t.y1,t.y2)&&Math.max(e.y1,e.y2)===Math.max(t.y1,t.y2)},isInside:function(e,t){var r=e,n=t;return Math.min(r.x1,r.x2)>=Math.min(n.x1,n.x2)&&Math.max(r.x1,r.x2)<=Math.max(n.x1,n.x2)&&Math.min(r.y1,r.y2)>=Math.min(n.y1,n.y2)&&Math.max(r.y1,r.y2)<=Math.max(n.y1,n.y2)},getIntersectionState:function(e,t){var r=d.BoxUtils,n=d.IntersectionState;return r.isEqual(e,t)?n.EQUAL:r.isInside(e,t)?n.CONTAINED:r.isInside(t,e)?n.CONTAINING:r.hasIntersection(e,t)?n.OVERLAPPED:n.SEPARATED},getCenterCoord:function(e){var t={x:((e.x1||0)+(e.x2||0))/2,y:((e.y1||0)+(e.y2||0))/2};return(d.ObjUtils.notUnset(e.z1)||d.ObjUtils.notUnset(e.z2))&&(t.z=(e.z1||0+e.z2||0)/2),t},getMinMaxCoords:function(e){var t=d.BoxUtils.normalize(e),r={min:{x:t.x1,y:t.y1},max:{x:t.x2,y:t.y2}};return d.ObjUtils.notUnset(t.z1)&&(r.min.z=t.z1,r.max.z=t.z2),r},getCornerCoords:function(e){var t=d.BoxUtils.normalize(e);return d.ObjUtils.isUnset(t.z1)?[{x:t.x1,y:t.y1},{x:t.x1,y:t.y2},{x:t.x2,y:t.y1},{x:t.x2,y:t.y2}]:[{x:t.x1,y:t.y1,z:t.z1},{x:t.x1,y:t.y2,z:t.z1},{x:t.x2,y:t.y1,z:t.z1},{x:t.x2,y:t.y2,z:t.z1},{x:t.x1,y:t.y1,z:t.z2},{x:t.x1,y:t.y2,z:t.z2},{x:t.x2,y:t.y1,z:t.z2},{x:t.x2,y:t.y2,z:t.z2}]},transform2D:function(e,t){for(var r=d.BoxUtils.getCornerCoords(e),n=[],i=0,o=r.length;i<o;++i)n.push(d.CoordUtils.transform2D(r[i],t));return d.CoordUtils.getContainerBox(n)},transform3D:function(e,t){for(var r=d.BoxUtils.getCornerCoords(e),n=[],i=0,o=r.length;i<o;++i)n.push(d.CoordUtils.transform3D(r[i],t));return d.CoordUtils.getContainerBox(n)}},d.RectUtils={createRect:function(e,t,r,n){return{left:e,top:t,width:r,height:n}},clone:function(e){return{left:e.left,top:e.top,width:e.width,height:e.height}},isZero:function(e){return 0===e.width&&0===e.height},convertToBox:function(e){var t=d.CoordUtils.create(e.left,e.top),r=d.CoordUtils.create(e.left+e.width,e.top+e.height);return d.BoxUtils.createBox(t,r)},inflateRect:function(e,t,r){return d.ObjUtils.isUnset(r)&&(r=t),d.RectUtils.createRect(e.left,e.top,e.width+t,e.height+r)},shiftRect:function(e,t,r){var n=t||0,i=r||0;return d.RectUtils.createRect(e.left+n,e.top+i,e.width,e.height)},getContainerRect:function(e,t){var r=d.RectUtils.convertToBox(e),n=d.RectUtils.convertToBox(t),i=d.BoxUtils.getContainerBox(r,n);return d.BoxUtils.convertToRect(i)},getIntersection:function(e,t){var r=d.RectUtils.convertToBox(e),n=d.RectUtils.convertToBox(t),i=d.BoxUtils.getIntersection(r,n);return i?d.BoxUtils.convertToRect(i):null},hasIntersection:function(e,t){return!!d.RectUtils.getIntersection(e,t)}},d.ZoomUtils={PREDEFINED_ZOOM_RATIOS:[.1,.3,.5,.66,.8,.9,1,1.1,1.25,1.5,1.75,2,2.5,3,4,5,7,10,15,20],getNearestZoomLevel:function(e,t){var r=t||d.ZoomUtils.PREDEFINED_ZOOM_RATIOS,n=r.length;if(e>r[n-1])return r[n-1];if(e<r[0])return r[0];for(var i=0;i<n-1;++i){var o=r[i],a=r[i+1];if(e>=o&&e<=a)return 1===o||1===a?1:(e-o)/(a-o)<=.5?o:a}},getNextZoomInRatio:function(e,t,r){t||(t=1);var n=r||d.ZoomUtils.PREDEFINED_ZOOM_RATIOS,i=n.length;if(e<n[i-1])for(var o=0;o<i;++o)if(n[o]>e)return n[Math.min(o+t,i)-1];return e},getNextZoomOutRatio:function(e,t,r){t||(t=1);var n=r||d.ZoomUtils.PREDEFINED_ZOOM_RATIOS,i=n.length;if(e>n[0])for(var o=i-1;o>=0;--o)if(n[o]<e)return n[Math.max(o-t+1,0)];return e}},d.DomHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DomHelper",NAMESPACE_DEFINE_PREFIX:"xmlns",NAMESPACE_DELIMITER:":",ERR_EMPTY_DOC:"Document is empty",ERR_ELEMENT_NOTSET:"Element not set",initialize:function(e){this.tryApplySuper("initialize"),this._supportNsMethods=null,e&&this.setDocument(e)},initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("document");if(!e){var t=this.getPropStoreFieldValue("rootElement");e=t?t.ownerDocument:null}return e},setter:function(e){e!=this.getPropStoreFieldValue("document")&&(this.setPropStoreFieldValue("document",e),this.analysisRootElem())}}),this.defineProp("rootElement",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("rootElement");if(!e){var t=this.getPropStoreFieldValue("document");e=t?t.documentElement:null}return e},setter:function(e){this.setPropStoreFieldValue("rootElement",e),this.analysisRootElem()}}),this.defineProp("namespaces",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("namespaces")||this.setPropStoreFieldValue("namespaces",[]),this.getPropStoreFieldValue("namespaces")}}),this.defineProp("defNamespaceURI",{dataType:DataType.STRING,serializable:!1}),this.defineProp("forceAnalysisDoc",{dataType:DataType.BOOL})},analysisRootElem:function(){this.setNamespaces([]),this.setDefNamespaceURI(null);var e=this.getRootElement();if(e){var t=e.ownerDocument;if(this._supportNsMethods=!!t.getElementsByTagNameNS,!this._supportNsMethods||this.getForceAnalysisDoc())for(var r=0,n=e.attributes.length;r<n;++r){var i=e.attributes[r],o=i.name;if(o&&o.indexOf(this.NAMESPACE_DEFINE_PREFIX)>=0){var a=i.value,s=o.indexOf(this.NAMESPACE_DELIMITER),l=s>=0?o.substring(s+1):null;this.getNamespaces().push({namespaceURI:a,prefix:l}),l||this.setDefNamespaceURI(a)}}}},_getEmptyDocErrorMsg:function(){return d.hasLocalRes()?d.$L("ErrorMsg.EMPTY_DOC"):this.ERR_EMPTY_DOC},_getElementNotSetErrorMsg:function(){return d.hasLocalRes()?d.$L("ErrorMsg.ELEMENT_NOTSET"):this.ELEMENT_NOTSET},assertDocAvailable:function(e){return!!e||(d.raise(this._getEmptyDocErrorMsg()),!1)},assertElementAvailable:function(e){return!!e||(d.raise(this._getElementNotSetErrorMsg()),!1)},getNsPrefix:function(e){if(e==this.getDefNamespaceURI())return"";for(var t=this.getNamespaces(),r=0,n=t.length;r<n;++r)if(t[r].namespaceURI==e)return t[r].prefix;return null},getQualifiedName:function(e,t){var r=this.getNsPrefix(e);return null===r?null:r?r+this.NAMESPACE_DELIMITER+t:t},createElementNS:function(e,t){var r=this.getDocument();return this.assertDocAvailable(r)?this._supportNsMethods?r.createElementNS(e,t):r.createElement(t):null},getElementsByTagNameNS:function(e,t,r){var n=this.getPropStoreFieldValue("document")||this.getPropStoreFieldValue("rootElement"),i=this.getDocument();if(!this.assertDocAvailable(i))return null;if(this._supportNsMethods)return e||(e="*"),r?r.getElementsByTagNameNS(e,t):n.getElementsByTagNameNS(e,t);var o=this.getQualifiedName(e,t);return null===o?[]:r?r.getElementsByTagName(o):n.getElementsByTagName(o)},getAttributeNodeNS:function(e,t,r){if(!this.assertElementAvailable(r))return null;if(this._supportNsMethods)return e||(e="*"),r.getAttributeNodeNS(e,t);var n=this.getQualifiedName(e,t);return null===n?null:r.getAttributeNode(n)},getAttributeNS:function(e,t,r){if(!this.assertElementAvailable(r))return null;if(this._supportNsMethods)return e||(e="*"),r.getAttributeNS(e,t);var n=this.getQualifiedName(e,t);return null===n?null:r.getAttribute(n)},setAttributeNS:function(e,t,r,n){if(!this.assertElementAvailable(n))return null;if(this._supportNsMethods)return n.setAttributeNS(e,t,r);var i=this.getQualifiedName(e,t);return null===i?null:n.setAttribute(i,r)}}),d.DomUtils={namespaceMatched:function(e,t,r){return void 0===r&&(r=!0),e.namespaceURI==t||r&&!e.namespaceURI},isElement:function(e){return e&&e.tagName&&e.nodeType},getElementText:function(e){for(var t="",r=0,n=e.childNodes.length;r<n;++r)3==e.childNodes[r].nodeType&&(t+=e.childNodes[r].nodeValue);return t},setElementText:function(e,t,r){for(var n=0,i=e.childNodes.length;n<i;++n)if(3==e.childNodes[n].nodeType)return e.childNodes[n].nodeValue=t,t;var o=r?(t||"").split("\n"):[t||""];for(n=0,i=o.length;n<i;++n){if(n>0){var a=e.ownerDocument.createElement("br");e.appendChild(a)}var s=e.ownerDocument.createTextNode(o[n]);e.appendChild(s)}return t},getLocalName:function(e){return e.localName||e.baseName||e.nodeName},getChildNodesOfTypes:function(e,t){for(var r=[],n=d.ArrayUtils.toArray(t),i=0,o=e.childNodes.length;i<o;++i){var a=e.childNodes[i];(!t||n.indexOf(a.nodeType)>=0)&&r.push(a)}return r},getFirstChildElem:function(e,t,r,n){for(var i=0,o=e.childNodes.length;i<o;++i){var a=e.childNodes[i];if(a.nodeType===Node.ELEMENT_NODE&&(t&&t.toLowerCase()===a.tagName.toLowerCase()||r&&r.toLowerCase()===d.DomUtils.getLocalName(a).toLowerCase()||!t&&!r)&&(!n||d.DomUtils.namespaceMatched(a,n)))return a}},getDirectChildElems:function(e,t,r,n){for(var i=[],o=0,a=e.childNodes.length;o<a;++o){var s=e.childNodes[o];s.nodeType===Node.ELEMENT_NODE&&(t&&t.toLowerCase()===s.tagName.toLowerCase()||r&&r.toLowerCase()===d.DomUtils.getLocalName(s).toLowerCase()||!t&&!r)&&(n&&!d.DomUtils.namespaceMatched(s,n)||i.push(s))}return i},getDirectChildElemsOfAttribValues:function(e,t,r,n,i){for(var o=d.DomUtils.getDirectChildElems(e,r,n,i),a=[],s=0,l=o.length;s<l;++s){for(var u=!0,c=0,h=t.length;c<h;++c){var p=d.ObjUtils.getOwnedFieldNames(t[c])[0];if(o[s].getAttribute(p)!=t[c][p]){u=!1;break}}u&&a.push(o[s])}return a},getParentNode:function(e,t){var r=t||{};return e.parentNode||(r.acrossShadowRoot&&e.host?e.host:null)},isDescendantOf:function(e,t,r){var n=r||{};try{if(e&&t){if(e.documentElement)return!1;if(e.ownerDocument===t)return!0;for(var i=d.DomUtils.getParentNode,o=i(e,n);o;){if(o===t)return!0;o=i(o,n)}}return!1}catch(e){return!1}},isOrIsDescendantOf:function(e,t,r){return e===t||d.DomUtils.isDescendantOf(e,t,r)},getNearestAncestorByTagName:function(e,t,r){var n=t.toLowerCase();if(r&&e.tagName&&e.tagName.toLowerCase()===n)return e;for(var i=e.parentNode;i&&i.tagName;){if(i.tagName.toLowerCase()===n)return i;i=i.parentNode}return null},getSameNSAttributeValue:function(e,t,r){return e.getAttribute(t)},setSameNSAttributeValue:function(e,t,r,n){return e.setAttribute(t,r)},fetchAttributeValuesToArray:function(e,t,r){for(var n=[],i=0,o=e.attributes.length;i<o;++i){var a=e.attributes[i];if(!t||d.DomUtils.namespaceMatched(a,t,!0)){var s;if(r)try{s=d.DomUtils.getLocalName(a)}catch(e){s=a.name}else s=a.name;n.push({name:s,value:a.value})}}return n},fetchAttributeValuesToJson:function(e,t,r){for(var n={},i=0,o=e.attributes.length;i<o;++i){var a=e.attributes[i];if(!t||d.DomUtils.namespaceMatched(a,t,!0)){var s;if(r)try{s=d.DomUtils.getLocalName(a)}catch(e){s=a.name}else s=a.name;n[s]=a.value}}return n},hasAttribute:function(e,t){return e.hasAttribute?e.hasAttribute(t):!!e.getAttribute(t)},isDataAttribName:function(e){return e.toString().startsWith("data-")},getDataAttribCoreName:function(e){return d.DomUtils.isDataAttribName(e)?e.substr(5):null},getDataAttrib:function(e,t){return e.dataset?e.dataset[t]:e.getAttribute("data-"+t.toString().hyphenize())},setDataAttrib:function(e,t,r){e.dataset?e.dataset[t]=r:e.setAttribute("data-"+t.toString().hyphenize(),r)},getDataset:function(e){if(e.dataset)return e.dataset;for(var t={},r=e.attributes,n=0,i=r.length;n<i;++n){var o=r[n],a=o.name;0===a.toLowerCase().indexOf("data-")&&(t[a.substring(5).camelize()]=o.value)}return t},clearChildContent:function(e){for(var t=d.ArrayUtils.toArray(e.childNodes),r=t.length-1;r>=0;--r){var n=t[r];n.nodeType!==Node.ATTRIBUTE_NODE&&e.removeChild(n)}return e},replaceTagName:function(e,t){if(e.tagName.toLowerCase()!==t.toLowerCase()){for(var r=e.ownerDocument.createElement(t),n=d.DomUtils.fetchAttributeValuesToArray(e),i=0,o=n.length;i<o;++i)r.setAttribute(n[i].name,n[i].value);var a=d.DomUtils.getDirectChildElems(e);for(i=0,o=a.length;i<o;++i)r.appendChild(a[i]);var s=e.parentNode,l=e.nextSibling;return s.removeChild(e),l?s.insertBefore(r,l):s.appendChild(r),r}return e},setElemAttributes:function(e,t){for(var r=d.ObjUtils.getOwnedFieldNames(t),n=0,i=r.length;n<i;++n){var o=r[n],a=t[o];o&&a&&e.setAttribute(o,a)}return e},isInDomTree:function(e,t,r){var n=r||{};if(!e)return!1;if(t||(t=e.ownerDocument),t){if(!n.acrossShadowRoot&&e.getRootNode)return e.getRootNode()===t;var i=t.documentElement;return d.DomUtils.isDescendantOf(e,i,r)||e===i}return!1},isInShadowRoot:function(e){if("undefined"==typeof ShadowRoot)return!1;try{return(e.getRootNode&&e.getRootNode())instanceof ShadowRoot}catch(e){return!1}}},d.DataSrcAttribUtils={isUrlBasedValue:function(e){return 0===e.toLowerCase().indexOf("url(")},getUrl:function(e){var t=e.trim();if(0===t.toLowerCase().indexOf("url(")){var r=t.lastIndexOf(")");return t.substring(4,r)}return null},getElementContent:function(e){if(!e)return null;var t=e.innerHTML;return t.ltrim()},getElementMimeType:function(e){return e.getAttribute("type")}},d.ScriptFileUtils={_existedScriptUrls:new d.MapEx,appendScriptFile:function(e,t,r){var n;if(e){if((n=d.ScriptFileUtils._existedScriptUrls.get(e))||(n=[],d.ScriptFileUtils._existedScriptUrls.set(e,n)),n.indexOf(t)>=0)return void(r&&r(null));var i=e.createElement("script");return i.src=t,i.onerror=function(e){r&&r(e)},i.onload=i.onreadystatechange=function(e){if(!i._loaded){var o=i.readyState;void 0!==o&&"loaded"!==o&&"complete"!==o||(i._loaded=!0,i.onload=i.onreadystatechange=null,n.push(t),r&&r(null))}},(e.getElementsByTagName("head")[0]||e.body).appendChild(i),i}var o=d.$jsRoot.__$kekule_scriptfile_utils__;if(o&&o.appendScriptFile)return o.appendScriptFile(e,t,r)},appendScriptFiles:function(e,t,r){!function e(t,r,n,i){if(r.length<=0)n&&(i.length?n(new Error("Error in loading: "+i.join("; "))):n(null));else{var o=r.shift();d.ScriptFileUtils.appendScriptFile(t,o,(function(a){a&&i.push(o+": "+a?a.message||a:""),e(t,r,n,i)}))}}(e,[].concat(t),r,[])}},function(){"use strict";d.ExternalResourceType={JS_OBJ:"jsObject",STYLESHEET:"stylesheet",DATA:"data",OTHER:"other"},d.ExternalResourceType.DEFAULT=d.ExternalResourceType.JS_OBJ,d.ExternalResourceManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ExternalResourceManager",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("resources",{})},doFinalize:function(){this.setPropStoreFieldValue("resources",null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("resources",{dataType:DataType.HASH,serializable:!1,setter:null})},register:function(e,t,r,n){var i=this.getResources();i[e]&&this.unregister(e),i[e]={name:e,resource:t,resourceType:r||d.ExternalResourceType.DEFAULT},this.invokeEvent("resourceRegistered",{name:e,resource:t,resourceType:r}),this.invokeEvent(e+"Registered",{name:e,resource:t,resourceType:r})},unregister:function(e){var t=this.getResources();if(t[e]){var r=t[e];this.invokeEvent("resourceUnregistered",r),this.invokeEvent(e+"Unregistered",r),delete t[e]}},getResourceDetails:function(e){return this.getResources()[e]},getResource:function(e){var t=this.getResourceDetails(e);return t&&t.resource}}),d.ClassUtils.makeSingleton(d.ExternalResourceManager),d.externalResourceManager=d.ExternalResourceManager.getInstance()}(),function(){"use strict";d.Unit={ALL:{},_KEY_MAP:{},register:function(t,r,n,i,o){var a=e[n];a||(a=e._createCategoryObj(n),e[n]=a);var s=r.toUpperCase();return a[s]=e._createUnitObj(t,r,a,i,o),1===i&&a.setStandardUnit(a[s]),e.ALL[s]=a[s],e._KEY_MAP[a[s].getKey()]=a[s],a[s]},unregister:function(t){var r=e.getUnit(t);if(r){var n=r.getKey().toUpperCase();delete e.ALL[n],delete e._KEY_MAP[n],delete r.category[n]}},getUnit:function(t){return"object"==typeof t?t.getKey?t:null:e._KEY_MAP[t]},_createCategoryObj:function(t){var r=Object.create(e._categoryObjProto);return r.name=t,r},_createUnitObj:function(e,t,r,n,i){var o=Object.create(d.Unit._unitObjProto);return Object.extend(o,{symbol:e,name:t,category:r,rateToStandard:n}),i&&Object.extend(o,i),o}};var e=d.Unit;d.Unit._categoryObjProto={getName:function(){return this.name},getStandardUnit:function(){return this._standardUnit},setStandardUnit:function(e){this._standardUnit=e}},d.Unit._unitObjProto={getKey:function(){return this.symbol||this.name},isStandard:function(){return 1===this.rateToStandard},convertValueTo:function(t,r,n){var i="string"==typeof r?e.getUnit(r):r;if(i)return this.doConvertValueTo(t,i,n);d.error(d.$L("ErrorMsg.UNIT_NOT_FOUND").format(r.symbol||r.name||r))},doConvertValueTo:function(e,t,r){if(t.category!==this.category)d.error(d.$L("ErrorMsg.UNABLE_TO_CONVERT_BETWEEN_UNITS").format(this.getKey(),t.getKey()));else{var n=t.rateToStandard,i=this.rateToStandard;if(n&&i)return e*i/n;d.error(d.$L("ErrorMsg.UNABLE_TO_CONVERT_BETWEEN_UNITS").format(this.getKey(),t.getKey()))}}},d.UnitUtils={convertValue:function(t,r,n,i){return e.getUnit(r).convertValueTo(t,n,i)}};var t=e.register;t("","arbitrary","General",null),t("","one","Ratio",1),t("%","percent","Ratio",.01),t("\u2030","thousandth","Ratio",.001),t("ppm","millionth","Ratio",1e-6),t("hr","hour","Time",3600),t("min","minute","Time",60),t("sec","second","Time",1),t("ms","millisecond","Time",.001),t("\u03bcs","microsecond","Time",1e-6),t("ns","nanosecond","Time",1e-9),t("m","meter","Length",1),t("cm","centimeter","Length",.01),t("mm","millimeter","Length",.001),t("\u03bcm","micrometer","Length",1e-6),t("mm","nanometer","Length",1e-9),t("\xc5","angstrom","Length",1e-10),t("mol","mole","AmountOfSubstance",1),t("g","gram","Weight",1),t("kg","kilogram","Weight",1e3),t("K","kelvin","Temperature",1),t("A","ampere","ElectricCurrent",1),t("\u03bcA","microampere","ElectricCurrent",1e-6),t("nA","nanoampere","ElectricCurrent",1e-9),t("pA","picoampere","ElectricCurrent",1e-12),t("V","volts","ElectricVoltage",1),t("Hz","hertz","Frequency",1),t("kHz","kilohertz","Frequency",1e3)}(),d.AbstractConfigs=Class.create(ObjectEx,{CLASS_NAME:"Kekule.AbstractConfigs",CONFIG_PROP_FLAG:"__$config_prop__",initialize:function(e){this.tryApplySuper("initialize"),void 0===e&&(e=!0),e&&this.initPropDefValues()},addConfigProp:function(e,t,r,n){var i={dataType:t};n&&(i=Object.extend(i,n)),void 0!==r&&(i.defaultValue=r);var o=this.defineProp(e,i);return o[this.CONFIG_PROP_FLAG]=!0,o},addHashConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.HASH,t,r)},addStrConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.STRING,t,r)},addNumConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.NUM,t,r)},addIntConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.INT,t,r)},addFloatConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.FLOAT,t,r)},addBoolConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.BOOL,t,r)},initPropDefValues:function(){this.beginUpdate();try{for(var e=this.getAllPropList(),t=0,r=e.getLength();t<r;++t){var n=e.getPropInfoAt(t),i=n.name,o=n.defaultValue;void 0!==o&&this.setPropValue(i,o)}}finally{this.endUpdate()}},assign:function(e){e.copyPropsTo(this)},doTransformPropNameToHash:function(e){return this.doGetPropNameToHashPrefix()+e},doGetPropNameToHashPrefix:function(){return""},toHash:function(e){var t={},r=this.CONFIG_PROP_FLAG;this.saveObj(t,"json",{saveDefaultValues:!0,propFilter:function(e,t){return e[r]}});for(var n=e||this.doTransformPropNameToHash.bind(this),i={},o=d.ObjUtils.getOwnedFieldNames(t,!1),a=0,s=o.length;a<s;++a)i[n(o[a])]=t[o[a]];return i}}),d.ConfigPresetMap=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ConfigPresetMap",initialize:function(){this.tryApplySuper("initialize"),this.map=new d.MapEx(!0)},doFinalize:function(){this.map=null,this.tryApplySuper("doFinalize")},set:function(e,t){this.map.set(e,t)},get:function(e){return this.map.get(e)},getHash:function(e){var t=this.get(e);return t?t.toHash?t.toHash():t:null},remove:function(e){this.map.remove(e)},has:function(e){return this.map.has(e)},clear:function(){this.map.clear()}}),d.ElementSeries={NONMETAL:"Nonmetals",METAL:"Metals",ALKALI_METAL:"Alkali Metals",ALKALI_EARTH_METAL:"Alkali Earth Metals",TRANSITION_METAL:"Transition Metals",METALLOID:"Metalloids",HALOGEN:"Halogens",NOBLE_GAS:"Noble Gases",LANTHANIDE:"Lanthanides",ACTINIDE:"Actinides"},d.ElementCategory={NONMETAL:1,METAL:21,ALKALI_METAL:22,ALKALI_EARTH_METAL:23,TRANSITION_METAL:24,METALLOID:11,HALOGEN:3,NOBLE_GAS:2,LANTHANIDE:25,ACTINIDE:26},d.Element=Class.create(d.ChemObject,{CLASS_NAME:"Kekule.Element",initialize:function(e){if(this.tryApplySuper("initialize"),e!=d.Element.UNSET_ELEMENT){var t=this.getElementInfo(e);t?(this.setPropStoreFieldValue("symbol",t.symbol),this.setPropStoreFieldValue("atomicNumber",t.atomicNumber),this.setPropStoreFieldValue("group",t.group),this.setPropStoreFieldValue("period",t.period),this.setPropStoreFieldValue("series",t.chemicalSerie),this.setPropStoreFieldValue("naturalMass",t.naturalMass),this.setPropStoreFieldValue("categories",this._getElementCategoriesFromSeries(t.chemicalSerie)),t.name&&this.setPropStoreFieldValue("name",t.name)):d.chemError(d.hasLocalRes()?d.$L("ErrorMsg.INVALID_CHEMELEMENT")+": "+e:"Invalid chemical element: "+e)}else this.setPropStoreFieldValue("symbol",d.Element.UNSET_ELEMENT),this.setPropStoreFieldValue("atomicNumber",d.Element.UNSET_ELEMENT)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("atomicNumber",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("symbol",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("group",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("period",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("series",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("categories",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("naturalMass",{dataType:DataType.FLOAT,serializable:!1,setter:null})},getElementInfo:function(e){return e==d.Element.UNSET_ELEMENT?{symbol:d.Element.UNSET_ELEMENT,atomicNumber:d.Element.UNSET_ELEMENT}:d.Element.isDummyElement(e)?{symbol:d.Element.DUMMY_ELEMENT,atomicNumber:d.Element.DUMMY_ELEMENT_ATOMICNUM}:d.Element.isRGroup(e)?{symbol:d.Element.RGROUP_ELEMENT,atomicNumber:d.Element.RGROUP_ELEMENT_ATMOICNUM}:d.ChemicalElementsDataUtil.getElementInfo(e)},_getElementCategoriesFromSeries:function(e){var t=d.ElementSeries,r=d.ElementCategory,n=[];switch(e){case t.NONMETAL:n=[r.NONMETAL];break;case t.METAL:n=[r.METAL];break;case t.ALKALI_METAL:n=[r.METAL,r.ALKALI_METAL];break;case t.ALKALI_EARTH_METAL:n=[r.METAL,r.ALKALI_EARTH_METAL];break;case t.TRANSITION_METAL:n=[r.METAL,r.TRANSITION_METAL];break;case t.METALLOID:n=[r.METALLOID];break;case t.HALOGEN:n=[r.NONMETAL,r.HALOGEN];break;case t.NOBLE_GAS:n=[r.NONMETAL,r.NOBLE_GAS];break;case t.LANTHANIDE:n=[r.METAL,r.LANTHANIDE];break;case t.ACTINIDE:n=[r.METAL,r.ACTINIDE]}return n},getTheoreticValence:function(){return this.getGroup()?d.Element.getTheoreticValenceOfGroup(this.getGroup()):null},isDummyElement:function(){return this.getAtomicNumber()==d.Element.DUMMY_ELEMENT_ATOMICNUM},isRGroupElement:function(){return this.getAtomicNumber()==d.Element.RGROUP_ELEMENT_ATMOICNUM},isNormalElement:function(){return d.Element.isNormalElement(this.getAtomicNumber())},isSameElement:function(e){return e==d.Element.UNSET_ELEMENT?this.getAtomicNumber()==d.Element.UNSET_ELEMENT:"number"==typeof e?this.getAtomicNumber()==e:this.getSymbol()==e},isHetero:function(){return(this.getSeries()===d.ElementSeries.NONMETAL||this.getSeries()===d.ElementSeries.HALOGEN)&&6!==this.getAtomicNumber()&&1!==this.getAtomicNumber()},belongToCategory:function(e){return(this.getCategories()||[]).indexOf(e)>=0},getLabel:function(){return this.getSymbol()}}),Object.extend(d.Element,d.ChemicalElementsDataUtil),d.Element.UNSET_ELEMENT=void 0,d.Element.DUMMY_ELEMENT="DU",d.Element.DUMMY_ELEMENT_ATOMICNUM=-1,d.Element.RGROUP_ELEMENT="R",d.Element.RGROUP_ELEMENT_ATOMICNUM=-2,d.Element.DEUTERIUM="D",d.Element.isNormalElement=function(e){return e!=d.Element.UNSET_ELEMENT&&!d.Element.isPseudoElement(e)},d.Element.isPseudoElement=function(e){return"string"==typeof e?e==d.Element.DUMMY_ELEMENT||e==d.Element.RGROUP_ELEMENT:e==d.Element.DUMMY_ELEMENT_ATOMICNUM||e==d.Element.RGROUP_ELEMENT_ATMOICNUM},d.Element.isDummyElement=function(e){return e===d.Element.DUMMY_ELEMENT||e===d.Element.DUMMY_ELEMENT_ATOMICNUM},d.Element.isRGroup=function(e){return e===d.Element.RGROUP_ELEMENT||e===d.Element.RGROUP_ELEMENT_ATOMICNUM},d.Element.getTheoreticValenceOfGroup=function(e){return e<=2?e:e<=12?null:e<=17?e-10:0},d.Element.getTheoreticValence=function(e){var t=d.ChemicalElementsDataUtil.getElementInfo(e);return t.group?d.Element.getTheoreticValenceOfGroup(t.group):null},Object.extend(d.Element,{isAtomicNumberAvailable:function(e){return d.ChemicalElementsDataUtil.isAtomicNumberAvailable(e)},isElementSymbolAvailable:function(e){return d.ChemicalElementsDataUtil.isElementSymbolAvailable(e)}}),d.Isotope=Class.create(d.Element,{CLASS_NAME:"Kekule.Isotope",initialize:function(e,t){var r=e,n=t,i=d.IsotopesDataUtil.getIsotopeInfo(e,t);if(i&&(i.atomicNumber&&(r=i.atomicNumber),n=i.massNumber),this.tryApplySuper("initialize",[r]),this.setPropStoreFieldValue("massNumber",n),i&&i.isotopeAlias&&this.setPropStoreFieldValue("isotopeAlias",i.isotopeAlias),d.Element.isNormalElement(r)&&n!==d.Isotope.UNSET_MASSNUMBER){var o=d.IsotopesDataUtil.getIsotopeInfo(this.getAtomicNumber(),n);o?(this.setPropStoreFieldValue("exactMass",o.exactMass),this.setPropStoreFieldValue("naturalAbundance",o.naturalAbundance)):d.chemError((d.hasLocalRes()?d.$L("ErrorMsg.INVALID_ISOTOPE"):"Invalid isotope")+": "+this.getSymbol()+"/"+t)}},initProperties:function(){this.defineProp("massNumber",{dataType:DataType.INTEGER,serializable:!1,setter:null}),this.defineProp("exactMass",{dataType:DataType.FLOAT,serializable:!1,setter:null}),this.defineProp("naturalAbundance",{dataType:DataType.FLOAT,serializable:!1,setter:null}),this.defineProp("isotopeAlias",{dataType:DataType.STRING,serializable:!1,setter:null})},isSame:function(e){return e instanceof d.Isotope&&(e===this||e.getAtomicNumber()==this.getAtomicNumber()&&e.getMassNumber()==this.getMassNumber())},getIsotopeId:function(){return d.IsotopesDataUtil.getIsotopeId(this.getAtomicNumber(),this.getMassNumber())},getLabel:function(){return""+(this.getMassNumber()||"")+this.getSymbol()}}),Object.extend(d.Isotope,d.IsotopesDataUtil),d.Isotope.UNSET_MASSNUMBER=void 0,d.Isotope.getIsotopeId=function(e,t){return d.IsotopesDataUtil.getIsotopeId(e,t)},Object.extend(d.Isotope,{isMassNumberAvailable:function(e,t){return d.IsotopesDataUtil.isMassNumberAvailable(e,t)}}),d.IsotopeFactory={GENERIC_ELEMENT_ID:"__GENERIC__",_isotopes:{},getIsotopeId:function(e,t){return e?d.IsotopesDataUtil.getIsotopeId(e,t):d.IsotopeFactory.GENERIC_ELEMENT_ID},getIsotope:function(e,t){var r=d.IsotopeFactory.getIsotopeId(e,t);if(!d.IsotopeFactory._isotopes[r]){var n=new d.Isotope(e,t);d.IsotopeFactory._isotopes[r]=n}return d.IsotopeFactory._isotopes[r]},getIsotopeById:function(e){if(d.IsotopeFactory._isotopes[e])return d.IsotopeFactory._isotopes[e];var t=d.IsotopesDataUtil.getIsotopeIdDetail(e);return t?d.IsotopeFactory.getIsotope(t.symbol,t.massNumber):null}},d.AtomType={UNSET_ATOMTYPE:void 0},d.ElectronSet=Class.create(d.ChemObject,{CLASS_NAME:"Kekule.ElectronSet",initialize:function(e){this.tryApplySuper("initialize"),this.setElectronCount(e||d.ElectronSet.UNSET_ELECTRONCOUNT)},initProperties:function(){this.defineProp("electronCount",{dataType:DataType.FLOAT})}}),d.ElectronSet.UNSET_ELECTRONCOUNT=null,d.UnbondedElectronSet=Class.create(d.ElectronSet,{CLASS_NAME:"Kekule.UnBondedElectronSet",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){}}),d.BondType={COVALENT:"covalent",IONIC:"ionic",COORDINATE:"coordinate",METALLIC:"metallic",HYDROGEN:"hydrogen",UNKNOWN:null,DEFAULT:"covalent"},d.BondOrder={SINGLE:1,DOUBLE:2,TRIPLE:3,QUAD:4,EXPLICIT_AROMATIC:10,OTHER:20,UNSET:null,DEFAULT:1,getBondValence:function(e){return e===d.BondOrder.UNSET?0:e==d.BondOrder.EXPLICIT_AROMATIC?1.5:e}},d.BondForm=Class.create(d.ElectronSet,{CLASS_NAME:"Kekule.BondForm",initialize:function(e,t,r){this.tryApplySuper("initialize",[t]),this.setBondOrder(e||d.BondOrder.DEFAULT),d.ObjUtils.notUnset(r)&&this.setBondType(r),d.ObjUtils.notUnset(t)&&this.setElectronCount(t)},initProperties:function(){this.defineProp("bondType",{dataType:DataType.STRING,enumSource:d.BondType,getter:function(){return this.getPropStoreFieldValue("bondType")||d.BondType.DEFAULT}}),this.defineProp("bondOrder",{dataType:DataType.FLOAT,enumSource:d.BondOrder,setter:function(e){this.getPropStoreFieldValue("bondOrder")!=e&&(this.setPropStoreFieldValue("bondOrder",e),e?this.getBondType()==d.BondType.COVALENT&&this.setElectronCount(2*this.getBondValence()):e===d.BondOrder.UNSET&&this.setElectronCount(d.ElectronSet.UNSET_ELECTRONCOUNT))}}),this.defineProp("electronCount",{dataType:DataType.FLOAT}),this.defineProp("bondValence",{dataType:DataType.FLOAT,serializable:!1,getter:function(){return d.BondOrder.getBondValence(this.getBondOrder())},setter:null})}}),d.BondFormFactory={_bondForms:{},getBondFormId:function(e,t,r){var n="";return r&&(n+=r+"_"),e&&(n+=Number(e).toString()),t&&(n+="_"+Number(t).toString()),n},getBondForm:function(e,t,r){if(e||t||r){r||(r=d.BondType.DEFAULT),!t&&e&&r===d.BondType.COVALENT&&(t=2*d.BondOrder.getBondValence(e));var n=d.BondFormFactory.getBondFormId(e,t,r);return d.BondFormFactory._bondForms[n]||(d.BondFormFactory._bondForms[n]=new d.BondForm(e,t,r)),d.BondFormFactory._bondForms[n]}}},d.RadicalOrder={NONE:0,SINGLET:1,DOUBLET:2,TRIPLET:3,DEFAULT:0,getRadicalElectronCount:function(e){var t=d.RadicalOrder;return d.ObjUtils.isUnset(e)||e===t.NONE?0:e===t.DOUBLET?1:2}},d.HybridizationType={UNKNOWN:null,SP:1,SP2:2,SP3:3,NONE:0},d.ValenceUtils={getPossibleMdlValenceInfo:function(e,t){var r=Math.round(t),n=[],i=0,o=!1;switch(e){case 1:case 3:case 11:case 19:case 37:case 55:case 87:0===r?n=[1]:1===r?n=[0]:o=!0,i=1;break;case 4:case 12:case 20:case 38:case 56:case 88:switch(r){case 0:n=[2];break;case 1:n=[1];break;case 2:n=[0];break;default:o=!0}i=2;break;case 5:switch(r){case-4:n=[1];break;case-3:n=[2];break;case-2:n=[3,5];break;case-1:n=[4];break;case 0:n=[3];break;case 1:n=[2];break;case 2:n=[1];break;case 3:n=[0];break;default:o=!0}i=3;break;case 6:switch(r){case-4:n=[0];break;case-3:n=[1];break;case-2:n=[2];break;case-1:n=[3,5];break;case 0:n=[4];break;case 1:n=[3];break;case 2:n=[2];break;case 3:n=[1];break;case 4:n=[0];break;default:o=!0}i=4;break;case 7:switch(r){case-3:n=[0];break;case-2:n=[1];break;case-1:n=[2];break;case 0:n=[3,5];break;case 1:n=[4];break;case 2:n=[3];break;case 3:n=[2];break;case 4:n=[1];break;case 5:n=[0];break;default:o=!0}i=5;break;case 8:switch(r){case-2:n=[0];break;case-1:n=[1];break;case 0:n=[2];break;case 1:n=[3,5];break;case 2:n=[4];break;case 3:n=[3];break;case 4:n=[2];break;case 5:n=[1];break;case 6:n=[0];break;default:o=!0}i=6;break;case 9:switch(r){case-1:n=[0];break;case 0:n=[1];break;case 1:n=[2];break;case 2:n=[3,5];break;case 3:n=[4];break;case 4:n=[3];break;case 5:n=[2];break;case 6:n=[1];break;case 7:n=[0];break;default:o=!0}i=7;break;case 13:switch(r){case-4:n=[1,3,5,7];break;case-3:n=[2,4,6];break;case-2:n=[3,5];break;case-1:n=[4];break;case 0:n=[3];break;case 1:n=[2];break;case 2:n=[1];break;case 3:n=[0];break;default:o=!0}i=3;break;case 14:switch(r){case-4:n=[0];break;case-3:n=[1,3,5,7];break;case-2:n=[2,4,6];break;case-1:n=[3,5];break;case 0:n=[4];break;case 1:n=[3];break;case 2:n=[2];break;case 3:n=[1];break;case 4:n=[0]}i=4;break;case 15:switch(r){case-3:n=[0];break;case-2:n=[1,3,5,7];break;case-1:n=[2,4,6];break;case 0:n=[3,5];break;case 1:n=[4];break;case 2:n=[3];break;case 3:n=[2];break;case 4:n=[1];break;case 5:n=[0]}i=5;break;case 16:switch(r){case-2:n=[0];break;case-1:n=[1,3,5,7];break;case 0:n=[2,4,6];break;case 1:n=[3,5];break;case 2:n=[4];break;case 3:n=[3];break;case 4:n=[2];break;case 5:n=[1];break;case 6:n=[0]}i=6;break;case 17:switch(r){case-1:n=[0];break;case 0:n=[1,3,5,7];break;case 1:n=[2,4,6];break;case 2:n=[3,5];break;case 3:n=[4];break;case 4:n=[3];break;case 5:n=[2];break;case 6:n=[1];break;case 7:n=[0]}i=7;break;case 31:case 49:switch(r){case-4:n=[1,3,5,7];break;case-3:n=[2,4,6];break;case-2:n=[3,5];break;case-1:n=[4];break;case 0:n=[3];break;case 2:n=[1];break;case 3:n=[0];break;default:o=!0}i=3;break;case 32:switch(r){case-4:n=[0];break;case-3:n=[1,3,5,7];break;case-2:n=[2,4,6];break;case-1:n=[3,5];break;case 0:n=[4];break;case 1:n=[3];break;case 3:n=[1];break;case 4:n=[0]}i=4;break;case 33:switch(r){case-3:n=[0];break;case-2:n=[1,3,5,7];break;case-1:n=[2,4,6];break;case 0:n=[3,5];break;case 1:n=[4];break;case 2:n=[3];break;case 4:n=[1];break;case 5:n=[0]}i=5;break;case 34:switch(r){case-2:n=[0];break;case-1:n=[1,3,5,7];break;case 0:n=[2,4,6];break;case 1:n=[3,5];break;case 2:n=[4];break;case 3:n=[3];break;case 5:n=[1];break;case 6:n=[0]}i=6;break;case 35:switch(r){case-1:n=[0];break;case 0:n=[1,3,5,7];break;case 1:n=[2,4,6];break;case 2:n=[3,5];break;case 3:n=[4];break;case 4:n=[3];break;case 6:n=[1];break;case 7:n=[0]}i=7;break;case 50:case 82:switch(r){case-4:n=[0];break;case-3:n=[1,3,5,7];break;case-2:n=[2,4,6];break;case-1:n=[3,5];break;case 0:n=[2,4];break;case 1:n=[3];break;case 3:n=[1];break;case 4:n=[0]}i=4;break;case 51:case 83:switch(r){case-3:n=[0];break;case-2:n=[1,3,5,7];break;case-1:n=[2,4,6];break;case 0:n=[3,5];break;case 1:n=[2,4];break;case 2:n=[3];break;case 4:n=[1];break;case 5:n=[0]}i=5;break;case 52:case 84:switch(r){case-2:n=[0];break;case-1:n=[1,3,5,7];break;case 0:n=[2,4,6];break;case 1:n=[3,5];break;case 2:n=[2,4];break;case 3:n=[3];break;case 5:n=[1];break;case 6:n=[0]}i=6;break;case 53:case 85:switch(r){case-1:n=[0];break;case 0:n=[1,3,5,7];break;case 1:n=[2,4,6];break;case 2:n=[3,5];break;case 3:n=[2,4];break;case 4:n=[3];break;case 6:n=[1];break;case 7:n=[0]}i=7;break;case 81:switch(r){case-4:n=[1,3,5,7];break;case-3:n=[2,4,6];break;case-2:n=[3,5];break;case-1:n=[2,4];break;case 0:n=[1,3];break;case 3:n=[0];break;default:o=!0}i=3}if(o){var a=i-t;(a<0||a>8)&&(n=[])}return{valences:n,valenceElectronCount:i,unexpectedCharge:o}},getMaxPossibleMdlValence:function(e,t){var r=d.ValenceUtils.getPossibleMdlValenceInfo(e,t).valences;return r.length?r[r.length-1]:0},getImplicitMdlValence:function(e,t,r){var n=t,i=r;switch(e){case 1:case 3:case 11:case 19:case 37:case 55:case 87:if(0==n&&i<=1)return 1;break;case 4:case 12:case 20:case 38:case 56:case 88:switch(n){case 0:if(i<=2)return 2;break;case 1:if(i<=1)return 1}break;case 5:switch(n){case-4:if(i<=1)return 1;break;case-3:if(i<=2)return 2;break;case-2:if(i<=3)return 3;if(i<=5)return 5;break;case-1:if(i<=4)return 4;break;case 0:if(i<=3)return 3;break;case 1:if(i<=2)return 2;break;case 2:if(i<=1)return 1}break;case 6:switch(n){case-3:if(i<=1)return 1;break;case-2:if(i<=2)return 2;break;case-1:if(i<=3)return 3;if(i<=5)return 5;break;case 0:if(i<=4)return 4;break;case 1:if(i<=3)return 3;break;case 2:if(i<=2)return 2;break;case 3:if(i<=1)return 1}break;case 7:switch(n){case-2:if(i<=1)return 1;break;case-1:if(i<=2)return 2;break;case 0:if(i<=3)return 3;if(i<=5)return 5;break;case 1:if(i<=4)return 4;break;case 2:if(i<=3)return 3;break;case 3:if(i<=2)return 2;break;case 4:if(i<=1)return 1}break;case 8:switch(n){case-1:if(i<=1)return 1;break;case 0:if(i<=2)return 2;break;case 1:if(i<=3)return 3;if(i<=5)return 5;break;case 2:if(i<=4)return 4;break;case 3:if(i<=3)return 3;break;case 4:if(i<=2)return 2;break;case 5:if(i<=1)return 1}break;case 9:switch(n){case 0:case 6:if(i<=1)return 1;break;case 1:case 5:if(i<=2)return 2;break;case 2:if(i<=3)return 3;if(i<=5)return 5;break;case 3:if(i<=4)return 4;break;case 4:if(i<=3)return 3}break;case 13:switch(n){case-4:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-3:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case-2:if(i<=3)return 3;if(i<=5)return 5;break;case-1:if(i<=4)return 4;break;case 0:if(i<=3)return 3;break;case 1:if(i<=2)return 2;break;case 2:if(i<=1)return 1}break;case 14:switch(n){case-3:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-2:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case-1:if(i<=3)return 3;if(i<=5)return 5;break;case 0:if(i<=4)return 4;break;case 1:if(i<=3)return 3;break;case 2:if(i<=2)return 2;break;case 3:if(i<=1)return 1}break;case 15:switch(n){case-2:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-1:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 0:if(i<=3)return 3;if(i<=5)return 5;break;case 1:if(i<=4)return 4;break;case 2:if(i<=3)return 3;break;case 3:if(i<=2)return 2;break;case 4:if(i<=1)return 1}break;case 16:switch(n){case-1:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case 0:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 1:if(i<=3)return 3;if(i<=5)return 5;break;case 2:if(i<=4)return 4;break;case 3:if(i<=3)return 3;break;case 4:if(i<=2)return 2;break;case 5:if(i<=1)return 1}break;case 17:switch(n){case 0:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case 1:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 2:if(i<=3)return 3;if(i<=5)return 5;break;case 3:if(i<=4)return 4;break;case 4:if(i<=3)return 3;break;case 5:if(i<=2)return 2;break;case 6:if(i<=1)return 1}break;case 31:switch(n){case-4:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-3:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case-2:if(i<=3)return 3;if(i<=5)return 5;break;case-1:if(i<=4)return 4;break;case 0:if(i<=3)return 3;break;case 2:if(i<=1)return 1}break;case 32:switch(n){case-3:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-2:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case-1:if(i<=3)return 3;if(i<=5)return 5;break;case 0:if(i<=4)return 4;break;case 1:if(i<=3)return 3;break;case 3:if(i<=1)return 1}break;case 33:switch(n){case-2:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-1:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 0:if(i<=3)return 3;if(i<=5)return 5;break;case 1:if(i<=4)return 4;break;case 2:if(i<=3)return 3;break;case 4:if(i<=1)return 1}break;case 34:switch(n){case-1:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case 0:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 1:if(i<=3)return 3;if(i<=5)return 5;break;case 2:if(i<=4)return 4;break;case 3:if(i<=3)return 3;break;case 5:if(i<=1)return 1}break;case 35:switch(n){case 0:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case 1:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 2:if(i<=3)return 3;if(i<=5)return 5;break;case 3:if(i<=4)return 4;break;case 4:if(i<=3)return 3;break;case 6:if(i<=1)return 1}break;case 49:switch(n){case-4:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-3:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case-2:if(i<=3)return 3;if(i<=5)return 5;break;case-1:if(i<=2)return 2;if(i<=4)return 4;break;case 0:if(i<=3)return 3;break;case 2:if(i<=1)return 1}break;case 50:case 82:switch(n){case-3:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-2:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case-1:if(i<=3)return 3;if(i<=5)return 5;break;case 0:if(i<=2)return 2;if(i<=4)return 4;break;case 1:if(i<=3)return 3;break;case 3:if(i<=1)return 1}break;case 51:case 83:switch(n){case-2:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-1:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 0:if(i<=3)return 3;if(i<=5)return 5;break;case 1:if(i<=2)return 2;if(i<=4)return 4;break;case 2:if(i<=3)return 3;break;case 4:if(i<=1)return 1}break;case 52:case 84:switch(n){case-1:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case 0:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 1:if(i<=3)return 3;if(i<=5)return 5;break;case 2:if(i<=2)return 2;if(i<=4)return 4;break;case 3:if(i<=3)return 3;break;case 5:if(i<=1)return 1}break;case 53:case 85:switch(n){case 0:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case 1:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 2:if(i<=3)return 3;if(i<=5)return 5;break;case 3:if(i<=2)return 2;if(i<=4)return 4;break;case 4:if(i<=3)return 3;break;case 6:if(i<=1)return 1}break;case 81:switch(n){case-4:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-3:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case-2:if(i<=3)return 3;if(i<=5)return 5;break;case-1:if(i<=2)return 2;if(i<=4)return 4;break;case 0:if(i<=1)return 1;if(i<=3)return 3}}return i},getImplicitHydValence:function(e,t,r){var n=e,i=t,o=r,a=0;return 6==n?a=4-Math.abs(i):7==n||15==n?a=3+i:8!=n&&16!=n||(a=2+i),a<0&&(a=0),o>a&&(a=o),a}},d.ValenceUtils.getImplicitValence=d.ValenceUtils.getImplicitMdlValence,d.ValenceUtils.getMaxPossibleValence=d.ValenceUtils.getMaxPossibleMdlValence,function(){"use strict";var e=d.ArrayUtils;d.StructureComparationLevel={SKELETAL:1,CONSTITUTION:2,CONFIGURATION:3,EXACT:4,DEFAULT:4},d.globalOptions.add("algorithm.structureComparation",{structureComparationLevel:d.StructureComparationLevel.DEFAULT}),d.globalOptions.add("algorithm.structureClean",{structureCleanOptions:{orphanChemNode:!0,hangingChemConnector:!0}}),d.globalOptions.add("structure.implicitHydrogenEstimationStrategy",{targetElementCategories:{},targetElements:{},targetOrphanAtomElementCategories:{},targetOrphanAtomElements:{}}),d.globalOptions.structure.implicitHydrogenEstimationStrategy.targetOrphanAtomElementCategories[d.ElementCategory.METAL]=!1,d.ObjComparer.compareStructure=function(e,t,r){var n=Object.create(r||{});return n.method=d.ComparisonMethod.CHEM_STRUCTURE,d.ObjComparer.compare(e,t,n)},d.ObjComparer.equalStructure=function(e,t,r){return 0===d.ObjComparer.compareStructure(e,t,r)},d.ObjComparer.getStructureComparisonDetailOptions=function(e){var t=Object.extend({},e);if(e){var r,n=d.StructureComparationLevel,i=e.structureLevel||e.level||d.globalOptions.algorithm.structureComparation.structureComparationLevel,o=["atom","mass","linkedConnectorCount","charge","radical","stereo","hydrogenCount","connectedObjCount","bondType","bondOrder"];i===n.SKELETAL?r={atom:!1,mass:!1,linkedConnectorCount:!0,charge:!1,radical:!1,stereo:!1,hydrogenCount:!1,connectedObjCount:!0,bondType:!1,bondOrder:!1}:i===n.CONSTITUTION?r={atom:!0,mass:!1,linkedConnectorCount:!0,charge:!1,radical:!1,stereo:!1,hydrogenCount:!0,connectedObjCount:!0,bondType:!0,bondOrder:!0}:i===n.CONFIGURATION?r={atom:!0,mass:!1,linkedConnectorCount:!0,charge:!1,radical:!1,stereo:!0,hydrogenCount:!0,connectedObjCount:!0,bondType:!0,bondOrder:!0}:i===n.EXACT&&(r={atom:!0,mass:!0,linkedConnectorCount:!0,charge:!0,radical:!0,stereo:!0,hydrogenCount:!0,connectedObjCount:!0,bondType:!0,bondOrder:!0});for(var a=0,s=o.length;a<s;++a){var l=o[a],u="compare"+l.capitalizeFirst(),c=t[l];d.ObjUtils.isUnset(c)&&(c=t[u]),d.ObjUtils.isUnset(c)?(t[l]=r[l],t[u]=r[l]):(t[l]=c,t[u]=c)}}return t},d.ChemStructureObject=Class.create(d.ChemObject,{CLASS_NAME:"Kekule.ChemStructureObject",initialize:function(e){this.setPropStoreFieldValue("autoClearStructureCache",!0),this.tryApplySuper("initialize",[e])},doFinalize:function(){this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("linkedConnectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null}),this.defineProp("linkedObjs",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t)for(var n=this.getLinkedConnectorAt(t).getConnectedObjs(),i=0,o=n.length;i<o;++i){var a=n[i];a===this||this.hasChildObj&&this.hasChildObj(a)||d.ArrayUtils.pushUnique(e,n[i])}return e}}),this.defineProp("linkedSiblings",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=this.getParent(),r=0,n=this.getLinkedConnectorCount();r<n;++r)for(var i=this.getLinkedConnectorAt(r).getConnectedObjs(),o=0,a=i.length;o<a;++o){var s=i[o];s!==this&&e.indexOf(s)<0&&(s.getParent()!==t&&(s=t.getDirectChildOfNestedNode(s)),s&&e.push(s))}return e}}),this.defineProp("structureCache",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("structureCache");return!t&&e&&(t={},this.setPropStoreFieldValue("structureCache",t)),t}}),this.defineProp("autoClearStructureCache",{dataType:DataType.BOOL,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("linkedConnectors",[]),this.setSuppressChildChangeEventInUpdating(!0)},getAutoIdPrefix:function(){return"o"},getAcceptCoordStickFrom:function(e){return!1},doGetActualCompareOptions:function(e){if(e&&e.method===d.ComparisonMethod.CHEM_STRUCTURE){var t=d.ObjComparer.getStructureComparisonDetailOptions(e);return e.customMethod&&(t.customMethod=e.customMethod),e.extraComparisonProperties&&(t.extraComparisonProperties=e.extraComparisonProperties),t}return this.tryApplySuper("doGetActualCompareOptions",[e])},_getComparisonOptionFlagValue:function(e,t){var r=e["compare"+t.capitalizeFirst()];return d.ObjUtils.isUnset(r)&&(r=e[t]),r},doGetComparisonPropNames:function(e){return e.method===d.ComparisonMethod.CHEM_STRUCTURE?[]:this.tryApplySuper("doGetComparisonPropNames",[e])},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===d.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"linkedConnectorCount")){var n=this.getLinkedNonHydrogenConnectors(),i=e.getLinkedNonHydrogenConnectors&&e.getLinkedNonHydrogenConnectors();r=this.doCompareOnValue(n.length,i&&i.length,t)}return r},compareStructure:function(e,t){var r=Object.create(t||{});return r.method=d.ComparisonMethod.CHEM_STRUCTURE,this.compare(e,r)},equalStructure:function(e,t){return 0===this.compareStructure(e,t)},getParentFragment:function(){var e=this.getParent();return e instanceof d.StructureFragment?e:null},getRootFragment:function(){var e=this.getParentFragment();return e&&e.getRootFragment()||e},getStructureCacheData:function(e){var t=this.getStructureCache();return t&&t[e]},setStructureCacheData:function(e,t){return this.getStructureCache(!0)[e]=t,this},clearStructureCache:function(){return this.setPropStoreFieldValue("structureCache",null),this},needAutoClearStructureCache:function(){var e=this.getParent();return this.getAutoClearStructureCache()&&(!e||!e.needAutoClearStructureCache||e.needAutoClearStructureCache())},notifyLinkedConnectorsChanged:function(){this.notifyPropSet("linkedConnectors",this.getPropStoreFieldValue("linkedConnectors"))},getCurrConnectableObj:function(){return this},getActualConnectedObjToConnector:function(e){return this},getLinkedConnectorCount:function(){return this.getLinkedConnectors().length},getLinkedConnectorAt:function(e){return this.getLinkedConnectors()[e]},indexOfLinkedConnector:function(e){return this.getLinkedConnectors().indexOf(e)},appendLinkedConnector:function(e){var t=this._doAppendLinkedConnector(e);return e&&e._doAppendConnectedObj(this),t},_doAppendLinkedConnector:function(e){if(!e)return-1;var t=this.getPropStoreFieldValue("linkedConnectors"),r=d.ArrayUtils.pushUniqueEx(t,e);return r.isPushed&&this.notifyLinkedConnectorsChanged(),r.index},insertLinkedConnectorAt:function(e,t){t||(t=0);var r=this.indexOfLinkedConnector(e),n=this.getLinkedConnectors();r>=0?(n.splice(r,1),n.splice(t,0,e),this.notifyLinkedConnectorsChanged()):(n.splice(t,0,e),e&&e._doAppendConnectedObj(this),this.notifyLinkedConnectorsChanged())},insertLinkedConnectorBefore:function(e,t){var r=t?this.indexOfLinkedConnector(t):-1;return r<0?this.appendLinkedConnector(e):this.insertLinkedConnectorAt(e,r)},removeLinkedConnectorAt:function(e){var t=this.getLinkedConnectorAt(e);return t&&t._doRemoveConnectedObjAt(t.indexOfConnectedObj(this)),this._doRemoveLinkedConnectorAt(e)},_doRemoveLinkedConnectorAt:function(e){var t=d.ArrayUtils.removeAt(this.getLinkedConnectors(),e);return t&&this.notifyLinkedConnectorsChanged(),t},removeLinkedConnector:function(e){var t=this.getLinkedConnectors().indexOf(e);t>=0&&this.removeLinkedConnectorAt(t)},getConnectorTo:function(e){for(var t=0,r=this.getLinkedConnectorCount();t<r;++t){var n=this.getLinkedConnectorAt(t);if(n.hasConnectedObj(e))return n}return null},removeThisFromLinkedConnector:function(){for(var e=this.getLinkedConnectorCount()-1;e>=0;--e)this.getLinkedConnectorAt(e).removeConnectedObj(this)},getLinkedObjsOnConnector:function(e){for(var t=[],r=e.getConnectedObjs(),n=0,i=r.length;n<i;++n)r[n]!==this&&d.ArrayUtils.pushUnique(t,r[n]);return t},filterConnector:function(e){for(var t=[],r=0,n=this.getLinkedConnectorCount();r<n;++r){var i=this.getLinkedConnectorAt(r);e(i)&&d.ArrayUtils.pushUnique(t,i)}return t},getLinkedNonHydrogenConnectors:function(){var e=this;return this.filterConnector((function(t){var r=e.getLinkedObjsOnConnector(t);return r.length>1||!(r[0].isHydrogenAtom&&r[0].isHydrogenAtom())}))},getLinkedHydrogenConnectors:function(){var e=this;return this.filterConnector((function(t){var r=e.getLinkedObjsOnConnector(t);return 1===r.length&&r[0].isHydrogenAtom&&r[0].isHydrogenAtom()}))},getLinkedNonHydrogenObjs:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t)for(var n=this.getLinkedConnectorAt(t).getConnectedObjs(),i=0,o=n.length;i<o;++i)n[i]===this||n[i].isHydrogenAtom&&n[i].isHydrogenAtom()||d.ArrayUtils.pushUnique(e,n[i]);return e},getLinkedHydrogenAtoms:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t){var n=this.getLinkedConnectorAt(t);if(n instanceof d.Bond)for(var i=n.getConnectedObjs(),o=0,a=i.length;o<a;++o)i[o]!==this&&i[o].isHydrogenAtom&&i[o].isHydrogenAtom()&&d.ArrayUtils.pushUnique(e,i[o])}return e},getLinkedHydrogenAtomsWithSingleBond:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t){var n=this.getLinkedConnectorAt(t);if(n instanceof d.Bond&&n.isSingleBond()){var i=n.getConnectedObjs();if(2===i.length)for(var o=0,a=i.length;o<a;++o)i[o]!==this&&i[o].isHydrogenAtom&&i[o].isHydrogenAtom()&&d.ArrayUtils.pushUnique(e,i[o])}}return e},getLinkedHydrogenAtomsWithSingleBondCount:function(e){var t=this.getLinkedHydrogenAtomsWithSingleBond().length||0;return e&&(t+=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0),t},getPathesToDest:function(e){return this._doGetPathesToDest(e,[])},_doGetPathesToDest:function(t,r){if(t===this)return[];for(var n,i=[],o=e.clone(r),a=0,s=this.getLinkedConnectorCount();a<s;++a){var l=this.getLinkedConnectorAt(a);if(!(o.indexOf(l)>=0)){o.push(l);for(var d=l.getConnectedObjs(),u=0,c=d.length;u<c;++u){var h=d[u];if(h===t)n=[[]];else{if(h===this)continue;n=h&&h._doGetPathesToDest&&h._doGetPathesToDest(t,o)}if(n){for(var p={connector:l,object:h},g=0,f=n.length;g<f;++g)n[g].unshift(p);i=i.concat(n)}}}}return i.length||(i=null),i},getStructureRelatedPropNames:function(){return["linkedConnectors"]},structureChange:function(e){this.needAutoClearStructureCache()&&(this.clearStructureFlags(),this.clearStructureCache()),this.invokeEvent("structureChange",{origin:e||this})},clearStructureFlags:function(){},relayEvent:function(e,t){"structureChange"===e?this.structureChange(t.origin):this.tryApplySuper("relayEvent",[e,t])},doObjectChange:function(e){d.ArrayUtils.intersect(e||[],this.getStructureRelatedPropNames()).length&&this.structureChange()}}),d.SimpleStructureNode=Class.create(d.ChemStructureObject,{CLASS_NAME:"Kekule.SimpleStructureNode",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initProperties:function(){this.defineProp("zIndex2D",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["coord2D","coord3D"])},getAutoIdPrefix:function(){return"n"},getContainerBox:function(e,t){var r=this.getAbsCoordOfMode(e,t);return d.BoxUtils.createBox(r,r)},getContainerBox2D:function(e){return this.getContainerBox(d.CoordMode.COORD2D,e)},getContainerBox3D:function(e){return this.getContainerBox(d.CoordMode.COORD3D,e)}}),d.ClassDefineUtils.addStandardCoordSupport(d.SimpleStructureNode),d.BaseStructureNode=Class.create(d.SimpleStructureNode,{CLASS_NAME:"Kekule.BaseStructureNode",initProperties:function(){this.defineProp("coordStickTarget",{dataType:"Kekule.ChemStructureObject",objRef:!0,autoUpdate:!0,getter:function(){return this.getPropStoreFieldValue("coordStickTarget")},setter:function(e){if(e){if(!this.getAllowCoordStickTo(e))return void d.chemError(d.$L("ErrorMsg.COORD_STICK_NOT_ALLOWED_ON_CLASS"));var t=this.getOwner(),r=e.getOwner&&e.getOwner();if(r&&t!==r)return void d.chemError(d.$L("ErrorMsg.UNABLE_TO_STICK_TO_OTHER_OWNER_OBJ"));if(!e.getAcceptCoordStickFrom&&!e.getAcceptCoordStickFrom(this))return void d.chemError(d.$L("ErrorMsg.INVALID_STICK_TARGET_OBJ"));if(!e.getAbsCoordOfMode)return void d.chemError(d.$L("ErrorMsg.UNABLE_TO_STICK_TO_OBJ_WITHOUT_ABS_COORD"));if(e.getCoordStickTarget&&e.getCoordStickTarget()===this)return void d.chemError(d.$L("ErrorMsg.STICK_RECURSION_NOT_ALLOWED"))}var n=this.getCoordStickTarget();this.setPropStoreFieldValue("coordStickTarget",e),this._coordStickTargetChanged(n,e)}})},getAllowCoordStickTo:function(e){return!1},notifyCoordStickTargetChanged:function(e,t){},_getParentAbsCoord:function(e,t){var r=this.getCoordParent();return r&&r.getAbsCoordOfMode&&r.getAbsCoordOfMode(e,t)},_coordStickTargetChanged:function(e,t){e&&!t?this._copyAbsCoordFromStickedTarget(e,this.getCoordParent()):t&&this._copyAbsCoordFromStickedTarget(t,this.getCoordParent()),e&&e.detachCoordStickNodes&&e.detachCoordStickNodes(this),t&&t.attachCoordStickNodes&&t.attachCoordStickNodes(this),this.notifyCoordStickTargetChanged(e,t)},_copyAbsCoordFromStickedTarget:function(e,t,r){var n=d.CoordUtils,i=d.CoordMode;t||(t=this.getCoordParent());var o=r&&r!==i.COORD2D?null:e.getAbsCoord2D(),a=r&&r!==i.COORD2D?null:e.getAbsCoord3D();if(t){if(o){var s=t.getAbsCoord2D&&t.getAbsCoord2D();s&&(o=n.substract(o,s))}if(a){var l=t.getAbsCoord3D&&t.getAbsCoord3D();l&&(a=n.substract(a,l))}}o&&this.setPropStoreFieldValue("coord2D",o),a&&this.setPropStoreFieldValue("coord3D",a)},doGetCoord2D:function(e,t){var r=this.getCoordStickTarget();if(r&&r.getAbsCoord2D){var n=r.getAbsCoord2D(e,t),i=this._getParentAbsCoord(d.CoordMode.COORD2D,e);return i&&(n=d.CoordUtils.substract(n,i)),n}return this.tryApplySuper("doGetCoord2D",[e,t])},doGetCoord3D:function(e,t){var r=this.getCoordStickTarget();if(r&&r.getAbsCoord3D){var n=r.getAbsCoord3D(e,t),i=this._getParentAbsCoord(d.CoordMode.COORD3D,e);return i&&(n=d.CoordUtils.substract(n,i)),n}return this.tryApplySuper("doGetCoord3D",[e,t])},isOrphan:function(){var e=this.getParent();return!e||e.getChildCount()<=1}}),d.StereoParity={NONE:null,ODD:1,EVEN:2,UNKNOWN:0},d.ChemStructureNode=Class.create(d.BaseStructureNode,{CLASS_NAME:"Kekule.ChemStructureNode",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initProperties:function(){this.defineProp("charge",{dataType:DataType.FLOAT,getter:function(){return this.getPropStoreFieldValue("charge")||0}}),this.defineProp("radical",{dataType:DataType.INT}),this.defineProp("parity",{dataType:DataType.INT}),this.defineProp("isAnchor",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getParent();return!(!e||!e.indexOfAnchorNode)&&e.indexOfAnchorNode(this)>=0},setter:function(e){if(e!==this.getIsAnchor()){var t=this.getParent();t&&(e&&t.appendAnchorNode()?t.appendAnchorNode(this):!e&&t.removeAnchorNode&&t.removeAnchorNode(this))}}})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["charge","radical"])},getLabel:function(){return null},getAcceptCoordStickFrom:function(e){return!(this.isSiblingWith(e)||e instanceof d.ChemStructureNode)},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===d.ComparisonMethod.CHEM_STRUCTURE&&(this._getComparisonOptionFlagValue(e,"charge")&&t.push("charge"),this._getComparisonOptionFlagValue(e,"radical")&&t.push("radical")),t},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===d.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"stereo")){var n=this.getParity()||d.StereoParity.UNKNOWN,i=e.getParity&&e.getParity()||d.StereoParity.UNKNOWN;r=this.doCompareOnValue(n,i,t)}return r},getPrimaryIsotope:function(){return null},getLinkedChemNodes:function(e){for(var t=this.getLinkedObjs(),r=[],n=0,i=t.length;n<i;++n){var o=t[n];!(o instanceof d.ChemStructureNode)||e&&o.isHydrogenAtom&&o.isHydrogenAtom()||r.push(o)}return r},getLinkedBonds:function(e){for(var t=[],r=0,n=this.getLinkedConnectorCount();r<n;++r){var i=this.getLinkedConnectorAt(r);i instanceof d.Bond&&(!e||i.getBondType()===e)&&t.push(i)}return t},getLinkedMultiCenterBonds:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t){var n=this.getLinkedConnectorAt(t);n instanceof d.Bond&&n.getConnectedObjCount()>2&&e.push(n)}return e},getLinkedMultipleBonds:function(){for(var e=d.BondOrder,t=[],r=0,n=this.getLinkedConnectorCount();r<n;++r){var i=this.getLinkedConnectorAt(r);if(i instanceof d.Bond&&i.getBondType()===d.BondType.COVALENT){var o=i.getBondOrder();o!==e.DOUBLE&&o!==e.TRIPLE&&o!==e.QUAD&&o!==e.EXPLICIT_AROMATIC||t.push(i)}}return t},getLinkedDoubleBonds:function(){for(var e=d.BondOrder,t=[],r=0,n=this.getLinkedConnectorCount();r<n;++r){var i=this.getLinkedConnectorAt(r);i instanceof d.Bond&&i.getBondType()===d.BondType.COVALENT&&i.getBondOrder()===e.DOUBLE&&t.push(i)}return t},clearStructureFlags:function(){this.setPropStoreFieldValue("parity",d.StereoParity.NONE)},isHydrogenAtom:function(){return!1},_getBondsValenceInfo:function(e){for(var t=0,r=0,n=this.getStructureCacheData("piElectronCount")||null,i=0,o=e.length;i<o;++i){var a,s=e[i];s instanceof d.Bond&&(t+=a=s.getBondType()==d.BondType.COVALENT&&s.getBondOrder()===d.BondOrder.EXPLICIT_AROMATIC&&n>=2?1:s.getBondValence(),a>r&&(r=a))}return{valenceSum:t,maxValence:r}},_getCurrCovalentBondsInfo:function(){return this._getBondsValenceInfo(this.filterConnector((function(e){return e instanceof d.Bond&&e.getBondType()==d.BondType.COVALENT})))},_getCurrIonicBondsInfo:function(e){return this._getBondsValenceInfo(this.filterConnector((function(e){return e instanceof d.Bond&&e.getBondType()==d.BondType.IONIC})))}}),d.RadicalType=d.RadicalOrder,d.AbstractAtom=Class.create(d.ChemStructureNode,{CLASS_NAME:"Kekule.AbstractAtom",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},initProperties:function(){this.defineProp("explicitHydrogenCount",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED,setter:function(e){var t=parseFloat(e),r=isNaN(t)||t<0?void 0:t;this.setPropStoreFieldValue("explicitHydrogenCount",r)}})},getAutoIdPrefix:function(){return"a"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["explicitHydrogenCount"])},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===d.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"hydrogenCount")){var n=this.getHydrogenCount(!0),i=e.getHydrogenCount&&e.getHydrogenCount(!0);r=this.doCompareOnValue(n,i,t)}return r},getHydrogenCount:function(e){var t=this.getExplicitHydrogenCount()||0;return e&&(t+=this.getLinkedHydrogenAtomsWithSingleBondCount(!1)),t+(this.getStructureCacheData("omittedBondHydrogenAtomCount")||0)},setHydrogenCount:function(e){return this.setExplicitHydrogenCount(e)},hasExplicitHydrogens:function(){return d.ObjUtils.notUnset(this.getExplicitHydrogenCount())},isSaturated:function(){return!this.getLinkedMultipleBonds().length},mayContainElement:function(e){var t;return t="string"==typeof e?d.ChemicalElementsDataUtil.getAtomicNumber(e):e,this.doMayContainElement(t)},doMayContainElement:function(e){return!1}}),d.Atom=Class.create(d.AbstractAtom,{CLASS_NAME:"Kekule.Atom",initialize:function(e,t,r,n,i){this.tryApplySuper("initialize",[e,n,i]),(t||r)&&this.changeIsotope(t,r)},initProperties:function(){this.defineProp("isotope",{dataType:"Kekule.Isotope",serializable:!1}),this.defineProp("isotopeId",{dataType:DataType.STRING,serializable:!0,getter:function(){var e=this.getIsotope();return e?e.getIsotopeId():d.Element.UNSET_ELEMENT},setter:function(e){var t=d.IsotopeFactory.getIsotopeById(e);t&&this.setIsotope(t)}}),this.defineProp("symbol",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this.getIsotope();return e?e.getSymbol():d.Element.UNSET_ELEMENT},setter:function(e){this.changeElement(e)}}),this.defineProp("atomicNumber",{dataType:DataType.INTEGER,serializable:!1,getter:function(){var e=this.getIsotope();return e?e.getAtomicNumber():0},setter:function(e){this.changeElement(e)}}),this.defineProp("massNumber",{dataType:DataType.INTEGER,getter:function(){var e=this.getIsotope();return e?e.getMassNumber():d.Isotope.UNSET_MASSNUMBER},setter:function(e){this.changeMassNumber(e)}}),this.defineProp("isotopeAlias",{dataType:DataType.STRING,getter:function(){var e=this.getIsotope();return e?e.getIsotopeAlias():void 0},setter:function(e){this.changeElement(e)}}),this.defineProp("atomType",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("atomTypeId",{dataType:DataType.STRING,getter:function(){var e=this.getPropStoreFieldValue("atomType");return e?e.id:d.AtomType.UNSET_ATOMTYPE},setter:function(e){if(this.isNormalAtom()){var t=d.AtomTypeDataUtil.getAtomTypeFromId(this.getAtomicNumber(),e);this.setAtomType(t)}}}),this.defineProp("hybridizationType",{dataType:DataType.INT,enumSource:d.HybridizationType}),this.defineProp("disableImplicitHydrogenEstimation",{dataType:DataType.BOOL})},getAutoIdPrefix:function(){return"a"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["isotope","atomType"])},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===d.ComparisonMethod.CHEM_STRUCTURE&&(this._getComparisonOptionFlagValue(e,"mass")&&t.unshift("massNumber"),this._getComparisonOptionFlagValue(e,"atom")&&t.unshift("atomicNumber")),t},getPrimaryIsotope:function(){return this.getIsotope()},getLabel:function(){return""+(this.getMassNumber()||"")+this.getSymbol()},doMayContainElement:function(e){return this.getAtomicNumber()===e},changeIsotope:function(e,t){e===d.Element.UNSET_ELEMENT?t=d.Isotope.UNSET_MASSNUMBER:e||(e=this.getAtomicNumber()),t||(t=d.Isotope.UNSET_MASSNUMBER),this.getAtomicNumber()!==e&&this.setAtomType(d.AtomType.UNSET_ATOMTYPE);var r=d.IsotopeFactory.getIsotope(e,t);this.setIsotope(r)},changeElement:function(e){return this.changeIsotope(e,d.Isotope.UNSET_MASSNUMBER)},changeMassNumber:function(e){return this.changeIsotope(null,e)},isElement:function(e){return this.getSymbol()===e||this.getAtomicNumber()===e},getElementSeries:function(){var e=this.getIsotope();return e&&e.getSeries()},isNormalAtom:function(){var e=this.getIsotope();return!!e&&e.isNormalElement()},isHydrogenAtom:function(){return this.isElement(1)&&(!this.getMassNumber()||this.getMassNumber()<=1)},guessAtomType:function(){if(this.isNormalAtom()){var e=null,t=null,r=this._getCurrCovalentBondsInfo(),n=d.AtomTypeDataUtil.getAllAtomTypes(this.getAtomicNumber());if(n){for(var i=0,o=n.length;i<o;++i){var a=n[i];if(t=a,a.bondOrderSum>=r.valenceSum&&(e=a,a.maxBondOrder>=r.maxValence))return a}return e||t}}return null},getProximalAtomType:function(){return this.getAtomType()||this.guessAtomType()},getImplicitValence:function(){if(this.isNormalAtom()){var e=this._getCurrCovalentBondsInfo().valenceSum,t=Math.round(this.getCharge()||0);return d.ValenceUtils.getImplicitValence(this.getAtomicNumber(),t,e)}return 0},getExplicitValence:function(e){var t=e||{};if(this.isNormalAtom()){var r=this._getCurrCovalentBondsInfo().valenceSum;return t.ignoreBondHydrogens?r-=(this.getLinkedHydrogenAtomsWithSingleBond()||[]).length:r+=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0,t.ignoreExplicitHydrogens||(r+=this.getExplicitHydrogenCount()||0),r}return 0},getValence:function(e){var t=e||{};if(this.isNormalAtom()){var r,n=this.getExplicitValence(t);if(this.hasExplicitHydrogens())r=n;else{var i=t.ignoreCharge?0:Math.round(this.getCharge()||0);r=d.ValenceUtils.getImplicitValence(this.getAtomicNumber(),i,n)}return r}return 0},getImplicitHydrogenCount:function(e){if(this.isNormalAtom()&&this._needToEsitmateImplicityHydrogens()){var t=this._getCurrCovalentBondsInfo(),r=this._getCurrIonicBondsInfo(),n=Math.round(this.getCharge()||0),i=d.RadicalOrder.getRadicalElectronCount(this.getRadical()),o=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0;return d.ChemStructureUtils.getImplicitHydrogenCount(this.getAtomicNumber()||0,{coValenceBondValenceSum:(t.valenceSum||0)+o,otherBondValenceSum:r.valenceSum||0,charge:n,radicalECount:i})}return 0},_needToEsitmateImplicityHydrogens:function(){var e=!this.getDisableImplicitHydrogenEstimation();if(e){var t=this.isOrphan(),r=this.getSymbol(),n=d.globalOptions.get("structure.implicitHydrogenEstimationStrategy")||{};if((n.targetElements&&!1===n.targetElements[r]||t&&n.targetOrphanAtomElements&&!1===n.targetOrphanAtomElements[r])&&(e=!1),e)for(var i=n.targetElementCategories,o=n.targetOrphanAtomElementCategories,a=this.getIsotope().getCategories(),s=0,l=a.length;s<l;++s){var u=a[s];if(i&&!1===i[u]||t&&o&&!1===o[u]){e=!1;break}}}return e},getHydrogenCount:function(e){var t=this.tryApplySuper("getHydrogenCount",[e]);return d.ObjUtils.isUnset(this.getExplicitHydrogenCount())&&(t+=this.getImplicitHydrogenCount()||0),t},getAtomicMass:function(){var e=null,t=this.getIsotope();return t&&(e=t.getExactMass()||t.getNaturalMass()),e}}),d.PseudoatomType={DUMMY:"dummy",ANY:"any",HETERO:"hetero",CUSTOM:"custom"},d.Pseudoatom=Class.create(d.AbstractAtom,{CLASS_NAME:"Kekule.Pseudoatom",initialize:function(e,t,r,n,i){this.tryApplySuper("initialize",[e,n,i]),t&&this.setAtomType(t),r&&t==d.PseudoatomType.CUSTOM&&this.setSymbol(r)},initProperties:function(){this.defineProp("atomType",{dataType:DataType.STRING,enumSource:d.PseudoatomType}),this.defineProp("symbol",{dataType:DataType.STRING,getter:function(){var e=this.getAtomType(),t=d.PseudoatomType,r=d.ChemStructureNodeLabels;return e===t.DUMMY?r.DUMMY_ATOM:e===t.ANY?r.ANY_ATOM:e===t.HETERO?r.HETERO_ATOM:this.getPropStoreFieldValue("symbol")||r.CUSTOM_ATOM},setter:function(e){var t=d.PseudoatomType,r=d.ChemStructureNodeLabels;if(e){var n=e===r.DUMMY_ATOM?t.DUMMY:e===r.ANY_ATOM?t.ANY:e===r.HETERO_ATOM?t.HETERO:t.CUSTOM;this.setAtomType(n)}this.setPropStoreFieldValue("symbol",e)}})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["atomType","symbol"])},getPrimaryIsotope:function(){return null},getLabel:function(){return this.getSymbol()},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===d.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(e,"atom")&&t.push("atomType"),t},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===d.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"atom")&&this.getAtomType()===d.PseudoatomType.CUSTOM){var n=this.getSymbol(),i=e.getSymbol&&e.getSymbol();r=this.doCompareOnValue(n,i,t)}return r},doMayContainElement:function(e){var t=d.PseudoatomType,r=this.getAtomType();return r===t.ANY||r===t.HETERO&&!([1,6].indexOf(e)>=0)&&"Nonmetals"===d.ChemicalElementsDataUtil.getElementInfo(e).chemicalSerie}}),d.VariableAtom=Class.create(d.AbstractAtom,{CLASS_NAME:"Kekule.VariableAtom",initProperties:function(){this.defineProp("allowedIsotopeIds",{dataType:DataType.ARRAY,getter:function(e){var t=this.getPropStoreFieldValue("allowedIsotopeIds");return!t&&e&&(t=[],this.setPropStoreFieldValue("allowedIsotopeIds",t)),t}}),this.defineProp("disallowedIsotopeIds",{dataType:DataType.ARRAY,getter:function(e){var t=this.getPropStoreFieldValue("disallowedIsotopeIds");return!t&&e&&(t=[],this.setPropStoreFieldValue("disallowedIsotopeIds",t)),t}}),this.defineProp("allowedIsotopes",{dataType:DataType.ARRAY,setter:null,getter:function(){return this._getIsotopesFromIds(this.getAllowedIsotopeIds())}}),this.defineProp("disallowedIsotopes",{dataType:DataType.ARRAY,setter:null,getter:function(){return this._getIsotopesFromIds(this.getDisallowedIsotopeIds())}})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["allowedIsotopeIds","disallowedIsotopeIds"])},getPrimaryIsotope:function(){if(this.isDisallowedList())return null;var e=this.getAllowedIsotopeIds(),t=e?e[0]:null;return t?d.IsotopeFactory.getIsotopeById(t):null},getLabel:function(){return d.ChemStructureNodeLabels.VARIABLE_ATOM},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===d.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"atom")){var n=d.ArrayUtils,i=this.getAllowedIsotopeIds(),o=e.getAllowedIsotopeIds&&e.getAllowedIsotopeIds();if(i)i=n.clone(i).sort(),o&&o.length&&(o=n.clone(o).sort()),r=this.doCompareOnValue(i,o,t);else if(o)r=1;else{var a=this.getDisallowedIsotopeIds(),s=e.getDisallowedIsotopeIds&&e.getDisallowedIsotopeIds();a&&a.length&&(a=n.clone(a).sort()),s&&s.length&&(s=n.clone(s).sort()),r=this.doCompareOnValue(a,s,t)}}return r},doMayContainElement:function(e){var t=function(e,t){if(!t)return!1;for(var r=0,n=t.length;r<n;++r){var i=t[r],o=d.IsotopesDataUtil.getIsotopeIdDetail(i).symbol;if(d.ChemicalElementsDataUtil.getAtomicNumber(o)===e)return!0}return!1},r=this.getAllowedIsotopeIds();return r?t(e,r):(r=this.getDisallowedIsotopeIds())?!t(e,r):void 0},isDisallowedList:function(){return this.getDisallowedIsotopeIds()&&!this.getAllowedIsotopeIds()},isListEmpty:function(){var e=this.getAllowedIsotopeIds(),t=!e||!e.length;return t&&(t=!(e=this.getDisallowedIsotopeIds())||!e.length),t},fetchAllowedIsotopeIds:function(){return this.doGetAllowedIsotopeIds(!0)},fetchDisallowedIsotopeIds:function(){return this.doGetDisallowedIsotopeIds(!0)},_getIsotopesFromIds:function(e){if(!e)return null;for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r],o=d.IsotopeFactory.getIsotopeById(i);o&&t.push(o)}return t}}),d.MolecularFormula=Class.create(ObjectEx,{CLASS_NAME:"Kekule.MolecularFormula",initialize:function(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("sections",[]),e&&this.setPropStoreFieldValue("parent",e),this.setBubbleEvent(!0)},initProperties:function(){this.defineProp("parent",{dataType:"Kekule.StructureFragment",serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("sections",{dataType:DataType.ARRAY,setter:null}),this.defineProp("charge",{dataType:DataType.FLOAT,getter:function(){return this.getPropStoreFieldValue("charge")||0}}),this.defineProp("radical",{dataType:DataType.INT,getter:function(){return this.getPropStoreFieldValue("radical")||0}})},getHigherLevelObj:function(){return this.getParent()},isEmpty:function(){return this.getSectionCount()<=0},notifySectionsChanged:function(){this.notifyPropSet("sections",this.getPropStoreFieldValue("sections"))},createSectionItem:function(e,t,r){var n={obj:e,count:t||1};return r&&e.setCharge(r),e.setParent&&e.setParent(this.getParent()),n},getTotalCharge:function(){for(var e=0,t=this.getSections(),r=0,n=t.length;r<n;++r)t[r].obj.getCharge&&(e+=t[r].obj.getCharge()*(t.count||1));return this.getCharge()&&(e+=this.getCharge()),e},indexOfObj:function(e){for(var t=this.getSections(),r=0,n=t.length;r<n;++r)if(t[r].obj==e)return r;return-1},getSectionCount:function(){return this.getSections().length},getSectionAt:function(e){return this.getSections()[e]},getSectionCharge:function(e){var t,r=0;return(t="object"!=typeof e?this.getSectionAt(e):e).obj.getCharge&&(r+=t.obj.getCharge()||0),r},appendSection:function(e,t,r){var n=this.createSectionItem(e,t,r);return this.getSections().push(n),this.notifySectionsChanged(),n},insertSection:function(e,t,r,n){var i=this.createSectionItem(t,r,n);return this.getSections().splice(e,0,i),this.notifySectionsChanged(),i},removeSectionAt:function(e){var t=this.getSections().splice(e,1);return t&&this.notifySectionsChanged(),t},clear:function(){this.beginUpdate();try{this.setCharge(null),this.setRadical(null),this.setPropStoreFieldValue("sections",[]),this.notifySectionsChanged()}finally{this.endUpdate()}},removeObj:function(e){var t=this.indexOfObj(e);if(!(t>=0))return null;this.removeSectionAt(t),this.notifySectionsChanged()},getMaxNestedLevel:function(){for(var e=0,t=0,r=this.getSectionCount();t<r;++t){var n=this.getSectionAt(t);if(n.obj instanceof d.MolecularFormula){var i=n.obj.getMaxNestedLevel()+1;i>e&&(e=i)}}return e},getSimpleIsotopeMaps:function(){}}),d.StructureConnectionTable=Class.create(ObjectEx,{CLASS_NAME:"Kekule.StructureConnectionTable",TRAVERS_VISITED_KEY:"__$ctabTraversVisited__",initialize:function(e,t){this.tryApplySuper("initialize"),e&&this.setOwner(e),t&&this.setPropStoreFieldValue("parent",t)},initProperties:function(){this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){e!=this.getPropStoreFieldValue("owner")&&(this.setPropStoreFieldValue("owner",e),this.ownerChanged(e))}}),this.defineProp("parent",{dataType:"Kekule.StructureFragment",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){e!=this.getPropStoreFieldValue("parent")&&(this.setPropStoreFieldValue("parent",e),this.parentChanged(e))}}),this.defineProp("nodes",{dataType:DataType.ARRAY}),this.defineProp("anchorNodes",{dataType:DataType.ARRAY,setter:null}),this.defineProp("connectors",{dataType:DataType.ARRAY}),this.defineProp("nonHydrogenNodes",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){for(var e=[],t=0,r=this.getNodeCount();t<r;++t){var n=this.getNodeAt(t);n instanceof d.ChemStructureNode&&(n.isHydrogenAtom&&n.isHydrogenAtom()||e.push(n))}return e}}),this.defineProp("nonHydrogenConnectors",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){for(var e=[],t=0,r=this.getConnectorCount();t<r;++t){var n=this.getConnectorAt(t);n.isNormalConnectorToHydrogen&&n.isNormalConnectorToHydrogen()||e.push(n)}return e}}),this.defineProp("structureCache",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(e){var t=this.getParent();return t&&t.getStructureCache(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("nodes",[]),this.setPropStoreFieldValue("anchorNodes",[]),this.setPropStoreFieldValue("connectors",[])},getHigherLevelObj:function(){return this.getParent()||this.getOwner()},doSaveProp:function(e,t,r,n){var i=t.name;switch(i){case"anchorNodes":for(var o=[],a=0,s=e.getAnchorNodeCount();a<s;++a){var l=e.getAnchorNodeAt(a),d=e.indexOfNode(l);o.push(d)}var u=n.createChildStorageNode(r,n.propNameToStorageName(i),!0);return n.save(o,u),!0;case"connectors":for(u=n.createChildStorageNode(r,n.propNameToStorageName(i),!0),a=0,s=e.getConnectorCount();a<s;++a){var c=e.getConnectorAt(a),h=n.getNameForArrayItemStorageNode(c),p=n.appendArrayItemStorageNode(u,n.propNameToStorageName(h),n.isArray(c));n.setStorageNodeExplicitType(p,n.getValueExplicitType(c)),n.save(c,p);for(var g=[],f=0,m=c.getConnectedObjCount();f<m;++f){var C=c.getConnectedObjAt(f);if((d=e.indexOfChild(C))>=0)g.push(d);else{var y=e.indexStackOfChild(C);null!=y&&g.push(y)}}if(g.length){var _=n.createChildStorageNode(p,n.propNameToStorageName("connectedObjs"),!0);n.save(g,_)}}return!0;default:return!1}},doLoadProp:function(e,t,r,n){var i=t.name;switch(i){case"anchorNodes":var o=[],a=n.getChildStorageNode(r,n.propNameToStorageName(i));return n.load(o,a),e.__load_anchorNodes_indexes=o,!0;case"connectors":a=n.getChildStorageNode(r,n.propNameToStorageName(i));for(var s,l=n.getAllArrayItemStorageNodes(a),d=0,u=l.length;d<u;++d){var c=l[d],h=n.getStorageNodeExplicitType(c)||n.getStorageNodeName(c);if(h){s=DataType.createInstance(h),n.load(s,c);var p=n.getChildStorageNode(c,n.propNameToStorageName("connectedObjs"));if(p){var g=[];n.load(g,p),s.__load_connectedObj_indexes=g}var f=n.getChildStorageNode(c,n.propNameToStorageName("connectedNodes"));if(f){var m=[];n.load(m,f),s.__load_connectedNode_indexes=m}var C=n.getChildStorageNode(c,n.propNameToStorageName("connectedConnectors"));if(C){var y=[];n.load(y,C),s.__load_connectedConnector_indexes=y}e.appendConnector(s)}}return!0;default:return!1}},loaded:function(){if(this.__load_anchorNodes_indexes){for(var e=0,t=this.__load_anchorNodes_indexes.length;e<t;++e){var r=this.__load_anchorNodes_indexes[e];this.appendAnchorNode(this.getNodeAt(r))}delete this.__load_anchorNodes_indexes}for(e=0,t=this.getConnectorCount();e<t;++e){var n=this.getConnectorAt(e);if(n.__load_connectedObj_indexes){for(var i=0,o=n.__load_connectedObj_indexes.length;i<o;++i){var a;(a="object"==typeof(r=n.__load_connectedObj_indexes[i])?this.getChildAtIndexStack(r):this.getChildAt(r))&&n.appendConnectedObj(a)}delete n.__load_connectedObj_indexes}if(n.__load_connectedNode_indexes){for(i=0,o=n.__load_connectedNode_indexes.length;i<o;++i)"object"==typeof(r=n.__load_connectedNode_indexes[i])?n.appendConnectedObj(this.getNodeAtIndexStack(r)):n.appendConnectedObj(this.getNodeAt(r));delete n.__load_connectedNode_indexes}if(n.__load_connectedConnector_indexes){for(i=0,o=n.__load_connectedConnector_indexes.length;i<o;++i)r=n.__load_connectedConnector_indexes[i],n.appendConnectedObj(this.getConnectorAt(r));delete n.__load_connectedConnector_indexes}}this.ownerChanged(this.getOwner()),this.parentChanged(this.getParent()),this.tryApplySuper("loaded")},notifyNodesChanged:function(){this.notifyPropSet("nodes",this.getPropStoreFieldValue("nodes"))},notifyAnchorNodesChanged:function(){this.notifyPropSet("anchorNodes",this.getPropStoreFieldValue("anchorNodes"))},notifyConnectorsChanged:function(){this.notifyPropSet("connectors",this.getPropStoreFieldValue("connectors"))},ownerChanged:function(e){for(var t=0,r=this.getNodeCount();t<r;++t)this.getNodeAt(t).setOwner(e);for(t=0,r=this.getConnectorCount();t<r;++t)this.getConnectorAt(t).setOwner(e)},parentChanged:function(e,t){for(var r=0,n=this.getNodeCount();r<n;++r)this.getNodeAt(r).setParent(e);for(r=0,n=this.getConnectorCount();r<n;++r)this.getConnectorAt(r).setParent(e)},isEmpty:function(){return this.getNodeCount()<=0&&this.getConnectorCount()<=0},getStructureCacheData:function(e){var t=this.getStructureCache();return t&&t[e]},setStructureCacheData:function(e,t){var r=this.getParent();return r&&r.setStructureCacheData&&r.setStructureCacheData(e,t),this},clearStructureCache:function(){var e=this.getParent();return e&&e.clearStructureCache(),this},getNodeById:function(e){for(var t=this.getNodes(),r=0,n=t.length;r<n;++r)if(t[r].getId()==e)return t[r];return null},getConnectorById:function(e){for(var t=this.getConnectors(),r=0,n=t.length;r<n;++r)if(t[r].getId()==e)return t[r];return null},getObjectById:function(e){return this.getNodeById(e)||this.getConnectorById(e)},getNodeCount:function(){return this.getNodes().length},getNodeAt:function(e){return this.getNodes()[e]},indexOfNode:function(e){return this.getNodes().indexOf(e)},hasNode:function(e,t){var r=this.indexOfNode(e)>=0;if(!r&&t)for(var n=0,i=this.getNodeCount();n<i;++n){var o=this.getNodeAt(n);if(o.hasNode&&(r=o.hasNode(e,!0)),r)break}return r},indexStackOfNode:function(e){var t=this.indexOfNode(e);if(t>=0)return t;for(var r=null,n=0,i=this.getNodeCount();n<i;++n){var o=this.getNodeAt(n);if(o.indexStackOfNode&&(r=o.indexStackOfNode(e),!d.ObjUtils.isUnset(r)))return"object"!=typeof r&&(r=[r]),r.unshift(n),r}return r},getNodeAtIndexStack:function(e){if((e=d.ArrayUtils.toArray(e)).length<=0)return null;for(var t=this.getNodeAt(e[0]),r=1,n=e.length;r<n;++r){if(!t||!t.getNodeAt)return null;t=t.getNodeAt(e[r])}return t},insertNodeBefore:function(e,t){var r=this.indexOfNode(t);r?this.insertNodeAt(e,r):this.appendNode(e)},appendNode:function(e){var t=d.ArrayUtils.pushUniqueEx(this.getNodes(),e);return t.isPushed&&(e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent()),this.notifyNodesChanged()),t.index},insertNodeAt:function(e,t){var r=this.indexOfNode(e),n=this.getNodes();return(d.ObjUtils.isUnset(t)||t<0)&&(t=n.length),r>=0?(n.splice(r,1),n.splice(t,0,e)):(n.splice(t,0,e),e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent())),this.notifyNodesChanged(),t},setNodeIndex:function(e,t){var r=this.getNodes(),n=this.indexOfNode(e);n>=0&&(r.splice(n,1),r.splice(t,0,e))},removeNodeAt:function(e,t){var r=this.getNodes()[e];r&&(t||r.removeThisFromLinkedConnector(),this.getNodes().splice(e,1),r.setOwner&&r.setOwner(null),r.setParent&&r.setParent(null),this.notifyNodesChanged())},removeNode:function(e,t){var r=this.getNodes().indexOf(e);r>=0&&this.removeNodeAt(r,t)},replaceNode:function(e,t){if(!this.hasNode(e))return this;this.insertBefore(t,e);var r=this.getAnchorNodes(),n=r.indexOf(e);n>=0&&r.splice(n,1,[t]);for(var i=d.ArrayUtils.clone(e.getLinkedConnectors()),o=0,a=i.length;o<a;++o)(l=i[o]).replaceConnectedObj(e,t);if(e.getNodes&&e.getCrossConnectors){var s=d.ArrayUtils.clone(e.getCrossConnectors());for(o=0,a=s.length;o<a;++o){var l=s[o];if(this.indexOfConnector(l)>=0)for(var u=0,c=l.getConnectedObjCount();u<c;++u){var h=l.getConnectedObjAt(u);e.indexOfChild(h)>=0&&l.replaceConnectedObj(h,t)}l.replaceConnectedObj(e,t)}}this.removeNode(e)},clearNodes:function(){this.clearAnchorNodes(),this.setPropStoreFieldValue("nodes",[]),this.notifyAnchorNodesChanged(),this.notifyNodesChanged()},sortNodes:function(e){e?(this.getNodes().sort(e),this.notifyNodesChanged()):d.error(d.$L("ErrorMsg.SORT_FUNC_UNSET"))},nodesHasCoord2D:function(e,t){return this.nodesHasCoordOfMode(d.CoordMode.COORD2D,e,t)},nodesHasCoord3D:function(e,t){return this.nodesHasCoordOfMode(d.CoordMode.COORD3D,e,t)},nodesHasCoordOfMode:function(e,t,r){for(var n=d.CoordUtils.isZero,i=0,o=this.getNodes(),a=0,s=o.length;a<s;++a)if(o[a].hasCoordOfMode(e,t)){if(!r)return!0;if(!n(o[a].getCoordOfMode(e,t)))return!0;++i}return!!(r&&i===o.length&&i<=1)},_createAtom:function(e,t,r,n){return new d.Atom(null,e,t,r,n)},appendAtom:function(e,t,r,n){var i=this._createAtom(e,t,r,n);return i&&this.appendNode(i),i},getAnchorNodeCount:function(){return this.getAnchorNodes().length},indexOfAnchorNode:function(e){return this.getAnchorNodes().indexOf(e)},getAnchorNodeAt:function(e){return this.getAnchorNodes()[e]},appendAnchorNode:function(e){if(!e)return-1;if(this.getNodes().indexOf(e)>=0){var t=d.ArrayUtils.pushUniqueEx(this.getAnchorNodes(),e);return t.isPushed&&this.notifyAnchorNodesChanged(),t.index}return-1},removeAnchorNodeAt:function(e){this.getAnchorNodes()[e]&&(this.getAnchorNodes().splice(e,1),this.notifyAnchorNodesChanged())},removeAnchorNode:function(e){var t=this.getAnchorNodes().indexOf(e);t>=0&&this.removeAnchorNodeAt(t)},clearAnchorNodes:function(){this.setPropStoreFieldValue("anchorNodes",[]),this.notifyAnchorNodesChanged()},getConnectorCount:function(){return this.getConnectors().length},indexOfConnector:function(e){return this.getConnectors().indexOf(e)},getConnectorAt:function(e){return this.getConnectors()[e]},indexStackOfConnector:function(e){var t=this.indexOfConnector(e);if(t>=0)return t;for(var r=null,n=0,i=this.getNodeCount();n<i;++n){var o=this.getNodeAt(n);if(o.indexStackOfConnector&&(r=o.indexStackOfConnector(e),!d.ObjUtils.isUnset(r)))return"object"!=typeof r&&(r=[r]),r.unshift(n),r}return r},getConnectorAtIndexStack:function(e){if((e=d.ArrayUtils.toArray(e)).length<=0)return null;if(1===e.length)return this.getConnectorAt(e[0]);for(var t=e.length-1,r=this.getNodeAt(e[0]),n=1;n<t;++n){if(!r||!r.getNodeAt)return null;r=r.getNodeAt(e[n])}return r?r.getConnectorAt(e[t]):null},insertConnectorBefore:function(e,t){var r=this.indexOfConnector(t);r?this.insertConnectorAt(e,r):this.appendConnector(e)},appendConnector:function(e){var t=d.ArrayUtils.pushUniqueEx(this.getConnectors(),e);return t.isPushed&&(e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent()),this.notifyConnectorsChanged()),t.index},insertConnectorAt:function(e,t){var r=this.indexOfConnector(e),n=this.getConnectors();(d.ObjUtils.isUnset(t)||t<0)&&(t=n.length),r>=0?(n.splice(r,1),n.splice(t,0,e)):(n.splice(t,0,e),e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent())),this.notifyConnectorsChanged()},setConnectorIndex:function(e,t){var r=this.getConnectors(),n=this.indexOfConnector(e);n>=0&&(r.splice(n,1),r.splice(t,0,e))},removeConnectorAt:function(e,t){var r=this.getConnectors()[e];r&&(t||r.removeThisFromConnectedObjs(),this.getConnectors().splice(e,1),r.setOwner&&r.setOwner(null),r.setParent&&r.setParent(null),this.notifyConnectorsChanged())},removeConnector:function(e,t){var r=this.getConnectors().indexOf(e);r>=0&&this.removeConnectorAt(r,t)},clearConnectors:function(){this.setPropStoreFieldValue("connectors",[]),this.notifyConnectorsChanged()},hasConnector:function(e,t){var r=this.indexOfConnector(e)>=0;if(!r&&t)for(var n=0,i=this.getNodeCount();n<i;++n){var o=this.getNodeAt(n);if(o.hasConnector&&(r=o.hasConnector(e,!0)),r)break}return r},sortConnectors:function(e){e?(this.getConnectors().sort(e),this.notifyConnectorsChanged()):d.error(d.$L("ErrorMsg.SORT_FUNC_UNSET"))},_createBond:function(e,t,r){for(var n=[],i=0,o=e.length;i<o;++i){var a=e[i];DataType.isSimpleValue(a)&&(a=this.getNodeAt(a)),n.push(a)}return new d.Bond(null,n,t,null,r)},appendBond:function(e,t,r){var n=this._createBond(e,t,r);return n&&this.appendConnector(n),n},_getObjsNeedToBeCascadeRemoved:function(e,t){for(var r=[],n=e.getLinkedConnectors?e.getLinkedConnectors():[],i=0,o=n.length;i<o;++i){var a=n[i];(!t||t.indexOf(a)<0)&&a.getConnectedObjs().length<=2&&d.ArrayUtils.pushUnique(r,a)}if(e instanceof d.ChemStructureNode);else if(e instanceof d.ChemStructureConnector){var s=e.getConnectedObjs();for(i=0,o=s.length;i<o;++i){var l=s[i];(!t||t.indexOf(l)<0)&&l instanceof d.ChemStructureNode&&l.getLinkedConnectors().length<=1&&d.ArrayUtils.pushUnique(r,l)}}var u=[].concat(r);u.push(e);var c=[];for(i=0,o=r.length;i<o;++i){if((l=r[i])!==e)var h=this._getObjsNeedToBeCascadeRemoved(l,u);d.ArrayUtils.pushUnique(c,h)}return d.ArrayUtils.pushUnique(r,c),r},removeChildObj:function(e,t,r){var n;t?(n=this._getObjsNeedToBeCascadeRemoved(e),d.ArrayUtils.pushUnique(n,e)):n=[e];for(var i=0,o=n.length;i<o;++i)(a=n[i])instanceof d.BaseStructureConnector?this.removeConnector(a):a instanceof d.BaseStructureNode&&this.removeNode(a);if(r)for(i=n.length-1;i>=0;--i){var a;(a=n[i]).finalize&&a.finalize()}},removeChild:function(e){return this.removeChildObj(e)||this.tryApplySuper("removeChild",[e])},deleteChildObj:function(e,t){return this.removeChildObj(e,t,!0)},hasChildObj:function(e){return this.hasNode(e)||this.hasConnector(e)},getNextSiblingOfChild:function(e){if(e instanceof d.SimpleStructureNode){if((t=this.indexOfNode(e))>=0)return this.getNodeAt(t+1)}else if(e instanceof d.BaseStructureConnector){var t;if((t=this.indexOfConnector(e))>=0)return this.getConnectorAt(t+1)}return null},insertBefore:function(e,t){if(e instanceof d.SimpleStructureNode){var r=this.indexOfNode(t);return this.insertNodeAt(e,r)}return e instanceof d.BaseStructureConnector?(r=this.indexOfConnector(t),this.insertConnectorAt(e,r)):-1},clear:function(){this.clearNodes(),this.clearConnectors()},getChildCount:function(){return this.getNodeCount()+this.getConnectorCount()},getChildAt:function(e){var t=this.getNodeCount();return e<t?this.getNodeAt(e):e<t+this.getConnectorCount()?this.getConnectorAt(e-t):null},indexOfChild:function(e){var t;return e instanceof d.BaseStructureNode?t=this.indexOfNode(e):e instanceof d.BaseStructureConnector?(t=this.indexOfConnector(e))>=0&&(t+=this.getNodeCount()):t=-1,t},indexStackOfChild:function(e){var t;if(e instanceof d.BaseStructureNode)t=this.indexStackOfNode(e);else if(e instanceof d.BaseStructureConnector){var r=this.getNodeCount();(t=this.indexStackOfConnector(e)).length?t[t.length-1]+=r:t+=r}else t=-1;return t},getChildAtIndexStack:function(e){if((e=d.ArrayUtils.toArray(e)).length<=0)return null;for(var t=this.getChildAt(e[0]),r=1,n=e.length;r<n;++r){if(!t||!t.getChildAt)return null;t=t.getChildAt(e[r])}return t},isSubFragment:function(e){return e.getNodeCount&&e.getNodeCount()>0},getSubFragments:function(){for(var e=[],t=0,r=this.getNodeCount();t<r;++t){var n=this.getNodeAt(t);this.isSubFragment(n)&&e.push(n)}return e},hasSubFragments:function(){var e=this.getSubFragments();return e&&e.length},getLeafNodes:function(){for(var e=[],t=0,r=this.getNodeCount();t<r;++t){var n=this.getNodeAt(t);if(this.isSubFragment(n)){if(n.getLeafNodes){var i=n.getLeafNodes();e=e.concat(i)}}else e.push(n)}return e},findDirectChildOfObj:function(e){for(var t=e;t&&this.indexOfChild(t)<0;)t=t.getParent?t.getParent():null;return t},getAllChildConnectors:function(){for(var e=[].concat(this.getConnectors()),t=this.getSubFragments(),r=0,n=t.length;r<n;++r)t[r].getAllChildConnectors&&(e=e.concat(t[r].getAllChildConnectors()));return e},getAllContainingConnectors:function(){return this.getAllChildConnectors()},getIsotopeMaps:function(){var e=this.getNodes();if(e.length<=0)return[];for(var t=function(e,t,r,n){for(var i=!1,a=0,s=e.length;a<s;++a)t.isSame(e[a].isotope)&&(i=!0,e[a].count+=r,e[a].charge+=n||0);if(!i){var l={isotope:t,count:r,charge:o.getCharge()||0};e.push(l)}return e},r=[],n=0,i=e.length;n<i;++n){var o=e[n];if(o instanceof d.StructureFragment){var a=o.getIsotopeMaps();for(n=0,i=a.length;n<i;++n)r=t(r,a[n].isotope,a[n].count,a[n].charge||0)}else if(o instanceof d.Atom){o.getIsotope(),r=t(r,o.getIsotope(),1,o.getCharge()||0);var s=o.getHydrogenCount();s>0&&(r=t(r,d.IsotopeFactory.getIsotope(1),s,0))}}return r},calcFormula:function(){var e=this.getIsotopeMaps();if(e.length<=0)return null;for(var t=new d.MolecularFormula,r=0,n=e.length;r<n;++r){var i=new d.Atom;i.setIsotope(e[r].isotope),t.appendSection(i,e[r].count,e[r].charge)}return t},getNodesContainBox:function(e,t,r){for(var n=t===d.CoordMode.COORD3D,i={},o=0,a=e.length;o<a;++o){var s=e[o].getAbsCoordOfMode(t,r);0==o?(i.x1=i.x2=s.x,i.y1=i.y2=s.y,n&&(i.z1=i.z2=s.z)):(s.x<i.x1?i.x1=s.x:s.x>i.x2&&(i.x2=s.x),s.y<i.y1?i.y1=s.y:s.y>i.y2&&(i.y2=s.y),n&&(s.z<i.z1?i.z1=s.z:s.z>i.z2&&(i.z2=s.z)))}return i},getContainerBox:function(e,t){return this.getNodesContainBox(this.getNodes(),e,t)},getContainerBox2D:function(e){var t=this.getContainerBox(d.CoordMode.COORD2D,e);return t.width=t.x2-t.x1,t.height=t.y2-t.y1,t},getContainerBox3D:function(e){var t=this.getContainerBox(d.CoordMode.COORD3D,e);return t.deltaX=t.x2-t.x1,t.deltaY=t.y2-t.y1,t.deltaZ=t.z2-t.z1,t},traverse:function(t,r,n,i){for(var o={nodes:[],connectors:[]},a=e.clone(i||this.getNodes()),s=0,l=a.length;s<l;++s)a[s][this.TRAVERS_VISITED_KEY]=!1;for(;a.length;){var d;d=r&&a.indexOf(r)>=0?r:a[0];var u=this._doTravers(t,d,n,i);o.nodes=o.nodes.concat(u.nodes),o.connectors=o.connectors.concat(u.connectors),a=e.exclude(a,u.nodes)}return o},_doTravers:function(t,r,n,i){var o={nodes:[],connectors:[]},a=r;a[this.TRAVERS_VISITED_KEY]||(o.nodes.push(a),a[this.TRAVERS_VISITED_KEY]=!0,t&&t(a,!1));var s=e.clone(a.getLinkedConnectors()),l=this.getConnectors();s.sort((function(e,t){return l.indexOf(e)-l.indexOf(t)}));for(var u=[],c=0,h=s.length;c<h;++c){var p=s[c],g=a.getLinkedObjsOnConnector(p);i&&(g=e.intersect(g,i));for(var f=0,m=g.length;f<m;++f){var C=g[f];if(C instanceof d.BaseStructureNode)break}if(C&&!C[this.TRAVERS_VISITED_KEY])if(o.nodes.push(C),o.connectors.push(p),C[this.TRAVERS_VISITED_KEY]=!0,t&&(t(p,!0),t(C,!1)),n)u.push(C);else{var y=this._doTravers(t,C,n,i);o.nodes=o.nodes.concat(y.nodes),o.connectors=o.connectors.concat(y.connectors)}}if(n)for(c=0,h=u.length;c<h;++c){var _=u[c];y=this._doTravers(t,_,n,i),o.nodes=o.nodes.concat(y.nodes),o.connectors=o.connectors.concat(y.connectors)}return o}}),d.StructureFragment=Class.create(d.ChemStructureNode,{CLASS_NAME:"Kekule.StructureFragment",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},doFinalize:function(){this.hasFormula()&&this.getFormula().finalize(),this.hasCtab()&&this.getCtab().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("formula",{dataType:"Kekule.MolecularFormula",getter:function(e){return this.getPropStoreFieldValue("formula")||e&&this.createFormula(),this.getPropStoreFieldValue("formula")},setter:function(e){var t=this.getPropStoreFieldValue("formula");t&&(t.finalize(),t=null),e&&(e.setPropValue("parent",this,!0),e.addEventListener("change",(function(e){this.notifyPropSet("formula",this.getFormula())}),this)),this.setPropStoreFieldValue("formula",e)}}),this.defineProp("ctab",{dataType:"Kekule.StructureConnectionTable",getter:function(e){return this.getPropStoreFieldValue("ctab")||e&&this.createCtab(),this.getPropStoreFieldValue("ctab")},setter:function(e){var t=this.getPropStoreFieldValue("ctab");t&&(t.finalize(),t=null),e&&(e.setPropValue("parent",this,!0),e.setOwner(this.getOwner()),e.addEventListener("propValueSet",(function(e){"nodes"!=e.propName&&"anchorNodes"!=e.propName&&"connectors"!=e.propName||this.notifyPropSet(e.propName,e.propValue)}),this),e.setEnablePropValueSetEvent(!0)),this.setPropStoreFieldValue("ctab",e)}}),this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNodes():[]}}),this.defineProp("anchorNodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getAnchorNodes():[]}}),this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getConnectors():[]}}),this.defineProp("crossConnectors",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){for(var e=[].concat(this.getPropStoreFieldValue("linkedConnectors")),t=0,r=this.getNodeCount();t<r;++t)for(var n=this.getNodeAt(t).getLinkedConnectors()||[],i=0,o=n.length;i<o;++i)this.indexOfConnector(n[i])<0&&d.ArrayUtils.pushUnique(e,n[i]);return e}}),this.defineProp("nonHydrogenNodes",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNonHydrogenNodes():[]}}),this.defineProp("nonHydrogenConnectors",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNonHydrogenConnectors():[]}}),this.defineProp("canonicalizationInfo",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getStructureCacheData("canonicalizationInfo")},setter:function(e){this.setStructureCacheData("canonicalizationInfo",e)}}),this.defineProp("aromaticRings",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getStructureCacheData("aromaticRings");return e||(e=[],this.setStructureCacheData("aromaticRings",e)),e},setter:function(e){this.setStructureCacheData("aromaticRings",e)}}),this.defineProp("flattenedShadow",{dataType:"Kekule.StructureFragmentShadow",serializable:!1,scope:Class.PropertyScope.PRIVATE,getter:function(e){var t=null;if(d.ObjUtils.isUnset(e)&&(e=!0),this.getFlattenedShadowOnSelf())return null;if(!(t=this.getPropStoreFieldValue("flattenedShadow"))&&e){var r=(t=new d.StructureFragmentShadow(this)).getShadowFragment();r.unmarshalAllSubFragments(!0),this._copyAdditionalInfoToShadowFragment(r,t.getSourceToShadowMap(),t.getShadowToSourceMap()),this.setPropStoreFieldValue("flattenedShadow",t)}return t}}),this.defineProp("flattenedShadowOnSelf",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PROVATE,setter:null,getter:function(){var e=this.setPropStoreFieldValue("flattenedShadowOnSelf");return d.ObjUtils.isUnset(e)&&(e=!this.hasSubFragments(),this.setPropStoreFieldValue("flattenedShadowOnSelf",e)),e}})},getAutoIdPrefix:function(){return"f"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["ctab","formula","nodes","anchorNodes","connectors"])},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===d.ComparisonMethod.CHEM_STRUCTURE){var n=this.hasCtab(),i=e.hasCtab&&e.hasCtab();if(!(r=n?i?0:1:i?-1:0)){var o=this.hasFormula(),a=e.hasFormula&&e.hasFormula();r=o?a?0:1:a?-1:0}if(!r&&this.hasCtab()){if(0===r&&this.getNonHydrogenNodes&&e.getNonHydrogenNodes){var s=function(e,t){var r;e instanceof d.ChemStructureConnector?r=e.getConnectedNonHydrogenObjs():e instanceof d.ChemStructureNode&&(r=e.getLinkedNonHydrogenObjs());for(var n=[],i=0,o=r.length;i<o;++i){var a=r[i],s=t.indexOfNode(a);s>=0&&n.push(s)}return n.sort(),n},l=this.getNonHydrogenNodes(),u=e.getNonHydrogenNodes();if(0===(r=l.length-u.length))for(var c=0,h=l.length;c<h&&0===(r=this.doCompareOnValue(l[c],u[c],t));++c){var p=s(l[c],this),g=s(u[c],e);if(0!==(r=d.ArrayUtils.compare(p,g)))break}}if(0===r&&this.getConnectors&&e.getConnectors){var f=this.getNonHydrogenConnectors(),m=e.getNonHydrogenConnectors();if(0===(r=f.length-m.length))for(c=0,h=f.length;c<h&&0===(r=this.doCompareOnValue(f[c],m[c],t))&&(p=s(f[c],this),g=s(m[c],e),0===(r=d.ArrayUtils.compare(p,g)));++c);}if(0===r){var C=this.getNonHydrogenNodes(),y=e.getNonHydrogenNodes(),_=this.traverse(null,C[C.length-1],!0,C),E=e.traverse(null,y[y.length-1],!0,y);for(c=0,h=_.nodes.length;c<h;++c){var T=_.nodes[c],O=E.nodes[c];if(0!==(r=this.doCompareOnValue(T,O,t)))break}if(0===r)for(c=0,h=_.connectors.length;c<h;++c){var v=_.connectors[c],S=E.connectors[c];if(0!==(r=this.doCompareOnValue(v,S,t)))break}}}}return r},structureChange:function(e){this.setPropStoreFieldValue("flattenedShadowOnSelf",null);var t=this.getFlattenedShadow(!1);t&&(t.finalize(),this.setPropStoreFieldValue("flattenedShadow",null)),this.tryApplySuper("structureChange",[e])},clearStructureFlags:function(){this.tryApplySuper("clearStructureFlags");for(var e=0,t=this.getChildCount();e<t;++e){var r=this.getChildAt(e);r.clearStructureFlags&&r.clearStructureFlags()}},ownerChanged:function(e,t){this.hasCtab()&&this.getCtab().setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){if(this.hasFormula())this.getFormula()===e&&this.removeFormula();else if(this.hasCtab()){var t=this.getCtab();t===e?this.removeCtab():t.hasChildObj(e)&&t.removeChildObj(e)}this.tryApplySuper("_removeChildObj",[e])},isEmpty:function(){var e;return(e=!this.hasFormula())&&((e=!this.hasCtab())||(e=this.getCtab().isEmpty())),e},isCtabEmpty:function(){return!this.hasCtab()||this.getCtab().isEmpty()},doGetLinkedConnectors:function(){return this.getCrossConnectors()},appendLinkedConnector:function(e){var t=this.getCurrConnectableObj();return t&&t!==this?t.appendLinkedConnector(e):this.tryApplySuper("appendLinkedConnector",[e])},getCurrConnectableObj:function(){var e=this.getAnchorNodeCount()>0?this.getAnchorNodes():this.getNodes();if(e.length<=0)return this;for(var t=this.getCrossConnectors(),r=null,n=null,i=0,o=e.length;i<o;++i){var a=e[i],s=a.getLinkedConnectors(),l=d.ArrayUtils.intersect(s,t).length;(null===r||r>l)&&(r=l,n=a)}return n},getActualConnectedObjToConnector:function(e){if(this.indexOfConnector(e)>=0)return null;if(e.indexOfConnectedObj(this)>=0)return this;for(var t=0,r=e.getConnectedObjCount();t<r;++t){var n=e.getConnectedObjAt(t);if(n.isChildOf(this))return n}return null},createCtab:function(){var e=new d.StructureConnectionTable(this.getOwner(),this);this.setCtab(e)},createFormula:function(){var e=new d.MolecularFormula(this);this.setFormula(e)},hasCtab:function(){return!!this.getPropStoreFieldValue("ctab")},hasFormula:function(){return!!this.getPropStoreFieldValue("formula")},removeFormula:function(){var e=this.getPropStoreFieldValue("formula");return e&&(e.finalize(),e=null,this.setPropStoreFieldValue("formula",null)),this},removeCtab:function(){var e=this.getPropStoreFieldValue("ctab");return e&&(e.finalize(),e=null,this.setPropStoreFieldValue("ctab",null)),this},getContainerBox:function(e,t){return this.hasCtab()?this.getCtab().getContainerBox(e,t):this.tryApplySuper("getContainerBox",[e])},getNodeById:function(e){return this.hasCtab()?this.getCtab().getNodeById(e):null},getConnectorById:function(e){return this.hasCtab()?this.getCtab().getConnectorById(e):null},getObjectById:function(e){return this.getNodeById(e)||this.getConnectorById(e)},getNodeCount:function(){return this.hasCtab()?this.getCtab().getNodeCount():0},getNodeAt:function(e){return this.hasCtab()?this.getCtab().getNodeAt(e):null},indexOfNode:function(e){return this.hasCtab()?this.getCtab().indexOfNode(e):-1},hasNode:function(e,t){return this.hasCtab()?this.getCtab().hasNode(e,t):null},indexStackOfNode:function(e){return this.hasCtab()?this.getCtab().indexStackOfNode(e):-1},getNodeAtIndexStack:function(e){return this.hasCtab()?this.getCtab().getNodeAtIndexStack(e):null},getDirectChildOfNestedNode:function(e){var t=e.getParent();if(t){if(t===this)return t;for(var r=e;t&&t.getParent&&t!==this;)r=t,t=t.getParent();return t===this?r:null}return null},insertNodeBefore:function(e,t){return this.doGetCtab(!0).insertNodeBefore(e,t)},appendNode:function(e){return this.doGetCtab(!0).appendNode(e)},insertNodeAt:function(e,t){return this.doGetCtab(!0).insertNodeAt(e,t)},removeNodeAt:function(e,t){return this.hasCtab()?this.getCtab().removeNodeAt(e,t):null},removeNode:function(e,t){return this.hasCtab()?this.getCtab().removeNode(e,t):null},replaceNode:function(e,t){return this.hasCtab()?this.getCtab().replaceNode(e,t):null},clearNodes:function(){if(this.hasCtab())return this.getCtab().clearNodes()},sortNodes:function(e){if(this.hasCtab())return this.getCtab().sortNodes(e)},nodesHasCoord2D:function(e,t){return!!this.hasCtab()&&this.getCtab().nodesHasCoord2D(e,t)},nodesHasCoord3D:function(e,t){return!!this.hasCtab()&&this.getCtab().nodesHasCoord3D(e,t)},nodesHasCoordOfMode:function(e,t,r){return!!this.hasCtab()&&this.getCtab().nodesHasCoordOfMode(e,t,r)},isNodeInAromaticRing:function(e){for(var t=this.getAromaticRings(),r=0,n=t.length;r<n;++r)if(t[r].nodes.indexOf(e)>=0)return!0;return!1},appendAtom:function(e,t,r,n){return this.doGetCtab(!0).appendAtom(e,t,r,n)},getAnchorNodeCount:function(){return this.hasCtab()?this.getCtab().getAnchorNodeCount():0},getAnchorNodeAt:function(e){return this.hasCtab()?this.getCtab().getAnchorNodeAt(e):null},indexOfAnchorNode:function(e){return this.hasCtab()?this.getCtab().indexOfAnchorNode(e):-1},appendAnchorNode:function(e){return this.doGetCtab(!0).appendAnchorNode(e)},removeAnchorNodeAt:function(e){return this.hasCtab()?this.getCtab().removeAnchorNodeAt(e):null},removeAnchorNode:function(e){return this.hasCtab()?this.getCtab().removeAnchorNode(e):null},clearAnchorNodes:function(){if(this.hasCtab())return this.getCtab().clearAnchorNodes()},getConnectorCount:function(){return this.hasCtab()?this.getCtab().getConnectorCount():0},getConnectorAt:function(e){return this.hasCtab()?this.getCtab().getConnectorAt(e):null},indexOfConnector:function(e){return this.hasCtab()?this.getCtab().indexOfConnector(e):-1},hasConnector:function(e,t){return this.hasCtab()?this.getCtab().hasConnector(e,t):null},insertConnectorBefore:function(e,t){return this.doGetCtab(!0).insertConnectorBefore(e,t)},appendConnector:function(e){return this.doGetCtab(!0).appendConnector(e)},insertConnectorAt:function(e,t){return this.doGetCtab(!0).insertConnectorAt(e,t)},removeConnectorAt:function(e,t){return this.hasCtab()?this.getCtab().removeConnectorAt(e,t):null},removeConnector:function(e,t){return this.hasCtab()?this.getCtab().removeConnector(e,t):null},clearConnectors:function(){if(this.hasCtab())return this.getCtab().clearConnectors()},sortConnectors:function(e){if(this.hasCtab())return this.getCtab().sortConnectors(e)},isConnectorInAromaticRing:function(e){for(var t=this.getAromaticRings(),r=0,n=t.length;r<n;++r)if(t[r].connectors.indexOf(e)>=0)return!0;return!1},appendBond:function(e,t,r){return this.doGetCtab(!0).appendBond(e,t,r)},_getObjsNeedToBeCascadeRemoved:function(e,t){return this.hasCtab()?this.getCtab()._getObjsNeedToBeCascadeRemoved(e,t):[]},removeChildObj:function(e,t,r){this.hasCtab()&&this.getCtab().removeChildObj(e,t,r)},hasChildObj:function(e){return!!this.hasCtab()&&this.getCtab().hasChildObj(e)},getNextSiblingOfChild:function(e){return this.hasCtab()&&this.getCtab().getNextSiblingOfChild(e)||this.tryApplySuper("getNextSiblingOfChild",[e])},getChildSubgroupNames:function(){return["node","connector"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof d.SimpleStructureNode?"node":e instanceof d.BaseStructureConnector?"connector":this.tryApplySuper("getBelongChildSubGroupName",[e])},isSubFragment:function(e){return e.getNodeCount&&e.getNodeCount()>0},getSubFragments:function(){return this.hasCtab()?this.getCtab().getSubFragments():[]},hasSubFragments:function(){return!!this.hasCtab()&&this.getCtab().hasSubFragments()},getLeafNodes:function(){return this.hasCtab()?this.getCtab().getLeafNodes():[]},findDirectChildOfObj:function(e){return this.hasCtab()?this.getCtab().findDirectChildOfObj(e):null},getAllChildConnectors:function(){return this.hasCtab()?this.getCtab().getAllChildConnectors():[]},getAllContainingConnectors:function(){return this.hasCtab()?this.getCtab().getAllContainingConnectors():[]},getIsotopeMaps:function(){return this.hasCtab()?this.getCtab().getIsotopeMaps():[]},clear:function(){this.hasCtab()&&this.setCtab(void 0),this.hasFormula()&&this.setFormula(void 0)},clean:function(e){var t=Object.extend({},d.globalOptions.algorithm.structureClean.structureCleanOptions);return t=Object.extend(t,e||{}),this.doClean(t)},doClean:function(e){if(e.hangingChemConnector)for(var t=this.getConnectorCount()-1;t>=0;--t){var r=this.getConnectorAt(t);r instanceof d.ChemStructureConnector&&r.getConnectedObjCount()<2&&this.removeConnectorAt(t)}var n=this.getNodeCount();for(t=n-1;t>=0;--t){var i=this.getNodeAt(t);i instanceof d.ChemStructureNode&&(this.isSubFragment(i)&&i.doClean?i.doClean(e):e.orphanChemNode&&i.getLinkedConnectorCount()<1&&n>1&&this.removeNodeAt(t))}return this},clearExplicitBondHydrogens:function(e,t){var r=this,n=function(e){var t=e.getLinkedConnectors(),r=1===t.length;if(r){var n=t[0];r=n.isSingleBond&&n.isSingleBond()&&n.getStereo&&(!n.getStereo()||n.getStereo()===d.BondStereo.NONE)}return r},i=function(e,t){for(var n=e.getLinkedConnectors(),i=n.length;i>=0;--i){var o=n[i];r.hasConnector(o,!0)&&r.removeConnector(o,!1)}r.removeNodeAt(t,!1)},o=function(e,t,n){for(var i=e.getLinkedConnectors(),o=i.length;o>=0;--o){var a=i[o];if(r.hasConnector(a,!0)){if(n){var s=e.getLinkedObjsOnConnector(a)[0],l=s.getStructureCacheData("omittedBondHydrogenAtomCount")||0;s.setStructureCacheData("omittedBondHydrogenAtomCount",l+1)}r.removeConnector(a,!1)}}r.removeNodeAt(t,!1)};if(e){var a=this.getAutoClearStructureCache();this.setAutoClearStructureCache(!1)}this.beginUpdate();try{for(var s=this.getNodeCount()-1;s>=0;--s){var l=this.getNodeAt(s);l instanceof d.ChemStructureNode&&(this.isSubFragment(l)&&l.clearExplicitBondHydrogens?(l.clearExplicitBondHydrogens(e,t),l.getNodeCount()<=0&&i(l,s)):l.isHydrogenAtom()&&(t||n(l))&&o(l,s,!0))}}finally{this.endUpdate(),e&&this.setAutoClearStructureCache(a)}return this},calcFormula:function(){return this.hasCtab()?this.getCtab().calcFormula():this.hasFormula()?this.getFormula():null},marshalSubFragment:function(e,t){if(this.hasCtab()){this.beginUpdate();try{this.appendNode(t);for(var r=[],n=[],i=[],o=[],a=0,s=e.length;a<s;++a){var l=e[a];if(!(this.indexOfNode(l)<0)){for(var u=!1,c=l.getLinkedConnectors(),h=0,p=c.length;h<p;++h){for(var g=c[h],f=!1,m=g.getConnectedObjs(),C=0,y=m.length;C<y;++C){var _=m[C];_!=l&&e.indexOf(_)<0&&(u=!0,f=!0)}f?d.ArrayUtils.pushUnique(o,g):d.ArrayUtils.pushUnique(i,g)}d.ArrayUtils.pushUnique(r,l),u&&d.ArrayUtils.pushUnique(n,l)}}for(a=i.length-1;a>=0;--a)this.removeConnector(i[a],!0);for(a=r.length-1;a>=0;--a)this.removeNode(r[a],!0);t.beginUpdate();try{for(a=0,s=r.length;a<s;++a)t.appendNode(r[a]);for(a=0,s=n.length;a<s;++a)t.appendAnchorNode(n[a]);for(a=0,s=i.length;a<s;++a)t.appendConnector(i[a])}finally{t.endUpdate()}}finally{this.endUpdate()}return t}return null},unmarshalSubFragment:function(e,t){if(this.hasCtab()){this.beginUpdate();try{e.beginUpdate();try{t&&e.unmarshalAllSubFragments&&e.unmarshalAllSubFragments(t);var r=this.getCtab();d.StructureFragment.moveChildBetweenStructFragment(e,this,e.getNodes(),e.getConnectors(),!0),e.clear(),r.removeNode(e)}finally{e.endUpdate(),e.finalize()}}finally{this.endUpdate()}}},unmarshalAllSubFragments:function(e){var t=this.getSubFragments();if(t)for(var r=0,n=t.length;r<n;++r)this.unmarshalSubFragment(t[r],e)},recalcCoords:function(){if(this.hasCtab()){this.beginUpdate();try{for(var e={},t={},r=this.getAnchorNodeCount(),n=0,i=r;n<i;++n){var o=this.getAnchorNodeAt(n);e=d.CoordUtils.add(e,o.getCoord2D()||{}),t=d.CoordUtils.add(t,o.getCoord3D()||{})}var a=d.ObjUtils.notUnset,s=a(e.x)||a(e.y),l=a(t.x)||a(t.y)||a(t.z);if(s){var u=d.CoordUtils.substract({},e);this.setCoord2D(d.CoordUtils.substract(this.fetchCoord2D(),u))}if(l){var c=d.CoordUtils.substract({},t);this.setCoord3D(d.CoordUtils.substract(this.fetchCoord3D(),c))}for(n=0,i=this.getNodeCount();n<i;++n)o=this.getNodeAt(n),s&&o.setCoord2D(d.CoordUtils.add(o.fetchCoord2D(),u)),l&&o.setCoord3D(d.CoordUtils.add(o.fetchCoord3D(),c))}finally{this.endUpdate()}}},_copyAdditionalInfoToShadowFragment:function(e,t,r){var n=this.getAromaticRings();if(n&&n.length){for(var i=[],o=0,a=n.length;o<a;++o){for(var s=n[o],l=[],d=[],u=0,c=s.nodes.length;u<c;++u)(h=t.get(s.nodes[u]))&&l.push(h);for(u=0,c=s.connectors.length;u<c;++u){var h;(h=t.get(s.connectors[u]))&&d.push(h)}var p=Object.extend({},s);p.nodes=l,p.connectors=d,i.push(p)}e.setAromaticRings(i)}},getFlattenedShadowFragment:function(e){if(this.getFlattenedShadowOnSelf())return this;var t=this.getFlattenedShadow(e);return t?t.getShadowFragment():null},getFlatternedShadowShadowObj:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var r=this.getFlattenedShadow(t);return r?r.getShadowObj(e):null},getFlatternedShadowSourceObj:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var r=this.getFlattenedShadow(t);return r?r.getSourceObj(e):null},getFlatternedShadowShadowObjs:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var r=this.getFlattenedShadow(t),n=[];if(r)for(var i=0,o=e.length;i<o;++i)n.push(r.getShadowObj(e[i]));return n},getFlatternedShadowSourceObjs:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var r=this.getFlattenedShadow(t),n=[];if(r)for(var i=0,o=e.length;i<o;++i)n.push(r.getSourceObj(e[i]));return n},createShadow:function(){var e=new d.StructureFragmentShadow(this);return this._copyAdditionalInfoToShadowFragment(e.getShadowFragment(),e.getSourceToShadowMap(),e.getShadowToSourceMap()),e},traverse:function(e,t,r,n){return this.hasCtab()?this.getCtab().traverse(e,t,r,n):null}}),d.StructureFragment.moveChildBetweenStructFragment=function(e,t,r,n,i){var o=d.CoordUtils;e.beginUpdate(),t.beginUpdate();var a=e.getAnchorNodes();try{for(var s=e.getAbsCoord2D(),l=e.getAbsCoord3D(),u=t.getAbsCoord2D(),c=t.getAbsCoord3D(),h=o.substract(s,u),p=o.substract(l,c),g=d.ArrayUtils.clone(r),f=d.ArrayUtils.clone(n),m=0,C=g.length;m<C;++m){var y=g[m];if((v=e.indexOfNode(y))>=0){e.removeNodeAt(v,!0);var _=y.getCoord2D();if(_){var E=o.add(_,h);y.setCoord2D(E)}var T=y.getCoord3D();if(T){var O=o.add(T,p);y.setCoord2D(O)}t.appendNode(y),a.indexOf(y)>=0&&(e.removeAnchorNode(y),i||t.appendAnchorNode(y))}}for(m=0,C=f.length;m<C;++m){var v,S=f[m];(v=e.indexOfConnector(S))>=0&&(e.removeConnectorAt(v,!0),t.appendConnector(S))}}finally{t.endUpdate(),e.endUpdate()}},d.StructureFragmentShadow=Class.create(ObjectEx,{CLASS_NAME:"Kekule.StructureFragmentShadow",initialize:function(e){if(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("shadowToSourceMap",new d.MapEx),this.setPropStoreFieldValue("sourceToShadowMap",new d.MapEx);var t=this._createShadowFragment(e,this.getSourceToShadowMap(),this.getShadowToSourceMap());this.setPropStoreFieldValue("shadowFragment",t)}else d.error(d.$L("ErrorMsg.SOURCE_FRAGMENT_NOT_SET"))},doFinalize:function(){this.getShadowToSourceMap().finalize(),this.getSourceToShadowMap().finalize(),this.getShadowFragment().finalize(),this.setPropStoreFieldValue("shadowToSourceMap",null),this.setPropStoreFieldValue("sourceToShadowMap",null),this.setPropStoreFieldValue("shadowFragment",null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("shadowFragment",{dataType:"Kekule.StructureFragment",setter:null}),this.defineProp("sourceToShadowMap",{dataType:"Kekule.MapEx",setter:null}),this.defineProp("shadowToSourceMap",{dataType:"Kekule.MapEx",setter:null})},_createShadowFragment:function(e,t,r){var n=e.clone();return this._mapFragmentChildren(e,n,t,r),n},_mapFragmentChildren:function(e,t,r,n){for(var i=0,o=e.getChildCount();i<o;++i){var a=e.getChildAt(i),s=t.getChildAt(i);r.set(a,s),n.set(s,a),a.getChildCount&&s.getChildCount&&this._mapFragmentChildren(a,s,r,n)}},getShadowObj:function(e){return this.getSourceToShadowMap().get(e)},getSourceObj:function(e){return this.getShadowToSourceMap().get(e)}}),d.SubGroup=Class.create(d.StructureFragment,{CLASS_NAME:"Kekule.SubGroup",initialize:function(e,t,r,n,i){this.tryApplySuper("initialize",[e,n,i]),this.setPropStoreFieldValue("abbr",t),this.setPropStoreFieldValue("name",r)},initProperties:function(){this.defineProp("abbr",{dataType:DataType.STRING}),this.defineProp("formulaText",{dataType:DataType.STRING}),this.defineProp("name",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"g"},doPropChanged:function(e,t){return"anchorNodes"==e&&this.recalcCoords(),this.tryApplySuper("doPropChanged",[e,t])},getLabel:function(){return this.getName()||this.getAbbr()||this.getFormulaText()||d.ChemStructureNodeLabels.SUBGROUP}}),d.RGroup=d.SubGroup,d.Molecule=Class.create(d.StructureFragment,{CLASS_NAME:"Kekule.Molecule",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("name",t),r&&this.setCtab(new d.StructureConnectionTable)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"m"}}),d.BaseStructureConnector=Class.create(d.ChemStructureObject,{CLASS_NAME:"Kekule.BaseStructureConnector",initialize:function(e,t){this.tryApplySuper("initialize",[e]),this.setConnectedObjs(t||[])},initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:function(e){var t=this.getPropStoreFieldValue("connectedObjs");t||(this.setPropStoreFieldValue("connectedObjs",[]),t=this.getPropStoreFieldValue("connectedObjs"));for(var r=0,n=t.length;r<n;++r)t[r].removeLinkedConnector(this);if(e){for(r=0,n=e.length;r<n;++r)this.assertConnectedObjLegal(e[r]);for(r=0,n=e.length;r<n;++r){var i=e[r],o=i.getCurrConnectableObj?i.getCurrConnectableObj():i;d.ArrayUtils.pushUnique(t,o)}}else this.setPropStoreFieldValue("connectedObjs",[]);for(r=0,n=(t=this.getPropStoreFieldValue("connectedObjs")).length;r<n;++r)t[r].appendLinkedConnector(this);this.notifyConnectedObjsChanged()}}),this.defineProp("neighboringConnectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=this.getConnectedObjs(),r=0,n=t.length;r<n;++r){var i=t[r];i.getLinkedConnectors&&d.ArrayUtils.pushUnique(e,i.getLinkedConnectors()||[])}return d.ArrayUtils.remove(e,this),e}})},getAutoIdPrefix:function(){return"c"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["connectedObjs"])},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===d.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"connectedObjCount")){var n=this.getConnectedObjCount(),i=e.getConnectedObjCount&&e.getConnectedObjCount();r=this.doCompareOnValue(n,i,t)}return r},notifyConnectedObjsChanged:function(){this.notifyPropSet("connectedObjs",this.getPropStoreFieldValue("connectedObjs"))},assertConnectedObjLegal:function(e){if(e&&e.getOwner)return!e.getOwner()||e.getOwner()==this.getOwner()||(d.chemError(d.hasLocalRes()?d.$L("ErrorMsg.UNABLE_ADD_DIFF_OWNER_OBJ"):"Object with different owner can not be linked to connector"),!1);d.chemError(d.hasLocalRes()?d.$L("ErrorMsg.UNABLE_ADD_MISTYPED_NODE"):"Unable to link mistyped node to connector")},connectedObjAdded:function(e){this.notifyConnectedObjsChanged()},getConnectedObjCount:function(){return this.getConnectedObjs().length},indexOfConnectedObj:function(e){return this.getConnectedObjs().indexOf(e)},getConnectedObjAt:function(e){return this.getConnectedObjs()[e]},setConnectedObjAt:function(e,t){this.assertConnectedObjLegal(t);var r=this.getConnectedObjs()[e];r&&r.removeLinkedConnector(this),this.insertConnectedObjAt(t,e),this.connectedObjAdded(t)},appendConnectedObj:function(e){this.assertConnectedObjLegal(e);var t=e.getCurrConnectableObj?e.getCurrConnectableObj():e,r=this._doAppendConnectedObj(t);return t&&t.appendLinkedConnector(this),r},_doAppendConnectedObj:function(e){var t=d.ArrayUtils.pushUniqueEx(this.getConnectedObjs(),e);return t.isPushed&&this.connectedObjAdded(e),t.index},insertConnectedObjBefore:function(e,t){this.assertConnectedObjLegal(e);var r=t?t.getCurrConnectableObj?t.getCurrConnectableObj():t:null,n=r?this.indexOfConnectedObj(r):-1;return n<0?this.appendConnectedObj(e):this.insertConnectedObjAt(e,n)},insertConnectedObjAt:function(e,t){t||(t=0),this.assertConnectedObjLegal(e);var r=e.getCurrConnectableObj?e.getCurrConnectableObj():e,n=this.indexOfConnectedObj(r),i=this.getConnectedObjs();n>=0?(i.splice(n,1),i.splice(t,0,r),this.notifyConnectedObjsChanged()):(i.splice(t,0,r),r&&r.appendLinkedConnector(this),this.connectedObjAdded(r))},removeConnectedObjAt:function(e){var t=this.getConnectedObjs()[e];t&&(this._doRemoveConnectedObjAt(e),t._doRemoveLinkedConnectorAt(t.indexOfLinkedConnector(this)),this.notifyConnectedObjsChanged())},_doRemoveConnectedObjAt:function(e){this.getConnectedObjs().splice(e,1)},removeConnectedObj:function(e){var t=this.getConnectedObjs().indexOf(e);t>=0&&this.removeConnectedObjAt(t)},replaceConnectedObj:function(e,t){var r=this.indexOfConnectedObj(e);r>=0&&this.setConnectedObjAt(r,t)},clearConnectedObjs:function(){this.setConnectedObjs([])},hasConnectedObj:function(e){return this.getConnectedObjs().indexOf(e)>=0},isConnectingWithObj:function(e){return this.hasConnectedObj(e)},sortConnectedObjs:function(e){this.getConnectedObjs().sort(e)},reverseConnectedObjOrder:function(){this.setPropStoreFieldValue("connectedObjs",d.ArrayUtils.reverse(this.getConnectedObjs())),this.notifyConnectedObjsChanged()},removeThisFromConnectedObjs:function(){for(var e=this.getConnectedObjCount()-1;e>=0;--e)this.getConnectedObjAt(e).removeLinkedConnector(this)},getConnectedSiblings:function(){for(var e=this.getConnectedObjs(),t=[],r=this.getParent(),n=function e(t){if(t.getParent){var n=t.getParent();return n===r?n:e(n)}return t},i=0,o=e.length;i<o;++i){var a=e[i];if(a.getParent&&a.getParent()!==r){var s=n(a);s&&t.push(s)}else t.push(a)}return t},isConnectingConnector:function(){for(var e=0,t=this.getConnectedObjCount();e<t;++e)if(this.getConnectedObjAt(e)instanceof d.ChemStructureConnector)return!0;return!1}}),d.ChemStructureConnector=Class.create(d.BaseStructureConnector,{CLASS_NAME:"Kekule.ChemStructureConnector",initProperties:function(){this.defineProp("parity",{dataType:DataType.INT}),this.defineProp("connectedChemNodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=0,r=this.getConnectedObjCount();t<r;++t){var n=this.getConnectedObjAt(t);n instanceof d.ChemStructureNode&&e.push(n)}return e}})},getAcceptCoordStickFrom:function(e){return!(this.isSiblingWith(e)||e instanceof d.ChemStructureNode||e instanceof d.BaseStructureConnector)},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===d.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"stereo")){var n=this.getParity()||d.StereoParity.UNKNOWN,i=e.getParity&&e.getParity()||d.StereoParity.UNKNOWN;r=this.doCompareOnValue(n,i,t)}return r},clearStructureFlags:function(){this.setParity(d.StereoParity.NONE)},getConnectedChemNodeCount:function(){return this.getConnectedChemNodes().length},getConnectedNonHydrogenObjs:function(){for(var e=[],t=this.getConnectedObjs(),r=0,n=t.length;r<n;++r){var i=t[r];i.isHydrogenAtom&&i.isHydrogenAtom()||e.push(i)}return e},isNormalConnectorToHydrogen:function(){return this.getConnectedNonHydrogenObjs().length<=1}}),d.BondStereo={NONE:0,UP:1,UP_INVERTED:2,DOWN:3,DOWN_INVERTED:4,UP_OR_DOWN:8,UP_OR_DOWN_INVERTED:9,CLOSER:10,E_OR_Z:20,E:21,Z:22,E_Z_BY_COORDINATES:23,CIS_OR_TRANS:30,CIS:31,TRANS:32,getInvertedDirection:function(e){var t=d.BondStereo;switch(e){case t.UP:return t.UP_INVERTED;case t.UP_INVERTED:return t.UP;case t.DOWN:return t.DOWN_INVERTED;case t.DOWN_INVERTED:return t.DOWN;case t.UP_OR_DOWN:return t.UP_OR_DOWN_INVERTED;default:return e}}},d.Bond=Class.create(d.ChemStructureConnector,{CLASS_NAME:"Kekule.Bond",initialize:function(e,t,r,n,i){this.tryApplySuper("initialize",[e,t||[]]),(r||n||i)&&this.setBondForm(d.BondFormFactory.getBondForm(r,n,i))},initProperties:function(){this.defineProp("bondForm",{dataType:"Kekule.BondForm",serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("bondType",{dataType:DataType.STRING,enumSource:d.BondType,getter:function(){var e=this.getBondForm();return e?e.getBondType():d.BondType.DEFAULT},setter:function(e){this.changeBondForm(this.getBondOrder(),d.ElectronSet.UNSET_ELECTRONCOUNT,e)}}),this.defineProp("bondOrder",{dataType:DataType.INT,enumSource:d.BondOrder,getter:function(){var e=this.getBondForm();return e?e.getBondOrder():d.BondOrder.UNSET},setter:function(e){this.changeBondForm(e,d.ElectronSet.UNSET_ELECTRONCOUNT,this.getBondType())}}),this.defineProp("bondValence",{dataType:DataType.INT,serializable:!1,getter:function(){var e=this.getBondForm();return e?e.getBondValence():0},setter:null}),this.defineProp("electronCount",{dataType:DataType.FLOAT,getter:function(){if(this.isAromatic())return 3;var e=this.getBondForm();return e?e.getElectronCount():d.ElectronSet.UNSET_ELECTRONCOUNT},setter:function(e){var t=this.getBondOrder();this.changeBondForm(t,e,this.getBondType())}}),this.defineProp("stereo",{dataType:DataType.INT,enumSource:d.BondStereo,defaultValue:d.BondStereo.NONE}),this.defineProp("isInAromaticRing",{dataType:DataType.BOOL,setter:null,getter:function(){var e=this.getParent();return!(!e||!e.isConnectorInAromaticRing)&&e.isConnectorInAromaticRing(this)}}),this.defineProp("neighboringBonds",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=this.getNeighboringConnectors()||[],t=[],r=0,n=e.length;r<n;++r)e[r]instanceof d.Bond&&t.push(e[r]);return t}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("stereo",d.BondStereo.NONE)},getAutoIdPrefix:function(){return"b"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["bondForm","stereo"])},clearStructureFlags:function(){this.setPropStoreFieldValue("isInAromaticRing",null)},doGetParity:function(){return this.isDoubleBond()?this.tryApplySuper("doGetParity"):null},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===d.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(e,"bondType")&&t.push("bondType"),t},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===d.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(t,"connectedObjCount")){var n=this.getConnectedObjCount(),i=e.getConnectedObjCount&&e.getConnectedObjCount();r=this.doCompareOnValue(n,i,t)}if(!r&&this._getComparisonOptionFlagValue(t,"bondOrder")){var o=Math.round(this.getElectronCount()),a=Math.round(e.getElectronCount());r=this.doCompareOnValue(o,a,t)}}return r},changeBondForm:function(e,t,r){this.setBondForm(d.BondFormFactory.getBondForm(e,t,r))},canInvertBondDirection:function(){var e=d.BondType,t=this.getBondType();return[e.COVALENT,e.IONIC,e.METALLIC,e.HYDROGEN,e.UNKNOWN].indexOf(t)>=0},invertBondDirection:function(){this.setStereo(d.BondStereo.getInvertedDirection(this.getStereo()))},reverseConnectedObjOrder:function(){this.canInvertBondDirection()&&(this.tryApplySuper("reverseConnectedObjOrder"),this.invertBondDirection())},normalizeDirection:function(){var e=d.BondStereo,t=[e.UP_INVERTED,e.DOWN_INVERTED,e.UP_OR_DOWN_INVERTED],r=this.getBondStereo();t.indexOf(r)>=0&&this.reverseConnectedObjOrder()},isCovalentBond:function(){return this.getBondType()===d.BondType.COVALENT},isSingleBond:function(){return this.getBondType()===d.BondType.COVALENT&&this.getBondOrder()===d.BondOrder.SINGLE&&!this.getIsInAromaticRing()},isDoubleBond:function(){return this.getBondType()===d.BondType.COVALENT&&this.getBondOrder()===d.BondOrder.DOUBLE&&!this.getIsInAromaticRing()},isTripleBond:function(){return this.getBondType()===d.BondType.COVALENT&&this.getBondOrder()===d.BondOrder.TRIPLE},isAromatic:function(){return(!!this.getIsInAromaticRing()||this.getBondOrder()===d.BondOrder.EXPLICIT_AROMATIC)&&this.getBondType()===d.BondType.COVALENT},isBondBetween:function(e,t){var r,n,i=this.getConnectedObjs();if(2!==i.length)return!1;for(var o=0,a=i.length;o<a;++o){var s=i[o];if(s instanceof d.Atom&&(s.isElement(e)?r=!0:s.isElement(t)&&(n=!0),r&&n))return!0}return!1}}),d.ChemStructureObjectGroup=Class.create(d.ChemStructureObject,{CLASS_NAME:"Kekule.ChemStructureObjectGroup",ITEM_BASE_CLASSES:["Kekule.ChemStructureObject","Kekule.ChemStructureObjectGroup"],initialize:function(e){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("items",[]),this.setPropStoreFieldValue("raiseExceptionOnTypeMismatch",[])},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY}),this.defineProp("raiseExceptionOnTypeMismatch",{dataType:DataType.BOOL,defaultValue:!0,scope:Class.PropertyScope.PUBLIC})},getAutoIdPrefix:function(){return"sg"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["items"])},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===d.ComparisonMethod.CHEM_STRUCTURE&&t.push("items"),t},ownerChanged:function(e,t){for(var r=this.getItems(),n=0,i=r.length;n<i;++n){var o=r[n].obj;o&&o.setOwner&&o.setOwner(e)}this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){var t=this.indexOfObj(e);t<0&&(t=this.indexOfItem(e)),t>=0&&this.removeObjAt(t),this.tryApplySuper("_removeChildObj",[e])},getObjectBaseClasses:function(){return this.getPrototype().ITEM_BASE_CLASSES},ensureItemClass:function(e){var t=this.getObjectBaseClasses();if(t.length>0){for(var r=0,n=t.length;r<n;++r)if(e instanceof ClassEx.findClass(t[r]))return!0;if(this.getRaiseExceptionOnTypeMismatch()){var i=d.hasLocalRes()?d.$L("ErrorMsg.CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH"):"Mismatched group item class";d.raise(i)}return!1}return!0},notifyItemsChanged:function(){this.notifyPropSet("items",this.getPropStoreFieldValue("items"))},indexOfItem:function(e){return this.getItems().indexOf(e)},indexOfObj:function(e){for(var t=this.getItems(),r=0,n=t.length;r<n;++r)if(t[r].obj==e)return r;return-1},hasObj:function(e){return this.indexOfObj(e)>=0},setAttributesAt:function(e,t){var r=this.getItems()[e];if(r)for(var n=d.ObjUtils.getOwnedFieldNames(t),i=0,o=n.length;i<o;++i)r[n[i]]=t[n[i]]},getItemCount:function(){return this.getItems().length},getItemAt:function(e){return this.getItems()[e]},appendItem:function(e){return this.getItems().push(e),this},insertItem:function(e,t){return this.insertItemAt(e,t)},insertItemAt:function(e,t){return d.ArrayUtils.insertUniqueEx(this.getItems(),e,t).index},removeItemAt:function(e){this.getItems()[e]&&(this.getItems().splice(e,1),this.notifyItemsChanged())},removeItem:function(e){var t=this.getItems().indexOf(e);t>=0&&this.removeItemAt(t)},getObjAt:function(e){var t=this.getItemAt(e);return t?t.obj:null},insertObj:function(e,t,r){return this.insertObjAt(e,t,r)},insertObjAt:function(e,t,r){if(e)if(this.indexOfObj(e)>=0);else if(this.ensureItemClass(e)){var n={obj:e};this.beginUpdate();try{var i=this.insertItem(n,t);r&&this.setAttributesAt(i,r),this.notifyItemsChanged()}finally{this.endUpdate()}return i}},appendObj:function(e,t){return this.insertObj(e,null,t)},removeObjAt:function(e){this.getItems()[e]&&(this.getItems().splice(e,1),this.notifyItemsChanged())},removeObj:function(e){var t=this.indexOfObj(e);t>=0&&this.removeObjAt(t)},getAllObjs:function(){for(var e=[],t=0,r=this.getItemCount();t<r;++t)e.push(this.getObjAt(t));return e},getChildSubgroupNames:function(){return["item"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return"item"},getNextSiblingOfChild:function(e){var t=this.indexOfItem(e);return t<0&&(t=this.indexOfObj(e)),t>=0?this.getChildAt(t+1):null},appendChild:function(e){return e instanceof d.ChemObject?this.appendObj(e):this.appendItem(e)},insertChild:function(e,t){return e instanceof d.ChemObject?this.insertObj(e,t):this.insertItem(e,t)},insertBefore:function(e,t){var r=this.indexOfItem(t);return r<0&&(r=this.indexOfObj(t)),this.insertChild(e,r)}}),d.StructureFragmentGroup=Class.create(d.ChemStructureObjectGroup,{CLASS_NAME:"Kekule.ChemStructureObjectGroup",ITEM_BASE_CLASSES:["Kekule.StructureFragment","Kekule.StructureFragmentGroup"]}),d.MoleculeGroup=Class.create(d.ChemStructureObjectGroup,{CLASS_NAME:"Kekule.MoleculeGroup",ITEM_BASE_CLASSES:["Kekule.Molecule","Kekule.MoleculeGroup"]}),d.CompositeMolecule=Class.create(d.Molecule,{CLASS_NAME:"Kekule.CompositeMolecule",initialize:function(e,t){this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("subMolecules",{dataType:"Kekule.MoleculeGroup",getter:function(){return this.getPropStoreFieldValue("subMolecules")||this.setPropStoreFieldValue("subMolecules",new d.MoleculeGroup),this.getPropStoreFieldValue("subMolecules")}})},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===d.ComparisonMethod.CHEM_STRUCTURE&&t.push("subMolecules"),t},ownerChanged:function(e,t){var r=this.getPropStoreFieldValue("subMolecules");r&&r.setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},getSubMoleculeCount:function(){var e=this.getPropStoreFieldValue("subMolecules");return e?e.length:0},hasCtab:function(){return!1},hasFormula:function(){return!1},getAllContainingConnectors:function(){for(var e=this.getSubMolecules(),t=[],r=0,n=e.getItemCount();r<n;++r){var i=e.getObjAt(r);if(i.getAllContainingConnectors){var o=i.getAllContainingConnectors();o&&o.length&&(t=t.concat(o))}}return t},getContainerBox:function(e){var t=null,r=this.getPropStoreFieldValue("subMolecules");if(r)for(var n=0,i=r.getItemCount();n<i;++n){var o=r.getObjAt(n).getContainerBox(e);o&&(t=t?d.BoxUtils.getContainerBox(t,o):d.BoxUtils.clone(o))}return t},doGetCtab:function(){return null},doSetCtab:function(){},doGetFormula:function(){return null},doSetFormula:function(){},getChildSubgroupNames:function(){return["subMolecule"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof d.Molecule?"subMolecule":this.tryApplySuper("getBelongChildSubGroupName",[e])},getNextSiblingOfChild:function(e){return this.getSubMolecules().getNextSiblingOfChild(e)},insertChild:function(e,t){return this.insertChildAt(e,t)}}),d.MoleculeList=Class.create(d.ChemObjList,{CLASS_NAME:"Kekule.MoleculeList",initialize:function(e){this.tryApplySuper("initialize",[e,d.Molecule])}}),d.ChemStructureNodeLabels={ENABLE_ISOTOPE_ALIAS:!0,UNSET_ELEMENT:"?",DUMMY_ATOM:"Du",HETERO_ATOM:"Q",ANY_ATOM:"A",CUSTOM_ATOM:"@",VARIABLE_ATOM:"L",SUBGROUP:"R",ISO_LIST_LEADING_BRACKET:"[",ISO_LIST_TAILING_BRACKET:"]",ISO_LIST_DELIMITER:",",ISO_LIST_DISALLOW_PREFIX:"NOT"},d.ChemStructureNodeFactory={CANDIDATE_CLASSES:[d.SubGroup,d.VariableAtom,d.Pseudoatom],getClassByLabel:function(e,t){void 0===t&&(t=d.Pseudoatom);for(var r,n=d.ChemStructureNodeLabels,i=[[n.SUBGROUP],[n.VARIABLE_ATOM],[n.DUMMY_ATOM,n.HETERO_ATOM,n.ANY_ATOM,n.CUSTOM_ATOM]],o=d.ChemStructureNodeFactory.CANDIDATE_CLASSES,a=0,s=o.length;a<s;++a){var l=o[a];if(i[a].indexOf(e)>=0){r=l;break}}return r||(r=d.IsotopesDataUtil.isIsotopeIdAvailable(e)?d.Atom:t),r},createByLabel:function(e){var t=new(d.ChemStructureNodeFactory.getClassByLabel(e));return t instanceof d.Pseudoatom?t.setSymbol(e):t instanceof d.Atom&&t.setIsotopeId(e),t}}}(),d.ChemStructureBuilder=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemStructureBuilder",initialize:function(e){this.tryApplySuper("initialize"),e&&this.setTarget(e)},initProperties:function(){this.defineProp("target",{dataType:"Kekule.StructureFragment"})},setNodeCoord:function(){for(var e=Array.prototype.slice.call(arguments),t=e.shift(),r=e,n=0,i=r.length;n<i&&n<2;++n){var o=r[n];void 0!==o.z?t.setCoordOfMode(o,d.CoordMode.COORD3D):t.setCoordOfMode(o,d.CoordMode.COORD2D)}},createNode:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),r=e.shift(),n=e,i=new t(r);return this.setNodeCoord(i,n),this.appendNode(i),i},createConnector:function(e,t,r){var n=new e(t);return n.setConnectedObjs(r),n},appendNode:function(e){return e&&this.getTarget()?this.getTarget().appendNode(e):null},appendConnector:function(e){return e&&this.getTarget()?this.getTarget().appendConnector(e):null},createAtom:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),r=e.shift(),n=e.shift(),i=new d.Atom(t,r,n);return e.unshift(i),this.setNodeCoord.apply(this,e),this.appendNode(i),i},createBond:function(e,t,r,n,i){var o=new d.Bond(e,t,r);return o.changeBondForm(r,null,i),n&&o.setStereo(n),this.appendConnector(o),o},deleteNode:function(){},marshalSubGroup:function(e,t){var r=this.getTarget();if(r&&r.hasCtab()){var n=new d.SubGroup(t);return r.marshalSubFragment(e,n),n}return null}}),d.ReactionComponent={REACTANT:"reactant",PRODUCT:"product",SUBSTANCE:"substance",CONDITION:"condition"},d.ReactionRole={REAGENT:"reagent",CATALYST:"catalyst",SOLVENT:"solvent",TEMPERATURE:"temperature",DURATION:"duration"},d.ReactionDirection={FORWARD:1,BACKWARD:-1,BIDIRECTION:0},d.Reaction=Class.create(d.ChemObject,{CLASS_NAME:"Kekule.Reaction",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setDirection(d.ReactionDirection.FORWARD)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("title",{dataType:DataType.STRING}),this.defineProp("reactionType",{dataType:DataType.STRING}),this.defineProp("yield",{dataType:DataType.FLOAT}),this.defineProp("direction",{dataType:DataType.INT,defaultValue:d.ReactionDirection.FORWARD,enumSource:d.ReactionDirection}),this.defineProp("reactants",{dataType:DataType.ARRAY,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("reactants");return!t&&e&&(t=[],this.setPropStoreFieldValue("reactants",t)),t}}),this.defineProp("products",{dataType:DataType.ARRAY,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("products");return!t&&e&&(t=[],this.setPropStoreFieldValue("products",t)),t}}),this.defineProp("substances",{dataType:DataType.ARRAY,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("substances");return!t&&e&&(t=[],this.setPropStoreFieldValue("substances",t)),t}}),this.defineProp("conditions",{dataType:DataType.ARRAY,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("conditions");return!t&&e&&(t=[],this.setPropStoreFieldValue("conditions",t)),t}})},ownerChanged:function(e,t){for(var r=["reactants","products","substances","conditions"],n=0,i=r.length;n<i;++n){var o=r[n],a=this.getComponentArray(o);if(a)for(var s=0,l=a.length;s<l;++s){var d=a[s].item;d.setOwner&&d.setOwner(e)}}this.tryApplySuper("ownerChanged",[e,t])},assertAddingMolecule:function(e){e instanceof d.Molecule||d.chemError(d.$L("ErrorMsg.UNABLE_ADD_NONMOLECULE_MAP"))},notifyReactantsChange:function(){this.notifyPropSet("reactants",this.getPropStoreFieldValue("reactants"))},notifyProductsChange:function(){this.notifyPropSet("products",this.getPropStoreFieldValue("products"))},notifySubstancesChange:function(){this.notifyPropSet("substances",this.getPropStoreFieldValue("substances"))},notifyConditionsChange:function(){this.notifyPropSet("conditions",this.getPropStoreFieldValue("conditions"))},notifyComponentChange:function(e){var t=this.componentToPropName(e);t&&this.notifyPropSet(t,this.getPropStoreFieldValue(t))},componentToPropName:function(e){return e+"s"},getComponentArray:function(e,t){var r=this.componentToPropName(e);if(!r)return null;switch(r){case"reactants":return this.doGetReactants(t);case"products":return this.doGetProducts(t);case"substances":return this.doGetSubstances(t);case"conditions":return this.doGetConditions(t);default:return null}},getComponentItemCount:function(e){var t=this.getComponentArray(e);return t?t.length:0},getMapAt:function(e,t){var r=this.getComponentArray(e);return r?r[t]:null},getMapItemAt:function(e,t){var r=this.getMapAt(e,t);return r?r.item:null},indexOfMap:function(e,t){var r=this.getComponentArray(e);return r?r.indexOf(t):-1},indexOfItem:function(e,t,r){var n=this.getComponentArray(e);if(n)for(var i=0,o=n.length;i<o;++i)if(n[i].item==t){if(void 0===r)return i;if(r===n[i].role)return i}return-1},appendMap:function(e,t){e!=d.ReactionComponent.PRODUCT&&e!=d.ReactionComponent.REACTANT||this.assertAddingMolecule(t.item);var r=d.ArrayUtils.pushUniqueEx(this.getComponentArray(e,!0),t);return r.isPushed&&this.notifyComponentChange(e),r.index},appendItem:function(e,t,r,n){var i=this.indexOfItem(e,t,r);if(i<0){e!=d.ReactionComponent.PRODUCT&&e!=d.ReactionComponent.REACTANT||this.assertAddingMolecule(t);var o=d.RoleMapUtils.createMap(t,r);n&&Object.extend(o,n);var a=d.ArrayUtils.pushUniqueEx(this.getComponentArray(e,!0),o);return this.notifyComponentChange(e),a.index}return i},removeMapAt:function(e,t){var r=null,n=this.getComponentArray(e);return n&&(r=d.ArrayUtils.removeAt(n,t))&&this.notifyComponentChange(e),r},removeMap:function(e,t){var r=null,n=this.getComponentArray(e);return n&&(r=d.ArrayUtils.remove(n,t))&&this.notifyComponentChange(e),r},removeItem:function(e,t,r){var n=this.indexOfItem(e,t,r);return n>=0?this.removeMapAt(e,n):null},clearComponent:function(e){this.getComponentArray(e),this.notifyComponentChange(e)},getReactantCount:function(){return this.getComponentItemCount(d.ReactionComponent.REACTANT)},getProductCount:function(){return this.getComponentItemCount(d.ReactionComponent.PRODUCT)},getSubstancesCount:function(){return this.getComponentItemCount(d.ReactionComponent.SUBSTANCE)},getConditionCount:function(){return this.getComponentItemCount(d.ReactionComponent.CONDITION)},getReactantMapAt:function(e){return this.getMapAt(d.ReactionComponent.REACTANT,e)},getProductMapAt:function(e){return this.getMapAt(d.ReactionComponent.PRODUCT,e)},getSubstanceMapAt:function(e){return this.getMapAt(d.ReactionComponent.SUBSTANCE,e)},getConditionMapAt:function(e){return this.getMapAt(d.ReactionComponent.CONDITION,e)},getReactantItemAt:function(e){return this.getMapItemAt(d.ReactionComponent.REACTANT,e)},getReactantAt:function(e){return this.getMapItemAt(d.ReactionComponent.REACTANT,e)},getProductItemAt:function(e){return this.getMapItemAt(d.ReactionComponent.PRODUCT,e)},getProductAt:function(e){return this.getMapItemAt(d.ReactionComponent.PRODUCT,e)},getSubstanceItemAt:function(e){return this.getMapItemAt(d.ReactionComponent.SUBSTANCE,e)},getSubstanceAt:function(e){return this.getMapItemAt(d.ReactionComponent.SUBSTANCE,e)},getConditionItemAt:function(e){return this.getMapItemAt(d.ReactionComponent.CONDITION,e)},indexOfReactantMap:function(e){return this.indexOfMap(d.ReactionComponent.REACTANT,e)},indexOfProductMap:function(e){return this.indexOfMap(d.ReactionComponent.PRODUCT,e)},indexOfSubstanceMap:function(e){return this.indexOfMap(d.ReactionComponent.SUBSTANCE,e)},indexOfConditionMap:function(e){return this.indexOfMap(d.ReactionComponent.CONDITION,e)},indexOfReactant:function(e,t){return this.indexOfItem(d.ReactionComponent.REACTANT,e,t)},indexOfProduct:function(e,t){return this.indexOfItem(d.ReactionComponent.PRODUCT,e,t)},indexOfSubstance:function(e,t){return this.indexOfItem(d.ReactionComponent.SUBSTANCE,e,t)},indexOfCondition:function(e,t){return this.indexOfItem(d.ReactionComponent.CONDITION,e,t)},appendReactantMap:function(e){return this.appendMap(d.ReactionComponent.REACTANT,e)},appendProductMap:function(e){return this.appendMap(d.ReactionComponent.PRODUCT,e)},appendSubstanceMap:function(e){return this.appendMap(d.ReactionComponent.SUBSTANCE,e)},appendConditionMap:function(e){return this.appendMap(d.ReactionComponent.CONDITION,e)},appendReactant:function(e,t,r,n){var i=n||{};return r&&(i.amount=r),this.appendItem(d.ReactionComponent.REACTANT,e,t,i)},appendProduct:function(e,t,r,n){var i=n||{};return r&&(i.amount=r),this.appendItem(d.ReactionComponent.PRODUCT,e,t,i)},appendSubstance:function(e,t,r,n){var i=n||{};return r&&(i.amount=r),this.appendItem(d.ReactionComponent.SUBSTANCE,e,t,i)},appendCondition:function(e,t,r){return this.appendItem(d.ReactionComponent.CONDITION,e,t,r)},removeReactantAt:function(e){return this.removeMapAt(d.ReactionComponent.REACTANT,e)},removeProductAt:function(e){return this.removeMapAt(d.ReactionComponent.PRODUCT,e)},removeSubstanceAt:function(e){return this.removeMapAt(d.ReactionComponent.SUBSTANCE,e)},removeConditionAt:function(e){return this.removeMapAt(d.ReactionComponent.CONDITION,e)},removeReactantMap:function(e){return this.removeMap(d.ReactionComponent.REACTANT,e)},removeProductMap:function(e){return this.removeMap(d.ReactionComponent.PRODUCT,e)},removeSubstanceMap:function(e){return this.removeMap(d.ReactionComponent.SUBSTANCE,e)},removeConditionMap:function(e){return this.removeMap(d.ReactionComponent.CONDITION,e)},removeReactant:function(e,t){return this.removeItem(d.ReactionComponent.REACTANT,e,t)},removeProduct:function(e,t){return this.removeItem(d.ReactionComponent.PRODUCT,e,t)},removeSubstance:function(e,t){return this.removeItem(d.ReactionComponent.SUBSTANCE,e,t)},removeCondition:function(e,t){return this.removeItem(d.ReactionComponent.CONDITION,e,t)},clearReactants:function(){return this.clearComponent(d.ReactionComponent.REACTANT)},clearProducts:function(){return this.clearComponent(d.ReactionComponent.PRODUCT)},clearSubstance:function(){return this.clearComponent(d.ReactionComponent.SUBSTANCE)},clearConditions:function(){return this.clearComponent(d.ReactionComponent.CONDITION)},clearAll:function(){this.clearProducts(),this.clearProducts(),this.clearSubstance(),this.clearConditions()},getAllContainingConnectors:function(){for(var e=d.ReactionComponent,t=[e.REACTANT,e.PRODUCT,e.SUBSTANCE],r=[],n=0,i=t.length;n<i;++n)for(var o=t[n],a=0,s=this.getComponentItemCount(o);a<s;++a){var l=this.getMapItemAt(o,a);if(l.getAllContainingConnectors){var u=l.getAllContainingConnectors();u&&u.length&&(r=r.concat(u))}}return r}}),d.ReactionList=Class.create(d.ChemObjList,{CLASS_NAME:"Kekule.ReactionList",initialize:function(e){this.tryApplySuper("initialize",[e,d.Reaction])}}),function(){"use strict";var e=d.ArrayUtils;d.ChemStructureUtils={getConnectorLengthMedian:function(e,t,r){for(var n=[],i=0,o=e.length;i<o;++i){var a=e[i];if(a&&a.getLength){var s=a.getLength(t,r);s&&n.push(s)}}if(0===o)return 1;if(o<=1)return n[0];n.sort();var l=n.length;return l%2?n[l+1>>1]:(n[l>>1]+n[(l>>1)-1])/2},getChildStructureObjs:function(e,t){var r,n=!0;if(e instanceof d.CompositeMolecule)r=e.getSubMolecules().getAllObjs();else if(e instanceof d.ChemStructureObjectGroup)r=e.getAllObjs();else if(e instanceof d.ChemObjList)r=e.getItems();else if(e instanceof d.ChemSpaceElement)r=e.getChildren().getItems();else{if(!(e instanceof d.ChemSpace))return n=!1,[e];r=e.getChildren()}if(r=[].concat(r),t&&n){for(var i=[],o=0,a=r.length;o<a;++o){var s=r[o],l=d.ChemStructureUtils.getChildStructureObjs(s,t);!l.length||1===l.length&&l[0]===s?d.ArrayUtils.pushUnique(i,s):d.ArrayUtils.pushUnique(i,l)}r=i}return r},getAllStructFragments:function(e,t){if(e instanceof d.StructureFragment)return[e];for(var r=d.ChemStructureUtils.getChildStructureObjs(e,t),n=[],i=0,o=r.length;i<o;++i)r[i]instanceof d.StructureFragment&&d.ArrayUtils.pushUnique(n,r[i]);return n},getTotalStructFragment:function(e,t){var r=d.ChemStructureUtils.getAllStructFragments(e,!0),n=r.length;return n<=0?null:1===n?r[0]:d.ChemStructureUtils.mergeStructFragments(r,t)},getCascadeDeleteObjs:function(e){for(var t=[],r=e.getLinkedConnectors?e.getLinkedConnectors():[],n=0,i=r.length;n<i;++n){var o=r[n];if(o.getConnectedObjs().length<=2){d.ArrayUtils.pushUnique(t,o);var a=d.ChemStructureUtils.getCascadeDeleteObjs(o);d.ArrayUtils.pushUnique(t,a)}}if(e instanceof d.ChemStructureNode);else if(e instanceof d.ChemStructureConnector){var s=e.getConnectedObjs();for(n=0,i=s.length;n<i;++n){var l=s[n];l instanceof d.ChemStructureNode&&l.getLinkedConnectors().length<=1&&d.ArrayUtils.pushUnique(t,l)}}return t},moveChildBetweenStructFragment:function(e,t,r,n,i){return d.StructureFragment.moveChildBetweenStructFragment(e,t,r,n,i)},_getCascadeConnectedNodesAndConnectors:function(e,t){for(var r=[],n=[],i=e.getConnectedObjs(),o=0,a=i.length;o<a;++o){var s=i[o];if(s!==e)if(t&&(s=t.findDirectChildOfObj(s)),s instanceof d.ChemStructureNode)d.ArrayUtils.pushUnique(n,s);else if(s instanceof d.ChemStructureConnector){d.ArrayUtils.pushUnique(r,s);var l=d.ChemStructureUtils._getCascadeConnectedNodesAndConnectors(s);d.ArrayUtils.pushUnique(r,l.connectors),d.ArrayUtils.pushUnique(n,l.nodes)}}return{connectors:r,nodes:n}},mergeStructFragments:function(e,t){if(e.length<=1)return e[0];for(var r=new(t||d.Molecule),n=0,i=e.length;n<i;++n){var o=e[n].clone();d.ChemStructureUtils.moveChildBetweenStructFragment(o,r,o.getNodes(),o.getConnectors())}return r},splitStructFragment:function(e){if(!e.hasCtab())return[e];var t=e.getNodes();if(t.length<=0)return[e];var r=e.getConnectors(),n=[],i=[t[0]],o=[],a=0;do{var s=i[a],l=s.getLinkedConnectors();s.getCrossConnectors&&l.concat(s.getCrossConnectors()||[]),d.ArrayUtils.pushUnique(o,l);for(var u=0,c=l.length;u<c;++u){var h=d.ChemStructureUtils._getCascadeConnectedNodesAndConnectors(l[u],e);d.ArrayUtils.pushUnique(o,h.connectors),d.ArrayUtils.pushUnique(i,h.nodes)}++a}while(a<i.length);n.push(e);var p=d.ArrayUtils.exclude(t,i),g=d.ArrayUtils.exclude(r,o);if(p.length>0){var f=new(e.getClass());d.ChemStructureUtils.moveChildBetweenStructFragment(e,f,p,g);var m=d.ChemStructureUtils.splitStructFragment(f);n=n.concat(m)}return n},getAbsCoordVectorBetweenObjs:function(e,t,r,n){var i=e.getAbsCoordOfMode(r,n),o=t.getAbsCoordOfMode(r,n);return d.CoordUtils.substract(o,i)},_getRef2DCoordOfObj:function(e,t){return e.getAbsBaseCoord2D?e.getAbsBaseCoord2D(t):e.getAbsCoord2D?e.getAbsCoord2D(t):e.getCoord2D(t)},_getStandardizedLinkedObj2DRelCoords:function(t,r,n,i,o){var a=[],s=d.ChemStructureUtils._getRef2DCoordOfObj(t,n),l=o?t.getLinkedObjs():t.getLinkedExposedObjs();i&&t.getAttachedMarkers&&(l=l.concat(t.getAttachedMarkers()||[])),r&&r.length&&(l=e.exclude(l,r));for(var u=0,c=l.length;u<c;++u){var h=l[u],p=d.ChemStructureUtils._getRef2DCoordOfObj(h,n),g=d.CoordUtils.substract(p,s);g=d.CoordUtils.standardize(g),a.push(g)}return a},_calcLinkedObj2DAnglesOfObj:function(e,t,r,n,i){for(var o=[],a=d.ChemStructureUtils._getStandardizedLinkedObj2DRelCoords(e,t,r,n,i),s=0,l=a.length;s<l;++s){var u=a[s];if(0!==u.x||0!==u.y){var c=Math.atan2(u.y,u.x);c<0&&(c=2*Math.PI+c),o.push(c)}}return o.sort(),o},_getMostEmptyDirectionOfExistingAngles:function(e){var t=e.length;if(0===t)return 0;if(1===t)return d.GeometryUtils.standardizeAngle(Math.PI+e[0]);for(var r=0,n=0,i=0;i<t;++i){var o=e[i],a=e[(i+1)%t]-o;a<0&&(a+=2*Math.PI),a>r&&(r=a,n=i)}return e[n]+r/2},getMostEmptyDirection2DAngleOfObj:function(e,t,r,n,i,o){var a=d.ChemStructureUtils._calcLinkedObj2DAnglesOfObj(e,t,r,n,i);return o&&(a=a.concat(o)).sort(),d.ChemStructureUtils._getMostEmptyDirectionOfExistingAngles(a)},isSameRing:function(t,r){return t.nodes.length===r.nodes.length&&t.connectors.length===r.connectors.length&&!(e.exclude(t.nodes,r.nodes).length>0)&&!(e.exclude(t.connectors,r.connectors).length>0)},isInRings:function(e,t){for(var r=0,n=t.length;r<n;++r){var i=t[r];if(e===i)return!0;if(d.ChemStructureUtils.isSameRing(e,i))return!0}return!1},getImplicitHydrogenCount:function(e,t){var r=Object.extend({coValenceBondValenceSum:0,otherBondValenceSum:0,charge:0,radicalECount:0},t||{},!0),n=d.ValenceUtils.getImplicitValence(e,r.charge,r.coValenceBondValenceSum),i=(n-=r.radicalECount)-r.coValenceBondValenceSum-r.otherBondValenceSum;return r.allowNegative||(i=Math.max(n-r.coValenceBondValenceSum-r.otherBondValenceSum,0)),i}},d.TokenAnalyzer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.TokenAnalyzer",initialize:function(e){this.tryApplySuper("initialize"),this.setSrcText(e)},initProperties:function(){this.defineProp("srcText",{dataType:DataType.STRING,setter:function(e){var t=e||"";this.setPropStoreFieldValue("srcText",t),this.setPropStoreFieldValue("srcLength",t.length),this.setCurrPos(0)}}),this.defineProp("srcLength",{dataType:DataType.INT,setter:null,serializable:!1}),this.defineProp("currPos",{dataType:DataType.INT,serializable:!1})},getCharType:function(e){return 0},isCharTypeMatched:function(e,t){return e===t},nextCharInfo:function(){var e=this.getCurrPos();if(e>=this.getSrcLength())return null;var t=this.getSrcText().charAt(e);return this.setCurrPos(e+1),{char:t,charType:this.getCharType(t)}},nextTokenInfo:function(){var e=this.nextCharInfo();if(e){for(var t=e.char,r=e.charType,n=this.nextCharInfo();n&&this.isCharTypeMatched(n.charType,e.charType);)t+=n.char,e=n,n=this.nextCharInfo();return n&&this.setCurrPos(this.getCurrPos()-1),{token:t,tokenType:r}}return null},getAllTokenInfos:function(){for(var e=[],t=this.nextTokenInfo();t;)e.push(t),t=this.nextTokenInfo();return e}}),d.ChemTextTypes={CT_ATOM_SYMBOL_LEADING:1,CT_ATOM_SYMBOL_FOLLOWING:2,CT_CHARGE_SYMBOL:3,CT_NUMBER:4,CT_BRACKET_LEADING:10,CT_BRACKET_TAILING:11,CT_SEPARATOR:20,CT_UNKNOWN:0};var t=d.ChemTextTypes;d.ChemTextAnalyzer=Class.create(d.TokenAnalyzer,{CLASS_NAME:"Kekule.ChemTextAnalyzer",getCharType:function(e){return" "===e?t.CT_SEPARATOR:e>="0"&&e<="9"?t.CT_NUMBER:["+","-"].indexOf(e)>=0?t.CT_CHARGE_SYMBOL:["(","[","{"].indexOf(e)>=0?t.CT_BRACKET_LEADING:[")","]","}"].indexOf(e)>=0?t.CT_BRACKET_TAILING:e>="A"&&e<="Z"?t.CT_ATOM_SYMBOL_LEADING:e>="a"&&e<="z"?t.CT_ATOM_SYMBOL_FOLLOWING:t.CT_UNKNOWN},isCharTypeMatched:function(e,r){return!d.ArrayUtils.intersect([t.CT_BRACKET_LEADING,t.CT_BRACKET_TAILING],[e,r]).length&&(e===r&&r!==t.CT_ATOM_SYMBOL_LEADING||r===t.CT_ATOM_SYMBOL_LEADING&&e===t.CT_ATOM_SYMBOL_FOLLOWING)}}),d.FormulaUtils={FORMULA_BRACKETS:[["(",")"],["[","]"],["{","}"]],FORMULA_BRACKET_TYPE_COUNT:3,textToFormula:function(e,r,n){var i=n||null;i&&i.clear();var o=new d.ChemTextAnalyzer(e);try{var a=o.getAllTokenInfos();i||(i=new d.MolecularFormula(r));var s=a.length;if(s){var l,u,c=null,h=i;l={};for(var p=function(){l={}},g=function(){l&&l.obj&&h.appendSection(l.obj,l.count,l.charge)},f=0;f<s;++f){var m=a[f],C=m.tokenType,y=m.token,_=!1;if(C===t.CT_BRACKET_LEADING){g();var E=new d.MolecularFormula(r);E._parentFormula=h,h=E,p(),_=!0}else if(C===t.CT_BRACKET_TAILING)g(),p(),l.obj=h,h=h._parentFormula,m.asSymbol=!0,_=!0;else if([t.CT_ATOM_SYMBOL_LEADING,t.CT_ATOM_SYMBOL_FOLLOWING].indexOf(C)>=0){l.obj&&(g(),p());var T=l.massNum;T||c&&!c.handled&&c.tokenType===t.CT_NUMBER&&(T=parseInt(c.token,10)||null);var O=""+(T||"")+y;l.obj=d.ChemStructureNodeFactory.createByLabel(O),m.asSymbol=!0,_=!0}else if(C===t.CT_CHARGE_SYMBOL){if(u="+"===y?1:-1,m.asCharge=!0,c.tokenType===t.CT_NUMBER){var v;if(c.asCount)if(c.token.length>1){var S=c.token;v=S.substr(S.length-1),c.asCount&&(l.count=parseInt(S.substring(0,S.length-1),10))}else v=c.token,c.asCount&&(l.count=1);else v=c.token,c.asChargeCount=!0;u*=parseInt(v,10)}l.charge=u,_=!0}else if(C===t.CT_NUMBER){var b=parseInt(y,10);u&&c.tokenType===t.CT_CHARGE_SYMBOL&&c.asCharge?(u*=b,l.charge=u,m.asChargeCount=!0,_=!0):l.obj&&c.asSymbol?(l.count=b,m.asCount=!0,_=!0):l.obj||(l.massNum=b,_=!0)}m.handled=_,c=m}l&&l.obj&&g()}return i}finally{o.finalize()}},formulaToText:function(e,t,n){return d.ObjUtils.isUnset(t)&&(t=!0),r._convFormulaToText(e,!1,t,n)},_convFormulaToText:function(e,t,n,i){var o="",a=e.getSections();if(t){var s=e.getMaxNestedLevel()%r.FORMULA_BRACKET_TYPE_COUNT,l=r.FORMULA_BRACKETS[s][0],u=r.FORMULA_BRACKETS[s][1];o+=l}for(var c=0,h=a.length;c<h;++c){var p=a[c].obj,g=e.getSectionCharge(a[c]),f=null;if(p instanceof d.MolecularFormula?f=r._convFormulaToText(p,!0,!1,!1,i):p.getLabel&&(f=p.getLabel(),p.getMassNumber&&p.getMassNumber()&&(f=(o?" ":"")+f)),f){var m=!1;1!=a[c].count&&(f+=a[c].count,m=!0),n&&g&&(f+=(m?" ":"")+r._convChargeToText(g,i)),o+=f}}return t&&(o+=u),n&&(g=e.getCharge())&&(o+=r._convChargeToText(g,i)),o},_convChargeToText:function(e,t){if(!e)return null;var r=e>0?"+":"-",n=Math.abs(e),i=r;return 1!=n&&(i=(t?d.NumUtils.toDecimals(n,t):n.toString())+r),i}};var r=d.FormulaUtils;ClassEx.defineProp(d.MolecularFormula,"text",{dataType:DataType.STRING,serializable:!1,getter:function(){return r.formulaToText(this)},setter:function(e){r.textToFormula(e,this.getParent(),this)}})}(),function(){"use strict";d.Glyph={},d.Glyph.Base=Class.create(d.ChemObject,{CLASS_NAME:"Kekule.Glyph.Base",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initProperties:function(){},getAutoIdPrefix:function(){return"g"},getAllowChildCoordStickTo:function(e,t){return!1},getChildAcceptCoordStickFrom:function(e,t){return!1},getChildUseCoordStickOffset:function(e,t){return null}}),d.ClassDefineUtils.addStandardCoordSupport(d.Glyph.Base)}(),function(){"use strict";d.Glyph.ElectronArrowGlyphUtils={isValidChemNodeOrConnectorStickTarget:function(e){var t=e instanceof d.ChemStructureNode||e instanceof d.ChemStructureConnector;if(!t&&e instanceof d.ChemMarker.BaseMarker){var r=e.getParent&&e.getParent();r&&(t=r instanceof d.ChemStructureNode||r instanceof d.ChemStructureConnector)}return t},isValidElectronTarget:function(e){return d.Glyph.ElectronArrowGlyphUtils.isValidChemNodeOrConnectorStickTarget(e)},getValidElectronTarget:function(e){var t=e&&e.getCoordStickTarget&&e.getCoordStickTarget();return t&&d.Glyph.ElectronArrowGlyphUtils.isValidElectronTarget(t)?t:null},setValidElectronTarget:function(e,t){e.getAllowCoordStickTo&&e.getAllowCoordStickTo(t)&&(t?d.Glyph.ElectronArrowGlyphUtils.isValidElectronTarget(t)&&e.setCoordStickTarget(t):e.setCoordStickTarget(null))},getValidElectronTargetNodeOrConnector:function(e){var t=null,r=d.Glyph.ElectronArrowGlyphUtils.getValidElectronTarget(e);return r&&(t=r instanceof d.ChemMarker.BaseMarker?r.getParent():r),t}}}(),function(){"use strict";var e=d.CoordUtils,t=d.CoordMode;d.Glyph.PathGlyphNode=Class.create(d.BaseStructureNode,{CLASS_NAME:"Kekule.Glyph.PathGlyphNode",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e]),r&&this.setCoord2D(r),n&&this.setCoord3D(n),this.setNodeType(t||d.Glyph.NodeType.LOCATION)},initProperties:function(){this.defineProp("nodeType",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC}),this.defineProp("pathNodeParams",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLISHED,getter:function(){var e=this.getPropStoreFieldValue("pathNodeParams");return e||(e={},this.setPropStoreFieldValue("pathNodeParams",e)),e},setter:function(e){e?this.setPropStoreFieldValue("pathNodeParams",Object.extend({},e,!0)):this.setPropStoreFieldValue("pathNodeParams",null)}})},initPropValues:function(){this.tryApplySuper("initPropValues")},getAllowCoordStickTo:function(e){if(!e||!this.isSiblingWith(e)){var t=this.getParent();if(t&&t.getAllowChildCoordStickTo)return t.getAllowChildCoordStickTo(this,e)}return!1},getAcceptCoordStickFrom:function(e){var t=this.getParent();return!(!t||!t.getChildAcceptCoordStickFrom)&&t.getChildAcceptCoordStickFrom(this,e)},notifyCoordStickTargetChanged:function(e,t){this.tryApplySuper("notifyCoordStickTargetChanged",[e,t]);var r=this.getParent();if(d.ObjUtils.isUnset(this.getPathNodeParams().useStickingOffset)&&r.getChildUseCoordStickOffset){var n=r.getChildUseCoordStickOffset(this,t);d.ObjUtils.notUnset(n)&&(this.getPathNodeParams().useStickingOffset=n)}r.notifyChildCoordStickTargetChanged&&r.notifyChildCoordStickTargetChanged(this.oldTarget,t)}}),d.Glyph.NodeType={LOCATION:"location",CONTROLLER:"controller",HIDDEN:"hidden"},d.Glyph.PathGlyphConnectorControlNode=Class.create(d.BaseStructureNode,{CLASS_NAME:"Kekule.Glyph.PathGlyphConnectorControlNode",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setInteractMode(d.ChemObjInteractMode.UNSELECTABLE)},getAutoIdPrefix:function(){return"cn"},getAcceptCoordStickFrom:function(e){return!1},getParentConnector:function(){var e=this.getParent();return e&&e instanceof d.Glyph.PathGlyphConnector?e:null},isPositioned:function(e,r){return e||(e=t.COORD2D),this.doCheckIsPositioned(e,r)},doCheckIsPositioned:function(e,t){return!0},resetPosition:function(e){return e?this.doResetPosition(e):(this.doResetPosition(t.COORD2D),this.doResetPosition(t.COORD3D)),this},doResetPosition:function(e){}}),d.Glyph.PathType={LINE:"L",ARC:"A"},d.Glyph.ArrowType={NONE:null,OPEN:"open",TRIANGLE:"triangle"},d.Glyph.ArrowSide={DEFAULT:0,BOTH:0,SINGLE:1,REVERSED:-1},d.Glyph.PathGlyphConnector=Class.create(d.BaseStructureConnector,{CLASS_NAME:"Kekule.Glyph.PathGlyphConnector",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),this.setPathType(t)},initProperties:function(){this.defineProp("pathType",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLISHED,enumSource:d.Glyph.PathType}),this.defineProp("pathParams",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLISHED,getter:function(){var e=this.getPropStoreFieldValue("pathParams");return e||(e={},this.setPropStoreFieldValue("pathParams",e)),e},setter:function(e){e?this.setPropStoreFieldValue("pathParams",Object.extend({},e,!0)):this.setPropStoreFieldValue("pathParams",null)}}),this.defineProp("controlPoints",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLISHED,getter:function(e){var t=this.getPropStoreFieldValue("controlPoints");return!t&&e&&(t=[],this.setPropStoreFieldValue("controlPoints",t)),t&&!t.length&&this.doFillDefaultControlPoints(t),t},setter:function(e){this.clearControlPoints(),this.setPropStoreFieldValue("controlPoints",e),this._controlPointsChanged()}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setInteractMode(d.ChemObjInteractMode.UNSELECTABLE)},_appendChildObj:function(e){var t=this.tryApplySuper("_appendChildObj",[e]);return e instanceof d.Glyph.PathGlyphConnectorControlNode&&this.tryResetControlPointPosition(e),t},doPropChanged:function(e,t){return"connectedObjs"===e&&this.tryResetAllControlPointPositions(),this.tryApplySuper("doPropChanged",[e,t])},getAbsCoord2D:function(e){return this.getAbsCoordOfMode(d.CoordMode.COORD2D,e)},getAbsCoord3D:function(e){return this.getAbsCoordOfMode(d.CoordMode.COORD2D,e)},getAbsCoordOfMode:function(e,t){for(var r=d.CoordUtils,n={x:0,y:0},i=0,o=0,a=this.getConnectedObjCount();o<a;++o){var s=this.getConnectedObjAt(o);if(s&&s.getAbsCoordOfMode){var l=s.getAbsCoordOfMode(e,t);l&&(++i,n=r.add(n,l))}}return r.divide(n,i)},getChildSubgroupNames:function(){return["controlPoint"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof d.Glyph.PathGlyphArcConnectorControlNode?"controlPoint":this.tryApplySuper("getBelongChildSubGroupName",[e])},getControlPointCount:function(){var e=this.getControlPoints();return e&&e.length||0},getControlPointAt:function(e){return(this.getControlPoints()||[])[e]},indexOfControlPoint:function(e){var t=this.getControlPoints();return t?t.indexOf(e):-1},removeControlPointAt:function(e){var t=null,r=this.getControlPoints();return r&&e>=0&&e<r.length&&((t=r.splice(e,1)).setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this.notifyPropSet("controlPoints",this.getControlPoints())),t},removeControlPoint:function(e){var t=null,r=this.getControlPoints();if(r){var n=r.indexOf(e);n>=0&&(r.splice(n,1),e.setOwner&&e.setOwner(null),e.setParent&&e.setParent(null),t=e,this.notifyPropSet("controlPoints",this.getControlPoints()))}return t},insertControlPointAt:function(e,t){var r=this.getControlPoints();if(r&&t<r.length){var n=d.ArrayUtils.insertUniqueEx(r,e,t);return n.isInserted&&(e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this),this.notifyPropSet("controlPoints",this.getControlPoints())),n.index}return-1},insertControlPointBefore:function(e,t){var r=this.getControlPoints();if(r){var n=t?this.indexOfControlPoint(t):-1;return n<0&&(n=r.length),this.insertControlPointAt(e,n)}return-1},tryResetControlPointPosition:function(e){if(e.isPositioned&&e.resetPosition)for(var r=[t.COORD2D,t.COORD3D],n=0,i=r.length;n<i;++n){var o=r[n];e.isPositioned(o,!0)||e.resetPosition(o)}},tryResetAllControlPointPositions:function(){for(var e=0,t=this.getControlPointCount();e<t;++e){var r=this.getControlPointAt(e);this.tryResetControlPointPosition(r)}},doFillDefaultControlPoints:function(e){},removeChildObj:function(e){return this.removeControlPoint(e)},hasChildObj:function(e){return this.hasChild(e)},getNextSiblingOfChild:function(e){var t=this.indexOfChild(e);return++t,this.getChildAt(t)},_controlPointsChanged:function(){this._updateControlPointsOwner(),this._updateControlPointsParent()},_updateControlPointsOwner:function(e){e||(e=this.getOwner());var t=this.getControlPoints();if(t)for(var r=0,n=t.length;r<n;++r){var i=t[r];i.setOwner&&i.setOwner(e)}},_updateControlPointsParent:function(e){e||(e=this);var t=this.getControlPoints();if(t)for(var r=0,n=t.length;r<n;++r){var i=t[r];i.setParent&&i.setParent(e)}},clearControlPoints:function(){var e=this.getControlPoints();if(e&&(e=d.ArrayUtils.clone(e)),this.setPropStoreFieldValue("controlPoints",null),e)for(var t=0,r=e.length;t<r;++t){var n=e[t];n.setOwner&&n.setOwner(null),n.setParent&&n.setParent(null)}return this.notifyPropSet("controlPoints",null),this},modifyPathParams:function(e){if(e){var t=this.getPathParams();return t=Object.extend(t,e||{}),this.setPathParams(t),t}return null}}),d.Glyph.PathGlyphArcConnectorControlNode=Class.create(d.Glyph.PathGlyphConnectorControlNode,{CLASS_NAME:"Kekule.Glyph.PathGlyphArcConnectorControlNode",initProperties:function(){this.defineProp("distanceToChord",{dataType:DataType.FLOAT})},doCheckIsPositioned:function(e,t){return this.getIndirectCoordRefCoords(e,t)&&d.ObjUtils.notUnset(this.getDistanceToChord())},doResetPosition:function(r){if(r===t.COORD2D){var n=this.getIndirectCoordRefCoords(r,!0);if(n&&n[0]&&n[1]){var i=e.getDistance(n[0],n[1]);this.setDistanceToChord(.5*i),this.notifyPropSet("coord2D",this.getCoord2D())}}},doGetEnableIndirectCoord:function(){return!0},getIndirectCoordRefCoords:function(e,t){var r=this.getParentConnector();return r&&r.getConnectedObjCount()>=2?[r.getConnectedObjAt(0).getAbsCoordOfMode(t),r.getConnectedObjAt(1).getAbsCoordOfMode(t)]:this.tryApplySuper("getIndirectCoordRefCoords",[e])},calcIndirectCoordValue:function(r,n){if(r===t.COORD2D){var i=this.getDistanceToChord();if(d.ObjUtils.notUnset(i)){var o=this.getIndirectCoordRefCoords();if(o){var a=o[0],s=o[1];if(a&&s){var l=e.substract(s,a),u=Math.sign(l.x),c=Math.sign(l.y);if(d.NumUtils.isFloatEqual(l.x,0,1e-10))p={x:-i*c,y:0};else if(d.NumUtils.isFloatEqual(l.y,0,1e-10))p={x:0,y:i*u};else{var h=-1/(l.y/l.x),p={x:-c*i/Math.sqrt(1+Math.sqr(h))};p.y=p.x*h}return p}}}}return this.tryApplySuper("calcIndirectCoordValue",[r,n])},saveIndirectCoordValue:function(r,n,i,o){if(r===t.COORD2D){var a=i,s=this.getIndirectCoordRefCoords();if(s){var l=s[0],d=s[1],u=e.substract(d,l),c=Math.atan2(u.y,u.x),h=(e.getDistance(l,d),e.substract(n,a)),p=Math.atan2(h.y,h.x),g=e.getDistance(n,a)*Math.sin(p-c),f=(this.getDistanceToChord()||0)+g;return this.setDistanceToChord(f),f}}return this.tryApplySuper("saveIndirectCoordValue",[r,n])}}),d.Glyph.PathGlyphArcConnector=Class.create(d.Glyph.PathGlyphConnector,{CLASS_NAME:"Kekule.Glyph.PathGlyphArcConnector",initialize:function(e,t){this.tryApplySuper("initialize",[e,d.Glyph.PathType.ARC,t]);var r=this._createDefaultControlPoints();this.setControlPoints(r)},getControlPoint:function(){return(this.getControlPoints()||[])[0]},doFillDefaultControlPoints:function(e){var t=this._createDefaultControlPoints();d.ArrayUtils.pushUnique(e,t)},_createDefaultControlPoints:function(){return[new d.Glyph.PathGlyphArcConnectorControlNode(null,{x:0,y:0})]}}),d.Glyph.PathGlyph=Class.create(d.Glyph.Base,{CLASS_NAME:"Kekule.Glyph.PathGlyph",initialize:function(e,t,r,n,i){this.tryApplySuper("initialize",[e,n,i]),this.createDefaultStructure(t||1,r||{})},doFinalize:function(){this.hasCtab()&&this.getCtab().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("ctab",{dataType:"Kekule.StructureConnectionTable",scope:Class.PropertyScope.PUBLIC,getter:function(e){return this.getPropStoreFieldValue("ctab")||e&&this.createCtab(),this.getPropStoreFieldValue("ctab")},setter:function(e){var t=this.getPropStoreFieldValue("ctab");t&&(t.finalize(),t=null),e&&(e.setPropValue("parent",this,!0),e.setOwner(this.getOwner())),this.setPropStoreFieldValue("ctab",e)}}),this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNodes():[]}}),this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getConnectors():[]}})},createDefaultStructure:function(e,t){e||(e=1);var r={},n=["startArrowLength","startArrowWidth","endArrowLength","endArrowWidth"];for(var i in t)n.indexOf(i)>=0?r[i]=t[i]*e:r[i]=t[i];return this.doCreateDefaultStructure(e,r)},doCreateDefaultStructure:function(e,t){},getAutoIdPrefix:function(){return"p"},ownerChanged:function(e,t){this.hasCtab()&&this.getCtab().setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){if(this.hasCtab()){var t=this.getCtab();t===e?this.removeCtab():t.hasChildObj(e)&&t.removeChildObj(e)}this.tryApplySuper("_removeChildObj",[e])},isEmpty:function(){return this.getCtab().isEmpty()},createCtab:function(){var e=new d.StructureConnectionTable(this.getOwner(),this);this.setPropStoreFieldValue("ctab",e),e.addEventListener("propValueSet",(function(e){"nodes"==e.propName&&this.notifyPropSet(e.propName,e.propValue)}),this),e.setEnablePropValueSetEvent(!0)},hasCtab:function(){return!!this.getPropStoreFieldValue("ctab")},getContainerBox:function(e,t){return this.hasCtab()?this.getCtab().getContainerBox(e,t):this.tryApplySuper("getContainerBox",[e])},getNodeById:function(e){return this.hasCtab()?this.getCtab().getNodeById(e):null},getConnectorById:function(e){return this.hasCtab()?this.getCtab().getConnectorById(e):null},getObjectById:function(e){return this.getNodeById(e)||this.getConnectorById(e)},getNodeCount:function(){return this.hasCtab()?this.getCtab().getNodeCount():0},getNodeAt:function(e){return this.hasCtab()?this.getCtab().getNodeAt(e):null},indexOfNode:function(e){return this.hasCtab()?this.getCtab().indexOfNode(e):-1},hasNode:function(e,t){return this.hasCtab()?this.getCtab().hasNode(e,t):null},appendNode:function(e){return this.doGetCtab(!0).appendNode(e)},insertNodeAt:function(e,t){return this.doGetCtab(!0).insertNodeAt(e,t)},insertNodeBefore:function(e,t){var r=t?this.indexOfNode(t):-1;return r<0?this.appendNode(e):this.doGetCtab(!0).insertNodeAt(e,r)},removeNodeAt:function(e,t){return this.hasCtab()?this.getCtab().removeNodeAt(e,t):null},removeNode:function(e,t){return this.hasCtab()?this.getCtab().removeNode(e,t):null},replaceNode:function(e,t){return this.hasCtab()?this.getCtab().replaceNode(e,t):null},clearNodes:function(){if(this.hasCtab())return this.getCtab().clearNodes()},nodesHasCoord2D:function(e){return!!this.hasCtab()&&this.getCtab().nodesHasCoord2D(e)},nodesHasCoord3D:function(e){return!!this.hasCtab()&&this.getCtab().nodesHasCoord3D(e)},getConnectorCount:function(){return this.hasCtab()?this.getCtab().getConnectorCount():0},getConnectorAt:function(e){return this.hasCtab()?this.getCtab().getConnectorAt(e):null},indexOfConnector:function(e){return this.hasCtab()?this.getCtab().indexOfConnector(e):-1},hasConnector:function(e,t){return this.hasCtab()?this.getCtab().hasConnector(e,t):null},appendConnector:function(e){return this.doGetCtab(!0).appendConnector(e)},insertConnectorAt:function(e,t){return this.doGetCtab(!0).insertConnectorAt(e,t)},insertConnectorBefore:function(e,t){var r=t?this.indexOfConnector(t):-1;return r<0?this.appendConnector(e):this.doGetCtab(!0).insertConnectorAt(e,r)},removeConnectorAt:function(e,t){return this.hasCtab()?this.getCtab().removeConnectorAt(e,t):null},removeConnector:function(e,t){return this.hasCtab()?this.getCtab().removeConnector(e,t):null},clearConnectors:function(){if(this.hasCtab())return this.getCtab().clearConnectors()},_getObjsNeedToBeCascadeRemoved:function(e,t){return this.hasCtab()?this.getCtab()._getObjsNeedToBeCascadeRemoved(e,t):[]},getChildSubgroupNames:function(){return["node","connector"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof d.Glyph.PathGlyphNode?"node":e instanceof d.Glyph.PathGlyphConnector?"connector":this.tryApplySuper("getBelongChildSubGroupName",[e])},removeChildObj:function(e,t,r){this.hasCtab()&&this.getCtab().removeChildObj(e,t,r)},hasChildObj:function(e){return!!this.hasCtab()&&this.getCtab().hasChildObj(e)},getNextSiblingOfChild:function(e){return this.hasCtab()?this.getCtab().getNextSiblingOfChild(e):null},getDirectManipulationTarget:function(){return null}})}(),function(){"use strict";var e=d.ObjUtils,t=(d.Glyph.NodeType,d.Glyph.PathType),r=d.CoordUtils,n=d.CoordMode;d.Glyph.StraightLine=Class.create(d.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.StraightLine",initialize:function(e,t,r,n,i){this.tryApplySuper("initialize",[e,t,r,n,i])},doCreateDefaultStructure:function(e,r){var n=d.CoordUtils,i={x:0,y:0},o={x:0,y:0,z:0},a={x:e*(r.lineLength||1)},s=new d.Glyph.PathGlyphNode(null,null,i,o),l=new d.Glyph.PathGlyphNode(null,null,n.add(i,a),n.add(o,a)),u=new d.Glyph.PathGlyphConnector(null,t.LINE,[s,l]);this._applyParamsToConnector(u,r),this.appendNode(s),this.appendNode(l),this.appendConnector(u)},_applyParamsToConnector:function(e,t){var r=Object.create(t);d.ObjUtils.isUnset(t.autoOffset)&&(r.autoOffset=!1),e.setPathParams(r)},getDirectManipulationTarget:function(){return this.getNodeAt(this.getNodeCount()-1)}}),d.Glyph.Polygon=Class.create(d.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.Polygon",initialize:function(e,t,r,n,i){this.tryApplySuper("initialize",[e,t,r,n,i])},getRefLengthRatio:function(){return 1},doCreateDefaultStructure:function(e,r){for(var n,i,o=d.CoordUtils,a={x:0,y:0},s={x:0,y:0,z:0},l=r.nodeProps,u=r.connectorProps,c=e*(r.lineLength||1)*this.getRefLengthRatio(),h=r.edgeCount||3,p=2*Math.PI/h,g=h%2?0:-p/2,f=0;f<h;++f){var m={x:c*Math.sin(g),y:c*Math.cos(g)},C=new d.Glyph.PathGlyphNode(null,null,o.add(a,m),o.add(s,m));if(l&&C.setPropValues(l),this.appendNode(C),0===f&&(n=C),i){var y=new d.Glyph.PathGlyphConnector(null,t.LINE,[i,C]);u&&y.setPropValues(u),this._applyParamsToConnector(y,r),this.appendConnector(y)}i=C,g+=p}y=new d.Glyph.PathGlyphConnector(null,t.LINE,[C,n]),u&&y.setPropValues(u),this._applyParamsToConnector(y,r),this.appendConnector(y)},_applyParamsToConnector:function(e,t){e.setPathParams(t)}}),d.Glyph.BaseArc=Class.create(d.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.BaseArc",initialize:function(e,t,r,n,i){this.tryApplySuper("initialize",[e,t,r,n,i])},doCreateDefaultStructure:function(e,t){var r=d.CoordUtils,n={x:0,y:0},i={x:0,y:0,z:0},o={x:e*(t.lineLength||1)},a=new d.Glyph.PathGlyphNode(null,null,n,i),s=new d.Glyph.PathGlyphNode(null,null,r.add(n,o),r.add(i,o));this.appendNode(a),this.appendNode(s);var l=new d.Glyph.PathGlyphArcConnector(null,[a,s]);this._applyParamsToConnector(l,t),this.appendConnector(l),l.setInteractMode(d.ChemObjInteractMode.HIDDEN)},getDirectManipulationTarget:function(){return this.getNodeAt(this.getNodeCount()-1)},_isValidChemNodeOrConnectorStickTarget:function(e){return d.Glyph.ElectronArrowGlyphUtils.isValidChemNodeOrConnectorStickTarget(e)},_applyParamsToConnector:function(e,t){e.setPathParams(t)},getAllowChildCoordStickTo:function(e,t){return!t||this._isValidChemNodeOrConnectorStickTarget(t,e)&&!this._isChildrenStickingTo(t,[e])},getChildUseCoordStickOffset:function(e,t){return t instanceof d.ChemStructureNode||t instanceof d.ChemStructureConnector},_isChildrenStickingTo:function(e,t){for(var r=this.getNodes(),n=0,i=(r=d.ArrayUtils.exclude(r,t||[])).length;n<i;++n)if(r[n].getCoordStickTarget()===e)return!0;return!1}}),d.Glyph.BaseTwinArc=Class.create(d.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.BaseTwinArc",DEF_MIN_PATH_END_DISTANCE_RATIO:.05,DEF_INIT_PATH_END_GAP_RATIO:.2,FIELD_ARC_END_NODE_FLAG:"__$arcEndNode$__",initialize:function(e,t,r,n,i){this.setPropStoreFieldValue("minPathEndDistanceRatio",this.DEF_MIN_PATH_END_DISTANCE_RATIO),this.tryApplySuper("initialize",[e,t,r,n,i])},initProperties:function(){this.defineProp("minPathEndDistanceRatio",{dataType:DataType.FLOAT}),this.defineProp("oppositePathEndArrowSides",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._isPathArrowSideOpposite("end")},setter:function(e){this._setPathArrowSideOpposite("end",!!e)}}),this.defineProp("oppositePathStartArrowSides",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._isPathArrowSideOpposite("start")},setter:function(e){this._setPathArrowSideOpposite("start",!!e)}})},loaded:function(){var e=this.tryApplySuper("loaded");return this._isTwinArcSetup()&&(this._setupArcEndNode(this.getNodeAt(1)),this._setupArcEndNode(this.getNodeAt(2))),e},_isPathArrowSideOpposite:function(t){var r=this.getConnectorCount();if(r<2)return null;for(var n,i=null,o=0;o<r;++o){var a=this.getConnectorAt(o).getPathParams();if(a[t+"ArrowType"]===d.Glyph.ArrowType.NONE)return null;var s=a[t+"ArrowSide"];if(s===d.Glyph.ArrowSide.BOTH)return null;if(0===o)n=s;else{var l=n!==s;if(e.isUnset(i))i=l;else if(i!==l)return null;n=s}}return i},_setPathArrowSideOpposite:function(t,r){var n=this.getConnectorCount();if(n<2)return null;for(var i,o=d.Glyph.ArrowSide,a=!0,s=0;s<n;++s){var l=this.getConnectorAt(s).getPathParams();l[t+"ArrowType"]===d.Glyph.ArrowType.NONE&&(a=!1);var u,c=l[t+"ArrowSide"];c===d.Glyph.ArrowSide.BOTH&&(a=!1),a?e.isUnset(i)?i=c:(u=r?i===o.SINGLE?o.REVERSED:o.SINGLE:i,l[t+"ArrowSide"]=u,i=u):i=null}return null},_isTwinArcSetup:function(){return 2===this.getConnectorCount()&&4===this.getNodeCount()},getDirectManipulationTarget:function(){return this.getNodeAt(this.getNodeCount()-1)},doCreateDefaultStructure:function(e,t){var n=d.CoordUtils,i={x:0,y:0},o={x:0,y:0,z:0},a=t.lineLength||1,s=t.minPathEndDistanceRatio||this.getMinPathEndDistanceRatio()||this.DEF_MIN_PATH_END_DISTANCE_RATIO,l=a*s;this.setMinPathEndDistanceRatio(s);var u=t.pathEndGap||a*this.DEF_INIT_PATH_END_GAP_RATIO,c={x:e*((a-(u=Math.max(u,l)))/2)},h={x:e*u},p={x:e*a},g=new d.Glyph.PathGlyphNode(null,null,i,o),f=new d.Glyph.PathGlyphNode(null,null);this._setupArcEndNode(f);var m=new d.Glyph.PathGlyphNode(null,null),C=new d.Glyph.PathGlyphNode(null,null,n.add(i,p),n.add(o,p));this._setupArcEndNode(m),this.appendNode(g),this.appendNode(f),this.appendNode(m),this.appendNode(C),f.setCoord2D(n.add(i,c)).setCoord3D(n.add(o,c)),m.setCoord2D(n.add(i,r.add(c,h))).setCoord3D(n.add(o,r.add(c,h)));var y=new d.Glyph.PathGlyphArcConnector(null,[g,f]),_=new d.Glyph.PathGlyphArcConnector(null,[C,m]);this._applyParamsToConnector(y,t),this._applyParamsToConnector(_,t),_.getControlPointAt(0).setDistanceToChord(-_.getControlPointAt(0).getDistanceToChord()),this.appendConnector(y),this.appendConnector(_),y.setInteractMode(d.ChemObjInteractMode.HIDDEN),_.setInteractMode(d.ChemObjInteractMode.HIDDEN)},_applyParamsToConnector:function(e,t){e.setPathParams(t)},_setupArcEndNode:function(e){e[this.FIELD_ARC_END_NODE_FLAG]||(this._overwriteChildPathNodeMethods(e),e.setEnableIndirectCoord(!0),e[this.FIELD_ARC_END_NODE_FLAG]=!0)},_overwriteChildPathNodeMethods:function(e){e.overwriteMethod("getIndirectCoordRefLengths",this._insideNodeGetIndirectCoordRefLengths).overwriteMethod("getIndirectCoordRefCoords",this._insideNodeGetIndirectCoordRefCoords).overwriteMethod("calcIndirectCoordStorage",this._insideNodeCalcIndirectCoordStorage).overwriteMethod("calcIndirectCoordValue",this._insideNodeCalcIndirectCoordValue).overwriteMethod("_childPathNodeGetParentGlyph",this._childPathNodeGetParentGlyph).overwriteMethod("_childPathNodeGetGlyphMinPathEndDistanceRatio",this._childPathNodeGetGlyphMinPathEndDistanceRatio)},_getArrowStartingNodes:function(){var e=[];if(this._isTwinArcSetup())for(var t=0,r=this.getConnectorCount();t<r;++t){var n=this.getConnectorAt(t).getConnectedObjAt(0);n&&e.push(n)}return e},_childPathNodeGetParentGlyph:function(e){var t=this.getParent();return t instanceof d.Glyph.BaseTwinArc?t:null},_childPathNodeGetGlyphMinPathEndDistanceRatio:function(e){var t=this._childPathNodeGetParentGlyph();return t&&t.getMinPathEndDistanceRatio()},_insideNodeGetIndirectCoordRefLengths:function(e,t,r){var n=this.getParent();if(!n||t!==d.CoordMode.COORD2D)return e(t,r);var i=n.getNodeAt(0),o=n.getNodeAt(n.getNodeCount()-1);if(i&&o){var a=i.getAbsCoordOfMode(t),s=o.getAbsCoordOfMode(t),l=d.CoordUtils.getDistance(s,a);return{x:l,y:l,length:l}}},_insideNodeGetIndirectCoordRefCoords:function(e,t,r){var i=this.getParent();if(!i||t!==n.COORD2D)return e(t,r);var o=i.getNodeAt(0),a=i.getNodeAt(i.getNodeCount()-1);return o&&a?[o.getCoordOfMode(t),a.getCoordOfMode(t)]:void 0},_insideNodeCalcIndirectCoordStorage:function(e,t,i,o,a){var s=this.getParent();if(s&&t===n.COORD2D){var l=this.getIndirectCoordRefCoords(t,a);if(l){var u=s.getNodeAt(0).getCoordOfMode(t),c=d.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(i,l[0],l[1],!1);c||(c=r.getDistance(i,l[0])<r.getDistance(i,l[1])?l[0]:l[1]);var h=r.getDistance(u,c),p=r.getDistance(l[1],l[0]),g=p?h/p:0,f=this._childPathNodeGetGlyphMinPathEndDistanceRatio()||0;return g<f?g=f:g>1-f&&(g=1-f),{x:g,y:g,ratio:g}}}return e(t,i,o,a)},_insideNodeCalcIndirectCoordValue:function(e,t,i){var o=this.getParent();if(o&&t===n.COORD2D){var a=this.getIndirectCoordRefCoords(t,i);if(a){var s=r.substract(a[1],a[0]),l=o.getNodeAt(0).getCoordOfMode(t),u=this.getIndirectCoordStorageOfMode(t).ratio;if(d.ObjUtils.notUnset(u)){var c=r.multiply(s,u);return r.add(l,c)}}}return e(t,i)},_isValidChemNodeOrConnectorStickTarget:function(e){var t=e instanceof d.ChemStructureNode||e instanceof d.ChemStructureConnector;if(!t&&e instanceof d.ChemMarker.BaseMarker){var r=e.getParent&&e.getParent();r&&(t=r instanceof d.ChemStructureNode||r instanceof d.ChemStructureConnector)}return t},getAllowChildCoordStickTo:function(e,t){var r=this.indexOfNode(e);return(0===r||r===this.getNodeCount()-1)&&(!t||this._isValidChemNodeOrConnectorStickTarget(t,e)&&!this._isChildrenStickingTo(t,[e]))},getChildUseCoordStickOffset:function(e,t){return t instanceof d.ChemStructureNode||t instanceof d.ChemStructureConnector},_isChildrenStickingTo:function(e,t){for(var r=this._getArrowStartingNodes(),n=0,i=(r=d.ArrayUtils.exclude(r,t||[])).length;n<i;++n)if(r[n].getCoordStickTarget()===e)return!0;return!1}}),d.Glyph.Arc=Class.create(d.Glyph.BaseArc,{CLASS_NAME:"Kekule.Glyph.Arc"}),d.Glyph.TwinArc=Class.create(d.Glyph.BaseTwinArc,{CLASS_NAME:"Kekule.Glyph.TwinArc"})}(),function(){"use strict";var e=d.ObjUtils,t=(d.Glyph.NodeType,d.Glyph.PathType),r=d.Glyph.ElectronArrowGlyphUtils;d.Glyph.HeatSymbol=Class.create(d.Glyph.Polygon,{CLASS_NAME:"Kekule.Glyph.HeatSymbol",initialize:function(e,t,r,n,i){this.tryApplySuper("initialize",[e,t,r,n,i]),this.setRenderOption&&this.setRenderOption("strokeWidth",1.5)},getRefLengthRatio:function(){return.25},doCreateDefaultStructure:function(e,t){return t.edgeCount=3,t.nodeProps=Object.extend(t.nodeProps||{},{interactMode:d.ChemObjInteractMode.HIDDEN}),t.connectorProps=Object.extend(t.connectorProps||{},{interactMode:d.ChemObjInteractMode.HIDDEN}),this.tryApplySuper("doCreateDefaultStructure",[e,t])},_applyParamsToConnector:function(e,t){return this.tryApplySuper("_applyParamsToConnector",[e,t])}}),d.Glyph.AddSymbol=Class.create(d.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.AddSymbol",initialize:function(e,t,r,n,i){this.tryApplySuper("initialize",[e,t,r,n,i]),this.setRenderOption&&this.setRenderOption("strokeWidth",1.5)},getRefLengthRatio:function(){return.5},doCreateDefaultStructure:function(e,r){var n={interactMode:d.ChemObjInteractMode.HIDDEN},i={interactMode:d.ChemObjInteractMode.HIDDEN},o=d.CoordUtils,a={x:0,y:0},s={x:0,y:0,z:0},l=e*this.getRefLengthRatio()*(r.lineLength||1)/2,u=new d.Glyph.PathGlyphNode(null,null,a,s);u.setPropValues(n),this.appendNode(u);for(var c=[{x:-l,y:0},{x:0,y:-l},{x:l,y:0},{x:0,y:l}],h=0,p=c.length;h<p;++h){var g=c[h],f=new d.Glyph.PathGlyphNode(null,null,o.add(a,g),o.add(s,g));f.setPropValues(n);var m=new d.Glyph.PathGlyphConnector(null,t.LINE,[u,f]);m.setPropValues(i),this._applyParamsToConnector(m,r),this.appendNode(f),this.appendConnector(m)}},_applyParamsToConnector:function(e,t){e.setPathParams(t)}}),d.Glyph.Segment=Class.create(d.Glyph.StraightLine,{CLASS_NAME:"Kekule.Glyph.Segment"}),d.Glyph.ReactionArrowType={NORMAL:"normal",REVERSIBLE:"reversible",RESONANCE:"resonance",RETROSYNTHESIS:"retrosynthesis",CUSTOM:"custom"},d.Glyph.ReactionArrowType.getDefPathParamOfArrowType=function(e){var t,r=d.Glyph.ReactionArrowType,n=d.Glyph.ArrowType,i=d.Glyph.ArrowSide;switch(e){case r.NORMAL:t={startArrowType:n.NONE,endArrowType:n.OPEN,endArrowSide:i.BOTH,lineCount:1};break;case r.REVERSIBLE:t={startArrowType:n.OPEN,startArrowSide:i.REVERSED,endArrowType:n.OPEN,endArrowSide:i.SINGLE,lineGap:.1,lineCount:2};break;case r.RESONANCE:t={startArrowType:n.OPEN,startArrowSide:i.BOTH,endArrowType:n.OPEN,endArrowSide:i.BOTH,lineCount:1};break;case r.RETROSYNTHESIS:t={startArrowType:n.NONE,endArrowType:n.OPEN,endArrowSide:i.BOTH,lineGap:.1,lineCount:2};break;default:t=null}return t},d.Glyph.ReactionArrow=Class.create(d.Glyph.StraightLine,{CLASS_NAME:"Kekule.Glyph.ReactionArrow",initProperties:function(){this.defineProp("reactionType",{dataType:DataType.STRING,enumSource:d.Glyph.ReactionArrowType,setter:function(e){this.setPropStoreFieldValue("reactionType",e),this.reactionTypeChanged(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setReactionType(d.Glyph.ReactionArrowType.NORMAL)},doCreateDefaultStructure:function(e,t){var r=t,n=t.reactionType||this.getReactionType();if(n){var i=this._getPathParamOfArrowType(n);r=Object.extend(i,t)}var o=this.tryApplySuper("doCreateDefaultStructure",[e,r]);return n&&this.setReactionType(n),o},reactionTypeChanged:function(e){var t=this._getPathParamOfArrowType(e);if(t){var r=this.getConnectorAt(0);r&&r.modifyPathParams(t)}},_getPathParamOfArrowType:function(e){return d.Glyph.ReactionArrowType.getDefPathParamOfArrowType(e)}}),d.Glyph.ElectronPushingArrow=Class.create(d.Glyph.BaseArc,{CLASS_NAME:"Kekule.Glyph.ElectronPushingArrow",initProperties:function(){this.defineProp("electronCount",{dataType:DataType.INT,getter:function(){var e=this._getValidArrowSide(),t=d.Glyph.ArrowSide;return e===t.BOTH?2:[t.SINGLE,t.REVERSED].indexOf(e)>=0?1:null},setter:function(e){var t=d.Glyph.ArrowSide,r=this._getValidArrowPos(),n=this.getConnectorAt(0);r||(n.getPathParams().endArrowType=d.Glyph.ArrowType.OPEN,r="end");var i=n.getPathParams();e>=2?i[r+"ArrowSide"]=t.BOTH:1===e&&(i[r+"ArrowSide"]=t.SINGLE),n.setPathParams(i)}}),this.defineProp("directReceptor",{dataType:"Kekule.ChemStructureObject",getter:function(){var e=this.getNodeAt(1);return this._getValidElectronTarget(e)},setter:function(e){var t=this.getNodeAt(1);this._setValidElectronTarget(t,e)}}),this.defineProp("directDonor",{dataType:"Kekule.ChemStructureObject",getter:function(){var e=this.getNodeAt(0);return this._getValidElectronTarget(e)},setter:function(e){var t=this.getNodeAt(0);this._setValidElectronTarget(t,e)}}),this.defineProp("receptor",{dataType:"Kekule.ChemStructureObject",getter:function(){var e=this.getNodeAt(1);return this._getValidElectronTargetNodeOrConnector(e)},setter:function(e){var t=this.getNodeAt(1);this._setValidElectronTarget(t,e)}}),this.defineProp("donor",{dataType:"Kekule.ChemStructureObject",getter:function(){var e=this.getNodeAt(0);return this._getValidElectronTargetNodeOrConnector(e)},setter:function(e){var t=this.getNodeAt(0);this._setValidElectronTarget(t,e)}})},doCreateDefaultStructure:function(e,t){var r=this.tryApplySuper("doCreateDefaultStructure",[e,t]);return t.electronCount&&this.setElectronCount(t.electronCount),r},_isValidElectronTarget:function(e){return this._isValidChemNodeOrConnectorStickTarget(e)},_getValidElectronTarget:function(e){return d.Glyph.ElectronArrowGlyphUtils.getValidElectronTarget(e)},_setValidElectronTarget:function(e,t){return d.Glyph.ElectronArrowGlyphUtils.setValidElectronTarget(e,t),this},_getValidElectronTargetNodeOrConnector:function(e){return d.Glyph.ElectronArrowGlyphUtils.getValidElectronTargetNodeOrConnector(e)},_getValidArrowPos:function(){var e=this.getConnectorAt(0),t=e&&e.getPathParams();if(t){if(t.endArrowType)return"end";if(t.startArrowType)return"start"}return null},_getValidArrowSide:function(){var e=this.getConnectorAt(0),t=e&&e.getPathParams();if(t){if(t.endArrowType)return t.endArrowSide||d.Glyph.ArrowSide.DEFAULT;if(t.startArrowType)return t.startArrowSide||d.Glyph.ArrowSide.DEFAULT}return null},_applyParamsToConnector:function(e,t){var r=Object.create(t);d.ObjUtils.isUnset(t.autoOffset)&&(r.autoOffset=!0),e.setPathParams(r)}}),d.Glyph.BondFormingElectronPushingArrow=Class.create(d.Glyph.BaseTwinArc,{CLASS_NAME:"Kekule.Glyph.BondFormingElectronPushingArrow",initProperties:function(){this.defineProp("electronCount",{dataType:DataType.INT,getter:function(){for(var t=null,r=0,n=this.getConnectorCount();r<n;++r){var i=this._getConnectorElectronCount(this.getConnectorAt(r));if(e.notUnset(i))if(e.isUnset(t))t=i;else if(t!==i)return null}return t*this.getConnectorCount()},setter:function(e){if(e!==this.getElectronCount()){var t=this.getConnectorCount()?e/this.getConnectorCount():e;(t=Math.round(t))<=0&&(t=1);for(var r=d.Glyph.ArrowSide,n=this.getConnectors(),i=0,o=n.length;i<o;++i){var a=n[i];a.getPathParams().endArrowType=d.Glyph.ArrowType.OPEN;var s=a.getPathParams();t>=2?s.endArrowSide=r.BOTH:1===t&&(s.endArrowSide=i%2?r.SINGLE:r.REVERSED),a.setPathParams(s)}}}}),this.defineProp("directDonors",{dataType:DataType.ARRAY,getter:function(){for(var e=this._getArrowStartingNodes(),t=[],n=0,i=e.length;n<i;++n){var o=r.getValidElectronTarget(e[n]);o&&t.push(o)}return t},setter:function(e){var t=this._getArrowStartingNodes();if(t.length)for(var n=0,i=t.length;n<i;++n){var o=t[n];e[n],r.setValidElectronTarget(o,e)}}}),this.defineProp("donors",{dataType:DataType.ARRAY,getter:function(){for(var e=this._getArrowStartingNodes(),t=[],n=0,i=e.length;n<i;++n){var o=r.getValidElectronTargetNodeOrConnector(e[n]);o&&t.push(o)}return t},setter:function(e){this.setDirectDonors(e)}})},_getConnectorElectronCount:function(e){var t=e&&e.getPathParams();if(t){var r=d.Glyph.ArrowSide,n=t.endArrowType?t.endArrowSide||d.Glyph.ArrowSide.DEFAULT:null;if(n===r.BOTH)return 2;if([r.SINGLE,r.REVERSED].indexOf(n)>=0)return 1}return null},doCreateDefaultStructure:function(e,t){var r=this.tryApplySuper("doCreateDefaultStructure",[e,t]);return this.setElectronCount(t.electronCount||1),r}})}(),function(){"use strict";d.CoordMode,d.CoordUtils,d.ContentBlock=Class.create(d.ChemObject,{CLASS_NAME:"Kekule.ContentBlock",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initProperties:function(){this.defineProp("needRecalcSize",{dataType:DataType.BOOL})},getAutoIdPrefix:function(){return"b"},getCornerCoord1:function(e,t){return this.getCoordOfMode(e,t)},getCornerCoord2:function(e,t){var r=this.getCornerCoord1(e,t),n=this.getSizeOfMode(e,t);return d.CoordUtils.add(r,n)},getContainerBox:function(e,t){var r=this.getAbsCoordOfMode(e,t)||{},n=this.getSizeOfMode(e,t)||{};if(e===d.CoordMode.COORD3D)var i=d.CoordUtils.add(r,this.getSizeOfMode(e,t)||{});else i={x:r.x+n.x,y:r.y-n.y};return d.BoxUtils.createBox(r,i)}}),d.ClassDefineUtils.addStandardCoordSupport(d.ContentBlock),d.ClassDefineUtils.addStandardSizeSupport(d.ContentBlock),d.TextBlock=Class.create(d.ContentBlock,{CLASS_NAME:"Kekule.TextBlock",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e,r,n]),this.setText(t||"")},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"t"},doObjectChange:function(e){d.ArrayUtils.intersect(["text","renderOptions"],e).length&&this.setNeedRecalcSize(!0)}}),d.ImageBlock=Class.create(d.ContentBlock,{CLASS_NAME:"Kekule.ImageBlock",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e,r,n]),t&&this.setSrc(t)},initProperties:function(){this.defineProp("src",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLISHED,setter:function(e){e!==this.getSrc()&&(this.setPropStoreFieldValue("src",e),this._clearCacheImg())}}),this.defineProp("cacheImg",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("cacheImg");return!e&&d.$document&&(e=this._createCacheImg(this.getSrc())),e}})},getAutoIdPrefix:function(){return"g"},_createCacheImg:function(e){var t,r=d.$document;return r&&r.body&&r.createElement&&((t=r.createElement("img")).src=e),t},_clearCacheImg:function(){var e=this.getPropStoreFieldValue("cacheImg");if(e){e.src="";try{delete e.width,delete e.height}catch(e){}}}})}(),function(){"use strict";var e=d.ArrayUtils;d.ChemMarker={},ClassEx.extend(d.ChemObject,{isAttachedMarker:function(){var e=this.getParent();return e&&e.hasMarker(this)},notifyAttachedMarkersChanged:function(){this.notifyPropSet("attachedMarkers",this.getPropStoreFieldValue("attachedMarkers"))},_attachedMarkerAdded:function(e){},_attachedMarkerRemoved:function(e){},getMarkerCount:function(){var e=this.getPropStoreFieldValue("attachedMarkers");return e?e.length:0},getMarkerAt:function(e){var t=this.getPropStoreFieldValue("attachedMarkers");return t?t[e]:null},getMarkerOfType:function(e,t){for(var r=0,n=this.getMarkerCount();r<n;++r){var i=this.getMarkerAt(r);if(t&&i.getClass()===e||i instanceof e)return i}return null},getMarkersOfType:function(e,t){for(var r=[],n=0,i=this.getMarkerCount();n<i;++n){var o=this.getMarkerAt(n);(t&&o.getClass()===e||o instanceof e)&&r.push(o)}return r},fetchMarkerOfType:function(e,t,r,n){var i=this.getMarkerOfType(e,r);if(!i&&t){(i=new e).beginUpdate();try{n&&i.setPropValues(n),this.appendMarker(i)}finally{i.endUpdate()}}return i},getUnplacedMarkers:function(e){for(var t=[],r=0,n=this.getMarkerCount();r<n;++r){var i=this.getMarkerAt(r);i.getCoordOfMode(e)||t.push(i)}return t},indexOfMarker:function(e){var t=this.getPropStoreFieldValue("attachedMarkers");return t?t.indexOf(e):-1},hasMarker:function(e){return this.indexOfMarker(e)>=0},hasMarkerOfType:function(e,t){return!!this.getMarkerOfType(e,t)},appendMarker:function(e){var t=this.indexOfMarker(e);if(t>=0)return t;var r=this.getAttachedMarkers(!0).push(e);e.beginUpdate();try{e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this),this._attachedMarkerAdded(e)}finally{e.endUpdate()}return this.notifyAttachedMarkersChanged(),r},insertMarkerBefore:function(e,t){var r=this.indexOfMarker(t);return this.insertMarkerAt(e,r)},insertMarkerAt:function(t,r){this.indexOfMarker(t);var n=this.getAttachedMarkers(!0);(d.ObjUtils.isUnset(r)||r<0)&&(r=n.length);var i=e.insertUniqueEx(n,t,r);return i.isInserted&&(t.setOwner&&t.setOwner(this.getOwner()),t.setParent&&t.setParent(this),this._attachedMarkerAdded(t)),this.notifyAttachedMarkersChanged(),i.index},setMarkerIndex:function(e,t){var r=this.indexOfMarker(e);if(r>=0){var n=this.getPropStoreFieldValue("attachedMarkers");n.splice(r,1),n.splice(t,0,e)}},removeMarkerAt:function(e){var t=this.getMarkerAt(e);if(t){var r=this.getAttachedMarkers(!0).splice(e,1);return t.setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this._attachedMarkerRemoved(t),this.notifyAttachedMarkersChanged(),r}},removeMarker:function(e){var t=this.indexOfMarker(e);if(t>=0)return this.removeMarkerAt(t)},replaceMarker:function(e,t){var r=this.indexOfMarker(e);return r<0||(this.removeMarkerAt(r),this.insertMarkerAt(t,r)),this},clearMarkers:function(){var t=this.getPropStoreFieldValue("attachedMarkers");if(t&&(t=e.clone(t)),this.setPropStoreFieldValue("attachedMarkers",null),t)for(var r=0,n=t.length;r<n;++r){var i=t[r];i.setOwner&&i.setOwner(null),i.setParent&&i.setParent(null),this._attachedMarkerRemoved(i)}return this.notifyAttachedMarkersChanged(),this},autoSetMarker2DPos:function(e,t,r,n){if(this.hasMarker(e)){var i=d.ChemStructureUtils.getMostEmptyDirection2DAngleOfObj(this,[e],r,!0,!1,n),o={x:t*Math.cos(i),y:t*Math.sin(i)};e.setCoord2D(o)}},_updateAttachedMarkersOwner:function(e){e||(e=this.getOwner());for(var t=0,r=this.getMarkerCount();t<r;++t){var n=this.getMarkerAt(t);n.setOwner&&n.setOwner(e)}},_updateAttachedMarkersParent:function(e){e||(e=this);for(var t=0,r=this.getMarkerCount();t<r;++t){var n=this.getMarkerAt(t);n.setParent&&n.setParent(e)}}}),ClassEx.extendMethod(d.ChemObject,"ownerChanged",(function(e,t){e(t),this._updateAttachedMarkersOwner(t)})),ClassEx.extendMethod(d.ChemObject,"removeChild",(function(e,t){var r=e(t);return r||(r=this.removeMarker(t)),r})),ClassEx.extendMethod(d.ChemObject,"insertBefore",(function(e,t,r){var n=e(t,r);return n<0&&(r&&this.hasMarker(r)||t instanceof d.ChemMarker.BaseMarker)&&(n=this.insertMarkerBefore(t,r)),n})),ClassEx.extendMethod(d.ChemObject,"getChildSubgroupNames",(function(e){return e().concat("marker")})),ClassEx.defineProp(d.ChemObject,"attachedMarkers",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLISHED,getter:function(e){var t=this.getPropStoreFieldValue("attachedMarkers");return!t&&e&&(t=[],this.setPropStoreFieldValue("attachedMarkers",t)),t},setter:function(e){this.clearMarkers(),this.setPropStoreFieldValue("attachedMarkers",e),this._updateAttachedMarkersOwner(),this._updateAttachedMarkersParent()}})}(),function(){"use strict";d.ChemMarker.BaseMarker=Class.create(d.ChemObject,{CLASS_NAME:"Kekule.ChemMarker.BaseMarker",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},getAutoIdPrefix:function(){return"marker"},getAcceptCoordStickFrom:function(e){return!(this.isSiblingWith(e)||e instanceof d.ChemStructureNode||e instanceof d.BaseStructureConnector)}}),d.ClassDefineUtils.addStandardCoordSupport(d.ChemMarker.BaseMarker),d.ChemMarker.UnbondedElectronSet=Class.create(d.ChemMarker.BaseMarker,{CLASS_NAME:"Kekule.ChemMarker.UnbondedElectronSet",initProperties:function(){this.defineProp("electronCount",{dataType:DataType.VARIANT})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setElectronCount(2)},getAutoIdPrefix:function(){return"electron"}}),d.ChemMarker.ChemPropertyMarker=Class.create(d.ChemMarker.BaseMarker,{CLASS_NAME:"Kekule.ChemMarker.ChemPropertyMarker",initProperties:function(){this.defineProp("value",{dataType:DataType.VARIANT,serializable:!1,getter:function(){var e,t=this.getParent(),r=this.getPropertyName();return t&&r?(e=t.getPropValue(r),this.setPropStoreFieldValue("value",e)):e=this.getPropStoreFieldValue("value"),e},setter:function(e){this.setPropStoreFieldValue("value",e),this.setParentPropValue(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues")},setParentPropValue:function(e){var t=this.getParent();if(t){var r=this.getPropertyName();r&&t&&t.setPropValue(r,e)}return this},resetParentPropValue:function(){return this.setParentPropValue(void 0)},getPropertyName:function(){return null},beforAddingByEditor:function(e,t){if(e){var r=this.getPropStoreFieldValue("value");d.ObjUtils.notUnset(r)&&this.setParentPropValue(r)}this.tryApplySuper("beforAddingByEditor")},beforeRemovingByEditor:function(e){this.setPropStoreFieldValue("value",this.getValue()),this.resetParentPropValue()}}),d.ChemMarker.Charge=Class.create(d.ChemMarker.ChemPropertyMarker,{CLASS_NAME:"Kekule.ChemMarker.Charge",getPropertyName:function(){return"charge"},getAutoIdPrefix:function(){return"charge"}}),d.ChemMarker.Radical=Class.create(d.ChemMarker.ChemPropertyMarker,{CLASS_NAME:"Kekule.ChemMarker.Radical",getPropertyName:function(){return"radical"},getAutoIdPrefix:function(){return"radical"}}),ClassEx.extend(d.ChemStructureNode,{fetchChargeMarker:function(e,t){return this.fetchMarkerOfType(d.ChemMarker.Charge,e,!1,t)},fetchRadicalMarker:function(e,t){return this.fetchMarkerOfType(d.ChemMarker.Radical,e,!1,t)}}),ClassEx.defineProp(d.AbstractAtom,"lonePairCount",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED,serializable:!1,setter:null,getter:function(){for(var e=0,t=this.getMarkersOfType(d.ChemMarker.UnbondedElectronSet),r=0,n=t.length;r<n;++r)2===t[r].getElectronCount()&&++e;return e}}),ClassEx.extendMethod(d.AbstractAtom,"doCompare",(function(e,t,r){var n=e(t,r);if(!n&&r.method===d.ComparisonMethod.CHEM_STRUCTURE&&(this._getComparisonOptionFlagValue(r,"lonePair")||this._getComparisonOptionFlagValue(r,"unbondedElectron"))){var i=function(e){var t=[];if(e.getMarkersOfType)for(var r=e.getMarkersOfType(d.ChemMarker.UnbondedElectronSet),n=0,i=r.length;n<i;++n){var o=r[n];t.push(o.getElectronCount())}return t.sort(),t},o=i(this),a=i(t);return d.ArrayUtils.compare(o,a)}return n}))}(),function(e){"use strict";"undefined"!=typeof window&&(e=window);var t,r,n,i=e,o=i&&i.document;void 0===d&&(d={}),"undefined"==typeof navigator?(d.Browser={},d.BrowserFeature={}):(d.Browser={IE:!(!i.attachEvent||i.opera),Opera:!!i.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("like Gecko")<0&&-1==navigator.userAgent.indexOf("KHTML"),MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/),language:navigator.language||navigator.browserLanguage},d.Browser.IEVersion=d.Browser.IE&&-1!==(n=navigator.userAgent.toLowerCase()).indexOf("msie")&&parseInt(n.split("msie")[1]),d.BrowserFeature={typedArray:"undefined"!=typeof ArrayBuffer,svg:!!i.SVGSVGElement,canvas:!!i.CanvasRenderingContext2D,webgl:!!function(){try{var e=o.createElement("canvas");return!!i.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(e){return!1}}(),htmlTemplate:!!i.HTMLTemplateElement,htmlSlot:!!i.HTMLSlotElement,downloadHref:"download"in o.createElement("a"),blob:!!i.Blob,workers:!!i.Worker,fileapi:!!(i.File&&i.FileReader&&i.FileList&&i.Blob),sessionStorage:function(){try{return!!i.sessionStorage}catch(e){return!1}}(),localStorage:function(){try{return!!i.localStorage}catch(e){return!1}}(),cssTransition:(r=o.createElement("div").style,"transition"in r||"WebkitTransition"in r||"MozTransition"in r||"msTransition"in r||"OTransition"in r),cssTranform:function(e){return"transform"in e||"WebkitTransform"in e||"MozTransform"in e||"msTransform"in e||"OTransform"in e}(o.createElement("div").style),cssFlex:function(e){return"flex"in e||"WebkitFlex"in e||"MozFlex"in e||"msFlex"in e||"OFlex"in e}(o.createElement("div").style),cssGrid:function(e){return"grid"in e||"WebkitGrid"in e||"MozGrid"in e||"msGrid"in e||"OGrid"in e}(o.createElement("div").style),html5Form:{placeholder:"placeholder"in o.createElement("input"),supportType:function(e){var t=o.createElement("input");t.setAttribute("type",e);var r=t.type===e;return r&&["text","url","search"].indexOf(e.toLowerCase())<0&&(t.value=":)",r=":)"!==t.value),r}},mutationObserver:i.MutationObserver||i.MozMutationObserver||i.WebkitMutationObserver,resizeObserver:!!i.ResizeObserver,touchEvent:!!i.touchEvent,pointerEvent:!!i.PointerEvent,draggable:(t=o.createElement("div"),"draggable"in t||"ondragstart"in t&&"ondrop"in t)}),function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!i.requestAnimationFrame;++r)i.requestAnimationFrame=i[t[r]+"RequestAnimationFrame"],i.cancelAnimationFrame=i[t[r]+"CancelAnimationFrame"]||i[t[r]+"CancelRequestAnimationFrame"];i.requestAnimationFrame||(i.requestAnimationFrame=function(t,r){var n=(new Date).getTime(),o=Math.max(0,16-(n-e)),a=i.setTimeout((function(){t(n+o)}),o);return e=n+o,a}),i.cancelAnimationFrame||(i.cancelAnimationFrame=function(e){clearTimeout(e)})}(),d.X={};var a,s=d.X,l=function(e){return!function(e){return null==e}(e)},u=function(e){var t=i.getComputedStyle?i.getComputedStyle(e,null).position:e.currentStyle?e.currentStyle.position:null;return!!t&&!!t&&("relative"===(t=t.toString().toLowerCase())||"absolute"===t)};if(s.MutationObserver=i.MutationObserver||i.MozMutationObserver||i.WebkitMutationObserver,s.Event={MOUSE_BTN_LEFT:0,MOUSE_BTN_RIGHT:2,MOUSE_BTN_MID:1,MOUSE_BTN_LR:3},s.Event.PointerType={MOUSE:"mouse",TOUCH:"touch",PEN:"pen"},s.Event.MouseButton={LEFT:0,RIGHT:2,MID:1,LR:3},s.Event.KeyCode={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRTSC:44,INS:45,DEL:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145},s.Event.isSupported=(a={},function(e){if(0===e.indexOf("touch"))return d.BrowserFeature.touchEvent;if(0===e.indexOf("pointer"))return d.BrowserFeature.pointerEvent;var t={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img",unload:"win",resize:"win"},r=e.replace(/^on/,"");if(a[r])return a[r];var n="win"==t[r]?i:o.createElement(t[r]||"div"),s=(e="on"+r)in n;return s||(n.setAttribute(e,"return;"),s="function"==typeof n[e]),n=null,a[r]=s,s}),s.Event.Methods={getType:function(e){return e.__$type__||e.type},setType:function(e,t){e.__$type__=t;try{e.type=t}catch(e){}},getPointerType:function(e){return e.pointerType},getTarget:function(e){var t=e.__$target__||e.target||e.srcElement;return 3==t.nodeType&&(t=t.parentNode),t},setTarget:function(e,t){e.__$target__=t;try{e.target=t}catch(e){}},getCurrentTarget:function(e){return e.currentTarget},getEventPhase:function(e){return e.eventPhase},getAltKey:function(e){return e.altKey},getCtrlKey:function(e){return e.ctrlKey},getShiftKey:function(e){return e.shiftKey},getMetaKey:function(e){return e.metaKey},getRepeat:function(e){return e.repeat},getCharCode:function(e){return l(e.charCode)?e.charCode:e.keyCode},getKeyCode:function(e){return e.keyCode},getKey:function(e){return e.key},getCode:function(e){return e.code},getClientX:function(e){var t;if(e.touches){var r=e.touches[0];t=r&&r.clientX}return void 0===t&&(t=e.clientX),t},getClientY:function(e){var t;if(e.touches){var r=e.touches[0];t=r&&r.clientY}return void 0===t&&(t=e.clientY),t},getScreenX:function(e){var t;if(e.touches){var r=e.touches[0];t=r&&r.screenX}return void 0===t&&(t=e.screenX),t},getScreenY:function(e){var t;if(e.touches){var r=e.touches[0];t=r&&r.screenY}return void 0===t&&(t=e.screenY),t},getPageX:function(e){var t;if(e.touches){var r=e.touches[0];r&&l(r.pageX)&&(t=r.pageX)}if(void 0===t&&l(e.pageX)&&(t=e.pageX),void 0===t){var n=s.Event.getTarget(e).ownerDocument||s.Event.getTarget(e),i=n?n.body:null;t=s.Event.getClientX(e)+(n&&n.scrollLeft||i&&i.scrollLeft||0)-(n&&n.clientLeft||i&&i.clientLeft||0)}return t},getPageY:function(e){var t;if(e.touches){var r=e.touches[0];if(r&&l(r.pageY))return r.pageY}else if(void 0===t&&l(e.pageY))return e.pageY;if(void 0===t){var n=s.Event.getTarget(e).ownerDocument||s.Event.getTarget(e),i=n?n.body:null;t=s.Event.getClientY(e)+(n&&n.scrollTop||i&&i.scrollTop||0)-(n&&n.clientTop||i&&i.clientTop||0)}return t},getOffsetX:function(e){if(l(e.offsetX))return e.offsetX;var t=s.Event.getTarget(e);if((t.defaultView||t.parentWindow)&&t.body&&(t=t.body),l(e.layerX)&&u(t)&&!e.touches)return e.layerX;var r=s.Event.getClientX(e);return Math.round(r-d.HtmlElementUtils.getElemPagePos(t,!0).x)},getOffsetY:function(e){if(l(e.offsetY))return e.offsetY;var t=s.Event.getTarget(e);if((t.defaultView||t.parentWindow)&&t.body&&(t=t.body),l(e.layerY)&&u(t)&&!e.touches)return e.layerY;var r=s.Event.getClientY(e);return Math.round(r-d.HtmlElementUtils.getElemPagePos(t,!0).y)},getOffsetCoord:function(e,t){var r,n=s.Event.getTarget(e);if(t&&d.ObjUtils.isUnset(e.offsetX)&&(r=d.StyleUtils.getTotalTransformMatrix(n)),r){var i=s.Event.getClientX(e),o=s.Event.getClientY(e),a={x:i-d.HtmlElementUtils.getElemBoundingClientRect(n).x,y:o-d.HtmlElementUtils.getElemBoundingClientRect(n).y},l=d.StyleUtils.calcInvertTransformMatrix(r);if(l){var u=d.MatrixUtils.create(3,1);u[0][0]=a.x,u[1][0]=a.y,u[2][0]=1;var c=d.MatrixUtils.multiply(l,u);return a.x=c[0][0],a.y=c[1][0],a}}return{x:s.Event.getOffsetX(e),y:s.Event.getOffsetY(e)}},getWindowX:function(e){var t=s.Event.getPageX(e),r=e.target.ownerDocument||e.target,n=r&&(r.defaultView||r.parentWindow);return t-(n&&n.scrollX||0)},getWindowY:function(e){var t=s.Event.getPageY(e),r=e.target.ownerDocument||e.target,n=r&&(r.defaultView||r.parentWindow);return t-(n&&n.scrollY||0)},getRelXToCurrTarget:function(e){var t=s.Event.getCurrentTarget(e);(t.defaultView||t.parentWindow)&&t.body&&(t=t.body);var r=s.Event.getClientX(e);return Math.round(r-d.HtmlElementUtils.getElemPagePos(t,!0).left)},getRelYToCurrTarget:function(e){var t=s.Event.getCurrentTarget(e);(t.defaultView||t.parentWindow)&&t.body&&(t=t.body);var r=s.Event.getClientY(e);return Math.round(r-d.HtmlElementUtils.getElemPagePos(t,!0).top)},getTouches:function(e){return e.touches}},s.Event._MouseEventEx={isMouseEnterLeaveEvent:function(e){return"mouseenter"===e||"mouseleave"===e},addMouseEnterLeaveListener:function(e,t,r,n){if("mouseenter"===t&&s.Event.isSupported("mouseenter")||"mouseleave"===t&&s.Event.isSupported("mouseleave"))return e.addEventListener(t,r,n);var o=function(e){var n=e.getTarget?e.getTarget():e.target,o=e.getCurrentTarget?e.getCurrentTarget():e.currentTarget;if(n===o||d.DomUtils.isDescendantOf(n,o)){var a=e.getRelatedTarget?e.getRelatedTarget():e.relatedTarget;if(!a||!d.DomUtils.isDescendantOf(a,o)){var s=new MouseEvent(t,{view:i,bubbles:!1,cancelable:!0,target:o,currentTarget:o,relatedTarget:a});r.call(o,s)}}};r.__$mouseExListenerWrapper__=o;var a="mouseenter"===t?"mouseover":"mouseout";return e.addEventListener(a,o,n)},removeMouseEnterLeaveListener:function(e,t,r){if("mouseenter"===t&&s.Event.isSupported("mouseenter")||"mouseleave"===t&&s.Event.isSupported("mouseleave"))return e.removeEventListener(t,r);var n="mouseenter"===t?"mouseover":"mouseout";return e.removeEventListener(n,r.__$mouseExListenerWrapper__||r)}},s.Event._W3C={addListener:function(e,t,r,n){return s.Event._MouseEventEx.isMouseEnterLeaveEvent(t)?s.Event._MouseEventEx.addMouseEnterLeaveListener(e,t,r,n):e.addEventListener(t,r,n)},removeListener:function(e,t,r,n){return s.Event._MouseEventEx.isMouseEnterLeaveEvent(t)&&r.__$listenerWrapper__?s.Event._MouseEventEx.removeMouseEnterLeaveListener(e,t,r.__$listenerWrapper__):e.removeEventListener(t,r,n)},stopPropagation:function(e){e.stopPropagation()},preventDefault:function(e){e.preventDefault()}},s.Event._W3CMethods={getRelatedTarget:function(e){return e.relatedTarget},getButton:function(e){return e.button}},s.Event._Gecko={addListener:function(e,t,r,n){if(s.Event._MouseEventEx.isMouseEnterLeaveEvent(t))return s.Event._MouseEventEx.addMouseEnterLeaveListener(e,t,r,n);if("mousewheel"===t){var i=function(t){t.wheelDeltaY=t.wheelDelta=40*-t.detail,t.__$type__="mousewheel",r.call(e,t)};r.__$mousewheelListenerWrapper__=i,e.addEventListener("DOMMouseScroll",i,n)}else e.addEventListener(t,r,n)},removeListener:function(e,t,r,n){"mousewheel"===t&&r.__$mousewheelListenerWrapper__?e.removeEventListener("DOMMouseScroll",r.__$mousewheelListenerWrapper__,n):e.removeEventListener(t,r,n)}},s.Event._IE={_handlers:{},WIN_UNLOAD_FLAG_FIELD:"__$win_unload_linked__",addListener:function(e,t,r,n){if(!(s.Event.findHandlerIndex(e,t,r)>=0)){var i=function(t){t||(t=a.event),t.currentTarget=e,t.eventPhase=t.srcElement===e?2:3,p||Object.extend(t,g),r.call(e,t)};e.attachEvent(s.Event.getEventName(t),i),s.Event.registerHandler(e,t,r,i);var o=e.ownerDocument||e,a=o.parentWindow||o;s.Event._linkUnloadEvent(a)}},removeListener:function(e,t,r,n){var i=s.Event.findHandlerIndex(e,t,r);if(i>=0){var o=s.Event._handlers[t][i].wrapper;e.detachEvent(s.Event.getEventName(t),o),s.Event._handlers[t].splice(i,1)}},stopPropagation:function(e){e.cancelBubble=!0},preventDefault:function(e){e.returnValue=!1},removeAllListeners:function(e){var t=s.Event._handlers;if(t)for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];if(n&&n.length)for(var i=s.Event.getEventName(r),o=n.length-1;o>=0;--o){var a=n[o];e&&a.element.ownerDocument!==e||(a.element.detachEvent(i,a.wrapper),n.splice(o,1))}}},getEventName:function(e){return"on"+e},registerHandler:function(e,t,r,n){var i=s.Event._handlers;i[t]||(i[t]=[]),i[t].push({element:e,handler:r,wrapper:n})},unregisterHandler:function(e,t,r){if(r[t]){var n=r[t],i=s.Event.findHandlerIndex(e,t,r);i>=0&&n.splice(i,1)}},findHandlerIndex:function(e,t,r){var n=s.Event._handlers[t];if(!n)return-1;for(var i=0,o=n.length;i<o;++i){var a=n[i];if(a.element===e&&a.handler===r)return i}return-1},_linkUnloadEvent:function(e){var t=s.Event.WIN_UNLOAD_FLAG_FIELD;e[t]||(e.attachEvent("onunload",s.Event.reactWinUnload),e[t]=!0)},reactWinUnload:function(){var e=this.ownerDocument;s.Event.removeAllListeners(e)}},s.Event._IEMethods={getRelatedTarget:function(e){var t=e.type;return["focusin","mouseenter","mouseover","pointerenter","pointerover","dragenter"].indexOf(t)>=0?e.fromElement||e.toElement:e.toElement||e.fromElement},getButton:function(e){switch(e.button){case 1:return 0;case 2:return 2;case 4:return 1;case 3:return 3;default:return e.button}},stopPropagation:function(e){e.cancelBubble=!0},preventDefault:function(e){e.returnValue=!1}},o)if(o.addEventListener)s.Event=Object.extend(s.Event,s.Event._W3C),s.Event.Methods=Object.extend(s.Event.Methods,s.Event._W3CMethods),d.Browser.Gecko&&(s.Event=Object.extend(s.Event,s.Event._Gecko));else if(o.attachEvent&&(s.Event=Object.extend(s.Event,s.Event._IE),s.Event.Methods=Object.extend(s.Event.Methods,s.Event._IEMethods),i.Element)){var c=i.Element.prototype;c.addEventListener=s.Event.addListener.methodize(),c.removeEventListener=s.Event.removeListener.methodize()}Object.extend(s.Event,s.Event.Methods);var h=null;i.Event&&(h=i.Event.prototype),h||o&&o.createEvent&&(h=o.createEvent("HTMLEvents").__proto__);var p=!!h,g={},f=s.Event.Methods;for(var m in f)f.hasOwnProperty(m)&&"function"==typeof f[m]&&(g[m]=f[m].methodize());h&&Object.extend(h,g),function(){if(void 0!==o){var e=o.createElement("div");!("draggable"in e)&&"ondragstart"in e&&"ondrop"in e&&d.X.Event.addListener(o,"selectstart",(function(e){for(var t=e.target;t;t=t.parentNode)if(t.attributes&&t.attributes.draggable)return e.preventDefault(),e.stopImmediatePropagation?e.stopImmediatePropagation():e.stopPropagation(),t.dragDrop(),!1}))}}(),s.Ajax={XMLHttpFactories:[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],_availableFactoryIndex:-1,createXMLHTTPObject:function(){var e=!1,t=s.Ajax.XMLHttpFactories,r=s.Ajax._availableFactoryIndex;if(r>=0)e=t[r]();else for(var n=0;n<t.length;n++){try{e=t[n](),s.Ajax._availableFactoryIndex=n}catch(e){continue}break}return e},preparePostData:function(e){var t=e;return"object"==typeof e&&(t=d.UrlUtils.generateSearchString(e)),t},request:function(e){return s.Ajax.sendRequest(e.url,e.callback,e.postData,e.xhrProps)},sendRequest:function(e,t,r,n,i){var o=!1,a=!0,l=s.Ajax.createXMLHTTPObject();if(l){var d,u,c=r?"POST":"GET";if(l.open(c,e,!0),l.setRequestHeader("User-Agent","XMLHTTP/1.0"),r&&l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n&&("object"==typeof n?(d=(u=n).responseType,i=u.overwriteMimeType):"string"==typeof n&&(d=n)),d){try{l.responseType=d}catch(e){}"arraybuffer"!==d&&"blob"!==d||(o=!0),l.responseType!==d&&(a=!1)}if(o&&!a&&l.overwriteMimeType&&l.overrideMimeType("text/plain; charset=x-user-defined"),i&&l.overwriteMimeType&&l.overwriteMimeType(i),u)for(var h in u)if(h in l)try{l[h]=u[h]}catch(e){}if(l.onreadystatechange=function(){if(4==l.readyState){if(200!=l.status&&304!=l.status)throw t(null,l,!1),"HTTP error "+l.status;t(l.response||l.responseText,l,!0)}},4!=l.readyState)return l.send(s.Ajax.preparePostData(r)),l}},getResponseMimeType:function(e){return e.getResponseHeader("content-type")||""}},d.Ajax=d.X.Ajax,d.X.DomReady={isReady:!1,suspendFlag:0,funcs:[],domReady:function(e,t){if(t||(t=o),C.initReady(t),!C.isReady){var r=t&&t.readyState;("complete"===r||"loaded"===r||"interactive"===r&&!d.Browser.IE)&&(C.isReady=!0)}C.isReady?e():C.funcs.push(e)},fireReady:function(){C.isReady||(C.isReady=!0,C._execFuncs())},_execFuncs:function(){var e=C.funcs;if(e&&e.length)for(;e.length&&!C.isSuspending();){var t=e.shift();t&&t()}},suspend:function(){++C.suspendFlag},resume:function(){C.suspendFlag>0&&--C.suspendFlag,C.isSuspending()||C._execFuncs()},isSuspending:function(){return C.suspendFlag>0},initReady:function e(t){t||(t=o),t&&t.addEventListener?t.addEventListener("DOMContentLoaded",(function(){t.removeEventListener("DOMContentLoaded",e,!1),C.fireReady()}),!1):t&&t.getElementById&&(t.write('<script id="ie-domReady" defer="defer" src="//:"><\/script>'),t.getElementById("ie-domReady").onreadystatechange=function(){"complete"===this.readyState&&(C.fireReady(),this.onreadystatechange=null,this.parentNode.removeChild(this))})}};var C=d.X.DomReady;d.X.domReady=C.domReady}(this),function(e){"use strict";var t=!0;"undefined"==typeof window&&(t=!1),d.NativeServices={MODE_OPEN:"open",MODE_SAVE:"save",FILTER_ALL_SUPPORT:"all",FILTER_ANY:"any",showFilePickerDialog:function(e,t,r){if(d.NativeServices.doShowFilePickerDialog)return d.NativeServices.doShowFilePickerDialog(e,t,r)},canLoadFileData:function(e){return!!r.doLoadFileData||!!r.doShowFilePickerDialog},loadFileData:function(e,t,n){if(d.NativeServices.doLoadFileData)return d.NativeServices.doLoadFileData(e,t,n);var i=Object.create(n||{});i.multiple=!1,i.mode=r.MODE_OPEN,r.showFilePickerDialog(e,(function(e,r,n){if(e&&r)if(d.BrowserFeature.fileapi){var o=r.name,a=i.binaryDetector&&i.binaryDetector(o,r),s=new FileReader;s.onload=function(e){var r=s.result;t&&t(!0,r,o)},s.onerror=function(){t&&t(!1),d.error(d.$L("ErrorMsg.ERROR_LOADING_FILE"+o))},a?s.readAsArrayBuffer(r):s.readAsText(r)}else d.error(d.$L("ErrorMsg.FILE_API_NOT_SUPPORTED"));else t(e,null,null)}),i)},canSaveFileData:function(e){return!!r.doSaveFileData},saveFileData:function(e,t,r,n){if(d.NativeServices.doSaveFileData)return d.NativeServices.doSaveFileData(e,t,r,n)}};var r=d.NativeServices;d.HtmlNativeServiceImpl={doShowFilePickerDialog:function(e,t,r){d.HtmlNativeServiceImpl._createFileInputElem(e,t,r||{}).click()},_createFileInputElem:function(e,t,r){var n=e.createElement("input");n.setAttribute("type","file");var i=r||{};if(i.multiple&&n.setAttribute("multiple","multiple"),i.filters){for(var o=[],a=0,s=i.filters.length;a<s;++a){var l=i.filters[a];if(l!==d.NativeServices.FILTER_ALL_SUPPORT&&l!==d.NativeServices.FILTER_ANY){var u=l.filter;u&&o.push(u)}}var c=o.join(",");n.setAttribute("accept",c)}var h=n.style;h.position="absolute",h.left="-100000px",h.opacity=0,e.body.appendChild(n);return d.X.Event.addListener(n,"change",(function e(r){var n=r.getTarget(),i=n.files,o=i&&i[0];t&&t(!0,o,i),d.X.Event.removeListener(n,"change",e),n.ownerDocument.body.focus(),n.parentNode})),n},doSaveFileData:function(e,t,r,n){var i=n.initialFileName||null,o=d.HtmlNativeServiceImpl._createDataElem(e,t,i);o.click(),o.parentNode.removeChild(o),r&&r(null,null)},_createDataElem:function(e,t,r){var n=e.createElement("a"),i="data:application/octet-stream,"+encodeURIComponent(t);return n.setAttribute("href",i),n.setAttribute("download",r||""),n.style,n.position="absolute",n.left="-100000px",n.opacity=0,e.body.appendChild(n),n},doSaveFileDataIe:function(e,r,n,i){var o=i.initialFileName||null;if(d.BrowserFeature.blob&&t&&window.navigator.msSaveOrOpenBlob){var a=new Blob([r]);window.navigator.msSaveBlob(a,o)}else{var s=d.HtmlNativeServiceImpl._createAndExecDataIframe(e,r,o);s.parentNode.removeChild(s)}n&&n(null,null)},_createAndExecDataIframe:function(e,t,r){var n=e.createElement("iframe");e.body.appendChild(n);var i=n.contentWindow||n.contentDocument;i.document.open("text/html","replace");var o=t.toString();return i.document.write(o),i.document.close(),i.focus(),i.document.execCommand("SaveAs",!0,d.UrlUtils.extractFileCoreName(r)),n}},d.BrowserFeature.fileapi&&(r.doShowFilePickerDialog=d.HtmlNativeServiceImpl.doShowFilePickerDialog),d.Browser.IE||t&&window.navigator.msSaveOrOpenBlob?r.doSaveFileData=d.HtmlNativeServiceImpl.doSaveFileDataIe:d.BrowserFeature.downloadHref&&(r.doSaveFileData=d.HtmlNativeServiceImpl.doSaveFileData)}(),d.PredefinedResLoader=Class.create(ObjectEx,{CLASS_NAME:"Kekule.PredefinedResLoader",initialize:function(e,t,r){this.tryApplySuper("initialize"),t?(this.setPropStoreFieldValue("resUri",t),this.setDoc(e),r&&this.setResType(r)):d.Error(d.$L("ErrorMsg.EMPTY_RESURI"))},initProperties:function(){this.defineProp("doc",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("resUri",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("resType",{dataType:DataType.STRING,serializable:!1})},getLinkedResUrl:function(e){var t=e.tagName.toLowerCase();return"link"===t?e.getAttribute("href"):"script"===t?e.getAttribute("src"):null},getElemResType:function(e){return e.getAttribute("type")},load:function(e){var t,r,n=this.getResUri(),i=d.PredefinedResReferer.ID_MARK;if(n.startsWith(i)){var o=n.substr(i.length).trim();if(t=this.getDoc().getElementById(o)){r=this.getLinkedResUrl(t);var a=this.getElemResType(t);a&&this.setResType(a)}}else r=n;var s={resType:this.getResType(),resUri:n};if(r)d.X.Ajax.sendRequest(r,(function(t,n,i){if(i){if(!(s=Object.extend(s,{data:t,text:n.responseText,success:!0})).resType&&(s.resType=d.X.Ajax.getResponseMimeType(n),s.resType===d.IO.MimeType.OCTSTREAM)){var o=d.UrlUtils.extractFileExt(r);if(o){var a=d.IO.DataFormatsManager.findFormat(null,o);a&&(s.resType=a.mimeType)}}e(s,i)}else e(s,!1)}),null,null,this.getResType()||null);else if(t){var l=t.innerHTML,u=2,c=l.indexOf("\r\n");c<0&&(c=l.indexOf("\n"),u=1),0===c&&(l=l.substring(u)),s=Object.extend(s,{data:l,text:l,resType:s.resType||"text/plain",success:!0}),e(s,!0)}else e(s,!1)}}),d.PredefinedResReferer={REFER_PATTERN:/^\s*url\((\S+)\)\s*$/,ID_MARK:"#",isResValue:function(e){return d.PredefinedResReferer.isResReferrer(e)},isResReferrer:function(e){return d.PredefinedResReferer.REFER_PATTERN.test(e)},extractReferedValue:function(e){var t=d.PredefinedResReferer.REFER_PATTERN.exec(e);if(t){var r=t[1];if(r)return d.StrUtils.unquote(r)}return null},loadResource:function(e,t,r,n){n||(n=document);var i,o=d.PredefinedResReferer.extractReferedValue(e);(i=new d.PredefinedResLoader(n,o))&&(r&&i.setResType(r),i.load(t))}},d._registerAfterLoadSysProc((function(){d.IO&&(d.IO.loadResourceData=function(e,t,r,n){d.PredefinedResReferer.loadResource(e,(function(e,r){var n;r&&(n=d.IO.loadTypedData(e.data,e.resType,e.resUri)),t&&t(n,r)}),r,n)})})),d.StyleUtils={removeStyleProperty:function(e,t){e.removeProperty?e.removeProperty(t):e.removeAttribute?e.removeAttribute(t):e[t]=null},analysisUnitsValue:function(e){var t,r={};if(r.total=e,r.value=parseFloat(e),e&&e.length&&void 0!==r.value&&!isNaN(r.value)){t="";for(var n=e.length-1;n>=0;--n){var i=e.charAt(n);i>="0"&&i<="9"||"."===i||"-"===i||(t=i+t)}}return r.units=t||"",r},multiplyUnitsValue:function(e,t){var r=d.StyleUtils.analysisUnitsValue(e);return r.value*=t,""+r.value+r.units},colorStrToValue:function(e){var t=d.StyleUtils.analysisCssColor(e,!0);return(Math.round(t.r)<<16)+(Math.round(t.g)<<8)+Math.round(t.b)},analysisCssColor:function(e,t){var r=d.StyleUtils,n=(e||"").toLowerCase();if(0===n.indexOf("#")){var i=n.substr(1);return r._analyisCssColorHex(i)}if(0===n.indexOf("rgb")){var o=n.indexOf("("),a=n.indexOf(")");return o<0||a<0?null:r._analysisCssColorRgbOrHsl(n.substring(o+1,a),!1)}if(0===n.indexOf("hsl")){if(o=n.indexOf("("),a=n.indexOf(")"),o<0||a<0)return null;var s=r._analysisCssColorRgbOrHsl(n.substring(o+1,a),!0);return t&&(s=Object.extend(s,r._convertHslToRgb(s))),s}return null},_analyisCssColorHex:function(e){for(var t=e.length,r=3===t,n=r?1:2,i=Math.min(4,Math.floor(t/n)),o=[],a=0;a<i;++a){var s=a*n,l=e.substr(s,n);r&&(l+=l),o.push(parseInt(l,16))}var u={r:o[0]||0,g:o[1]||0,b:o[2]||0};return d.ObjUtils.notUnset(o[3])?u.a=o[3]/255:u.a=1,u},_analysisCssColorRgbOrHsl:function(e,t){var r,n=d.StyleUtils._convertCssNumOrPercentageToNum,i=e.split(",");return r=t?{h:n(i[0],360),s:n(i[1]),l:n(i[2])}:{r:n(i[0],255),g:n(i[1],255),b:n(i[2],255)},d.ObjUtils.notUnset(i[3])?r.a=n(i[3]):r.a=1,r},_convertHslToRgb:function(e,t){t||(t=255);var r,n,i,o=e.h,a=e.s,s=e.l;if(0===a)r=n=i=s;else{var l=s<.5?s*(1+a):s+a-s*a,d=2*s-l,u=o/360,c=[u+1/3,u,u-1/3],h=0;for(s=c.length;h<s;++h)c[h]<0?c[h]=c[h]+1:c[h]>1&&(c[h]=c[h]-1),6*c[h]<1?c[h]=d+6*(l-d)*c[h]:2*c[h]<1?c[h]=l:3*c[h]<2?c[h]=d+6*(l-d)*(2/3-c[h]):c[h]=d;r=c[0],n=c[1],i=c[2]}return{r:r*t,g:n*t,b:i*t}},_convertCssNumOrPercentageToNum:function(e,t){var r=parseFloat(e)||0;return e.endsWith("%")&&(r=r/100*(t||1)),r},getComputedStyle:function(e,t){var r,n=e.ownerDocument;if(!n)return null;var i=n.defaultView;return i&&i.getComputedStyle?r=i.getComputedStyle(e,null):e.currentStyle&&(r=e.currentStyle),r?t?t.indexOf("-")>=0&&r.getPropertyValue?r.getPropertyValue(t):r[t]:r:null},isShown:function(e){var t=d.StyleUtils;return t.isDisplayed(e)&&t.isVisible(e)},isDisplayed:function(e){return"none"!==(d.StyleUtils.getComputedStyle(e,"display")||"").toLowerCase()},getDisplayed:function(e){return d.StyleUtils.getComputedStyle(e,"display")},setDisplay:function(e,t){e&&(e.style.display="string"==typeof t?t:t?"":"none")},isVisible:function(e){return"hidden"!==(d.StyleUtils.getComputedStyle(e,"visibility")||"").toLowerCase()},getVisibility:function(e){return d.StyleUtils.getComputedStyle(e,"visibility")},setVisibility:function(e,t){e&&(e.style.visibility="string"==typeof t?t:t?"":"hidden")},isBlockElem:function(e){var t=d.StyleUtils.getComputedStyle(e,"display");return["block","list-item","table","flex","grid"].indexOf(t)>=0},isAbsOrFixPositioned:function(e){var t=d.StyleUtils.getComputedStyle(e,"position")||"";return"absolute"===(t=t.toLowerCase())||"fixed"===t},_fillAbsOrFixedPositionStyleStack:function(e,t){if(d.DomUtils.isElement(e)){var r=d.StyleUtils.getComputedStyle(e,"position")||"";"absolute"!==(r=r.toLowerCase())&&"fixed"!==r||t.push(r.toLocaleLowerCase())}var n=e.parentNode;return n&&n.ownerDocument&&d.StyleUtils._fillAbsOrFixedPositionStyleStack(n,t),t},isAncestorPositionFixed:function(e){return!!e.parentNode&&d.StyleUtils.isSelfOrAncestorPositionFixed(e)},isSelfOrAncestorPositionFixed:function(e){var t=[];if(d.StyleUtils._fillAbsOrFixedPositionStyleStack(e,t),!t.length)return null;for(var r=t.length-1;r>=0;--r)if("fixed"===t[r])return!0;return!1},setCursor:function(e,t){if(DataType.isArrayValue(t)){for(var r=0,n=t.length;r<n;++r){var i=t[r];if(e.style.cursor=i,e.style.cursor===i)return i}return e.style.cursor}return e.style.cursor=t,e.style.cursor},_cssTransformValuesToMatrix:function(e){var t=d.MatrixUtils.create(3,3,0);return t[0][0]=e.a,t[1][0]=e.b,t[0][1]=e.c,t[1][1]=e.d,t[0][2]=e.tx,t[1][2]=e.ty,t},_matrixToCssTransformValues:function(e){return{a:e[0][0],b:e[1][0],c:e[0][1],d:e[1][1],tx:e[0][2],ty:e[1][2]}},hasTransform:function(e){var t=d.StyleUtils.getComputedStyle(e,"transform");return t&&"none"!==t},getTransformMatrixValues:function(e){var t=(d.StyleUtils.getComputedStyle(e,"transform")||"").match(/-?[\d\.]+/g);return t?{a:t[0],b:t[1],c:t[2],d:t[3],tx:t[4],ty:t[5]}:null},setTransformMatrixArrayValues:function(e,t){if(t){var r="matrix("+t.join(",")+")";e.style.transform=r}},getTransformMatrix:function(e){var t=d.StyleUtils.getTransformMatrixValues(e);return t?d.StyleUtils._cssTransformValuesToMatrix(t):null},getCascadeTranformMatrixes:function(e){for(var t=[],r=e;r;){if(1===r.nodeType){var n=d.StyleUtils.getTransformMatrix(r);n&&t.unshift(n)}r=r.parentNode}return t},getTotalTransformMatrix:function(e){for(var t=d.StyleUtils.getCascadeTranformMatrixes(e),r=null,n=t.length-1;n>=0;--n){var i=t[n];r=r?d.MatrixUtils.multiply(r,i):i}return r},calcInvertTransformMatrix:function(e){var t=d.StyleUtils._matrixToCssTransformValues(e),r=t.a*t.d-t.b*t.c;if(Math.abs(r)<1e-6)return!1;var n={a:t.d/r,b:-t.b/r,c:-t.c/r,d:t.a/r,tx:(t.c*t.ty-t.d*t.tx)/r,ty:(t.b*t.tx-t.a*t.ty)/r};return d.StyleUtils._cssTransformValuesToMatrix(n)}},d.HtmlElementUtils={getClassNames:function(e){return d.StrUtils.splitTokens(e.getAttribute("class")||"")},hasClass:function(e,t){return d.HtmlElementUtils.getClassNames(e).indexOf(t)>=0},addClass:function(e,t){for(var r=d.HtmlElementUtils,n=d.ArrayUtils.isArray(t)?t:d.StrUtils.splitTokens(t),i=0,o=n.length;i<o;++i)r.hasClass(e,n[i])||(e.className+=" "+n[i]);return r},removeClass:function(e,t){for(var r=d.HtmlElementUtils,n=d.ArrayUtils.isArray(t)?t:d.StrUtils.splitTokens(t),i=r.getClassNames(e),o=i.length;o>=0;--o)n.indexOf(i[o])>=0&&i.splice(o,1);return e.className=i.join(" "),r},toggleClass:function(e,t){for(var r=d.HtmlElementUtils,n=d.ArrayUtils.isArray(t)?t:d.StrUtils.splitTokens(t),i=0,o=n.length;i<o;++i)r.hasClass(e,n[i])?r.removeClass(e,n[i]):r.addClass(e,n[i]);return r},getInnerText:function(e){return e.innerText||e.textContent},resizeElem:function(e,t,r,n){e.style.width=t+(n||"px"),e.style.height=r+(n||"px")},getElemClientDimension:function(e){return{width:e.clientWidth,height:e.clientHeight}},getElemScrollDimension:function(e){return{width:e.scrollWidth,height:e.scrollHeight}},getElemComputedDimension:function(e){var t=d.StyleUtils,r={width:t.getComputedStyle(e,"width"),height:t.getComputedStyle(e,"height")},n=t.analysisUnitsValue(r.width),i=t.analysisUnitsValue(r.height),o={};return"px"===n.units&&(o.width=n.value),"px"===i.units&&(o.height=n.value),o},getElemOffsetDimension:function(e){return{width:e.offsetWidth,height:e.offsetHeight}},getViewportDimension:function(e){var t;if(e&&(t=e.ownerDocument?d.DocumentUtils.getDefaultView(e.ownerDocument):e.defaultView?e.defaultView:e.parentWindow?e.parentWindow:e),null!=(t=t||window).innerWidth)return{width:t.innerWidth,height:t.innerHeight};var r=t.document;return"CSS1Compat"==r.compatMode?{width:r.documentElement.clientWidth,height:r.documentElement.clientHeight}:{width:r.body.clientWidth,height:r.body.clientHeight}},getViewportVisibleBox:function(e){var t;e&&(t=e.ownerDocument?d.DocumentUtils.getDefaultView(e.ownerDocument):e.defaultView?e.defaultView:e.parentWindow?e.parentWindow:e);var r=(t=t||window).document,n=d.HtmlElementUtils.getViewportDimension(t),i=d.DocumentUtils.getScrollPosition(r),o={x1:i.left,y1:i.top,x2:n.width,y2:n.height};return o.left=o.x1,o.top=o.y1,o.right=o.x2,o.bottom=o.y2,o},getElemBoundingClientRect:function(e,t){var r=Object.extend({},e.getBoundingClientRect());if(d.ObjUtils.isUnset(r.width)&&(r.width=r.right-r.left),d.ObjUtils.isUnset(r.height)&&(r.height=r.bottom-r.top),t){var n=e.ownerDocument,i=n.documentElement.scrollTop||n.body.scrollTop||0,o=n.documentElement.scrollLeft||n.body.scrollLeft||0;r.left+=o,r.right+=o,r.top+=i,r.bottom+=i}var a=r;return a.x=a.left,a.y=a.top,a},getElemPagePos:function(e,t){for(var r=0,n=0,i=e;i;)r+=i.offsetLeft-i.scrollLeft+i.clientLeft,n+=i.offsetTop-i.scrollTop+i.clientTop,i=i.offsetParent;if(t){var o=e.ownerDocument,a=o.documentElement.scrollTop||o.body.scrollTop||0;r-=o.documentElement.scrollLeft||o.body.scrollLeft||0,n-=a}return{x:r,y:n}},getElemPageRect:function(e,t){var r=d.HtmlElementUtils.getElemPagePos(e,t),n=d.HtmlElementUtils.getElemClientDimension(e);return{x:r.x,y:r.y,left:r.x,top:r.y,right:r.x+n.width,bottom:r.y+n.height,width:n.width,height:n.height}},getElemViewportPos:function(e){var t=d.HtmlElementUtils.getElemPagePos(e,!0);return{x:t.left,y:t.top}},makePositioned:function(e){var t=d.StyleUtils.getComputedStyle(e,"position");t&&"static"!==t.toLowerCase()||(e.style.position="relative")},isFormCtrlElement:function(e){var t=e&&e.tagName.toLowerCase();return!!t&&["input","button","textarea","select"].indexOf(t)>=0},requestFullScreen:function(e){var t=e.requestFullScreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullScreen;return t?t.apply(e):null},exitFullScreen:function(e){var t=e.exitFullScreen||e.mozExitFullScreen||e.webkitExitFullScreen||e.msExitFullScreen;return t?t.apply(e):null}},d.DocumentUtils={getDefaultView:function(e){return e.defaultView||e.parentWindow},getScrollPosition:function(e){var t=d.DocumentUtils.getDefaultView(e),r={left:(void 0!==t.pageXOffset?t.pageXOffset:(e.documentElement||e.body.parentNode||e.body).scrollLeft)||0,top:(void 0!==t.pageYOffset?t.pageYOffset:(e.documentElement||e.body.parentNode||e.body).scrollTop)||0};return r.x=r.left,r.y=r.top,r},getClientDimension:function(e){return"BackCompat"==e.compatMode?{width:e.body.clientWidth,height:e.body.clientHeight}:{width:e.documentElement.clientWidth,height:e.documentElement.clientHeight}},getClientVisibleBox:function(e){var t=d.DocumentUtils.getScrollPosition(e),r=d.DocumentUtils.getInnerClientDimension(e),n={};return n.left=n.x1=t.left,n.top=n.y1=t.top,n.right=n.x2=r.width+t.left,n.bottom=n.y2=r.height+t.top,n.width=r.width,n.height=r.height,n},getWindowInnerDimension:function(e){var t=d.DocumentUtils.getDefaultView(e);return{width:Math.min(t.innerWidth,t.outerWidth),height:Math.min(t.innerHeight,t.outerHeight)}},getInnerClientDimension:function(e){var t=d.DocumentUtils.getClientDimension(e),r=d.DocumentUtils.getWindowInnerDimension(e);return{width:r.width?Math.min(r.width,t.width):t.width,height:r.height?Math.min(r.height,t.height):t.height}},getClientScaleLevel:function(e){return"BackCompat"==e.compatMode?e.body.clientWidth/window.innerWidth:e.documentElement.clientWidth/window.innerWidth},getPixelZoomLevel:function(e){return d.DocumentUtils.getClientScaleLevel(e)*(d.DocumentUtils.getDefaultView(e).devicePixelRatio||1)},getDevicePPI:function(e){var t=d.DocumentUtils.getDefaultView(e);if(t.matchMedia){for(var r=0,n=0,i=200;!n||n-r>1;)t.matchMedia("(min-resolution: "+i+"dpi)").matches?n?(r=i,i=Math.round((r+n)/2)):(r=i,i*=2):(n=i,i=Math.round((r+n)/2));return i}return 96}},d.TextLinesBuffer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.TextLinesBuffer",LINEBREAK:"\n",initialize:function(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("lines",[]),e&&("string"==typeof e?this.setText(e):this.setLines(e)),this.setCurrLineNo(0)},initProperties:function(){this.defineProp("lines",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getLines().join(this.LINEBREAK)},setter:function(e){this.setPropStoreFieldValue("lines",[]),this.reset(),this.appendText(e)}}),this.defineProp("currLineNo",{dataType:DataType.INT,serializable:!1})},getUnreadLines:function(){var e=[].concat(this.getLines());return e.splice(0,this.getCurrLineNo()),e},getUnreadText:function(){return this.getUnreadLines().join(this.LINEBREAK)},appendText:function(e){var t=e.split(this.LINEBREAK);this.appendLines(t)},appendLines:function(e){this.setPropStoreFieldValue("lines",this.getLines().concat(e)),this.notifyPropSet("lines",this.getPropStoreFieldValue("lines"))},clear:function(){this.setLines([]),this.setCurrLineNo(0)},incCurrLineNo:function(e){null==e&&(e=1);var t=this.getCurrLineNo();t+=e,this.setCurrLineNo(t)},getLineAt:function(e){var t=this.getLines()[e];return t&&t.length&&"\r"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t},getCurrLine:function(){return this.getLineAt(this.getCurrLineNo())},readLine:function(){var e=this.getLineAt(this.getCurrLineNo());return this.incCurrLineNo(),e},writeLine:function(e){this.getLines().splice(this.getCurrLineNo(),0,e),this.incCurrLineNo()},writeLines:function(e){for(var t=0,r=e.length;t<r;++t)this.writeLine(e[t])},writeText:function(e){var t=e.split(this.LINEBREAK);this.writeLines(t)},eof:function(){return this.getCurrLineNo()>=this.getLines().length},reset:function(){this.setCurrLineNo(0)}}),function(){d.globalOptions.add("IO",{}),d.IO={},d.IO.ChemDataType={TEXT:"text",DOM:"dom",JSON:"json",BINARY:"bin",OTHER:"other",UNKNOWN:"unknown",isBinaryType:function(e){var t=d.IO.ChemDataType;return!e||e===t.BINARY||e===t.OTHER||e===t.UNKNOWN}},d.IO.DataFormat={},d.IO.MimeType={TEXT:"text/plain",HTML:"text/html",XML:"text/xml",JSON:"application/json",JAVASCRIPT:"application/javascript",GIF:"image/gif",JPEG:"image/jpeg",PNG:"image/png",XPNG:"image/x-png",OCTSTREAM:"application/octet-stream"},d.IO.DataFormatsManager={_formats:{},register:function(t,r,n,i,o,a,s){var l=null;l||(l=e._formats[t]),l||(l={id:t},e._formats[t]=l),l.mimeType=r;var u=DataType.isArrayValue(n)?n:[n];return u=u.map((function(e){return e?e.toLowerCase():e})),l.fileExts?d.ArrayUtils.pushUnique(l.fileExts,u):l.fileExts=u,i&&i!==d.IO.ChemDataType.UNKNOWN&&(l.dataType=i),l.title=o,l.description=a,s&&(l=Object.extend(l,s)),l},unregister:function(t){e._formats[t]&&delete e._formats[t]},getAllIds:function(){return d.ObjUtils.getOwnedFieldNames(e._formats)},getFormatInfo:function(t){return e._formats[t]||null},getMimeType:function(t){var r=e.getFormatInfo(t);return r?r.mimeType:null},getFileExts:function(t){var r=e.getFormatInfo(t);return r?r.fileExts:null},findFormat:function(t,r){if(!t&&!r)return null;for(var n=e.getAllIds(),i=!1,o=0,a=n.length;o<a;++o){var s=e.getFormatInfo(n[o]);if((i=t&&t===s.mimeType)||(i=r&&s.fileExts.indexOf(r.toLowerCase())>=0),i)return s}return null},findFormatId:function(e,t){var r=d.IO.DataFormatsManager.findFormat(e,t);return r?r.id:null}};var e=d.IO.DataFormatsManager;d.IO.dataFormatsManager=d.IO.DataFormatsManager,d.IO.ChemDataReader=Class.create(ObjectEx,{initialize:function(e){this.tryApplySuper("initialize")},CLASS_NAME:"Kekule.IO.ChemDataReader",readData:function(e,t,r,n){if(!t){var i=d.IO.DataFormatsManager.getFormatInfo(r);(t=i?i.dataType:null)||(t="string"==typeof e?d.IO.ChemDataType.TEXT:e.getElementsByTagName?d.IO.ChemDataType.DOM:d.IO.ChemDataType.BINARY)}var o=this.doReadData(e,t,r,n||{});if(o instanceof d.ChemObject&&o.getSrcInfo){var a=o.getSrcInfo();a.data=e,a.dataType=t;var s=d.IO.DataFormatsManager.getFormatInfo(r);s&&(a.format=r,a.mimeType=s.mimeType,a.possibleFileExts=s.fileExts)}return o},doReadData:function(e,t,r,n){}}),d.IO.ChemDataWriter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.ChemDataWriter",initialize:function(e){this.tryApplySuper("initialize")},writeData:function(e,t,r,n){if(!t){var i=d.IO.DataFormatsManager.getFormatInfo(r);t=i?i.dataType:null}return this.doWriteData(e,t,r,n||{})},doWriteData:function(e,t,r,n){}}),d.IO.ChemDataReaderManager={_readers:[],register:function(e,t,r,n){if(e&&t&&r&&(!DataType.isArrayValue(r)||r.length)){if(d.IO.ChemDataReaderManager.getReaderInfoById(e))return d.raise(d.$L("ErrorMsg.READER_ID_ALREADY_EXISTS")),null;var i={id:e,readerClass:t,formatId:DataType.isArrayValue(r)?r:[r]};return i=Object.extend(i,n),d.IO.ChemDataReaderManager._readers.push(i),i}},unregister:function(e){for(var t=-1,r=d.IO.ChemDataReaderManager._readers,n=0,i=r.length;n<i;++n)if(r[n].id===e){t=n;break}if(t>=0){var o=r[t];return r.splice(t,1),o}return null},getAllReadableFormatIds:function(){for(var e=[],t=d.IO.ChemDataReaderManager._readers,r=0,n=t.length;r<n;++r){var i=t[r].formatId;d.ArrayUtils.pushUnique(e,i)}return e},getAllReadableFormats:function(){for(var t=[],r=d.IO.ChemDataReaderManager.getAllReadableFormatIds(),n=0,i=r.length;n<i;++n){var o=e.getFormatInfo(r[n]);o&&t.push(o)}return t},getAvailableReaderInfos:function(e){for(var t=[],r=d.IO.ChemDataReaderManager._readers,n=r.length-1;n>=0;--n)d.ObjUtils.match(r[n],e)&&t.push(r[n]);return t},getReaderInfo:function(e){for(var t=d.IO.ChemDataReaderManager._readers,r=t.length-1;r>=0;--r)if(d.ObjUtils.match(t[r],e))return t[r];return null},getReaderInfoById:function(e){return d.IO.ChemDataReaderManager.getReaderInfo({id:e})},getReaderInfoByFormat:function(e,t){for(var r=d.IO.ChemDataReaderManager._readers,n=r.length-1;n>=0;--n)if((!t||d.ObjUtils.match(r[n],t))&&r[n].formatId.indexOf(e)>=0)return r[n];return null},getReaderInfoByFileExt:function(e,t){var r=d.IO.DataFormatsManager.findFormatId(null,e);return r?d.IO.ChemDataReaderManager.getReaderInfoByFormat(r,t):null},createReaderOfInfo:function(e){return new e.readerClass(e.createOptions)},getReaderOfInfo:function(e){return e.instance||(e.instance=d.IO.ChemDataReaderManager.createReaderOfInfo(e)),e.instance},createReader:function(e){var t=d.IO.ChemDataReaderManager.getReaderInfo(e);if(t)return d.IO.ChemDataReaderManager.createReaderOfInfo(t)},getReader:function(e){var t=d.IO.ChemDataReaderManager.getReaderInfo(e);if(t)return d.IO.ChemDataReaderManager.getReaderOfInfo(t)},createReaderById:function(e){return d.IO.ChemDataReaderManager.createReader({id:e})},getReaderById:function(e){return d.IO.ChemDataReaderManager.getReader({id:e})},createReaderByFormat:function(e,t){var r=d.IO.ChemDataReaderManager.getReaderInfoByFormat(e,t);return r?d.IO.ChemDataReaderManager.createReaderOfInfo(r):null},getReaderByFormat:function(e,t){var r=d.IO.ChemDataReaderManager.getReaderInfoByFormat(e,t);return r?d.IO.ChemDataReaderManager.getReaderOfInfo(r):null},createReaderByFileExt:function(e,t){var r=d.IO.ChemDataReaderManager.getReaderInfoByFileExt(e,t);return r?d.IO.ChemDataReaderManager.createReaderOfInfo(r):null},getReaderByFileExt:function(e,t){var r=d.IO.ChemDataReaderManager.getReaderInfoByFileExt(e,t);return r?d.IO.ChemDataReaderManager.getReaderOfInfo(r):null},createReaderByMimeType:function(e){var t=d.IO.DataFormatsManager.findFormatId(e,null);return t?d.IO.ChemDataReaderManager.createReaderByFormat(t):null},getReaderByMimeType:function(e){var t=d.IO.DataFormatsManager.findFormatId(e,null);return t?d.IO.ChemDataReaderManager.getReaderByFormat(t):null}},d.IO.ChemDataWriterManager={_writers:[],register:function(e,t,r,n,i){if(e&&t&&n&&(!DataType.isArrayValue(n)||n.length)){if(d.IO.ChemDataWriterManager.getWriterInfoById(e))return d.raise(d.$L("ErrorMsg.WRITER_ID_ALREADY_EXISTS")),null;var o={id:e,writerClass:t,srcClasses:r,formatId:DataType.isArrayValue(n)?n:[n]};return o=Object.extend(o,i),d.IO.ChemDataWriterManager._writers.push(o),o}},unregister:function(e){for(var t=-1,r=d.IO.ChemDataWriterManager._writers,n=0,i=r.length;n<i;++n)if(r[n].id===e){t=n;break}if(t>=0){var o=r[t];return r.splice(t,1),o}return null},getAllWritableFormatIds:function(){for(var e=[],t=d.IO.ChemDataWriterManager._writers,r=0,n=t.length;r<n;++r){var i=t[r].formatId;d.ArrayUtils.pushUnique(e,i)}return e},getAllWritableFormats:function(){for(var t=[],r=d.IO.ChemDataWriterManager.getAllWritableFormatIds(),n=0,i=r.length;n<i;++n){var o=e.getFormatInfo(r[n]);o&&t.push(o)}return t},getAvailableWriterInfos:function(e,t){for(var r=[],n=ClassEx.isClass(t)?t:t.getClass?t.getClass():t?null:void 0,i=d.IO.ChemDataWriterManager._writers,o=i.length-1;o>=0;--o)if(d.ObjUtils.match(i[o],e))if(void 0!==n){if(n)for(var a=0,s=i[o].srcClasses.length;a<s;++a)ClassEx.isOrIsDescendantOf(n,i[o].srcClasses[a])&&r.push(i[o])}else r.push(i[o]);return r},getWriterInfo:function(e,t){for(var r=d.IO.ChemDataWriterManager._writers,n=r.length-1;n>=0;--n)if(d.ObjUtils.match(r[n],e)){if(t){for(var i=0,o=r[n].srcClasses.length;i<o;++i)if(t instanceof r[n].srcClasses[i])return r[n];return null}return r[n]}return null},getWriterInfoById:function(e,t){return d.IO.ChemDataWriterManager.getWriterInfo({id:e},t)},getWriterInfoByFormat:function(e,t,r){for(var n=d.IO.ChemDataWriterManager._writers,i=n.length-1;i>=0;--i)if((!t||d.ObjUtils.match(n[i],t))&&n[i].formatId.indexOf(e)>=0){if(r){for(var o=0,a=n[i].srcClasses.length;o<a;++o)if(r instanceof n[i].srcClasses[o])return n[i];return null}return n[i]}return null},getWriterInfoByFileExt:function(e,t,r){var n=d.IO.DataFormatsManager.findFormatId(null,e);return n?d.IO.ChemDataWriterManager.getWriterInfoByFormat(n,t,r):null},createWriterOfInfo:function(e){return new e.writerClass(e.createOptions)},getWriterOfInfo:function(e){return e.instance||(e.instance=d.IO.ChemDataWriterManager.createWriterOfInfo(e)),e.instance},createWriter:function(e,t){var r=d.IO.ChemDataWriterManager.getWriterInfo(e,t);return r?d.IO.ChemDataWriterManager.createWriterOfInfo(r):null},getWriter:function(e,t){var r=d.IO.ChemDataWriterManager.getWriterInfo(e,t);return r?d.IO.ChemDataWriterManager.getWriterOfInfo(r):null},createWriterById:function(e,t){return d.IO.ChemDataWriterManager.createWriter({id:e},t)},getWriterById:function(e,t){return d.IO.ChemDataWriterManager.getWriter({id:e},t)},createWriterByFormat:function(e,t,r){var n=d.IO.ChemDataWriterManager.getWriterInfoByFormat(e,t,r);return n?d.IO.ChemDataWriterManager.createWriterOfInfo(n):null},getWriterByFormat:function(e,t,r){var n=d.IO.ChemDataWriterManager.getWriterInfoByFormat(e,t,r);return n?d.IO.ChemDataWriterManager.getWriterOfInfo(n):null},createWriterByFileExt:function(e,t,r){var n=d.IO.ChemDataWriterManager.getWriterInfoByFileExt(e,t,r);return n?d.IO.ChemDataWriterManager.createWriterOfInfo(n):null},getWriterByFileExt:function(e,t,r){var n=d.IO.ChemDataWriterManager.getWriterInfoByFileExt(e,t,r);return n?d.IO.ChemDataWriterManager.getWriterOfInfo(n):null},createWriterByMimeType:function(e,t){var r=d.IO.DataFormatsManager.findFormatId(e,null);return r?d.IO.ChemDataWriterManager.createWriterByFormat(r,null,t):null},getWriterByMimeType:function(e){var t=d.IO.DataFormatsManager.findFormatId(e,null);return t?d.IO.ChemDataWriterManager.getWriterByFormat(t,null):null}},d.IO.loadFormatData=function(e,t,r){var n=d.IO.ChemDataReaderManager.getReaderByFormat(t);if(n){var i=n.readData(e,null,t,r);if(!1===i){var o=d.$L("ErrorMsg.FAIL_TO_READ_FORMAT")+t;d.raise(o)}return i}return o=d.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FORMAT")+t,d.raise(o),null},d.IO.loadMimeData=function(e,t,r){return d.IO.loadTypedData(e,t,null,r)},d.IO.loadTypedData=function(e,t,r,n){var i;r&&(i=d.UrlUtils.extractFileExt(r));var o,a=d.IO.DataFormatsManager.findFormatId(t||null,i);if(a&&(o=d.IO.loadFormatData(e,a,n)),!1!==o){if(o instanceof d.ChemObject&&o.getSrcInfo){var s=o.getSrcInfo();t&&(s.mimeType=t),i&&(s.fileExt=i),r&&(s.url=r,s.fileName=r)}return o}var l=t?d.$L("ErrorMsg.NO_SUITABLE_READER_FOR_MIMETYPE")+t:d.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+i;return d.raise(l),null},d.IO.loadFileData=function(e,t,r,n){if(d.BrowserFeature.fileapi){var i,o=e.name,a=d.UrlUtils.extractFileExt(o);if(!(i=r?d.IO.DataFormatsManager.getFormatInfo(r):d.IO.DataFormatsManager.findFormat(null,a))){var s=d.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+a;return void d.raise(s)}var l=d.IO.ChemDataType.isBinaryType(i.dataType),u=new FileReader;u.onload=function(e){var r=u.result,a=d.IO.loadFormatData(r,i.id,n);a&&a.getSrcInfo&&(a.getSrcInfo().fileName=o),t(a,!1!==a,r)},l?u.readAsArrayBuffer(e):u.readAsText(e)}else d.error(d.$L("ErrorMsg.FILE_API_NOT_SUPPORTED"))},d.IO.loadUrlData=function(e,t,r,n){if(!d.Ajax)return d.raise(d.$L("ErrorMsg.AJAX_FILELOADER_NOT_FOUND")),null;d.Ajax.sendRequest(e,(function(i,o,a){if(i&&a){var s;if(r&&(s=d.IO.DataFormatsManager.getFormatInfo(r)),!r){var l=d.Ajax.getResponseMimeType(o);s=d.IO.DataFormatsManager.findFormat(l)}if(!r){var u=d.UrlUtils.extractFileExt(e);s=d.IO.DataFormatsManager.findFormat(null,u)}if(!s){var c=d.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+u;return void d.raise(c)}var h=d.IO.loadFormatData(i,s.id,n);h.getSrcInfo().fileName=e,t(h,a=!1!==h)}else d.raise(d.$L("ErrorMsg.FAIL_TO_LOAD_FILE_URL")+e)}))},d.IO.saveFormatData=function(e,t,r){var n=d.IO.ChemDataWriterManager.getWriterByFormat(t,null,e);if(n)return n.writeData(e,null,t,r);var i=d.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT")+t;return d.raise(i),null},d.IO.saveMimeData=function(e,t,r){return d.IO.saveTypedData(e,t,null,r)},d.IO.saveTypedData=function(e,t,r,n){var i;r&&((i=d.UrlUtils.extractFileExt(r))||(i=r));var o,a=d.IO.DataFormatsManager.findFormatId(t||null,i);if(a&&(o=d.IO.saveFormatData(e,a,n)),d.ObjUtils.isUnset(o)){var s=t?d.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_MIMETYPE")+t:d.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FILEEXT")+i;return d.raise(s),null}return o}}(),d.globalOptions.add("IO.cml",{prettyPrint:!0}),d.IO.CML={CML2CORE_NAMESPACE_URI:"http://www.xml-cml.org/schema/cml2/core",CML3_SCHEMA_NAMESPACE_URI:"http://www.xml-cml.org/schema",ARRAY_VALUE_DELIMITER:" ",TYPED_ELEM_NAMES:["string","integer","float"],TYPED_ARRAY_ELEM_NAMES:["stringArray","integerArray","floatArray"],ATOMS_REF_ATTRIBS:["atomRef","atomRefs2","atomRefs3","atomRefs4","atomRefs","atomRefArray"],BONDS_REF_ATTRIBS:["bondRef","bondRefs","bondRefArray"]},d.IO.CML.LEGAL_CORE_NAMESPACE_URIS=[d.IO.CML.CML2CORE_NAMESPACE_URI,d.IO.CML.CML3_SCHEMA_NAMESPACE_URI],d.IO.CmlUtils={cmlBondOrderToKekule:function(e){var t=parseInt(e);if(t!=t)switch(e.toUpperCase()){case"A":t=d.BondOrder.EXPLICIT_AROMATIC;break;case"D":t=d.BondOrder.DOUBLE;break;case"T":t=d.BondOrder.TRIPLE;break;default:t=d.BondOrder.SINGLE}return t},kekuleBondOrderToCml:function(e){switch(e){case d.BondOrder.EXPLICIT_AROMATIC:return"A";case d.BondOrder.QUAD:return"4";case d.BondOrder.DOUBLE:return"D";case d.BondOrder.TRIPLE:return"T";default:return"S"}},cmlBondStereoToKekule:function(e){var t;switch(e.toUpperCase()){case"E":t=d.BondStereo.E;break;case"Z":t=d.BondStereo.Z;break;case"C":t=d.BondStereo.CIS;break;case"T":t=d.BondStereo.TRANS;break;case"W":t=d.BondStereo.UP;break;case"H":t=d.BondStereo.DOWN;break;default:t=d.BondStereo.NONE}return t},kekuleBondStereoToCml:function(e){switch(e){case d.BondStereo.UP:return{value:"W"};case d.BondStereo.UP_INVERTED:return{value:"W",invert:!0};case d.BondStereo.DOWN:return{value:"H"};case d.BondStereo.DOWN_INVERTED:return{value:"H",invert:!0};case d.BondStereo.E:return{value:"E"};case d.BondStereo.Z:return{value:"Z"};case d.BondStereo.CIS:return{value:"C"};case d.BondStereo.TRANS:return{value:"T"};default:return{value:null}}},reagentRoleToKekule:function(e){var t=d.ReactionRole;switch(e){case"reagent":return t.REAGENT;case"catalyst":case"solvent":return t.CATALYST;default:return e}},kekuleReagentRoleToCml:function(e){var t=d.ReactionRole;switch(e){case t.REAGENT:return"reagent";case t.CATALYST:return"catalyst";case t.SOLVENT:return"solvent";default:return e}},isDummyElementType:function(e){return"Du"==e||"Dummy"==e},isRGroupElementType:function(e){return"R"==e},isAtomListElementType:function(e){return"L"==e},getNodeElementType:function(e){if(e instanceof d.Atom)return e.getSymbol();if(!(e instanceof d.Pseudoatom))return e instanceof d.VariableAtom||e instanceof d.StructureFragment?"R":e.getSymbol?e.getSymbol():"*";switch(e.getAtomType()){case d.PseudoatomType.DUMMY:return"Du";case d.PseudoatomType.ANY:return"A";case d.PseudoatomType.HETERO:return"Q";case d.PseudoatomType.CUSTOM:default:return e.getSymbol()}},createNodeByCmdElementType:function(e,t,r){return d.IO.CmlUtils.isDummyElementType(t)?new d.Pseudoatom(e,d.PseudoatomType.DUMMY):d.IO.CmlUtils.isRGroupElementType(t)?new d.RGroup(e):d.IO.CmlUtils.isAtomListElementType(t)?new d.VariableAtom(e):d.Element.isElementSymbolAvailable(t)||t==d.Element.UNSET_ELEMENT?new d.Atom(e,t,Math.round(r)):new d.Pseudoatom(e,d.PseudoatomType.CUSTOM,t)}},d.IO.CmlDomUtils={splitCmlArrayValue:function(e){return"object"==typeof e&&e.length?e:d.StrUtils.normalizeSpace(d.StrUtils.trim(e)).split(d.IO.CML.ARRAY_VALUE_DELIMITER)},mergeToCmlArrayValue:function(e){return e.join(" ")},analysisCmlFormulaConciseValue:function(e){for(var t,r=d.IO.CmlDomUtils.splitCmlArrayValue(e),n=0,i=r.length,o=[],a=null;n<i;){var s=r[n],l=parseFloat(s);l!=l?(a&&o.push(a),a={elementType:s}):a?(a.count=l,o.push(a),a=null):n==i-1&&(t=l),++n}return{isotopes:o,formalCharge:t}},getCmlBuiltinElemInfo:function(e,t,r){var n=e.getAttribute("builtin");return!n&&t&&(e.getAttributeNS?n=e.getAttributeNS(t,"builtin"):r&&(n=r.getAttributeNS(t,"builtin",e))),n?{name:n,value:d.DomUtils.getElementText(e)}:null},readCmlTypedPropertyElem:function(e,t,r){var n;if(!(n=e.getAttribute("builtin"))&&t&&(e.getAttributeNS?n=e.getAttributeNS(t,"builtin"):r&&(n=r.getAttributeNS(t,"builtin",e))),n){var i=d.DomUtils.getElementText(e);switch(d.DomUtils.getLocalName(e)){case"float":i=parseFloat(i);break;case"integer":i=parseInt(i)}return{name:n,value:i}}return null},readCmlTypedPropertyArrayElem:function(e,t,r){var n;if(!(n=e.getAttribute("builtin"))&&t&&(e.getAttributeNS?n=e.getAttributeNS(t,"builtin"):r&&(n=r.getAttributeNS(t,"builtin",e))),n){var i=d.DomUtils.getElementText(e),o=d.IO.CmlDomUtils.splitCmlArrayValue(i);switch(d.DomUtils.getLocalName(e)){case"float":for(var a=0,s=o.length;a<s;++a)o[a]=parseFloat(o[a]);break;case"integer":for(a=0,s=o.length;a<s;++a)o[a]=parseInt(o[a])}return{name:n,values:o}}return null},hasDirectCmlTypedElemChildren:function(e,t){for(var r=0,n=d.IO.CML.TYPED_ELEM_NAMES.length;r<n;++r){var i=d.IO.CML.TYPED_ELEM_NAMES[r];if(d.DomUtils.getDirectChildElems(e,null,i,t).length>0)return!0}return!1},hasDirectCmlTypedArrayElemChildren:function(e,t){for(var r=0,n=d.IO.CML.TYPED_ARRAY_ELEM_NAMES.length;r<n;++r){var i=d.IO.CML.TYPED_ARRAY_ELEM_NAMES[r];if(d.DomUtils.getDirectChildElems(e,null,i,t).length>0)return!0}return!1},isCmlTypedElem:function(e,t){var r=d.IO.CML.TYPED_ELEM_NAMES.indexOf(d.DomUtils.getLocalName(e))>=0;return t&&(r=r&&e.namespaceURI==t),r},isCmlTypedArrayElem:function(e,t){var r=d.IO.CML.TYPED_ARRAY_ELEM_NAMES.indexOf(d.DomUtils.getLocalName(e))>=0;return t&&(r=r&&e.namespaceURI==t),r},isCmlBuiltInMarkedElem:function(e,t){var r=d.DomUtils.hasAttribute(e,"builtin");return t&&r&&(r=e.namespaceURI===t),r},FILTER_TYPED_ELEM:1,FILTER_TYPEDARRAY_ELEM:2,FILTER_ALL:3,getCmlTypedElem:function(e,t,r){var n=e.namespaceURI,i=d.DomUtils.getDirectChildElemsOfAttribValues(e,[{builtin:t}],null,null,n);if(i&&i.length>0)for(var o=i.length-1;o>=0;--o){if(r&d.IO.CmlDomUtils.FILTER_TYPED_ELEM&&d.IO.CmlDomUtils.isCmlTypedElem(i[o],n))return i[o];if(r&d.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM&&d.IO.CmlDomUtils.isCmlTypedArrayElem(i[o],n))return i[o]}return null},getCmlTypedElems:function(e,t,r){var n=[],i=e.namespaceURI,o=d.DomUtils.getDirectChildElemsOfAttribValues(e,[{builtin:t}],null,null,i);if(o&&o.length>0)for(var a=o.length-1;a>=0;--a)(r&d.IO.CmlDomUtils.FILTER_TYPED_ELEM&&d.IO.CmlDomUtils.isCmlTypedElem(o[a],i)||r&d.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM&&d.IO.CmlDomUtils.isCmlTypedArrayElem(o[a],i))&&n.push(o[a]);return n.length?n:null},getCmlTypedElemValue:function(e,t,r,n){r||(r=d.IO.CmlDomUtils.FILTER_ALL);var i=d.IO.CmlDomUtils.getCmlTypedElem(e,t,r);if(i)return d.DomUtils.getElementText(i)},getMultipleCmlTypedElemValues:function(e,t,r,n){r||(r=d.IO.CmlDomUtils.FILTER_ALL);var i=d.IO.CmlDomUtils.getCmlTypedElems(e,t,r);if(i){for(var o=[],a=0,s=i.length;a<s;++a)o.push(d.DomUtils.getElementText(i[a]));return o}return null},getCmlElemAttribute:function(e,t,r,n){r||(r=d.IO.CmlDomUtils.FILTER_ALL);var i=d.DomUtils.getSameNSAttributeValue(e,t,n);return i||(i=d.IO.CmlDomUtils.getCmlTypedElemValue(e,t,r,n)),i},getMultipleCmlElemAttribute:function(e,t,r,n){r||(r=d.IO.CmlDomUtils.FILTER_ALL);var i=d.DomUtils.getSameNSAttributeValue(e,t,n);return i||(i=d.IO.CmlDomUtils.getMultipleCmlTypedElemValues(e,t,r,n)),i},setCmlElemAttribute:function(e,t,r,n){return d.DomUtils.setSameNSAttributeValue(e,t,r,n)},fetchCmlElemAttributeValuesToJson:function(e,t,r,n){t||(t=d.IO.CmlDomUtils.FILTER_ALL);for(var i=e.namespaceURI,o=d.DomUtils.fetchAttributeValuesToJson(e,i,!0),a=d.DomUtils.getDirectChildElems(e,null,null,i),s=0,l=a.length;s<l;++s){var u=a[s];if(t&d.IO.CmlDomUtils.FILTER_TYPED_ELEM&&(d.IO.CmlDomUtils.isCmlTypedElem(u,i)||d.IO.CmlDomUtils.isCmlBuiltInMarkedElem(u,i)))(c=d.IO.CmlDomUtils.readCmlTypedPropertyElem(u,i,n))&&(o[c.name]&&r?o[c.name]+=d.IO.CML.ARRAY_VALUE_DELIMITER+c.value:o[c.name]=c.value);else if(t&d.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM&&d.IO.CmlDomUtils.isCmlTypedArrayElem(u,i)){var c;(c=d.IO.CmlDomUtils.getCmlBuiltinElemInfo(u,i,n))&&(o[c.name]&&r?o[c.name]+=d.IO.CML.ARRAY_VALUE_DELIMITER+c.value:o[c.name]=c.value)}}return o},isScalarElem:function(e,t){var r="scalar"==d.DomUtils.getLocalName(e);return t&&(r=r&&e.namespaceURI==t),r},getCmlId:function(e,t){return d.IO.CmlDomUtils.getCmlElemAttribute(e,"id",d.IO.CmlDomUtils.FILTER_TYPED_ELEM,t)},setCmlId:function(e,t,r){return d.IO.CmlDomUtils.setCmlElemAttribute(e,"id",t,r)},getCmlTitle:function(e,t){return d.IO.CmlDomUtils.getCmlElemAttribute(e,"title",d.IO.CmlDomUtils.FILTER_TYPED_ELEM,t)},setCmlTitle:function(e,t,r){return d.IO.CmlDomUtils.setCmlElemAttribute(e,"title",t,r)}},d.IO.CmlElementReaderFactory={_readers:{},register:function(e,t){if(d.ArrayUtils.isArray(e))for(var r=0,n=e.length;r<n;++r)d.IO.CmlElementReaderFactory.register(e[r],t);else d.IO.CmlElementReaderFactory._readers[e]=t},getReader:function(e){var t;t="string"!=typeof e?d.DomUtils.getLocalName(e):e;var r=d.IO.CmlElementReaderFactory._readers[t];return r?new r:null}},d.IO.CmlElementWriterFactory={_writers:{},register:function(e,t){if(d.ArrayUtils.isArray(e))for(var r=0,n=e.length;r<n;++r)d.IO.CmlElementWriterFactory.register(e[r],t);else d.IO.CmlElementWriterFactory._writers[e]=t},getWriter:function(e){var t;t="string"!=typeof e?DataType.getType(e):e;var r=d.IO.CmlElementWriterFactory._writers[t];if(!r&&e.getClassName)for(var n=e,i=d.ObjUtils.getOwnedFieldNames(d.IO.CmlElementWriterFactory._writers),o=i.length-1;o>=0;--o){var a=ClassEx.findClass(i[o]);if(a&&n instanceof a){r=d.IO.CmlElementWriterFactory._writers[i[o]];break}}return r?new r:null}},d.IO.CmlElementHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.CmlElementHandler",initProperties:function(){this.defineProp("domHelper",{dataType:"Kekule.DomHelper",serializable:!1,getter:function(){return this.getPropStoreFieldValue("domHelper")||this.setPropStoreFieldValue("domHelper",new d.DomHelper),this.getPropStoreFieldValue("domHelper")}}),this.defineProp("coreNamespaceURI",{dataType:DataType.STRING,serializable:!1})},matchCoreNamespace:function(e){var t;return t=e?"string"!=typeof e?e.namespaceURI:e:"",!this.getCoreNamespaceURI()&&!t||this.getCoreNamespaceURI()&&this.getCoreNamespaceURI()==t},copySettingsToChildHandler:function(e){e.setDomHelper(this.getDomHelper()),e.setCoreNamespaceURI(this.getCoreNamespaceURI())}}),d.IO.CmlElementReader=Class.create(d.IO.CmlElementHandler,{CLASS_NAME:"Kekule.IO.CmlElementReader",readElement:function(e,t){var r=this.doReadElement(e,t);if(r&&r.getId&&!r.getId()&&r.setId){var n=d.IO.CmlDomUtils.getCmlId(e,this.getDomHelper);n&&r.setId(n)}return r},doReadElement:function(e,t){},readChildElement:function(e,t){return this.doReadChildElement(e,t)},doReadChildElement:function(e,t){return this.doReadChildElementDef(e,t)},readChildElementDef:function(e,t){return this.doReadChildElementDef(e,t)},doReadChildElementDef:function(e,t){var r=d.IO.CmlElementReaderFactory.getReader(e);return r?(this.copySettingsToChildHandler(r),r.readElement(e,t)):null},iterateChildElements:function(e,t){for(var r=d.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI()),n=0,i=r.length;n<i;++n)this.readChildElement(r[n],t)}}),d.IO.CmlElementWriter=Class.create(d.IO.CmlElementHandler,{CLASS_NAME:"Kekule.IO.CmlElementWriter",writeObject:function(e,t,r){if(!t&&!r)return d.error(d.$L("ErrorMsg.CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT")),null;!t&&r?t=r.documentElement:r||(r=t.ownerDocument),this.getDomHelper().getDocument!=r&&this.getDomHelper().setDocument(r);var n=this.doCreateElem(e,t,r);n?t.appendChild(n):n=t;var i=this.doWriteObject(e,n)||n;return i&&e&&(this.writeObjId(e,i),this.writeObjAdditionalInfo(e,i)),i},writeObjId:function(e,t){e.getId&&e.getId()&&d.IO.CmlDomUtils.setCmlId(t,e.getId(),this.getDomHelper())},writeScalarAttribs:function(e,t){if(e.getScalarAttribs){var r=d.IO.CmlElementWriterFactory.getWriter("Kekule.Scalar");if(r){this.copySettingsToChildHandler(r);for(var n=0,i=e.getScalarAttribCount();n<i;++n)r.writeObject(e.getScalarAttribAt(n),t)}}},writeObjInfoValues:function(e,t){if(e.getInfo)for(var r,n=e.getInfoKeys(),i=0,o=n.length;i<o;++i){var a=n[i],s=e.getInfoValue(n[i]);if(a&&s&&!d.IO.CmlDomUtils.getCmlElemAttribute(t,a,this.getDomHelper())){r||(r=this.createChildElem("metaDataList",t));var l=this.createChildElem("metaData",r);d.IO.CmlDomUtils.setCmlElemAttribute(l,"name",a,this.getDomHelper()),d.IO.CmlDomUtils.setCmlElemAttribute(l,"content",DataType.StringUtils.serializeValue(s),this.getDomHelper())}}},writeObjAdditionalInfo:function(e,t){this.writeScalarAttribs(e,t),this.writeObjInfoValues(e,t)},doCreateElem:function(e,t){},createChildElem:function(e,t,r){var n=r||this.getCoreNamespaceURI(),i=this.getDomHelper().createElementNS(n,e);return t&&t.appendChild(i),i},doWriteObject:function(e,t){},reportTypeMismatchError:function(e){d.error(d.$L("ErrorMsg.CML_ELEM_WRITER_TYPE_INPROPER").format(this.getClassName(),DataType.getType(e)))}}),d.IO.CmlNameReader=Class.create(d.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlNameReader",initialize:function(){this.tryApplySuper("initialize")},doReadElement:function(e,t){var r=d.DomUtils.getElementText(e),n=d.IO.CmlDomUtils.getCmlElemAttribute(e,"convention");if(r){var i={};return i.name=r,n?i.convention=n:t.setName&&t.setName(r),i}return null}}),d.IO.CmlScalarReader=Class.create(d.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlScalarReader",doReadElement:function(e,t){var r=this.readScalar(e);return t&&t.appendScalarAttrib&&t.appendScalarAttrib(r),r},readScalar:function(e){var t,r=d.DomUtils.fetchAttributeValuesToJson(e,this.getCoreNamespaceURI(),!0);if((s=d.DomUtils.getElementText(e))&&(r.value=s),r.value&&r.dataType)switch(r.dataType){case"xsd:boolean":r.value=d.StrUtils.strToBool(r.value);break;case"xsd:float":case"xsd:double":case"xsd:duration":case"xsd:decimal":case"xsd:integer":case"xsd:nonPositiveInteger":case"xsd:negativeInteger":case"xsd:long":case"xsd:int":case"xsd:short":case"xsd:byte":case"xsd:nonNegativeInteger":case"xsd:unsignedLong":case"xsd:unsignedInt":case"xsd:unsignedShort":case"xsd:unsignedByte":case"xsd:positiveInteger":r.value=parseFloat(r.value),r.errorValue&&(r.errorValue=parseFloat(r.errorValue))}if(r){t=new d.Scalar;for(var n=d.ObjUtils.getOwnedFieldNames(r),i=0,o=n.length;i<o;++i){var a=n[i],s=r[a];switch(a){case"value":t.setValue(s);break;case"errorValue":t.setErrorValue(s);break;case"units":t.setUnit(s);break;case"title":t.setTitle(s);break;case"dictRef":t.setName(s);break;default:t.setInfoValue(a,s)}}}return t}}),d.IO.CmlScalarWriter=Class.create(d.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlScalarWriter",doCreateElem:function(e,t){return this.createChildElem("scalar",t)},doWriteObject:function(e,t){if(!(e instanceof d.Scalar))return this.reportTypeMismatchError(e),null;var r;if(d.ObjUtils.isUnset(e.getValue())||(d.DomUtils.setElementText(t,e.getValue()),r=DataType.getType(e.getValue())),e.getName()&&d.IO.CmlDomUtils.setCmlElemAttribute(t,"dictRef",e.getName(),this.getDomHelper()),e.getErrorValue()&&d.IO.CmlDomUtils.setCmlElemAttribute(t,"errorValue",e.getErrorValue(),this.getDomHelper()),e.getUnit()&&d.IO.CmlDomUtils.setCmlElemAttribute(t,"units",e.getUnit(),this.getDomHelper()),e.getTitle()&&d.IO.CmlDomUtils.setCmlElemAttribute(t,"title",e.getTitle(),this.getDomHelper()),r){var n=r==DataType.INT?"xsd:integer":r==DataType.FLOAT?"xsd:float":r==DataType.BOOL?"xsd:boolean":null;n&&d.IO.CmlDomUtils.setCmlElemAttribute(t,"datatype",n,this.getDomHelper())}}}),d.IO.CmlMetaDataReader=Class.create(d.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlMetaReader",doReadElement:function(e,t){var r=this.readMeta(e);return t&&t.setInfoValue&&r.key&&r.value&&t.setInfoValue(r.key,r.value),r},readMeta:function(e){var t=d.DomUtils.fetchAttributeValuesToJson(e,this.getCoreNamespaceURI(),!0);return{key:t.name,value:DataType.StringUtils.deserializeValue(t.content)}}}),d.IO.CmlMetaDataListReader=Class.create(d.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlMetaListReader",doReadElement:function(e,t){for(var r=d.DomUtils.getDirectChildElems(e,null,"metaData",this.getCoreNamespaceURI()),n=0,i=r.length;n<i;++n){var o=r[n],a=d.IO.CmlElementReaderFactory.getReader(o);a&&(this.copySettingsToChildHandler(a),a.readElement(o,t))}}}),d.IO.CmlChemStructureReader=Class.create(d.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlChemStructureReader",initialize:function(){this.tryApplySuper("initialize")},hasAtomChildren:function(e,t){return t.getElementsByTagNameNS(this.getCoreNamespaceURI(),"atom",e).length},getAtomChildren:function(e,t){return t.getElementsByTagNameNS(this.getCoreNamespaceURI(),"atom",e)},atomInfoToJSON:function(e,t){return d.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(e,d.IO.CmlDomUtils.FILTER_TYPED_ELEM,!0,t)},arrayedAtomInfosToJSON:function(e,t){for(var r=["id","atomID","elementType","isotope","hydrogenCount","formalCharge","count","xFract","yFract","zFract","x2","y2","x3","y3","z3"],n=["id","id","elementType","isotope","hydrogenCount","formalCharge","count","xFract","yFract","zFract","x2","y2","x3","y3","z3"],i=[],o=0,a=r.length;o<a;++o){var s,l=[];(s=d.IO.CmlDomUtils.getCmlElemAttribute(e,r[o],d.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,t))&&(l=d.IO.CmlDomUtils.splitCmlArrayValue(s));for(var u=0,c=l.length;u<c;++u)i[u]||(i[u]={}),l[u]&&(i[u][n[o]]=l[u])}return i}}),d.IO.CmlFormulaReader=Class.create(d.IO.CmlChemStructureReader,{CLASS_NAME:"Kekule.IO.CmlFormulaReader",doReadElement:function(e,t){return this.readFormula(e,this.getDomHelper())},readFormula:function(e,t){var r=new d.MolecularFormula,n=d.IO.CmlDomUtils.getCmlElemAttribute(e,"formalCharge",d.IO.CmlDomUtils.FILTER_TYPED_ELEM,t);n&&r.setCharge(parseFloat(n));var i=d.IO.CmlDomUtils.getCmlElemAttribute(e,"concise",d.IO.CmlDomUtils.FILTER_TYPED_ELEM,t);if(i)this.setConcise(r,i);else for(var o=d.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI()),a=0,s=o.length;a<s;++a)switch(d.DomUtils.getLocalName(o[a])){case"formula":this.readSubFormula(r,o[a],t);break;case"atomArray":this.readAtomArray(r,o[a],t);break;default:d.IO.CmlDomUtils.isCmlTypedElem(e)||d.IO.CmlDomUtils.isCmlTypedArrayElem(e)||this.readChildElementDef(e,r)}return r},readConsice:function(e){var t=null;return e&&(t=new d.MolecularFormula,this.setConcise(t,e)),t},setConcise:function(e,t){var r=d.IO.CmlDomUtils.analysisCmlFormulaConciseValue(t);return r.isotopes&&r.isotopes.length&&this.createSectionsFromAtomAttribs(e,r.isotopes),r.formalCharge&&e.setCharge(r.formalCharge),e},readAtomArray:function(e,t,r){var n=[],i=this.getAtomChildren(t,r);if(i.length>0)for(var o=0,a=i.length;o<a;++o){var s=i[o],l=this.atomInfoToJSON(s,r);n.push(l)}else n=this.arrayedAtomInfosToJSON(t,r);return this.createSectionsFromAtomAttribs(e,n),e},createSectionsFromAtomAttribs:function(e,t){for(var r=0,n=t.length;r<n;++r){var i=t[r].elementType;if(i){var o=d.IO.CmlUtils.createNodeByCmdElementType(null,i),a=t[r].formalCharge||0,s=t[r].count;e.appendSection(o,s,a)}}},readSubFormula:function(e,t,r){var n=this.readElement(t,r),i=d.IO.CmlDomUtils.getCmlElemAttribute(t,"count",d.IO.CmlDomUtils.FILTER_TYPED_ELEM,r);e.appendSection(n,parseFloat(i)||1,n.getCharge()||0)}}),d.IO.CmlFormulaWriter=Class.create(d.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlFormulaWriter",doCreateElem:function(e,t){return this.createChildElem("formula",t)},doWriteObject:function(e,t){if(!(e instanceof d.MolecularFormula))return this.reportTypeMismatchError(e),null;for(var r=[],n=[],i=[],o=0,a=e.getSectionCount();o<a;++o){var s=e.getSectionAt(o);s.obj instanceof d.MolecularFormula?(this.createAtomArrayElem(r,n,i,t),r=[],n=[],i=[],this.writeSubFormula(s.obj,s.count||1,t)):(r.push(d.IO.CmlUtils.getNodeElementType(s.obj)),n.push(s.count||1),i.push(e.getSectionCharge(s)||0),o==a-1&&this.createAtomArrayElem(r,n,i,t))}e.getCharge()&&d.IO.CmlDomUtils.setCmlElemAttribute(t,"formalCharge",e.getCharge(),this.getDomHelper())},writeSubFormula:function(e,t,r){var n=this.createChildElem("formula",r);return this.doWriteObject(e,n),t>1&&d.IO.CmlDomUtils.setCmlElemAttribute(n,"count",t,this.getDomHelper()),n},createAtomArrayElem:function(e,t,r,n){if(!(e.length<=0)){var i=this.createChildElem("atomArray",n),o=d.IO.CmlDomUtils.mergeToCmlArrayValue(e),a=d.IO.CmlDomUtils.mergeToCmlArrayValue(t);d.IO.CmlDomUtils.setCmlElemAttribute(i,"elementType",o,this.getDomHelper()),d.IO.CmlDomUtils.setCmlElemAttribute(i,"count",a,this.getDomHelper());for(var s=!1,l=0,u=r.length;l<u;++l)if(r[l]){s=!0;break}if(s){var c=d.IO.CmlDomUtils.mergeToCmlArrayValue(t);d.IO.CmlDomUtils.setCmlElemAttribute(i,"formalCharge",c,this.getDomHelper())}return i}}}),d.IO.CmlMoleculeReader=Class.create(d.IO.CmlChemStructureReader,{CLASS_NAME:"Kekule.IO.CmlMoleculeReader",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("structureBuilder",{dataType:"Kekule.ChemStructureBuilder",serializable:!1,getter:function(){return this.getPropStoreFieldValue("structureBuilder")||this.setPropStoreFieldValue("structureBuilder",new d.ChemStructureBuilder),this.getPropStoreFieldValue("structureBuilder")},setter:null})},doReadElement:function(e,t){return this.readMolecule(e,this.getDomHelper())},doReadChildElement:function(e,t){if("molecule"==d.DomUtils.getLocalName(e)&&this.matchCoreNamespace(e)){if(t.getSubMolecules){var r=this.readElement(e,t);if(r){var n=d.IO.CmlDomUtils.getCmlElemAttribute(e,"amount",d.IO.CmlDomUtils.FILTER_TYPED_ELEM)||d.IO.CmlDomUtils.getCmlElemAttribute(e,"count",d.IO.CmlDomUtils.FILTER_TYPED_ELEM),i=n?{amount:parseFloat(n)}:null;t.getSubMolecules().appendObj(r,i)}return r}return null}return this.tryApplySuper("doReadChildElement",[e,t])},hasSubMolecule:function(e){return d.DomUtils.getDirectChildElems(e,null,"molecule",this.getCoreNamespaceURI()).length>0},readMolecule:function(e,t){var r;return this.hasSubMolecule(e)?(r=new d.CompositeMolecule,this.iterateChildElements(e,r)):r=this.readMoleculeCore(e,t),this.readMoleculeAttribs(r,e,t),r},readMoleculeAttribs:function(e,t,r){for(var n=d.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(t,null,!0,r),i=d.ObjUtils.getOwnedFieldNames(n),o=0,a=i.length;o<a;++o){var s=i[o],l=n[s];switch(s){case"id":e.setId(l);break;case"title":e.setInfoValue("title",l);break;case"formalCharge":l&&e.setCharge(parseFloat(l));break;case"formula":this.readFormulaAttrib(e,l);break;case"amount":case"count":break;default:e.setInfoValue(s,l)}}},readMoleculeCore:function(e,t){var r=new d.Molecule;this.getStructureBuilder().setTarget(r);for(var n=e.firstChild;n;){if(n.nodeType!=Node.ELEMENT_NODE);else if(this.matchCoreNamespace(n))switch(d.DomUtils.getLocalName(n)){case"atomArray":this.readMoleculeAtomArray(r,n,this.getStructureBuilder(),t);break;case"bondArray":this.readMoleculeBondArray(r,n,this.getStructureBuilder(),t);break;case"formula":this.readFormula(r,n,t);break;case"atom":this.getStructureBuilder().setTarget(r);var i=this.readAtom(n,t);this.getStructureBuilder().appendNode(i);break;case"bond":this.getStructureBuilder().setTarget(r);var o=this.readBond(r,n,t);this.getStructureBuilder().appendConnector(o);break;case"molecule":break;default:d.IO.CmlDomUtils.isCmlTypedElem(n)||d.IO.CmlDomUtils.isCmlTypedArrayElem(n)||this.readChildElementDef(n,r)}n=n.nextSibling}return r.hasCtab()&&this.connectUpBondAndAtom(r),r},connectUpBondAndAtom:function(e){for(var t=e.getConnectors(),r=0,n=t.length;r<n;++r){var i=t[r],o=i[this._BOND_ATOM_REF_TEMP_FIELD];if(o&&o.length)for(var a=0,s=o.length;a<s;++a){var l=e.getNodeById(o[a]);l?i.appendConnectedObj(l):d.raise((d.hasLocalRes()?d.$L("ErrorMsg.ATOMID_NOT_EXISTS"):"Atom id not exists: ")+o[a])}delete i[this._BOND_ATOM_REF_TEMP_FIELD];var u=i[this._BOND_BOND_REF_TEMP_FIELD];if(u&&u.length)for(a=0,s=u.length;a<s;++a){var c=e.getConnectorById(u[a]);c?i.appendConnectedObj(c):d.raise((d.hasLocalRes()?d.$L("ErrorMsg.BONDID_NOT_EXISTS"):"Bond id not exists: ")+u[a])}delete i[this._BOND_BOND_REF_TEMP_FIELD]}},readMoleculeAtomArray:function(e,t,r,n){r.setTarget(e);var i=this.getAtomChildren(t,n);if(i.length>0)for(var o=0,a=i.length;o<a;++o){var s=i[o],l=this.readAtom(s,n);r.appendNode(l)}else{var d=this.readArrayedAtoms(t,n);for(o=0,a=d.length;o<a;++o)r.appendNode(d[o])}},readAtom:function(e,t){var r,n=!d.IO.CmlDomUtils.hasDirectCmlTypedElemChildren(e,this.getCoreNamespaceURI()),i=this.atomInfoToJSON(e,t);if(r=this.createStructureNodeOfAttribs(i),n)for(var o=d.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI()),a=0,s=o.length;a<s;++a)e=o[a],this.readChildElementDef(e,r);return r},readArrayedAtoms:function(e,t){for(var r=this.arrayedAtomInfosToJSON(e,t),n=[],i=0,o=r.length;i<o;++i){var a=this.createStructureNodeOfAttribs(r[i]);a&&n.push(a)}return n},createStructureNodeOfAttribs:function(e){var t;e.elementType||(e.elementType=d.Element.UNSET_ELEMENT);var r=null;void 0!==e.id&&(r=e.id),delete e.id;var n,i,o=e.isotope?Math.round(e.isotope):null;if(t=d.IO.CmlUtils.createNodeByCmdElementType(r,e.elementType,o),delete e.elementType,void 0!==e.hydrogenCount&&t.setExplicitHydrogenCount&&t.setExplicitHydrogenCount(parseInt(e.hydrogenCount,10)),delete e.hydrogenCount,e.formalCharge&&t.setCharge(parseInt(e.formalCharge)),delete e.formalCharge,e.title&&t.setInfoValue("title",e.title),delete e.title,e.role&&t.setInfoValue("role",e.role),delete e.role,void 0!==e.x2&&void 0!==e.y2)n={x:parseFloat(e.x2),y:parseFloat(e.y2)};else if(e.xy2){var a=d.IO.CmlDomUtils.splitCmlArrayValue(e.xy2);2==a.length&&(n={x:parseFloat(a[0]),y:parseFloat(a[1])})}if(delete e.x2,delete e.y2,delete e.xy2,void 0!==e.x3&&void 0!==e.y3&&void 0!==e.z3)i={x:parseFloat(e.x3),y:parseFloat(e.y3),z:parseFloat(e.z3)};else if(e.xyz3){var s=d.IO.CmlDomUtils.splitCmlArrayValue(e.xyz3);3==s.length&&(n={x:parseFloat(s[0]),y:parseFloat(s[1]),z:parseFloat(s[2])})}for(var l in delete e.x3,delete e.y3,delete e.z3,delete e.xyz3,n&&t.setCoord2D(n),i&&t.setCoord3D(i),e)e.hasOwnProperty(l)&&"string"==typeof e[l]&&t.setInfoValue(l,e[l]);return t},_BOND_ATOM_REF_TEMP_FIELD:"__cml_atomRefs",_BOND_BOND_REF_TEMP_FIELD:"__cml_bondRefs",readMoleculeBondArray:function(e,t,r,n){r.setTarget(e);var i=n.getElementsByTagNameNS(this.getCoreNamespaceURI(),"bond",t);if(i.length>0)for(var o=0,a=i.length;o<a;++o){var s=i[o],l=this.readBond(e,s,n);r.appendConnector(l)}else{var d=this.readArrayedBonds(e,t,n);for(o=0,a=d.length;o<a;++o)r.appendConnector(d[o])}},readBond:function(e,t,r){var n,i,o;if(o=!d.IO.CmlDomUtils.hasDirectCmlTypedElemChildren(t,this.getCoreNamespaceURI()),i=d.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(t,d.IO.CmlUtils.FILTER_TYPED_ELEM,!0,r),n=this.createStructureConnectorOfAttribs(e,i),o)for(var a=d.DomUtils.getDirectChildElems(t,null,null,this.getCoreNamespaceURI()),s=0,l=a.length;s<l;++s)if(t=a[s],"bondStereo"==d.DomUtils.getLocalName(t)){var u=d.DomUtils.getElementText(t);u||(u=d.IO.CmlDomUtils.getCmlElemAttribute(t,"conversionValue",d.IO.CmlDomUtils.FILTER_TYPED_ELEM,r));var c=d.IO.CmlUtils.cmlBondStereoToKekule(u);c!=d.BondStereo.NONE&&n.setStereo&&n.setStereo(c)}else this.readChildElementDef(t,n);return n},readArrayedBonds:function(e,t,r){var n=["id","bondID","atomRef1","atomRef2","order","bondStereo"],i=["id","id","atomRefs2","atomRefs2","order","bondStereo"],o=[],a=d.IO.CmlDomUtils.getMultipleCmlElemAttribute(t,"atomRefs",d.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,r);if(a&&a.length)for(var s=0,l=a.length;s<l;++s)for(var u=a[s],c=0,h=(p=d.IO.CmlDomUtils.splitCmlArrayValue(u)).length;c<h;++c)o[c]||(o[c]={}),null==o[c].atomRefs&&(o[c].atomRefs=[]),o[c].atomRefs.push(p[c]);for(s=0,l=n.length;s<l;++s){var p=[];for((u=d.IO.CmlDomUtils.getCmlElemAttribute(t,n[s],d.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,r))&&(p=d.IO.CmlDomUtils.splitCmlArrayValue(u)),c=0,h=p.length;c<h;++c)o[c]||(o[c]={}),p[c]&&("atomRef1"==n[s]||"atomRef2"==n[s]?(null==o[c].atomRefs2&&(o[c].atomRefs2=[]),"atomRef1"==n[s]?o[c].atomRefs2[0]=p[c]:o[c].atomRefs2[1]=p[c]):o[c][i[s]]=p[c])}var g=[];for(s=0,l=o.length;s<l;++s){var f=this.createStructureConnectorOfAttribs(e,o[s]);f&&g.push(f)}return g},createStructureConnectorOfAttribs:function(e,t){var r,n,i;if(t.id&&(n=t.id),delete t.id,void 0!==t.order&&(i=d.IO.CmlUtils.cmlBondOrderToKekule(t.order)),delete t.order,r=new d.Bond(n,null,i),t.bondStereo){var o=d.IO.CmlUtils.cmlBondStereoToKekule(t.bondStereo);o!=d.BondStereo.NONE&&r.setStereo&&r.setStereo(o)}delete t.bondStereo;for(var a=0,s=d.IO.CML.ATOMS_REF_ATTRIBS.length;a<s;++a)if(null!=t[u=d.IO.CML.ATOMS_REF_ATTRIBS[a]]){var l=d.IO.CmlDomUtils.splitCmlArrayValue(t[u]);l.length>0&&(r[this._BOND_ATOM_REF_TEMP_FIELD]=l),delete t[u];break}for(a=0,s=d.IO.CML.BONDS_REF_ATTRIBS.length;a<s;++a){var u;if(null!=t[u=d.IO.CML.BONDS_REF_ATTRIBS[a]]){var c=d.IO.CmlDomUtils.splitCmlArrayValue(t[u]);c.length>0&&(r[this._BOND_BOND_REF_TEMP_FIELD]=c),delete t[u];break}}for(var h in t)t.hasOwnProperty(h)&&"string"==typeof t[h]&&r.setInfoValue(h,t[h]);return r},readFormula:function(e,t,r){var n=d.IO.CmlElementReaderFactory.getReader(t);if(n){this.copySettingsToChildHandler(n);var i=n.readElement(t,e);i&&e.setFormula(i)}},readFormulaAttrib:function(e,t){var r=d.IO.CmlElementReaderFactory.getReader("formula");if(r){var n=r.readConsice?r.readConsice(t):null;n&&e.setFormula(n)}}}),d.IO.CmlMoleculeWriter=Class.create(d.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlMoleculeWriter",initProperties:function(){this.defineProp("allowCascadeGroup",{dataType:DataType.BOOL})},doCreateElem:function(e,t){return this.createChildElem("molecule",t)},doWriteObject:function(e,t){return this.writeMolecule(e,t)},writeMolecule:function(e,t){return this.writeMoleculeAttribs(e,t),e instanceof d.CompositeMolecule?this.writeCompositeMolecule(e,t):this.writeMoleculeCore(e,t)},writeMoleculeAttribs:function(e,t){var r=[];e.getCharge()&&r.push({key:"formalCharge",value:e.getCharge()});for(var n=["title","dictRef","chirality","ref","spinMultiplicity","symmetryOriented","role"],i=0,o=n.length;i<o;++i){var a=n[i],s=e.getInfoValue(a);d.ObjUtils.isUnset(s)||r.push({key:a,value:e.getInfoValue(a)})}for(i=0,o=r.length;i<o;++i)d.IO.CmlDomUtils.setCmlElemAttribute(t,r[i].key,r[i].value,this.getDomHelper())},writeCompositeMolecule:function(e,t){for(var r=e.getSubMolecules(),n=0,i=r.getItemCount();n<i;++n){var o=r.getItemAt(n),a=o.obj,s=this.writeObject(a,t);o.amount&&d.IO.CmlDomUtils.setCmlElemAttribute(s,"amount",o.amount,this.getDomHelper())}return t},writeMoleculeCore:function(e,t){if(e.hasFormula()){var r=e.getFormula(),n=d.IO.CmlElementWriterFactory.getWriter(r);this.copySettingsToChildHandler(n),n.writeObject(r,t)}e.hasCtab()&&this.writeCtab(e.getCtab(),e,t)},writeCtab:function(e,t,r){this.identifyObjsInCtab(e,t);var n=this.getAllowCascadeGroup()?e.getNodes():e.getLeafNodes();if(n.length>0)for(var i=this.createChildElem("atomArray",r),o=0,a=n.length;o<a;++o)this.writeCtabNode(n[o],i);var s=this.getAllowCascadeGroup()?e.getConnectors():e.getAllChildConnectors();if(s.length>0){var l=this.createChildElem("bondArray",r);for(o=0,a=s.length;o<a;++o)this.writeCtabConnector(s[o],l)}},writeCtabNode:function(e,t){var r=this.createChildElem("atom",t);this.writeObjId(e,r);var n=d.IO.CmlUtils.getNodeElementType(e);d.IO.CmlDomUtils.setCmlElemAttribute(r,"elementType",n,this.getDomHelper());var i=e.getMassNumber?e.getMassNumber():null;i&&d.IO.CmlDomUtils.setCmlElemAttribute(r,"isotope",i,this.getDomHelper());var o=e.getExplicitHydrogenCount?e.getExplicitHydrogenCount():null;d.ObjUtils.isUnset(o)||d.IO.CmlDomUtils.setCmlElemAttribute(r,"hydrogenCount",o,this.getDomHelper());var a=e.getCharge?e.getCharge():null;a&&d.IO.CmlDomUtils.setCmlElemAttribute(r,"formalCharge",a,this.getDomHelper()),e.getParity&&e.getParity();var s=e.getInfoValue?e.getInfoValue("title"):null;s&&d.IO.CmlDomUtils.setCmlElemAttribute(r,"title",s,this.getDomHelper());var l=e.getInfoValue?e.getInfoValue("role"):null;if(l&&d.IO.CmlDomUtils.setCmlElemAttribute(r,"role",l,this.getDomHelper()),e.hasCoord2D&&e.hasCoord2D()){var u=e.getAbsCoord2D();!d.ObjUtils.isUnset(u.x)&&d.IO.CmlDomUtils.setCmlElemAttribute(r,"x2",u.x,this.getDomHelper()),!d.ObjUtils.isUnset(u.y)&&d.IO.CmlDomUtils.setCmlElemAttribute(r,"y2",u.y,this.getDomHelper())}if(e.hasCoord3D&&e.hasCoord3D()){var c=e.getAbsCoord3D();!d.ObjUtils.isUnset(c.x)&&d.IO.CmlDomUtils.setCmlElemAttribute(r,"x3",c.x,this.getDomHelper()),!d.ObjUtils.isUnset(c.y)&&d.IO.CmlDomUtils.setCmlElemAttribute(r,"y3",c.y,this.getDomHelper()),!d.ObjUtils.isUnset(c.z)&&d.IO.CmlDomUtils.setCmlElemAttribute(r,"z3",c.z,this.getDomHelper())}for(var h=["occupancy","xFract","xyzFract","yFract","convention","dictRef","ref"],p=0,g=h.length;p<g;++p){var f=h[p],m=e.getInfoValue(f);m&&d.IO.CmlDomUtils.setCmlElemAttribute(r,f,m,this.getDomHelper())}return this.writeObjAdditionalInfo(e,r),r},writeCtabConnector:function(e,t){var r=!1,n=this.createChildElem("bond",t);this.writeObjId(e,n);var i=e.getBondOrder?e.getBondOrder():null;if(i){var o=d.IO.CmlUtils.kekuleBondOrderToCml(i);o&&d.IO.CmlDomUtils.setCmlElemAttribute(n,"order",o,this.getDomHelper())}var a,s=e.getStereo?e.getStereo():null;if(s){var l=d.IO.CmlUtils.kekuleBondStereoToCml(s);if(l.value){var u=this.createChildElem("bondStereo",n);d.DomUtils.setElementText(u,l.value),l.invert&&(r=!0)}}for(var c=[],h=[],p=0,g=e.getConnectedObjCount();p<g;++p){var f=e.getConnectedObjAt(p);if(f.getId&&f.getId()){var m=f.getId();f instanceof d.ChemStructureNode?r?c.unshift(m):c.push(m):f instanceof d.ChemStructureConnector&&h.push(m)}}if(a=c.length){var C=1==a?"atomRefs":a>=2&&a<=4?"atomRefs"+a:"atomRefs";d.IO.CmlDomUtils.setCmlElemAttribute(n,C,d.IO.CmlDomUtils.mergeToCmlArrayValue(c),this.getDomHelper())}(a=h.length)&&(C="bondRefs",d.IO.CmlDomUtils.setCmlElemAttribute(n,C,d.IO.CmlDomUtils.mergeToCmlArrayValue(h),this.getDomHelper()));var y=["convention","dictRef","ref"];for(p=0,g=y.length;p<g;++p){var _=y[p],E=e.getInfoValue(_);E&&d.IO.CmlDomUtils.setCmlElemAttribute(n,_,E,this.getDomHelper())}return this.writeObjAdditionalInfo(e,n),n},identifyObjsInCtab:function(e,t){for(var r=0,n=e.getNodeCount();r<n;++r){var i=e.getNodeAt(r);i.getId()||this.autoIdentifyForObj(i,t),e.isSubFragment(i)&&i.hasCtab&&i.hasCtab()&&this.identifyObjsInCtab(i.getCtab(),t)}for(r=0,n=e.getConnectorCount();r<n;++r){var o=e.getConnectorAt(r);o.getId()||this.autoIdentifyForObj(o,t)}},autoIdentifyForObj:function(e,t){e.getId()||(e.getOwner&&e.getOwner()&&e.getOwner().getAutoId?e.setId(e.getOwner().getAutoId(e)):e.setId(this.getAutoIdForObj(e,t)))},getAutoIdForObj:function(e,t){var r=e.getAutoIdPrefix?e.getAutoIdPrefix():"obj";return d.IO.CmlMoleculeWriter._UID_SEED||(d.IO.CmlMoleculeWriter._UID_SEED=(new Date).getTime()),++d.IO.CmlMoleculeWriter._UID_SEED,""+r+d.IO.CmlMoleculeWriter._UID_SEED.toString()}}),d.IO.CmlMoleculeWriter._UID_SEED=null,d.IO.CmlReactionReagentReader=Class.create(d.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlReactionReagentReader",doReadElement:function(e,t){return this.readReagent(e,this.getDomHelper())},readReagent:function(e,t){var r=null,n=d.DomUtils.getDirectChildElems(e,null,"molecule",this.getCoreNamespaceURI());if(n&&n.length){var i=n[n.length-1],o=d.IO.CmlElementReaderFactory.getReader(i);this.copySettingsToChildHandler(o);var a=o.readElement(i,null);a&&(r={},d.RoleMapUtils.setItem(r,a),this.readReagentAttribs(r,e,t))}return r},readReagentAttribs:function(e,t,r){for(var n=d.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(t,d.IO.CmlDomUtils.FILTER_TYPED_ELEM,!0,r),i=d.ObjUtils.getOwnedFieldNames(n),o=0,a=i.length;o<a;++o){var s=i[o],l=n[s];switch(s){case"role":e.role=d.IO.CmlUtils.reagentRoleToKekule(l);break;case"amount":case"count":e.amount=parseFloat(l);break;default:e[s]=l}}return e}}),d.IO.CmlReactionReader=Class.create(d.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlReactionReader",doReadElement:function(e,t){return this.readReaction(e,this.getDomHelper())},readReaction:function(e,t){for(var r=new d.Reaction,n=d.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI()),i=0,o=n.length;i<o;++i)this.isComponentListElem(n[i])?this.readComponentList(r,n[i],t):this.readChildElement(n[i],r);var a=d.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(e,d.IO.CmlDomUtils.FILTER_TYPED_ELEM,null,this.getDomHelper()),s=d.ObjUtils.getOwnedFieldNames(a);for(i=0,o=s.length;i<o;++i){var l=s[i],u=a[l];switch(l){case"name":r.setName(u);break;case"title":r.setTitle(u);break;case"type":r.setReactionType(u);break;case"yield":r.setYield(parseFloat(u));break;default:r.setInfoValue(l,u)}}return r},readComponentList:function(e,t,r){var n=this.getListElemComponentName(t),i=e.getComponentArray(n,!0);if(i)for(var o=d.DomUtils.getDirectChildElems(t,null,null,this.getCoreNamespaceURI()),a=0,s=o.length;a<s;++a){var l=this.readChildElement(o[a],i);l&&(n==d.ReactionComponent.CONDITION&&l instanceof ObjectEx?e.appendItem(n,l):e.appendMap(n,l))}},isComponentListElem:function(e){return["reactantList","productList","substanceList","conditionList"].indexOf(d.DomUtils.getLocalName(e))>=0},getListElemComponentName:function(e){switch(d.DomUtils.getLocalName(e)){case"reactantList":return d.ReactionComponent.REACTANT;case"productList":return d.ReactionComponent.PRODUCT;case"conditionList":return d.ReactionComponent.CONDITION;default:return d.ReactionComponent.SUBSTANCE}}}),d.IO.CmlReactionWriter=Class.create(d.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlReactionWriter",doCreateElem:function(e,t){return this.createChildElem("reaction",t)},doWriteObject:function(e,t){return this.writeReaction(e,t)},writeReaction:function(e,t){for(var r=[d.ReactionComponent.REACTANT,d.ReactionComponent.PRODUCT,d.ReactionComponent.SUBSTANCE,d.ReactionComponent.CONDITION],n=0,i=r.length;n<i;++n)this.writeCompList(e,r[n],t);return this.writeReactionAttribs(e,t),t},writeReactionAttribs:function(e,t){var r=[];e.getName()&&r.push({key:"name",value:e.getName()}),e.getTitle()&&r.push({key:"title",value:e.getTitle()}),e.getReactionType()&&r.push({key:"type",value:e.getReactionType()}),e.getYield()&&r.push({key:"yield",value:e.getYield()});for(var n=["dictRef","convention","format","ref","role","type","state","yield","atomMap","electronMap"],i=0,o=n.length;i<o;++i)d.ObjUtils.isUnset(e.getInfoValue(n[i]))||r.push({key:n[i],value:e.getInfoValue(n[i])});for(i=0,o=r.length;i<o;++i)d.IO.CmlDomUtils.setCmlElemAttribute(t,r[i].key,r[i].value,this.getDomHelper())},writeCompList:function(e,t,r){if(e.getComponentItemCount(t)<=0)return null;for(var n=this.getReactionComponentCmlName(t),i=this.createChildElem(n+"List",r),o=0,a=e.getComponentItemCount(t);o<a;++o){var s=e.getMapAt(t,o),l=e.getMapItemAt(t,o);if(s&&l){var u;t!=d.ReactionComponent.CONDITION?(u=this.createChildElem(n,i),d.ObjUtils.isUnset(s.amount)||d.IO.CmlDomUtils.setCmlElemAttribute(u,"amount",s.amount,this.getDomHelper()),s.role&&d.IO.CmlDomUtils.setCmlElemAttribute(u,"role",d.IO.CmlUtils.kekuleReagentRoleToCml(s.role),this.getDomHelper())):u=i;var c=d.IO.CmlElementWriterFactory.getWriter(l);c&&(this.copySettingsToChildHandler(c),c.writeObject(l,u))}}},getReactionComponentCmlName:function(e){switch(e){case d.ReactionComponent.REACTANT:return"reactant";case d.ReactionComponent.PRODUCT:return"product";case d.ReactionComponent.CONDITION:return"condition";default:return"substance"}}}),d.IO.CmlListReader=Class.create(d.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlListReader",doReadElement:function(e,t){var r=this.createList(e);return this.readList(r,e,this.getDomHelper())},createList:function(e){switch(d.DomUtils.getLocalName(e)){case"moleculeList":return new d.MoleculeList;case"reactionList":return new d.ReactionList;default:return new d.ChemObjList}},readList:function(e,t,r){var n=d.DomUtils.getDirectChildElems(t,null,null,this.getCoreNamespaceURI());if(n)for(var i=0,o=n.length;i<o;++i){var a=n[i],s=d.IO.CmlElementReaderFactory.getReader(a);if(s){this.copySettingsToChildHandler(s);var l=s.readElement(a,null);l&&e.append(l)}}return e}}),d.IO.CmlListWriter=Class.create(d.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlListWriter",doCreateElem:function(e,t){var r;switch(DataType.getType(e)){case"Kekule.MoleculeList":r="moleculeList";break;case"Kekule.ReactionList":r="reactionList";break;default:r="list"}return this.createChildElem(r,t)},doWriteObject:function(e,t){var r=d.ChemStructureUtils.getChildStructureObjs(e,!1);return this.writeList(r,t)},writeList:function(e,t){for(var r=0,n=e.length;r<n;++r){var i=e[r];if(i){var o=d.IO.CmlElementWriterFactory.getWriter(i);o&&(this.copySettingsToChildHandler(o),o.writeObject(i,t))}}return t}}),d.IO.CmlRootReader=Class.create(d.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlRootReader",doReadElement:function(e,t){var r;if(this.analysisElem(e),"cml"!=d.DomUtils.getLocalName(e)&&(r=this.getReader(e)),r)return r.readElement(e,null);var n=d.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI());if(n)for(var i=0,o=n.length;i<o;++i)if(r=this.getReader(n[i]))return r.readElement(n[i],null);return null},getReader:function(e){var t=d.IO.CmlElementReaderFactory.getReader(e);return t?(this.copySettingsToChildHandler(t),t):null},analysisElem:function(e){var t=this.getDomHelper();t.setForceAnalysisDoc(!0),this.getDomHelper().setRootElement(e);for(var r=t.getNamespaces(),n=null,i=0,o=r.length;i<o;++i){var a=r[i].namespaceURI;if(d.IO.CML.LEGAL_CORE_NAMESPACE_URIS.indexOf(a)>=0){n=a;break}}this.setCoreNamespaceURI(n||null)}}),d.IO.CmlRootWriter=Class.create(d.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlRootWriter",getWriter:function(e){var t=d.IO.CmlElementWriterFactory.getWriter(e);return t?(this.copySettingsToChildHandler(t),t):null},writeObject:function(e,t,r){var n;this.getDomHelper().setForceAnalysisDoc(!0),this.getDomHelper().setRootElement(t),n=e instanceof d.ChemSpace?e.getRoot():e;var i=this.getWriter(n);return i?i.writeObject(n,t):null}}),d.IO.CmlReader=Class.create(d.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.CmlReader",doReadData:function(e,t,r){var n;return n=t!=d.IO.ChemDataType.DOM?DataType.XmlUtility.parse(e).documentElement:e.documentElement?e.documentElement:e,d.IO.CmlElementReaderFactory.getReader("cml").readElement(n,null)}}),d.IO.CmlWriter=Class.create(d.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.CmlWriter",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=e||{};this.setPrettyPrint(d.ObjUtils.isUnset(t.prettyPrint)?d.globalOptions.IO.cml.prettyPrint:t.prettyPrint)},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:!0})},doWriteData:function(e,t,r){var n=d.IO.CML.CML3_SCHEMA_NAMESPACE_URI,i=DataType.XmlUtility.newDocument("cml",n),o=d.IO.CmlElementWriterFactory.getWriter("Kekule.ChemDocument");if(o){o.setCoreNamespaceURI(n);var a=o.writeObject(e,i.documentElement);return t==d.IO.ChemDataType.TEXT&&(a=DataType.XmlUtility.serializeNode(i.documentElement,{prettyPrint:this.getPrettyPrint()})),a}return d.error(d.$L("ErrorMsg.UNABLE_TO_OUTPUT_AS_CML").format(DataType.getType(e))),null}}),function(){d.IO.MimeType.CML="chemical/x-cml";var e=d.IO.CmlElementReaderFactory;e.register("name",d.IO.CmlNameReader),e.register("scalar",d.IO.CmlScalarReader),e.register("metaData",d.IO.CmlMetaDataReader),e.register("metaDataList",d.IO.CmlMetaDataListReader),e.register("formula",d.IO.CmlFormulaReader),e.register("molecule",d.IO.CmlMoleculeReader),e.register(["reactant","product","substance"],d.IO.CmlReactionReagentReader),e.register("reaction",d.IO.CmlReactionReader),e.register(["list","moleculeList","reactionList"],d.IO.CmlListReader),e.register("cml",d.IO.CmlRootReader);var t=d.IO.CmlElementWriterFactory;t.register("Kekule.Scalar",d.IO.CmlScalarWriter),t.register("Kekule.MolecularFormula",d.IO.CmlFormulaWriter),t.register(["Kekule.ChemStructureFragment","Kekule.Molecule","Kekule.CompositeMolecule"],d.IO.CmlMoleculeWriter),t.register("Kekule.Reaction",d.IO.CmlReactionWriter),t.register(["Kekule.ChemObjList","Kekule.ChemStructureObjectGroup","Kekule.ChemSpaceElement","Kekule.ChemSpace"],d.IO.CmlListWriter),t.register("Kekule.ChemDocument",d.IO.CmlRootWriter),d.IO.DataFormat.CML="cml",d.IO.DataFormatsManager.register("cml",d.IO.MimeType.CML,"cml",d.IO.ChemDataType.TEXT,"Chemical Markup Language");var r=d.IO.DataFormatsManager.findFormatId(d.IO.MimeType.CML);d.IO.ChemDataReaderManager.register("cml",d.IO.CmlReader,[r]),d.IO.ChemDataWriterManager.register("cml",d.IO.CmlWriter,[d.Scalar,d.StructureFragment,d.Reaction,d.ChemObjList,d.ChemSpace],[r])}(),d.IO.MdlVersion={V2000:2,V3000:3},d.IO.MDL={VER2000:"V2000",VER3000:"V3000",SYMBOL_ANYATOM:"A",SYMBOL_STARATOM:"*",SYMBOL_HETEROATOM:"Q",SYMBOL_RGROUP:"R",SYMBOL_RGROUP2:"R#",SYMBOL_LONEPAIR:"LP",SYMBOL_ATOMLIST:"L",SYMBOL_DUMMYATOM:"Du",SD_DATA_HEAD_PREFIX:">",MOL_DELIMITER:"$$$$"},d.IO.MdlUtils={isUnspecifiedAtomSymbol:function(e){return e===d.IO.MDL.SYMBOL_ANYATOM||e===d.IO.MDL.SYMBOL_STARATOM},isHeteroAtomSymbol:function(e){return e===d.IO.MDL.SYMBOL_HETEROATOM},isRGroupSymbol:function(e){return e===d.IO.MDL.SYMBOL_RGROUP||e===d.IO.MDL.SYMBOL_RGROUP2},isLonePairSymbol:function(e){return e===d.IO.MDL.SYMBOL_LONEPAIR},isAtomListSymbol:function(e){return e===d.IO.MDL.SYMBOL_ATOMLIST},analysisMdlDateTimeStr:function(e,t){var r=new Date,n=0,i=2,o=(parseInt(e.substr(n,i).trim(),10)||1)-1;n+=i;var a=parseInt(e.substr(n,i).trim(),10)||0;n+=i,i=t?4:2;var s=parseInt(e.substr(n,i),10)||0;t||(s+=s>=70?1900:2e3),r.setFullYear(s,o,a),n+=i,i=2;var l=parseInt(e.substr(n,i),10)||0;n+=i;var d=parseInt(e.substr(n,i),10)||0;return r.setHours(l,d),r},generateMdlDateTimeStr:function(e,t){var r="";return r+=(e.getMonth()+1).toString().lpad(2,"0"),r+=e.getDate().toString().lpad(2,"0"),r+=t?e.getFullYear().toString().lpad(4,"0"):(e.getFullYear()%100).toString().lpad(2,"0"),(r+=e.getHours().toString().lpad(2,"0"))+e.getMinutes().toString().lpad(2,"0")},mdlRadicalToKekule:function(e){return e},kekuleRadicalToMdl:function(e){return e},bondTypeToKekuleOrder:function(e){switch(e){case 1:return d.BondOrder.SINGLE;case 2:return d.BondOrder.DOUBLE;case 3:return d.BondOrder.TRIPLE;case 4:return d.BondOrder.EXPLICIT_AROMATIC;default:return d.BondOrder.UNSET}},kekuleBondOrderToMdlType:function(e){switch(e){case d.BondOrder.SINGLE:return 1;case d.BondOrder.DOUBLE:return 2;case d.BondOrder.TRIPLE:return 3;case d.BondOrder.EXPLICIT_AROMATIC:return 4;default:return 1}},getRxnMarkVersion:function(e){var t=e.substr(0,4);return"$RXN"!=t?null:(t=e.substr(4).trim())==d.IO.MDL.VER3000?d.IO.MdlVersion.V3000:d.IO.MdlVersion.V2000},assertIlegalForCtabOutput:function(e){return e instanceof d.StructureFragment?!!e.hasCtab()||(d.error(d.$L("ErrorMsg.MOLECULE_HAS_NO_CTAB_TO_OUTPUT")),!1):(d.error(d.$L("ErrorMsg.CAN_NOT_WRITE_NON_MOLECULE_TO_MOL")),!1)}},d.IO.MdlStructureUtils={fillFragment:function(e,t,r){if(e.clear(),t){var n;if(n=r&&r!=d.CoordMode.UNKNOWN?r==d.CoordMode.COORD3D:t.atomInfos.isCoord3D,t.atomInfos)for(var i=0,o=t.atomInfos.length;i<o;++i)if(u=t.atomInfos[i]){var a=d.IO.MdlStructureUtils.createStructureNode(e,u,n);a?e.appendNode(a):d.raise(d.$L("ErrorMsg.MDL_CTAB_ATOM_CANNOT_CREATE"))}if(t.bondInfos)for(i=0,o=t.bondInfos.length;i<o;++i)if(u=t.bondInfos[i]){var s=d.IO.MdlStructureUtils.createStructureConnector(e,u);s?e.appendConnector(s):d.raise(d.$L("ErrorMsg.MDL_CTAB_BOND_CANNOT_CREATE"))}if(t.sgInfos&&t.sgInfos.length){var l=[];for(i=0,o=t.sgInfos.length;i<o;++i){var u;if((u=t.sgInfos[i])&&"SUP"==u.sgType){for(var c=[],h=0,p=u.atomIndexes.length;h<p;++h)c.push(e.getNodeAt(u.atomIndexes[h]));c.length&&l.push({atoms:c,text:u.label})}}for(i=0,o=l.length;i<o;++i)if((c=l[i].atoms).length){var g=e.marshalSubFragment(c,new d.SubGroup),f=l[i].text;g.setFormulaText&&f.match(/.+\d/)?g.setFormulaText(l[i].text):g.setAbbr(l[i].text)}}}return e},createStructureNode:function(e,t,r){var n;if(t.atomListInfo||d.IO.MdlUtils.isAtomListSymbol(t.symbol)){n=new d.VariableAtom;var i=[];t.atomListInfo&&t.atomListInfo.symbols&&(i=i.concat(t.atomListInfo.symbols),t.atomListInfo.isAllowList?n.setAllowedIsotopeIds(i):n.setDisallowedIsotopeIds(i))}else if(d.IO.MdlUtils.isRGroupSymbol(t.symbol))n=new d.RGroup;else if(d.IO.MdlUtils.isHeteroAtomSymbol(t.symbol))n=new d.Pseudoatom(null,d.PseudoatomType.HETERO);else if(d.IO.MdlUtils.isUnspecifiedAtomSymbol(t.symbol))n=new d.Pseudoatom(null,d.PseudoatomType.ANY);else{var o=d.ChemicalElementsDataUtil.getElementInfo(t.symbol);if(o){var a=null;if(t.massNumber)a=t.massNumber;else if(t.massDiff&&o){var s=o.naturalMass,l=(a=Math.round(s+t.massDiff),d.IsotopesDataUtil.getIsotopeInfo(o.atomicNumber,a));l||(a=Math.floor(s+t.massDiff),l=d.IsotopesDataUtil.getIsotopeInfo(o.atomicNumber,a)),l||(a=Math.ceil(s+t.massDiff),l=d.IsotopesDataUtil.getIsotopeInfo(o.atomicNumber,a)),l||(a=null)}n=new d.Atom(null,t.symbol,a)}else{var u=d.IsotopesDataUtil.getIsotopeInfo(t.symbol);n=u?new d.Atom(null,u.atomicNumber,u.massNumber):new d.Pseudoatom(null,d.PseudoatomType.ANY)}}return t.charge&&n.setCharge(t.charge),t.radical&&n.setRadical(t.radical),t.parity&&n.setParity&&n.setParity(t.parity),void 0!==t.hydrongenCount&&n.setExplicitHydrogenCount&&n.setExplicitHydrogenCount(t.hydrongenCount),r?n.setCoord3D({x:t.x,y:t.y,z:t.z}):n.setCoord2D({x:t.x,y:t.y}),n},createStructureConnector:function(e,t){var r=e.getNodeAt(t.atomIndex1),n=e.getNodeAt(t.atomIndex2);if(r&&n){var i=[r,n];if(t.endAtomIndexes)for(var o=0,a=t.endAtomIndexes.length;o<a;++o){var s=e.getNodeAt(t.endAtomIndexes[o]);s&&i.push(s)}var l=new d.Bond(null,i,t.order);return void 0!==t.stereo&&l.setStereo(t.stereo),l}return null},isNodeVariableAtom:function(e){return e instanceof d.VariableAtom},getAtomTypeStr:function(e,t){if(e instanceof d.Atom)return e.getSymbol();if(!(e instanceof d.Pseudoatom)){if(e instanceof d.RGroup)return d.IO.MDL.SYMBOL_RGROUP;if(e instanceof d.VariableAtom){if(t)return d.IO.MDL.SYMBOL_ATOMLIST;var r="[",n=e.getAllowedIsotopeIds();if(n&&n.length||(r="NOT[",n=e.getDisallowedIsotopeIds()),n&&n.length){for(var i=[],o=0,a=n.length;o<a;++o){var s=d.IsotopesDataUtil.getIsotopeIdDetail(n[o]);s&&s.symbol&&i.push(s.symbol)}return r+i.join(",")+"]"}return d.IO.MDL.SYMBOL_ATOMLIST}return"?"}switch(e.getAtomType()){case d.PseudoatomType.ANY:return d.IO.MDL.SYMBOL_ANYATOM;case d.PseudoatomType.HETERO:return d.IO.MDL.SYMBOL_HETEROATOM;default:return d.IO.MDL.SYMBOL_DUMMYATOM}},getMoleculeCtabStructureInfo:function(e){var t={};t.atoms=e.getLeafNodes(),t.bonds=e.getAllChildConnectors(),t.subGroups=e.getSubFragments();for(var r=0,n=0,i=0,o=t.atoms.length;i<o;++i)t.atoms[i].hasCoord3D()&&++n,t.atoms[i].hasCoord2D()&&++r;return t.coordMode=r>n?d.CoordMode.COORD2D:d.CoordMode.COORD3D,t},splitConnectedNodes:function(e){for(var t={primaryNodes:[]},r=0,n=e.getConnectedObjs(),i=0,o=n.length;i<o;++i)n[i]instanceof d.ChemStructureNode&&(r<2?(t.primaryNodes.push(n[i]),++r):(t.remainNodes||(t.remainNodes=[]),t.remainNodes.push(n[i])));return t},generateClassicStyleCountLine:function(e,t){if(t==d.IO.MdlVersion.V3000)return"  0  0  0     0  0              0 V3000";var r="";r+=e.atoms.length.toString().lpad(3),r+=e.bonds.length.toString().lpad(3),r+="0".lpad(3),r+="0".lpad(3),r+="0".lpad(3),r+="0".lpad(3);for(var n=0;n<4;++n)r+="0".lpad(3);return(r+="999")+d.IO.MDL.VER2000.lpad(6)}},d.IO.MdlBlockHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.MdlBlockHandler",initProperties:function(){this.defineProp("textBuffer",{dataType:"Kekule.TextLinesBuffer",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("textBuffer");return e||(e=this.createTextBuffer(),this.setPropStoreFieldValue("textBuffer",e)),e},setter:null})},createTextBuffer:function(){return new d.TextLinesBuffer}}),d.IO.MdlBlockReader=Class.create(d.IO.MdlBlockHandler,{CLASS_NAME:"Kekule.IO.MdlBlockReader",readBlock:function(e,t){return"string"==typeof e?this.getTextBuffer().setText(e):this.getTextBuffer().setLines(e),this.getTextBuffer().reset(),this.doReadBlock(this.getTextBuffer())},doReadBlock:function(e,t){}}),d.IO.MdlBlockWriter=Class.create(d.IO.MdlBlockHandler,{CLASS_NAME:"Kekule.IO.MdlBlockWriter",writeBlock:function(e){return this.getTextBuffer().clear(),this.doWriteBlock(e,this.getTextBuffer()),this.getTextBuffer().getText()},doWriteBlock:function(e,t){}}),d.IO.Mdl2kUtils={atomLineChargeToKekule:function(e){switch(e){case 1:return 3;case 2:return 2;case 3:return 1;case 5:return-1;case 6:return-2;case 7:return-3;default:return 0}},chargeToMdlAtomLineValue:function(e){switch(e){case 1:return 3;case 2:return 2;case 3:return 1;case-1:return 5;case-2:return 6;case-3:return 7;default:return 0}},atomLineChargeToRadical:function(e){return 4==e?d.RadicalOrder.DOUBLET:0},radicalToMdlAtomLineValue:function(e){return e==d.RadicalOrder.DOUBLET?4:0},chargeOrRadicalToMdlAtomLineValue:function(e,t){return e?d.IO.Mdl2kUtils.chargeToMdlAtomLineValue(e):t?d.IO.Mdl2kUtils.radicalToMdlAtomLineValue(e):0},bondStereoToKekule:function(e,t){if(t!=d.BondOrder.SINGLE)return t!=d.BondOrder.DOUBLE?d.BondStereo.NONE:3===e?d.BondStereo.E_Z_BY_COORDINATES:d.BondStereo.NONE;switch(e){case 1:return d.BondStereo.UP;case 4:return d.BondStereo.UP_OR_DOWN;case 6:return d.BondStereo.DOWN;default:return d.BondStereo.NONE}},bondStereoToMdlBondLineValue:function(e,t,r){var n=d.BondStereo,i={};if(t==d.BondOrder.SINGLE)if(r&&[n.UP_INVERTED,n.DOWN_INVERTED].indexOf(e)>=0&&(i.inverted=!0),i.inverted)e===n.UP_INVERTED?i.stereo=1:e===n.DOWN_INVERTED&&(i.stereo=6);else switch(e){case n.DOWN_INVERTED:case n.UP:i.stereo=1;break;case n.UP_INVERTED:case n.DOWN:i.stereo=6;break;case n.UP_OR_DOWN_INVERTED:case n.UP_OR_DOWN:i.stereo=4;break;default:i.stereo=0}else if(t==d.BondOrder.DOUBLE)if(e===d.BondStereo.E_Z_BY_COORDINATES)i.stereo=3;else i.stereo=0;else i.stereo=0;return i},coordToStr:function(e){return(e||0).toFixed(4)},getMassDiff:function(e){var t=d.ChemicalElementsDataUtil.getElementInfo(e.getAtomicNumber()).naturalMass;return Math.round(e.getMassNumber()-t)},getAtomListPropLineValue:function(e){var t="",r=e.getAllowedIsotopeIds();if(r&&r.length?t=" F ":(t=" T ",r=e.getDisallowedIsotopeIds()),r&&r.length){for(var n=[],i=0,o=r.length;i<o;++i){var a=d.IsotopesDataUtil.getIsotopeIdDetail(r[i]);a&&a.symbol&&n.push(a.symbol.rpad(4))}var s=n.join("");return n.length.toString().lpad(3)+t+s}return null},getCtabPropLineTag:function(e,t){return(t||"M")+"  "+e},getCtabPropLineCountTag:function(e,t,r){var n=(r||"M")+"  "+e;return t&&(n+=t.toString().lpad(3)),n},generateCtabPropLine:function(e,t,r,n){return d.IO.Mdl2kUtils.getCtabPropLineCountTag(t,r,n)+" "+e.join(" ")}},d.IO.Mdl2kCTabReader=Class.create(d.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.Mdl2kCTabReader",doReadBlock:function(e,t){return this.analysisCTab(e)},analysisCTab:function(e){var t={},r=e.readLine(),n=this.analysisCountLine(r),i=[];i.isCoord3D=!1;for(var o=0;o<n.atomCount;++o){r=e.readLine();var a=this.analysisAtomLine(r);a.z&&(i.isCoord3D=!0),i.push(a)}var s=[];for(o=0;o<n.bondCount;++o){r=e.readLine();var l=this.analysisBondLine(r);s.push(l)}for(o=0;o<n.atomListCount;++o){r=e.readLine();var d=this.analysisAtomListInfoLine(r);i[d.atomIndex]&&(i[d.atomIndex].atomListInfo=d)}for(o=0;o<n.stextCount;++o)r=e.readLine(),r=e.readLine();for(var u=[];!e.eof();){r=e.readLine();var c=this.analysisPropertyLine(r,i,u);if("END"===c.prop)break;if("SKP"===c.prop)for(o=0;o<c.count&&!e.eof();++o)r=e.readLine();else if("A"===c.leading){if(e.eof())break;var h=c.atomIndex;r=e.readLine(),i[h].symbol=r.trim()}}return t.countInfo=n,t.atomInfos=i,t.bondInfos=s,t.sgInfos=u,t},analysisCountLine:function(e){var t={},r=e.substr(33,6).trim();return r&&r!=d.IO.MDL.VER2000?(d.error(d.$L("ErrorMsg.NOT_MDL2000_FORMAT_DATA")),null):(r=e.substr(0,3),t.atomCount=parseInt(r,10),r=e.substr(3,3),t.bondCount=parseInt(r,10),r=e.substr(12,3),t.isChiral=0!=parseInt(r,10),r=e.substr(15,3),t.stextCount=parseInt(r,10),t)},analysisAtomLine:function(e){var t={},r=e.substr(0,10);t.x=parseFloat(r),r=e.substr(10,10),t.y=parseFloat(r),r=e.substr(20,10),t.z=parseFloat(r),r=e.substr(31,3),t.symbol=r.trim(),r=e.substr(34,2),t.massDiff=parseInt(r,10),r=e.substr(36,3);var n=parseInt(r,10),i=d.IO.Mdl2kUtils.atomLineChargeToRadical(n);return i?t.radical=i:t.charge=d.IO.Mdl2kUtils.atomLineChargeToKekule(n),r=e.substr(39,3),(n=parseInt(r,10))&&(t.parity=n),r=e.substr(42,3),(n=parseInt(r,10))>0&&(t.hydrongenCount=n-1),t},analysisBondLine:function(e){var t={},r=e.substr(0,3);t.atomIndex1=parseInt(r,10)-1,r=e.substr(3,3),t.atomIndex2=parseInt(r,10)-1,r=e.substr(6,3),t.order=d.IO.MdlUtils.bondTypeToKekuleOrder(parseInt(r,10)),r=e.substr(9,3);var n=d.IO.Mdl2kUtils.bondStereoToKekule(parseInt(r,10),t.order);return n&&(t.stereo=n),t},analysisAtomListInfoLine:function(e){var t={},r=e.substr(0,3);t.atomIndex=parseInt(r,10)-1,r=e.substr(4,1),t.isAllowList="f"==r.toLowerCase(),r=e.substr(9,1);var n=Math.min(parseInt(r,10),5);t.atomicNumbers=[];for(var i=11,o=0;o<n;++o){i+=4*o,r=e.substr(i,3);var a=parseInt(r,10);a&&t.atomicNumbers.push(a)}return t},analysisPropertyLine:function(e,t,r){var n={},i=e.substr(0,1);if(n.leading=i,"M"==i){var o,a,s=e.substr(3,3).trim();if(n.prop=s,"END"===s)return n;if(["CHG","RAD","ISO"].indexOf(s)>=0){var l=parseInt(e.substr(6,3).trim());n.entryCount=l,n.entries=[];for(var u="CHG"===s?"charge":"RAD"===s?"radical":"massNumber",c=10,h=0;h<l;++h){var p=parseInt(e.substr(c,3).trim(),10)-1,g=parseInt(e.substr(c+4,3).trim(),10);c+=8,n.entries.push({atomIndex:p,propName:g}),t[p][u]=g}}else["STY","SLB"].indexOf(s)>=0?a=r[o=parseInt(e.substr(10,3),10)-1]:["SAL","SBL","SMT","SCL","SAP","SBV"].indexOf(s)>=0&&(a=r[o=parseInt(e.substr(7,3),10)-1]);switch(s){case"ALS":var f={},m=e.substr(7,3).trim();f.atomIndex=parseInt(m,10)-1,n.atomIndex=f.atomIndex;var C=parseInt(e.substr(10,3)),y=e.substr(14,1);for(f.isAllowList="f"==y.toLowerCase(),f.symbols=[],h=0;h<C;++h)y=e.substr(16+4*h,4).trim(),f.symbols.push(y);n.atomListInfo=f;var _=t[f.atomIndex].atomListInfo;_?_.isAllowList!==f.isAllowList?t[f.atomIndex].atomListInfo=f:_.symbols=d.ArrayUtils.pushUnique(_.symbols,f.symbols):t[f.atomIndex].atomListInfo=f;break;case"STY":"SUP"==e.substr(14,3)&&(r[o]={sgType:"SUP"});break;case"SLB":a&&(a.labelId=e.substr(14).trim());break;case"SAL":if(a){var E=parseInt(e.substr(10,3));for(a.atomIndexes||(a.atomIndexes=[]),h=0;h<E;++h)y=e.substr(14+4*h,3),p=parseInt(y)-1,a.atomIndexes.push(p)}break;case"SBL":if(a&&"SUP"==a.sgType){var T=parseInt(e.substr(10,3));for(a.crossBondIndexes||(a.crossBondIndexes=[]),h=0;h<T;++h){y=e.substr(14+4*h,3);var O=parseInt(y)-1;a.crossBondIndexes.push(O)}}break;case"SMT":a&&("SUP"==a.sgType?a.label=e.substr(11).trim():a.subscript=e.substr(11).trim());break;case"SCL":a&&(a.sgClass=e.substr(11).trim());break;case"SBV":if(a){var v=parseInt(e.substr(11,3),10)-1;a.bondVectors||(a.bondVectors=[]),a.bondVectors[v]={bondIndex:v,x:parseFloat(e.substr(14,10)),y:parseFloat(e.substr(24,10))};var S=e.substr(34,10).trim();S&&(a.bondVectors[v].z=parseFloat(S)||0)}}}else"A"===i?(c=3,p=parseInt(e.substr(c,3).trim(),10)-1,n.atomIndex=p):"V"===i||"G"===i||"S"===i&&(s=e.substr(3,3).trim(),n.prop=s,n.count=parseInt(e.substr(6,3),10));return n}}),d.IO.Mdl2kCTabWriter=Class.create(d.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl2kCTabWriter",initialize:function(e){this.tryApplySuper("initialize"),this.setCoordMode(e||d.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,deaultValue:d.CoordMode.UNKNOWN})},doWriteBlock:function(e,t){return d.IO.MdlUtils.assertIlegalForCtabOutput(e),this.outputCtab(e,t)},outputCtab:function(e,t){var r=[],n=d.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(e);if(this.getCoordMode()!=d.CoordMode.UNKNOWN&&(n.coordMode=this.getCoordMode()),t.writeLine(this.generateCountLine(n)),this.outputAtomBlock(e,n,t,r),this.outputBondBlock(e,n,t),r.length)for(var i=0,o=r.length;i<o;++i)t.writeLine(r[i]);this.outputSubgroupsPropLines(e,n,t),t.writeLine(d.IO.Mdl2kUtils.getCtabPropLineTag("END"))},generateCountLine:function(e){return d.IO.MdlStructureUtils.generateClassicStyleCountLine(e,d.IO.MdlVersion.V2000)},outputAtomBlock:function(e,t,r,n){for(var i=0,o=t.atoms.length;i<o;++i){var a=t.atoms[i],s=this.generateAtomLine(i,t.coordMode,a,n);r.writeLine(s)}},generateAtomLine:function(e,t,r,n){var i=d.IO.Mdl2kUtils.coordToStr,o="",a=(e+1).toString().lpad(3),s=t==d.CoordMode.COORD3D?r.getAbsCoord3D():r.getAbsCoord2D();if(o+=i(s.x).lpad(10)+i(s.y).lpad(10)+i(s.z).lpad(10),o+=" "+d.IO.MdlStructureUtils.getAtomTypeStr(r,!0).rpad(3),d.IO.MdlStructureUtils.isNodeVariableAtom(r)){var l=d.IO.Mdl2kUtils.getAtomListPropLineValue(r);if(l){var u=d.IO.Mdl2kUtils.getCtabPropLineTag("ALS")+" "+a+l;n.push(u)}}r.getMassNumber&&r.getMassNumber()?(o+=(d.IO.Mdl2kUtils.getMassDiff(r.getIsotope())||0).toString().lpad(2),u=d.IO.Mdl2kUtils.generateCtabPropLine([a,r.getMassNumber().toString().lpad(3)],"ISO",1),n.push(u)):o+="0".lpad(2),o+=d.IO.Mdl2kUtils.chargeOrRadicalToMdlAtomLineValue(r.getCharge?r.getCharge():null,r.getRadical?r.getRadical():null).toString().lpad(3),r.getCharge&&r.getCharge()&&(u=d.IO.Mdl2kUtils.generateCtabPropLine([a,r.getCharge().toString().lpad(3)],"CHG",1),n.push(u)),r.getRadical&&r.getRadical()&&(u=d.IO.Mdl2kUtils.generateCtabPropLine([a,d.IO.MdlUtils.kekuleRadicalToMdl(r.getRadical()).toString().lpad(3)],"RAD",1),n.push(u)),o+=(r.getParity&&r.getParity()||0).toString().lpad(3);var c=r.getExplicitHydrogenCount?r.getExplicitHydrogenCount():null;o+=(d.ObjUtils.isUnset(c)?"0":(c+1).toString()).lpad(3);for(var h=0,p="0".lpad(3);h<8;++h)o+=p;return o},outputBondBlock:function(e,t,r){for(var n=0,i=t.bonds.length;n<i;++n){var o=t.bonds[n],a=this.generateBondLine(n,o,t.atoms);r.writeLine(a)}},generateBondLine:function(e,t,r){var n,i,o="";t.getStereo&&t.getBondOrder?n=(i=d.IO.Mdl2kUtils.bondStereoToMdlBondLineValue(t.getStereo(),t.getBondOrder(),!0)).stereo.toString().lpad(3):(i={},n+="0".lpad(3));var a,s,l=d.IO.MdlStructureUtils.splitConnectedNodes(t);return a=(r.indexOf(l.primaryNodes[0])+1).toString().lpad(3),s=(r.indexOf(l.primaryNodes[1])+1).toString().lpad(3),i&&i.inverted?o+=s+a:o+=a+s,t.getBondOrder?o+=d.IO.MdlUtils.kekuleBondOrderToMdlType(t.getBondOrder()).toString().lpad(3):o+="0".lpad(3),o+=n,o+="0".lpad(3),(o+="0".lpad(3))+"0".lpad(3)},outputSubgroupsPropLines:function(e,t,r){for(var n=0,i=t.subGroups.length;n<i;++n)for(var o=this.generateSgroupLines(n,t.subGroups[n],t),a=0,s=o.length;a<s;++a)r.writeLine(o[a])},generateSgroupLines:function(e,t,r){var n=[],i=(e+1).toString().lpad(3),o=d.IO.Mdl2kUtils.generateCtabPropLine([i,"SUP"],"STY",1);n.push(o),o=d.IO.Mdl2kUtils.generateCtabPropLine([i,i],"SLB",1),n.push(o);var a=t.getAbbr&&t.getAbbr()||t.getFormulaText&&t.getFormulaText()||t.getName&&t.getName();a&&(o=d.IO.Mdl2kUtils.generateCtabPropLine([i,a],"SMT"),n.push(o));for(var s=[],l=0,u=(C=t.getLeafNodes()).length;l<u;++l)(e=r.atoms.indexOf(C[l]))>=0&&s.push((e+1).toString().lpad(3));s=s.sort();var c=d.ArrayUtils.divide(s,15);for(l=0,u=c.length;l<u;++l){var h=c[l];o=d.IO.Mdl2kUtils.getCtabPropLineTag("SAL")+" "+i+h.length.toString().lpad(3)+" "+h.join(" "),n.push(o)}var p=t.getCrossConnectors(),g=[],f=[],m=d.IO.Mdl2kUtils.coordToStr;for(l=0,u=p.length;l<u;++l)if((e=r.bonds.indexOf(p[l]))>=0){g.push((e+1).toString().lpad(3));var C,y=[e+1],_={};2==(C=d.IO.MdlStructureUtils.splitConnectedNodes(p[l]).primaryNodes).length&&(r.coordMode==d.CoordMode.COORD2D?(_=d.CoordUtils.substract(C[0].getAbsCoord2D(),C[1].getAbsCoord2D()),y=y.concat([m(_.x).lpad(10),m(_.y).lpad(10)])):(_=d.CoordUtils.substract(C[0].getAbsCoord3D(),C[1].getAbsCoord3D()),y=y.concat([m(_.x),m(_.y),m(_.z)]))),f.push(y)}g=g.sort();var E=d.ArrayUtils.divide(g,15);for(l=0,u=E.length;l<u;++l){var T=E[l];o=d.IO.Mdl2kUtils.getCtabPropLineTag("SBL")+" "+i+T.length.toString().lpad(3)+" "+T.join(" "),n.push(o)}for(l=0,u=f.length;l<u;++l){var O=f[l].shift(),v=f[l].join("");o=d.IO.Mdl2kUtils.getCtabPropLineTag("SBV")+" "+i+" "+O.toString().lpad(3)+v,n.push(o)}return n}}),d.IO.Mdl3kUtils={get3kBlockStartTag:function(e){return"BEGIN "+e.toUpperCase()},get3kBlockEndTag:function(e){return"END "+e.toUpperCase()},isAtomList:function(e){return e.search(/\[.+\]/)>=0},analysisAtomList:function(e){var t=/\[(.+)\]/g.exec(e);if(t&&t.length>=2){t=t[1].split(",");var r={};r.isAllowList=!(0==e.trim().indexOf("NOT")),r.symbols=[];for(var n=0,i=t.length;n<i;++n)r.symbols.push(t[n].trim());return r}return null},bondCfgToKekule:function(e){switch(e){case 0:default:return d.BondStereo.NONE;case 1:return d.BondStereo.UP;case 2:return d.BondStereo.UP_OR_DOWN;case 3:return d.BondStereo.DOWN}},bondStereoToMdlCfg:function(e,t){var r=d.BondStereo,n={};if(t&&[r.UP_INVERTED,r.DOWN_INVERTED].indexOf(e)>=0&&(n.inverted=!0),n.inverted)e===r.UP_INVERTED?n.cfg=1:e===r.DOWN_INVERTED&&(n.cfg=3);else switch(e){case r.UP:case r.DOWN_INVERTED:n.cfg=1;break;case r.UP_OR_DOWN:n.cfg=2;break;case r.DOWN:case r.UP_INVERTED:n.cfg=3;break;default:n.cfg=0}return n},coordToStr:function(e){return(e||0).toFixed(6)}},d.IO.Mdl3kValueUtils={SEPARATOR:" ",KEYVALUE_CONNECTOR:"=",STR_QUOTE:'"',ESC_QUOTE:'""',VALUELIST_PATTERN:/\(.+\)/g,split:function(e,t){for(var r=t||d.IO.Mdl3kValueUtils.SEPARATOR,n=d.IO.Mdl3kValueUtils.STR_QUOTE,i=[],o=!1,a=!1,s=!1,l="",u=0,c=e.length;u<c;++u){var h=e.charAt(u);h==n?!o&&e.charAt(u+1)==n||o&&e.charAt(u-1)==n||(o=!o):"["==h?a=!0:"]"==h?a=!1:"("==h?s=!0:")"==h&&(s=!1),h==r?o||a||s||!l?l+=h:(i.push(l),l=""):l+=h}return l&&i.push(l),i},merge:function(e,t){var r=t||d.IO.Mdl3kValueUtils.SEPARATOR;return e.join(r)},isKeyValuePair:function(e){return e.indexOf(d.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR)>=0},splitKeyValue:function(e){var t={},r=d.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR,n=e.indexOf(r);return n<0?t.value=e:(t.key=e.substr(0,n),t.value=e.substr(n+r.length)),t},mergeKeyValue:function(e,t){return t?""+t+d.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR+e:e},isValueList:function(e){return e.search(d.IO.Mdl3kValueUtils.VALUELIST_PATTERN)>=0},splitValueList:function(e){var t=/\((.+)\)/.exec(e);if(t&&t.length>1){var r=t[1],n=d.IO.Mdl3kValueUtils.split(r);return n.shift(),n}return[e]},mergeValueList:function(e){for(var t="("+e.length,r=0,n=e.length;r<n;++r)t+=d.IO.Mdl3kValueUtils.SEPARATOR+e[r];return t+")"},unquoteValue:function(e){var t=d.IO.Mdl3kValueUtils.STR_QUOTE,r=e.trim();r.substr(0,t.length)==t&&(r=r.substr(t.length)),r.substr(r.length-t.length)==t&&(r=r.substr(0,r.length-t.length));var n=new RegExp(t+t,"g");return r=r.replace(n,t),d.IO.Mdl3kValueUtils.isValueList(r)&&(r=d.IO.Mdl3kValueUtils.splitValueList(r)),r},quoteValue:function(e){var t=d.IO.Mdl3kValueUtils.STR_QUOTE,r=""+e,n=new RegExp(t,"g");return(r=r.replace(n,t+t)).indexOf(d.IO.Mdl3kValueUtils.SEPARATOR)>=0&&(r=t+r+t),r},splitValues:function(e){for(var t=[],r=d.IO.Mdl3kValueUtils.split(e),n=0,i=r.length;n<i;++n){var o=d.IO.Mdl3kValueUtils.splitKeyValue(r[n]);o.value&&(o.value=d.IO.Mdl3kValueUtils.unquoteValue(o.value)),t.push(o)}return t},mergeValues:function(e){for(var t,r=0,n=e.length;r<n;++r){var i,o,a,s=e[r];"object"!=typeof s||d.ArrayUtils.isArray(s)?o=s:(i=s.key,o=s.value),a=d.ArrayUtils.isArray(o)?d.IO.Mdl3kValueUtils.mergeValueList(o):d.IO.Mdl3kValueUtils.quoteValue(o),i&&(a=d.IO.Mdl3kValueUtils.mergeKeyValue(a,i)),t=d.IO.Mdl3kValueUtils.appendToken(t,a)}return t},appendToken:function(e,t,r){var n=r||d.IO.Mdl3kValueUtils.SEPARATOR,i=e||"";return i&&i.substr(i.length-n.length,n.length)!=n?i+=d.IO.Mdl3kValueUtils.SEPARATOR+t:i=t,i}},d.IO.Mdl3kTextBuffer=Class.create(d.TextLinesBuffer,{CLASS_NAME:"Kekule.Mdl3kTextBuffer",LEADING_TAG:"M  V30 ",LINE_CONTI_MARK:"-",MAX_COL_WIDTH:80,initialize:function(e){this.tryApplySuper("initialize",[e])},isStartWithLeadingTag:function(e){return e.substr(0,this.LEADING_TAG.length)==this.LEADING_TAG},isEndWithContinueMark:function(e){var t=e.trim();return t.substr(t.length-this.LINE_CONTI_MARK.length)==this.LINE_CONTI_MARK},getLineWithout3kTag:function(e){if(!e)return e;var t=this.LEADING_TAG.length;return e.substr(0,t)==this.LEADING_TAG?e.substr(t):e},getLineAtEx:function(e){var t=this.getLineAt(e),r=1;if(t&&this.isEndWithContinueMark(t)&&this.isStartWithLeadingTag(this.getLines()[e])){var n=t.lastIndexOf(this.LINE_CONTI_MARK);t=t.substr(0,n);var i=this.getLineAtEx(e+1);t+=i.line,r+=i.lineCount}return{line:t,lineCount:r}},getLineAt:function(e){var t=this.tryApplySuper("getLineAt",[e]);return this.getLineWithout3kTag(t)},readLine:function(){var e=this.getLineAtEx(this.getCurrLineNo());return this.incCurrLineNo(e.lineCount),e.line||""},writeLine:function(e,t){if(t)return this.tryApplySuper("writeLine",[e]);var r,n=e;if(this.isStartWithLeadingTag(e)||(n=this.LEADING_TAG+n),n.length>this.MAX_COL_WIDTH){var i=this.LINE_CONTI_MARK,o=(d.IO.Mdl3kValueUtils.SEPARATOR,this.MAX_COL_WIDTH-i.length);r=n.substr(o),n=n.substr(0,o),n+=i}var a=this.tryApplySuper("writeLine",[n]);return r&&(a=this.writeLine(r,t)),a},writeLines:function(e,t){for(var r=0,n=e.length;r<n;++r)this.writeLine(e[r],t)},getBlockBuffer:function(e,t){for(var r,n=d.IO.Mdl3kUtils.get3kBlockStartTag(e),i=d.IO.Mdl3kUtils.get3kBlockEndTag(e),o=this.getCurrLineNo(),a=this.readLine().trim();a!=n&&!this.eof();)a=this.readLine().trim();if(this.eof())r=null;else{var s=this.getCurrLineNo(),l=this.getCurrLineNo();for(a=this.readLine().trim();a!=i&&!this.eof();)l=this.getCurrLineNo(),a=this.readLine().trim();if(a==i)var u=this.getLines().slice(s,l);else u=this.getLines().slice(s);r=new d.IO.Mdl3kTextBuffer(u)}return t&&this.setCurrLineNo(o),r}}),d.IO.Mdl3kBlockReader=Class.create(d.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.Mdl3kBlockReader",createTextBuffer:function(){return new d.IO.Mdl3kTextBuffer},doReadBlock:function(e,t){var r,n=!(e instanceof d.IO.Mdl3kTextBuffer);n?(r=new d.IO.Mdl3kTextBuffer).setLines(e.getUnreadLines()):r=e;var i=r.getCurrLineNo(),o=this.doRead3kBlock(r,t),a=r.getCurrLineNo();if(n){var s=a-i;e.incCurrLineNo(s)}return o},doRead3kBlock:function(e,t){}}),d.IO.Mdl3kBlockWriter=Class.create(d.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl3kBlockWriter",createTextBuffer:function(){return new d.IO.Mdl3kTextBuffer},writeStartTag:function(e,t){t.writeLine(d.IO.Mdl3kUtils.get3kBlockStartTag(e))},writeEndTag:function(e,t){t.writeLine(d.IO.Mdl3kUtils.get3kBlockEndTag(e))},doWriteBlock:function(e,t){var r,n=!(t instanceof d.IO.Mdl3kTextBuffer);n?((r=new d.IO.Mdl3kTextBuffer).setLines(t.getUnreadLines()),r.reset()):r=t;var i=this.doWrite3kBlock(e,r);return n&&t.appendLines(n.getLines()),i},doWrite3kBlock:function(e,t){}}),d.IO.Mdl3kCTabReader=Class.create(d.IO.Mdl3kBlockReader,{CLASS_NAME:"Kekule.IO.Mdl3kCTabReader",doRead3kBlock:function(e,t){var r=e.getBlockBuffer("CTAB");return r||(r=e).reset(),this.analysisCTab(r)},analysisCTab:function(e){var t={},r=e.readLine(),n=this.analysisCountLine(r);if(!n)return null;var i,o,a=[],s=e.getBlockBuffer("ATOM");if(!s)return d.raise(d.$L("ErrorMsg.MDL3000_ATOMBLOCK_NOT_FOUND")),null;i=this.analysisAtomBlock(s,a);var l,u=e.getBlockBuffer("BOND");u&&(o=this.analysisBondBlock(u,a));var c=e.getBlockBuffer("SGROUP");return c&&(l=this.analysisSGroupBlock(c,a)),t.countInfo=n,t.atomInfos=i,t.atomIndexMap=a,o&&(t.bondInfos=o),l&&(t.sgInfos=l),t},analysisCountLine:function(e){var t={},r=d.IO.Mdl3kValueUtils.splitValues(e);if("COUNTS"==r.shift().value){var n=r.shift().value;return t.atomCount=parseInt(n,10),n=r.shift().value,t.bondCount=parseInt(n,10),n=r.shift().value,t.sgroupCount=parseInt(n,10),n=r.shift().value,t.isChiral=0!=parseInt(n,10),t}d.raise(d.$L("ErrorMsg.MALFORMED_MDL3000_COUNTLINE"))},analysisAtomBlock:function(e,t){for(var r=d.CoordMode.COORD2D,n=[];!e.eof();){var i=e.readLine(),o=this.analysisAtomLine(i),a=n.push(o)-1;t[o.index]=a,o.z&&(r=d.CoordMode.COORD3D)}return n.coordMode=r,n.isCoord3D=r==d.CoordMode.COORD3D,n},analysisAtomLine:function(e,t){var r={},n=d.IO.Mdl3kValueUtils.splitValues(e);r.index=parseInt(n.shift().value,10);var i=n.shift().value.trim();if(d.IO.Mdl3kUtils.isAtomList(i)){var o=d.IO.Mdl3kUtils.analysisAtomList(i);o&&(r.atomListInfo=o,r.symbol="L")}else r.symbol=i;r.x=parseFloat(n.shift().value),r.y=parseFloat(n.shift().value),r.z=parseFloat(n.shift().value),n.shift();for(var a=0,s=n.length;a<s;++a){var l=n[a],u=l.key,c=l.value;switch(u){case"CHG":(h=parseInt(c,10))&&(r.charge=h);break;case"RAD":(h=parseInt(c,10))&&(r.radical=h);break;case"CFG":(h=parseInt(c,10))&&(r.parity=h);break;case"MASS":r.massNumber=parseFloat(c);break;case"VAL":break;case"HCOUNT":(h=parseInt(c,10))&&(r.hydrongenCount=-1==h?0:h-1);break;case"RGROUPS":var h;(h=parseInt(c,10))&&(r.rgroupCount=h)}}return r},analysisBondBlock:function(e,t){for(var r=[];!e.eof();){var n=e.readLine(),i=this.analysisBondLine(n,t);r[i.index]=i}return r},analysisBondLine:function(e,t){var r={},n=d.IO.Mdl3kValueUtils.splitValues(e);r.index=parseInt(n.shift().value,10);var i=n.shift().value;r.order=d.IO.MdlUtils.bondTypeToKekuleOrder(parseInt(i,10)),r.atomIndex1=t[parseInt(n.shift().value,10)],r.atomIndex2=t[parseInt(n.shift().value,10)];for(var o=0,a=n.length;o<a;++o){var s=n[o].key,l=n[o].value;switch(s){case"CFG":var u=parseInt(l,10);r.stereo=d.IO.Mdl3kUtils.bondCfgToKekule(u);break;case"ENDPTS":if(d.ArrayUtils.isArray(l)){r.endAtomIndexes=[];for(var c=0,h=l.length;c<h;++c)r.endAtomIndexes.push(t[parseInt(l[c],10)])}else r.endAtomIndexes=[t[parseInt(l,10)]]}}return r},analysisSGroupBlock:function(e,t){var r=[],n=null,i=e.getCurrLineNo(),o=e.readLine();for("DEFAULT"==d.IO.Mdl3kValueUtils.splitValues(o).shift().value?n=this.fetchSGroupOptionalValues(o,t):e.setCurrLineNo(i);!e.eof();){o=e.readLine();var a=this.analysisSGroupLine(o,t,n);r[a.index]=a}return r},analysisSGroupLine:function(e,t,r){var n={},i=d.IO.Mdl3kValueUtils.splitValues(e);n.index=parseInt(i.shift().value,10),n.sgType=i.shift().value.trim(),n.extIndex=parseInt(i.shift().value,10);var o=this.fetchSGroupOptionalValues(i,t);return r&&(o=Object.extend(r,o)),Object.extend(n,o)},fetchSGroupOptionalValues:function(e,t){for(var r={},n=0,i=e.length;n<i;++n){var o=e[n].key,a=e[n].value;switch(o){case"ATOMS":r.atomIndexes=[];for(var s=0,l=a.length;s<l;s++)r.atomIndexes.push(t[a[s]]);break;case"XBONDS":r.crossBondIndexes=[].concat(a);break;case"SUBTYPE":r.subType=a;break;case"LABEL":r.label=a;break;case"CSTATE":r.bondVectors||(r.bondVectors=[]);var d=parseInt(a.shift(),10),u=parseFloat(a.shift())||0,c=parseFloat(a.shift())||0,h=parseFloat(a.shift())||0;r.bondVectors[d]={bondIndex:d,x:u,y:c,z:h};break;case"CLASS":r.sgClass=a}}return r}}),d.IO.Mdl3kCTabWriter=Class.create(d.IO.Mdl3kBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl3kCTabWriter",initialize:function(e){this.tryApplySuper("initialize"),this.setCoordMode(e||d.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,deaultValue:d.CoordMode.UNKNOWN})},doWrite3kBlock:function(e,t){return d.IO.MdlUtils.assertIlegalForCtabOutput(e),this.outputCtab(e,t)},outputCtab:function(e,t){var r=d.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(e);this.writeStartTag("CTAB",t),this.getCoordMode()!=d.CoordMode.UNKNOWN&&(r.coordMode=this.getCoordMode()),t.writeLine(this.generateCountLine(r)),this.outputAtomBlock(e,r,t),this.outputBondBlock(e,r,t),this.outputSgroupBlock(e,r,t),this.writeEndTag("CTAB",t)},generateCompatibilityCountLine:function(e){return d.IO.MdlStructureUtils.generateClassicStyleCountLine(e,d.IO.MdlVersion.V3000)},generateCountLine:function(e){var t=["COUNTS"];return t.push(e.atoms.length),t.push(e.bonds.length),t.push(e.subGroups.length),t.push(0),t.push(0),d.IO.Mdl3kValueUtils.mergeValues(t)},outputAtomBlock:function(e,t,r){this.writeStartTag("ATOM",r);for(var n=0,i=t.atoms.length;n<i;++n){var o=t.atoms[n],a=this.generateAtomLine(n,t.coordMode,o);r.writeLine(a)}this.writeEndTag("ATOM",r)},generateAtomLine:function(e,t,r){var n=d.IO.Mdl3kUtils.coordToStr,i=[e+1,d.IO.MdlStructureUtils.getAtomTypeStr(r)];if(t==d.CoordMode.COORD2D){var o=r.getAbsCoord2D();i=i.concat([n(o.x),n(o.y),n(0)])}else o=r.getAbsCoord3D(),i=i.concat([n(o.x),n(o.y),n(o.z)]);return i.push(0),r.getCharge&&r.getCharge()&&i.push({key:"CHG",value:r.getCharge()}),r.getRadical&&r.getRadical()&&i.push({key:"RAD",value:r.getRadical()}),r.getParity&&r.getParity()&&i.push({key:"CFG",value:r.getParity()}),r.getMassNumber&&r.getMassNumber()&&i.push({key:"MASS",value:r.getMassNumber()}),r.getExplicitHydrogenCount&&!d.ObjUtils.isUnset(r.getExplicitHydrogenCount())&&i.push({key:"HCOUNT",value:r.getExplicitHydrogenCount()+1}),d.IO.Mdl3kValueUtils.mergeValues(i)},outputBondBlock:function(e,t,r){if(!(t.bonds.length<=0)){this.writeStartTag("BOND",r);for(var n=0,i=t.bonds.length;n<i;++n){var o=t.bonds[n],a=this.generateBondLine(n,o,t.atoms);r.writeLine(a)}this.writeEndTag("BOND",r)}},generateBondLine:function(e,t,r){var n,i=[e+1,d.IO.MdlUtils.kekuleBondOrderToMdlType(t.getBondOrder?t.getBondOrder():d.BondOrder.UNSET)],o=t.getStereo&&t.getStereo()?d.IO.Mdl3kUtils.bondStereoToMdlCfg(t.getStereo(),!0):{},a=[],s=d.IO.MdlStructureUtils.splitConnectedNodes(t),l=r.indexOf(s.primaryNodes[0])+1,u=r.indexOf(s.primaryNodes[1])+1;if(n=o.inverted?[u,l]:[l,u],s.remainNodes&&s.remainNodes.length)for(var c=0,h=s.remainNodes.length;c<h;++c)a.push(r.indexOf(s.remainNodes[c])+1);return i=i.concat(n),o&&o.cfg&&i.push({key:"CFG",value:o.cfg}),a.length>0&&(i.push({key:"ENDPTS",value:a}),i.push({key:"ATTACH",value:"ALL"})),d.IO.Mdl3kValueUtils.mergeValues(i)},outputSgroupBlock:function(e,t,r){if(!(t.subGroups.length<=0)){this.writeStartTag("SGROUP",r);for(var n=0,i=t.subGroups.length;n<i;++n){var o=this.generateSgroupLine(n,t.subGroups[n],t);r.writeLine(o)}this.writeEndTag("SGROUP",r)}},generateSgroupLine:function(e,t,r){for(var n=r.atoms,i=r.bonds,o=[e+1,"SUP",e+1],a=[],s=0,l=(f=t.getLeafNodes()).length;s<l;++s)(e=n.indexOf(f[s]))>=0&&a.push(e+1);a=a.sort(),o.push({key:"ATOMS",value:a});var u=t.getAbbr&&t.getAbbr()||t.getFormulaText&&t.getFormulaText()||t.getName&&t.getName();u&&o.push({key:"LABEL",value:u});var c=t.getCrossConnectors(),h=[],p=[],g=d.IO.Mdl3kUtils.coordToStr;for(s=0,l=c.length;s<l;++s)if((e=i.indexOf(c[s]))>=0){h.push(e+1);var f,m=[e+1],C={};2==(f=d.IO.MdlStructureUtils.splitConnectedNodes(c[s]).primaryNodes).length&&(r.coordMode==d.CoordMode.COORD2D?(C=d.CoordUtils.substract(f[0].getAbsCoord2D(),f[1].getAbsCoord2D()),m=m.concat([g(C.x),g(C.y),0])):(C=d.CoordUtils.substract(f[0].getAbsCoord3D(),f[1].getAbsCoord3D()),m=m.concat([g(C.x),g(C.y),g(C.z)]))),p.push(m)}for(h=h.sort(),o.push({key:"XBONDS",value:h}),s=0,l=p.length;s<l;++s)o.push({key:"CSTATE",value:p[s]});return d.IO.Mdl3kValueUtils.mergeValues(o)}}),d.globalOptions.add("IO.mdl",{mdlVersion:d.IO.MdlVersion.V2000,coordMode:d.CoordMode.UNKNOWN}),d.IO.MdlStructureFragmentReader=Class.create(d.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlStructureFragmentReader",initialize:function(e){this.tryApplySuper("initialize"),this.setCoordMode(e||d.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:d.CoordMode.UNKNOWN})},createFragment:function(e){},createCtabReader:function(e){return e==d.IO.MdlVersion.V3000?new d.IO.Mdl3kCTabReader:new d.IO.Mdl2kCTabReader},getCtabVersion:function(e){var t=e.getCurrLineNo(),r=e.readLine();return e.setCurrLineNo(t),"V3000"==r.substr(33,6).trim()?d.IO.MdlVersion.V3000:d.IO.MdlVersion.V2000},createStructureFromJson:function(e,t){var r=this.createFragment();return r&&d.IO.MdlStructureUtils.fillFragment(r,e,this.getCoordMode()),r},doReadBlock:function(e,t){var r=this.getCtabVersion(e);if(!r)return null;var n=this.createCtabReader(r).doReadBlock(e,t);return n.atomInfos.coordMode&&(this._forceCoordMode=n.atomInfos.coordMode),this.createStructureFromJson(n,t)}}),d.IO.MdlStructureFragmentWriter=Class.create(d.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlStructureFragmentWriter",initialize:function(e,t){this.tryApplySuper("initialize"),this.setMdlVersion(e||d.IO.MdlVersion.V2000),this.setCoordMode(t||d.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:d.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:d.CoordMode.UNKNOWN})},createCtabWriter:function(e){return e==d.IO.MdlVersion.V3000?new d.IO.Mdl3kCTabWriter(this.getCoordMode()):new d.IO.Mdl2kCTabWriter(this.getCoordMode())},doWriteBlock:function(e,t){var r=this.createCtabWriter(this.getMdlVersion()).writeBlock(e);t.writeText(r)}}),d.IO.Mdl3kMoleculeCTabReader=Class.create(d.IO.MdlStructureFragmentReader,{CLASS_NAME:"Kekule.IO.Mdl3kMoleculeCTabReader",createFragment:function(e){return new d.Molecule},doReadBlock:function(e,t){var r=this.createCtabReader(d.IO.MdlVersion.V3000).doReadBlock(e,t);return this.createStructureFromJson(r,t)}}),d.IO.Mdl3kMoleculeCTabWriter=Class.create(d.IO.MdlStructureFragmentWriter,{CLASS_NAME:"Kekule.IO.Mdl3kMoleculeCTabWriter",initialize:function(e){this.tryApplySuper("initialize",[d.IO.MdlVersion.V3000,e])},doWriteBlock:function(e,t){var r=new d.IO.Mdl3kCTabWriter(this.getCoordMode()).writeBlock(e);t.writeText(r)}}),d.IO.MdlMoleculeReader=Class.create(d.IO.MdlStructureFragmentReader,{CLASS_NAME:"Kekule.IO.MdlMoleculeReader",createFragment:function(e){return new d.Molecule},readHeaderInfo:function(e,t){var r={},n=e.readLine();n&&(r.name=n);var i=e.readLine(),o=this.readInfoLine(i);o&&(r=Object.extend(r,o));var a=e.readLine();return a&&(r.comment=a),r},readInfoLine:function(e){var t={};if(e.trim()){var r=e.substr(0,2).trim();r&&(t.userAbbr=r),(r=e.substr(2,8).trim())&&(t.programName=r),(r=e.substr(10,10)).trim()&&(t.date=d.IO.MdlUtils.analysisMdlDateTimeStr(r,!1)),r=e.substr(20,2),t.coordMode="3D"==r?d.CoordMode.COORD3D:"2D"==r?d.CoordMode.COORD2D:d.CoordMode.UNKNOWN}return t},doReadBlock:function(e,t){var r=this.readHeaderInfo(e,t);r&&void 0!==r.coordMode&&this.setCoordMode(r.coordMode);var n=this.tryApplySuper("doReadBlock",[e,t]);return n&&r&&(r.name&&n.setName(r.name),r.userAbbr&&n.setInfoValue("author",r.userAbbr),r.programName&&n.setInfoValue("generator",r.programName),r.date&&n.setInfoValue("date",r.date),r.comment&&n.setInfoValue("comment",r.comment)),e.eof()||"M  END"===e.getCurrLine().trim().toUpperCase()&&e.readLine(),n}}),d.IO.MdlMoleculeWriter=Class.create(d.IO.MdlStructureFragmentWriter,{CLASS_NAME:"Kekule.IO.MdlMoleculeWriter",writeHeaderInfo:function(e,t){t.writeLine(e.getName()||d.$L("Texts.UNNAMED")||"");var r=this.generateInfoLine(e);t.writeLine(r);var n=e.getInfoValue("comment");t.writeLine(n||"")},generateInfoLine:function(e){var t="",r=e.getInfoValue("author");t+=r?r.toString().substr(0,2).rpad(2):"  ";var n=e.getInfoValue("generator");t+=n?n.toString().substr(0,8).rpad(8):d.LIBNAME_CORE.rpad(8);var i=e.getInfoValue("date")||new Date;return(t+=d.IO.MdlUtils.generateMdlDateTimeStr(i,!1))+(this.getCoordMode()==d.CoordMode.COORD3D?"3D":"2D")},getMolecule:function(e){return d.ChemStructureUtils.getTotalStructFragment(e)},doWriteBlock:function(e,t){var r=this.getMolecule(e);if(r){var n=d.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(r);this.setCoordMode(n.coordMode),this.writeHeaderInfo(r,t),this.getMdlVersion()==d.IO.MdlVersion.V3000&&t.writeLine(d.IO.MdlStructureUtils.generateClassicStyleCountLine(n,this.getMdlVersion())),this.tryApplySuper("doWriteBlock",[r,t]),this.getMdlVersion()==d.IO.MdlVersion.V3000&&t.writeLine("M  END")}}}),d.IO.MdlStructDataReader=Class.create(d.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlStructDataReader",DATA_HEAD_PREFIX:d.IO.MDL.SD_DATA_HEAD_PREFIX,DATA_DBFIELD_PATTERN:/\bDT(\d+)\b/,DATA_KEY_NAME_PATTERN:/\<(.+)\>/,MOL_DELIMITER:d.IO.MDL.MOL_DELIMITER,doReadBlock:function(e,t){var r=new d.IO.MdlMoleculeReader;try{for(var n,i,o,a=[];!e.eof();){try{o=r.doReadBlock(e,null)}catch(e){o=null}if(!o)break;for(a.push(o),n=null,i=null;!e.eof();){var s=this.analysisDataLine(e.readLine());if(s){var l=s.lineType;if("dataheader"===l)n=s.key;else if("datavalue"===l)n&&(i=s.value,o.setInfoValue(n,i));else if("moldelimiter"===l)break}}}if(a.length>1){for(var u=new d.ChemObjList,c=0,h=a.length;c<h;++c)u.append(a[c]);return u}return a[0]}finally{r.finalize()}},analysisDataLine:function(e){var t,r=e.trim();return r.startsWith(this.DATA_HEAD_PREFIX)?(t=this.getDataHeaderKey(e))?{lineType:"dataheader",key:t}:null:r.startsWith(this.MOL_DELIMITER)?{lineType:"moldelimiter"}:r?{lineType:"datavalue",value:e}:null},getDataHeaderKey:function(e){var t=this.DATA_KEY_NAME_PATTERN.exec(e);return t&&t.length>1||(t=this.DATA_DBFIELD_PATTERN.exec(e))&&t.length>1?t[1]:e},doReadDataBlock:function(e,t){e.readLine()}}),d.IO.MdlStructDataWriter=Class.create(d.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlStructDataWriter",IGNORED_INFO_FIELDS:["generator","author","date","comment"],initialize:function(e,t){this.tryApplySuper("initialize"),this.setMdlVersion(e||d.IO.MdlVersion.V2000),this.setCoordMode(t||d.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:d.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:d.CoordMode.UNKNOWN})},doWriteBlock:function(e,t){var r=this.getChildMols(e),n=new d.IO.MdlMoleculeWriter;n.setMdlVersion(this.getMdlVersion()),n.setCoordMode(this.getCoordMode());for(var i=0,o=r.length;i<o;++i){var a=r[i];try{var s=n.writeBlock(a);t.writeText(s);var l=this.getMolData(a);this.doWriteDataBlock(l,t),t.writeLine(d.IO.MDL.MOL_DELIMITER)}catch(e){}}},doWriteDataBlock:function(e,t){for(var r=d.ObjUtils.getOwnedFieldNames(e),n=0,i=r.length;n<i;++n){var o=r[n];if(this.IGNORED_INFO_FIELDS.indexOf(o)<0){var a=d.IO.MDL.SD_DATA_HEAD_PREFIX+" <"+o+">",s=e[o];a&&s&&(t.writeLine(a),t.writeLine(s),t.writeLine(""))}}},getChildMols:function(e){for(var t=d.ChemStructureUtils.getChildStructureObjs(e,!0),r=[],n=0,i=t.length;n<i;++n){var o=t[n];o instanceof d.StructureFragment&&r.push(o)}return r},getMolData:function(e){return e.getInfo?e.getInfo()||{}:null}}),d.IO.MdlBaseReactionReader=Class.create(d.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlBaseReactionReader",readHeaderBlock:function(e,t){var r,n={},i=e.readLine().trim();return"$RXN"!=(r=i.substr(0,4))?(d.error(d.$L("ErrorMsg.NOT_MDL_RXN_DATA")),null):(r=i.substr(4).trim(),n.version="V3000"==r?d.IO.MdlVersion.V3000:d.IO.MdlVersion.V2000,(i=e.readLine().trim())&&(n.name=i),(r=(i=e.readLine()).substr(0,6).trim())&&(n.userAbbr=r),(r=i.substr(6,9).trim())&&(n.programName=r),(r=i.substr(15,10)).trim()&&(n.date=d.IO.MdlUtils.analysisMdlDateTimeStr(r,!0)),(i=e.readLine().trim())&&(n.comment=i),n)},readSubstanceCountLine:function(e){},readMolBlock:function(e){},doReadBlock:function(e,t){for(var r=this.readHeaderBlock(e,null),n=this.readSubstanceCountLine(e.readLine()),i=new d.Reaction,o=0;o<n.reactantCount;++o)(a=this.readMolBlock(e))&&i.appendReactant(a);for(o=0;o<n.productCount;++o){var a;(a=this.readMolBlock(e))&&i.appendProduct(a)}return i&&r&&(r.name&&i.setName(r.name),r.userAbbr&&i.setInfoValue("author",r.userAbbr),r.programName&&i.setInfoValue("generator",r.programName),r.date&&i.setInfoValue("date",r.date),r.comment&&i.setInfoValue("comment",r.comment)),i}}),d.IO.Mdl2kReactionReader=Class.create(d.IO.MdlBaseReactionReader,{CLASS_NAME:"Kekule.IO.Mdl2kReactionReader",readHeaderBlock:function(e,t){var r=this.tryApplySuper("readHeaderBlock",[e,t]);return r.version!=d.IO.MdlVersion.V2000?(d.error(d.$L("ErrorMsg.NOT_MDL2000_RXN_DATA")),null):r},readSubstanceCountLine:function(e){var t={};return t.reactantCount=parseInt(e.substr(0,3),10)||0,t.productCount=parseInt(e.substr(3,3),10)||0,t},readMolBlock:function(e){for(var t=e.readLine();"$MOL"!==t&&!e.eof();)t=e.readLine();if(e.eof())return null;var r=[];for(t=e.getCurrLine();"$MOL"!==t&&!e.eof();)r.push(t),e.incCurrLineNo(),t=e.getCurrLine();return(new d.IO.MdlMoleculeReader).readBlock(r,null)}}),d.IO.Mdl3kReactionReader=Class.create(d.IO.MdlBaseReactionReader,{CLASS_NAME:"Kekule.IO.Mdl3kReactionReader",createTextBuffer:function(){return new d.IO.Mdl3kTextBuffer},readHeaderBlock:function(e,t){var r=this.tryApplySuper("readHeaderBlock",[e,t]);return r.version!=d.IO.MdlVersion.V3000?(d.error(d.$L("ErrorMsg.NOT_MDL3000_RXN_DATA")),null):r},readSubstanceCountLine:function(e){var t={},r=d.IO.Mdl3kValueUtils.splitValues(e);return"COUNTS"!=r.shift().value.trim()?(d.error(d.$L("ErrorMsg.NOT_MDL3000_RXN_COUNTLINE")),null):(t.reactantCount=parseInt(r.shift().value,10)||0,t.productCount=parseInt(r.shift().value,10)||0,t)},readMolBlock:function(e){if(e.getBlockBuffer){var t=e.getBlockBuffer("CTAB");return(new d.IO.Mdl3kMoleculeCTabReader).doReadBlock(t)}return null}}),d.IO.MdlReactionReader=Class.create(d.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlReactionReader",doReadBlock:function(e,t){return(d.IO.MdlUtils.getRxnMarkVersion(e.getCurrLine())==d.IO.MdlVersion.V3000?new d.IO.Mdl3kReactionReader:new d.IO.Mdl2kReactionReader).readBlock(e.getUnreadLines(),t)}}),d.IO.MdlReactionWriter=Class.create(d.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlReactionWriter",initialize:function(e,t){this.tryApplySuper("initialize"),this.setMdlVersion(e||d.IO.MdlVersion.V2000),this.setCoordMode(t||d.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:d.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:d.CoordMode.UNKNOWN})},writeHeaderBlock:function(e,t){var r;r="$RXN"+(this.getMdlVersion()==d.IO.MdlVersion.V3000?" "+d.IO.MDL.VER3000:""),t.writeLine(r),t.writeLine(e.getName()||""),r=(e.getInfoValue("author")||"").substr(0,6).rpad(6),r+=(e.getInfoValue("generator")||"").substr(0,9).rpad(9);var n=e.getInfoValue("date")||new Date;r+=d.IO.MdlUtils.generateMdlDateTimeStr(n,!0),t.writeLine(r);var i=e.getInfoValue("comment")||"";t.writeLine(i)},generateSubstanceCountLine:function(e){return this.getMdlVersion()==d.IO.MdlVersion.V3000?"M  V30 COUNTS "+d.IO.Mdl3kValueUtils.mergeValues([e.getReactantCount(),e.getProductCount()]):e.getReactantCount().toString().lpad(3)+e.getProductCount().toString().lpad(3)},writeMolDelimiterLine:function(e){this.getMdlVersion()==d.IO.MdlVersion.V2000&&e.writeLine("$MOL")},writeMolBlock:function(e,t){var r=(this.getMdlVersion()==d.IO.MdlVersion.V3000?new d.IO.Mdl3kMoleculeCTabWriter(this.getCoordMode()):new d.IO.MdlMoleculeWriter(this.getMdlVersion(),this.getCoordMode())).writeBlock(e);t.writeText(r)},doWriteBlock:function(e,t){var r=this.getMdlVersion()==d.IO.MdlVersion.V3000;this.writeHeaderBlock(e,t);var n=this.generateSubstanceCountLine(e);t.writeLine(n),r&&t.writeLine("M  V30 "+d.IO.Mdl3kUtils.get3kBlockStartTag("REACTANT"));for(var i=0;i<e.getReactantCount();++i)this.writeMolDelimiterLine(t),this.writeMolBlock(e.getReactantAt(i),t);for(r&&t.writeLine("M  V30 "+d.IO.Mdl3kUtils.get3kBlockEndTag("REACTANT")),r&&t.writeLine("M  V30 "+d.IO.Mdl3kUtils.get3kBlockStartTag("PRODUCT")),i=0;i<e.getProductCount();++i)this.writeMolDelimiterLine(t),this.writeMolBlock(e.getProductAt(i),t);r&&(t.writeLine("M  V30 "+d.IO.Mdl3kUtils.get3kBlockEndTag("PRODUCT")),t.writeLine("M  END"))}}),d.IO.BaseMdlReader=Class.create(d.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.BaseMdlReader",doReadData:function(e,t,r){return t!=d.IO.ChemDataType.TEXT?(d.error(d.$L("ErrorMsg.MDL_INPUT_DATATYPE_NOT_TEXT")),null):this.doReadMdlData(e)},doReadMdlData:function(e){return null}}),d.IO.BaseMdlWriter=Class.create(d.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.BaseMdlWriter",initialize:function(e){this.tryApplySuper("initialize",[e]),e||(e={}),this.setMdlVersion(e.mdlVersion||d.globalOptions.IO.mdl.mdlVersion),this.setCoordMode(e.coordMode||d.globalOptions.IO.mdl.coordMode)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:d.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:d.CoordMode.UNKNOWN})},doWriteData:function(e,t,r){var n=t||d.IO.ChemDataType.TEXT;return n!=d.IO.ChemDataType.TEXT?(d.error(d.$L("ErrorMsg.MDL_OUTPUT_DATATYPE_NOT_TEXT")),null):this.tryApplySuper("doWriteData",[e,n,r])}}),d.IO.MdlMolReader=Class.create(d.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlMolReader",doReadMdlData:function(e){return(new d.IO.MdlMoleculeReader).readBlock(e,null)}}),d.IO.MdlMolWriter=Class.create(d.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlMolWriter",doWriteData:function(e,t,r){return new d.IO.MdlMoleculeWriter(this.getMdlVersion(),this.getCoordMode()).writeBlock(e)}}),d.IO.MdlSdReader=Class.create(d.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlSdReader",doReadMdlData:function(e){return(new d.IO.MdlStructDataReader).readBlock(e,null)}}),d.IO.MdlSdWriter=Class.create(d.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlSdWriter",doWriteData:function(e,t,r){return new d.IO.MdlStructDataWriter(this.getMdlVersion(),this.getCoordMode()).writeBlock(e)}}),d.IO.MdlRxnReader=Class.create(d.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlRxnReader",doReadMdlData:function(e){return(new d.IO.MdlReactionReader).readBlock(e,null)}}),d.IO.MdlRxnWriter=Class.create(d.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlRxnWriter",doWriteData:function(e,t,r){return new d.IO.MdlReactionWriter(this.getMdlVersion(),this.getCoordMode()).writeBlock(e)}}),d.IO.MdlReader=Class.create(d.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.MdlReader",doReadData:function(e,t,r){return t!=d.IO.ChemDataType.TEXT?(d.error(d.$L("ErrorMsg.MDL_INPUT_DATATYPE_NOT_TEXT")),null):("$RXN"==e.substr(0,4)?new d.IO.MdlReactionReader:new d.IO.MdlMoleculeReader).readBlock(e,null)}}),d.IO.MdlWriter=Class.create(d.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.MdlWriter",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=e||{};this.setMdlVersion(t.mdlVersion||d.globalOptions.IO.mdl.mdlVersion),this.setCoordMode(t.coordMode||d.globalOptions.IO.mdl.coordMode)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:d.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:d.CoordMode.UNKNOWN})},doWriteData:function(e,t,r){var n;if(e instanceof d.Reaction)n=new d.IO.MdlRxnWriter(this.getMdlVersion(),this.getCoordMode());else{if(!(e instanceof d.StructureFragment)){var i=e&&e.getClassName?e.getClassName():typeof e;return d.error(d.$L("ErrorMsg.UNABLE_TO_OUTPUT_AS_MDL").format(i)),null}n=new d.IO.MdlMolWriter(this.getMdlVersion(),this.getCoordMode())}if(n)return n.writeData(e)}}),function(){d.IO.DataFormat.MOL="mol",d.IO.DataFormat.RXN="rxn",d.IO.DataFormat.SD="sd",d.IO.DataFormat.MOL3K="mol3k",d.IO.DataFormat.RXN3K="rxn3k",d.IO.MimeType.MDL_MOL="chemical/x-mdl-molfile",d.IO.MimeType.MDL_RXN="chemical/x-mdl-rxnfile",d.IO.MimeType.MDL_SD="chemical/x-mdl-sdfile",d.IO.DataFormatsManager.register("mol",d.IO.MimeType.MDL_MOL,"mol",d.IO.ChemDataType.TEXT,"MDL Mol 2000 format"),d.IO.DataFormatsManager.register("rxn",d.IO.MimeType.MDL_RXN,"rxn",d.IO.ChemDataType.TEXT,"MDL Reaction 2000 format"),d.IO.DataFormatsManager.register("sd",d.IO.MimeType.MDL_SD,["sd","sdf"],d.IO.ChemDataType.TEXT,"MDL Structure-Data format"),d.IO.DataFormatsManager.register("mol3k",d.IO.MimeType.MDL_MOL,"mol",d.IO.ChemDataType.TEXT,"MDL Mol 3000 format"),d.IO.DataFormatsManager.register("rxn3k",d.IO.MimeType.MDL_RXN,"rxn",d.IO.ChemDataType.TEXT,"MDL Reaction 3000 format"),d.IO.ChemDataReaderManager.register("MDL-mol",d.IO.MdlMolReader,["mol","mol3k"]),d.IO.ChemDataReaderManager.register("MDL-rxn",d.IO.MdlRxnReader,["rxn","rxn3k"]),d.IO.ChemDataReaderManager.register("MDL-general",d.IO.MdlReader,["mol","mol3k","rxn","rxn3k"]),d.IO.ChemDataReaderManager.register("MDL-sd",d.IO.MdlSdReader,"sd");var e=[d.StructureFragment,d.ChemObjList,d.ChemStructureObjectGroup,d.ChemSpaceElement,d.ChemSpace];d.IO.ChemDataWriterManager.register("MDL-mol",d.IO.MdlMolWriter,e,"mol"),d.IO.ChemDataWriterManager.register("MDL-mol3k",d.IO.MdlMolWriter,e,"mol3k",{createOptions:{mdlVersion:d.IO.MdlVersion.V3000}}),d.IO.ChemDataWriterManager.register("MDL-rxn",d.IO.MdlRxnWriter,[d.Reaction],"rxn"),d.IO.ChemDataWriterManager.register("MDL-rxn3k",d.IO.MdlRxnWriter,[d.Reaction],"rxn3k"),d.IO.ChemDataWriterManager.register("MDL-sd",d.IO.MdlSdWriter,e,"sd")}(),function(){"use strict";var e=d.ArrayUtils;d.IO.SMILES={ATOM_BRACKET_LEFT:"[",ATOM_BRACKET_RIGHT:"]",ATOM_WILDCARD:"*",ATOM_H:"H",ORGAN_SUBSET_ATOMS:["B","C","N","O","S","P","F","Cl","Br","I"],AROMATIC_SUBSET_ATOMS:["B","C","N","O","S","P"],BOND_SINGLE:"-",BOND_DOUBLE:"=",BOND_TRIPLE:"#",BOND_QUAD:"$",BOND_AROMATIC:":",BOND_FAKE:".",RING_BOND_TWO_DIGIT_NO_PREFIX:"%",BRANCH_BRACKET_LEFT:"(",BRANCH_BRACKET_RIGHT:")",ROTATION_DIR_CLOCKWISE:"@@",ROTATION_DIR_ANTICLOCKWISE:"@",DIRECTION_BOND_SYMBOLS:["/","\\"]};var t=d.IO.SMILES;d.IO.SmilesUtils={createGraphDepthSpanningTreesEx:function(t,r){for(var n=function e(t){var r={vertexes:[],edges:[],longestPath:{vertexes:[],edges:[],length:0}},n=t;n.getData("__$visitedEx__")||(r.vertexes.push(n),n.setData("__$visitedEx__",!0));for(var i,o=n.getEdges(),a=0,s=o.length;a<s;++a){var l=o[a],d=n.getNeighborOnEdge(l);if(!d.getData("__$visitedEx__")){r.vertexes.push(d),r.edges.push(l),d.setData("__$visitedEx__",!0);var u=e(d);r.vertexes=r.vertexes.concat(u.vertexes),r.edges=r.edges.concat(u.edges),(u.longestPath.length>r.longestPath.length||!r.longestPath.length)&&(r.longestPath.vertexes=u.longestPath.vertexes,r.longestPath.edges=u.longestPath.edges,r.longestPath.length=u.longestPath.length,i=l)}}return i&&(r.longestPath.edges.unshift(i),r.longestPath.length=(r.longestPath.length||0)+1),r.longestPath.vertexes.unshift(n),r},i=e.clone(t.getVertexes()),o=0,a=i.length;o<a;++o)i[o].setData("__$visitedEx__",!1);for(var s=[];i.length;){var l={vertexes:[],edges:[],longestPath:{vertexes:[],edges:[],length:0}},d=n(r&&i.indexOf(r)>=0?r:i[0]);l.vertexes=l.vertexes.concat(d.vertexes),l.edges=l.edges.concat(d.edges),l.longestPath.length=(l.longestPath.length||0)+d.longestPath.length,l.longestPath.vertexes=l.longestPath.vertexes.concat(d.longestPath.vertexes),l.longestPath.edges=l.longestPath.edges.concat(d.longestPath.edges),i=e.exclude(i,d.vertexes),s.push(l)}return s}},d.IO.SmilesMolWriter=Class.create(d.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.SmilesMolWriter",doWriteData:function(e,t,r,n){var i=this.getMolecule(e);return i?this.writeStructFragment(i,n):""},getMolecule:function(e){return d.ChemStructureUtils.getTotalStructFragment(e)},writeStructFragment:function(r,n){if(r.hasCtab()&&!r.isEmpty()){var i=r.clone();i.standardize&&i.standardize();var o=[],a=[];if(i.getAromaticRings)for(var s=i.getAromaticRings(),l=0,u=s.length;l<u;++l){var c=s[l];e.pushUnique(o,c.nodes),e.pushUnique(a,c.connectors)}var h,p=d.GraphAdaptUtils.ctabToGraph(i.getCtab(),null,{expandSubStructures:!0,ignoreBondedHydrogen:!0}),g=p.getVertexes(),f=(p.getEdges(),g[g.length-1]),m=d.IO.SmilesUtils.createGraphDepthSpanningTreesEx(p,f),C=this._prepareStereoBondsInformation(i.getCtab(),n),y=[];for(l=0,u=m.length;l<u;++l){var _,E=m[l],T=E.longestPath,O=T.vertexes[0];_=this._writeMolVertex(O,null,T.edges,E.edges,y,o,a,{bondStereoDirMap:C},n),0===l?h=_:h+=t.BOND_FAKE+_}return h}return""},_prepareStereoBondsInformation:function(e,t){var r=t.ignoreStereoBond;if(d.ObjUtils.isUnset(r)&&(r=t.ignoreStereo||!1),r)return null;for(var n=0,i=new d.MapEx,o=0,a=e.getConnectorCount();o<a;++o){var s=e.getConnectorAt(o);if(s.getParity&&s.getParity()){++n;for(var l=d.MolStereoUtils.getStereoBondKeyNeighborConnectors(s),u=this._getStereoDoubleBondInitialDirectionSymbols(s),c=[],h=0,p=0,g=l.length;p<g;++p)i.has(l[p])&&(c[p]=!0,u[p]!==i.get(l[p])&&++h);if(h<2)for(p=0,g=l.length;p<g;++p)if(!c[p]){var f=1===h?this._getInvertBondDirectionSymbol(u[p]):u[p];i.set(l[p],f)}}}return n?i:null},_writeMolVertex:function(e,r,n,i,o,a,s,l,u){var c,h,p=e.getData("object"),g=e.getEdges(),f=[],m=[],C=[],y=[],_=u.ignoreStereoBond;d.ObjUtils.isUnset(_)&&(_=u.ignoreStereo||!1);for(var E=g.length-1;E>=0;--E){var T=g[E];if(T!==r){var O=T.getData("object");if(i.indexOf(T)>=0){var v=e.getNeighborOnEdge(T),S=this._writeMolVertex(v,T,n,i,o,a,s,l,u);n.indexOf(T)>=0?(h=v,c=S):(m.push(v),f.push(S))}else{var b=o.indexOf(T);b<0&&(b=o.length,o.push(T)),y.push(e.getNeighborOnEdge(T));var A=this._outputConnectorStr(O,T.getVertexes()[0].getData("object"),T.getVertexes()[1].getData("object"),a,s,l.bondStereoDirMap);A+=(b+=1)<10?b:t.RING_BOND_TWO_DIGIT_NO_PREFIX+b,C.push(A)}}}var I,R="";if(r){I=e.getNeighborOnEdge(r).getData("object");var D=r.getData("object");R+=this._outputConnectorStr(D,r.getVertexes()[0].getData("object"),r.getVertexes()[1].getData("object"),a,s,l.bondStereoDirMap)}for(var N=[],P=(E=0,y.length);E<P;++E)N.push(y[E].getData("object"));for(E=0,P=m.length;E<P;++E)N.push(m[E].getData("object"));for(h&&N.push(h.getData("object")),R+=this._outputNodeStr(p,a.indexOf(p)>=0,I,N,u),E=0,P=C.length;E<P;++E)R+=C[E];for(!c&&f.length&&(c=f.shift()),E=0,P=f.length;E<P;++E)R+=t.BRANCH_BRACKET_LEFT+f[E]+t.BRANCH_BRACKET_RIGHT;return R+="",c&&(R+=c),R},_outputNodeStr:function(e,r,n,i,o){var a,s;e instanceof d.Atom?(a=s=e.getSymbol(),r&&(a=a.toLowerCase())):a=t.ATOM_WILDCARD;var l=o.ignoreStereoAtom;if(d.ObjUtils.isUnset(l)&&(l=o.ignoreStereo||!1),!l&&e.getParity&&e.getParity()&&i&&i.length){var u=e.getLinkedHydrogenAtomsWithSingleBond();u&&1===u.length&&i.indexOf(u[0])<0&&i.push(u[0]);var c=e.getHydrogenCount&&e.getHydrogenCount(!1)||0;if(u.length&&c)p="";else var h=d.MolStereoUtils.calcTetrahedronChiralCenterRotationDirection(null,e,n,i,!!c,!1,{allowExplicitVerticalHydrogen:!0}),p=h===d.RotationDir.CLOCKWISE?t.ROTATION_DIR_CLOCKWISE:h===d.RotationDir.ANTICLOCKWISE?t.ROTATION_DIR_ANTICLOCKWISE:"";p&&(a+=p)}var g=this._getNodeHydrogenCount(e,o),f=!0,m=e.getRadical?Math.round(e.getRadical()||0):0;if(p);else if(m);else if(e instanceof d.Atom)if(g&&r&&"C"!==s);else if((o.ignoreExplicitHydrogens||o.ignoreImplicitHydrogens)&&g!==this._getNodeHydrogenCount(e,{}));else{var C=e.getValence&&e.getValence()||0,y=d.ValenceUtils.getMaxPossibleValence(e.getAtomicNumber(),e.getCharge())||0;C&&(C>y&&g||(e.hasExplicitHydrogens()?(e.getExplicitHydrogenCount()||0)===(e.getImplicitHydrogenCount()||0)&&(f=!1):(e.getValence&&e.getValence({ignoreExplicitHydrogens:!0,ignoreBondHydrogens:!0})||0)<C||(f=!1)))}f&&((c=Math.round(g))>0&&(a+=t.ATOM_H),c>1&&(a+=c));var _=Math.round(e.getCharge());if(_){var E=_>0?"+":"-";(_>1||_<-1)&&(E=Math.abs(_)+E),a+=E}var T=e.getMassNumber?e.getMassNumber():null;T&&(a=Math.abs(T)+a);var O=!1;return f||_||T||p||m||(!r&&t.ORGAN_SUBSET_ATOMS.indexOf(s)>=0||r&&t.AROMATIC_SUBSET_ATOMS.indexOf(s)>=0)&&(O=!0),O||(a=t.ATOM_BRACKET_LEFT+a+t.ATOM_BRACKET_RIGHT),a},_getNodeHydrogenCount:function(e,t){var r=e.getLinkedHydrogenAtomsWithSingleBondCount&&e.getLinkedHydrogenAtomsWithSingleBondCount(!0)||0,n=e.getExplicitHydrogenCount&&e.getExplicitHydrogenCount();return t.ignoreExplicitHydrogens||(r+=n||0),d.ObjUtils.isUnset(n)&&!t.ignoreImplicitHydrogens&&(r+=e.getImplicitHydrogenCount&&e.getImplicitHydrogenCount()||0),r},_outputConnectorStr:function(e,r,n,i,o,a){if(e instanceof d.Bond&&e.getBondType()===d.BondType.COVALENT){if(o.indexOf(e)>=0)return"";var s=i.indexOf(r)>=0&&i.indexOf(n)>=0,l=e.getBondOrder(),u=d.BondOrder,c=l===u.DOUBLE?t.BOND_DOUBLE:l===u.TRIPLE?t.BOND_TRIPLE:l===u.QUAD?t.BOND_QUAD:s?t.BOND_SINGLE:"";return a&&a.has(e)&&(c+=a.get(e)),c}return t.BOND_FAKE},_getStereoDoubleBondInitialDirectionSymbols:function(e){var r=e.getParity();return r?r===d.StereoParity.EVEN?[t.DIRECTION_BOND_SYMBOLS[0],t.DIRECTION_BOND_SYMBOLS[0]]:[t.DIRECTION_BOND_SYMBOLS[0],t.DIRECTION_BOND_SYMBOLS[1]]:["",""]},_getInvertBondDirectionSymbol:function(e){return e===t.DIRECTION_BOND_SYMBOLS[1]?t.DIRECTION_BOND_SYMBOLS[0]:t.DIRECTION_BOND_SYMBOLS[1]}}),d.IO.MimeType.SMILES="chemical/x-daylight-smiles",d.IO.DataFormat.SMILES="smi",d.IO.DataFormatsManager.register(d.IO.DataFormat.SMILES,d.IO.MimeType.SMILES,["smi","smiles"],d.IO.ChemDataType.TEXT,"SMILES format");var r=[d.StructureFragment,d.ChemObjList,d.ChemStructureObjectGroup,d.ChemSpaceElement,d.ChemSpace];d.IO.ChemDataWriterManager.register("SMILES",d.IO.SmilesMolWriter,r,[d.IO.DataFormat.SMILES])}(),d.globalOptions.add("IO.kekuleNative",{prettyPrint:!0}),d.IO.KcjReader=Class.create(d.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.KcjReader",readData:function(e,t){var r,n=t||d.IO.ChemDataType.TEXT;return n==d.IO.ChemDataType.JSON&&(r=e),n!=d.IO.ChemDataType.TEXT?(d.error(d.$L("ErrorMsg.KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT")),null):(r=DataType.JsonUtility.parse(e),this.tryApplySuper("readData",[r,d.IO.ChemDataType.JSON]))},doReadData:function(e,t){var r=Class.ObjSerializerFactory.getSerializer("json");return r?r.load(null,e):(d.error(d.$L("ErrorMsg.JSON_SERIALIZER_NOT_EXISTS")),null)}}),d.IO.KcjWriter=Class.create(d.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.KcjWriter",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=e||{};this.setPrettyPrint(d.ObjUtils.isUnset(t.prettyPrint)?d.globalOptions.IO.kekuleNative.prettyPrint:t.prettyPrint)},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:!0})},writeData:function(e,t,r,n){var i=t||d.IO.ChemDataType.TEXT;if(i!=d.IO.ChemDataType.JSON&&i!=d.IO.ChemDataType.TEXT)return d.error(d.$L("ErrorMsg.KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT")),null;var o=this.tryApplySuper("writeData",[e,d.IO.ChemDataType.JSON]);if(i==d.IO.ChemDataType.JSON)return o;if(i==d.IO.ChemDataType.TEXT){var a=n&&d.ObjUtils.notUnset(n.prettyPrint)?n.prettyPrint:this.getPrettyPrint();return DataType.JsonUtility.serializeToStr(o,{prettyPrint:a})}},doWriteData:function(e,t,r,n){var i=Class.ObjSerializerFactory.getSerializer("json");if(!i)return d.error(d.$L("ErrorMsg.JSON_SERIALIZER_NOT_EXISTS")),null;var o={};return i.save(e,o),o}}),d.IO.KcxReader=Class.create(d.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.KcxReader",readData:function(e,t){var r,n=t||d.IO.ChemDataType.TEXT;return n==d.IO.ChemDataType.DOM&&(r=e),n!=d.IO.ChemDataType.TEXT?(d.error(d.$L("ErrorMsg.KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT")),null):(r=DataType.XmlUtility.parse(e).documentElement,this.tryApplySuper("readData",[r,d.IO.ChemDataType.DOM]))},doReadData:function(e,t){var r=Class.ObjSerializerFactory.getSerializer("xml");return r?r.load(null,e):(d.error(d.$L("ErrorMsg.XML_SERIALIZER_NOT_EXISTS")),null)}}),d.IO.KcxWriter=Class.create(d.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.KcxWriter",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=e||{};this.setPrettyPrint(d.ObjUtils.isUnset(t.prettyPrint)?d.globalOptions.IO.kekuleNative.prettyPrint:t.prettyPrint),this.setRootTag(t.rootTag||"kcx")},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:!0}),this.defineProp("rootTag",{dataType:DataType.STRING})},writeData:function(e,t){var r=t||d.IO.ChemDataType.TEXT;if(r!=d.IO.ChemDataType.DOM&&r!=d.IO.ChemDataType.TEXT)return d.error(d.$L("ErrorMsg.KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT")),null;var n=this.tryApplySuper("writeData",[e,d.IO.ChemDataType.DOM]);if(r==d.IO.ChemDataType.DOM)return n;if(r==d.IO.ChemDataType.TEXT){var i={prettyPrint:this.getPrettyPrint()};return DataType.XmlUtility.serializeNode(n,i)}},doWriteData:function(e,t){var r=Class.ObjSerializerFactory.getSerializer("xml");if(!r)return d.error(d.$L("ErrorMsg.XML_SERIALIZER_NOT_EXISTS")),null;var n=DataType.XmlUtility.newDocument(this.getRootTag());return r.save(e,n.documentElement),n.documentElement}}),function(){d.IO.MimeType.KEKULE_JSON="chemical/x-kekule-json",d.IO.MimeType.KEKULE_XML="chemical/x-kekule-xml",d.IO.DataFormat.KEKULE_JSON="Kekule-JSON",d.IO.DataFormat.KEKULE_XML="Kekule-XML",d.IO.DataFormatsManager.register("JSON",d.IO.MimeType.JSON,"json",d.IO.ChemDataType.TEXT,"JSON format"),d.IO.DataFormatsManager.register(d.IO.DataFormat.KEKULE_JSON,d.IO.MimeType.KEKULE_JSON,"kcj",d.IO.ChemDataType.TEXT,"Kekule Chemical JSON format"),d.IO.DataFormatsManager.register(d.IO.DataFormat.KEKULE_XML,d.IO.MimeType.KEKULE_XML,"kcx",d.IO.ChemDataType.TEXT,"Kekule Chemical XML format");var e=d.IO.DataFormatsManager.findFormatId(d.IO.MimeType.JSON),t=d.IO.DataFormatsManager.findFormatId(d.IO.MimeType.KEKULE_JSON),r=d.IO.DataFormatsManager.findFormatId(d.IO.MimeType.KEKULE_XML);d.IO.ChemDataReaderManager.register("json",d.IO.KcjReader,e),d.IO.ChemDataReaderManager.register("kcj",d.IO.KcjReader,t),d.IO.ChemDataReaderManager.register("kcx",d.IO.KcxReader,r),d.IO.ChemDataWriterManager.register("kcj",d.IO.KcjWriter,[d.ChemObject],t,{createOptions:{prettyPrint:!1}}),d.IO.ChemDataWriterManager.register("kcx",d.IO.KcxWriter,[d.ChemObject],r,{createOptions:{prettyPrint:!0}})}(),function(){var e=d,t=d.ChemStructureNodeLabels,r=d.CoordMode;ClassEx.extend(d.ChemObject,{getDefCoordPos:function(e){return d.Render.CoordPos.CENTER},getCoordPos:function(e){var t=e===d.CoordMode.COORD3D?this.getPropStoreFieldValue("coordPos3D"):this.getPropStoreFieldValue("coordPos2D");return d.ObjUtils.isUnset(t)&&(t=this.getDefCoordPos(e)),t},getOverrideRenderOptions:function(e){if(e&&e.length){for(var t={},r=0,n=e.length;r<n;++r)t=Object.extend(t,e[r]);return t}return null},_appendOverrideRenderOptionItem:function(e,t){var r=this.getPropStoreFieldValue(t);r||(r=[],this.setPropStoreFieldValue(t,r));var n=r.indexOf(e);return n>=0&&r.splice(n,1),r.push(e),this.notifyPropSet(t,r),this},_deleteOverrideRenderOptionItem:function(e,t){var r=this.getPropStoreFieldValue(t);if(r){var n=r.indexOf(e);return n>=0&&(r.splice(n,1),this.notifyPropSet(t,r)),this}},addOverrideRenderOptionItem:function(e){return this._appendOverrideRenderOptionItem(e,"overrideRenderOptionItems")},addOverrideRender3DOptionItem:function(e){return this._appendOverrideRenderOptionItem(e,"overrideRender3DOptionItems")},removeOverrideRenderOptionItem:function(e){return this._deleteOverrideRenderOptionItem(e,"overrideRenderOptionItems")},removeOverrideRender3DOptionItem:function(e){return this._deleteOverrideRenderOptionItem(e,"overrideRender3DOptionItems")},getOverriddenRenderOptions:function(){var e=this.getRenderOptions()||{},t=this.getOverrideRenderOptions(this.getOverrideRenderOptionItems());return t&&(e=Object.extend(e,t)),e},getOverriddenRender3DOptions:function(){var e=Object.create(this.getRender3DOptions()||null),t=this.getOverrideRenderOptions(this.getOverrideRender3DOptionItems());return t&&(e=Object.extend(e,t)),e},setRenderOption:function(e,t){var r;(r=this.getRenderOptions())||this.setRenderOptions({}),(r=this.getRenderOptions())[e]!==t&&(r[e]=t,this.notifyPropSet("renderOptions",r))},setRender3DOption:function(e,t){var r;(r=this.getRender3DOptions())||this.setRender3DOptions({}),(r=this.getRender3DOptions())[e]!==t&&(r[e]=t,this.notifyPropSet("render3DOptions",r))},getRenderOption:function(e){var t=this.getOverriddenRenderOptions();return t?t[e]:void 0},getRender3DOption:function(e){var t=this.getOverriddenRender3DOptions();return t?t[e]:void 0},getCascadedRenderOption:function(e){var t=this.getOverriddenRenderOptions(),r=t?t[e]:void 0;if(d.ObjUtils.isUnset(r)){var n=this.getParent?this.getParent():null;r=n&&n.getCascadedRenderOption?n.getCascadedRenderOption(e):void 0}return r},getCascadedRender3DOption:function(e){var t=this.getOverriddenRender3DOptions(),r=t?t[e]:void 0;if(d.ObjUtils.isUnset(r)){var n=this.getParent?this.getParent():null;r=n&&n.getCascadedRender3DOption?n.getCascadedRender3DOption(e):void 0}return r},getBaseCoord:function(e,t){var n=this.getCoordPos(e),i=this.getCoordOfMode?this.getCoordOfMode(e,t):null;if(i&&n!==d.Render.CoordPos.CENTER&&n===d.Render.CoordPos.CORNER_TL){var o=this.getExposedContainerBox(e,t),a={x:(o.x2-o.x1)/2,y:(o.y2-o.y1)/2};e===r.COORD3D&&(a.z=(o.z2-o.z1)/2),e===r.COORD3D?i=d.CoordUtils.add(i,a):(i.x+=a.x,i.y-=a.y)}return i},getBaseCoord2D:function(e){return this.getBaseCoord(d.CoordMode.COORD2D,e)},getBaseCoord3D:function(e){return this.getBaseCoord(d.CoordMode.COORD3D,e)},getAbsBaseCoord:function(e,t){var n=this.getCoordPos(e),i=this.getAbsCoordOfMode?this.getAbsCoordOfMode(e,t):null;if(i&&n!==d.Render.CoordPos.CENTER&&n===d.Render.CoordPos.CORNER_TL){var o=this.getExposedContainerBox(e,t),a={x:(o.x2-o.x1)/2,y:(o.y2-o.y1)/2};e===r.COORD3D&&(a.z=(o.z2-o.z1)/2),e===r.COORD3D?i=d.CoordUtils.add(i,a):(i.x+=a.x,i.y-=a.y)}return i},getAbsBaseCoord2D:function(e){return this.getAbsBaseCoord(d.CoordMode.COORD2D,e)},getAbsBaseCoord3D:function(e){return this.getAbsBaseCoord(d.CoordMode.COORD3D,e)},setAbsBaseCoord:function(e,t,n){var i=this.getCoordPos(t),o=d.CoordUtils.clone(e);if(e&&i!==d.Render.CoordPos.CENTER&&i===d.Render.CoordPos.CORNER_TL){var a=this.getExposedContainerBox(t,n),s={x:(a.x2-a.x1)/2,y:(a.y2-a.y1)/2};t===r.COORD3D&&(s.z=(a.z2-a.z1)/2),t===r.COORD3D?o=d.CoordUtils.substract(o,s):(o.x-=s.x,o.y+=s.y)}return this.setAbsCoordOfMode?this.setAbsCoordOfMode(o,t):this.setCoordOfMode&&this.setCoordOfMode(o,t),this},setAbsBaseCoord2D:function(e,t){return this.setAbsCoordOfMode(e,d.CoordMode.COORD2D,t)},setAbsBaseCoord3D:function(e,t){return this.setAbsCoordOfMode(e,d.CoordMode.COORD3D,t)},getExposedAncestor:function(){var e=this.getParent();return e?e.isExpanded()?this:e.getExposedAncestor():this},isExposed:function(){var e=this.getParent();return!e||e.isExpanded()},isExpanded:function(){return!0},setExpanded:function(e){},getLinkedExposedObjs:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t){var n=this.getLinkedConnectorAt(t);if(n.isExposed())for(var i=n.getConnectedExposedObjs(),o=0,a=i.length;o<a;++o)i[o]!==this&&d.ArrayUtils.pushUnique(e,i[o])}return e},getExposedContainerBox:function(e,t){return this.getContainerBox(e,t)},getAllAutoScaleRefLengths:function(e,t){return[]},getAllContainingConnectors:function(){return this.getAllChildConnectors?this.getAllChildConnectors():[]},getConnectorLengthMedian:function(e,t){var r=this.getAllContainingConnectors();return d.ChemStructureUtils.getConnectorLengthMedian(r,e,t)}}),ClassEx.defineProps(d.ChemObject,[{name:"coordPos2D",dataType:DataType.INT,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getCoordPos(d.CoordMode.COORD2D)}},{name:"coordPos3D",dataType:DataType.INT,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getCoordPos(d.CoordMode.COORD3D)}},{name:"renderOptions",dataType:DataType.OBJECT},{name:"render3DOptions",dataType:DataType.OBJECT},{name:"overrideRenderOptionItems",dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC},{name:"overrideRender3DOptionItems",dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}]),ClassEx.extend(d.ChemObjList,{getAllContainingConnectors:function(){for(var e=[],t=0,r=this.getItemCount();t<r;++t){var n=this.getItemAt(t);n.getAllContainingConnectors&&(e=e.concat(n.getAllContainingConnectors()))}return e},getAllAutoScaleRefLengths:function(e,t){for(var r=[],n=0,i=this.getItemCount();n<i;++n){var o=this.getItemAt(n);o.getAllAutoScaleRefLengths&&(r=r.concat(o.getAllAutoScaleRefLengths(e,t)))}return r},getExposedContainerBox:function(e,t){for(var r,n=this.toArray(),i=0,o=n.length;i<o;++i){var a=n[i];if(a.isExposed()){var s=a.getExposedContainerBox?a.getExposedContainerBox(e,t):a.getContainerBox?a.getContainerBox(e,t):null;s&&(r=r?d.BoxUtils.getContainerBox(r,s):d.BoxUtils.clone(s))}}return r}}),d.ClassDefineUtils.addStandardCoordSupport(d.ChemObjList),ClassEx.extend(d.ChemSpaceElement,{getAllContainingConnectors:function(){return this.getChildren().getAllContainingConnectors()},getAllAutoScaleRefLengths:function(e,t){return this.getChildren().getAllAutoScaleRefLengths(e,t)}}),ClassEx.extend(d.ChemSpace,{getAllContainingConnectors:function(){return this.getRoot().getAllContainingConnectors()},getAllAutoScaleRefLengths:function(e,t){return this.getDefAutoScaleRefLength()?[this.getDefAutoScaleRefLength()]:this.getRoot().getAllAutoScaleRefLengths(e,t)}}),ClassEx.defineProps(d.ChemObject,[{name:"defAutoScaleRefLength",dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC}]),ClassEx.extend(d.BaseStructureConnector,{getBaseCoord:function(e,t){for(var r=null,n=0,i=e===d.CoordMode.COORD2D?{x:0,y:0}:{x:0,y:0,z:0},o=0,a=this.getConnectedObjCount();o<a;++o){var s=this.getConnectedObjAt(o),l=s.getBaseCoord?s.getBaseCoord(e,t):null;l&&(i=d.CoordUtils.add(i,l),++n)}return n&&(r=d.CoordUtils.divide(i,n)),r},getAbsBaseCoord:function(e,t){for(var r=null,n=0,i=e===d.CoordMode.COORD2D?{x:0,y:0}:{x:0,y:0,z:0},o=0,a=this.getConnectedObjCount();o<a;++o){var s=this.getConnectedObjAt(o),l=s.getAbsBaseCoord?s.getAbsBaseCoord(e,t):null;l&&(i=d.CoordUtils.add(i,l),++n)}return n&&(r=d.CoordUtils.divide(i,n)),r},getAbsCoordOfMode:function(e,t){return this.getAbsBaseCoord(e,t)},getConnectedExposedObjs:function(){for(var e=this.getConnectedObjs(),t=[],r=0,n=e.length;r<n;++r){var i=e[r].getExposedAncestor();t.indexOf(i)<0&&t.push(i)}return t},getLength:function(e,t){var r=this.getConnectedObjs();if(2!==r.length)return null;var n=r[0].getAbsBaseCoord?r[0].getAbsBaseCoord(e,t):null,i=r[1].getAbsBaseCoord?r[1].getAbsBaseCoord(e,t):null;return d.CoordUtils.getDistance(n,i)},getLength2D:function(e){return this.getLength(d.CoordMode.COORD2D,e)},getLength3D:function(e){return this.getLength(d.CoordMode.COORD3D,e)}}),ClassEx.defineProps(d.BaseStructureConnector,[{name:"absCoord2D",dataType:DataType.HASH,serializable:!1,getter:function(e){return this.getAbsBaseCoord(d.CoordMode.COORD2D,e)}},{name:"absCoord3D",dataType:DataType.HASH,serializable:!1,getter:function(e){return this.getAbsBaseCoord(d.CoordMode.COORD3D,e)}}]),ClassEx.extend(d.ChemStructureConnector,{getAllAutoScaleRefLengths:function(e,t){return[this.getLength(e,t)]}}),ClassEx.extend(d.BaseStructureNode,{getBaseCoord:function(e,t){return this.getCoordOfMode(e,t)},getAbsBaseCoord:function(e,t){return this.getAbsCoordOfMode(e,t)},getExposedContainerBox:function(e,t){return this.getContainerBox(e,t)},getExposedContainerBox2D:function(e){var t=this.getExposedContainerBox(d.CoordMode.COORD2D,e);return t.width=t.x2-t.x1,t.height=t.y2-t.y1,t},getExposedContainerBox3D:function(e){var t=this.getExposedContainerBox(d.CoordMode.COORD3D,e);return t.deltaX=t.x2-t.x1,t.deltaY=t.y2-t.y1,t.deltaZ=t.z2-t.z1,t}}),ClassEx.extend(d.ChemStructureNode,{getDisplayRichText:function(e,t,r,n,i,o){var a=d.Render;d.ObjUtils.isUnset(t)&&(t=!0);var s,l=a.RichTextUtils.create(),u=this.getRenderOption("customLabel");return(s=u?a.RichTextUtils.strToRichText(u):this.getCoreDisplayRichTextItem(e,t,r,n))&&(t&&(s=this.appendElectronStateDisplayText(s,n,i,o)),s&&(a.RichTextUtils.append(l,s),l.anchorItem=s)),l},getCoreDisplayRichTextItem:function(e,t,r,n){return null},appendElectronStateDisplayText:function(e,t,r,n){var i=d.Render,o=this.getCharge(),a=this.getRadical(),s=i.ChemDisplayTextUtils.createElectronStateDisplayTextSection(o,a,t,r,n);if(s){var l=i.RichTextUtils.createGroup();return i.RichTextUtils.append(l,e),i.RichTextUtils.append(l,s),l.charDirection=d.Render.TextDirection.LTR,l.anchorItem=e,l}return e}}),ClassEx.extend(d.AbstractAtom,{getDisplayRichText:function(e,t,r,n,i,o){var a=d.Render;d.ObjUtils.isUnset(e)&&(e=a.HydrogenDisplayLevel.DEFAULT);var s=this.tryApplySuper("getDisplayRichText",[e,t,r,n,i,o]),l=0;switch(e){case a.HydrogenDisplayLevel.NONE:l=0;break;case a.HydrogenDisplayLevel.ALL:l=this.getHydrogenCount();break;case a.HydrogenDisplayLevel.EXPLICIT:l=this.getExplicitHydrogenCount();break;case a.HydrogenDisplayLevel.UNMATCHED_EXPLICIT:this.getImplicitHydrogenCount&&this.getImplicitHydrogenCount()!==this.getExplicitHydrogenCount()&&(l=this.getExplicitHydrogenCount())}return l&&(s=this.appendHydrogenDisplayText(s,l)),s},appendHydrogenDisplayText:function(e,t){var r=d.Render;if(t)if(t>1){var n=r.RichTextUtils.createGroup();n.charDirection=d.Render.TextDirection.LTR;var i=r.RichTextUtils.appendText2(n,"H");r.RichTextUtils.appendText(n,t.toString(),{textType:r.RichText.SUB,refItem:i}),r.RichTextUtils.append(e,n)}else r.RichTextUtils.appendText(e,"H");return e}}),ClassEx.extend(d.Atom,{getCoreDisplayRichTextItem:function(r,n,i,o){var a,s=d.Render,l=s.RichTextUtils.createGroup(),u=this.getIsotopeAlias();return this.getSymbol(),u||this.getSymbol()!==e.Element.UNSET_ELEMENT?u&&d.ChemStructureNodeLabels.ENABLE_ISOTOPE_ALIAS?(a=s.RichTextUtils.createSection(this.getIsotopeAlias(),{charDirection:d.Render.TextDirection.LTR}),(l=s.RichTextUtils.append(l,a)).anchorItem=a):(a=s.RichTextUtils.createSection(this.getSymbol(),{charDirection:d.Render.TextDirection.LTR}),(l=s.RichTextUtils.append(l,a)).anchorItem=a,this.getMassNumber()!==d.Isotope.UNSET_MASSNUMBER&&((l=s.RichTextUtils.insertText(l,0,this.getMassNumber().toString(),{textType:s.RichText.SUP,charDirection:d.Render.TextDirection.LTR,refItem:l.anchorItem})).charDirection=d.Render.TextDirection.LTR)):l=s.RichTextUtils.appendText(l,i&&i.getUnsetElement()||t.UNSET_ELEMENT),l}}),ClassEx.extend(d.Pseudoatom,{getCoreDisplayRichTextItem:function(e,r,n,i){var o,a=d.Render,s=n;return(o=this.getLabel())||(o=s&&s.getUnsetElement()||t.UNSET_ELEMENT),a.RichTextUtils.createSection(o,{charDirection:d.Render.TextDirection.LTR})}});var n=function(e,t,r){var n,i=d.Render,o=d.IsotopesDataUtil.getIsotopeIdDetail(t);o.massNumber&&(n=i.RichTextUtils.appendText2(e,o.massNumber.toString(),{textType:d.Render.RichText.SUP,charDirection:d.Render.TextDirection.LTR}));var a=i.RichTextUtils.appendText2(e,o.symbol,{charDirection:d.Render.TextDirection.LTR},r);return n&&(n.refItem=a),e.charDirection=d.Render.TextDirection.LTR,e};ClassEx.extend(d.VariableAtom,{getCoreDisplayRichTextItem:function(e,r,i,o){var a,s=d.Render,l=i;if(this.isListEmpty())return(a=s.RichTextUtils.strToRichText(l&&l.getVariableAtom()||t.VARIABLE_ATOM)).charDirection=d.Render.TextDirection.LTR,a;var u=this.getAllowedIsotopeIds()||this.getDisallowedIsotopeIds(),c=this.isDisallowedList();if((a=s.RichTextUtils.createGroup()).charDirection=d.Render.TextDirection.LTR,c&&(a=s.RichTextUtils.appendText(a,l.getIsoListDisallowPrefix())),a=s.RichTextUtils.appendText(a,l.getIsoListLeadingBracket()),u&&u.length)for(var h=0,p=u.length;h<p;++h){var g=u[h];g&&(0!=h&&(a=s.RichTextUtils.appendText(a,l.getIsoListDelimiter())),a=n(a,g,0==h))}return s.RichTextUtils.appendText(a,l.getIsoListTailingBracket())}}),ClassEx.extend(d.StructureConnectionTable,{exposedNodesHasCoord2D:function(e){for(var t=this.getExposedNodes(),r=0,n=t.length;r<n;++r)if(t[r].hasCoord2D(e))return!0;return!1},exposedNodesHasCoord3D:function(e){for(var t=this.getExposedNodes(),r=0,n=t.length;r<n;++r)if(t[r].hasCoord3D(e))return!0;return!1},getExposedNodes:function(){for(var e=[],t=this.getNodes(),r=0,n=t.length;r<n;++r){var i=t[r];if(i.getExposedNodes&&i.isExpanded()){var o=i.getExposedNodes();e=e.concat(o)}else i.isExposed()&&e.push(i)}return e},getExposedConnectors:function(){for(var e=this.getConnectors(),t=this.getNodes(),r=0,n=t.length;r<n;++r){var i=t[r];if(i.getConnectors&&i.isExpanded()){var o=i.getExposedConnectors();e=e.concat(o)}}return e},getExposedContainerBox:function(e,t){var r=this.getExposedNodes();return r.length?this.getNodesContainBox(r,e,t):null},getExposedContainerBox2D:function(e){var t=this.getExposedContainerBox(d.CoordMode.COORD2D,e);return t.width=t.x2-t.x1,t.height=t.y2-t.y1,t},getExposedContainerBox3D:function(e){var t=this.getExposedContainerBox(d.CoordMode.COORD3D,e);return t.deltaX=t.x2-t.x1,t.deltaY=t.y2-t.y1,t.deltaZ=t.z2-t.z1,t},getConnectorLengthMedian:function(e,t){var r=this.getAllContainingConnectors();return d.ChemStructureUtils.getConnectorLengthMedian(r,e,t)},getAllAutoScaleRefLengths:function(e,t){for(var r=this.getAllContainingConnectors(),n=[],i=0,o=r.length;i<o;++i){var a=r[i];if(a&&a.getAllAutoScaleRefLengths){var s=a.getAllAutoScaleRefLengths(e,t);s&&(n=n.concat(s))}}return n}}),ClassEx.extend(d.ContentBlock,{getDefCoordPos:function(e){return e!==r.COORD3D?d.Render.CoordPos.CORNER_TL:this.tryApplySuper("getDefCoordPos",[e])}}),ClassEx.extend(d.ChemMarker.ChemPropertyMarker,{getDefCoordPos:function(e){return e!==r.COORD3D?d.Render.CoordPos.CENTER:this.tryApplySuper("getDefCoordPos",[e])}}),ClassEx.extend(d.StructureFragment,{isExpanded:function(){var e=this.getOverriddenRenderOptions();return!!e&&!!e.expanded},setExpanded:function(e){this.setRenderOption("expanded",e)},getExposedNodes:function(){return this.hasCtab()?this.getCtab().getExposedNodes():[]},getExposedConnectors:function(){return this.hasCtab()?this.getCtab().getExposedConnectors():[]},exposedNodesHasCoord2D:function(e){return!!this.hasCtab()&&this.getCtab().exposedNodesHasCoord2D(e)},exposedNodesHasCoord3D:function(e){return!!this.hasCtab()&&this.getCtab().exposedNodesHasCoord3D(e)},getExposedContainerBox:function(e,t){if(this.hasCtab()){var r=this.getCtab().getExposedContainerBox(e,t);return r||(r=this.getContainerBox(e,t)),r}return this.getContainerBox(e,t)},getConnectorLengthMedian:function(e,t){return this.hasCtab()?this.getCtab().getConnectorLengthMedian(e,t):null},getAutoScaleRefLength:function(e,t){return this.getConnectorLengthMedian(e,t)},getAllAutoScaleRefLengths:function(e,t){return this.hasCtab()?this.getCtab().getAllAutoScaleRefLengths(e,t):null}}),ClassEx.extend(d.SubGroup,{getCoreDisplayRichTextItem:function(e,r,n,i){var o,a=d.Render,s=null,l=this.getAbbr();if(l||(s=this.getFormulaText()?d.FormulaUtils.textToFormula(this.getFormulaText()):this.getFormula(!1)||this.calcFormula())&&!s.isEmpty()||(l=n&&n.getRgroup()||t.SUBGROUP),l)if(l.length<=3)(o=a.RichTextUtils.createSection(l)).charDirection=d.Render.TextDirection.LTR;else{var u=this._indexOfFirstUppercaseLetter(l);u<0&&(u=0),(o=a.RichTextUtils.createGroup()).charDirection=d.Render.TextDirection.LTR,u>0&&((c=a.RichTextUtils.createSection(l.substring(0,u))).charDirection=d.Render.TextDirection.INHERIT,o=a.RichTextUtils.append(o,c));var c=a.RichTextUtils.createSection(l.charAt(u));(o=a.RichTextUtils.append(o,c)).anchorItem=c,u<l.length-1&&((c=a.RichTextUtils.createSection(l.substring(u+1))).charDirection=d.Render.TextDirection.INHERIT,o=a.RichTextUtils.append(o,c))}else s&&(o=s.getDisplayRichText(r,n,i),(c=a.RichTextUtils.getFirstNormalTextSection(o))||(c=o.items[0]),o.anchorItem=c);return o},_indexOfFirstUppercaseLetter:function(e){for(var t=0,r=e.length;t<r;++t){var n=e.charAt(t);if(n>="A"&&n<="Z")return t}return-1},_autoSetSelfCoord:function(e,t){if(!this._isAutoSettingSelfCoord&&!(this.getCoordOfMode(e,t)||(a=this.getAnchorNodeCount())<=0)){this.beginUpdate();try{this._isAutoSettingSelfCoord=!0;for(var r={},n=0;n<a;++n)(s=this.getAnchorNodeAt(n))._autoSetSelfCoord&&s._autoSetSelfCoord(e,t),(l=s.getAbsCoordOfMode(e,t))&&(r=d.CoordUtils.add(r,l));var i=d.CoordUtils.divide(r,a);this.setAbsCoordOfMode(i,e);var o=this.getCoordOfMode(e)||{},a=this.getNodeCount();for(n=0;n<a;++n){var s,l;(l=(s=this.getNodeAt(n)).getCoordOfMode(e,t))&&(l=d.CoordUtils.substract(l,o),s.setCoordOfMode(l,e))}}finally{this._isAutoSettingSelfCoord=!1,this.endUpdate()}}},doGetAbsCoord2D:function(e){return this._autoSetSelfCoord(d.CoordMode.COORD2D,e),this.tryApplySuper("doGetAbsCoord2D",[e])},doGetAbsCoord3D:function(e){return this._autoSetSelfCoord(d.CoordMode.COORD3D,e),this.tryApplySuper("doGetAbsCoord3D",[e])},doSetAbsCoord2D:function(e){return this._autoSetSelfCoord(d.CoordMode.COORD2D),this.tryApplySuper("doSetAbsCoord2D",[e])},doSetAbsCoord3D:function(e){return this._autoSetSelfCoord(d.CoordMode.COORD3D),this.tryApplySuper("doSetAbsCoord3D",[e])}}),ClassEx.extend(d.MolecularFormula,{getDisplayRichText:function(e,t,r,n,i){var o=d.Render;return d.ObjUtils.isUnset(e)&&(e=!0),o.ChemDisplayTextUtils.formulaToRichText(this,e,null,r,t,n,i)},getDisplayText:function(e,t,r){var n=this.getDisplayRichText();return d.Render.RichTextUtils.toText(n)}}),ClassEx.extend(d.Molecule,{afterInitialization:function(){this.setExpanded(!0)}}),ClassEx.extend(d.CompositeMolecule,{getExposedContainerBox:function(e,t){var r=null,n=this.getPropStoreFieldValue("subMolecules");if(n)for(var i=0,o=n.length;i<o;++i){var a=n[i].getExposedContainerBox(e,t);a&&(r=r?d.BoxUtils.getContainerBox(r,a):d.BoxUtils.clone(a))}return r},getAllAutoScaleRefLengths:function(e,t){var r=[],n=this.getPropStoreFieldValue("subMolecules");if(n)for(var i=0,o=n.getItemCount();i<o;++i){var a=n.getObjAt(i).getAllAutoScaleRefLengths(e,t);a&&(r=r.concat(a))}return r}})}(),d.Render={},d.Render.CoordSystem={CHEM:0,CONTEXT:1,SCREEN:2},d.Render.RendererType={R2D:2,R3D:3},d.Render.CoordPos={CENTER:0,CORNER_TL:21,DEFAULT:0},d.Render.DEF_ATOM_ATOMIC_NUM=6,d.Render.MoleculeDisplayType={SKELETAL:1,CONDENSED:2,DEFAULT:1},d.Render.Molecule2DDisplayType=d.Render.MoleculeDisplayType,d.Render.NodeLabelDisplayMode={HIDDEN:-1,SHOWN:1,SMART:0,DEFAULT:0},d.Render.HydrogenDisplayLevel={NONE:0,EXPLICIT:1,UNMATCHED_EXPLICIT:2,ALL:10,LABELED:30,DEFAULT:30},d.Render.TextDirection={DEFAULT:0,LTR:1,RTL:3,TTB:2,BTT:4,INHERIT:10},d.Render.TextAlign={DEFAULT:0,LEFT:1,RIGHT:2,TOP:3,BOTTOM:4,CENTER:5,LEADING:10,TRAILING:11,getAbsAlign:function(e,t){var r=e,n=d.Render.TextAlign,i=d.Render.TextDirection;if(e===n.LEADING||e===n.TRAILING){var o=e==n.LEADING;switch(t){case i.RTL:r=o?n.RIGHT:n.LEFT;break;case i.TTB:r=o?n.TOP:n.BOTTOM;break;case i.BTT:r=o?n.BOTTOM:n.TOP;break;case i.LTR:default:r=o?n.LEFT:n.RIGHT}}return r}},d.Render.BoxXAlignment={LEFT:0,RIGHT:1,CENTER:2},d.Render.BoxYAlignment={TOP:0,BOTTOM:1,CENTER:2},d.Render.TextBoxAlignmentMode={BOX:0,ANCHOR:1},d.Render.BondRenderType={DEFAULT:null,SINGLE:0,DOUBLE:1,TRIPLE:2,QUAD:3,DASHED:4,DASHED_DOUBLE:5,DASHED_TRIPLE:6,SOLID_DASH:7,ARROWED:8,ARROWED_INV:9,HASHED:10,BOLD:11,BOLD_DOUBLE:12,BOLD_TRIPLE:13,BOLD_QUAD:14,BOLD_DASH:16,WEDGED_SOLID:20,WEDGED_SOLID_INV:21,WEDGED_HOLLOW:22,WEDGED_HOLLOW_INV:23,WEDGED_HASHED:24,WEDGED_HASHED_INV:25,WEDGED_SOLID_BOTH:26,WEDGED_HOLLOW_BOTH:27,WAVY:30,SCISSORS_DOUBLE:40},d.Render.ChargeMarkRenderType={NUM_WITH_SYMBOL:1,DEFAULT:1,CIRCLE_AROUND:3},d.Render.Render3DGraphicQuality={EXTREME_LOW:1,LOW:2,MEDIUM:3,HIGH:4,EXTREME_HIGH:5},d.Render.Molecule3DDisplayType={WIRE:31,STICKS:32,BALL_STICK:33,SPACE_FILL:34,DEFAULT:33},d.Render.Bond3DRenderMode={NONE:0,WIRE:1,MULTI_WIRE:2,CYLINDER:3,MULTI_CYLINDER:4,isWireMode:function(e){var t=d.Render.Bond3DRenderMode;return e===t.WIRE||e===t.MULTI_WIRE},isCylinderMode:function(e){var t=d.Render.Bond3DRenderMode;return e===t.CYLINDER||e===t.MULTI_CYLINDER}},d.Render.Bond3DSpliceMode={UNSPLIT:1,MID_SPLIT:2,WEIGHTING_SPLIT:3},d.Render.Bond3DRenderType={SINGLE:1,DOUBLE:2,TRIPLE:3,DASH:-1,SOLID_DASH:-2},d.Render.Node3DRenderMode={NONE:0,BALL:1,SPACE:2},d.Render.MetaShapeType={POINT:0,CIRCLE:1,LINE:2,RECT:3,ARC:5,POLYLINE:11,POLYGON:10,SPHERE:101,CYLINDER:102,COMPOSITE:-1},d.Render.BoundShapeType=d.Render.MetaShapeType,d.Render.ObjectUpdateType={MODIFY:0,ADD:1,REMOVE:2,CLEAR:3},d.Render.AbstractRenderer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.AbstractRenderer",RENDER_CACHE_FIELD:"__$renderCache$__",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setPropValue("chemObj",e,!0),r&&this.setParent(r),this.setDrawBridge(t),this.setBubbleEvent(!0),this._suspendUpdateStatus=0,this._suspendUpdateInfos=[]},finalize:function(){var e=this.getPropStoreFieldValue("boundInfoRecorder");e&&e.finalize(),this.setPropValue("chemObj",null,!0),this.setDrawBridge(null),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:null}),this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("parent",{dateType:DataType.OBJECT,serializable:!1}),this.defineProp("parentRenderer",{dateType:"Kekule.Render.AbstractRenderer",serializable:!1,getter:function(){var e=this.getParent();return e instanceof d.Render.AbstractRenderer?e:null},setter:function(e){this.setParent(e)}}),this.defineProp("redirectContext",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("canModifyTargetObj",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("canModifyTargetObj");if(d.ObjUtils.isUnset(e)){var t=this.getParent();t&&t.getCanModifyTargetObj&&(e=t.getCanModifyTargetObj())}return e}}),this.defineProp("boundInfoRecorder",{dataType:"Kekule.Render.BoundInfoRecorder",serializable:!1,setter:null,getter:function(e){if(this.isRootRenderer()){var t=this.getPropStoreFieldValue("boundInfoRecorder");return t||e||(t=this._createBoundInfoRecorder()),t}var r=this.getRootRenderer();return r&&r.getBoundInfoRecorder(e)}}),this.defineEvent("clear"),this.defineEvent("updateBasicDrawObject")},_createBoundInfoRecorder:function(){var e=this.getPropStoreFieldValue("boundInfoRecorder");e&&e.finalize();var t=new d.Render.BoundInfoRecorder(this);return this.setPropStoreFieldValue("boundInfoRecorder",t),t},isRootRenderer:function(){return!this.getParentRenderer()},getHigherLevelObj:function(){return this.getParent()},getRootRenderer:function(){if(this.isRootRenderer())return this;var e=this.getParentRenderer();return e?e.getRootRenderer():this},getRendererType:function(){return d.Render.RendererType.R2D},getCoordMode:function(){return this.getRendererType()===d.Render.RendererType.R3D?d.CoordMode.COORD3D:d.CoordMode.COORD2D},_getRenderSortIndex:function(){return 0},getRenderCache:function(e){var t=this.getExtraProp(e,this.RENDER_CACHE_FIELD);return t||(t={},this.setExtraProp(e,this.RENDER_CACHE_FIELD,t)),t},beginDraw:function(e,t,r){var n=this.getDrawBridge();n.prepareContext&&n.prepareContext(e)},endDraw:function(e,t,r){var n=this.getDrawBridge();n.renderContext&&n.renderContext(e)},updateDrawInfoInCache:function(e,t,r,n,i){var o=this.getRenderCache(t);t&&(o.context=t),r&&(o.baseCoord=r),e&&(o.chemObj=e),n&&(o.options=n),i&&(o.realDrawOptions=i)},_isCurrChemObjNeedToBeDrawn:function(e,t){for(var r=this.getChemObj(),n=0,i=e.length;n<i;++n){var o=e[n];if(o===r||o.isChildOf(r))return!0}return!1},getAutoBaseCoord:function(e){return this.doGetAutoBaseCoord(e)},doGetAutoBaseCoord:function(e){return null},getCachedDrawOptions:function(e){return this.getRenderCache(e).options},getCachedDrawnElem:function(e){return this.getRenderCache(e).drawnElem},draw:function(e,t,r){try{this.__isDrawing=!0,this.getBoundInfoRecorder();var n={},i=this.getParentRenderer();if(i)var o=i.getRenderCache().options;o?(n=Object.create(o),n=Object.extend(n,r)):n=Object.create(r||null);var a=this.getChemObj(),s=n.partialDrawObjs;if(s&&!this._isCurrChemObjNeedToBeDrawn(s,e))return null;var l=this.getRendererType()===d.Render.RendererType.R3D?"getRender3DOptions":"getRenderOptions",u=a[l]?a[l]():null,c=a[l=this.getRendererType()===d.Render.RendererType.R3D?"getOverriddenRender3DOptions":"getOverriddenRenderOptions"]?a[l]():null;n=d.Render.RenderOptionUtils.mergeRenderOptions(u||{},n),this.getRenderCache().options=n,n=d.Render.RenderOptionUtils.mergeRenderOptions(c||{},n),this.updateDrawInfoInCache(this.getChemObj(),e,t,r,n);var h=this.isRootRenderer();this.invokeEvent("prepareDrawing",{context:e,obj:this.getChemObj()}),h&&this.beginDraw(e,t,n);var p=this.doDraw(e,t,n);this.getRenderCache(e).drawnElem=p,h&&this.endDraw(e,t,n),this.invokeEvent("draw",{context:e,obj:this.getChemObj()})}finally{this.__isDrawing=!1}return p},doDraw:function(e,t,r){return this.doDrawSelf(e,t,r)},doDrawSelf:function(e,t,r){return null},redraw:function(e){var t=this.isRootRenderer();if(t){var r=this.getRenderCache(e)||{};this.beginDraw(e,r.baseCoord,r.options)}var n=this.doRedraw(e);return this.getRenderCache(e).drawnElem=n,t&&this.endDraw(e,r.baseCoord,r.options),n},doRedraw:function(e){var t=this.getRenderCache(e);return this.draw(e,t.baseCoord,t.options)},canModifyGraphic:function(e){var t=this.getDrawBridge();return!!t.canModifyGraphic&&t.canModifyGraphic(e)},beginUpdateRenderer:function(){++this._suspendUpdateStatus},endUpdateRenderer:function(){--this._suspendUpdateStatus,this._suspendUpdateStatus<=0&&(this._suspendUpdateStatus=0),this.isUpdatingRenderer()||this.doEndUpdateRenderer()},doEndUpdateRenderer:function(){this.updateEx(this._suspendUpdateInfos),this._suspendUpdateInfos=[]},isUpdatingRenderer:function(){return this._suspendUpdateStatus>0},updateEx:function(e){var t=!0;if(this.isUpdatingRenderer())return this._suspendUpdateInfos||(this._suspendUpdateInfos=[]),this._mergeRendererUpdateInfo(this._suspendUpdateInfos,e),!0;if(!this.canModifyGraphic(s)){if(this.isRootRenderer()){var r=[];for(i=0,o=e.length;i<o;++i)s=(a=e[i]).context,d.ArrayUtils.pushUnique(r,s);for(i=0,o=r.length;i<o;++i){this.getDrawBridge().clearContext(s);var n=this.getRenderCache(s);this.draw(s,n.baseCoord,n.options)}return!0}return this.getParentRenderer().updateEx(e)}for(var i=0,o=e.length;i<o;++i){for(var a,s=(a=e[i]).context,l=0,u=a.items.length;l<u;++l){var c=a.items[l];if(!(t=t&&this.doUpdate(s,c.updatedObjDetails,c.updateType)))break}if(!t)break}return t},_mergeRendererUpdateInfo:function(e,t){for(var r=0,n=t.length;r<n;++r){var i=t[r],o=this._indexOfContextInRendererUpdateInfos(i.context,e);if(o<0)e.push(i);else{var a=e[o];a.items=a.items.concat(i.items)}}return e},_indexOfContextInRendererUpdateInfos:function(e,t){for(var r=0,n=t.length;r<n;++r)if(t[r].context===e)return r;return-1},update:function(e,t,r){for(var n=[],i=0,o=t.length;i<o;++i){var a=t[i].obj;this.isChemObjRenderedBySelf(e,a)&&n.push(t[i])}return!n.length||this.updateEx([{context:e,items:[{updateType:r,updatedObjDetails:n}]}])},doUpdate:function(e,t,r){return this.doUpdateSelf(e,t,r)},doUpdateSelf:function(e,t,r){if(this.canModifyGraphic(e)){for(var n=!1,i=this.getChemObj(),o=0,a=t.length;o<a;++o)if(t[o].obj===i){n=!0;break}if(n){if(r===d.Render.ObjectUpdateType.CLEAR)return this.doClear(e);this.doClear(e);var s=this.getRenderCache(e);return this.draw(e,s.baseCoord,s.options)}}return!1},_extractObjsOfUpdateObjDetails:function(e){return d.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(e)},_createUpdateObjDetailsFromObjs:function(e){return d.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(e)},addNew:function(e,t){var r=this._createUpdateObjDetailsFromObjs(t);return this.update(e,r,d.Render.ObjectUpdateType.ADD)},modify:function(e,t){return this.update(e,t,d.Render.ObjectUpdateType.MODIFY)},remove:function(e,t){var r=this._createUpdateObjDetailsFromObjs(t);return this.update(e,r,d.Render.ObjectUpdateType.REMOVE)},clear:function(e){this.doClear(e),this.invokeEvent("clear",{context:e,obj:this.getChemObj()})},doClear:function(e){return!!this.canModifyGraphic()&&this.doClearSelf(e)},doClearSelf:function(e){if(!this.canModifyGraphic())return!1;var t=this.getRenderCache(e).drawnElem;if(t)try{this.getDrawBridge().removeDrawnElem(e,t)}catch(e){}this.getRenderCache(e).drawnElem=null},estimateObjBox:function(e,t,r){var n=this.doEstimateObjBox(e,t,r);return n&&(n=this._fillBoxDefaultValue(n,this.getRendererType())),n},doEstimateObjBox:function(e,t,r){return this.doEstimateSelfObjBox(e,t,r)},doEstimateSelfObjBox:function(e,t,r){return null},estimateRenderBox:function(e,t,r,n){var i=this.doEstimateRenderBox(e,t,r,n);return i&&(i=this._fillBoxDefaultValue(i,this.getRendererType())),i},doEstimateRenderBox:function(e,t,r,n){return null},_fillBoxDefaultValue:function(e,t){e||(e={});var r=t===d.Render.RendererType.R3D,n={x1:e.x1||0,x2:e.x2||0,y1:e.y1||0,y2:e.y2||0};return r&&(n.z1=e.z1||0,n.z2=e.z2||0),n},transformCoordToObj:function(e,t,r){return this.doTransformCoordToObj(e,t,r)},doTransformCoordToObj:function(e,t,r){return r},transformCoordToContext:function(e,t,r){return this.doTransformCoordToContext(e,t,r)},doTransformCoordToContext:function(e,t,r){return r},transformContextCoordToScreen:function(e,t){return this.doTransformContextCoordToScreen(e,t)},doTransformContextCoordToScreen:function(e,t){var r=this.getDrawBridge();return r&&r.transformContextCoordToScreen?r.transformContextCoordToScreen(e,t):t},basicDrawObjectUpdated:function(e,t,r,n,i){this.invokeEvent("updateBasicDrawObject",{context:e,obj:t,parentObj:r,boundInfo:n,updateType:i})},isChemObjRenderedBySelf:function(e,t){return t===this.getRenderCache(e).chemObj},isChemObjRenderedDirectlyBySelf:function(e,t){return!(!t||!this.getRenderCache(e).chemObj)&&t===this.getRenderCache(e).chemObj},getObjRenderBound:function(e,t,r){var n=this.getBoundInfoRecorder(),i=t;return r&&t.getCoordStickTarget&&(i=t.getCoordStickTarget()||i),n&&n.getBound(e,i)},getStickingTargetRenderBound:function(e,t){var r;if(t.getCoordStickTarget&&(r=t.getCoordStickTarget()),r){var n=this.getBoundInfoRecorder();return n&&n.getBound(e,r,!0)}return null},createBoundInfo:function(e,t,r){return d.Render.MetaShapeUtils.createShapeInfo(e,t,r)},createPointBoundInfo:function(e){return this.createBoundInfo(d.Render.BoundShapeType.POINT,[e])},createCircleBoundInfo:function(e,t){return this.createBoundInfo(d.Render.BoundShapeType.CIRCLE,[e],{radius:t})},createArcBoundInfo:function(e,t,r,n,i,o){return this.createBoundInfo(d.Render.BoundShapeType.ARC,[e],{radius:t,startAngle:r,endAngle:n,anticlockwise:i,width:o})},createLineBoundInfo:function(e,t,r){return this.createBoundInfo(d.Render.BoundShapeType.LINE,[e,t],{width:r})},createRectBoundInfo:function(e,t){return this.createBoundInfo(d.Render.BoundShapeType.RECT,[e,t])},createSphereBoundInfo:function(e,t){return this.createBoundInfo(d.Render.BoundShapeType.SPHERE,[e],{radius:t})},createCylinderBoundInfo:function(e,t,r){return this.createBoundInfo(d.Render.BoundShapeType.CYLINDER,[e,t],{radius:r})}}),d.ClassDefineUtils.addExtraObjMapSupport(d.Render.AbstractRenderer),d.Render.DummyRenderer=Class.create(d.Render.AbstractRenderer,{CLASS_NAME:"Kekule.Render.DummyRenderer",draw:function(e,t,r){},redraw:function(e){}}),d.Render.CompositeRenderer=Class.create(d.Render.AbstractRenderer,{CLASS_NAME:"Kekule.Render.CompositeRenderer",initProperties:function(){this.defineProp("targetChildObjs",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("childRendererMap",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("childRendererMap");return e||(e=new d.MapEx(!0),this.setPropStoreFieldValue("childRendererMap",e)),e}})},finalize:function(){this.reset(),this.tryApplySuper("finalize")},_getRenderSortIndex:function(){for(var e=this.tryApplySuper("_getRenderSortIndex"),t=this.prepareChildRenderers(),r=0,n=t.length;r<n;++r){var i=t[r]._getRenderSortIndex();i>e&&(e=i)}return e},doEstimateObjBox:function(e,t,r){for(var n=this.tryApplySuper("doEstimateObjBox",[e,t,r]),i=this.prepareChildRenderers(),o=d.BoxUtils,a=0,s=i.length;a<s;++a){var l=i[a];if(l){var u=l.estimateObjBox(e,t,r);u&&(n=n?o.getContainerBox(n,u):o.clone(u))}}return n},isChemObjRenderedBySelf:function(e,t){var r=this.tryApplySuper("isChemObjRenderedBySelf",[e,t]);if(!r)for(var n=this.getChildRenderers(),i=0,o=n.length;i<o;++i)if(n[i].isChemObjRenderedBySelf(e,t))return!0;if(!r){this.refreshChildObjs();var a=this.getTargetChildObjs();r=a&&a.indexOf(t)>=0}return r},isChemObjRenderedDirectlyBySelf:function(e,t){return this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[e,t])},doSetRedirectContext:function(e){this.tryApplySuper("doSetRedirectContext",[e]);var t=this.getChildRenderers();if(t&&t.length)for(var r=0,n=t.length;r<n;++r)t[r].setRedirectContext(e)},getChildObjs:function(){var e=this.getChemObj();return e&&e.getAttachedMarkers?[].concat(e.getAttachedMarkers()||[]):[]},prepareChildObjs:function(){return this.getTargetChildObjs()||(this.setTargetChildObjs(this.getChildObjs()),this.getTargetChildObjs())},refreshChildObjs:function(){this.setTargetChildObjs(null),this.prepareChildObjs()},getChildRenderers:function(){return this.getChildRendererMap().getValues()},getRendererForChild:function(e,t){var r=this.getRendererType()===d.Render.RendererType.R3D?d.Render.get3DRendererClass:d.Render.get2DRendererClass,n=this.getChildRendererMap();if(!(o=n.get(e))&&t){var i=r(e)||d.Render.DummyRenderer,o=i?new i(e,this.getDrawBridge(),this):null;n.set(e,o),o.setRedirectContext(this.getRedirectContext())}return o},prepareChildRenderers:function(){for(var e=this.getChildRendererMap(),t=this.prepareChildObjs()||[],r=e.getKeys(),n=0,i=r.length;n<i;++n){var o=r[n];t.indexOf(o)<0&&e.remove(o)}for(n=0,i=t.length;n<i;++n){var a=t[n];this.getRendererForChild(a,!0)}return e.getValues()},releaseChildRenderers:function(){var e=this.getChildRendererMap(),t=e.getValues();if(t){for(var r=0,n=t.length;r<n;++r)t[r].finalize();e.clear()}},hasChildRenderers:function(){var e=this.getChildRendererMap().getValues();return e&&e.length},prepare:function(){this.prepareChildObjs(),this.prepareChildRenderers()},reset:function(){this.setTargetChildObjs(null),this.releaseChildRenderers()},_needWholelyDraw:function(e,t){var r=this.getChemObj();return!e||e.indexOf(r)>=0},doDraw:function(e,t,r){this.refreshChildObjs(),this.prepareChildRenderers();var n=Object.create(r);if(r.partialDrawObjs&&this._needWholelyDraw(r.partialDrawObjs,e)&&(n.partialDrawObjs=null),this.getTargetChildObjs().length){var i=this.doDrawSelf(e,t,n),o=this.doDrawChildren(e,t,n);return i&&this.addToDrawGroup(i,o),o}return this.tryApplySuper("doDraw",[e,t,n])},doDrawChildren:function(e,t,r){var n=this.createDrawGroup(e),i=this.getChildRenderers();this._sortChildRenderers(i);var o=Object.create(r);this.getRenderCache(e).childDrawOptions=o;for(var a=0,s=i.length;a<s;++a){var l=i[a].draw(e,null,o);n&&l&&this.addToDrawGroup(l,n)}return n},_sortChildRenderers:function(e){e.sort((function(e,t){return e._getRenderSortIndex()-t._getRenderSortIndex()}))},doClear:function(e){return this.tryApplySuper("doClear",[e]),this.hasChildRenderers()&&this.doClearChildren(e),!0},doClearChildren:function(e){for(var t=this.getChildRendererMap().getValues(),r=0,n=t.length;r<n;++r)t[r]&&t[r].clear(e)},doUpdate:function(e,t,r){return this.refreshChildObjs(),this.tryApplySuper("doUpdate",[e,t,r]),this.getTargetChildObjs().length&&this.doUpdateChildren(e,t,r),!0},doUpdateChildren:function(e,t,r){for(var n=d.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(t),i=this.getTargetChildObjs()||[],o=this.getChildRendererMap(),a=d.ArrayUtils.toArray(n),s=new d.MapEx(!1),l=[],u=!1,c=0,h=a.length;c<h;++c){var p=a[c];this.isChemObjRenderedDirectlyBySelf(e,p)&&(u=!0)}if(u)return this.doClear(e),this.redraw(e),!0;for(c=0,h=a.length;c<h;++c)if(p=a[c],_=o.get(p))r===d.Render.ObjectUpdateType.REMOVE?(_.clear(),o.remove(p)):(d.ArrayUtils.pushUnique(l,_),E=[p],s.set(_,E));else{var g=this._getRenderersForChildObj(e,p);if(!g.length&&i.indexOf(p)>=0){var f=(S=this.getRendererForChild(p,!0)).draw(e,null,this.getRenderCache(e).childDrawOptions);if(f){var m=this.getCachedDrawnElem(e);m&&this.addToDrawGroup(f,m)}}for(var C=0,y=g.length;C<y;++C){var _=g[C],E=s.get(_);E||(l.push(_),E=[],s.set(_,E)),E.push(p)}}var T=!0;for(c=0,h=l.length;c<h;++c){_=l[c];var O=s.get(_),v=d.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(O),S=_.update(e,v,r);T=T&&S}return T},_getRenderersForChildObj:function(e,t){for(var r=[],n=this.getChildRenderers(),i=0,o=n.length;i<o;++i){var a=n[i];a.isChemObjRenderedBySelf(e,t)&&r.push(a)}return r}}),d.Render.Renderer2DFactory=d.FactoryUtils.createSimpleFactory(d.FactoryUtils.MATCH_BY_CLASS),d.Render.get2DRendererClass=function(e){var t=e instanceof ObjectEx?e.getClass():e;return d.Render.Renderer2DFactory.getClass(t)},d.Render.Renderer3DFactory=d.FactoryUtils.createSimpleFactory(d.FactoryUtils.MATCH_BY_CLASS),d.Render.get3DRendererClass=function(e){var t=e instanceof ObjectEx?e.getClass():e;return d.Render.Renderer3DFactory.getClass(t)},d.Render.DrawBridgeManager=Class.create({CLASS_NAME:"Kekule.Render.DrawBridgeManager",initialize:function(){this._items=[],this._preferredItem=null},_indexOfBridgeClass:function(e){for(var t=0,r=this._items.length;t<r;++t)if(this._items[t].bridgeClass===e)return t;return-1},_sortItems:function(){this._items.sort((function(e,t){return(e.priorityLevel||0)-(t.priorityLevel||0)}))},_reselectPreferred:function(){this._sortItems();for(var e=this._items.length-1;e>=0;--e){var t=this._items[e];if(t.isSupported)return this._preferredItem=t,t}return this._preferredItem=null,null},_recheckAvailabilityOfItem:function(e){var t=e.bridgeClass,r=t.getAvailabilityInformation&&t.getAvailabilityInformation();!r&&t.isSupported&&(r={available:t.isSupported(),message:null}),r?(e.isSupported=r.available,e.message=r.message):(e.isSupported=!1,e.message=null)},recheckAvailabilities:function(){for(var e=this._items,t=e.length-1;t>=0;--t){var r=e[t];this._recheckAvailabilityOfItem(r)}},register:function(e,t){t||(t=0);var r,n=this._indexOfBridgeClass(e);return n>=0&&this._items.splice(n,1),r={bridgeClass:e,priorityLevel:t},this._recheckAvailabilityOfItem(r),this._items.push(r),this._sortItems(),(!this._preferredItem||this._preferredItem.priorityLevel<t)&&r.isSupported&&(this._preferredItem=r),r},unregister:function(e){var t=null,r=this._indexOfBridgeClass(e);return r>=0&&(t=this._items[r],this._items.splice(r,1),t===this._preferredItem&&this._reselectPreferred()),t},getPreferredBridgeClass:function(){return this._preferredItem?this._preferredItem.bridgeClass:null},getPreferredBridgeInstance:function(){var e=this.getPreferredBridgeClass();return e?new e:null},getUnavailableMessages:function(){for(var e=[],t=this._items,r=t.length-1;r>=0;--r){var n=t[r];!n.isSupported&&n.message&&e.push(n.message)}return e},getUnavailableMessage:function(){var e=this._preferredItem||this._items[this._items.length-1];return!e.isSupported&&e.message?e.message:""}}),d.Render.DrawBridge2DMananger=new d.Render.DrawBridgeManager,d.Render.DrawBridge3DMananger=new d.Render.DrawBridgeManager,d.Render.registerExternalModule=function(e,t){d.externalResourceManager.register(e,t)},d.Render.getExternalModule=function(e){return d.externalResourceManager.getResource(e)},function(){var e=d.Render;e.atomColorSets={jmol:["#000099","#FFFFFF","#D9FFFF","#CC80FF","#C2FF00","#FFB5B5","#909090","#3050F8","#FF0D0D","#90E050","#B3E3F5","#AB5CF2","#8AFF00","#BFA6A6","#F0C8A0","#FF8000","#FFFF30","#1FF01F","#80D1E3","#8F40D4","#3DFF00","#E6E6E6","#BFC2C7","#A6A6AB","#8A99C7","#9C7AC7","#E06633","#F090A0","#50D050","#C88033","#7D80B0","#C28F8F","#668F8F","#BD80E3","#FFA100","#A62929","#5CB8D1","#702EB0","#00FF00","#94FFFF","#94E0E0","#73C2C9","#54B5B5","#3B9E9E","#248F8F","#0A7D8C","#006985","#C0C0C0","#FFD98F","#A67573","#668080","#9E63B5","#D47A00","#940094","#429EB0","#57178F","#00C900","#70D4FF","#FFFFC7","#D9FFC7","#C7FFC7","#A3FFC7","#8FFFC7","#61FFC7","#45FFC7","#30FFC7","#1FFFC7","#00FF9C","#00E675","#00D452","#00BF38","#00AB24","#4DC2FF","#4DA6FF","#2194D6","#267DAB","#266696","#175487","#D0D0E0","#FFD123","#B8B8D0","#A6544D","#575961","#9E4FB5","#AB5C00","#754F45","#428296","#420066","#007D00","#70ABFA","#00BAFF","#00A1FF","#008FFF","#0080FF","#006BFF","#545CF2","#785CE3","#8A4FE3","#A136D4","#B31FD4","#B31FBA","#B30DA6","#BD0D87","#C70066","#CC0059","#D1004F","#D90045","#E00038","#E6002E","#EB0026","#000000","#000000"],cpk2D:["#000000","#000000","#FFC0CB","#B22222",null,"#00FF00","#000000","#8F8FFF","#F00000","#DAA520",null,"#0000FF","#228B22","#808090","#DAA520","#FFA500","#FFC832","#00FF00",null,"#0000FF","#808090","#808090","#808090","#808090","#808090","#808090","#FFA500","#A52A2A","#A52A2A","#A52A2A","#A52A2A"]};var t=e.atomColorSets.cpk2D,r=e.atomColorSets.jmol;t[35]="#A52A2A",t[47]="#808090",t[53]="#A020F0",t[56]="#FFA500",t[79]="#DAA520",t.SubGroup=r.SubGroup="#0000CC",e.atom3DColors=d.Render.atomColorSets.jmol,e.atom2DColors=d.Render.atomColorSets.cpk2D,e.atomColors=[],e.atomColors[e.RendererType.R2D]=e.atom2DColors,e.atomColors[e.RendererType.R3D]=e.atom3DColors}(),d.Render.RichText={SECTION:"section",GROUP:"group",LINES:"lines",SUP:"superscript",SUB:"subscript",NORMAL:"normal"},d.Render.RichTextUtils={STYLE_PROPS:["fontSize","fontFamily","fontWeight","fontStyle","color","opacity"],create:function(){return d.Render.RichTextUtils.createGroup()},createGroup:function(e,t){var r={role:e||"group",items:[]};if(t)for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r},createSection:function(e,t){var r={text:e};if(t)for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r},strToRichText:function(e,t){e||(e="");var r=d.Render.RichTextUtils,n=e.split("\n");if(n.length<=1)return d.Render.RichTextUtils.appendText(r.create(),e,t);for(var i=r.createGroup(d.Render.RichText.LINES),o=0,a=n.length;o<a;++o){var s=n[o]||"\xa0";r.appendText(i,s,t)}return i},insertText:function(e,t,r,n,i){var o=d.Render.RichTextUtils.createSection(r,n);return e.items.splice(t,0,o),i&&(e.anchorItem=o),e},appendText:function(e,t,r,n){var i=d.Render.RichTextUtils.createSection(t,r);return e.items.push(i),n&&(e.anchorItem=i),e},appendText2:function(e,t,r,n){var i=d.Render.RichTextUtils.createSection(t,r);return e.items.push(i),n&&(e.anchorItem=i),i},insert:function(e,t,r){return e.items.splice(t,0,r),e},append:function(e,t){return e.items.push(t),e},appendItems:function(e,t){return e.items=e.items.concat(d.ArrayUtils.toArray(t)),e},getItemType:function(e){return e.items?e.role:d.Render.RichText.SECTION},getItemRole:function(e){var t=d.Render.RichText;return d.Render.RichTextUtils.getItemType(e)===t.GROUP?t.GROUP:t.SECTION},getItemTextType:function(e){return e.textType||d.Render.RichText.NORMAL},isSuperscript:function(e){return d.Render.RichTextUtils.getItemTextType(e)==d.Render.RichText.SUP},isSubscript:function(e){return d.Render.RichTextUtils.getItemTextType(e)==d.Render.RichText.SUB},isGroup:function(e){return d.Render.RichTextUtils.getItemType(e)===d.Render.RichText.GROUP},isSection:function(e){return d.Render.RichTextUtils.getItemType(e)===d.Render.RichText.SECTION},getFirstNormalTextSection:function(e){for(var t=0,r=e.items.length;t<r;++t){var n=e.items[t];if(d.Render.RichTextUtils.getItemTextType(n)===d.Render.RichText.NORMAL)return n}return null},getActualRefItem:function(e,t){var r=e.refItem;if(!r&&t.items.length>1){var n=t.items.indexOf(e);r=n>0?t.items[n-1]:0==n?t.items[1]:null}return r},getFinalAnchorItem:function(e){return e.anchorItem?d.Render.RichTextUtils.getFinalAnchorItem(e.anchorItem):e},tidy:function(e){for(var t=d.Render.RichTextUtils.createGroup(e.role),r=-1,n=0,i=e.items.length;n<i;++n){var o=e.items[n];if(o.items){var a=d.Render.RichTextUtils.tidy(o);if(1==a.items.length){var s=Object.extend({},a);delete s.items,delete s.role,o=s=Object.extend(s,a.items[0])}else if(a.items.length>0){++r,t.items.push(a);continue}}var l=!1;if(r>=0){var u=t.items[r];u.items||d.ObjUtils.equal(o,u,["text"])&&(u.text+=o.text,l=!0)}l||(++r,t.items.push(Object.extend({},o)))}return t},clone:function(e){var t={};if(Object.extend(t,e),e.items){t.items=[];for(var r=0,n=e.items.length;r<n;++r){var i={};i=d.Render.RichTextUtils.clone(e.items[r]),t.items.push(i)}}if(t.items){if(e.anchorItem){var o=e.items.indexOf(e.anchorItem);t.anchorItem=o>=0?t.items[o]:null}for(r=0,n=t.items.length;r<n;++r){var a=e.items[r];i=t.items[r],a.refItem&&(o=e.items.indexOf(a.refItem),i.refItem=o>=0?t.items[o]:null)}}return t},toText:function(e){var t="";if(!e.items)return e.text||"";for(var r=0,n=e.items.length;r<n;++r){var i=e.items[r];i.items?t+=d.Render.RichTextUtils.toText(i):i.text&&(t+=i.text)}return t},_toDebugHtml:function(e){if(!e.items)return e.text;for(var t="",r=0,n=e.items.length;r<n;++r){var i=e.items[r];if(i.items)t+=d.Render.RichTextUtils._toDebugHtml(i);else if(i.text)switch(i.textType){case d.Render.RichText.SUB:t+="<sub>"+i.text+"</sub>";break;case d.Render.RichText.SUP:t+="<sup>"+i.text+"</sup>";break;default:t+=i.text}}return t},toSimpleHtmlCode:function(e){return d.Render.RichTextUtils._toDebugHtml(e)},toHtml:function(e,t,r){var n,i,o=d.Render.RichText;i=t.charDirection?t.charDirection===d.Render.TextDirection.RTL||t.charDirection===d.Render.TextDirection.BTT:r;var a=t.role;if(a===o.SECTION||t.text){var s=t.textType,l=s===o.SUB?"sub":s===o.SUP?"sup":"span";n=e.createElement(l);var u=t.text;i&&(u=u.reverse()),d.DomUtils.setElementText(n,t.text||"")}else{var c,h,p=null;a===o.LINES?(n=e.createElement("div"),p="p",c="margin:0.2em 0;padding:0"):n=e.createElement("span");for(var g=0,f=t.items.length;g<f;++g){var m=t.items[g],C=d.Render.RichTextUtils.toHtml(e,m,i);if(p){var y=e.createElement(p);c&&(y.style.cssText=c),y.appendChild(C),C=y}i&&h?n.insertBefore(C,h):n.appendChild(C),h=C}}var _=n.style,E=d.Render.RichTextUtils.STYLE_PROPS;for(g=0,f=E.length;g<f;++g){var T=E[g];t[T]&&(_[T]=t[T])}return n},fromHtml:function(e){var t=d.Render.RichText,r=d.Render.RichTextUtils,n=d.DomUtils,i=d.StyleUtils;return function e(o,a){if(o.nodeType===Node.TEXT_NODE)return(S=(S=o.nodeValue).replace(/[\r\n]/g,"")).trim()?r.createSection(S):null;if(o.nodeType===Node.ELEMENT_NODE){var s=r.STYLE_PROPS;s.push("direction");for(var l={},u=0,c=s.length;u<c;++u){var h,p=s[u];(h=a?i.getComputedStyle(o,p):o.style[p])&&(l[p]=h)}if(l.direction?(l.charDirection="ltr"===l.direction?d.Render.TextDirection.LTR:"rtl"===l.direction?d.Render.TextDirection.RTL:"inherit"===l.direction?d.Render.TextDirection.INHERIT:null,delete l.direction):l.charDirection=d.Render.TextDirection.DEFAULT,n.getFirstChildElem(o)){var g=t.GROUP,f=n.getChildNodesOfTypes(o,[Node.ELEMENT_NODE,Node.TEXT_NODE]),m=[],C=!1;for(u=0,c=f.length;u<c;++u){var y=f[u],_=e(y,!1);y.nodeType===Node.ELEMENT_NODE&&("br"===y.tagName.toLowerCase()&&(m.push("br"),C=!0),i.isBlockElem(y)&&(C=!0,_._isLine=!0)),_&&m.push(_)}if(C){var E=[],T=[];for(u=0,c=m.length;u<c;++u)if((_=m[u])._isLine||"br"==_){if(T.length){if(T.length>1){var O=r.createGroup();r.appendItems(O,T),E.push(O)}else E.push(T[0]);T=[]}_._isLine&&(delete _._isLine,E.push(_))}else T.push(_);T.length&&(T.length>1?(O=r.createGroup(),r.appendItems(O,T),E.push(O)):E.push(T[0])),m=E}C&&(g=t.LINES);var v=r.createGroup(g,l);for(u=0,c=m.length;u<c;++u)r.append(v,m[u]);return v}var S=n.getElementText(o),b=o.tagName.toLowerCase();return l.textType="sub"===b?t.SUB:"sup"===b?t.SUP:t.NORMAL,S?r.createSection(S,l):null}}(e,!0)}},d.Render.ChemDisplayTextUtils={RADICAL_LABELS:["","\u2022\u2022","\u2022","\u2022\u2022"],RADICAL_TRIPLET_ALTER_LABEL:"^^",getRadicalDisplayText:function(e,t){return t&&e===d.RadicalOrder.TRIPLET?d.Render.ChemDisplayTextUtils.RADICAL_TRIPLET_ALTER_LABEL:d.Render.ChemDisplayTextUtils.RADICAL_LABELS[e]},getChargeDisplayText:function(e,t,r){var n="";if(e&&(!t||Math.abs(e)>Math.pow(10,-t)/2)){var i=e>0?"+":"-",o=Math.abs(e);1!=o?n+=t?d.NumUtils.toDecimals(o,t):o.toString():r===d.Render.ChargeMarkRenderType.CIRCLE_AROUND&&(i=e>0?"\u2295":"\u2296"),n+=i}return n},createElectronStateDisplayTextSection:function(e,t,r,n,i){var o=null,a="";return e&&(a=d.Render.ChemDisplayTextUtils.getChargeDisplayText(e,r,n)),t&&(a+=d.Render.ChemDisplayTextUtils.getRadicalDisplayText(t,i)||""),a&&(o=d.Render.RichTextUtils.createSection(a,{textType:d.Render.RichText.SUP,charDirection:d.Render.TextDirection.LTR})),o},formulaToRichText:function(e,t,r,n,i,o,a){return d.Render.ChemDisplayTextUtils._convFormulaToRichTextGroup(e,!1,t,r,n,i,o,a)},_convFormulaToRichTextGroup:function(e,t,r,n,i,o,a,s){var l=d.Render.RichTextUtils.createGroup(),u=e.getSections();if(t){var c=e.getMaxNestedLevel()%d.FormulaUtils.FORMULA_BRACKET_TYPE_COUNT,h=d.FormulaUtils.FORMULA_BRACKETS[c][0],p=d.FormulaUtils.FORMULA_BRACKETS[c][1];l=d.Render.RichTextUtils.appendText(l,h)}for(var g=0,f=u.length;g<f;++g){var m=u[g].obj,C=e.getSectionCharge(u[g]),y=null;m instanceof d.MolecularFormula?y=d.Render.ChemDisplayTextUtils._convFormulaToRichTextGroup(m,!0,!1,!1,i,o,a):m.getDisplayRichText&&(y=m.getDisplayRichText(d.Render.HydrogenDisplayLevel.NONE,!1,null,o,i,a)),y&&(1!=u[g].count&&((y=d.Render.RichTextUtils.appendText(y,u[g].count.toString(),{textType:d.Render.RichText.SUB})).charDirection=d.Render.TextDirection.LTR),r&&C&&(_=d.Render.ChemDisplayTextUtils.createElectronStateDisplayTextSection(C,null,i,a,s))&&d.Render.RichTextUtils.append(y,_),l=d.Render.RichTextUtils.append(l,y))}if(t&&(l=d.Render.RichTextUtils.appendText(l,p)),r||n){C=e.getCharge();var _,E=e.getRadical();(_=d.Render.ChemDisplayTextUtils.createElectronStateDisplayTextSection(C,E,i,a))&&d.Render.RichTextUtils.append(l,_)}return l}},d.Render.TextDrawUtils={isHorizontalLine:function(e){return e==d.Render.TextDirection.LTR||e==d.Render.TextDirection.RTL||null==e},isVerticalLine:function(e){return e==d.Render.TextDirection.TTB||e==d.Render.TextDirection.BTT},getOppositeDirection:function(e){var t=d.Render.TextDirection;switch(e){case t.LTR:return t.RTL;case t.RTL:return t.LTR;case t.TTB:return t.BTT;case t.BTT:return t.TTB}},isOppositeDirection:function(e,t){return d.Render.TextDrawUtils.getOppositeDirection(e)===t},getActualDirection:function(e,t){var r=d.Render.TextDirection;return e===r.LINE_BREAK?t===r.TTB||t===r.BTT?r.LTR:t===r.LTR||t===r.RTL?r.TTB:e:e},getActualAlign:function(e,t){var r=d.Render.TextAlgin,n=d.Render.TextDirection;switch(e){case r.LEFT:case r.RIGHT:case r.TOP:case r.BOTTOM:case r.CENTER:return e;case r.LEADING:switch(t){case n.TTB:return r.TOP;case n.BTT:return r.BOTTOM;case n.RTL:return r.RIGHT;case n.LTR:default:return r.LEFT}case r.TRAILING:switch(t){case n.BTT:return r.TOP;case n.TTB:return r.BOTTOM;case n.RTL:return r.LEFT;case n.LTR:default:return r.RIGHT}}}},d.Render.DrawPathUtils={makePath:function(){for(var e,t=[],r=null,n=[],i=0,o=arguments.length;i<o;++i){var a=arguments[i];DataType.isArrayValue(a)?n=n.concat(a):"number"==typeof a?n.push(a):(r&&(e={method:r,params:n},t.push(e),r=null,n=[]),r=a.toString()),i===o-1&&r&&(e={method:r,params:n},t.push(e))}return t}},d.Render.ConnectorDrawUtils={getPossibleConnectorRenderTypes:function(e){if(e instanceof d.Bond)return d.Render.ConnectorDrawUtils.getPossibleBondRenderTypes(e);var t=d.Render.BondRenderType;return[t.SINGLE,t.DASHED,t.WAVY]},getDefConnectorRenderType:function(e){return d.Render.ConnectorDrawUtils.getPossibleConnectorRenderTypes(e)[0]},getPossibleBondRenderTypes:function(e){var t=d.Render.BondRenderType,r=d.BondType;switch(e.getBondType()){case r.HYDROGEN:return[t.DASHED,t.ARROWED,t.WAVY];case r.COORDINATE:return[t.ARROWED,t.SINGLE,t.DASHED,t.WAVY];case r.IONIC:case r.METALLIC:case r.UNKNOWN:return[t.SINGLE,t.DASHED,t.WAVY];case r.COVALENT:break;default:return[t.SINGLE,t.DASHED,t.ARROWED,t.WAVY]}if(e.getConnectedObjCount()>2)return[t.DASHED,t.SINGLE];var n=d.BondOrder;switch(e.getBondOrder()){case n.DOUBLE:var i=[t.DOUBLE,t.DASHED_DOUBLE,t.BOLD_DOUBLE,t.WAVY];return e.getStereo&&[d.BondStereo.E_OR_Z,d.BondStereo.CIS_OR_TRANS].indexOf(e.getStereo())>=0&&i.unshift(t.SCISSORS_DOUBLE),i;case n.TRIPLE:return[t.TRIPLE,t.BOLD_TRIPLE,t.WAVY];case n.QUAD:return[t.QUAD,t.BOLD_QUAD,t.WAVY];case n.EXPLICIT_AROMATIC:return[t.SOLID_DASH,t.WAVY];case n.SINGLE:var o=d.BondStereo,a=[t.SINGLE,t.BOLD,t.WAVY];switch(e.getStereo()){case o.UP:a.unshift(t.WEDGED_SOLID,t.WEDGED_HOLLOW);break;case o.UP_INVERTED:a.unshift(t.WEDGED_SOLID_INV,t.WEDGED_HOLLOW_INV);break;case o.DOWN:a.unshift(t.WEDGED_HASHED,t.DASHED);break;case o.DOWN_INVERTED:a.unshift(t.WEDGED_HASHED_INV,t.DASHED);break;case o.UP_OR_DOWN:case o.UP_OR_DOWN_INVERTED:a=[t.WAVY,t.SINGLE];break;case o.CLOSER:a=[t.WEDGED_SOLID_BOTH,t.WEDGED_HOLLOW_BOTH]}return a;default:return[t.SINGLE,t.DASHED,t.ARROWED,t.WAVY]}},getDefBondRenderType:function(e){return d.Render.ConnectorDrawUtils.getPossibleBondRenderTypes(e)[0]},getConnectorRender3DType:function(e,t){var r=d.Render.Bond3DRenderType,n=d.Render.Bond3DRenderMode;return(!t||t!==n.WIRE&&t!==n.CYLINDER)&&e instanceof d.Bond?d.Render.ConnectorDrawUtils.getBondRender3DTypes(e):r.SINGLE},getBondRender3DTypes:function(e){var t=d.Render.Bond3DRenderType,r=d.BondType;switch(e.getBondType()){case r.HYDROGEN:return t.DASH;case r.COVALENT:break;default:return t.SINGLE}var n=d.BondOrder;switch(e.getBondOrder()){case n.DOUBLE:return t.DOUBLE;case n.TRIPLE:return t.TRIPLE;case n.EXPLICIT_AROMATIC:return t.SOLID_DASH;default:return t.SINGLE}}},d.Render.ObjUtils={getContainerBox:function(e,t,r){var n;t||(t=d.CoordMode.COORD2D);var i=e;if(i.getExposedContainerBox)n=i.getExposedContainerBox(t,r);else if(i.getContainerBox)n=i.getContainerBox(t,r);else{var o=i.getAbsCoordOfMode?i.getAbsCoordOfMode(t):null;n=o?d.BoxUtils.createBox(o,o):null}return n}},d.Render.MetaShapeUtils={createShapeInfo:function(e,t,r){var n={shapeType:e,coords:t};return r&&(n=Object.extend(n,r)),n},isCompositeShape:function(e){return DataType.isArrayValue(e)},inflateShape:function(e,t){if(!e)return null;var r,n=d.Render.MetaShapeType,i=d.Render.MetaShapeUtils;if(i.isCompositeShape(e)){for(var o=[],a=0,s=e.length;a<s;++a){var l=e[a],u=i.inflateShape(l,t);o.push(u)}return o}switch(e.shapeType){case n.POINT:r=i._inflatePointShape(e,t);break;case n.CIRCLE:r=i._inflateCircleShape(e,t);break;case n.LINE:r=i._inflateLineShape(e,t);break;case n.RECT:r=i._inflateRectShape(e,t);break;case n.POLYGON:r=i._inflatePolygonShape(e,t);break;case n.ARC:r=i._inflateArcShape(e,t)}return r},_inflatePointShape:function(e,t){return d.Render.MetaShapeUtils.createShapeInfo(d.Render.BoundShapeType.CIRCLE,[e.coords[0]],{radius:t})},_inflateCircleShape:function(e,t){return d.Render.MetaShapeUtils.createShapeInfo(d.Render.BoundShapeType.CIRCLE,[e.coords[0]],{radius:e.radius+t})},_inflateLineShape:function(e,t){return d.Render.MetaShapeUtils.createShapeInfo(d.Render.BoundShapeType.LINE,[e.coords[0],e.coords[1]],{width:(e.width||0)+2*t})},_inflateArcShape:function(e,t){var r=Object.extend({},e);return r.width=(e.width||0)+2*t,r},_inflateRectShape:function(e,t){var r=d.Render.MetaShapeUtils.createShapeInfo(d.Render.BoundShapeType.RECT,[]),n=d.Render.MetaShapeUtils._inflateCoords(e.coords,t);return r.coords=n,r},_inflatePolygonShape:function(e,t){var r=d.Render.MetaShapeUtils.createShapeInfo(d.Render.BoundShapeType.POLYGON,[]),n=d.Render.MetaShapeUtils._inflateCoords(e.coords,t);return r.coords=n,r},_inflateCoords:function(e,t){for(var r=d.CoordUtils,n=[],i=r.getCenter(e),o=0,a=e.length;o<a;++o){var s=e[o],l=r.substract(s,i),u=r.getDistance(l),c=r.multiply(l,t/u),h=r.add(s,c);n.push(h)}return n},getDistance:function(e,t,r){if(d.Render.MetaShapeUtils.isCompositeShape(t)){for(var n=null,i=0,o=t.length;i<o;++i){var a=t[i],s=d.Render.MetaShapeUtils.getDistance(e,a,r);(null===n||n>s)&&(n=s)}return n}var l=d.Render.MetaShapeType,u=d.Render.MetaShapeUtils,c=r?u.inflateShape(t,r):t;switch(t.shapeType){case l.POINT:return r?u._getDistanceToCircle(e,c):u._getDistanceToPoint(e,c);case l.CIRCLE:return u._getDistanceToCircle(e,c);case l.LINE:return u._getDistanceToLine(e,c);case l.RECT:return u._getDistanceToRect(e,c);case l.POLYGON:return u._getDistanceToPolygon(e,c);case l.ARC:return u._getDistanceToArc(e,c);default:return!1}},_getDistanceToPoint:function(e,t){return d.CoordUtils.getDistance(e,t.coords[0])},_getDistanceToCircle:function(e,t){return d.CoordUtils.getDistance(e,t.coords[0])-t.radius},_getDistanceToArc:function(e,t){var r=d.CoordUtils,n=r.substract(e,t.coords[0]),i=Math.atan2(n.y,n.x);if(d.Render.MetaShapeUtils.isAngleInArcRange(i,t.startAngle,t.endAngle,t.anticlockwise)){var o=r.getDistance(e,t.coords[0]);return o=Math.abs(o-t.radius),t.width&&t.width>1&&(o-=t.width/2),Math.max(0,o)}var a,s=t.coords[0];a=t.width&&t.width>1?[t.radius-t.width/2,t.radius+t.width/2]:[t.radius];for(var l=[],u=t.startAngle,c=t.endAngle,h=0,p=a.length;h<p;++h){var g=a[h],f=r.add(s,{x:g*Math.cos(u),y:g*Math.sin(u)}),m=r.add(s,{x:g*Math.cos(c),y:g*Math.sin(c)});l.push(f),l.push(m)}var C=null;for(h=0,p=l.length;h<p;++h)o=r.getDistance(l[h],e),(null===C||C>o)&&(C=o);return C},_getDistanceToLine:function(e,t){var r=d.Render.MetaShapeUtils,n=t.coords,i=d.Render.MetaShapeUtils._calcVerticalLineCrossPoint(e,n[0],n[1]),o=d.NumUtils;if(o.isFloatEqual(n[0].x,n[1].x)&&o.isFloatEqual(n[0].y,n[1].y)){var a={coords:[t.coords[0]],radius:t.width};return r._getDistanceToCircle(e,a)}var s=d.CoordUtils.substract(n[1],n[0]);if(Math.abs(s.y)>Math.abs(s.x)?Math.sign(i.y-n[0].y)*Math.sign(i.y-n[1].y)<=0:Math.sign(i.x-n[0].x)*Math.sign(i.x-n[1].x)<=0)return d.CoordUtils.getDistance(e,i)-(t.width||0)/2;var l={coords:[t.coords[0]],radius:t.width||0},u={coords:[t.coords[1]],radius:t.width||0},c=r._getDistanceToCircle(e,l),h=r._getDistanceToCircle(e,u);return Math.min(c,h)},_getDistanceToRect:function(e,t){var r=t.coords,n=d.Render.MetaShapeUtils,i=Object.extend({},t);return i.shapeType=d.Render.MetaShapeType.POLYGON,i.coords=[{x:r[0].x,y:r[0].y},{x:r[1].x,y:r[0].y},{x:r[1].x,y:r[1].y},{x:r[0].x,y:r[1].y}],n._getDistanceToPolygon(e,i)},_getDistanceToPolygon:function(e,t){d.CoordUtils;for(var r=d.Render.MetaShapeUtils,n=d.Render.MetaShapeType,i=r._isInsidePolygon(e,t),o=t.coords,a=null,s=0,l=o.length;s<l;++s){var u=o[s],c=o[(s+1)%l],h=r.createShapeInfo(n.LINE,[u,c],{width:0}),p=r._getDistanceToLine(e,h);(null===a||a>p)&&(a=p)}return i&&(a=-a),a},_getDistanceOfTwoLines:function(e,t){d.Render.MetaShapeUtils;var r=d.GeometryUtils;if(r.getCrossPointOfLines(e[0],e[1],t[0],t[1]))return 0;var n=r.getDistanceFromPointToLine(e[0],t[0],t[1]),i=r.getDistanceFromPointToLine(e[1],t[0],t[1]),o=r.getDistanceFromPointToLine(t[0],e[0],e[1]),a=r.getDistanceFromPointToLine(t[1],e[0],e[1]);return Math.min(n,i,o,a)},isCoordInside:function(e,t,r){if(!e)return!1;if(d.Render.MetaShapeUtils.isCompositeShape(t)){for(var n=0,i=t.length;n<i;++n){var o=t[n];if(d.Render.MetaShapeUtils.isCoordInside(e,o,r))return!0}return!1}var a=d.Render.MetaShapeType,s=d.Render.MetaShapeUtils,l=r?s.inflateShape(t,r):t;if(!l)return!1;switch(t.shapeType){case a.POINT:return r?s._isInsideCircle(e,l):s._isInsidePoint(e,l);case a.CIRCLE:return s._isInsideCircle(e,l);case a.LINE:return s._isInsideLine(e,l);case a.RECT:return s._isInsideRect(e,l);case a.POLYGON:return s._isInsidePolygon(e,l);case a.ARC:return s._isInsideArc(e,l);default:return!1}},_isInsidePoint:function(e,t){return d.CoordUtils.isEqual(e,t.coords[0])},_isInsideCircle:function(e,t){return d.CoordUtils.getDistance(e,t.coords[0])<=t.radius},_isInsideLine:function(e,t){var r=t.coords,n=d.Render.MetaShapeUtils._calcVerticalLineCrossPoint(e,r[0],r[1]),i=d.NumUtils;if(i.isFloatEqual(r[0].x,r[1].x)&&i.isFloatEqual(r[0].y,r[1].y)){var o={coords:[t.coords[0]],radius:t.width};return d.Render.MetaShapeUtils._isInsideCircle(e,o)}var a=d.CoordUtils.substract(r[1],r[0]);return!!(Math.abs(a.y)>Math.abs(a.x)?Math.sign(n.y-r[0].y)*Math.sign(n.y-r[1].y)<=0:Math.sign(n.x-r[0].x)*Math.sign(n.x-r[1].x)<=0)&&d.CoordUtils.getDistance(e,n)<=t.width/2},_isInsideArc:function(e,t){var r=d.CoordUtils,n=d.GeometryUtils,i=r.getDistance(e,t.coords[0]),o=Math.abs(i-t.radius)<t.width/2;if(o){var a=r.substract(e,t.coords[0]),s=n.standardizeAngle(Math.atan2(a.y,a.x),0);o=d.Render.MetaShapeUtils.isAngleInArcRange(s,t.startAngle,t.endAngle,t.anticlockwise)}return o},_isInsideRect:function(e,t){var r=t.coords;return d.CoordUtils.insideRect(e,r[0],r[1])},_isInsidePolygon:function(e,t){for(var r=e.x,n=e.y,i=t.coords,o={x:i[0].x,y:i[0].y},a={x:i[0].x,y:i[0].y},s=1,l=i.length;s<l;++s){var u=i[s];u.x<o.x?o.x=u.x:u.x>a.x&&(a.x=u.x),u.y<o.y?o.y=u.y:u.y>a.y&&(a.y=u.y)}if(!d.CoordUtils.insideRect(e,o,a))return!1;for(var c=!1,h=(s=0,(l=i.length)-1);s<l;++s){var p=i[s],g=i[h];(p.y<n&&g.y>=n||g.y<n&&p.y>=n)&&(p.x<=r||g.x<=r)&&p.x+(n-p.y)/(g.y-p.y)*(g.x-p.x)<r&&(c=!c),h=s}return c},_calcVerticalLineCrossPoint:function(e,t,r){var n={};if(Math.abs(t.x-r.x)<1e-10)n.x=t.x,n.y=e.y;else{var i=(r.y-t.y)/(r.x-t.x);n.x=(i*i*t.x+i*(e.y-t.y)+e.x)/(i*i+1),n.y=i*(n.x-t.x)+t.y}return n},getContainerBox:function(e,t){var r=d.Render.MetaShapeType,n=d.Render.MetaShapeUtils,i=d.BoxUtils;if(!e)return null;var o,a=e.coords;if(t=t||0,n.isCompositeShape(e)){o=null;for(var s=0,l=e.length;s<l;++s){var u=e[s],c=n.getContainerBox(u);o=o?i.getContainerBox(o,c):c}}else switch(e.shapeType){case r.POINT:case r.CIRCLE:var h=e.shapeType===r.POINT?0:e.radius||0,p=a[0];o=i.createBox({x:p.x-h,y:p.y-h},{x:p.x+h,y:p.y+h});break;case r.LINE:o=i.createBox(a[0],a[1]),o=d.BoxUtils.inflateBox(o,(e.width||0)/2);break;case r.ARC:o=d.Render.MetaShapeUtils._getArcContainerBox(e);break;case r.RECT:o=i.createBox(a[0],a[1]);break;case r.POLYGON:for(o=i.createBox(a[0],a[0]),s=1,l=a.length;s<l;++s)p=a[s],o={x1:Math.min(o.x1,p.x),y1:Math.min(o.y1,p.y),x2:Math.max(o.x2,p.x),y2:Math.max(o.y2,p.y)}}return t&&(o=d.BoxUtils.inflateBox(o,t)),o},_getArcContainerBox:function(e){var t,r=d.Render.MetaShapeUtils,n=d.CoordUtils;t=e.width&&e.width>1?[e.radius+e.width/2,e.radius-e.width/2]:[e.radius];for(var i=e.coords[0],o=Math.PI/2,a=function(e,t){return n.add(i,{x:t*Math.cos(e),y:t*Math.sin(e)})},s=[],l=0,u=t.length;l<u;++l){var c=t[l],h=a(e.startAngle,c),p=a(e.endAngle,c);s=s.concat([h,p]);for(var g=[0,o,2*o,3*o],f=0,m=g.length;f<m;++f)r.isAngleInArcRange(g[f],e.startAngle,e.endAngle,e.anticlockwise)&&s.push(a(g[f],c))}return n.getContainerBox(s)},isAngleInArcRange:function(e,t,r,n){var i=d.GeometryUtils.standardizeAngle,o=i(t),a=i(r),s=i(e),l=Math.sign(s-o)*Math.sign(s-a)*Math.sign(a-o);return n?l>=0:l<=0},isIntersectingLine:function(e,t,r){var n=d.Render.MetaShapeType,i=d.Render.MetaShapeUtils;if(i.isCompositeShape(e)){for(var o=0,a=e.length;o<a;++o){var s=e[o];if(i.isIntersectingLine(s,t,r))return!0}return!1}var l=i.createShapeInfo(n.LINE,t),u=r/2,c=e.coords;switch(e.shapeType){case n.POINT:return(p=i._getDistanceToLine(c[0],l))<=u;case n.CIRCLE:return(p=i._getDistanceToLine(c[0],l))<=u+(l.radius||0);case n.LINE:return(p=i._getDistanceOfTwoLines(c,t))<=u+(l.width||0);case n.RECT:case n.POLYGON:var h=i._getCoordsForShapeInComparingWithPolygon(e),p=null,g=h.length-1;for(o=0,a=h.length;o<a;++o){var f=[h[o],h[g]],m=i._getDistanceOfTwoLines(f,t);(null===p||m<p)&&(p=m),g=o}return p<=u}return!1},isInsideBox:function(e,t){var r=d.Render.MetaShapeUtils.getContainerBox(e);return d.BoxUtils.isInside(r,t)},isIntersectingBox:function(e,t){if(!d.Render.MetaShapeUtils.isCompositeShape(e)){var r=e.coords;for(i=0,o=r.length;i<o;++i){var n=r[i];if(d.CoordUtils.isInsideBox(n,t))return!0}return!1}for(var i=0,o=e.length;i<o;++i){var a=e[i];if(d.Render.MetaShapeUtils.isIntersectingBox(a,t))return!0}},isPointInsidePolygon:function(e,t){for(var r=!1,n=t.length,i=n-1,o=0;o<n;++o)t[o].y>e.y!=t[i].y>e.y&&e.x<(t[i].x-t[o].x)*(e.y-t[o].y)/(t[i].y-t[o].y)+t[o].x&&(r=!r),i=o;return r},isInsidePolygon:function(e,t){var r=d.Render.MetaShapeUtils,n=r._getCoordsForShapeInComparingWithPolygon(e);if(!n)return!1;for(var i=0,o=n.length;i<o;++i){var a=n[i];if(!r.isPointInsidePolygon(a,t))return!1}return!0},isIntersectingPolygon:function(e,t){var r=d.Render.MetaShapeUtils,n=r._getCoordsForShapeInComparingWithPolygon(e);if(!n)return!1;for(var i=0,o=n.length;i<o;++i){var a=n[i];if(r.isPointInsidePolygon(a,t))return!0}return!1},isIntersectingPolyline:function(e,t,r){for(var n=d.Render.MetaShapeUtils,i=0,o=t.length-1;i<o;++i){var a=[t[i],t[i+1]];if(n.isIntersectingLine(e,a,r))return!0}return!1},_getCoordsForShapeInComparingWithPolygon:function(e){var t,r=d.Render.MetaShapeType,n=d.Render.MetaShapeUtils;if(n.isCompositeShape(e)){t=[];for(var i=0,o=e.length;i<o;++i){var a=e[i],s=n._getCoordsForShapeInComparingWithPolygon(a);t=t.concat(s)}return t}var l=e.coords;switch(e.shapeType){case r.POINT:t=[l[0]];break;case r.CIRCLE:var u=e.radius||0;if(u){var c=u,h=c/Math.sqrt(2);t=[{x:c,y:0},{x:h,y:h},{x:0,y:c},{x:-h,y:h},{x:-c,y:0},{x:-h,y:-h},{x:0,y:-c},{x:h,y:-h}]}else t=[l[0]];break;case r.LINE:t=[l[0],l[1]];break;case r.RECT:var p=l[0],g=l[1];t=[p,{x:g.x,y:p.y},g,{x:p.x,y:g.y}];break;case r.POLYGON:t=l}return t},getEdgeVectors:function(e){var t,r=d.Render.MetaShapeType,n=d.Render.MetaShapeUtils,i=d.CoordUtils;if(n.isCompositeShape(e)){t=[];for(var o=0,a=e.length;o<a;++o){var s=e[o],l=n.getEdgeVectors(s);t=t.concat(l)}return t}var u=e.coords;switch(e.shapeType){case r.POINT:t=[[u[0],u[0]]];break;case r.CIRCLE:t=null;break;case r.LINE:var c=e.width;if(c){var h=u[0],p=u[1],g=i.substract(p,h),f=i.getDistance(h,p),m=c/2,C=m*(g.y/f),y=m*(g.x/f),_=[{x:h.x-C,y:h.y+y},{x:h.x+C,y:h.y-y},{x:p.x+C,y:p.y-y},{x:p.x-C,y:p.y+y}];t=[[_[0],_[1]],[_[1],_[2]],[_[2],_[3]],[_[3],_[0]]]}else t=[[u[0],u[1]]];break;case r.RECT:var E=u[0],T=(h={x:(p=u[1]).x,y:E.y},{x:E.x,y:p.y});t=[[E,h],[h,p],[p,T],[T,E]];break;case r.POLYGON:for(t=[],o=0,a=u.length-1;o<a;++o){var O=++o;O>=a&&(O=0),t.push([u[o],u[O]])}}return t},getEdgeBasicElements:function(e){var t=d.Render.MetaShapeType,r=d.Render.MetaShapeUtils,n={vectors:[],circles:[]};if(r.isCompositeShape(e)){for(var i=0,o=e.length;i<o;++i){var a=e[i],s=r.getEdgeBasicElements(a);n.vectors=n.concat(s.vectors),n.circles=n.concat(s.circles)}return n}var l=e.coords;switch(e.shapeType){case t.POINT:n.circles.push({center:l[0],radius:0});break;case t.CIRCLE:n.circles.push({center:l[0],radius:e.radius});break;default:n.vectors=n.vectors.concat(d.Render.MetaShapeUtils.getEdgeVectors(e))}return n},getCrossPointsOfVectorToShapeEdges:function(e,t,r,n){for(var i=d.Render.MetaShapeUtils.getEdgeBasicElements(t),o=i.vectors,a=i.circles,s=[],l=0,u=o.length;l<u;++l){var c=o[l],h=d.GeometryUtils.getCrossPointOfVectors(e,c);if(h&&(s.push(h),r))return s}for(l=0,u=a.length;l<u;++l){var p=a[l],g=d.GeometryUtils.getCrossPointsOfVectorToCircle(e,p.center,p.radius,n);if(g&&g.length&&(s=s.concat(g),r))return s}return s}},d.Render.RenderOptionUtils={getOptionDefinitions:function(){return[{name:"expanded",dataType:DataType.BOOL,targetClass:d.StructureFragment},{name:"unitLength",dataType:DataType.FLOAT,targetClass:d.ChemObject},{name:"moleculeDisplayType",dataType:DataType.INT,enumSource:d.Render.MoleculeDisplayType,targetClass:d.StructureFragment},{name:"renderType",dataType:DataType.INT,enumSource:d.Render.BondRenderType,targetClass:d.ChemStructureConnector},{name:"nodeDisplayMode",dataType:DataType.INT,enumSource:d.Render.NodeLabelDisplayMode,targetClass:d.ChemStructureNode},{name:"hydrogenDisplayLevel",dataType:DataType.INT,enumSource:d.Render.HydrogenDisplayLevel,targetClass:d.ChemStructureNode},{name:"showCharge",dataType:DataType.BOOL,targetClass:d.ChemStructureNode},{name:"chargeMarkType",dataType:DataType.INT,enumSource:d.Render.ChargeMarkRenderType,targetClass:d.ChemStructureNode},{name:"chargeMarkFontSize",dataType:DataType.FLOAT,targetClass:d.ChemStructureNode},{name:"chargeMarkMargin",dataType:DataType.FLOAT,targetClass:d.ChemStructureNode},{name:"chemMarkerFontSize",dataType:DataType.FLOAT,targetClass:d.ChemStructureNode},{name:"chemMarkerMargin",dataType:DataType.FLOAT,targetClass:d.ChemStructureNode},{name:"distinguishSingletAndTripletRadical",dataType:DataType.BOOL,targetClass:d.ChemStructureNode},{name:"fontSize",dataType:DataType.NUMBER},{name:"fontFamily",dataType:DataType.STRING},{name:"supFontSizeRatio",dataType:DataType.FLOAT},{name:"subFontSizeRatio",dataType:DataType.FLOAT},{name:"superscriptOverhang",dataType:DataType.FLOAT},{name:"subscriptOversink",dataType:DataType.FLOAT},{name:"textBoxXAlignment",dataType:DataType.INT,enumSource:d.Render.BoxXAlignment},{name:"textBoxYAlignment",dataType:DataType.INT,enumSource:d.Render.BoxYAlignment},{name:"horizontalAlign",dataType:DataType.INT,enumSource:d.Render.TextAlign},{name:"verticalAlign",dataType:DataType.INT,enumSource:d.Render.TextAlign},{name:"charDirection",dataType:DataType.INT,enumSource:d.Render.TextDirection},{name:"customLabel",dataType:DataType.STRING,targetClass:d.ChemStructureNode},{name:"bondLineWidth",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject},{name:"boldBondLineWidth",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject},{name:"hashSpacing",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject},{name:"multipleBondSpacingRatio",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject},{name:"multipleBondSpacingAbs",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject},{name:"multipleBondMaxAbsSpacing",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject},{name:"bondArrowLength",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject},{name:"bondArrowWidth",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject},{name:"bondWedgeWidth",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject},{name:"bondWedgeHashMinWidth",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject},{name:"bondLengthScaleRatio",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject},{name:"color",dataType:DataType.STRING},{name:"atomColor",dataType:DataType.STRING,targetClass:d.ChemStructureNode},{name:"bondColor",dataType:DataType.STRING,targetClass:d.ChemStructureObject},{name:"useAtomSpecifiedColor",dataType:DataType.BOOL,targetClass:d.ChemStructureObject},{name:"opacity",dataType:DataType.FLOAT,targetClass:d.ChemObject},{name:"fillColor",dataType:DataType.STRING},{name:"strokeColor",dataType:DataType.STRING},{name:"strokeWidth",dataType:DataType.NUMBER},{name:"atomRadius",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject}]},mergeObjLocalRenderOptions:function(e,t){var r=e&&e.getOverriddenRenderOptions?e.getOverriddenRenderOptions():null;return d.Render.RenderOptionUtils.mergeRenderOptions(r||{},t)},mergeObjLocalRender3DOptions:function(e,t){var r=e&&e.getOverriddenRender3DOptions?e.getOverriddenRender3DOptions():null;return d.Render.RenderOptionUtils.mergeRenderOptions(r||{},t)},mergeRenderOptions:function(e,t){var r=Object.create(t);return Object.extend(r,e,!0,!0)},getColor:function(e){return e?e.color:null},getMoleculeDisplayType:function(e){return e?e.moleculeDisplayType:null},getNodeDisplayMode:function(e){return e?e.nodeDisplayMode:null},getHydrogenDisplayLevel:function(e){return e?e.hydrogenDisplayLevel:null},getShowCharge:function(e){return e?e.showCharge:null},getChargeDrawOptions:function(e){return e?Object.copyValues({},e,["showCharge","chargeMarkType","chargeMarkFontSize","chargeMarkMargin","chargeMarkCircleWidth","color","opacity"]):null},getNodeLabelDrawOptions:function(e){return e?Object.copyValues({},e,["fontSize","fontFamily","supFontSizeRatio","subFontSizeRatio","superscriptOverhang","subscriptOversink","textBoxXAlignment","textBoxYAlignment","color","opacity"]):null},getConnectorRenderType:function(e){return e?e.renderType:null},getConnectorDrawParams:function(e){return e?Object.copyValues({},e,["bondLineWidth","boldBondLineWidth","hashSpacing","multipleBondSpacingRatio","multipleBondSpacingAbs","multipleBondMaxAbsSpacing","bondArrowLength","bondArrowWidth","bondWedgeWidth","bondWedgeHashMinWidth","color","opacity"]):null},convertConfigsToPlainHash:function(e){var t=d.Render.RenderOptionUtils;return e instanceof d.Render.Render3DConfigs?t.convert3DConfigsToPlainHash(e):t.convert2DConfigsToPlainHash(e)},convert2DConfigsToPlainHash:function(e){var t=d.ObjUtils,r={};r._configs=e;var n=e.getGeneralConfigs().toHash();return t.replacePropName(n,"drawOpacity","opacity"),r=Object.extend(r,n),n=e.getMoleculeDisplayConfigs().toHash(),t.replacePropName(n,"defMoleculeDisplayType","moleculeDisplayType"),t.replacePropName(n,"defNodeDisplayMode","nodeDisplayMode"),t.replacePropName(n,"defHydrogenDisplayLevel","hydrogenDisplayLevel"),t.replacePropName(n,"defChargeMarkType","chargeMarkType"),(r=Object.extend(r,n)).displayLabelConfigs=e.getDisplayLabelConfigs(),n=e.getTextFontConfigs().toHash(),r=Object.extend(r,n),n=e.getLengthConfigs().toHash(),(r=Object.extend(r,n)).unitLength=r.unitLength||1,n=e.getColorConfigs().toHash(),Object.extend(r,n)},convert3DConfigsToPlainHash:function(e){var t=d.ObjUtils,r={};r._configs=e;var n=e.getGeneralConfigs().toHash();return t.replacePropName(n,"drawOpacity","opacity"),r=Object.extend(r,n),n=e.getEnvironmentConfigs().toHash(),r=Object.extend(r,n),n=e.getMoleculeDisplayConfigs().toHash(),t.replacePropName(n,"defMoleculeDisplayType","moleculeDisplayType"),t.replacePropName(n,"defBondSpliceMode","bondSpliceMode"),t.replacePropName(n,"defDisplayMultipleBond","displayMultipleBond"),t.replacePropName(n,"defBondColor","bondColor"),t.replacePropName(n,"defAtomColor","atomColor"),r=Object.extend(r,n),n=e.getModelConfigs().toHash(),r=Object.extend(r,n),n=e.getLengthConfigs().toHash(),Object.extend(r,n)},getCascadeRenderOptionValueOfObjs:function(e,t,r){for(var n,i=!1,o=d.ArrayUtils.toArray(e),a=r?"getCascadedRender3DOption":"getCascadedRenderOption",s=0,l=o.length;s<l;++s){var u=o[s];if(u[a]){var c=u[a](t);if(i){if(n!=c)return null}else n=c,i=!0}}return n},setRenderOptionValueOfObjs:function(e,t,r){for(var n=d.ArrayUtils.toArray(e),i=0,o=n.length;i<o;++i){var a=n[i];if(a.setRenderOption)for(var s=d.ObjUtils.getOwnedFieldNames(t),l=0,u=s.length;l<u;++l)a.setRenderOption(s[l],t[s[l]])}}},d.Render.Render3DOptionUtils={getOptionDefinitions:function(){return[{name:"displayMultipleBond",dataType:DataType.BOOL,targetClass:d.ChemStructureNode},{name:"useVdWRadius",dataType:DataType.BOOL,targetClass:d.ChemStructureNode},{name:"nodeRadius",dataType:DataType.NUMBER,targetClass:d.ChemStructureNode},{name:"connectorRadius",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject},{name:"nodeRadiusRatio",dataType:DataType.NUMBER,targetClass:d.ChemStructureNode},{name:"connectorRadiusRatio",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject},{name:"connectorLineWidth",dataType:DataType.NUMBER,targetClass:d.ChemStructureObject},{name:"color",dataType:DataType.STRING},{name:"atomColor",dataType:DataType.STRING,targetClass:d.ChemStructureObject},{name:"bondColor",dataType:DataType.STRING,targetClass:d.ChemStructureObject},{name:"useAtomSpecifiedColor",dataType:DataType.BOOL,targetClass:d.ChemStructureObject},{name:"hideHydrogens",dataType:DataType.BOOL,targetClass:d.StructureFragment},{name:"bondSpliceMode",dataType:DataType.INT,enumSource:d.Render.Bond3DSpliceMode,targetClass:d.ChemStructureObject}]},getConnectorRenderType:function(e){return e?e.renderType:null},convertConfigsToPlainHash:function(e){}},d.Render.RenderColorUtils={getActiveAtomColorSet:function(e){return d.Render.atomColors[e]},setActiveAtomColorSet:function(e,t){var r=d.Render.AtomColorSets[e];return r&&(d.Render.atomColorSet[t]=r),r},getColor:function(e,t){var r=d.Render.RenderColorUtils.getActiveAtomColorSet(t),n=r[e];return n||(n=r[0]),n}},d.Render.UpdateObjUtils={_extractObjsOfUpdateObjDetails:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r];i.obj&&d.ArrayUtils.pushUnique(t,i.obj)}return t},_createUpdateObjDetailsFromObjs:function(e){for(var t=[],r=0,n=e.length;r<n;++r)t.push({obj:e[r]});return t}},function(){"use strict";var e=d.OBJDEF_TEXTS,t=Class.PropertyScope;d.Render.PredefinedConfigsMap=Class.create(d.ConfigPresetMap,{CLASS_NAME:"Kekule.Render.PredefinedConfigsMap"}),d.Render.GeneralConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Render.GeneralConfigs",initProperties:function(){this.addBoolConfigProp("allowCoordBorrow",!0,{scope:t.PUBLIC}),this.addFloatConfigProp("drawOpacity",1,{title:e.TITLE_DRAWOPACITY,description:e.DES_DRAWOPACITY})}}),d.Render.Render2DConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render2DConfigs",initProperties:function(){this.addConfigProp("generalConfigs","Kekule.Render.GeneralConfigs"),this.addConfigProp("moleculeDisplayConfigs","Kekule.Render.MoleculeDisplayConfigs"),this.addConfigProp("displayLabelConfigs","Kekule.Render.DisplayLabelConfigs"),this.addConfigProp("textFontConfigs","Kekule.Render.TextFontConfigs"),this.addConfigProp("lengthConfigs","Kekule.Render.LengthConfigs"),this.addConfigProp("colorConfigs","Kekule.Render.ColorConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("generalConfigs",new d.Render.GeneralConfigs),this.setPropStoreFieldValue("moleculeDisplayConfigs",new d.Render.MoleculeDisplayConfigs),this.setPropStoreFieldValue("displayLabelConfigs",new d.Render.DisplayLabelConfigs),this.setPropStoreFieldValue("textFontConfigs",new d.Render.TextFontConfigs),this.setPropStoreFieldValue("lengthConfigs",new d.Render.LengthConfigs),this.setPropStoreFieldValue("colorConfigs",new d.Render.ColorConfigs),this.setPropStoreFieldValue("environmentConfigs",new d.Render.Render2DEnvironmentConfigs)},initInteractStyleMap:function(){}}),d.ClassUtils.makeSingleton(d.Render.Render2DConfigs),d.Render.getRender2DConfigs=function(){return d.Render.Render2DConfigs.getInstance()},d.Render.Render2DEnvironmentConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render2DEnvironmentConfigs",initProperties:function(){}}),d.Render.MoleculeDisplayConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Render.MoleculeDisplayConfigs",initProperties:function(){this.addIntConfigProp("defMoleculeDisplayType",d.Render.MoleculeDisplayType.SKELETAL,{enumSource:d.Render.MoleculeDisplayType}),this.addIntConfigProp("defNodeDisplayMode",d.Render.NodeLabelDisplayMode.SMART,{enumSource:d.Render.NodeLabelDisplayMode}),this.addIntConfigProp("defHydrogenDisplayLevel",d.Render.HydrogenDisplayLevel.DEFAULT,{enumSource:d.Render.HydrogenDisplayLevel}),this.addIntConfigProp("defChargeMarkType",d.Render.ChargeMarkRenderType.DEFAULT,{enumSource:d.Render.ChargeMarkRenderType}),this.addBoolConfigProp("distinguishSingletAndTripletRadical",!1),this.addIntConfigProp("partialChargeDecimalsLength",2),this.addBoolConfigProp("autoCreateChargeAndRadicalMarker",!0,{scope:Class.PropertyScope.PUBLIC}),this.addStrConfigProp("bondLineCap","round"),this.addStrConfigProp("bondLineJoin","miter"),this.addStrConfigProp("glyphLineCap","round"),this.addStrConfigProp("glyphLineJoin","miter")}}),d.Render.DisplayLabelConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Render.DisplayLabelConfigs",DEF_UNSET_ELEMENT:"?",DEF_DUMMY_ATOM:"Du",DEF_HETERO_ATOM:"Q",DEF_ANY_ATOM:"A",DEF_VARIABLE_ATOM:"L",DEF_RGROUP:"R",DEF_ISO_LIST_LEADING_BRACKET:"[",DEF_ISO_LIST_TAILING_BRACKET:"]",DEF_ISO_LIST_DELIMITER:",",DEF_ISO_LIST_DISALLOW_PREFIX:"NOT",initProperties:function(){var e=d.ChemStructureNodeLabels;this.addBoolConfigProp("enableIsotopeAlias",e.ENABLE_ISOTOPE_ALIAS,{getter:function(){return e.ENABLE_ISOTOPE_ALIAS},setter:function(t){e.ENABLE_ISOTOPE_ALIAS=t}}),this.addStrConfigProp("unsetElement",e.UNSET_ELEMENT,{getter:function(){return e.UNSET_ELEMENT},setter:function(t){t&&(e.UNSET_ELEMENT=t)}}),this.addStrConfigProp("dummyAtom",e.DUMMY_ATOM,{getter:function(){return e.DUMMY_ATOM},setter:function(t){t&&(e.DUMMY_ATOM=t)}}),this.addStrConfigProp("heteroAtom",e.HETERO_ATOM,{getter:function(){return e.HETERO_ATOM},setter:function(t){t&&(e.HETERO_ATOM=t)}}),this.addStrConfigProp("anyAtom",e.ANY_ATOM,{getter:function(){return e.ANY_ATOM},setter:function(t){t&&(e.ANY_ATOM=t)}}),this.addStrConfigProp("variableAtom",e.VARIABLE_ATOM,{getter:function(){return e.VARIABLE_ATOM},setter:function(t){t&&(e.VARIABLE_ATOM=t)}}),this.addStrConfigProp("rgroup",e.SUBGROUP,{getter:function(){return e.SUBGROUP},setter:function(t){t&&(e.SUBGROUP=t)}}),this.addStrConfigProp("isoListLeadingBracket",e.ISO_LIST_LEADING_BRACKET,{getter:function(){return e.ISO_LIST_LEADING_BRACKET},setter:function(t){t&&(e.ISO_LIST_LEADING_BRACKET=t)}}),this.addStrConfigProp("isoListTailingBracket",e.ISO_LIST_TAILING_BRACKET,{getter:function(){return e.ISO_LIST_TAILING_BRACKET},setter:function(t){t&&(e.ISO_LIST_TAILING_BRACKET=t)}}),this.addStrConfigProp("isoListDelimiter",e.ISO_LIST_DELIMITER,{getter:function(){return e.ISO_LIST_DELIMITER},setter:function(t){t&&(e.ISO_LIST_DELIMITER=t)}}),this.addStrConfigProp("isoListDisallowPrefix",e.ISO_LIST_DISALLOW_PREFIX,{getter:function(){return e.ISO_LIST_DISALLOW_PREFIX},setter:function(t){t&&(e.ISO_LIST_DISALLOW_PREFIX=t)}})}}),d.Render.TextFontConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Render.TextFontConfigs",DEF_LABEL_FONT_FAMILY:"",initProperties:function(){this.addStrConfigProp("labelFontFamily","Arial, Helvetica, sans-serif"),this.addStrConfigProp("atomFontFamily","Arial, Helvetica, sans-serif"),this.addFloatConfigProp("supFontSizeRatio",.66),this.addFloatConfigProp("subFontSizeRatio",.66),this.addFloatConfigProp("superscriptOverhang",.2),this.addFloatConfigProp("subscriptOversink",.2),this.addIntConfigProp("textCharDirection",d.Render.TextDirection.LTR,{enumSource:d.Render.TextDirection}),this.addIntConfigProp("textHorizontalAlign",d.Render.TextAlign.LEADING,{enumSource:d.Render.TextAlign}),this.addIntConfigProp("textVerticalAlign",d.Render.TextAlign.LEADING,{enumSource:d.Render.TextAlign}),this.addIntConfigProp("textBoxXAlignment",d.Render.BoxXAlignment.LEFT,{enumSource:d.Render.BoxXAlignment,scope:t.PUBLIC}),this.addIntConfigProp("textBoxYAlignment",d.Render.BoxYAlignment.TOP,{enumSource:d.Render.BoxYAlignment,scope:t.PUBLIC}),this.addIntConfigProp("textBoxAlignmentMode",d.Render.TextBoxAlignmentMode.ANCHOR,{enumSource:d.Render.TextBoxAlignmentMode,scope:t.PUBLIC})}}),d.Render.LengthConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Render.LengthConfigs",initProperties:function(){this.addFloatConfigProp("unitLength",1,{scope:t.PUBLIC}),this.addFloatConfigProp("labelFontSize",14),this.addFloatConfigProp("atomFontSize",14),this.addFloatConfigProp("atomLabelBoxExpandRatio",1.2,{scope:t.PUBLIC}),this.addFloatConfigProp("chargeMarkFontSize",10),this.addFloatConfigProp("chargeMarkMargin",5),this.addFloatConfigProp("chemMarkerFontSize",10),this.addFloatConfigProp("chemMarkerMargin",5),this.addFloatConfigProp("allenCenterAtomRadius",3),this.addFloatConfigProp("defBondLength",25),this.addFloatConfigProp("bondLineWidth",1),this.addFloatConfigProp("boldBondLineWidthRatio",2,{scope:t.PUBLIC}),this.addFloatConfigProp("hashSpacing",3),this.addFloatConfigProp("multipleBondSpacingRatio",.18),this.addFloatConfigProp("multipleBondSpacingAbs",null,{scope:t.PUBLIC}),this.addFloatConfigProp("multipleBondMaxAbsSpacing",5),this.addFloatConfigProp("bondArrowLength",6),this.addFloatConfigProp("bondArrowWidth",6),this.addFloatConfigProp("bondWedgeWidth",6),this.addFloatConfigProp("bondWedgeHashMinWidth",2),this.addFloatConfigProp("bondWavyRadius",5),this.addFloatConfigProp("glyphStrokeWidth",1),this.addFloatConfigProp("glyphStickOffsetRelLength",.1),this.addFloatConfigProp("rxnMolMargin",10,{scope:t.PUBLIC}),this.addFloatConfigProp("defScaleRefLength",.8),this.addFloatConfigProp("autofitContextPadding",45)},getActualLength:function(e){var t=this.getPropValue(e);return null!=t?t*this.getUnitLength():null}}),d.Render.ColorConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Render.ColorConfigs",initProperties:function(){this.addBoolConfigProp("useAtomSpecifiedColor",!1),this.addStrConfigProp("labelColor","#000000"),this.addStrConfigProp("atomColor","#000000"),this.addStrConfigProp("bondColor","#000000"),this.addStrConfigProp("glyphStrokeColor","#999999"),this.addStrConfigProp("glyphFillColor","#999999")}}),d.Render.Render3DConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render3DConfigs",initProperties:function(){this.addConfigProp("generalConfigs","Kekule.Render.GeneralConfigs"),this.addConfigProp("moleculeDisplayConfigs","Kekule.Render.Molecule3DDisplayConfigs"),this.addConfigProp("lengthConfigs","Kekule.Render.Length3DConfigs"),this.addConfigProp("environmentConfigs","Kekule.Render.Render3DEnvironmentConfigs"),this.addConfigProp("modelConfigs","Kekule.Render.Model3DConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("generalConfigs",new d.Render.GeneralConfigs),this.setPropStoreFieldValue("environmentConfigs",new d.Render.Render3DEnvironmentConfigs),this.setPropStoreFieldValue("moleculeDisplayConfigs",new d.Render.Molecule3DDisplayConfigs),this.setPropStoreFieldValue("modelConfigs",new d.Render.Model3DConfigs),this.setPropStoreFieldValue("lengthConfigs",new d.Render.Length3DConfigs)}}),d.ClassUtils.makeSingleton(d.Render.Render3DConfigs),d.Render.getRender3DConfigs=function(){return d.Render.Render3DConfigs.getInstance()},d.Render.Render3DEnvironmentConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render3DEnvironmentConfigs",initProperties:function(){this.addIntConfigProp("graphicQuality",d.Render.Render3DGraphicQuality.MEDIUM,{enumSource:d.Render.Render3DGraphicQuality}),this.addBoolConfigProp("antialias",!0)}}),d.Render.Molecule3DDisplayConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Molecule3DDisplayConfigs",initProperties:function(){this.addIntConfigProp("defMoleculeDisplayType",d.Render.Molecule3DDisplayType.BALL_STICK,{enumSource:d.Render.Molecule3DDisplayType}),this.addIntConfigProp("defBondSpliceMode",d.Render.Bond3DSpliceMode.WEIGHTING_SPLIT,{enumSource:d.Render.Bond3DSpliceMode}),this.addBoolConfigProp("defDisplayMultipleBond",!0),this.addStrConfigProp("defBondColor","#FFFFFF"),this.addStrConfigProp("defAtomColor","#000099"),this.addBoolConfigProp("useAtomSpecifiedColor",!0)}}),d.Render.Model3DConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Model3DConfigs",initProperties:function(){this.addBoolConfigProp("showNodeLabel",!0,{scope:t.PUBLIC}),this.addBoolConfigProp("hideHydrogens",!1),this.addBoolConfigProp("useVdWRadius",!0),this.addFloatConfigProp("nodeRadiusRatio",.25,{scope:t.PUBLIC}),this.addFloatConfigProp("connectorRadiusRatio",.25,{scope:t.PUBLIC}),this.addFloatConfigProp("multiConnectorRadiusRatio",.5),this.addFloatConfigProp("multiConnectorMarginRatio",1)}}),d.Render.Length3DConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Length3DConfigs",initProperties:function(){this.addFloatConfigProp("unitLength",1,{scope:t.PUBLIC}),this.addFloatConfigProp("fixedNodeRadius",1.7),this.addFloatConfigProp("connectorRadius",.6),this.addFloatConfigProp("connectorLineWidth",2),this.addFloatConfigProp("defBondLength",100,{scope:t.PUBLIC})},getActualLength:function(e){var t=this.getPropValue(e);return null!=t?t*this.getUnitLength():null}})}(),function(){var e=d.Render.RichText,t=d.Render.RichTextUtils,r=d.Render.TextDirection,n=d.Render.TextDrawUtils,i=d.Render.TextAlign;d.Render.AbstractTextDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.AbstractTextDrawBridge",drawText:function(e,t,r,n){return null},canMeasureText:function(e){return!1},measureText:function(e,t,r){return{}},canMeasureDrawnText:function(e){return!1},measureDrawnText:function(e,t,r){return{}},canModifyText:function(e){return!1},modifyDrawnTextCoord:function(e,t,r){},createGroup:function(e){},addToGroup:function(e,t){},removeFromGroup:function(e,t){}}),d.Render.BaseRichTextDrawer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.BaseRichTextDrawer",ITEM_PARENT_FIELD:"__$parent__",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.options=t||{},e&&this.setDrawBridge(e),r&&this.setDrawConfigs(r)},initProperties:function(){this.defineProp("drawBridge",{dataType:"Kekule.Render.AbstractTextDrawBridge",serializable:!1}),this.defineProp("drawConfigs",{dataType:"Kekule.Render.Render2DConfigs",serializable:!1})},fillOptions:function(e){if(e){var t=e.getTextFontConfigs(),r=this.options;r.supFontSizeRatio=t.getSupFontSizeRatio(),r.subFontSizeRatio=t.getSubFontSizeRatio(),r.superscriptOverhang=t.getSuperscriptOverhang(),r.subscriptOversink=t.getSubscriptOversink(),r.textCharDirection=t.getTextCharDirection(),r.textLineDirection=t.getTextLineDirection(),r.textHorizontalAlign=t.getTextHorizontalAlign(),r.textVerticalAlign=t.getTextVerticalAlign(),r.textBoxXAlignment=t.getTextBoxXAlignment(),r.textBoxYAlignment=t.getTextBoxYAlignment(),r.textBoxAlignmentMode=t.getTextBoxAlignmentMode()}},cloneRichText:function(e){return d.Render.RichTextUtils.clone(e)},_FONT_OPTION_FIELDS:["fontSize","fontFamily","fontWeight","fontStyle","color","overhang","oversink","opacity","zoom"],_DRAW_OPTIONS_FIELDS:["textType","charDirection","defaultCharDirection","fontSize","fontFamily","fontWeight","fontStyle","color","horizontalAlign","verticalAlign","zoom"],_fillLocalDrawOptions:function(e,t){for(var n=t||{},i=0,o=this._DRAW_OPTIONS_FIELDS.length;i<o;++i){var a=this._DRAW_OPTIONS_FIELDS[i],s=e[a];d.ObjUtils.notUnset(s)&&(n[a]=s)}return d.ObjUtils.isUnset(e.charDirection)?n.charDirection=r.DEFAULT:e.charDirection===r.INHERIT&&(n.charDirection=t.charDirection),n},RECT_INFO_FIELD:"__rectInfo__",ACTUAL_FONT_FIELD:"__drawFont__",RENDER_TEXT_FIELD:"__renderText__",RENDER_ELEM_FIELD:"__renderElem__",LOCAL_DRAW_OPTIONS_FIELD:"__drawOptions__",_setItemRectInfo:function(e,t,r){e[this.RECT_INFO_FIELD]={boundRect:Object.extend({},t),alignRect:Object.extend({},r)}},_getItemRectInfo:function(e){return e[this.RECT_INFO_FIELD]},_setActualFontInfo:function(e,t){e[this.ACTUAL_FONT_FIELD]=t},_getActualFontInfo:function(e){return e[this.ACTUAL_FONT_FIELD]},_setRenderText:function(e,t){e[this.RENDER_TEXT_FIELD]=t},_getRenderText:function(e){return e[this.RENDER_TEXT_FIELD]||e.text},_setRenderElem:function(e,t){e[this.RENDER_ELEM_FIELD]=t},_getRenderElem:function(e){return e[this.RENDER_ELEM_FIELD]},_itemHasNoAlignRect:function(e){return d.ObjUtils.notUnset(e._noAlignRect)?!!e._noAlignRect:t.isSubscript(e)||t.isSuperscript(e)},drawEx:function(e,t,r,n,i){var o=this.doPrepareDrawOptions(e,r,n),a=this.cloneRichText(r),s=this.getDrawBridge(),l={delayDrawing:s.canMeasureText(),adjustDrawing:s.canModifyText()};return this.doPrepare(e,t,a,o,l,[]),{drawnObj:this.doRenderRichText(e,a,o,l),boundRect:this._getItemRectInfo(a).boundRect}},draw:function(e,t,r,n,i){return this.drawEx(e,t,r,n,i).drawnObj},measure:function(e,t,r,n,i){var o=this.doPrepareDrawOptions(e,r,n),a=this.cloneRichText(r),s=this.getDrawBridge(),l={delayDrawing:s.canMeasureText(),adjustDrawing:s.canModifyText()},d=[];this.doPrepare(e,t,a,o,l,d);var u=this._getItemRectInfo(a);if(d.length&&s.removeDrawnElem)for(var c=0,h=d.length;c<h;++c){var p=d[c];s.removeDrawnElem(e,p)}return u},doPrepareDrawOptions:function(e,t,r){var n;return r?(n=Object.create(this.options||{}),n=Object.extend(n,r)):n=this.options,n.defaultCharDirection||(n.defaultCharDirection=n.charDirection),n},doPrepare:function(e,t,r,n,i,o){var a=this.doPrepareItem(e,r,n,i,o),s=null;n.textBoxAlignmentMode===d.Render.TextBoxAlignmentMode.ANCHOR&&(s=this.doGetRootAnchorItemAbsAlignRect(r));var l,u=this._getItemRectInfo(r);if(s){var c=this.doAlignRectToCoord(t,s,n.textBoxXAlignment,n.textBoxYAlignment);l={x:c.left-s.left,y:c.top-s.top}}else{var h=this.doAlignRectToCoord(t,u.alignRect,n.textBoxXAlignment,n.textBoxYAlignment);l={x:h.left-u.alignRect.left,y:h.top-u.alignRect.top}}var p=d.RectUtils.shiftRect(u.alignRect,l.x,l.y),g=d.RectUtils.shiftRect(u.boundRect,l.x,l.y);return this._setItemRectInfo(r,g,p),a},doAlignRectToCoord:function(e,t,r,n){var i=d.Render.BoxXAlignment,o=d.Render.BoxYAlignment,a=r===i.RIGHT?-1:r===i.CENTER?-.5:0,s=n===o.TOP?0:n===o.CENTER?-.5:-1,l=Object.extend({},t);return l.left=e.x+l.width*a,l.top=e.y+l.height*s,l},doGetRootAnchorItemAbsAlignRect:function(e){var t=e;if(t.anchorItem){for(var r=this._getItemRectInfo(t).alignRect,n={x:r.left,y:r.top};t.anchorItem;)t=t.anchorItem,r=this._getItemRectInfo(t).alignRect,n.x+=r.left,n.y+=r.top;return d.RectUtils.createRect(n.x,n.y,r.width,r.height)}return null},doCalcActualDrawFontInfo:function(e,r){function n(e,t){if("string"==typeof e){var r=d.StyleUtils.analysisUnitsValue(e);return r.value=Math.round(Math.max(r.value*t,1)),""+r.value+r.units}return e*t}for(var i={sizeScale:1},o=0,a=this._FONT_OPTION_FIELDS.length;o<a;++o){var s=this._FONT_OPTION_FIELDS[o];d.ObjUtils.notUnset(r[s])&&(i[s]=r[s])}return d.ObjUtils.notUnset(i.zoom)&&(i.fontSize=n(i.fontSize,i.zoom||1),i.zoom=null),t.isSuperscript(e)?(i.sizeScale=r.supFontSizeRatio,i.fontSize=n(i.fontSize,r.supFontSizeRatio),i.isSup=!0,d.ObjUtils.isUnset(i.overhang)&&(i.overhang=r.superscriptOverhang||0)):t.isSubscript(e)&&(i.sizeScale=r.subFontSizeRatio,i.fontSize=n(i.fontSize,r.subFontSizeRatio),i.isSub=!0,d.ObjUtils.isUnset(i.oversink)&&(i.oversink=r.subscriptOversink||0)),i},doPrepareItem:function(n,i,o,a,s){var l,u=t.getItemType(i),c=Object.create(o);switch(((c=this._fillLocalDrawOptions(i,c)).charDirection===r.DEFAULT||d.ObjUtils.isUnset(c.charDirection))&&(c.charDirection=c.defaultCharDirection),u){case e.SECTION:l=this.doPrepareSection(n,i,c,a,s);break;case e.LINES:l=this.doPrepareLines(n,i,c,a,s);break;default:l=this.doPrepareGroup(n,i,c,a,s)}return l},doPrepareSection:function(e,i,o,a,s){var l=this.getDrawBridge(),d=this.doCalcActualDrawFontInfo(i,o);this._setActualFontInfo(i,d);var u,c=i.text;if(n.isVerticalLine(o.charDirection)&&c.length>1){var h=i;h.role="group",delete h.text,h.charDirection=o.charDirection;var p=Object.create(o);p=Object.extend(p,d),h.items=[];for(var g=0,f=c.length;g<f;++g)t.appendText(h,c.charAt(g));return this.doPrepareItem(e,h,p,a,s)}if(o.charDirection===r.RTL&&(c=c.reverse()),this._setRenderText(i,c),a.delayDrawing)u=l.measureText(e,c,d);else{var m=this.getDrawBridge().drawText(e,{x:-1e4,y:-1e4},c,d);this._setRenderElem(i,m),u=l.measureDrawnText(e,m,d),s.push(m)}var C={left:0,top:0,width:u.width||0,height:u.height||0};this._setItemRectInfo(i,C,C)},doPrepareLines:function(e,t,n,i,o){for(var a=n.charDirection||r.DEFAULT,s=t.items,l=a===r.TTB?r.RTL:a===r.BTT?r.LTR:r.TTB,d=0,u=s.length;d<u;++d){var c=s[d];c.charDirection||(c.charDirection=a)}return t.charDirection=l,n.charDirection=l,n._originCharDirection=a,this.doPrepareGroup(e,t,n,i,o)},doPrepareGroup:function(e,o,a,s,l){for(var u=0,c=(j=o.items).length;u<c;++u){var h=j[u];this.doPrepareItem(e,h,a,s,l)}var p,g=a.charDirection||r.DEFAULT,f=a._originCharDirection||g,m=n.isHorizontalLine(g),C=m?"x":"y",y=m?"y":"x",_=i.getAbsAlign(a.horizontalAlign,f),E=i.getAbsAlign(a.verticalAlign,f);p=m?E==i.TOP?0:E==i.CENTER?-.5:-1:_==i.RIGHT?-1:_==i.CENTER?-.5:0;var T={x:0,y:0},O=g===r.RTL||g===r.BTT?-1:1,v=m?"left":"top",S=m?"top":"left",b=[];for(u=0,c=j.length;u<c;++u){h=j[u];var A=(w=this._getItemRectInfo(h)).boundRect,I=w.alignRect;if(O>0){var R=T[C]-A[v];A[v]=T[C],I[v]+=R}var D={x:A.width,y:A.height};if(T[C]+=D[C]*O,O<0&&(R=T[C]-A[v],A[v]=T[C],I[v]+=R),D={x:I.width,y:I.height},(L=this._getActualFontInfo(h))&&(L.isSup||L.isSub)&&t.getActualRefItem(h,o))b.push(h);else{var N=L?L.oversink||-(L.overhang||0):0;m||(N=-N);var P=D[y]*(p+N),x=I[S]-P;I[S]=P,A[S]-=x}}for(u=0,c=b.length;u<c;++u){h=b[u];var M=t.getActualRefItem(h,o),L=this._getActualFontInfo(h),w=this._getItemRectInfo(h),k=this._getItemRectInfo(M).alignRect;if(A=w.boundRect,I=w.alignRect,L.isSup){var B=L.overhang;m?(I.top=k.top,I.height=k.height,A.top=k.top-k.height*B):(I.left=k.left,I.width=k.width,A.left=k.lefy+k.width-A.left+k.width*B)}else N=L.oversink,m?(I.top=k.top,I.height=k.height,A.top=k.top+k.height-A.height+k.height*N):(I.left=k.left,I.width=k.width,A.left=k.left-k.width*N)}var j,U=null,F=null;for(u=0,c=(j=o.items).length;u<c;++u)h=j[u],w=this._getItemRectInfo(h),this._itemHasNoAlignRect(h)&&(U||u!=c-1)||(U=U?d.RectUtils.getContainerRect(U,w.alignRect):Object.extend({},w.alignRect)),F=F?d.RectUtils.getContainerRect(F,w.boundRect):Object.extend({},w.boundRect);if(j.length<=0&&(U=d.RectUtils.createRect(0,0,0,0),F=d.RectUtils.createRect(0,0,0,0)),0!==(x={x:-U.left,y:-U.top}).x||0!==x.y){for(u=0,c=j.length;u<c;++u)(w=this._getItemRectInfo(j[u])).alignRect=d.RectUtils.shiftRect(w.alignRect,x.x,x.y),w.boundRect=d.RectUtils.shiftRect(w.boundRect,x.x,x.y);U.left=0,U.top=0,F.left+=x.x,F.top+=x.y}this._setItemRectInfo(o,F,U)},doRenderRichText:function(e,t,r,n){var i=this.getDrawBridge().createGroup(e);return this.doRenderItem(e,{x:0,y:0},t,n,i),i},doRenderItem:function(r,n,i,o,a){var s;if(t.getItemType(i)===e.SECTION)s=this.doRenderSection(r,n,i,o,a);else s=this.doRenderGroup(r,n,i,o,a);return s},doRenderGroup:function(e,t,r,n,i){var o=r.items;if(o.length<=0)return null;for(var a=this._getItemRectInfo(r),s={x:t.x+a.alignRect.left,y:t.y+a.alignRect.top},l=0,d=o.length;l<d;++l)this.doRenderItem(e,s,o[l],n,i)},doRenderSection:function(e,t,r,n,i){var o=this._getItemRectInfo(r).boundRect,a={x:o.left,y:o.top};a=d.CoordUtils.add(a,t);var s,l=this._getRenderText(r),u=this._getActualFontInfo(r),c=this.getDrawBridge();n.delayDrawing?s=c.drawText(e,a,l,u):n.adjustDrawing&&(s=this._getRenderElem(r),c.modifyDrawnTextCoord(e,s,a)),c.addToGroup(s,i)}})}(),d.Render.BoundInfoRecorder=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.BoundInfoRecorder",initialize:function(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("boundInfos",new d.TwoTupleMapEx(!0)),this._renderer=e,e&&e.setBoundInfoRecorder&&e.setBoundInfoRecorder(this),this.installEventListener(e)},finalize:function(){this._renderer&&this.uninstallEventListener(this._renderer);var e=this.getPropStoreFieldValue("boundInfos");e&&e.clear(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("boundInfos",{dataType:"Kekule.TwoTupleMapEx",serializable:!1,setter:null}),this.defineProp("targetContext",{dataType:DataType.OBJECT,serializable:!1})},needRecordOnContext:function(e){var t=this.getTargetContext();return!t||t===e},installEventListener:function(e){e.addEventListener("updateBasicDrawObject",this._reactRendererUpdateBasicDrawObject,this),e.addEventListener("clear",this._reactRendererClear,this)},uninstallEventListener:function(e){e.removeEventListener("updateBasicDrawObject",this._reactRendererUpdateBasicDrawObject,this),e.removeEventListener("clear",this._reactRendererClear,this)},_reactRendererUpdateBasicDrawObject:function(e){var t=d.Render.ObjectUpdateType;if(this.needRecordOnContext(e.context)){var r=e.updateType;r===t.ADD?this.add(e.context,e.obj,e.parentObj,e.boundInfo,e.target):r===t.MODIFY?this.modify(e.context,e.obj,e.parentObj,e.boundInfo,e.target):r===t.REMOVE?this.remove(e.context,e.obj):r===t.CLEAR&&this.clear(e.context),this.invokeEvent("updateBasicDrawObject",e)}},_reactRendererClear:function(e){this.needRecordOnContext(e.context)&&this.clearOnRenderer(e.context,e.target),this.getAllRecordedInfoOfContext(e.context)},getInfo:function(e,t){return this.getBoundInfos().get(e,t)},getBelongedInfos:function(e,t){if(a=this.getInfo(e,t))return[a];for(var r=[],n=this.getAllRecordedInfoOfContext(e),i=0,o=n.length;i<o;++i){var a;(a=n[i]).obj.isChildOf(t)&&r.push(a)}return r},getBound:function(e,t){var r=(u=this.getInfo(e,t))?u.boundInfo:null;if(!r){for(var n=d.BoxUtils,i=d.Render.MetaShapeUtils,o=this.getBelongedInfos(e,t),a=null,s=0,l=o.length;s<l;++s){var u=o[s],c=i.getContainerBox(u.boundInfo,0);a=a?n.getContainerBox(a,c):c}a&&(r=i.createShapeInfo(d.Render.MetaShapeType.RECT,[{x:a.x1,y:a.y1},{x:a.x2,y:a.y2}]))}return r},clearOnRenderer:function(e,t){var r=(i=this.getBoundInfos()).getSecondLevelMap(e);if(r)for(var n=r.getKeys(),i=r.getValues(),o=n.length-1;o>=0;--o){var a=n[o];i[o].renderer===t&&r.remove(a)}},clear:function(e){var t=this.getBoundInfos().getSecondLevelMap(e);return t&&t.clear(),this},clearAll:function(){return this.getBoundInfos().clear(),this},add:function(e,t,r,n,i){return this.getBoundInfos().set(e,t,{obj:t,parentObj:r,boundInfo:n,renderer:i}),this},modify:function(e,t,r,n,i){var o=this.getBoundInfos().get(e,t);o||(o={},this.getBoundInfos.set(e,t,o));var a=d.ObjUtils.notUnset;return a(r)&&(o.parentObj=r),a(n)&&(o.boundInfo=n),a(i)&&(o.renderer=i),this},remove:function(e,t,r){return this.getBoundInfos().remove(e,t),this},getAllRecordedInfoOfContext:function(e){var t=this.getBoundInfos().getSecondLevelMap(e);return t?t.getValues():[]},getAllBoundInfosOfContext:function(e){for(var t=this.getAllRecordedInfoOfContext(e),r=[],n=0,i=t.length;n<i;++n){var o=t[n].boundInfo;o&&r.push(o)}return r},getContainerBox:function(e){for(var t=d.BoxUtils,r=d.Render.MetaShapeUtils,n=null,i=this.getAllBoundInfosOfContext(e),o=0,a=i.length;o<a;++o){var s=r.getContainerBox(i[o],0);n=t.getContainerBox(n,s)}return n},getIntersectionInfos:function(e,t,r,n,i){for(var o=[],a=this.getAllRecordedInfoOfContext(e),s=0,l=a.length;s<l;++s){var u=a[s].boundInfo;i&&!i(a[s])||u&&d.Render.MetaShapeUtils.isCoordInside(t,u,n)&&o.push(a[s])}return o}}),function(){var e=d.Render.BondRenderType,t=d.Render.TextDirection,r=d.BoxUtils,n=d.BondOrder,i=d.CoordUtils,o=d.oneOf;d.Render.Abstract2DDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.Abstract2DDrawBridge",CONTEXT_PARAMS_FIELD:"__$context_params__",createContext:function(e,t,r,n){return null},releaseContext:function(e){},getContextParam:function(e,t){return(e[this.CONTEXT_PARAMS_FIELD]||{})[t]},setContextParam:function(e,t,r){e[this.CONTEXT_PARAMS_FIELD]||(e[this.CONTEXT_PARAMS_FIELD]={}),e[this.CONTEXT_PARAMS_FIELD][t]=r},_getOverSamplingRatio:function(e){return this.getContextParam(e,"overSamplingRatio")||null},getContextDimension:function(e){var t=this._getContextRawDimension(e),r=this._getOverSamplingRatio(e);return r&&(t.width/=r,t.height/=r),t},_getContextRawDimension:function(e){return{}},setContextDimension:function(e,t,r){var n={width:t,height:r},i=this._getOverSamplingRatio(e);i&&(n.width*=i,n.height*=i),this._setContextRawDimension(e,n.width,n.height)},_setContextRawDimension:function(e,t,r){return null},getContextElem:function(e){},setContextViewBox:function(e,t,r,n,i,o){},prepareContext:function(e){},clearContext:function(e){return null},setClearColor:function(e,t){},setFilter:function(e,t){},clearFilter:function(e){},transformContextCoordToScreen:function(e,t){var r=t,n=this._getOverSamplingRatio(e);return n&&(r=d.CoordUtils.divide(r,n)),r},transformScreenCoordToContext:function(e,t){var r=t,n=this._getOverSamplingRatio(e);return n&&(r=d.CoordUtils.multiply(r,n)),r},transformContextLengthToScreen:function(e,t){var r=t,n=this._getOverSamplingRatio(e);return n&&(r/=n),r},transformScreenLengthToContext:function(e,t){var r=t,n=this._getOverSamplingRatio(e);return n&&(r*=n),r},canModifyGraphic:function(e){return!1},drawPath:function(e,t,r){},drawLine:function(e,t,r,n){},drawTriangle:function(e,t,r,n,i){},drawRect:function(e,t,r,n){},drawRoundRect:function(e,t,r,n,i){},drawCircle:function(e,t,r,n){},drawArc:function(e,t,r,n,i,o,a){},drawImage:function(e,t,r,n,i,o){},drawImageElem:function(e,t,r,n,i){},createGroup:function(e){return null},addToGroup:function(e,t){},removeFromGroup:function(e,t){},removeDrawnElem:function(e,t){},exportToDataUri:function(e,t,r){}}),d.Render.Base2DRenderer=Class.create(d.Render.CompositeRenderer,{CLASS_NAME:"Kekule.Render.Base2DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this.__$redirectContextDebug__=!1,this._richTextDrawer=null},initProperties:function(){this.defineProp("richTextDrawerClass",{dataType:DataType.CLASS,serializable:!1})},getActualTargetContext:function(e){return this.getRedirectContext()||e},getRendererType:function(){return d.Render.RendererType.R2D},canMeasureText:function(e){return this.getDrawBridge().canMeasureText(e)},getAutoScaleRefDrawLength:function(e){return e.defBondLength},getAutoScaleRefObjLength:function(e,t){var r=e||this.getChemObj();if(!r.getAllAutoScaleRefLengths)return null;var n=r.getAllAutoScaleRefLengths(d.CoordMode.COORD2D,t);return n&&n.length?d.ArrayUtils.getMedian(n):void 0},getRichTextDrawer:function(){if(!this._richTextDrawer){var e=this.getRichTextDrawerClass()||d.Render.BaseRichTextDrawer;this._richTextDrawer=new e(this.getDrawBridge())}return this._richTextDrawer},drawPath:function(e,t,r){return this.getDrawBridge().drawPath(this.getActualTargetContext(e),t,r)},drawLine:function(e,t,r,n){if(this.__$redirectContextDebug__){var i=Object.create(n);return this.getRedirectContext()&&(i.color=i.strokeColor="#ff0000"),this.getDrawBridge().drawLine(this.getActualTargetContext(e),t,r,i)}return this.getDrawBridge().drawLine(this.getActualTargetContext(e),t,r,n)},drawArrowLine:function(e,t,r,n,i){var o=this.getActualTargetContext(e);if(n){var a=this.createDrawGroup(o),s=this.drawLine(o,t,r,i);this.addToDrawGroup(s,a);var l=r.x-t.x,d=r.y-t.y,u=Math.atan(d/l),c=Math.sign(l)||1,h=(n.width||6)/2,p=n.length||3,g=Math.atan(h/p),f=Math.sqrt(Math.sqr(h)+Math.sqr(p))*c,m=Math.cos(u-g)*f,C=Math.sin(u-g)*f,y=Math.cos(u+g)*f,_=Math.sin(u+g)*f;return s=this.drawLine(o,r,{x:r.x-m,y:r.y-C},i),this.addToDrawGroup(s,a),s=this.drawLine(o,r,{x:r.x-y,y:r.y-_},i),this.addToDrawGroup(s,a),a}return this.drawLine(o,t,r,i)},drawTriangle:function(e,t,r,n,i){return this.getDrawBridge().drawTriangle(this.getActualTargetContext(e),t,r,n,i)},drawRect:function(e,t,r,n){var i={x:Math.min(t.x,r.x),y:Math.min(t.y,r.y)},o={x:Math.max(t.x,r.x),y:Math.max(t.y,r.y)};return this.getDrawBridge().drawRect(this.getActualTargetContext(e),i,o,n)},drawRoundRect:function(e,t,r,n,i){var o={x:Math.min(t.x,r.x),y:Math.min(t.y,r.y)},a={x:Math.max(t.x,r.x),y:Math.max(t.y,r.y)};return this.getDrawBridge().drawRoundRect(this.getActualTargetContext(e),o,a,n,i)},drawCircle:function(e,t,r,n){return this.getDrawBridge().drawCircle(this.getActualTargetContext(e),t,r,n)},drawArc:function(e,t,r,n,i,o,a){return this.getDrawBridge().drawArc(this.getActualTargetContext(e),t,r,n,i,o,a)},drawText:function(e,t,r,n){var i=this.getRichTextDrawer(),o=d.Render.RichTextUtils.strToRichText(r,n);if(this.__$redirectContextDebug__){var a=Object.create(n||{});return this.getRedirectContext()&&(a.color=a.strokeColor="#ff0000"),i.drawEx(this.getActualTargetContext(e),t,o,a)}return i.drawEx(this.getActualTargetContext(e),t,o,n)},drawRichText:function(e,t,r,n){var i=this.getRichTextDrawer();if(this.__$redirectContextDebug__){var o=Object.create(n||{});return this.getRedirectContext()&&(o.color=o.strokeColor="#ff0000"),i.drawEx(this.getActualTargetContext(e),t,r,o)}return i.drawEx(this.getActualTargetContext(e),t,r,n)},measureRichText:function(e,t,r,n){return this.getRichTextDrawer().measure(e,t,r,n)},drawImage:function(e,t,r,n,i,o){var a=this;return this.getDrawBridge().drawImage(this.getActualTargetContext(e),t,r,n,i,o,(function(){return a.getActualTargetContext(e)}))},drawImageElem:function(e,t,r,n,i){if(t.complete)return this.getDrawBridge().drawImageElem(this.getActualTargetContext(e),t,r,n,i);var o=d.X.Event;if(o){var a=this,s=function(){o.removeListener(t,"load",l)},l=function(){s(),a.update(a.getActualTargetContext(e),[{obj:a.getChemObj()}],d.Render.ObjectUpdateType.MODIFY)};o.addListener(t,"load",l),o.addListener(t,"error",s)}},createDrawGroup:function(e){return this.getDrawBridge().createGroup(this.getActualTargetContext(e))},addToDrawGroup:function(e,t){return this.getDrawBridge().addToGroup(e,t)},removeFromDrawGroup:function(e,t){return this.getDrawBridge().removeFromGroup(e,t)},removeDrawnElem:function(e,t){return this.getDrawBridge().removeDrawnElem(this.getActualTargetContext(e),t)},transformScreenCoordToContext:function(e,t){return this.doTransformScreenCoordToContext(this.getActualTargetContext(e),t)},doTransformScreenCoordToContext:function(e,t){var r=this.getDrawBridge();return r&&r.transformScreenCoordToContext?r.transformScreenCoordToContext(this.getActualTargetContext(e),t):t}}),d.Render.ChemObj2DRenderer=Class.create(d.Render.Base2DRenderer,{CLASS_NAME:"Kekule.Render.ChemObj2DRenderer",_getRenderSortIndex:function(){var e=this.getChemObj();return e&&e.coordStickTarget&&e.getCoordStickTarget()?1:this.tryApplySuper("_getRenderSortIndex")},doEstimateSelfObjBox:function(e,t,r){return d.Render.ObjUtils.getContainerBox(this.getChemObj(),this.getCoordMode(),r)},doEstimateRenderBox:function(e,t,n,i){var o=this.estimateObjBox(e,n,i);if(o){var a=this.prepareTransformParams(e,t,n,o);return r.transform2D(o,a)}return null},doGetAutoBaseCoord:function(e){var t=e.transformParams;if(t){var r=this.getChemObj(),n=r.getAbsBaseCoord?r.getAbsBaseCoord(d.CoordMode.COORD2D):r.getAbsBaseCoord2D?r.getAbsBaseCoord2D():null;if(n)return d.CoordUtils.transform2D(n,t)}return null},doDraw:function(e,t,r){var n=this.getAutoScaleRefObjLength(this.getChemObj(),r.allowCoordBorrow);return r.medianObjRefLength=n||r.defScaleRefLength,this.prepareTransformParams(e,t,r),this.prepareGeneralOptions(e,r),this.tryApplySuper("doDraw",[e,t,r])},prepareGeneralOptions:function(e,t){},prepareTransformParams:function(e,t,r,n){var i;if(r.transformParams)i=r.transformParams;else{r.unitLength||(r.unitLength=1);var o=this.getDrawBridge()._getOverSamplingRatio(e);o&&1!==o&&(r.unitLength*=o);var a=this.generateTransformParams(e,t,r,n);r.transformParams=a,i=a,r.transformParams.zoom&&(r.zoom=r.transformParams.zoom)}var s=d.CoordUtils.calcTransform2DMatrix(i),l=d.CoordUtils.calcInverseTransform2DMatrix(i);return r.transformParams.transformMatrix=s,r.transformParams.invTransformMtrix=l,this.getRenderCache(e).transformParams=i,this.getRenderCache(e).transformMatrix=s,this.getRenderCache(e).invTransformMatrix=l,i},calcPreferedTransformOptions:function(e,t,r,n){var i={};i.allowCoordBorrow=o(r.allowCoordBorrow,!1),i.unitLength=r.unitLength||1,n||(n=this.estimateObjBox(e,r,i.allowCoordBorrow)),n||(n={x1:0,x2:1,y1:0,y2:1});var a={x:(n.x1+n.x2)/2,y:(n.y1+n.y2)/2},s=d.ObjUtils;if(s.isUnset(r.translateX)&&s.isUnset(r.translateY)?t&&(i.translateX=t.x-a.x,i.translateY=t.y-a.y):(i.translateX=r.translateX||0,i.translateY=r.translateY||0),i.zoom=r.zoom||1,r.scale||r.scaleX||r.scaleY)i.scaleX=o(r.scaleX,r.scale,1),i.scaleY=o(r.scaleY,r.scale,1);else{var l,u=(o(r.refDrawLength,this.getAutoScaleRefDrawLength(r))||1)*i.unitLength,c=r.medianObjRefLength;if(d.ObjUtils.isUnset(c)&&(c=r.defScaleRefLength),l=u/c||1,r.autofit||r.autoShrink){var h=this.getDrawBridge().getContextDimension(e);h.x=h.width,h.y=h.height,(h=this.getDrawBridge().transformScreenCoordToContext(e,h)).width=h.x,h.height=h.y;var p=r.autofitContextPadding;p*=2*i.unitLength,n.width=n.x2-n.x1,n.height=n.y2-n.y1;var g=Math.max(h.width-p,0)/(n.width||1),f=Math.max(h.height-p,0)/(n.height||1),m=Math.min(g,f),C=m/l;s.isUnset(r.retainAspect)||r.retainAspect?(i.scaleX=i.scaleY=l,(r.autofit||r.autoShrink&&m<l)&&(i.zoom*=C)):r.autofit?(i.scaleX=(g<f?1:g/f)*l,i.scaleY=(f<g?1:f/g)*l,i.zoom*=C):r.autoShrink&&(i.zoom*=C,C<1?i.scaleX=i.scaleY=l:g<f?(i.scaleX=l,i.scaleY=l*f/g):(i.scaleY=l,i.scaleX=l*g/f))}else i.scaleX=i.scaleY=l}return s.notUnset(r.rotateAngle)&&(i.rotateAngle=r.rotateAngle),s.isUnset(r.center)?i.center=a:i.center=r.center,i.drawBaseCoord=t||d.CoordUtils.transform2D(a,i),i},generateTransformParams:function(e,t,r,n){var i=this.calcPreferedTransformOptions(e,t,r,n),o=Object.extend({},i);return(i=this.getFinalTransformParams(e,i)).initialTransformOptions=o,i},getFinalTransformParams:function(e,t){var r=Object.create(t);return r.zoom&&(r.scaleX*=r.zoom,r.scaleY*=r.zoom),r.scaleY=-r.scaleY,r.unitLength,r},getRenderFinalTransformParams:function(e){return this.getRenderCache(e).transformParams},getRenderInitialTransformOptions:function(e){var t=this.getRenderFinalTransformParams(e);return t?t.initialTransformOptions:null},doTransformCoordToObj:function(e,t,r){var n=this.getRenderCache(e).invTransformMatrix;return d.CoordUtils.transform2DByMatrix(r,n)},doTransformCoordToContext:function(e,t,r){var n=this.getRenderCache(e).transformMatrix;return d.CoordUtils.transform2DByMatrix(r,n)}}),d.Render.RichTextBased2DRenderer=Class.create(d.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.RichTextBased2DRenderer",DRAWN_OBJ_FIELD:"__$drawnObj__",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this.__$alwaysRecalcSize__=!1,this.__$isRecalculatingSize=!1},getDrawnObj:function(e){return this.getExtraProp(e,this.DRAWN_OBJ_FIELD)},setDrawnObj:function(e,t){this.setExtraProp(e,this.DRAWN_OBJ_FIELD,t)},getRichText:function(e,t){return null},extractRichTextDrawOptions:function(e){var t=Object.create(e||{});return t.horizontalAlign=o(t.horizontalAlign,t.textHorizontalAlign),t.verticalAlign=o(t.verticalAlign,t.textVerticalAlign),t.charDirection=o(t.charDirection,t.textCharDirection),t},getDrawTextCoord:function(e,t){return t},doDrawSelf:function(e,t,r){this.tryApplySuper("doDrawSelf",[e,t,r]);var n=this.getChemObj(),i=(r.transformParams,this.getRichText(this.getChemObj(),r));if(!i)return null;t||(t=this.getAutoBaseCoord(r));var o=this.getDrawTextCoord(e,t),a=this.extractRichTextDrawOptions(r);a.fontSize&&(a.fontSize*=a.unitLength||1);var s=this.drawRichText(e,o,i,a),l=s.boundRect,u=this.createRectBoundInfo({x:l.left,y:l.top},{x:l.left+l.width,y:l.top+l.height});return this.basicDrawObjectUpdated(e,n,n,u,d.Render.ObjectUpdateType.ADD),this.getRenderCache(e).drawnObj=s.drawnObj,this.setDrawnObj(e,s.drawnObj),(this.getCanModifyTargetObj()&&n.getNeedRecalcSize&&n.getNeedRecalcSize()||this.__$alwaysRecalcSize__)&&this._autosetObjSize(e,n,u),s.drawnObj},_autosetObjSize:function(e,t,r){if(!this.__$isRecalculatingSize&&t.hasProperty("size2D")&&t.setNeedRecalcSize){this.__$isRecalculatingSize=!0;try{var n=r.coords,i=this.transformCoordToObj(e,t,n[0]),o=this.transformCoordToObj(e,t,n[1]),a=d.CoordUtils.substract(o,i);t.setPropStoreFieldValue("size2D",{x:Math.abs(a.x),y:Math.abs(a.y)}),t.setNeedRecalcSize(!1)}finally{this.__$isRecalculatingSize=!1}}}}),d.Render.TextBlock2DRenderer=Class.create(d.Render.RichTextBased2DRenderer,{CLASS_NAME:"Kekule.Render.TextBlock2DRenderer",getRichText:function(e,t){return d.Render.RichTextUtils.strToRichText(e.getText())},doEstimateSelfObjBox:function(e,t,r){return this.getChemObj().getBox2D(r)},getDrawTextCoord:function(e,t){var r=this.getChemObj(),n=r.getExposedContainerBox(),i={x:n.x1,y:n.y2},o={x:n.x2,y:n.y1},a=this.transformCoordToContext(e,r,i),s=this.transformCoordToContext(e,r,o),l=d.CoordUtils.substract(s,a);return{x:t.x-l.x/2,y:t.y-l.y/2}},extractRichTextDrawOptions:function(e){var t=this.tryApplySuper("extractRichTextDrawOptions",[e]);return t.fontSize=o(t.fontSize,t.labelFontSize),t.fontFamily=o(t.fontFamily,t.labelFontFamily),t.color=o(t.color,t.labelColor),t.textBoxXAlignment=d.Render.BoxXAlignment.LEFT,t.textBoxYAlignment=d.Render.BoxYAlignment.TOP,t}}),d.Render.Formula2DRenderer=Class.create(d.Render.RichTextBased2DRenderer,{CLASS_NAME:"Kekule.Render.Formula2DRenderer",basicDrawObjectUpdated:function(e,t,r,n,i){return t===this.getChemObj()?this.tryApplySuper("basicDrawObjectUpdated",[e,t.getParent(),t.getParent(),n,i]):this.tryApplySuper("basicDrawObjectUpdated",[e,t,r,n,i])},getRichText:function(e,t){return e.getDisplayRichText(!0,t.displayLabelConfigs,t.partialChargeDecimalsLength,t.chargeMarkType)},doEstimateSelfObjBox:function(e,t,n){var i=this.getChemObj()?this.getChemObj().getParent():null;if(i){var o=i?i.getAbsBaseCoord2D(n):{x:0,y:0};return r.createBox(o,o)}return null},extractRichTextDrawOptions:function(e){var t=this.tryApplySuper("extractRichTextDrawOptions",[e]);return t.fontSize=o(t.fontSize,t.atomFontSize),t.fontFamily=o(t.fontFamily,t.atomFontFamily),t.color=o(t.color,t.labelColor,t.atomColor),t.textBoxXAlignment=d.Render.BoxXAlignment.CENTER,t.textBoxYAlignment=d.Render.BoxYAlignment.CENTER,t}}),d.Render.TextBasedChemMarker2DRenderer=Class.create(d.Render.RichTextBased2DRenderer,{CLASS_NAME:"Kekule.Render.TextBasedChemMarker2DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},doDrawSelf:function(e,t,r){return this.tryApplySuper("doDrawSelf",[e,t,r])},getRichText:function(e,t){var r,n=this.getChemObj();if(n instanceof d.ChemMarker.Charge){var i=n.getValue();if(r=d.Render.ChemDisplayTextUtils.getChargeDisplayText(i,t.partialChargeDecimalsLength,t.chargeMarkType))return d.Render.RichTextUtils.createSection(r,{charDirection:d.Render.TextDirection.LTR})}else if(n instanceof d.ChemMarker.Radical){var o=n.getValue();if(r=d.Render.ChemDisplayTextUtils.getRadicalDisplayText(o,t.distinguishSingletAndTripletRadical))return d.Render.RichTextUtils.createSection(r,{charDirection:d.Render.TextDirection.LTR})}return null},doEstimateSelfObjBox:function(e,t,r){return this.tryApplySuper("doEstimateSelfObjBox",[e,t,r])},extractRichTextDrawOptions:function(e){var t=this.tryApplySuper("extractRichTextDrawOptions",[e]),r=this.getChemObj();return t.fontSize=o(r.getRenderOption("fontSize"),t.chemMarkerFontSize,t.fontSize,t.atomFontSize),t.fontFamily=o(t.fontFamily,t.atomFontFamily),t.color=o(t.color,t.atomColor,t.labelColor),t.textBoxXAlignment=d.Render.BoxXAlignment.CENTER,t.textBoxYAlignment=d.Render.BoxYAlignment.CENTER,t}}),d.Render.ImageBlock2DRenderer=Class.create(d.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.ImageBlock2DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},doDrawSelf:function(e,t,r){this.tryApplySuper("doDrawSelf",[e,t,r]);var n=this.getChemObj();if(r.transformParams,!n||!n.getSrc||!n.getSrc())return null;t||(t=this.getAutoBaseCoord(r));var i,o=n.getExposedContainerBox(),a={x:o.x1,y:o.y2},s={x:o.x2,y:o.y1},l=this.transformCoordToContext(e,n,a),u=this.transformCoordToContext(e,n,s),c=d.CoordUtils.substract(u,l),h={x:t.x-c.x/2,y:t.y-c.y/2},p=n.getCacheImg();return i=p?this.drawImageElem(e,p,h,c,r):this.drawImage(e,n.getSrc(),h,c,r),this.basicDrawObjectUpdated(e,n,n,this.createRectBoundInfo(h,d.CoordUtils.add(h,c)),d.Render.ObjectUpdateType.ADD),i}}),d.Render.UnbondedElectronSetRenderer=Class.create(d.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.UnbondedElectronSetRenderer",_extractActualDrawOptions:function(e){var t=Object.create(e),r=this.getChemObj();return t.fontSize=o(r.getRenderOption("fontSize"),t.chargeMarkFontSize,t.fontSize,t.atomFontSize),t.color=o(t.color,t.atomColor,t.labelColor),t.strokeColor=t.color,t.fillColor=t.color,t.electronGap=t.fontSize/3*(t.unitLength||1)*(t.zoom||1),t.electronRadius=t.fontSize/12*(t.unitLength||1)*(t.zoom||1),t},_drawSingleElectron:function(e,t,r,n){return this.drawCircle(e,t,r,n)},_drawElectrons:function(e,t,r,n,o){var a=i.substract(r,n),s=i.getDistance(a);if(0===s)var l=0,d=1;else l=a.x/s,d=a.y/s;for(var u,c,h=o.electronGap,p=o.electronRadius,g={x:h*d,y:-h*l},f=(t-1)/2,m=i.substract(r,i.multiply(g,f)),C=[],y=t>1?this.createDrawGroup(e):null,_=0;_<t;++_)C.push(m),u=this._drawSingleElectron(e,m,p,o),y&&this.addToDrawGroup(u,y),m=i.add(m,g);if(C.length<=1)c=this.createCircleBoundInfo(C[0],p);else{var E=i.multiply(g,2*p/h),T=i.substract(C[0],E),O=i.add(C[t-1],E);c=this.createLineBoundInfo(T,O,p)}return{electronCoords:C,drawnElem:y||u,electronRadius:p,boundInfo:c}},_doGetParentCoord:function(e,t,r){var n=r.transformParams;if(n){var o=t,a=o.getAbsBaseCoord?o.getAbsBaseCoord(d.CoordMode.COORD2D):o.getAbsBaseCoord2D?o.getAbsBaseCoord2D():null;if(a)return i.transform2D(a,n)}return null},doDrawSelf:function(e,t,r){this.tryApplySuper("doDrawSelf",[e,t,r]);var n=this._extractActualDrawOptions(r),i=this.getChemObj(),o=i.getParent();if(r.transformParams,!i||!o||!i.getElectronCount||(i.getElectronCount()||0)<=0)return null;t||(t=this.getAutoBaseCoord(r));var a=this._doGetParentCoord(e,o,r);if(!t||!a)return null;var s=this._drawElectrons(e,i.getElectronCount(),t,a,n);return s.electronCoords,s.electronRadius,this.basicDrawObjectUpdated(e,i,o,s.boundInfo,d.Render.ObjectUpdateType.ADD),s.drawnElem}}),d.Render.Ctab2DRenderer=Class.create(d.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.Ctab2DRenderer",DRAW_ELEM_FIELD:"__$drawElem__",TRANSFORM_COORD_FIELD:"__$transCoord2D__",TRANSFORM_MATRIX_FIELD:"__$transMatrix__",RENDERED_OBJS_FIELD:"__$renderedObjs__",INV_TRANSFORM_MATRIX_FIELD:"__$inverseTransMatrix__",CHILD_TRANSFORM_MATRIX_FIELD:"__$childTransMatrix__",_getRenderSortIndex:function(){for(var e=this.getChemObj().getExposedNodes(),t=0,r=e.length;t<r;++t){var n=e[t];if(n&&n.coordStickTarget&&n.getCoordStickTarget())return 1}return this.tryApplySuper("_getRenderSortIndex")},doEstimateSelfObjBox:function(e,t,r){return this.getChemObj().getExposedContainerBox2D(r)},getObjDrawElem:function(e,t){return this.getExtraProp2(e,t,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(e,t,r){this.setExtraProp2(e,t,this.DRAW_ELEM_FIELD,r)},getRenderedObjs:function(e){return this.getExtraProp(e,this.RENDERED_OBJS_FIELD)},addRenderedObj:function(e,t){var r=this.getRenderedObjs(e);r?d.ArrayUtils.pushUnique(r,t):(r=[t],this.setExtraProp(e,this.RENDERED_OBJS_FIELD,r))},removeRenderedObj:function(e,t){var r=this.getRenderedObjs(e);r&&d.ArrayUtils.remove(r,t)},clearRenderedObj:function(e){this.setExtraProp(e,this.RENDERED_OBJS_FIELD,null)},prepareGeneralOptions:function(e,t){return this.tryApplySuper("prepareGeneralOptions",[e,t])},doPrepare:function(e,t,r,n){this.tryApplySuper("doPrepare",[e,t,r,n]),this.doPrepareLayout(e,t,r,n)},doPrepareLayout:function(e,t,r,n){},handleNodeSpecifiedRenderOptions:function(e,t){var r=(e.getOverriddenRenderOptions?e.getOverriddenRenderOptions():null)||{},n=Object.create(t);return Object.extend(n,r)},handleConnectorSpecifiedRenderOptions:function(e,t){var r=(e.getOverriddenRenderOptions?e.getOverriddenRenderOptions():null)||{},n=Object.create(t||null);return Object.extend(n,r)},isChemObjRenderedBySelf:function(e,t){var r=this.getRenderedObjs(e);return this.tryApplySuper("isChemObjRenderedBySelf",[e,t])||r&&r.indexOf(t)>=0||this.getChemObj().hasChildObj(t)&&(!t.isExposed||t.isExposed())},isChemObjRenderedDirectlyBySelf:function(e,t){var r=this.getRenderedObjs(e);return this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[e,t])||r&&r.indexOf(t)>=0},doDrawSelf:function(e,t,r){this.tryApplySuper("doDrawSelf",[e,t,r]);var n=this.getChemObj();this._ctab=n;var i=r.transformParams;return this.getRenderCache(e).transformOptions=i,this.transformCtabCoords2DToContext(e,n,i),this.doPrepare(e,n,t,r),this.getRenderCache(e).appliedOptions=r,this.doDrawCore(e,n,r,i)},doRedraw:function(e){var t=this.getRenderCache(e);return this.doDrawCore(e,this.getChemObj(),t.appliedOptions,t.transformOptions)},doDrawCore:function(e,t,r,n){this.clearRenderedObj(e);var i=this.createDrawGroup(e);return this.doDrawConnectors(e,i,t,r,n),this.doDrawNodes(e,i,t,r,n),this.setObjDrawElem(e,t,i),i},doUpdateSelf:function(e,t,r){if(this.canModifyGraphic(e)){var n=!1,i=d.Render.ObjectUpdateType;switch(r){case i.ADD:n=this.doAddNew(e,t);break;case i.MODIFY:n=this.doModify(e,t);break;case i.REMOVE:n=this.doRemove(e,d.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(t));break;default:return this.tryApplySuper("doUpdateSelf",[e,t,r])}return n}return this.tryApplySuper("doUpdateSelf",[e,t,r])},doAddNew:function(e,t){return!!this.canModifyGraphic()&&this.doModify(e,t)},doModify:function(e,t){if(this.canModifyGraphic()){var r=this._extractObjsOfUpdateObjDetails(t);this.remove(e,r);var n=this.getChemObj(),i=this.getObjDrawElem(e,n),o=this.getRenderCache(e),a=o.appliedOptions;r.indexOf(n)>=0&&this.draw(e,o.baseCoord,a);for(var s=0,l=r.length;s<l;++s){var d=r[s];if(!d.isExposed||d.isExposed())if(n.hasConnector(d)){var u=this.handleConnectorSpecifiedRenderOptions(d,a);this.doDrawConnector(e,i,d,this.getChemObj(),u,o.transformParams||{})}else n.hasNode(d)&&(u=this.handleNodeSpecifiedRenderOptions(d,a),this.doDrawNode(e,i,d,this.getChemObj(),u,o.transformParams))}return!0}return!1},doRemove:function(e,t){if(this.canModifyGraphic()){for(var r=d.ArrayUtils.toArray(t),n=0,i=r.length;n<i;++n){var o=r[n],a=this.getObjDrawElem(e,o);if(a){var s=this.getObjDrawElem(e,this.getChemObj());this.removeFromDrawGroup(a,s),this.removeDrawnElem(e,a)}this.removeRenderedObj(e,o),this.removeExtraProp2(e,o),this.basicDrawObjectUpdated(e,o,this.getChemObj(),null,d.Render.ObjectUpdateType.REMOVE)}return!0}return!1},getCoordTransformOptions:function(e){return this.getRenderCache(e).transformOptions},transformCtabCoords2DToContext:function(e,t,r){var n=r.allowCoordBorrow,i=Object.extend({},r);i.centerX=0,i.centerY=0;var o=r.transformMatrix;this.setExtraProp2(e,t,this.TRANSFORM_MATRIX_FIELD,o);var a=o;this.setExtraProp2(e,t,this.CHILD_TRANSFORM_MATRIX_FIELD,o);var s=r.invTransformMatrix;this.setExtraProp2(e,t,this.INV_TRANSFORM_MATRIX_FIELD,s);for(var l=0,d=t.getNodeCount();l<d;++l){var u=t.getNodeAt(l);this.transformObjCoord2DToContext(e,u,o,a,n)}},transformObjCoord2DToContext:function(e,t,r,n,i){var o;if(t&&t.getAbsBaseCoord2D){var a=t.getAbsBaseCoord2D(i);if(a){var s=d.CoordUtils.transform2DByMatrix(a,r);this.setTransformedCoord2D(e,t,s),o=s}if(t.getNodes)for(var l=0,u=t.getNodeCount();l<u;++l)this.transformObjCoord2DToContext(e,t.getNodeAt(l),n,n,i)}return o},getTransformedCoord2D:function(e,t,r){d.ObjUtils.isUnset(r)&&(r=this.getRenderCache(e).options.transformParams.allowCoordBorrow);var n=t instanceof d.BaseStructureNode,i=t.getParent(),o=n&&i&&i instanceof d.BaseStructureConnector,a=n&&!o&&this.getExtraProp2(e,t,this.TRANSFORM_COORD_FIELD);if(!a){var s=this.getChemObj(),l=this.getExtraProp2(e,s,this.TRANSFORM_MATRIX_FIELD),u=this.getExtraProp2(e,s,this.CHILD_TRANSFORM_MATRIX_FIELD);a=s&&(s.hasNode(t,!1)||s.hasConnector(t,!1))?this.transformObjCoord2DToContext(e,t,l,u,r):this.transformObjCoord2DToContext(e,t,u,u,r)}return a},setTransformedCoord2D:function(e,t,r){this.setExtraProp2(e,t,this.TRANSFORM_COORD_FIELD,r)},doTransformCoordToObj:function(e,t,r){var n=this.getExtraProp2(e,t,this.INV_TRANSFORM_MATRIX_FIELD);return n?d.CoordUtils.transform2DByMatrix(r,n):this.tryApplySuper("doTransformCoordToObj",[e,t,r])},doTransformCoordToContext:function(e,t,r){var n=this.getExtraProp2(e,t,this.TRANSFORM_MATRIX_FIELD);return n?d.CoordUtils.transform2DByMatrix(r,n):this.tryApplySuper("doTransformCoordToContext",[e,t,r])},doDrawNodes:function(e,t,r,n,i){for(var o=r.getExposedNodes(),a=0,s=o.length;a<s;++a){var l=o[a],d=this.handleNodeSpecifiedRenderOptions(l,n);this.doDrawNode(e,t,l,r,d,i)}},doDrawNode:function(e,t,r,n,i,o){},doDrawConnectors:function(e,t,r,n,i){for(var o=r.getExposedConnectors(),a=0,s=o.length;a<s;++a){var l=o[a],d=this.handleConnectorSpecifiedRenderOptions(l,n);this.doDrawConnector(e,t,l,r,d,i)}},doDrawConnector:function(e,t,r,n,i,o){var a,s,l,u,c=r.getConnectedExposedObjs(),h=c.length;if(h<2)return null;for(var p,g=h>2?this.createDrawGroup(e):null,f=h>2?[]:null,m=i,C=0;C<h;++C)if(s=c[C],this.getTransformedCoord2D(e,s,o.allowCoordBorrow))for(var y=C+1;y<h;++y)if(l=c[y],this.getTransformedCoord2D(e,l,o.allowCoordBorrow)&&(p=this.doDrawConnectorShape(e,r,[s,l],m,o))){(u=p.element)&&g&&this.addToDrawGroup(u,g);var _=p.boundInfo;f&&_&&f.push(_)}return(a=g||u)&&t&&this.addToDrawGroup(a,t),a?this.setObjDrawElem(e,r,a):this.setObjDrawElem(e,r,null),this.addRenderedObj(e,r),(_||f)&&this.basicDrawObjectUpdated(e,r,n,f||_,d.Render.ObjectUpdateType.ADD),a},doDrawConnectorShape:function(e,t,r,n,i){}}),d.ClassDefineUtils.addExtraTwoTupleObjMapSupport(d.Render.Ctab2DRenderer),d.Render.ChemCtab2DRenderer=Class.create(d.Render.Ctab2DRenderer,{CLASS_NAME:"Kekule.Render.ChemCtab2DRenderer",OBJ_NEED_LABEL_FIELD:"__$needDrawLabel__",OBJ_NEED_DOT_FIELD:"__$needDrawDot__",getObjNeedDrawLabel:function(e,t){var r=this.getExtraProp2(e,t,this.OBJ_NEED_LABEL_FIELD);if(d.ObjUtils.isUnset(r)){var n=this.getRenderCache(e).appliedOptions;r=!(t instanceof d.ChemStructureConnector)&&this._needNodeDrawLabel(t,n),this.setObjNeedDrawLabel(e,t,r)}return r},setObjNeedDrawLabel:function(e,t,r){this.setExtraProp2(e,t,this.OBJ_NEED_LABEL_FIELD,r)},getObjNeedDrawDot:function(e,t){var r=this.getRenderCache(e).appliedOptions;return!(t instanceof d.ChemStructureConnector)&&this._needNodeDrawDot(e,t,r)},doPrepare:function(e,t,r,n){n.fontSize||(n.fontSize=n.atomFontSize),n.textBoxXAlignment=d.Render.BoxXAlignment.CENTER,n.textBoxYAlignment=d.Render.BoxYAlignment.CENTER,this.tryApplySuper("doPrepare",[e,t,r,n])},doPrepareLayout:function(e,t,r,n){this.tryApplySuper("doPrepareLayout",[e,t,r,n]);for(var i=t.getExposedNodes(),o=0,a=i.length;o<a;++o){var s=i[o],l=this._needNodeDrawLabel(s,n);this.setObjNeedDrawLabel(e,s,l)}},handleNodeSpecifiedRenderOptions:function(e,t){var r=this.tryApplySuper("handleNodeSpecifiedRenderOptions",[e,t]);return!r.color&&r.atomColor&&(r.color=r.atomColor),!r.fontFamily&&r.atomFontFamily&&(r.fontFamily=r.atomFontFamily),!r.fontSize&&r.atomFontSize&&(r.fontSize=r.atomFontSize),r},handleConnectorSpecifiedRenderOptions:function(e,t){var r=this.tryApplySuper("handleConnectorSpecifiedRenderOptions",[e,t]);return!r.color&&r.bondColor&&(r.color=r.bondColor),r},doDrawNode:function(e,t,r,n,i,o){var a,s,l=this.getTransformedCoord2D(e,r,o.allowCoordBorrow),u=i,c=r.getAtomicNumber?r.getAtomicNumber():0,h=r.getOverriddenRenderOptions()||{},p=h.color||h.atomColor;if(p)u.color=p;else if(u.useAtomSpecifiedColor){var g;if(c<=0){var f=r.getClassLocalName();g=d.Render.RenderColorUtils.getColor(f,this.getRendererType())}else g=d.Render.RenderColorUtils.getColor(c,this.getRendererType());u.color=g}r.getCharge()||r.getRadical();var m=r.getCharge()&&!r.fetchChargeMarker(!1),C=r.getRadical()&&!r.fetchRadicalMarker(!1),y=!1;if(this.getObjNeedDrawLabel(e,r)){y=!0;var _=this._getNodeHydrogenDisplayLevel(r,u);_===d.Render.HydrogenDisplayLevel.LABELED&&(_=d.Render.HydrogenDisplayLevel.ALL);var E=!(!m&&!C),T=r.getDisplayRichText(_,E,u.displayLabelConfigs,u.partialChargeDecimalsLength,u.chargeMarkType,u.distinguishSingletAndTripletRadical),O=u.charDirection?u.charDirection:this._decideNodeLabelCharDirection(e,r);u.fontSize*=u.unitLength;var v=Object.create(u);v.charDirection=O;var S=(R=this.drawRichText(e,l,T,v)).drawnObj,b=R.boundRect;s=this.createRectBoundInfo({x:b.left,y:b.top},{x:b.left+b.width,y:b.top+b.height}),a=S}else{var A,I,R;if(this.getObjNeedDrawDot(e,r)&&d.ObjUtils.isUnset(u.atomRadius)&&(u.atomRadius=u.allenCenterAtomRadius),u.atomRadius){var D=u.atomRadius*u.unitLength;u.strokeColor=u.color,u.fillColor=u.color,A=this.drawCircle(e,l,D,u),s=this.createCircleBoundInfo(l,D)}else s=this.createPointBoundInfo(l);(m||C)&&(R=this.doDrawElectronStateMark(e,t,r,u.chargeMarkType,u.partialChargeDecimalsLength,u.distinguishSingletAndTripletRadical,u.fontFamily,u.chargeMarkFontSize*u.unitLength,u.chargeMarkMargin*u.unitLength,u.chargeMarkCircleWidth*u.unitLength,u.color,u.opacity,u.zoom||1))&&(I=R.drawnObj),A&&I?(a=this.createDrawGroup(e),this.addToDrawGroup(a,A),this.addToDrawGroup(a,I)):a=A||I}if(r.getUnplacedMarkers(this.getCoordMode()).length>=0){var N,P=u.chemMarkerMargin;if(y){P+=this._getNodeFontSize(e,r)*(o.zoom||1)*u.unitLength*1/2-P/2;var x=d.Render.TextDirection,M=(x.LTR,x.RTL,x.TTB,x.BTT,O===x.LTR?{x:1,y:0}:O===x.RTL?{x:-1,y:0}:O===x.TTB?{x:0,y:1}:O===x.BTT?{x:0,y:-1}:{x:0,y:0}),L={x:M.x*o.scaleX,y:M.y*o.scaleY};N=L.x>0?0:L.x<0?Math.PI:L.y>0?Math.PI/2:L.y<0?3*Math.PI/2:null}var w=P/u.defBondLength*u.medianObjRefLength;this.doAdjustChemPropMarkerPos(r,w,o.allowCoordBorrow,d.ObjUtils.notUnset(N)?[N]:[])}return a?(this.setObjDrawElem(e,r,a),t&&this.addToDrawGroup(a,t)):this.setObjDrawElem(e,r,null),this.addRenderedObj(e,r),this.basicDrawObjectUpdated(e,r,n,s,d.Render.ObjectUpdateType.ADD),a},_getNodeFontSize:function(e,t,r){r||(r=this.getRenderCache(e).appliedOptions||this.getRenderCache(e).options);var n=d.Render.RenderOptionUtils.getNodeLabelDrawOptions(t.getOverriddenRenderOptions())||{};return o(n.fontSize,r.fontSize,r.atomFontSize)},_getNodeHydrogenDisplayLevel:function(e,t){var r=e.getOverriddenRenderOptions(),n=d.Render.RenderOptionUtils.getHydrogenDisplayLevel(r);return d.ObjUtils.notUnset(n)?n:t.hydrogenDisplayLevel},_needNodeDrawDot:function(e,t,r){if(t.getOverriddenRenderOptions(),t instanceof d.Atom){if(t.getAtomicNumber()!==d.Render.DEF_ATOM_ATOMIC_NUM)return!1;if(this.getObjNeedDrawLabel(e,t))return!1;if(2===t.getLinkedBonds().length){var i=t.getLinkedMultipleBonds();if(2===i.length&&i[0].getBondOrder()===i[1].getBondOrder()){var o=i[0].getBondOrder();return o>=n.DOUBLE&&o<n.EXPLICIT_AROMATIC}}return!1}return!1},_needNodeDrawLabel:function(e,t){var r=d.Render.RenderOptionUtils,n=d.Render.NodeLabelDisplayMode,i=e.getOverriddenRenderOptions(),o=r.getNodeDisplayMode(i)||t.nodeDisplayMode;if(!(e instanceof d.ChemStructureNode))return!1;if(o===n.HIDDEN)return!1;if(o===n.SHOWN)return!0;if(t.moleculeDisplayType===d.Render.MoleculeDisplayType.CONDENSED)return!0;if(e.getLinkedConnectors().length<=0)return!0;if(e instanceof d.Atom&&e.getAtomicNumber()===d.Render.DEF_ATOM_ATOMIC_NUM&&!e.getMassNumber()){if(e.getRenderOption("customLabel"))return!0;var a=this._getNodeHydrogenDisplayLevel(e,t),s=d.Render.HydrogenDisplayLevel;if(a===s.ALL)return!0;if(a===s.UNMATCHED_EXPLICIT){var l=e.getExplicitHydrogenCount();return d.ObjUtils.notUnset(l)&&e.getImplicitHydrogenCount()!==l}return d.ObjUtils.notUnset(e.getExplicitHydrogenCount())}return!0},_isNodeHasConnectorToDirection:function(e,r,n){d.ObjUtils.isUnset(n)&&(n=.2);for(var i=0,o=e.length;i<o;++i){var a=e[i];if(r===t.LTR&&a.x>n)return!0;if(r===t.RTL&&a.x<-n)return!0;if(r===t.TTB&&a.y>n)return!0;if(r===t.BTT&&a.y<-n)return!0}return!1},_calcConnectorVectorWeight:function(e){for(var t=0,r=0,n=function(e,t){return 0==t?100:Math.min(100,Math.pow(e/t,2))},i=0,o=e.length;i<o;++i)t+=e[i].x*n(e[i].x,e[i].y)*1,r+=e[i].y*n(e[i].y,e[i].x)*1;return{x:t,y:r}},_calcConnectorVectorOfNode:function(e,t){for(var r={x:0,y:0},n=this._getStandardizedLinkedObjRelCoords(e,t,null),i=0,o=n.length;i<o;++i)r.x+=n[i].x,r.y+=n[i].y;return r.x===r.y===0&&(r={x:1,y:0}),r},_calcVectorAxisDirection:function(e){return Math.abs(e.x)>=Math.abs(e.y)?e.x>0?t.LTR:t.RTL:e.y>0?t.TTB:t.BTT},_decideNodeLabelCharDirection:function(e,t){for(var r=this._getStandardizedLinkedObjRelCoords(e,t,null),n=d.Render.TextDirection,i=[n.LTR,n.RTL,n.TTB,n.BTT],o=0,a=i.length;o<a;++o)if(!this._isNodeHasConnectorToDirection(r,i[o]))return i[o];var s=this._calcConnectorVectorWeight(r);return Math.abs(s.x)>Math.abs(s.y)?s.x<=0?n.LTR:n.RTL:s.y<=0?n.TTB:n.BTT},_calcConnectorAnglesOfNode:function(e,t){for(var r=[],n=this._getStandardizedLinkedObjRelCoords(e,t,null),i=0,o=n.length;i<o;++i){var a=n[i],s=Math.atan2(a.y,a.x);s<0&&(s=2*Math.PI+s),r.push(s)}return r.sort(),r},_getMostEmptyDirectionAngleOfNode:function(e,t){var r,n=this._calcConnectorAnglesOfNode(e,t),i=n.length;if(0===i)r=0;else if(1===i)r=-n[0];else{for(var o=0,a=0,s=0;s<i;++s){var l=n[s],d=n[(s+1)%i]-l;d<0&&(d+=2*Math.PI),d>o&&(o=d,a=s)}r=n[a]+o/2}return r},doAutoAdjustAttachedMarkerPos:function(e,t,r,n,i){t&&!t.getCoordOfMode(this.getCoordMode())&&e.autoSetMarker2DPos(t,r,n,i)},doAdjustChemPropMarkerPos:function(e,t,r,n){e.beginUpdate();try{var i=e.getMarkerOfType(d.ChemMarker.Charge);this.doAutoAdjustAttachedMarkerPos(e,i,t,r,n);var o=e.getMarkerOfType(d.ChemMarker.Radical);this.doAutoAdjustAttachedMarkerPos(e,o,t,r,n);for(var a=e.getUnplacedMarkers(this.getCoordMode()),s=0,l=a.length;s<l;++s)this.doAutoAdjustAttachedMarkerPos(e,a[s],t,r,n)}finally{e.endUpdate()}},doDrawElectronStateMark:function(e,t,r,n,i,o,a,s,l,u,c,h,p){var g=r.getCharge(),f=r.getRadical(),m="";if(!i||Math.abs(g)>Math.pow(10,-i)/2){d.Render.ChargeMarkRenderType.CIRCLE_AROUND;var C=n===d.Render.ChargeMarkRenderType.CIRCLE_AROUND;m=1===g?C?"\u2295":"+":-1===g?C?"\u2296":"\u2212":(i?d.NumUtils.toDecimals(Math.abs(g),i):Math.abs(g).toString())+(g>0?"+":"\u2212")}if(f&&(m+=d.Render.ChemDisplayTextUtils.getRadicalDisplayText(f,o)),!m)return null;var y=this.getTransformedCoord2D(e,r),_=this._getMostEmptyDirectionAngleOfNode(e,r),E=l/1,T={x:Math.cos(_)*E,y:Math.sin(_)*E};T=d.CoordUtils.add(y,T);var O,v,S=d.Render.BoxXAlignment,b=d.Render.BoxYAlignment;return O=S.CENTER,v=b.CENTER,this.drawText(e,T,m,{fontFamily:a,fontSize:s,color:c,opacity:h,textBoxXAlignment:O,textBoxYAlignment:v,zoom:p||1})},doDrawConnectorShape:function(e,t,r,n,i){var o,a=d.CoordUtils,s=r[0],l=r[1],u=this.getTransformedCoord2D(e,s,i.allowCoordBorrow),c=this.getTransformedCoord2D(e,l,i.allowCoordBorrow),h={x:u.x,y:u.y},p={x:c.x,y:c.y},g=(r=[s,l],[h,p]),f=a.getDistance(h,p),m=0,C=n.unitLength||1,y=Math.sqrt(Math.sqr(p.x-h.x)+Math.sqr(p.y-h.y)),_=[],E=n.bondLengthScaleRatio;if(d.ObjUtils.notUnset(E)){var T=a.substract(p,h);o=E>0?0:1;var O=1-Math.abs(E||1),v=1===o?-1:1;_[o]=a.multiply(T,v*O)}if(this.getObjNeedDrawLabel(e,s)||this.getObjNeedDrawLabel(e,l)){var S,b,A,I=n.atomLabelBoxExpandRatio,R=p.x-h.x,D=p.y-h.y,N=R>=0?1:-1,P=D>=0?1:-1,x=0===R;if(!x)var M=Math.abs(D/R);A=Math.abs(R)>=Math.abs(D);for(var L=0,w=r.length;L<w;++L){var k=r[L],B=g[L],j=null;if(this.getObjNeedDrawLabel(e,k)&&(S=b=this._getNodeFontSize(e,k)*(i.zoom||1)*C*I/2,j=A?{x:S*N,y:S*M*P}:x?{x:0,y:b*P}:{x:b/M*N,y:b*P})){var U=_[L];U&&Math.abs(E)<=1?(Math.abs(j.x)>Math.abs(U.x)||Math.abs(j.y)>Math.abs(U.y))&&(_[L]=j):_[L]=j}N*=-1,P*=-1}}for(L=0,w=g.length;L<w;++L)if(B=g[L],j=_[L]){m+=a.getDistance(j,{x:0,y:0});var F=a.add(B,j);B.x=F.x,B.y=F.y}if(m>=f)return null;var W=(n.bondLineWidth||n.strokeWidth||1)*(n.unitLength||1);n.strokeWidth=W;var V,H=n.renderType,G=d.Render.ConnectorDrawUtils.getPossibleConnectorRenderTypes(t);return(d.ObjUtils.isUnset(H)||G.indexOf(H)<0)&&(H=G[0]),this.isLineBasedConnector(H)?V=this.doDrawLineBasedConnector(e,H,s,l,h,p,y,n):this.isTriangleBasedConnector(H)?V=this.doDrawTriangleBasedConnector(e,H,s,l,h,p,y,n):this.isTriangleHashBasedConnector(H)?V=this.doDrawTriangleHashBasedConnector(e,H,s,l,h,p,y,n):this.isRectangleBasedConnector(H)?V=this.doDrawRectangleBasedConnector(e,H,s,l,h,p,y,n):this.isWavyBasedConnector(H)&&(V=this.doDrawWavyBasedConnector(e,H,s,l,h,p,y,n)),V},_lineBasedConnectorTypes:[e.SINGLE,e.DOUBLE,e.TRIPLE,e.QUAD,e.SCISSORS_DOUBLE,e.BOLD,e.BOLD_DOUBLE,e.BOLD_TRIPLE,e.DASHED,e.DASHED_DOUBLE,e.DASHED_TRIPLE,e.SOLID_DASH,e.BOLD_DASH,e.ARROWED],_triangleBasedConnectorTypes:[e.WEDGED_SOLID,e.WEDGED_SOLID_INV,e.WEDGED_HOLLOW,e.WEDGED_HOLLOW_INV],_triangleHashBasedConnectorTypes:[e.WEDGED_HASHED,e.WEDGED_HASHED_INV,e.HASHED],_rectangleBasedConnectorTypes:[e.WEDGED_SOLID_BOTH,e.WEDGED_HOLLOW_BOTH],isLineBasedConnector:function(e){return this._lineBasedConnectorTypes.indexOf(e)>=0},isTriangleBasedConnector:function(e){return this._triangleBasedConnectorTypes.indexOf(e)>=0},isTriangleHashBasedConnector:function(e){return this._triangleHashBasedConnectorTypes.indexOf(e)>=0},isRectangleBasedConnector:function(e){return this._rectangleBasedConnectorTypes.indexOf(e)>=0},isWavyBasedConnector:function(t){return e.WAVY},doDrawLineBasedConnector:function(t,r,n,i,o,a,s,l){var d=[],u={isBold:!1,isDash:!1},c={isBold:!0,isDash:!1},h={isBold:!1,isDash:!0};switch(r){case e.DOUBLE:case e.SCISSORS_DOUBLE:for(var p=0;p<2;++p,d.push(u));break;case e.TRIPLE:for(p=0;p<3;++p,d.push(u));break;case e.QUAD:for(p=0;p<4;++p,d.push(u));break;case e.BOLD:d.push(c);break;case e.BOLD_DOUBLE:d.push(c),d.push(u);break;case e.BOLD_TRIPLE:for(d.push(c),p=0;p<2;++p,d.push(u));break;case e.BOLD_QUAD:for(d.push(c),p=0;p<3;++p,d.push(u));break;case e.DASHED:d.push(h);break;case e.DASHED_DOUBLE:for(p=0;p<2;++p,d.push(h));break;case e.DASHED_TRIPLE:for(p=0;p<3;++p,d.push(h));break;case e.SOLID_DASH:d.push(u),d.push(h);break;case e.BOLD_DASH:d.push(c),d.push(h);break;case e.ARROWED:u.isArrow=!0,d.push(u);break;case e.SINGLE:default:d.push(u)}var g=r===e.SCISSORS_DOUBLE;return this.doDrawSymmetryLineConnector(t,n,i,o,a,s,d,g,l)},doDrawSymmetryLineConnector:function(e,t,r,n,i,o,a,s,l){var u=a.length,c=null,h=null;if(1===u){var p=l.strokeWidth;a[0].isBold&&(p*=l.boldBondLineWidthRatio);var g=null;a[0].isArrow&&(g={width:l.bondArrowWidth*l.unitLength,length:l.bondArrowLength*l.unitLength});var f=Object.create(l);f.strokeWidth=p,f.strokeColor=d.Render.RenderOptionUtils.getColor(l),f.strokeDash=a[0].isDash,f.lineCap=l.bondLineCap,f.lineJoin=l.bondLineJoin,h=this.drawArrowLine(e,n,i,g,f);var m=this.createLineBoundInfo(n,i,p)}else if(u>1){c=this.createDrawGroup(e);var C=l.multipleBondSpacingAbs?l.multipleBondSpacingAbs:l.multipleBondSpacingRatio*o;l.multipleBondMaxAbsSpacing&&(C=Math.min(C,l.multipleBondMaxAbsSpacing)),C*=l.unitLength;var y=i.x-n.x,_=i.y-n.y,E=Math.sqrt(Math.sqr(y)+Math.sqr(_)),T=_/E,O=y/E,v=[],S=1;1&u||(S=s?0:d.ObjUtils.isUnset(a.bondAlign)?this._decideEvenBondAlign(e,t,r):a.bondAlign);for(var b=0;b<u;++b)if(d.ObjUtils.notUnset(a[b].offsetAdjust))v.push(a[b].offsetAdjust);else if(0===b&&0!==S)v.push(0);else{var A=1&b?1:-1;if(0!==S)var I=S*A*(b+1>>1);else I=(1*(b>>1)+.5)*A;v.push(I)}var R=C,D=0,N={x:0,y:0},P={x:0,y:0},x=[];for(b=0;b<u;++b){var M=Object.create(l),L=R*T,w=R*O,k={x:n.x-L*v[b],y:n.y+w*v[b]},B={x:i.x-L*v[b],y:i.y+w*v[b]};N=d.CoordUtils.add(N,k),P=d.CoordUtils.add(P,B),g=null,a[b].isArrow&&(g={width:l.bondArrowWidth*l.unitLength,length:l.bondArrowLength*l.unitLength}),p=l.strokeWidth,a[b].isBold&&(p*=l.boldBondLineWidthRatio),M.strokeColor=l.color,M.strokeDash=a[b].isDash,M.lineCap=l.bondLineCap,M.lineJoin=l.bondLineJoin,x.push({coord1:k,coord2:B,arrowParams:g,drawOptions:M}),0!==b&&b!==u-1||(D+=p/2),R=a[b].isBold?C+Math.floor(p/2):C}if(s)for(b=0;b<u;++b){var j=x[b],U=x[u-b-1];h=this.drawArrowLine(e,j.coord1,U.coord2,j.arrowParams,j.drawOptions),this.addToDrawGroup(h,c)}else for(b=0;b<u;++b){var F=x[b];h=this.drawArrowLine(e,F.coord1,F.coord2,F.arrowParams,F.drawOptions),this.addToDrawGroup(h,c)}N=d.CoordUtils.divide(N,u),P=d.CoordUtils.divide(P,u);var W=C*Math.abs(v[v.length-1]-v[0])+D;m=this.createLineBoundInfo(N,P,W)}return{element:c||h,boundInfo:m}},_getStandardizedLinkedObjRelCoords:function(e,t,r){for(var n=[],i=this.getTransformedCoord2D(e,t),o=t.getLinkedExposedObjs(),a=0,s=o.length;a<s;++a){var l=o[a];if(l!==r){var u=this.getTransformedCoord2D(e,l),c=d.CoordUtils.substract(u,i);c=d.CoordUtils.standardize(c),n.push(c)}}return n},_decideEvenBondAlign:function(e,t,r){var n=d.CoordUtils.substract(this.getTransformedCoord2D(e,r),this.getTransformedCoord2D(e,t));n=d.CoordUtils.standardize(n);for(var i=this._getStandardizedLinkedObjRelCoords(e,t,r),o=this._getStandardizedLinkedObjRelCoords(e,r,t),a=0,s={x:0,y:0},l=0,u=i.length;l<u;++l)a+=this._calcSinglePointAlign(i[l],n),s.x+=i[l].x,s.y+=i[l].y;for(l=0,u=o.length;l<u;++l)a+=this._calcSinglePointAlign(o[l],n),s.x+=o[l].x,s.y+=o[l].y;return 0!==a?Math.sign(a):this._calcSinglePointAlign(s,n)},_calcSinglePointAlign:function(e,t){if(Math.abs(t.x)<1e-4)return Math.abs(e.x)<1e-4?0:-Math.sign(e.x)*Math.sign(t.y);var r=t.y*e.x/t.x,n=e.y-r;return(n>1e-4?1:n<-1e-4?-1:0)*Math.sign(t.x)},doDrawTriangleBasedConnector:function(t,r,n,i,o,a,s,l){var d=r===e.WEDGED_SOLID||r===e.WEDGED_SOLID_INV,u=r===e.WEDGED_SOLID_INV||r===e.WEDGED_HOLLOW_INV?[a,o]:[o,a],c=l.bondWedgeWidth*l.unitLength,h=this._calcTriangleBaselineCoords(u[0],u[1],c),p=Object.create(l);p.strokeColor=l.color,p.fillColor=d?l.color:null;var g={element:this.drawTriangle(t,u[0],h[0],h[1],p)};return g.boundInfo=this.createLineBoundInfo(u[0],u[1],c),g},doDrawTriangleHashBasedConnector:function(t,r,n,i,o,a,s,l){var u=r===e.WEDGED_HASHED_INV,c=r!==e.HASHED,h=u?[a,o]:[o,a],p=l.hashSpacing*l.unitLength,g=l.bondWedgeWidth*l.unitLength,f=c?l.bondWedgeHashMinWidth*l.unitLength:g,m=g-f,C=d.CoordUtils.substract(h[1],h[0]),y=Math.sqrt(Math.sqr(C.x)+Math.sqr(C.y)),_=Math.floor(y/p),E=this.createDrawGroup(t),T=Object.create(l);T.strokeColor=l.color;for(var O=0;O<_;++O){var v=p*O/y,S={x:C.x*v,y:C.y*v};S=d.CoordUtils.add(S,h[0]);var b=this._calcTriangleBaselineCoords(h[0],S,m*v+f),A=this.drawLine(t,b[0],b[1],T);this.addToDrawGroup(A,E)}var I={element:E};return I.boundInfo=this.createLineBoundInfo(h[0],h[1],g),I},_calcTriangleBaselineCoords:function(e,t,r){var n=d.CoordUtils.substract(t,e),i=Math.sqrt(Math.sqr(n.x)+Math.sqr(n.y)),o=n.y/i,a=n.x/i,s=r/2,l=[];return l.push({x:t.x+s*o,y:t.y-s*a}),l.push({x:t.x-s*o,y:t.y+s*a}),l},doDrawRectangleBasedConnector:function(t,r,n,i,o,a,s,l){var u=r===e.WEDGED_SOLID_BOTH,c=l.bondWedgeWidth*l.unitLength,h=this._calcRectangleCornerCoords(o,a,c),p=Object.create(l);p.strokeColor=l.color,p.fillColor=u?l.color:null;var g=d.Render.DrawPathUtils.makePath("M",[h[0].x,h[0].y],"L",[h[1].x,h[1].y],"L",[h[2].x,h[2].y],"L",[h[3].x,h[3].y],"Z"),f={element:this.drawPath(t,g,p)};return f.boundInfo=this.createLineBoundInfo(o,a,c),f},_calcRectangleCornerCoords:function(e,t,r){var n=d.CoordUtils.substract(t,e),i=Math.sqrt(Math.sqr(n.x)+Math.sqr(n.y)),o=r/2,a=[],s=o*(n.y/i),l=o*(n.x/i);return a.push({x:e.x+s,y:e.y-l}),a.push({x:e.x-s,y:e.y+l}),a.push({x:t.x-s,y:t.y+l}),a.push({x:t.x+s,y:t.y-l}),a},doDrawWavyBasedConnector:function(e,t,r,n,i,o,a,s){for(var l,u=d.CoordUtils,c=s.bondWavyRadius*s.unitLength,h=u.getDistance(i,o),p=Math.round(h/c),g=u.divide(u.substract(o,i),p),f=h/p,m=[],C=i,y=Math.atan2(g.y,g.x)+Math.PI,_={x:f/1.5*Math.sin(y),y:-f/1.5*Math.cos(y)},E=1,T=0;T<p;++T){E=-E,l=C,C=u.add(l,g);var O=u.multiply(_,E),v=u.add(l,O),S=u.add(C,O);0===T&&(m.push("M"),m.push([l.x,l.y])),m.push("C"),m.push([v.x,v.y,S.x,S.y,C.x,C.y])}var b=d.Render.DrawPathUtils.makePath.apply(d.Render.DrawPathUtils,m),A=Object.create(s);A.strokeColor=s.color,A.fillColor=null;var I={element:this.drawPath(e,b,A)};return I.boundInfo=this.createLineBoundInfo(i,o,f),I}}),d.Render.StructFragment2DRenderer=Class.create(d.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.StructFragment2DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this._concreteRenderer=null,this._concreteChemObj=null,this.initConcreteRenderer()},finalize:function(){this.tryApplySuper("finalize"),this._concreteRenderer&&(this._concreteRenderer.finalize(),this._concreteRenderer=null)},_getRenderSortIndex:function(){return this._concreteRenderer?this._concreteRenderer._getRenderSortIndex():this.tryApplySuper("_getRenderSortIndex")},initConcreteRenderer:function(){var e=this.getChemObj(),t=this.getDrawBridge();return this._isRendererMismatch(this._concreteRenderer,e)&&this._concreteRenderer&&(this._concreteRenderer.finalize(),this._concreteRenderer=null,this._concreteChemObj=null),!this._concreteRenderer&&e&&(e.hasCtab()?(this._concreteChemObj=e.getCtab(),this._concreteRenderer=new d.Render.ChemCtab2DRenderer(e.getCtab(),t,this)):e.hasFormula()&&(this._concreteChemObj=e.getFormula(),this._concreteRenderer=new d.Render.Formula2DRenderer(e.getFormula(),t,this))),this._concreteRenderer},_isRendererMismatch:function(e,t){return e&&!t||e instanceof d.Render.ChemCtab2DRenderer&&!t.hasCtab()||e instanceof d.Render.Formula2DRenderer&&!t.hasFormula()},getConcreteRenderer:function(){return this.initConcreteRenderer(),this._concreteRenderer},_getConcreteRendererDrawOptions:function(e){return e},isChemObjRenderedBySelf:function(e,t){var r=this.getConcreteRenderer();return this.tryApplySuper("isChemObjRenderedBySelf",[e,t])||t===this.getChemObj()||r&&r.isChemObjRenderedBySelf(e,t)},isChemObjRenderedDirectlyBySelf:function(e,t){return this.getConcreteRenderer(),this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[e,t])||t===this.getChemObj()||t===this._concreteChemObj},doSetRedirectContext:function(e){this.tryApplySuper("doSetRedirectContext",[e]);var t=this.getConcreteRenderer();t&&t.setRedirectContext(e)},getChildObjs:function(){var e=this.getChemObj();if(e){for(var t=[],r=(e.getExposedNodes()||[]).concat(e.getExposedConnectors()||[]),n=0,i=r.length;n<i;++n){var o=r[n];o.getAttachedMarkers&&(t=t.concat(o.getAttachedMarkers()||[]))}return t.concat(this.tryApplySuper("getChildObjs"))}return this.tryApplySuper("getChildObjs")},_needWholelyDraw:function(e,t){var r=this.tryApplySuper("_needWholelyDraw",[e,t]);if(!r){for(var n=this.getChemObj(),i=!1,o=0,a=e.length;o<a;++o)if(e[o].isChildOf(n)){i=!0;break}r=i}return r},_createChargeAndRadicalMarkerOnStructFragment:function(e){e.beginUpdate();try{e.getCharge&&e.getCharge()&&e.fetchChargeMarker(!0),e.getNodes();for(var t=0,r=e.getNodeCount();t<r;++t){var n=e.getNodeAt(t);n.beginUpdate();try{n.getCharge()&&n.fetchChargeMarker(!0),n.getRadical()&&n.fetchRadicalMarker(!0),n.getNodeAt&&this._createChargeAndRadicalMarkerOnStructFragment(n)}finally{n.endUpdate()}}}finally{e.endUpdate()}},doDraw:function(e,t,r){var n=!!r.autoCreateChargeAndRadicalMarker;if(this.getCanModifyTargetObj()&&n){var i=this.getChemObj();this._createChargeAndRadicalMarkerOnStructFragment(i)}this.tryApplySuper("doDraw",[e,t,r])},doDrawSelf:function(e,t,r){this.tryApplySuper("doDrawSelf",[e,t,r]);var n=this.getChemObj(),i=t,o=this.getConcreteRenderer();if(!i&&o instanceof d.Render.Formula2DRenderer&&n.getAbsBaseCoord2D){var a=n.getAbsBaseCoord2D(r.allowCoordBorrow);i=d.CoordUtils.transform2D(a,r.transformParams)}return n.hasFormula()||n.hasCtab()?o?o.draw(e,i,this._getConcreteRendererDrawOptions(r)):void 0:null},doRedraw:function(e){return this.tryApplySuper("doRedraw",[e])},doUpdateSelf:function(e,t,r){if(this._extractObjsOfUpdateObjDetails(t).indexOf(this.getChemObj())>=0){var n=this.getRenderCache(e);return this.doClear(e),this.draw(e,n.baseCoord,n.options)}var i=this.getConcreteRenderer();if(i)return i.doUpdate(e,t,r)},doClearSelf:function(e){var t=this.getConcreteRenderer();if(t)return t.clear(e)},estimateRenderBox:function(e,t,r,n){var i=this.getConcreteRenderer();return i?i.estimateRenderBox(e,t,this._getConcreteRendererDrawOptions(r),n):null},transformCoordToObj:function(e,t,r){return this.tryApplySuper("transformCoordToObj",[e,t,r])},transformCoordToContext:function(e,t,r){return this.tryApplySuper("transformCoordToContext",[e,t,r])}}),d.Render.Mol2DRenderer=d.Render.StructFragment2DRenderer,d.Render.CompositeObj2DRenderer=Class.create(d.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeObj2DRenderer"}),d.Render.CompositeMolecule2DRenderer=Class.create(d.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule2DRenderer",getChildObjs:function(){for(var e=[],t=this.getChemObj().getSubMolecules(),r=0,n=t.getItemCount();r<n;++r){var i=t.getObjAt(r);e.push(i)}return e.concat(this.tryApplySuper("getChildObjs"))}}),d.Render.ChemObjGroupList2DRenderer=Class.create(d.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule2DRenderer",getChildObjs:function(){var e=this.getChemObj();if(e instanceof d.ChemObjList)for(var t=[],r=0,n=e.getItemCount();r<n;++r)t.push(e.getItemAt(r));else e instanceof d.ChemStructureObjectGroup&&(t=e.getAllObjs());return(t||[]).concat(this.tryApplySuper("getChildObjs"))}}),d.Render.Reaction2DRenderer=Class.create(d.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.Reaction2DRenderer",getChildObjs:function(){for(var e=[],t=this.getChemObj(),r=(e=[],0),n=t.getReactantCount();r<n;++r){var i=t.getReactantAt(r);e.push(i)}for(r=0,n=t.getProductCount();r<n;++r)i=t.getProductAt(r),e.push(i);return(e||[]).concat(this.tryApplySuper("getChildObjs"))}}),d.Render.ChemSpaceElement2DRenderer=Class.create(d.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpaceElement2DRenderer",getChildObjs:function(){var e=this.tryApplySuper("getChildObjs")||[];return(this.getChemObj().getChildren().toArray()||[]).concat(e)}}),d.Render.ChemSpace2DRenderer=Class.create(d.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpace2DRenderer",getChildObjs:function(){return[this.getChemObj().getRoot()].concat(this.tryApplySuper("getChildObjs")||[])},doEstimateSelfObjBox:function(e,t,r){var n=this.getChemObj().getSize2D();return n.x&&n.y&&t.useExplicitSpaceSize?{x1:0,y1:0,x2:n.x,y2:n.y}:this.tryApplySuper("doEstimateSelfObjBox",[e,t,r])}}),d.Render.Renderer2DFactory.register(d.ChemMarker.Charge,d.Render.TextBasedChemMarker2DRenderer),d.Render.Renderer2DFactory.register(d.ChemMarker.Radical,d.Render.TextBasedChemMarker2DRenderer),d.Render.Renderer2DFactory.register(d.ChemMarker.UnbondedElectronSet,d.Render.UnbondedElectronSetRenderer),d.Render.Renderer2DFactory.register(d.TextBlock,d.Render.TextBlock2DRenderer),d.Render.Renderer2DFactory.register(d.ImageBlock,d.Render.ImageBlock2DRenderer),d.Render.Renderer2DFactory.register(d.StructureFragment,d.Render.StructFragment2DRenderer),d.Render.Renderer2DFactory.register(d.CompositeMolecule,d.Render.CompositeMolecule2DRenderer),d.Render.Renderer2DFactory.register(d.Reaction,d.Render.Reaction2DRenderer),d.Render.Renderer2DFactory.register(d.ChemObjList,d.Render.ChemObjGroupList2DRenderer),d.Render.Renderer2DFactory.register(d.ChemStructureObjectGroup,d.Render.ChemObjGroupList2DRenderer),d.Render.Renderer2DFactory.register(d.ChemSpaceElement,d.Render.ChemSpaceElement2DRenderer),d.Render.Renderer2DFactory.register(d.ChemSpace,d.Render.ChemSpace2DRenderer)}(),function(){d.Render.DrawPathUtils;var e=d.CoordUtils,t=(d.oneOf,d.Glyph.NodeType),r=d.Glyph.PathType;d.Render.BaseGlyph2DRenderer=Class.create(d.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.BaseGlyph2DRenderer",doDraw:function(e,t,r){var n=Object.create(r);return n.strokeColor=r.strokeColor||r.glyphStrokeColor,n.fillColor=r.fillColor||r.glyphFillColor,n.strokeWidth=r.strokeWidth||r.glyphStrokeWidth,n.lineCap=r.glyphLineCap,n.lineJoin=r.glyphLineJoin,this.tryApplySuper("doDraw",[e,t,n])}}),d.Render.PathGlyphCtab2DRenderer=Class.create(d.Render.Ctab2DRenderer,{CLASS_NAME:"Kekule.Render.PathGlyphCtab2DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this._nodeCoordOverrideMap=new d.MapEx(!0)},doFinalize:function(){this._nodeCoordOverrideMap.finalize(),this.tryApplySuper("doFinalize")},extractGlyphDrawOptions:function(e){var t=e.unitLength||1;return{strokeColor:e.strokeColor||e.color||e.glyphStrokeColor,fillColor:e.fillColor||e.color||e.glyphFillColor,strokeWidth:(e.strokeWidth||e.glyphStrokeWidth)*t,lineCap:e.lineCap||e.glyphLineCap,lineJoin:e.lineJoin||e.glyphLineJoin}},doDraw:function(e,t,r){var n=this.tryApplySuper("doDraw",[e,t,r]);return this._nodeCoordOverrideMap.clear(),n},doDrawNode:function(e,r,n,i,o,a){var s,l=n.getNodeType();if(!l||l===t.LOCATION||l===t.CONTROLLER){var u=this._nodeCoordOverrideMap.get(n)||this.getTransformedCoord2D(e,n,a.allowCoordBorrow);s=this.createPointBoundInfo(u)}s&&this.basicDrawObjectUpdated(e,n,i,s,d.Render.ObjectUpdateType.ADD)},doDrawConnector:function(e,t,r,n,i,o){var a=this.tryApplySuper("doDrawConnector",[e,t,r,n,i,o]),s=r.getControlPoints&&r.getControlPoints();if(s)for(var l=0,u=s.length;l<u;++l){var c=this.getTransformedCoord2D(e,s[l],o.allowCoordBorrow),h=this.createPointBoundInfo(c);this.basicDrawObjectUpdated(e,s[l],r,h,d.Render.ObjectUpdateType.ADD)}return a},doDrawConnectorShape:function(t,n,i,o,a){var s,l=d.Glyph.ArrowSide,u=i[0],c=i[1],h=e.clone(this.getTransformedCoord2D(t,u,a.allowCoordBorrow)),p=e.clone(this.getTransformedCoord2D(t,c,a.allowCoordBorrow)),g=this.extractGlyphDrawOptions(o),f=n.getPathType(),m=n.getPathParams()||{},C=this.getChemObj(),y=(m.lineGap||0)*o.defScaleRefLength,_=y&&m.lineCount||1,E=[];if(m.startArrowType&&m.startArrowWidth&&(s={arrowLength:(T=this._transformArrowLength(t,m.startArrowLength,m.startArrowWidth)).arrowLength,arrowWidth:T.arrowWidth,arrowType:m.startArrowType,arrowSide:m.startArrowSide,drawOnCenter:!m.startArrowSide||m.startArrowSide===l.BOTH}),m.endArrowType&&m.endArrowWidth)var T,O={arrowLength:(T=this._transformArrowLength(t,m.endArrowLength,m.endArrowWidth)).arrowLength,arrowWidth:T.arrowWidth,arrowType:m.endArrowType,arrowSide:m.endArrowSide,drawOnCenter:!m.endArrowSide||m.endArrowSide===l.BOTH};for(var v=[],S=d.Render.MetaShapeUtils.inflateShape,b=0,A=i.length;b<A;++b){var I=i[b].getPathNodeParams();if(I.useStickingOffset){var R=this.getStickingTargetRenderBound(t,i[b]);if(R){var D=I.stickingOffsetRelLength;d.ObjUtils.isUnset(D)&&(D=o.glyphStickOffsetRelLength),D&&(R=S(R,this._doGetStickOffsetContextLength(t,D,o))),v[b]=R}}}var N=[],P=[],x={y:0,x:y},M=e.substract(this.transformCoordToContext(t,C,{x:0,y:0}),this.transformCoordToContext(t,C,x)),L=e.getDistance(M,{x:0,y:0});if(f===r.LINE)N=(B=this._doDrawLineConnectorShape(t,C,n,i,h,p,_,L,s,O,v,g,o)).drawnElems,E=B.arrowElems,P=B.boundInfos;else if(f===r.ARC){var w=n.getControlPoints&&n.getControlPoints(),k=w&&w[0];if(k){var B,j=e.clone(this.getTransformedCoord2D(t,k,a.allowCoordBorrow));N=(B=this._doDrawArcConnectorShape(t,C,n,i,h,p,j,_,L,s,O,v,g,o)).drawnElems,E=B.arrowElems,P=B.boundInfos}}if(P.length||(P=null),_<=1&&!E.length)return{element:N&&N[0],boundInfo:P&&P[0]};var U=this.createDrawGroup(t);for(b=0;b<_;++b)N[b]&&this.addToDrawGroup(N[b],U);for(b=0,A=E.length;b<A;++b)E[b]&&this.addToDrawGroup(E[b],U);return{element:U,boundInfo:P}},_doGetStickOffsetContextLength:function(t,r,n){var i={x:r*n.medianObjRefLength,y:0},o=this.getRootRenderer(),a=o.transformCoordToContext(t,this.getChemObj(),{x:0,y:0}),s=o.transformCoordToContext(t,this.getChemObj(),i);return e.getDistance(a,s)},_doDrawLineConnectorShape:function(t,r,n,i,o,a,s,l,u,c,h,p,g){for(var f=[o,a],m=[o,a],C=(e.divide(e.add(o,a),2),0);C<2;++C){var y=h[C];if(y){var _=d.Render.MetaShapeUtils.getCrossPointsOfVectorToShapeEdges(m,y,!0);_&&_.length&&(f[C]=_[0],this._nodeCoordOverrideMap.set(i[C],f[C]))}}var E=d.Glyph.ArrowSide,T=[],O=[],v=[],S=e.substract(f[1],f[0]),b=S.x,A=S.y,I=e.getDistance(f[0],f[1]),R=I,D=(s-1)/2,N=l,P={y:N*(b/I),x:A/I*-N},x=(e.multiply(P,(s-1)/2),e.multiply(P,(s-1)/2)),M=e.substract(f[0],x),L=e.substract(f[1],x);for(C=0;C<s;++C){if(j=null,U=null,0!==C&&(M=e.add(M,P),L=e.add(L,P)),u||c){var w=C-D,k=N*Math.abs(w);if(u){if(u.drawOnCenter&&(!u.arrowSide||u.arrowSide===E.SINGLE&&w<0||u.arrowSide===E.REVERSED&&w>0))var B=u.arrowType===d.Glyph.ArrowType.OPEN?u.arrowLength*k/(u.arrowWidth/2):u.arrowLength,j=e.add(M,e.multiply(S,B/R));u.drawOnCenter&&0===C&&d.ArrayUtils.pushUnique(v,this.doDrawArrowShape(t,n,f[1],f[0],u,p,!0)),!u.drawOnCenter&&(u.arrowSide===E.SINGLE&&0===C||u.arrowSide===E.REVERSED&&C===s-1)&&d.ArrayUtils.pushUnique(v,this.doDrawArrowShape(t,n,L,M,u,p,!0))}if(c){if(c.drawOnCenter&&(!c.arrowSide||c.arrowSide===E.SINGLE&&w<0||c.arrowSide===E.REVERSED&&w>0)){B=c.arrowType===d.Glyph.ArrowType.OPEN?c.arrowLength*k/(c.arrowWidth/2):c.arrowLength;var U=e.substract(L,e.multiply(S,B/R))}c.drawOnCenter&&0===C&&d.ArrayUtils.pushUnique(v,this.doDrawArrowShape(t,n,f[0],f[1],c,p)),!c.drawOnCenter&&(c.arrowSide===E.SINGLE&&0===C||c.arrowSide===E.REVERSED&&C===s-1)&&d.ArrayUtils.pushUnique(v,this.doDrawArrowShape(t,n,M,L,c,p))}}var F=this.doDrawLineShape(t,n,j||M,U||L,p,g);T.push(F.element),O.push(F.boundInfo)}return{drawnElems:T,boundInfos:O,arrowElems:v}},_doDrawArcConnectorShape:function(t,r,n,i,o,a,s,l,u,c,h,p,g,f){for(var m=[],C=[],y=[],_=[o,a],E=e.divide(e.add(s,_[0]),2),T=e.divide(e.add(_[1],s),2),O=-(_[0].x-s.x)/(_[0].y-s.y),v=-(_[1].x-s.x)/(_[1].y-s.y),S={x:(T.y-E.y-v*T.x+O*E.x)/(O-v),y:E.y+O*(T.y-E.y-v*T.x+v*E.x)/(O-v)},b=e.getDistance(S,_[0]),A=e.substract(_[0],S),I=e.substract(_[1],S),R=e.substract(s,S),D=d.GeometryUtils.standardizeAngle(Math.atan2(A.y,A.x)),N=d.GeometryUtils.standardizeAngle(Math.atan2(I.y,I.x)),P=d.GeometryUtils.standardizeAngle(Math.atan2(R.y,R.x)),x=[],M=0;M<2;++M){var L=p[M];if(L){var w=this._getCrossCoordsAndAnglesOfArcToShapeEdges(S,b,D,N,P,L);if(w&&w.length>=1){var k=w[0].coord,B=w[0].angle;x[M]=B,_[M]=k,this._nodeCoordOverrideMap.set(i[M],k)}}}x[0]&&(D=x[0]),x[1]&&(N=x[1]);var j,U,F=N-D,W=P-D,V=P-N,H=Math.sign(W)*Math.sign(V)*Math.sign(F)>0,G=10/b;if(c){var z=D-(H?G:-G);j={x:Math.cos(z),y:Math.sin(z)}}h&&(z=N+(H?G:-G),U={x:Math.cos(z),y:Math.sin(z)});var K=b-u*((l-1)/2);for(M=0;M<l;++M){var Y=K+M*u;if((c||h)&&l<=1){if(c&&0===M){var X=e.add(S,e.multiply(j,Y));d.ArrayUtils.pushUnique(y,this.doDrawArrowShape(t,n,X,_[0],c,g,!0))}h&&0===M&&(X=e.add(S,e.multiply(U,Y)),d.ArrayUtils.pushUnique(y,this.doDrawArrowShape(t,n,X,_[1],h,g,!0)))}var $=this.doDrawArcShape(t,S,Y,D,N,H,g);$.element&&m.push($.element),$.boundInfo&&C.push($.boundInfo)}return{drawnElems:m,boundInfos:C,arrowElems:y}},_getCrossCoordsAndAnglesOfArcToShapeEdges:function(t,r,n,i,o,a){for(var s=d.Render.MetaShapeUtils.getEdgeBasicElements(a),l=s.vectors,u=[],c=0,h=l.length;c<h;++c){var p=l[c];(f=d.GeometryUtils.getCrossPointsOfVectorToCircle(p,t,r,1e-4))&&f.length&&(u=u.concat(f))}var g=s.circles;for(c=0,h=g.length;c<h;++c){var f;p=g[c],(f=d.GeometryUtils.getCrossPointsOfCircles(p.center,p.radius,t,r,1e-4))&&f.length&&(u=u.concat(f))}var m=[],C=Math.sign((o-n)*(o-i));for(c=0,h=u.length;c<h;++c){var y=e.substract(u[c],t),_=d.GeometryUtils.standardizeAngle(Math.atan2(y.y,y.x));Math.sign((_-n)*(_-i))===C&&m.push({angle:_,coord:u[c]})}return m},_getNearestCoordToPoint:function(t,r){for(var n=null,i=null,o=0,a=r.length;o<a;++o){var s=e.getDistance(r[o],t);(!n||s<i)&&(n=r[o],i=s)}return n},_transformArrowLength:function(e,t,r){var n={x:t||0,y:r||0},i=d.CoordUtils.substract(this.transformCoordToContext(e,this.getChemObj(),n),this.transformCoordToContext(e,this.getChemObj(),{x:0,y:0}));return{arrowLength:Math.abs(i.x),arrowWidth:Math.abs(i.y)}},doDrawArrowShape:function(t,r,n,i,o,a,s){var l,u,c=d.Glyph.ArrowSide,h=d.Glyph.ArrowType,p=e.substract(i,n),g=e.getDistance(i,n),f=p.y/g,m=p.x/g,C=o.arrowLength,y=o.arrowWidth/2,_=e.substract(i,e.multiply(p,C/g)),E={x:y*f,y:-y*m},T=d.Render.DrawPathUtils,O=[];!o.arrowSide||!s&&o.arrowSide===c.SINGLE||s&&o.arrowSide===c.REVERSED?(l=e.add(_,E),O.push("M"),O.push([l.x,l.y]),O.push("L"),O.push([i.x,i.y])):(O.push("M"),O.push([i.x,i.y])),(!o.arrowSide||!s&&o.arrowSide===c.REVERSED||s&&o.arrowSide===c.SINGLE)&&(u=e.substract(_,E),O.push("L"),O.push([u.x,u.y]));var v=!1;if(o.arrowType===h.TRIANGLE){var S=l&&u?null:_;S&&(O.push("L"),O.push([S.x,S.y])),O.push("Z"),v=!0}var b=T.makePath.apply(this,O),A=Object.create(a);return v||(A.fillColor="transparent"),this.drawPath(t,b,A)},doDrawLineShape:function(e,t,r,n,i,o){return{element:this.drawLine(e,r,n,i),boundInfo:this.createLineBoundInfo(r,n,i.strokeWidth)}},doDrawArcShape:function(e,t,r,n,i,o,a){var s=Object.create(a);return s.fillColor=null,{element:this.drawArc(e,t,r,n,i,o,s),boundInfo:this.createArcBoundInfo(t,r,n,i,o,s.strokeWidth)}}}),d.Render.PathGlyph2DRenderer=Class.create(d.Render.BaseGlyph2DRenderer,{CLASS_NAME:"Kekule.Render.PathGlyph2DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this._concreteChemObj=e.getCtab(),this._concreteRenderer=new d.Render.PathGlyphCtab2DRenderer(e.getCtab(),t,this)},finalize:function(){this.tryApplySuper("finalize"),this._concreteRenderer&&(this._concreteRenderer.finalize(),this._concreteRenderer=null)},_getRenderSortIndex:function(){return this._concreteRenderer?this._concreteRenderer._getRenderSortIndex():this.tryApplySuper("_getRenderSortIndex")},getRenderCache:function(e){return this._concreteRenderer.getRenderCache(e)},_getConcreteRendererDrawOptions:function(e){return e},isChemObjRenderedBySelf:function(e,t){return this.tryApplySuper("isChemObjRenderedBySelf",[e,t])||t===this.getChemObj()||this._concreteRenderer.isChemObjRenderedBySelf(e,t)},isChemObjRenderedDirectlyBySelf:function(e,t){return this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[e,t])||t===this.getChemObj()},doSetRedirectContext:function(e){this.tryApplySuper("doSetRedirectContext",[e]),this._concreteRenderer.setRedirectContext(e)},doDraw:function(e,t,r){this.tryApplySuper("doDraw",[e,t,r]),this.getChemObj();var n=Object.create(r);return n.partialDrawObjs&&(n.partialDrawObjs=null),this._concreteRenderer.draw(e,t,this._getConcreteRendererDrawOptions(n))},doRedraw:function(e){return this._concreteRenderer.redraw(e)},doUpdate:function(e,t,r){if(this._extractObjsOfUpdateObjDetails(t).indexOf(this.getChemObj())>=0){var n=this.getRenderCache(e);return this.doClear(e),this.draw(e,n.baseCoord,n.options)}return this._concreteRenderer.doUpdate(e,t,r)},doClear:function(e){return this._concreteRenderer.clear(e)},estimateRenderBox:function(e,t,r){return this._concreteRenderer.estimateRenderBox(e,this._getConcreteRendererDrawOptions(t),r)},transformCoordToObj:function(e,t,r){var n=this.getChemObj()===t?this._concreteChemObj:t;return this._concreteRenderer.transformCoordToObj(e,n,r)},transformCoordToContext:function(e,t,r){var n=this.getChemObj()===t?this._concreteChemObj:t;return this._concreteRenderer.transformCoordToContext(e,n,r)}}),d.Render.Renderer2DFactory.register(d.Glyph.PathGlyph,d.Render.PathGlyph2DRenderer)}(),d.Render.CanvasRendererBridge=Class.create(d.Render.Abstract2DDrawBridge,{CLASS_NAME:"Kekule.Render.CanvasRendererBridge",DEF_DOUBLE_BUFFERED:!1,SHADOW_CANVAS_FIELD:"__$shadow_canvas__",SHADOW_CONTEXT_FIELD:"__$shadow_context__",getShadowContext:function(e){return e[this.SHADOW_CONTEXT_FIELD]},getShadowCanvas:function(e){return e[this.SHADOW_CANVAS_FIELD]},getOperatingContext:function(e){return this.getShadowContext(e)||e},createContext:function(e,t,r,n){var i=n&&n.id,o=n&&n.doubleBuffered;void 0===o&&(o=this.DEF_DOUBLE_BUFFERED),e.ownerDocument;var a=document.createElement("canvas");i&&(a.id=i);var s={alpha:!0};n&&(s=Object.extend(s,n)),e.appendChild(a);var l=a.getContext("2d",s);if(o){var d=document.createElement("canvas");d.style.position="absolute",d.style.display="none",e.appendChild(d),l[this.SHADOW_CANVAS_FIELD]=d,l[this.SHADOW_CONTEXT_FIELD]=d.getContext("2d",s)}return n&&n.overSamplingRatio&&this.setContextParam(l,"overSamplingRatio",n.overSamplingRatio),this.setContextDimension(l,t,r),l},releaseContext:function(e){var t=e.canvas,r=this.getShadowCanvas(e),n=t.parentNode;n&&(n.removeChild(t),r&&n.removeChild(r))},_getContextRawDimension:function(e){return{width:e.canvas.width,height:e.canvas.height}},_setContextRawDimension:function(e,t,r){var n=this.getShadowCanvas(e);t&&(e.canvas.width=t,e.canvas.style.width=t+"px",n&&(n.width=t,n.style.width=t+"px")),r&&(e.canvas.height=r,e.canvas.style.height=r+"px",n&&(n.height=r,n.style.height=r+"px")),this.clearContext(e)},getContextElem:function(e){return e?e.canvas:null},setContextViewBox:function(e,t,r,n,i,o){},prepareContext:function(e){},clearContext:function(e){var t=e.canvas;t.setAttribute("width",t.width);var r=this.getShadowCanvas(e);r&&(r.width=t.width);var n=e.__$clearColor__;if(n){e.save();try{var i=this.getContextDimension(e);this.drawRect(e,{x:0,y:0},{x:i.width,y:i.height},{fillColor:n,strokeColor:n})}finally{e.restore()}}},setClearColor:function(e,t){e&&(e.__$clearColor__=t)},setFilter:function(e,t){var r=this.getContextElem(e);r&&(r.style.filter=t)},clearFilter:function(e){this.setFilter(e,"none")},renderContext:function(e){var t=this.getShadowCanvas(e);if(t){var r=this.getContextDimension(e);e.drawImage(t,0,0,r.width,r.height)}},canModifyGraphic:function(e){return!1},_drawDashLine:function(e,t,r,n){null==n&&(n=5),e.moveTo(t.x,t.y);for(var i=r.x-t.x,o=r.y-t.y,a=Math.floor(Math.sqrt(i*i+o*o)/n),s=i/a,l=o/a,d=0,u=t.x,c=t.y;d++<a;)u+=s,c+=l,e[d%2==0?"moveTo":"lineTo"](u,c);e[d%2==0?"moveTo":"lineTo"](r.x2,r.y)},drawLine:function(e,t,r,n){var i=this.getOperatingContext(e);i.beginPath(),this.setDrawStyle(i,n),n.strokeDash&&!this.isLineDashSupported(i)?this._drawDashLine(i,t,r,n.strokeDash):(i.moveTo(t.x,t.y),i.lineTo(r.x,r.y)),this.doneDraw(i,n)},drawTriangle:function(e,t,r,n,i){var o=this.getOperatingContext(e);o.beginPath(),this.setDrawStyle(o,i),o.moveTo(t.x,t.y),o.lineTo(r.x,r.y),o.lineTo(n.x,n.y),o.closePath(),this.doneDraw(o,i)},drawRect:function(e,t,r,n){var i=this.getOperatingContext(e);i.beginPath(),this.setDrawStyle(i,n),i.rect(t.x,t.y,r.x-t.x,r.y-t.y),this.doneDraw(i,n)},drawRoundRect:function(e,t,r,n,i){return this.drawRect(e,t,r,i)},drawCircle:function(e,t,r,n){var i=this.getOperatingContext(e);i.beginPath(),this.setDrawStyle(i,n),i.arc(t.x,t.y,r,0,2*Math.PI,!1),this.doneDraw(i,n)},drawArc:function(e,t,r,n,i,o,a){var s=this.getOperatingContext(e);s.beginPath(),this.setDrawStyle(s,a),s.arc(t.x,t.y,r,n,i,o),this.doneDraw(s,a)},_PATH_CMDS:["M","Z","L","C","Q"],_PATH_METHODS:["moveTo","closePath","lineTo","bezierCurveTo","quadraticCurveTo"],drawPath:function(e,t,r){var n=this.getOperatingContext(e);if(!(t.length<=0)){var i;n.beginPath(),this.setDrawStyle(n,r);for(var o=0,a=t.length;o<a;++o){i=[];var s=t[o],l=s.method.toUpperCase(),d=this._PATH_CMDS.indexOf(l);if(d>=0){var u=this._PATH_METHODS[d];i=s.params,n[u].apply(n,i)}}this.doneDraw(n,r)}},drawImage:function(e,t,r,n,i,o,a){var s=this.getOperatingContext(e),l=this.getContextElem(s).ownerDocument.createElement("img");l.src=t;var d=this;l.onload=function(){try{d.setDrawStyle(s,i);var t=e;a&&(t=a()),(t=d.getOperatingContext(t)).drawImage(l,r.x,r.y,n.x,n.y),o&&o(!0),d.doneDraw(s,i)}catch(e){throw o&&o(!1),e}},l.src=t},drawImageElem:function(e,t,r,n,i){var o=this.getOperatingContext(e);this.setDrawStyle(o,i),o.drawImage(t,r.x,r.y,n.x,n.y),this.doneDraw(o,i)},isLineDashSupported:function(e){return d.ObjUtils.isUnset(this.isLineDashSupported._cachedValue)&&(this.isLineDashSupported._cachedValue=e.setLineDash&&"number"==typeof e.lineDashOffset),this.isLineDashSupported._cachedValue},setDrawStyle:function(e,t){if(d.ObjUtils.notUnset(t.strokeWidth)?e.lineWidth=t.strokeWidth:e.lineWidth=1,t.strokeColor&&(e.strokeStyle=t.strokeColor),e.lineCap=t.lineCap||"butt",e.lineJoin=t.lineJoin||"miter",this.isLineDashSupported(e))if(t.strokeDash){var r=!0===t.strokeDash?[5]:d.ArrayUtils.isArray(t.strokeDash)?t.strokeDash:[t.strokeDash];e.setLineDash(r)}else e.setLineDash([]);t.fillColor?e.fillStyle=t.fillColor:e.fillStyle="transparent",d.ObjUtils.notUnset(t.opacity)?e.globalAlpha=t.opacity:e.globalAlpha=1},doneDraw:function(e,t){e.stroke(),t.fillColor&&e.fill()},getCanvasFontStyle:function(e){var t="";return e.fontStyle&&(t+=e.fontStyle+" "),e.fontWeight&&(t+=e.fontWeight+" "),e.fontSize&&("string"==typeof e.fontSize?t+=e.fontSize+" ":t+=e.fontSize+"px "),e.fontFamily&&(t+=e.fontFamily+" "),t},drawText:function(e,t,r,n){var i=this.getOperatingContext(e),o=i.font,a=i.fillStyle,s=this.getCanvasFontStyle(n);this.setDrawStyle(i,n),i.font=s,n.color&&(i.fillStyle=n.color),i.textBaseline="top",i.fillText(r,t.x,t.y),i.fontStyle=o,i.fillStyle=a},canMeasureText:function(e){return!0},measureText:function(e,t,r){var n=this.getCanvasFontStyle(r);e.font=n;var i=e.measureText(t),o=r.fontSize;return"string"==typeof o&&(o=d.StyleUtils.analysisUnitsValue(o).value),{width:i.width,height:o}},canMeasureDrawnText:function(e){return!1},canModifyText:function(e){return!1},createGroup:function(e){},addToGroup:function(e,t){},removeFromGroup:function(e,t){},exportToDataUri:function(e,t,r){var n=this.getContextElem(e);return n?n.toDataURL(t,r):null}}),d.Render.CanvasRendererBridge.isSupported=function(){var e=!1,t=d.$jsRoot.document;return t&&t.createElement&&(e=!!t.createElement("canvas").getContext),e},d.Render.CanvasRendererBridge.getAvailabilityInformation=function(){var e=!1,t=d.$jsRoot.document;return t&&t.createElement&&(e=!!t.createElement("canvas").getContext),{available:e,message:e?null:d.$L("ErrorMsg.CANVAS2D_NOT_UNAVAILABLE")}},d.Render.DrawBridge2DMananger.register(d.Render.CanvasRendererBridge,20),function(){"use strict";var e;d.Render.RaphaelRendererBridge=Class.create(d.Render.Abstract2DDrawBridge,{CLASS_NAME:"Kekule.Render.RaphaelRendererBridge",createContext:function(t,r,n,i){return e(t,r,n)},releaseContext:function(e){e.remove()},getContextDimension:function(e){return{width:e.width,height:e.height}},setContextDimension:function(e,t,r){e.setSize(t,r),this.clearContext(e)},clearContext:function(e){e.clear();var t=e.__$clearColor__;if(t){var r=this.getContextDimension(e);this.drawRect(e,{x:0,y:0},{x:r.width,y:r.height},{fillColor:t,strokeColor:t})}},setClearColor:function(e,t){e&&(e.__$clearColor__=t)},setFilter:function(e,t){var r=this.getContextElem(e);r&&(r.style.filter=t)},clearFilter:function(e){this.setFilter(e,"none")},getContextElem:function(e){return e?e.canvas:null},transformContextCoordToScreen:function(e,t){return t},transformScreenCoordToContext:function(e,t){return t},canModifyGraphic:function(e){return!0},drawPath:function(e,t,r){for(var n="",i=0,o=t.length;i<o;++i){var a=t[i];if(n+=a.method,a.params&&a.params.length)for(var s=0,l=a.params.length;s<l;++s)n+=0===s?"":",",DataType.isArrayValue(a.params[s])?n+=a.params[s].join(","):n+=a.params[s]}var d=e.path(n);return this.setBasicElemAttribs(d,r),d},drawLine:function(e,t,r,n){var i=e.line(t.x,t.y,r.x,r.y);return this.setBasicElemAttribs(i,n),i},drawTriangle:function(e,t,r,n,i){var o=e.triangle(t.x,t.y,r.x,r.y,n.x,n.y);return this.setBasicElemAttribs(o,i),o},drawRect:function(e,t,r,n){var i=e.rect(t.x,t.y,r.x-t.x,r.y-t.y);return this.setBasicElemAttribs(i,n),i},drawRoundRect:function(e,t,r,n,i){var o=e.rect(t.x,t.y,r.x-t.x,r.y-t.y,n);return this.setBasicElemAttribs(o,i),o},drawCircle:function(e,t,r,n){var i=e.circle(t.x,t.y,r);return this.setBasicElemAttribs(i,n),i},drawArc:function(e,t,r,n,i,o,a){var s=d.GeometryUtils.polarToCartesian,l=d.GeometryUtils.standardizeAngle,u=(d.CoordUtils,s(t.x,t.y,r,i)),c=s(t.x,t.y,r,n),h=l(n,0),p=l(i,0)-h,g=l(p)<=Math.PI&&!o||l(p)>Math.PI&&o?"0":"1",f=o?"1":"0",m=["M",u.x,u.y,"A",r,r,0,g,f,c.x,c.y].join(" "),C=e.path(m);return this.setBasicElemAttribs(C,a),C},drawImage:function(e,t,r,n,i,o){try{var a=e.image(t,r.x,r.y,n.x,n.y);this.setBasicElemAttribs(a,i),o&&o(!0)}catch(e){throw o&&o(!1),e}return a},drawImageElem:function(e,t,r,n,i){return this.drawImage(e,t.src,r,n,i)},setBasicElemAttribs:function(e,t){d.ObjUtils.notUnset(t.strokeWidth)&&e.attr("stroke-width",t.strokeWidth),t.strokeColor&&e.attr("stroke",t.strokeColor),t.strokeDash&&e.attr("stroke-dasharray","- "),t.fillColor&&e.attr("fill",t.fillColor),t.opacity&&e.attr({"stroke-opacity":t.opacity,"fill-opacity":t.opacity}),t.lineCap&&e.attr("stroke-linecap",t.lineCap),t.lineJoin&&e.attr("stroke-linejoin",t.lineJoin)},getRaphaelFontStyle:function(e){var t={};return e.fontStyle&&(t["font-style"]=e.fontStyle),e.fontWeight&&(t["font-weight"]=e.fontWeight),e.fontSize&&(t["font-size"]=e.fontSize+"px"),e.fontFamily&&(t["font-family"]=e.fontFamily),t},drawText:function(e,t,r,n){r.endsWith(" ")&&(r=r.substring(0,r.length-1)+"\xa0"),r.startsWith(" ")&&(r="\xa0"+r.substr(1));var i=this.getRaphaelFontStyle(n),o=e.text(-1e4,-1e4,r);return o.attr(i),n.color&&o.attr({stroke:n.color,fill:n.color}),this.modifyDrawnTextCoord(e,o,t),this.setBasicElemAttribs(o,n),o},canMeasureText:function(e){return!1},canMeasureDrawnText:function(e){return!0},canModifyText:function(e){return!0},measureDrawnText:function(e,t,r){var n=d.oneOf,i=t.getBBox(),o={};return o.width=n(i.width,i.x2-i.x1),o.height=n(i.height,i.y2-i.y1),o},modifyDrawnTextCoord:function(e,t,r){var n=this.measureDrawnText(e,t,null);t.attr({x:r.x+n.width/2,y:r.y+n.height/2})},createGroup:function(e){return e.set()},addToGroup:function(e,t){return t.push(e)},removeFromGroup:function(e,t){return e!==t&&t.exclude(e)},removeDrawnElem:function(e,t){t.remove()},exportToDataUri:function(e,t,r){if(e.toSVG){var n=e.toSVG();return"data:image/svg+xml;base64,"+btoa(n)}if(e.canvas&&"svg"===e.canvas.tagName.toLowerCase())return n=DataType.XmlUtility.serializeNode(e.canvas),"data:image/svg+xml;base64,"+btoa(n)}}),d.Render.RaphaelRendererBridge.isSupported=function(){var t=!1;return d.$jsRoot.Raphael&&(t=!(!e.svg&&!e.vml)),t},d.Render.RaphaelRendererBridge.getAvailabilityInformation=function(){var e=!!d.$jsRoot.Raphael,t=!(!e||!d.$jsRoot.Raphael.svg&&!d.$jsRoot.Raphael.vml);return{available:!!t,message:e?t?null:d.$L("ErrorMsg.RAPHAEL_SVG_VML_UNAVAILABLE"):d.$L("ErrorMsg.RAPHAEL_LIB_NOT_UNAVAILABLE")}},d.Render.DrawBridge2DMananger.register(d.Render.RaphaelRendererBridge,10);var t=function e(){var t;e.registered||d.$jsRoot.Raphael&&d.$jsRoot.Raphael.el&&(t=d.$jsRoot.Raphael,d.Render.registerExternalModule("Raphael.js",t),e.registered=!0)};d.externalResourceManager.on("Raphael.jsRegistered",(function(){(e=d.externalResourceManager.getResource("Raphael.js"))&&(e.fn.line=function(e,t,r,n){return this.path("M"+e+" "+t+" L"+r+" "+n)},e.fn.arrowLine=function(e,t,r,n,i){if(!i)return this.line(e,t,r,n);var o=this.set(),a=r-e,s=n-t,l=Math.atan(s/a),d=(i.width||6)/2,u=i.length||3,c=Math.atan(d/u),h=Math.sqrt(Math.sqr(d)+Math.sqr(u));return o.push(this.path("M"+r+" "+n+" L"+(r-h*Math.cos(l-c))+" "+(n-h*Math.sin(l-c))+" M"+r+" "+n+" L"+(r-h*Math.cos(l+c))+" "+(n-h*Math.sin(l+c))),this.path("M"+e+" "+t+" L"+r+" "+n)),o},e.fn.triangle=function(e,t,r,n,i,o){return this.path("M"+e+" "+t+" L"+r+" "+n+" L"+i+" "+o+" L"+e+" "+t)},e.fn.polygon=function(e){for(var t="M"+e[0].x+" "+e[0].y,r=1,n=e.length;r<n;++r)t+=" L"+e[r].x+" "+e[r].y;return t+="L"+e[0].x+" "+e[0].y,this.path(t)},e.el.translateCoord=function(e){if(this.forEach)this.forEach((function(t){t.translateCoord(e)}));else{var t=this.attr(["x","y"]);void 0!==t.x&&void 0!==t.y&&this.attr({x:t.x+e.x,y:t.y+e.y})}return this},e.st.translateCoord=function(e){return this.forEach&&this.forEach((function(t){t.translateCoord(e)})),this},e.st.remove=function(e){this.forEach((function(e){e.remove()}),this),this.clear()}),d.Render.DrawBridge2DMananger.register(d.Render.RaphaelRendererBridge,10)})),d.externalResourceManager.on("Raphael.jsUnregistered",(function(){})),t(),d.X.domReady(t)}(),function(){var e=d.ObjUtils,t=d.BoxUtils,r=d.Render.Molecule3DDisplayType,n=d.Render.Bond3DRenderMode,i=d.Render.Bond3DRenderType,o=d.Render.Bond3DSpliceMode,a=d.Render.Node3DRenderMode,s=d.oneOf;d.Render.Abstract3DDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.Abstract3DDrawBridge",CONTEXT_PARAMS_FIELD:"__$context_params__",getGraphicQualityLevel:function(){return null},setGraphicQualityLevel:function(e){},transformContextCoordToScreen:function(e,t){return{x:t.x,y:t.y}},canModifyGraphic:function(e){return!1},createContext:function(e,t,r){return null},getContextDimension:function(e){return{}},setContextDimension:function(e,t,r){return null},clearContext:function(e){return null},getContextParam:function(e,t){return(e[this.CONTEXT_PARAMS_FIELD]||{})[t]},setContextParam:function(e,t,r){e[this.CONTEXT_PARAMS_FIELD]||(e[this.CONTEXT_PARAMS_FIELD]={}),e[this.CONTEXT_PARAMS_FIELD][t]=r},_getOverSamplingRatio:function(e){return this.getContextParam(e,"overSamplingRatio")||null},setClearColor:function(e,t){},drawSphere:function(e,t,r,n){},drawCylinder:function(e,t,r,n,i){},drawLine:function(e,t,r,n){},createDrawGroup:function(e){},addToDrawGroup:function(e,t){},removeFromDrawGroup:function(e,t){},getCameraProps:function(e){},setCameraProps:function(e,t){},exportToDataUri:function(e,t,r){}}),d.Render.Base3DRenderer=Class.create(d.Render.CompositeRenderer,{CLASS_NAME:"Kekule.Render.Base3DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},getRendererType:function(){return d.Render.RendererType.R3D},getActualTargetContext:function(e){return this.getRedirectContext()||e},getCameraProps:function(e){return this.getDrawBridge().getCameraProps(e)},setCameraProps:function(e,t){return this.getDrawBridge().setCameraProps(e,t)},getInitialLightPositions:function(e){return this.getDrawBridge().getInitialLightPositions&&this.getDrawBridge().getInitialLightPositions(e)},getLightCount:function(e){return this.getDrawBridge().getLightCount&&this.getDrawBridge().getLightCount(e)},getLightProps:function(e,t){return this.getDrawBridge().getLightProps&&this.getDrawBridge().getLightProps(e,t)},setLightProps:function(e,t,r){return this.getDrawBridge().setLightProps(e,t,r)},drawSphere:function(e,t,r,n){return this.getDrawBridge().drawSphere(this.getActualTargetContext(e),t,r,n)},drawCylinder:function(e,t,r,n,i){var o=this.getDrawBridge();return o?o.drawCylinder(this.getActualTargetContext(e),t,r,n,i):null},drawCylinderEx:function(e,t,r,n,i){var o=null,a=this.drawCylinder(e,t,r,n,i);if(a&&i.withEndCaps){o=this.createDrawGroup(e);var s=this.drawSphere(e,t,n);this.addToDrawGroup(s,o),s=this.drawSphere(e,r,n),this.addToDrawGroup(s,o)}return o||a},drawParallelCylinders:function(e,t,r){var n=this.getDrawBridge();if(n.drawParallelCylinders)return n.drawParallelCylinders(this.getActualTargetContext(e),t,r);for(var i=this.createDrawGroup(e),o=0,a=t.length;o<a;++o){var s=t[o],l=this.drawCylinderEx(e,s.coord1,s.coord2,s.radius,{color:s.color,withEndCaps:r});l&&this.addToDrawGroup(l,i)}return i},drawLine:function(e,t,r,n){var i=this.getDrawBridge();return i?i.drawLine(this.getActualTargetContext(e),t,r,n):null},drawParallelLines:function(e,t,r){var n=this.getDrawBridge();if(n.drawParallelLines)return n.drawParallelLines(this.getActualTargetContext(e),t,r);if(n.drawLine){for(var i,o=t.length,a=[],s=0;s<o;++s){var l=t[s],d=this.drawLine(e,l.coord1,l.coord2,{lineWidth:l.lineWidth,color:l.color,opacity:l.opacity});d&&a.push(d)}if(a.length<=1)i=a[0];else{i=this.createDrawGroup(e),s=0;for(var u=a.length;s<u;++s)this.addToDrawGroup(a[s],i)}return i}},createDrawGroup:function(e){return this.getDrawBridge().createGroup(this.getActualTargetContext(e))},addToDrawGroup:function(e,t){return this.getDrawBridge().addToGroup(e,t)},removeFromDrawGroup:function(e,t){return this.getDrawBridge().removeFromGroup(e,t)},removeDrawnElem:function(e,t){}}),d.Render.ChemObj3DRenderer=Class.create(d.Render.Base3DRenderer,{CLASS_NAME:"Kekule.Render.ChemObj3DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this._enableTransformByCamera=!0},doEstimateSelfObjBox:function(e,t,r){return d.Render.ObjUtils.getContainerBox(this.getChemObj(),this.getCoordMode(),r)},doEstimateRenderBox:function(e,r,n,i){var o=this.estimateObjBox(e,n,i);if(o){var a=this.prepareTransformParams(e,r,n,o);return t.transform3D(o,a)}return null},beginDraw:function(e,t,r){if(this.tryApplySuper("beginDraw",[e,t,r]),this.isRootRenderer()){var n=this.getDrawBridge();if(n&&n.setGraphicQualityLevel){var i=r.graphicQuality;n.setGraphicQualityLevel(i)}}},endDraw:function(e,t,r){this.isRootRenderer()&&this.adjustCamera(e,r.transformParams),this.tryApplySuper("endDraw",[e,t,r])},doDraw:function(e,t,r){return this.prepareTransformParams(e,t,r),this.tryApplySuper("doDraw",[e,t,r])},changeGeometryOptions:function(e,t,r){var n=Object.create(r);this.prepareTransformParams(e,t,n).pureCameraTransform?this.endDraw(e,t,n):(this.getDrawBridge().clearContext(e),this.draw(e,t,r))},prepareTransformParams:function(e,t,r,n){var i;if(r.transformParams)i=r.transformParams;else{var o=this.generateTransformParams(e,t,r,n);r.transformParams=o,i=o}var a=d.CoordUtils.calcTransform3DMatrix(i),s=d.CoordUtils.calcInverseTransform3DMatrix(i);return r.transformParams.transformMatrix=a,r.transformParams.invTransformMtrix=s,this.getRenderCache(e).transformParams=i,this.getRenderCache(e).transformMatrix=a,this.getRenderCache(e).invTransformMatrix=s,this.getRenderCache(e).transformParams=i,i},canDoPureCameraTransform:function(e,t){return this._enableTransformByCamera&&t.scaleX===t.scaleY&&t.scaleY===t.scaleZ&&!t.rotateAngle&&!t.rotateX&&!t.rotateY&&!t.rotateZ},generateTransformParams:function(t,r,n,i){var o={};o.allowCoordBorrow=s(n.allowCoordBorrow,!1),o.unitLength=n.unitLength||1,i||(i=this.estimateObjBox(t,n,o.allowCoordBorrow)),i||(i={x1:0,x2:1,y1:0,y2:1,z1:0,z2:1});var a={x:(i.x1+i.x2)/2,y:(i.y1+i.y2)/2,z:(i.z1+i.z2)/2},l=d.ObjUtils;l.isUnset(n.translateX)&&l.isUnset(n.translateY)&&l.isUnset(n.translateZ)?r&&(o.translateX=r.x-a.x,o.translateY=r.y-a.y,o.translateZ=r.z||0-a.z||0):(o.translateX=n.translateX||0,o.translateY=n.translateY||0,o.translateZ=n.translateZ||0),o.zoom=n.zoom||1,o.scaleX=s(n.scaleX,n.scale,1),o.scaleY=s(n.scaleY,n.scale,1),o.scaleZ=s(n.scaleZ,n.scale,1),n.scaleX||n.scaleY||n.scaleZ||n.scale,e.notUnset(n.rotateMatrix)?o.rotateMatrix=n.rotateMatrix:e.notUnset(n.rotateAngle)&&e.notUnset(n.rotateAxisVector)?o.rotateMatrix=d.CoordUtils.calcRotate3DMatrix({rotateAngle:n.rotateAngle,rotateAxisVector:n.rotateAxisVector}):(o.rotateX||o.rotateY||o.rotateZ)&&(o.rotateMatrix=d.CoordUtils.calcRotate3DMatrix({rotateX:n.rotateX||0,rotateY:n.rotateY||0,rotateZ:n.rotateZ||0})),l.isUnset(n.center)&&(o.center=a),o.drawBaseCoord=r||d.CoordUtils.transform3D(a,o);var u=Object.extend({},o);(o=this.getFinalTransformParams(t,o)).initialTransformOptions=u;var c=this.canDoPureCameraTransform(t,o);if(o.pureCameraTransform=c,this.isRootRenderer()&&(n.autofit||!n.cameraPos)){var h=this.getAutofitObjBoxInflation(t,this.getChemObj(),n),p=d.BoxUtils.inflateBox(i,h.x,h.y,h.z),g=Math.max(p.x2-p.x1,p.y2-p.y1),f=this.getCameraProps(t),m=g/2/Math.tan(f.fov/2),C=Math.sqrt(Math.sqr(m)-Math.sqr(g/2));if(c){C/=o.scaleX,o.cameraWidth=g/o.scaleX,o.cameraHeight=o.cameraWidth;var y,_,E,T,O=d.MatrixUtils.create(4,1,[0,0,1,1]),v=d.MatrixUtils.create(4,1,[0,1,1,1]);if(o.rotateMatrix){var S=d.MatrixUtils.transpose(o.rotateMatrix);y=d.MatrixUtils.multiply(S,O),E=d.MatrixUtils.multiply(S,v),_={x:y[0],y:y[1],z:y[2]},T={x:E[0],y:E[1],z:E[2]}}else _={x:0,y:0,z:1},T={x:0,y:1,z:1};_=d.CoordUtils.multiply(_,C),o.cameraPos={x:_.x,y:_.y,z:_.z},o.cameraPos=d.CoordUtils.add(o.cameraPos,o.drawBaseCoord),o.cameraUp=T,o.scaleX=o.scaleY=o.scaleZ=1;var b=this.getInitialLightPositions(t);if(S){var A=this.getLightCount(t);if(b&&b.length&&A)for(var I=Math.min(b.length,A),R=[],D=0;D<I;++D){var N=b[D];if(N){var P=d.MatrixUtils.create(4,1,[N.x,N.y,N.z,1]),x=d.MatrixUtils.multiply(S,P),M={x:x[0],y:x[1],z:x[2]};R.push(M)}}}o.lightPositions=R||b,o.rotateMatrix=null}else o.cameraPos={x:o.drawBaseCoord.x,y:o.drawBaseCoord.y,z:C+o.drawBaseCoord.z},o.cameraUp={x:0,y:1,z:1};o.cameraLookAtVector=o.drawBaseCoord||{x:0,y:0,z:0};var L={x:-o.translateX,y:-o.translateY,z:-o.translateZ};o.translateX=o.translateY=o.translateZ=0,o.cameraPos=d.CoordUtils.add(o.cameraPos,L),o.cameraLookAtVector=d.CoordUtils.add(o.cameraLookAtVector,L)}return o},getFinalTransformParams:function(e,t){var r=Object.create(t);return r.zoom&&(r.scaleX*=r.zoom,r.scaleY*=r.zoom,r.scaleZ*=r.zoom),1!==r.unitLength&&(r.translateX*=r.unitLength,r.translateY*=r.unitLength,r.translateZ*=r.unitLength,r.drawBaseCoord&&(r.drawBaseCoord=d.CoordUtils.multiply(r.drawBaseCoord,r.unitLength))),r},getRenderFinalTransformParams:function(e){return this.getRenderCache(e).transformParams},getRenderInitialTransformOptions:function(e){var t=this.getRenderFinalTransformParams(e);return t?t.initialTransformOptions:null},getAutofitObjBoxInflation:function(e,t,r){var n=r.fixedNodeRadius||0;return{x:n,y:n,z:n}},adjustCamera:function(e,t){var r=t.cameraWidth,n=t.cameraHeight,i={position:t.cameraPos,upVector:t.cameraUp,lookAtVector:t.cameraLookAtVector};if(r&&n){var o=r/2,a=n/2;i.left=-o,i.right=o,i.top=a,i.bottom=-a}this.setCameraProps(e,i),this.adjustLights(e,t)},adjustLights:function(e,t){for(var r=t.lightPositions||[],n=0,i=r.length;n<i;++n){var o=r[n];o&&this.setLightProps(e,n,{position:o})}}}),d.Render.ChemCtab3DRenderer=Class.create(d.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemCtab3DRenderer",TRANSFORM_COORD_FIELD:"__$transCoord3D__",DRAW_ELEM_FIELD:"__$drawElem__",DRAW_COLOR_FIELD:"__$drawColor__",BASE_RADIUS_FIELD:"__$baseRadius__",TRANSFORM_MATRIX_FIELD:"__$transMatrix__",INV_TRANSFORM_MATRIX_FIELD:"__$inverseTransMatrix__",CHILD_TRANSFORM_MATRIX_FIELD:"__$childTransMatrix__",HIDDEN_NODES_FIELD:"__$hiddenNodes__",HIDDEN_CONNECTORS_FIELD:"__$hiddenConnectors__",getObjDrawElem:function(e,t){return this.getExtraProp2(e,t,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(e,t,r){this.setExtraProp2(e,t,this.DRAW_ELEM_FIELD,r)},getObjDrawColor:function(e,t){return this.getExtraProp2(e,t,this.DRAW_COLOR_FIELD)},setObjDrawColor:function(e,t,r){this.setExtraProp2(e,t,this.DRAW_COLOR_FIELD,r)},getNodeBaseRadius:function(e,t){return this.getExtraProp2(e,t,this.BASE_RADIUS_FIELD)},setNodeBaseRadius:function(e,t,r){this.setExtraProp2(e,t,this.BASE_RADIUS_FIELD,r)},getHiddenNodes:function(e){return this.getExtraProp(e,this.HIDDEN_NODES_FIELD)||[]},setHiddenNodes:function(e,t){return this.setExtraProp(e,this.HIDDEN_NODES_FIELD,t)},getHiddenConnectors:function(e){return this.getExtraProp(e,this.HIDDEN_CONNECTORS_FIELD)||[]},setHiddenConnectors:function(e,t){return this.setExtraProp(e,this.HIDDEN_CONNECTORS_FIELD,t)},doEstimateSelfObjBox:function(e,t,r){return this.getChemObj().getExposedContainerBox3D(r)},doPrepare:function(e,t,i,o){var s,l,d=o,u=this.getRenderCache(e);switch(d.moleculeDisplayType){case r.WIRE:s=a.NONE,l=d.displayMultipleBond?n.MULTI_WIRE:n.WIRE;break;case r.STICKS:s=a.NONE,l=d.displayMultipleBond?n.MULTI_CYLINDER:n.CYLINDER;break;case r.SPACE_FILL:s=a.SPACE,l=n.NONE;break;case r.BALL_STICK:default:s=a.BALL,l=d.displayMultipleBond?n.MULTI_CYLINDER:n.CYLINDER}u.nodeRenderMode=s,u.connectorRenderMode=l,u.options=d;var c=t.getExposedNodes(),h=t.getExposedConnectors();return this.prepareHiddenObjects(e,c,h,d),this.prepareNodesDrawColor(e,c,d),this.prepareNodeBaseRadii(e,c,d),d},prepareHiddenObjects:function(e,t,r,n){var i=[];this.setHiddenNodes(e,i);for(var o=0,a=t.length;o<a;++o){var s=t[o];n.hideHydrogens&&s instanceof d.Atom&&1===s.getAtomicNumber()&&i.push(s)}var l=[];for(this.setHiddenConnectors(e,l),o=0,a=r.length;o<a;++o){var u=r[o],c=u.getConnectedExposedObjs();d.ArrayUtils.exclude(c,i)<2&&l.push(u)}},prepareNodesDrawColor:function(e,t,r){for(var n=r.useAtomSpecifiedColor,i=0,o=t.length;i<o;++i){var a=t[i],l=a.getOverriddenRender3DOptions()||{},u=l.color||l.atomColor;if(u&&!l.useAtomSpecifiedColor);else if(n||l.useAtomSpecifiedColor){var c=a.getAtomicNumber?a.getAtomicNumber():0;u=c>=0?d.Render.RenderColorUtils.getColor(c,this.getRendererType()):d.Render.RenderColorUtils.getColor(a.getClassLocalName(),this.getRendererType())}else u=s(l.color||r.atomColor);this.setObjDrawColor(e,a,u)}},prepareNodeBaseRadii:function(e,t,r){for(var n=0,i=t.length;n<i;++n){var o,a=t[n];o=this.calcNodeBaseRadius(a,r),this.setNodeBaseRadius(e,a,o)}},calcNodeBaseRadius:function(e,t){var r=e.getOverriddenRender3DOptions()||{},n=e.getAtomicNumber?e.getAtomicNumber():null;return r.nodeRadius||t.nodeRadius?r.nodeRadius||t.nodeRadius:s(r.useVdWRadius,t.useVdWRadius)&&n?d.ChemicalElementsDataUtil.getElementProp(n,"radiiVdw")||r.fixedNodeRadius||t.fixedNodeRadius:s(r.fixedNodeRadius,t.fixedNodeRadius)},doDrawSelf:function(e,t,r){this.tryApplySuper("doDrawSelf",[e,t,r]);var n=this.getChemObj(),i=r.transformParams;this.getRenderCache(e).transformOptions=i,this.transformCtabCoords3DToContext(e,n,i);var o=this.doPrepare(e,n,t,r);return this.doDrawCore(e,n,o,i)},doRedraw:function(e){var t=this.getRenderCache(e);return this.doDrawCore(e,this.getChemObj(),t.options,t.transformOptions)},doDrawCore:function(e,t,r,n){var i=this.createDrawGroup(e);return this.doDrawConnectors(e,i,t,r,n),this.doDrawNodes(e,i,t,r,n),this.setObjDrawElem(e,t,i),i},transformCtabCoords3DToContext:function(e,t,r){var n=r.allowCoordBorrow;r.scaleX=r.scaleX||r.scale,r.scaleY=r.scaleY||r.scale,r.scaleZ=r.scaleZ||r.scale;var i=Object.extend({},r);i.centerX=0,i.centerY=0;var o=r.transformMatrix;this.setExtraProp2(e,t,this.TRANSFORM_MATRIX_FIELD,o);var a=o;this.setExtraProp2(e,t,this.CHILD_TRANSFORM_MATRIX_FIELD,o);var s=r.invTransformMatrix;this.setExtraProp2(e,t,this.INV_TRANSFORM_MATRIX_FIELD,s);for(var l=0,d=t.getNodeCount();l<d;++l){var u=t.getNodeAt(l);this.transformObjCoord3DToContext(e,u,o,a,n)}},transformObjCoord3DToContext:function(e,t,r,n,i){var o,a;if(t&&t.getAbsBaseCoord3D){if(a=t.getAbsBaseCoord3D(i)){var s=d.CoordUtils.transform3DByMatrix(a,r);this.setTransformedCoord3D(e,t,s),o=s}if(t.getNodes)for(var l=0,u=t.getNodeCount();l<u;++l)this.transformObjCoord3DToContext(e,t.getNodeAt(l),n,n,i)}return o},getTransformedCoord3D:function(e,t,r){d.ObjUtils.isUnset(r)&&(r=this.getRenderCache(e).options.transformParams.allowCoordBorrow);var n=t instanceof d.BaseStructureNode&&this.getExtraProp2(e,t,this.TRANSFORM_COORD_FIELD);if(!n){var i=this.getChemObj(),o=this.getExtraProp2(e,i,this.TRANSFORM_MATRIX_FIELD),a=this.getExtraProp2(e,i,this.CHILD_TRANSFORM_MATRIX_FIELD);n=i&&(i.hasNode(t,!1)||i.hasConnector(t,!1))?this.transformObjCoord3DToContext(t,o,a,r):this.transformObjCoord3DToContext(t,a,a,r)}return n},setTransformedCoord3D:function(e,t,r){this.setExtraProp2(e,t,this.TRANSFORM_COORD_FIELD,r)},doTransformCoordToObj:function(e,t,r){var n=this.getExtraProp2(e,t,this.INV_TRANSFORM_MATRIX_FIELD);return d.CoordUtils.transform3DByMatrix(r,n)},doTransformCoordToContext:function(e,t,r){var n=this.getExtraProp2(e,t,this.TRANSFORM_MATRIX_FIELD);return d.CoordUtils.transform3DByMatrix(r,n)},doDrawNodes:function(e,t,r,n,i){for(var o=r.getExposedNodes(),a=this.getHiddenNodes(e),s=0,l=o.length;s<l;++s){var d=o[s];a.indexOf(d)>=0||this.doDrawNode(e,t,d,r,n,i)}},doDrawNode:function(e,t,r,n,i,o){var s,l,u,c=this.getRenderCache(e).nodeRenderMode;if(c===a.NONE)return null;l=d.Render.RenderOptionUtils.mergeObjLocalRender3DOptions(r,i),u=this.getNodeBaseRadius(e,r),d.ObjUtils.isUnset(u)&&(u=this.calcNodeBaseRadius(r,i)),c===a.SPACE?u*=o.scaleX:u*=l.nodeRadiusRatio*o.scaleX;var h=this.getObjDrawColor(e,r),p=this.getTransformedCoord3D(e,r,o.allowCoordBorrow);s=this.drawSphere(e,p,u,{color:h,opacity:l.opacity});var g=this.createSphereBoundInfo(p,u);this.basicDrawObjectUpdated(e,r,n,g,d.Render.ObjectUpdateType.ADD),s&&(this.setObjDrawElem(e,r,s),t&&this.addToDrawGroup(s,t))},doDrawConnectors:function(e,t,r,i,o){if(this.getRenderCache(e).connectorRenderMode===n.NONE)return null;for(var a=r.getExposedConnectors(),s=this.getHiddenConnectors(e),l=0,d=a.length;l<d;++l){var u=a[l];s.indexOf(u)>=0||this.doDrawConnector(e,t,u,r,i,o)}},doDrawConnector:function(e,t,r,n,i,o){var a=Object.create(i);a=d.Render.RenderOptionUtils.mergeObjLocalRender3DOptions(r,i);for(var s,l,u,c,h,p=this.getHiddenNodes(e),g=r.getConnectedExposedObjs(),f=(g=d.ArrayUtils.exclude(g,p)).length,m=f>2?this.createDrawGroup(e):null,C=0;C<f;++C)if(s=g[C],u=this.getTransformedCoord3D(e,s,o.allowCoordBorrow))for(var y=C+1;y<f;++y)l=g[y],(c=this.getTransformedCoord3D(e,l,o.allowCoordBorrow))&&(h=this.doDrawConnectorShape(e,r,[s,l],n,u,c,a,o))&&m&&this.addToDrawGroup(h,m);return m?this.addToDrawGroup(m,t):this.addToDrawGroup(h,t),m||h},doDrawConnectorShape:function(e,t,r,a,l,u,c,h){var p=d.CoordUtils,g=t.getOverriddenRender3DOptions()||{},f=(c.unitLength,r[0]),m=r[1],C=s(g.bondSpliceMode,c.bondSpliceMode),y=C===o.MID_SPLIT?.5:null;if(C===o.WEIGHTING_SPLIT){var _=this.getNodeBaseRadius(e,f),E=this.getNodeBaseRadius(e,m);y=_&&E?_/(_+E):.5}var T=null,O=!1,v=[];if(y){var S=s(c.color||c.bondColor),b=s(g.color||g.bondColor);if(O=!1,b)v.push(b);else{var A=s(this.getObjDrawColor(e,f),S),I=s(this.getObjDrawColor(e,m),S);A!==I?(v.push(A),v.push(I),O=!0):v.push(s(A,c.color,c.bondColor,c.defBondColor))}}else v.push(s(g.color,g.bondColor,c.color,c.bondColor,c.defBondColor));if(y&&O){var R=u.x-l.x,D=u.y-l.y,N=u.z-l.z;(T={}).x=l.x+R*y,T.y=l.y+D*y,T.z=l.z+N*y}var P=O?[[l,T],[T,u]]:[[l,u]],x=this.getRenderCache(e).connectorRenderMode,M=this._getBondRenderType(t,x),L=!1,w=s(g.connectorRadius,c.connectorRadius)*s(g.connectorRadiusRatio,c.connectorRadiusRatio)*c.unitLength;w*=h.scaleX;var k=s(g.connectorLineWidth,c.connectorLineWidth)*c.unitLength;M!==i.SINGLE&&M!==i.DASH?(w*=s(g.multiConnectorRadiusRatio,c.multiConnectorRadiusRatio),L=x===n.MULTI_CYLINDER):L=!1;var B,j=[],U=1;switch(M){case i.SINGLE:U=1;break;case i.DOUBLE:U=2;break;case i.TRIPLE:U=3;case i.DASH:case i.SOLID_DASH:}var F=null;if((B=U)>1){var W=s(g.multiConnectorMarginRatio,c.multiConnectorMarginRatio)*w;L&&(W+=2*w);var V=p.getDistance(l,u),H=p.substract(u,l),G={x:-W*(H.y/V),y:W*(H.x/V),z:0};F=(B%2?0:.5)-Math.floor(B/2);var z=p.multiply(G,F)}for(var K=0,Y=P.length;K<Y;++K)if(1===B)(J={}).coord1=P[K][0],J.coord2=P[K][1],O&&(J.jointCoordIndex=0===K?2:1),J.color=v[K],J.radius=w,J.lineWidth=k,J.opacity=c.opacity,j.push(J);else for(var X=p.add(P[K][0],z),$=p.add(P[K][1],z),q=0;q<B;++q){var J;(J={}).coord1=X,J.coord2=$,X=p.add(X,G),$=p.add($,G),O&&(J.jointCoordIndex=0===K?2:1),J.color=v[K],J.radius=w,J.lineWidth=k,J.opacity=c.opacity,j.push(J)}var Z,Q=x;return Z=Q===n.WIRE||Q===n.MULTI_WIRE?this.createLineBoundInfo(l,u,{width:k}):this.createCylinderBoundInfo(l,u,{radius:w}),this.basicDrawObjectUpdated(e,t,a,Z,d.Render.ObjectUpdateType.ADD),this.doDrawConnectorSet(e,j,Q,M,c)},doDrawConnectorSet:function(e,t,r,i,o){if(r===n.WIRE||r===n.MULTI_WIRE)return this.drawParallelLines(e,t);var s=this.getRenderCache(e).nodeRenderMode===a.NONE;return this.drawParallelCylinders(e,t,s)},_getBondRenderType:function(e,t){var r=e.getOverriddenRender3DOptions()||{};return d.Render.Render3DOptionUtils.getConnectorRenderType(r)||d.Render.ConnectorDrawUtils.getConnectorRender3DType(e,t)}}),d.ClassDefineUtils.addExtraTwoTupleObjMapSupport(d.Render.ChemCtab3DRenderer),d.Render.StructFragment3DRenderer=Class.create(d.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.StructFragment3DRenderer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this._concreteRenderer=null,e.hasCtab()?this._concreteRenderer=new d.Render.ChemCtab3DRenderer(e.getCtab(),t,this):(this._concreteRenderer=null,d.raise(d.$L("ErrorMsg.FORMULA_RENDERER_3D_NOT_AVAILABLE"))),this._concreteRenderer.setParentRenderer(this)},finalize:function(){this.tryApplySuper("finalize"),this._concreteRenderer&&this._concreteRenderer.finalize()},getRenderCache:function(e){return this._concreteRenderer.getRenderCache(e)},_getConcreteRendererDrawOptions:function(e){var t=Object.create(e||{}),r=this.getChemObj(),n=this.getRendererType()===d.Render.RendererType.R3D?r.getOverriddenRender3DOptions():r.getOverriddenRenderOptions();return Object.extend(t,n||{})},isChemObjRenderedBySelf:function(e,t){return this.tryApplySuper("isChemObjRenderedBySelf",[e,t])||t===this.getChemObj()||this._concreteRenderer.isChemObjRenderedBySelf(e,t)},isChemObjRenderedDirectlyBySelf:function(e,t){return this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[e,t])||t===this.getChemObj()},doSetRedirectContext:function(e){this.tryApplySuper("doSetRedirectContext",[e]),this._concreteRenderer.setRedirectContext(e)},doDrawSelf:function(e,t,r){return this.tryApplySuper("doDrawSelf",[e,t,r]),this._concreteRenderer.draw(e,t,this._getConcreteRendererDrawOptions(r))},doRedraw:function(e){return this._concreteRenderer.redraw(e)},doUpdateSelf:function(e,t,r){if(this._extractObjsOfUpdateObjDetails(t).indexOf(this.getChemObj())>=0){var n=this.getRenderCache(e);return this.doClear(e),this.draw(e,n.baseCoord,n.options)}return this._concreteRenderer.doUpdate(e,t,r)},doClearSelf:function(e){var t=this._concreteRenderer;if(t)return t.clear(e)},estimateRenderBox:function(e,t,r){return this._concreteRenderer.estimateRenderBox(e,this._getConcreteRendererDrawOptions(t),r)},getChildObjs:function(){var e=this.getChemObj();if(e&&e.getAttachedMarkers){for(var t=[],r=(e.getExposedNodes()||[]).concat(e.getExposedConnectors()||[]),n=0,i=r.length;n<i;++n){var o=r[n];t=t.concat(o.getAttachedMarkers()||[])}return t.concat(this.tryApplySuper("getChildObjs"))}return this.tryApplySuper("getChildObjs")},_needWholelyDraw:function(e,t){var r=this.tryApplySuper("_needWholelyDraw",[e,t]);if(!r){for(var n=this.getChemObj(),i=!1,o=0,a=e.length;o<a;++o)if(e[o].isChildOf(n)){i=!0;break}r=i}return r},transformCoordToObj:function(e,t,r){var n=this.getChemObj()===t?this._concreteChemObj:t;return this._concreteRenderer.transformCoordToObj(e,n,r)},transformCoordToContext:function(e,t,r){var n=this.getChemObj()===t?this._concreteChemObj:t;return this._concreteRenderer.transformCoordToContext(e,n,r)}}),d.Render.Mol3DRenderer=d.Render.StructFragment3DRenderer,d.Render.CompositeObj3DRenderer=Class.create(d.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.CompositeObj3DRenderer"}),d.Render.CompositeMolecule3DRenderer=Class.create(d.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule3DRenderer",getChildObjs:function(){for(var e=[],t=this.getChemObj().getSubMolecules(),r=0,n=t.getItemCount();r<n;++r){var i=t.getObjAt(r);e.push(i)}return e.concat(this.tryApplySuper("getChildObjs"))}}),d.Render.ChemObjGroupList3DRenderer=Class.create(d.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemObjGroupList3DRenderer",getChildObjs:function(){var e=this.getChemObj();if(e instanceof d.ChemObjList)for(var t=[],r=0,n=e.getItemCount();r<n;++r)t.push(e.getItemAt(r));else e instanceof d.ChemStructureObjectGroup&&(t=e.getAllObjs());return(t||[]).concat(this.tryApplySuper("getChildObjs"))}}),d.Render.ChemSpaceElement3DRenderer=Class.create(d.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpaceElement3DRenderer",getChildObjs:function(){return(this.getChemObj().getChildren().toArray()||[]).concat(this.tryApplySuper("getChildObjs"))}}),d.Render.ChemSpace3DRenderer=Class.create(d.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpace3DRenderer",getChildObjs:function(){return[this.getChemObj().getRoot()].concat(this.tryApplySuper("getChildObjs"))}}),d.Render.Renderer3DFactory.register(d.StructureFragment,d.Render.StructFragment3DRenderer),d.Render.Renderer3DFactory.register(d.CompositeMolecule,d.Render.CompositeMolecule3DRenderer),d.Render.Renderer3DFactory.register(d.ChemObjList,d.Render.ChemObjGroupList3DRenderer),d.Render.Renderer3DFactory.register(d.ChemStructureObjectGroup,d.Render.ChemObjGroupList3DRenderer),d.Render.Renderer3DFactory.register(d.ChemSpaceElement,d.Render.ChemSpaceElement3DRenderer),d.Render.Renderer3DFactory.register(d.ChemSpace,d.Render.ChemSpace3DRenderer)}(),function(){"use strict";var e;d.Render.ThreeObjectCache=Class.create({CLASS_NAME:"Kekule.Render.ThreeObjectCache",initialize:function(){this.cache=new d.MapEx(!0)},finalize:function(){this.cache.finalize(),this.cache=null},createInstance:function(e,t){return null},isSameParams:function(e,t){if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;++r)if(!this.isParamEqual(e[r],t[r]))return!1;return!0},isParamEqual:function(e,t){var r=e===t;return r||DataType.isObjectValue(e)&&DataType.isObjectValue(t)&&(r=d.ObjUtils.equal(e,t)),r},add:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),r=this.cache.get(t);r||(r=[],this.cache.set(t,r));var n={params:e};return n.instance=this.createInstance(t,e),r.push(n),n.instance},get:function(){var e=Array.prototype.slice.call(arguments),t=e[0],r=this.cache.get(t);if(r){e.shift();for(var n=0,i=r.length;n<i;++n){var o=r[n].params;if(this.isSameParams(o,e))return r[n].instance}e.unshift(t)}return this.add.apply(this,e)}}),d.Render.ThreeGeometryCache=Class.create(d.Render.ThreeObjectCache,{CLASS_NAME:"Kekule.Render.ThreeGeometryCache",createInstance:function(t,r){var n=null,i=r;switch(i[0],t){case e.SphereGeometry:n=new e.SphereGeometry(i[1],i[2],i[3]);break;case e.CylinderGeometry:n=new e.CylinderGeometry(i[1],i[2],i[3],i[4],i[5],i[6])}return n}}),d.ClassUtils.makeSingleton(d.Render.ThreeGeometryCache),d.Render.ThreeMaterialCache=Class.create(d.Render.ThreeObjectCache,{CLASS_NAME:"Kekule.Render.ThreeMaterialCache",createInstance:function(e,t){return new e(t[1])}}),d.ClassUtils.makeSingleton(d.Render.ThreeMaterialCache),d.Render.ThreeContext=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.ThreeContext",initialize:function(e,t,r,n){this.tryApplySuper("initialize"),this.setScene(e),this.setCamera(t),this.setLights(r),this.setRenderer(n)},initProperties:function(){this.defineProp("scene",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("camera",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("lights",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("renderer",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("width",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("height",{dataType:DataType.INT,serializable:!1,setter:null})},getDimension:function(){return{width:this.getWidth(),height:this.getHeight()}},setDimension:function(t,r){this.setPropStoreFieldValue("width",t),this.setPropStoreFieldValue("height",r),this.getRenderer().setSize(t,r);var n=this.getCamera();n instanceof e.OrthographicCamera?(n.left=t/-2,n.right=t/2,n.top=r/2,n.bottom=r/-2):n.aspect=t/r,n.updateProjectionMatrix()}}),d.Render.ThreeRendererBridge=Class.create(d.Render.Abstract3DDrawBridge,{CLASS_NAME:"Kekule.Render.ThreeRendererBridge",_qualitySettings:[null,{sphereSegments:6,sphereRings:6,cylinderSegmentsRadius:6},{sphereSegments:8,sphereRings:8,cylinderSegmentsRadius:8},{sphereSegments:16,sphereRings:16,cylinderSegmentsRadius:16},{sphereSegments:32,sphereRings:32,cylinderSegmentsRadius:32},{sphereSegments:64,sphereRings:64,cylinderSegmentsRadius:64}],initialize:function(){this.geometryCache=d.Render.ThreeGeometryCache.getInstance(),this.materialCache=d.Render.ThreeMaterialCache.getInstance(),this._quality=null,this._modelParams={},this._webglEnabled=!0},finalize:function(){this.geometryCache=null,this.materialCache=null},getGraphicQualityLevel:function(){return this._quality},setGraphicQualityLevel:function(e){this._webglEnabled?this._quality=e:this._quality=d.Render.Render3DGraphicQuality.EXTREME_LOW,this._modelParams=this.calcModelParams(this._quality)},_updateGraphicQualityLevel:function(){this._webglEnabled||this.setGraphicQualityLevel(d.Render.Render3DGraphicQuality.EXTREME_LOW)},calcModelParams:function(e){var t=this._qualitySettings[e];return t||(t=this._qualitySettings[d.Render.Render3DGraphicQuality.MEDIUM]),t},getInitialLightPositions:function(e){return[{x:5,y:5,z:10}]},createContext:function(t,r,n,i){var o=d.BrowserFeature,a={preserveDrawingBuffer:!0,alpha:!0,antialias:!0};i&&(a=Object.extend(a,i));var s=o.webgl?new e.WebGLRenderer(a):o.canvas?new e.CanvasRenderer(a):new e.SVGRenderer(a),l=new e.PerspectiveCamera;l.fov=5,this._webglEnabled=s instanceof e.WebGLRenderer,this._updateGraphicQualityLevel();var u=new e.Scene;u.add(l),s.setSize(r,n);for(var c=this.getInitialLightPositions(),h=[],p=0,g=c.length;p<g;++p){var f=new e.DirectionalLight(13421772,1,10,!0),m=c[p];f.position.set(m.x,m.y,m.z),u.add(f),h.push(f)}f=new e.AmbientLight(2105376),u.add(f),t.appendChild(s.domElement);var C=new d.Render.ThreeContext(u,l,h,s);return C.setDimension(r,n),C},releaseContext:function(e){var t=this.getContextElem(e);e.finalize(),t&&t.parentNode.removeChild(t)},getContextElem:function(e){return e?e.getRenderer().domElement:null},getContextDimension:function(e){return{width:e.getWidth(),height:e.getHeight()}},setContextDimension:function(e,t,r){e.setDimension(t,r)},transformContextCoordToScreen:function(e,t){var r=e.getDimension();return{x:t.x+r.width/2,y:t.y+r.height/2}},transformScreenCoordToContext:function(e,t){var r=e.getDimension();return{x:t.x-r.width/2,y:t.y-r.height/2,z:0}},canModifyGraphic:function(e){return!0},colorStrToHex:function(e){return d.StyleUtils.colorStrToValue(e)},createGroup:function(t){var r=new e.Object3D;return r.__objGroup__=!0,t.getScene().add(r),r},addToGroup:function(e,t){return t.add(e),t},removeFromGroup:function(e,t){t.remove(e)},setClearColor:function(t,r){var n=t.getRenderer();n&&(n.setClearColor?r?t.getRenderer().setClearColor(new e.Color(r),1):t.getRenderer().setClearColor(new e.Color,0):n.setClearColorHex&&(r?t.getRenderer().setClearColorHex(this.colorStrToHex(r),1):t.getRenderer().setClearColorHex(null,0)))},clearContext:function(e){e.getScene().clearMesh(),this.renderContext(e)},renderContext:function(e){e.getRenderer().render(e.getScene(),e.getCamera())},drawSphere:function(t,r,n,i){var o=this._modelParams.sphereSegments,a=this._modelParams.sphereRings,s=this.geometryCache.get(e.SphereGeometry,t.getScene(),1,o,a),l=this.materialCache.get(e.MeshLambertMaterial,t.getScene(),{color:this.colorStrToHex(i.color),opacity:i.opacity||1}),d=new e.Mesh(s,l);return d.scale.x=n,d.scale.y=n,d.scale.z=n,d.position.x=r.x,d.position.y=r.y,d.position.z=r.z,t.getScene().add(d),d},drawLine:function(t,r,n,i){this.colorStrToHex(i.color);var o=this.materialCache.get(e.LineBasicMaterial,t.getScene(),{color:this.colorStrToHex(i.color),opacity:i.opacity||1,linewidth:i.lineWidth||1}),a=new e.Geometry;a.vertices.push(new e.Vector3(r.x,r.y,r.z)),a.vertices.push(new e.Vector3(n.x,n.y,n.z));var s=new e.Line(a,o);return t.getScene().add(s),s},drawCylinder:function(t,r,n,i,o){var a=d.CoordUtils,s=this._modelParams.cylinderSegmentsRadius,l=a.getDistance(r,n),u=this.geometryCache.get(e.CylinderGeometry,t.getScene(),1,1,1,s,1,!0),c=this.materialCache.get(e.MeshLambertMaterial,t.getScene(),{color:this.colorStrToHex(o.color),opacity:o.opacity||1}),h=new e.Mesh(u,c);h.scale.y=l,h.scale.x=i,h.scale.z=i;var p=d.ObjUtils.isUnset(o.quaternion)?this._calcQuaternion(r,n):o.quaternion;return p&&(h.applyQuaternion?h.applyQuaternion(p):(h.useQuaternion=!0,h.quaternion=p,h.updateMatrix())),h.position.x=(r.x+n.x)/2,h.position.y=(r.y+n.y)/2,h.position.z=(r.z+n.z)/2,t.getScene().add(h),h},drawParallelCylinders:function(e,t,r){d.CoordUtils;for(var n=t[0],i=this._calcQuaternion(n.coord1,n.coord2),o=this.createGroup(e),a=0,s=t.length;a<s;++a){var l=t[a],u=this.drawCylinder(e,l.coord1,l.coord2,l.radius,{color:l.color,quaternion:i,opacity:l.opacity});this.addToGroup(u,o)}var c;if(r)for(a=0,s=t.length;a<s;++a){l=t[a];for(var h=0,p=(c=d.ObjUtils.isUnset(l.jointCoordIndex)?[l.coord1,l.coord2]:1===l.jointCoordIndex?[l.coord2]:[l.coord1]).length;h<p;++h)u=this.drawSphere(e,c[h],l.radius,{color:l.color,opacity:l.opacity}),this.addToGroup(u,o)}return o},removeDrawnElem:function(e,t){t.parent&&t.parent.remove&&t.parent.remove(t)},_calcQuaternion:function(t,r){var n=d.CoordUtils,i=n.substract(r,t);if(i.x||i.z){var o={x:i.z,y:0,z:-i.x};o=n.standardize(o);var a=Math.atan2(Math.sqrt(Math.sqr(i.x)+Math.sqr(i.z)),i.y)/2,s=Math.cos(a),l=Math.sin(a);return new e.Quaternion(l*o.x,l*o.y,l*o.z,s)}return null},getLightCount:function(e){var t=e.getLights();return t&&t.length||0},getLightProps:function(e,t){return{position:e.getLights()[t].position}},setLightProps:function(e,t,r){var n=e.getLights()[t],i=r.position;i&&(n.position.x=i.x,n.position.y=i.y,n.position.z=i.z),n.updateMatrix()},getCameraProps:function(e){var t=e.getCamera();return{position:t.position,fov:t.fov*Math.PI/180,aspect:t.aspect,left:t.left,right:t.right,top:t.top,bottom:t.bottom,lookAtVector:t.lookAtVector,upVector:t.up}},setCameraProps:function(t,r){var n=t.getCamera(),i=d.ObjUtils.notUnset,o=r.position;if(o&&(n.position.x=o.x,n.position.y=o.y,n.position.z=o.z),i(r.near)&&(n.near=r.near),i(r.far)&&(n.near=r.far),r.fov&&(n.fov=180*r.fov/Math.PI),r.aspect&&(n.aspect=r.aspect),i(r.left)&&(n.left=r.left),i(r.top)&&(n.top=r.top),i(r.bottom)&&(n.bottom=r.bottom),i(r.right)&&(n.right=r.right),i(r.upVector)){var a=r.upVector;n.up=new e.Vector3(a.x,a.y,a.z)}i(r.lookAtVector)&&(a=r.lookAtVector,n.lookAt(new e.Vector3(a.x,a.y,a.z))),n.updateMatrix()},exportToDataUri:function(t,r,n){var i=t.getRenderer();if(e.SVGRenderer&&i instanceof e.SVGRenderer){var o=t.getRenderer().domElement,a=DataType.XmlUtility.serializeNode(o);return"data:image/svg+xml;base64,"+btoa(a)}return(o=t.getRenderer().domElement)?o.toDataURL(r,n):null}}),d.Render.ThreeRendererBridge.isSupported=function(){var e=void 0!==d.Render.getExternalModule("three.js");if(e){var t=d.BrowserFeature;e=t.webgl||t.canvas||t.svg}return!!e},d.Render.ThreeRendererBridge.getAvailabilityInformation=function(){var e=!1,t=void 0!==d.Render.getExternalModule("three.js"),r=d.BrowserFeature,n=r.webgl,i=r.canvas||r.svg,o=null;return t?n||i?e=!0:o=d.$L("ErrorMsg.THREEJS_DRAWING_NOT_UNAVAILABLE"):o=d.$L("ErrorMsg.THREEJS_LIB_NOT_UNAVAILABLE"),{available:e,message:o}},d.Render.DrawBridge3DMananger.register(d.Render.ThreeRendererBridge,20);var t=function e(){var t;e.registered||d.$jsRoot.THREE&&d.$jsRoot.THREE.Object3D&&(t=d.$jsRoot.THREE,d.Render.registerExternalModule("three.js",t),e.registered=!0)};d.externalResourceManager.on("three.jsRegistered",(function(){(e=d.externalResourceManager.getResource("three.js"))&&(e.Object3D.prototype.clear||(e.Object3D.prototype.clear=function(){for(var e=this.children,t=e.length-1;t>=0;t--){var r=e[t];r.clear(),this.remove(r)}}),e.Scene.prototype.clearMesh||(e.Scene.prototype.clearMesh=function(){for(var t=this.children,r=t.length-1;r>=0;r--){var n=t[r];(n instanceof e.Mesh||n instanceof e.Line||n.__objGroup__)&&(n.clear(),this.remove(n))}}),d.Render.DrawBridge3DMananger.register(d.Render.ThreeRendererBridge,20))})),d.externalResourceManager.on("three.jsUnregistered",(function(){})),t(),d.X.domReady(t)}(),d.Render.ChemObjPainter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.ChemObjPainter",initialize:function(e,t,r,n){this.tryApplySuper("initialize");var i=e||d.Render.RendererType.R2D;this.setPropStoreFieldValue("renderType",i),this.setPropStoreFieldValue("chemObj",t),this.setPropStoreFieldValue("drawBridge",r||(i===d.Render.RendererType.R3D?d.Render.DrawBridge3DMananger.getPreferredBridgeInstance():d.Render.DrawBridge2DMananger.getPreferredBridgeInstance())),n&&this.setPropStoreFieldValue("renderConfigs",n)},finalize:function(){this.getRenderer()&&this.getRenderer().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:null}),this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("renderConfigs",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("renderConfigs");return e||(e=this.getRenderType()===d.Render.RendererType.R3D?d.Render.Render3DConfigs.getInstance():d.Render.Render2DConfigs.getInstance()),e}}),this.defineProp("renderer",{dateType:"Kekule.Render.AbstractRenderer",serializable:!1,setter:null}),this.defineProp("canModifyTargetObj",{dataType:DataType.BOOL}),this.defineProp("boundInfoRecorder",{dataType:"Kekule.Render.BoundInfoRecorder",serializable:!1,setter:null,getter:function(){var e=this.getRenderer();return e&&e.getBoundInfoRecorder()}})},getDrawOptionFromConfigs:function(e){return d.Render.RenderOptionUtils.convertConfigsToPlainHash(e)},prepareRenderer:function(){if(this.getRenderer())return this.getRenderer();var e=(this.getRenderType()===d.Render.RendererType.R3D?d.Render.get3DRendererClass:d.Render.get2DRendererClass)(this.getChemObj());if(e){var t=new e(this.getChemObj(),this.getDrawBridge(),this);return this.setPropStoreFieldValue("renderer",t),t}return d.error(d.$L("ErrorMsg.CANNOT_FIND_SUITABLE_RENDERER_FOR_OBJ")),null},createContext:function(e,t,r){return this.getDrawBridge().createContext(e,t,r)},_convertContextBoxToScreen:function(e,t){if(!t)return{};var r=this.getDrawBridge(),n=r.transformContextCoordToScreen(e,{x:t.x1,y:t.y1}),i=r.transformContextCoordToScreen(e,{x:t.x2,y:t.y2});return d.BoxUtils.createBox(n,i)},estimateObjBox:function(e,t,r){return this._generateDrawOptions(t),this.prepareRenderer(),this.getRenderer().estimateObjBox(e,t,r)},estimateRenderBox:function(e,t,r,n){var i=this._generateDrawOptions(r);return this.prepareRenderer(),this.getRenderer().estimateRenderBox(e,t,i,n)},estimateScreenBox:function(e,t,r,n){var i=this.estimateRenderBox(e,t,r,n);return i?this._convertContextBoxToScreen(e,i):null},_generateDrawOptions:function(e){var t=this.getRenderConfigs(),r=t?this.getDrawOptionFromConfigs(t):{};return Object.extend(r,e)},draw:function(e,t,r){this.prepareRenderer();var n=this._generateDrawOptions(r);return this.getRenderer().draw(e,t,n)},redraw:function(e){return this.getRenderer().redraw(e)},getActualRenderTransformParams:function(e){var t=this.getRenderer();return t?t.getRenderFinalTransformParams(e):null},getActualInitialRenderTransformOptions:function(e){var t=this.getRenderer();return t?t.getRenderInitialTransformOptions(e):null},changeGeometryOptions:function(e,t,r){var n=this.getRenderer();if(n&&n.changeGeometryOptions){var i=this._generateDrawOptions(r);return n.changeGeometryOptions(e,t,i)}return this.clearContext(e),this.draw(e,t,r)},supportGeometryOptionChange:function(){var e=this.getRenderer();return e&&e.changeGeometryOptions},beginUpdatePainter:function(){return this.getRenderer().beginUpdateRenderer()},endUpdatePainter:function(){return this.getRenderer().endUpdateRenderer()},update:function(e,t,r){return this.getRenderer().update(e,t,r)},addNew:function(e,t){return this.getRenderer().addNew(e,t)},modify:function(e,t){return this.getRenderer().modify(e,t)},remove:function(e,t){return this.getRenderer().remove(e,t)},clear:function(e){var t=this.getRenderer();return t&&t.clear(e),this},clearContext:function(e){return this.getDrawBridge().clearContext(e)}}),d.Render.ChemObjPainter2D=Class.create(d.Render.ChemObjPainter,{CLASS_NAME:"Kekule.Render.ChemObjPainter2D",initialize:function(e,t,r){this.tryApplySuper("initialize",[d.Render.RendererType.R2D,e,t,r])}}),d.Render.ChemObjPainter3D=Class.create(d.Render.ChemObjPainter,{CLASS_NAME:"Kekule.Render.ChemObjPainter3D",initialize:function(e,t,r){this.tryApplySuper("initialize",[d.Render.RendererType.R3D,e,t,r])}}),"undefined"!=typeof window&&"undefined"!=typeof document&&function(i,o,a,s){"use strict";function l(e,t,r){return setTimeout(p(e,r),t)}function d(e,t,r){return!!Array.isArray(e)&&(u(e,r[t],r),!0)}function u(e,t,r){var n;if(e)if(e.forEach)e.forEach(t,r);else if(e.length!==s)for(n=0;n<e.length;)t.call(r,e[n],n,e),n++;else for(n in e)e.hasOwnProperty(n)&&t.call(r,e[n],n,e)}function c(e,t,r){var n="DEPRECATED METHOD: "+t+"\n"+r+" AT \n";return function(){var t=new Error("get-stack-trace"),r=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=i.console&&(i.console.warn||i.console.log);return o&&o.call(i.console,n,r),e.apply(this,arguments)}}function h(e,t,r){var n,i=t.prototype;(n=e.prototype=Object.create(i)).constructor=e,n._super=i,r&&ne(n,r)}function p(e,t){return function(){return e.apply(t,arguments)}}function g(e,t){return typeof e==ae?e.apply(t&&t[0]||s,t):e}function f(e,t){return e===s?t:e}function m(e,t,r){u(E(t),(function(t){e.addEventListener(t,r,!1)}))}function C(e,t,r){u(E(t),(function(t){e.removeEventListener(t,r,!1)}))}function y(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function _(e,t){return e.indexOf(t)>-1}function E(e){return e.trim().split(/\s+/g)}function T(e,t,r){if(e.indexOf&&!r)return e.indexOf(t);for(var n=0;n<e.length;){if(r&&e[n][r]==t||!r&&e[n]===t)return n;n++}return-1}function O(e){return Array.prototype.slice.call(e,0)}function v(e,t,r){for(var n=[],i=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];T(i,a)<0&&n.push(e[o]),i[o]=a,o++}return r&&(n=t?n.sort((function(e,r){return e[t]>r[t]})):n.sort()),n}function S(e,t){for(var r,n,i=t[0].toUpperCase()+t.slice(1),o=0;o<ie.length;){if((n=(r=ie[o])?r+i:t)in e)return n;o++}return s}function b(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||i}function A(e,t){var r=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){g(e.options.enable,[e])&&r.handler(t)},this.init()}function I(e,t,r){var n=r.pointers.length,i=r.changedPointers.length,o=t&_e&&n-i==0,a=t&(Ee|Te)&&n-i==0;r.isFirst=!!o,r.isFinal=!!a,o&&(e.session={}),r.eventType=t,function(e,t){var r=e.session,n=t.pointers,i=n.length;r.firstInput||(r.firstInput=D(t)),i>1&&!r.firstMultiple?r.firstMultiple=D(t):1===i&&(r.firstMultiple=!1);var o=r.firstInput,a=r.firstMultiple,s=a?a.center:o.center,l=t.center=N(n);t.timeStamp=de(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=L(s,l),t.distance=M(s,l),function(e,t){var r=t.center,n=e.offsetDelta||{},i=e.prevDelta||{},o=e.prevInput||{};t.eventType!==_e&&o.eventType!==Ee||(i=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=e.offsetDelta={x:r.x,y:r.y}),t.deltaX=i.x+(r.x-n.x),t.deltaY=i.y+(r.y-n.y)}(r,t),t.offsetDirection=x(t.deltaX,t.deltaY);var d=P(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=d.x,t.overallVelocityY=d.y,t.overallVelocity=le(d.x)>le(d.y)?d.x:d.y,t.scale=a?function(e,t){return M(t[0],t[1],Pe)/M(e[0],e[1],Pe)}(a.pointers,n):1,t.rotation=a?function(e,t){return L(t[1],t[0],Pe)+L(e[1],e[0],Pe)}(a.pointers,n):0,t.maxPointers=r.prevInput?t.pointers.length>r.prevInput.maxPointers?t.pointers.length:r.prevInput.maxPointers:t.pointers.length,R(r,t);var u=e.element;y(t.srcEvent.target,u)&&(u=t.srcEvent.target),t.target=u}(e,r),e.emit("hammer.input",r),e.recognize(r),e.session.prevInput=r}function R(e,t){var r,n,i,o,a=e.lastInterval||t,l=t.timeStamp-a.timeStamp;if(t.eventType!=Te&&(l>ye||a.velocity===s)){var d=t.deltaX-a.deltaX,u=t.deltaY-a.deltaY,c=P(l,d,u);n=c.x,i=c.y,r=le(c.x)>le(c.y)?c.x:c.y,o=x(d,u),e.lastInterval=t}else r=a.velocity,n=a.velocityX,i=a.velocityY,o=a.direction;t.velocity=r,t.velocityX=n,t.velocityY=i,t.direction=o}function D(e){for(var t=[],r=0;r<e.pointers.length;)t[r]={clientX:se(e.pointers[r].clientX),clientY:se(e.pointers[r].clientY)},r++;return{timeStamp:de(),pointers:t,center:N(t),deltaX:e.deltaX,deltaY:e.deltaY}}function N(e){var t=e.length;if(1===t)return{x:se(e[0].clientX),y:se(e[0].clientY)};for(var r=0,n=0,i=0;t>i;)r+=e[i].clientX,n+=e[i].clientY,i++;return{x:se(r/t),y:se(n/t)}}function P(e,t,r){return{x:t/e||0,y:r/e||0}}function x(e,t){return e===t?Oe:le(e)>=le(t)?0>e?ve:Se:0>t?be:Ae}function M(e,t,r){r||(r=Ne);var n=t[r[0]]-e[r[0]],i=t[r[1]]-e[r[1]];return Math.sqrt(n*n+i*i)}function L(e,t,r){r||(r=Ne);var n=t[r[0]]-e[r[0]],i=t[r[1]]-e[r[1]];return 180*Math.atan2(i,n)/Math.PI}function w(){this.evEl=Me,this.evWin=Le,this.pressed=!1,A.apply(this,arguments)}function k(){this.evEl=Be,this.evWin=je,A.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function B(){this.evTarget=Fe,this.evWin=We,this.started=!1,A.apply(this,arguments)}function j(){this.evTarget=He,this.targetIds={},A.apply(this,arguments)}function U(){A.apply(this,arguments);var e=p(this.handler,this);this.touch=new j(this.manager,e),this.mouse=new w(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function F(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var r={x:t.clientX,y:t.clientY};this.lastTouches.push(r);var n=this.lastTouches;setTimeout((function(){var e=n.indexOf(r);e>-1&&n.splice(e,1)}),Ge)}}function W(e,t){this.manager=e,this.set(t)}function V(e){this.options=ne({},this.defaults,e||{}),this.id=he++,this.manager=null,this.options.enable=f(this.options.enable,!0),this.state=et,this.simultaneous={},this.requireFail=[]}function H(e){return e&ot?"cancel":e&nt?"end":e&rt?"move":e&tt?"start":""}function G(e){return e==Ae?"down":e==be?"up":e==ve?"left":e==Se?"right":""}function z(e,t){var r=t.manager;return r?r.get(e):e}function K(){V.apply(this,arguments)}function Y(){K.apply(this,arguments),this.pX=null,this.pY=null}function X(){K.apply(this,arguments)}function $(){V.apply(this,arguments),this._timer=null,this._input=null}function q(){K.apply(this,arguments)}function J(){K.apply(this,arguments)}function Z(){V.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Q(e,t){return(t=t||{}).recognizers=f(t.recognizers,Q.defaults.preset),new ee(e,t)}function ee(e,t){this.options=ne({},Q.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=function(e){return new(e.options.inputClass||(ge?k:fe?j:pe?U:w))(e,I)}(this),this.touchAction=new W(this,this.options.touchAction),te(this,!0),u(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function te(e,t){var r,n=e.element;n.style&&(u(e.options.cssProps,(function(i,o){r=S(n.style,o),t?(e.oldCssProps[r]=n.style[r],n.style[r]=i):n.style[r]=e.oldCssProps[r]||""})),t||(e.oldCssProps={}))}function re(e,t){var r=o.createEvent("Event");r.initEvent(e,!0,!0),r.gesture=t,t.target.dispatchEvent(r)}var ne,ie=["","webkit","Moz","MS","ms","o"],oe=o.createElement("div"),ae="function",se=Math.round,le=Math.abs,de=Date.now;ne="function"!=typeof Object.assign?function(e){if(e===s||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(n!==s&&null!==n)for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}return t}:Object.assign;var ue=c((function(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;)(!r||r&&e[n[i]]===s)&&(e[n[i]]=t[n[i]]),i++;return e}),"extend","Use `assign`."),ce=c((function(e,t){return ue(e,t,!0)}),"merge","Use `assign`."),he=1,pe="ontouchstart"in i,ge=S(i,"PointerEvent")!==s,fe=pe&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),me="touch",Ce="mouse",ye=25,_e=1,Ee=4,Te=8,Oe=1,ve=2,Se=4,be=8,Ae=16,Ie=ve|Se,Re=be|Ae,De=Ie|Re,Ne=["x","y"],Pe=["clientX","clientY"];A.prototype={handler:function(){},init:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(b(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(b(this.element),this.evWin,this.domHandler)}};var xe={mousedown:_e,mousemove:2,mouseup:Ee},Me="mousedown",Le="mousemove mouseup";h(w,A,{handler:function(e){var t=xe[e.type];t&_e&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=Ee),this.pressed&&(t&Ee&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:Ce,srcEvent:e}))}});var we={pointerdown:_e,pointermove:2,pointerup:Ee,pointercancel:Te,pointerout:Te},ke={2:me,3:"pen",4:Ce,5:"kinect"},Be="pointerdown",je="pointermove pointerup pointercancel";i.MSPointerEvent&&!i.PointerEvent&&(Be="MSPointerDown",je="MSPointerMove MSPointerUp MSPointerCancel"),h(k,A,{handler:function(e){var t=this.store,r=!1,n=e.type.toLowerCase().replace("ms",""),i=we[n],o=ke[e.pointerType]||e.pointerType,a=o==me,s=T(t,e.pointerId,"pointerId");i&_e&&(0===e.button||a)?0>s&&(t.push(e),s=t.length-1):i&(Ee|Te)&&(r=!0),0>s||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),r&&t.splice(s,1))}});var Ue={touchstart:_e,touchmove:2,touchend:Ee,touchcancel:Te},Fe="touchstart",We="touchstart touchmove touchend touchcancel";h(B,A,{handler:function(e){var t=Ue[e.type];if(t===_e&&(this.started=!0),this.started){var r=function(e,t){var r=O(e.touches),n=O(e.changedTouches);return t&(Ee|Te)&&(r=v(r.concat(n),"identifier",!0)),[r,n]}.call(this,e,t);t&(Ee|Te)&&r[0].length-r[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:me,srcEvent:e})}}});var Ve={touchstart:_e,touchmove:2,touchend:Ee,touchcancel:Te},He="touchstart touchmove touchend touchcancel";h(j,A,{handler:function(e){var t=Ve[e.type],r=function(e,t){var r=O(e.touches),n=this.targetIds;if(t&(2|_e)&&1===r.length)return n[r[0].identifier]=!0,[r,r];var i,o,a=O(e.changedTouches),s=[],l=this.target;if(o=r.filter((function(e){return y(e.target,l)})),t===_e)for(i=0;i<o.length;)n[o[i].identifier]=!0,i++;for(i=0;i<a.length;)n[a[i].identifier]&&s.push(a[i]),t&(Ee|Te)&&delete n[a[i].identifier],i++;return s.length?[v(o.concat(s),"identifier",!0),s]:void 0}.call(this,e,t);r&&this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:me,srcEvent:e})}});var Ge=2500;h(U,A,{handler:function(e,t,r){var n=r.pointerType==me,i=r.pointerType==Ce;if(!(i&&r.sourceCapabilities&&r.sourceCapabilities.firesTouchEvents)){if(n)(function(e,t){e&_e?(this.primaryTouch=t.changedPointers[0].identifier,F.call(this,t)):e&(Ee|Te)&&F.call(this,t)}).call(this,t,r);else if(i&&function(e){for(var t=e.srcEvent.clientX,r=e.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var i=this.lastTouches[n],o=Math.abs(t-i.x),a=Math.abs(r-i.y);if(25>=o&&25>=a)return!0}return!1}.call(this,r))return;this.callback(e,t,r)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ze=S(oe.style,"touchAction"),Ke=ze!==s,Ye="compute",Xe="auto",$e="manipulation",qe="none",Je="pan-x",Ze="pan-y",Qe=function(){if(!Ke)return!1;var e={},t=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(r){e[r]=!t||i.CSS.supports("touch-action",r)})),e}();W.prototype={set:function(e){e==Ye&&(e=this.compute()),Ke&&this.manager.element.style&&Qe[e]&&(this.manager.element.style[ze]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return u(this.manager.recognizers,(function(t){g(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(_(e,qe))return qe;var t=_(e,Je),r=_(e,Ze);return t&&r?qe:t||r?t?Je:Ze:_(e,$e)?$e:Xe}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,r=e.offsetDirection;if(!this.manager.session.prevented){var n=this.actions,i=_(n,qe)&&!Qe[qe],o=_(n,Ze)&&!Qe[Ze],a=_(n,Je)&&!Qe[Je];if(i){var s=1===e.pointers.length,l=e.distance<2,d=e.deltaTime<250;if(s&&l&&d)return}return a&&o?void 0:i||o&&r&Ie||a&&r&Re?this.preventSrc(t):void 0}t.preventDefault()},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var et=1,tt=2,rt=4,nt=8,it=nt,ot=16;V.prototype={defaults:{},set:function(e){return ne(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(d(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=z(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return d(e,"dropRecognizeWith",this)||(e=z(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(d(e,"requireFailure",this))return this;var t=this.requireFail;return-1===T(t,e=z(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(d(e,"dropRequireFailure",this))return this;e=z(e,this);var t=T(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){r.manager.emit(t,e)}var r=this,n=this.state;nt>n&&t(r.options.event+H(n)),t(r.options.event),e.additionalEvent&&t(e.additionalEvent),n>=nt&&t(r.options.event+H(n))},tryEmit:function(e){return this.canEmit()?this.emit(e):void(this.state=32)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|et)))return!1;e++}return!0},recognize:function(e){var t=ne({},e);return g(this.options.enable,[this,t])?(this.state&(it|ot|32)&&(this.state=et),this.state=this.process(t),void(this.state&(tt|rt|nt|ot)&&this.tryEmit(t))):(this.reset(),void(this.state=32))},process:function(e){},getTouchAction:function(){},reset:function(){}},h(K,V,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,r=e.eventType,n=t&(tt|rt),i=this.attrTest(e);return n&&(r&Te||!i)?t|ot:n||i?r&Ee?t|nt:t&tt?t|rt:tt:32}}),h(Y,K,{defaults:{event:"pan",threshold:10,pointers:1,direction:De},getTouchAction:function(){var e=this.options.direction,t=[];return e&Ie&&t.push(Ze),e&Re&&t.push(Je),t},directionTest:function(e){var t=this.options,r=!0,n=e.distance,i=e.direction,o=e.deltaX,a=e.deltaY;return i&t.direction||(t.direction&Ie?(i=0===o?Oe:0>o?ve:Se,r=o!=this.pX,n=Math.abs(e.deltaX)):(i=0===a?Oe:0>a?be:Ae,r=a!=this.pY,n=Math.abs(e.deltaY))),e.direction=i,r&&n>t.threshold&&i&t.direction},attrTest:function(e){return K.prototype.attrTest.call(this,e)&&(this.state&tt||!(this.state&tt)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=G(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),h(X,K,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[qe]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&tt)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),h($,V,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Xe]},process:function(e){var t=this.options,r=e.pointers.length===t.pointers,n=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!n||!r||e.eventType&(Ee|Te)&&!i)this.reset();else if(e.eventType&_e)this.reset(),this._timer=l((function(){this.state=it,this.tryEmit()}),t.time,this);else if(e.eventType&Ee)return it;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===it&&(e&&e.eventType&Ee?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=de(),this.manager.emit(this.options.event,this._input)))}}),h(q,K,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[qe]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&tt)}}),h(J,K,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ie|Re,pointers:1},getTouchAction:function(){return Y.prototype.getTouchAction.call(this)},attrTest:function(e){var t,r=this.options.direction;return r&(Ie|Re)?t=e.overallVelocity:r&Ie?t=e.overallVelocityX:r&Re&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&r&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&le(t)>this.options.velocity&&e.eventType&Ee},emit:function(e){var t=G(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),h(Z,V,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[$e]},process:function(e){var t=this.options,r=e.pointers.length===t.pointers,n=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),e.eventType&_e&&0===this.count)return this.failTimeout();if(n&&i&&r){if(e.eventType!=Ee)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||M(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=l((function(){this.state=it,this.tryEmit()}),t.interval,this),tt):it}return 32},failTimeout:function(){return this._timer=l((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==it&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Q.VERSION="2.0.8",Q.defaults={domEvents:!1,touchAction:Ye,enable:!0,inputTarget:null,inputClass:null,preset:[[q,{enable:!1}],[X,{enable:!1},["rotate"]],[J,{direction:Ie}],[Y,{direction:Ie},["swipe"]],[Z],[Z,{event:"doubletap",taps:2},["tap"]],[$]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},ee.prototype={set:function(e){return ne(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var r,n=this.recognizers,i=t.curRecognizer;(!i||i&&i.state&it)&&(i=t.curRecognizer=null);for(var o=0;o<n.length;)r=n[o],2===t.stopped||i&&r!=i&&!r.canRecognizeWith(i)?r.reset():r.recognize(e),!i&&r.state&(tt|rt|nt)&&(i=t.curRecognizer=r),o++}},get:function(e){if(e instanceof V)return e;for(var t=this.recognizers,r=0;r<t.length;r++)if(t[r].options.event==e)return t[r];return null},add:function(e){if(d(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(d(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,r=T(t,e);-1!==r&&(t.splice(r,1),this.touchAction.update())}return this},on:function(e,t){if(e!==s&&t!==s){var r=this.handlers;return u(E(e),(function(e){r[e]=r[e]||[],r[e].push(t)})),this}},off:function(e,t){if(e!==s){var r=this.handlers;return u(E(e),(function(e){t?r[e]&&r[e].splice(T(r[e],t),1):delete r[e]})),this}},emit:function(e,t){this.options.domEvents&&re(e,t);var r=this.handlers[e]&&this.handlers[e].slice();if(r&&r.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var n=0;n<r.length;)r[n](t),n++}},destroy:function(){this.element&&te(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},ne(Q,{INPUT_START:_e,INPUT_MOVE:2,INPUT_END:Ee,INPUT_CANCEL:Te,STATE_POSSIBLE:et,STATE_BEGAN:tt,STATE_CHANGED:rt,STATE_ENDED:nt,STATE_RECOGNIZED:it,STATE_CANCELLED:ot,STATE_FAILED:32,DIRECTION_NONE:Oe,DIRECTION_LEFT:ve,DIRECTION_RIGHT:Se,DIRECTION_UP:be,DIRECTION_DOWN:Ae,DIRECTION_HORIZONTAL:Ie,DIRECTION_VERTICAL:Re,DIRECTION_ALL:De,Manager:ee,Input:A,TouchAction:W,TouchInput:j,MouseInput:w,PointerEventInput:k,TouchMouseInput:U,SingleTouchInput:B,Recognizer:V,AttrRecognizer:K,Tap:Z,Pan:Y,Swipe:J,Pinch:X,Rotate:q,Press:$,on:m,off:C,each:u,merge:ce,extend:ue,assign:ne,inherit:h,bindFn:p,prefixed:S}),(void 0!==i?i:"undefined"!=typeof self?self:{}).Hammer=Q,void 0===(n=function(){return Q}.call(t,r,t,e))||(e.exports=n)}(window,document),d.Operation=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Operation",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){},isReversible:function(){return!0},execute:function(){return this.doExecute()},doExecute:function(){},reverse:function(){return this.isReversible()||d.raise(d.$L("ErrorMsg.COMMAND_NOT_REVERSIBLE")),this.doReverse()},doReverse:function(){}}),d.Operation.State={UNEXECUTED:0,EXECUTED:1},d.MacroOperation=Class.create(d.Operation,{CLASS_NAME:"Kekule.MacroOperation",initialize:function(e){this.tryApplySuper("initialize"),this.setChildren(e||[])},initProperties:function(){this.defineProp("children",{dataType:DataType.ARRAY})},isReversible:function(){for(var e=this.getChildren(),t=0,r=e.length;t<r;++t)if(!e[t].isReversible())return!1;return!0},doExecute:function(){for(var e=this.getChildren(),t=0,r=e.length;t<r;++t)e[t].execute()},doReverse:function(){for(var e=this.getChildren(),t=e.length-1;t>=0;--t)e[t].reverse()},add:function(e){return this.getChildren().push(e)},remove:function(e){var t=this.getChildren(),r=t.indexOf(e);return r>=0?t.splice(r,1):null},getChildAt:function(e){return this.getChildren()[e]},getChildCount:function(){return this.getChildren().length}}),d.OperationHistory=Class.create(ObjectEx,{CLASS_NAME:"Kekule.OperationHistory",initialize:function(e){this.tryApplySuper("initialize"),this.setCapacity(e||null)},initProperties:function(){this.defineProp("capacity",{dataType:DataType.INT}),this.defineProp("operations",{dataType:DataType.ARRAY,getter:function(){var e=this.getPropStoreFieldValue("operations");return e||(e=[],this.setPropStoreFieldValue("operations",e)),e}}),this.defineProp("currIndex",{dataType:DataType.INT,serializable:!1}),this.defineEvent("push"),this.defineEvent("pop"),this.defineEvent("undo"),this.defineEvent("redo")},checkCapacity:function(){var e=this.getCapacity();if(e&&!(e<=0))for(var t=this.getPropStoreFieldValue("operations");t&&t.length>e;)t.shift(),this.getCurrIndex()>0&&this.setCurrIndex(this.getCurrIndex()-1)},getOperationCount:function(){return this.getOperations().length},getOperationAt:function(e){return this.getOperations()[e]},getCurrOperation:function(){var e=this.getCurrIndex();return e>=0?this.getOperations()[e]:null},clear:function(){this.setOperations([]),this.setCurrIndex(-1),this.invokeEvent("clear",{currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange")},push:function(e){var t=this.getOperations(),r=this.getCurrIndex();r<t.length&&t.splice(r+1,t.length-r-1),t.push(e),this.setCurrIndex(t.length-1),this.checkCapacity(),this.invokeEvent("push",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange")},pop:function(){var e,t=this.getCurrIndex();return this.canPop()?(e=this.getOperations()[t],this.setCurrIndex(--t),this.invokeEvent("pop",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange")):e=null,e},canPop:function(){return this.getCurrIndex()>=0&&!!this.getOperations().length},unpop:function(){var e,t=this.getCurrIndex();return this.getOperations(),this.canUnpop()?(this.setCurrIndex(++t),e=this.getOperations()[t]):e=null,e},canUnpop:function(){return this.getCurrIndex()<this.getOperations().length-1},replaceOperation:function(e,t){var r=this.getOperations(),n=r.lastIndexOf(e);return n>=0?(console.log("replace operation",n===r.length-1),r.splice(n,1,t)):null},undo:function(){var e=this.pop();return e&&e.isReversible()&&e.reverse(),this.invokeEvent("undo",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange"),e},undoAll:function(){for(;this.canUndo;)this.undo()},canUndo:function(){return this.canPop()},redo:function(){var e=this.unpop();return e&&e.execute(),this.invokeEvent("redo",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange"),e},canRedo:function(){return this.canUnpop()}}),function(){d.Action=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Action",HTML_CLASSNAME:null,initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("linkedWidgets",[]),this.setPropStoreFieldValue("enabled",!0),this.setPropStoreFieldValue("visible",!0),this.setPropStoreFieldValue("displayed",!0),this.setPropStoreFieldValue("htmlClassName",this.getInitialHtmlClassName()),this.setBubbleEvent(!0),this.reactWidgetExecuteBind=this.reactWidgetExecute.bind(this)},finalize:function(){var e=this.getOwner();e&&e.actionRemoved&&e.actionRemoved(this),this.unlinkAllWidgets(),this.setPropStoreFieldValue("linkedWidgets",[]),this._lastHtmlEvent=null,this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL,setter:function(e){e!==this.getEnabled()&&(this.setPropStoreFieldValue("enabled",e),this.updateAllWidgetsProp("enabled",e))}}),this.defineProp("visible",{dataType:DataType.BOOL,setter:function(e){e!==this.getVisible()&&(this.setPropStoreFieldValue("visible",e),this.updateAllWidgetsProp("visible",e))}}),this.defineProp("displayed",{dataType:DataType.BOOL,setter:function(e){e!==this.getDisplayed()&&(this.setPropStoreFieldValue("displayed",e),this.updateAllWidgetsProp("displayed",e))}}),this.defineProp("checked",{dataType:DataType.BOOL,setter:function(e){e!==this.getChecked()&&(this.setPropStoreFieldValue("checked",e),this.updateAllWidgetsProp("checked",e),this.checkedChanged())}}),this.defineProp("checkGroup",{dataType:DataType.STRING}),this.defineProp("hint",{dataType:DataType.STRING,setter:function(e){e&&e!==this.getHint()&&(this.setPropStoreFieldValue("hint",e),this.updateAllWidgetsProp("hint",e))}}),this.defineProp("text",{dataType:DataType.STRING,setter:function(e){e&&e!==this.getText()&&(this.setPropStoreFieldValue("text",e),this.updateAllWidgetsProp("text",e))}}),this.defineProp("shortcutKeys",{dataType:DataType.ARRAY}),this.defineProp("shortcutKey",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getShortCutKeys()[0]},setter:function(e){this.setShortcutKeys(d.ArrayUtils.toArray(e))}}),this.defineProp("htmlClassName",{dataType:DataType.STRING,setter:function(e){var t=this.getHtmlClassName();this.setPropStoreFieldValue("htmlClassName",e),this.updateAllWidgetClassName(e,t)}}),this.defineProp("owner",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("linkedWidgets",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("invoker",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},getHigherLevelObj:function(){return this.getOwner()},invokeEvent:function(e,t){t||(t={}),t.invoker||(t.invoker=this.getInvoker()),this.tryApplySuper("invokeEvent",[e,t])},getInitialHtmlClassName:function(){return this.HTML_CLASSNAME||null},getActionList:function(){var e=this.getOwner();return e instanceof d.ActionList?e:null},checkedChanged:function(){var e=this.getActionList();e&&e.actionCheckedChanged(this)},linkWidget:function(e){var t=this.getLinkedWidgets();if(t.indexOf(e)<0){var r=this.getText();r&&this.updateWidgetProp(e,"text",r);var n=this.getHint();return n&&this.updateWidgetProp(e,"hint",n),this.updateWidgetProp(e,"enabled",this.getEnabled()),this.updateWidgetProp(e,"displayed",this.getDisplayed()),this.updateWidgetProp(e,"visible",this.getVisible()),this.updateWidgetProp(e,"checked",this.getChecked()),this.updateWidgetProp(e,"shortcutKeys",this.getShortcutKeys()),this.updateWidgetClassName(e,this.getHtmlClassName(),null),e.addEventListener("execute",this.reactWidgetExecuteBind),t.push(e),this}},unlinkWidget:function(e){var t=this.getLinkedWidgets(),r=t.indexOf(e);r>=0&&(this.updateWidgetClassName(e,null,this.getHtmlClassName()),e.removeEventListener("execute",this.reactWidgetExecuteBind),t.splice(r,1))},unlinkAllWidgets:function(){for(var e=this.getLinkedWidgets(),t=e.length-1;t>=0;--t)this.unlinkWidget(e[t])},reactWidgetExecute:function(e){return this.execute(e.target,e.htmlEvent)},execute:function(e,t){if(!t||t!==this._lastHtmlEvent||t.__$periodicalExecuting$__){var r=this.getChecked();this.getCheckGroup()&&r||(this.doExecute(e,t),this.getCheckGroup()&&this.setChecked(!0)),this.setPropStoreFieldValue("invoker",e),this._lastHtmlEvent=t,this.invokeEvent("execute",{htmlEvent:t,invoker:e})}return this},doExecute:function(e,t){},update:function(){return this.doUpdate(),this},doUpdate:function(){},updateAllWidgetsProp:function(e,t){for(var r=this.getLinkedWidgets(),n=0,i=r.length;n<i;++n){var o=r[n];this.updateWidgetProp(o,e,t)}},updateWidgetProp:function(e,t,r){e.hasProperty(t)&&e.setPropValue(t,r)},updateWidgetClassName:function(e,t,r){r&&e.removeClassName(r,!0),t&&e.addClassName(t,!0)},updateAllWidgetClassName:function(e,t){for(var r=this.getLinkedWidgets(),n=0,i=r.length;n<i;++n){var o=r[n];this.updateWidgetClassName(o,e,t)}}}),d.ActionList=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ActionList",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("actions",[]),this.setPropStoreFieldValue("ownActions",!0),this.setPropStoreFieldValue("autoUpdate",!0),this.reactActionExecutedBind=this.reactActionExecuted.bind(this),this.addEventListener("execute",this.reactActionExecutedBind)},finalize:function(){this.removeEventListener("execute",this.reactActionExecutedBind),this.clear(),this.setPropStoreFieldValue("actions",null),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("actions",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("ownActions",{dataType:DataType.BOOL}),this.defineProp("autoUpdate",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoUpdate",e),e&&this.updateAll()}})},hasActionChecked:function(e){return!!this.getCheckedAction(e)},getCheckedAction:function(e){for(var t=this.getActions(),r=0,n=t.length;r<n;++r){var i=t[r];if(i.getCheckGroup()===e&&i.getChecked())return i}return null},actionAdded:function(e){if(this.getOwnActions()){var t=e.getOwner();t&&t.actionRemoved&&t.actionRemoved(e),e.setPropStoreFieldValue("owner",this)}d.ArrayUtils.pushUnique(this.getActions(),e),e.update()},actionRemoved:function(e){d.ArrayUtils.remove(this.getActions(),e),e.setPropStoreFieldValue("owner",null)},actionCheckedChanged:function(e){if(e&&e.getChecked()){var t=e.getCheckGroup();if(t)for(var r=this.getActions(),n=0,i=r.length;n<i;++n){var o=r[n];o!==e&&o.getCheckGroup()===t&&o.getChecked()&&o.setChecked(!1)}}},reactActionExecuted:function(e){e.target instanceof d.Action&&(this.invokeEvent("execute",{action:e.target}),this.getAutoUpdate()&&this.updateAll())},getActionCount:function(){return this.getActions().length},getActionLength:function(){return this.getActions().length},getActionAt:function(e){return this.getActions()[e]},indexOfAction:function(e){return this.getActions().indexOf(e)},setActionIndex:function(e,t){var r=this.getActions();if(r){var n=r.indexOf(e);n>=0&&n!==t&&(r.splice(n,1),r.splice(t,0,e))}return this},hasAction:function(e){return this.indexOfAction(e)>=0},add:function(e){return this.actionAdded(e),this},remove:function(e){return this.actionRemoved(e),this.getOwnActions()&&e.finalize(),this},removeAt:function(e){var t=this.getActions(),r=t[e];return r&&(d.ArrayUtils.removeAt(t,e),this.actionRemoved(r)),this},clear:function(){for(var e=this.getActions(),t=e.length-1;t>=0;--t)this.actionRemoved(e[t]);return this.setPropStoreFieldValue("actions",[]),this},updateAll:function(){for(var e=this.getActions(),t=0,r=e.length;t<r;++t)e[t].update();return this}}),d.ActionFileOpen=Class.create(d.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionFileOpen",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("filters",{dataType:DataType.ARRAY})},doUpdate:function(){this.tryApplySuper("doUpdate"),this.setEnabled(this.getEnabled()&&d.NativeServices.showFilePickerDialog)},doExecute:function(e){var t=e.getElement().ownerDocument,r=this,n=this.getInvoker();this.openFilePicker(t,(function(e,t,i){e&&r.fileOpened(i,n)}))},openFilePicker:function(e,t){return d.NativeServices.showFilePickerDialog(e,t,{mode:"open",filters:this.getFilters()})},fileOpened:function(e,t){this.doFileOpened(e,t),this.invokeEvent("open",{files:e,file:e[0]})},doFileOpened:function(e,t){}}),d.ActionLoadFileData=Class.create(d.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionLoadFileData",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("filters",{dataType:DataType.ARRAY}),this.defineProp("binaryDetector",{dataType:DataType.FUNCTION,serializable:!1})},doUpdate:function(){this.tryApplySuper("doUpdate"),this.setEnabled(this.getEnabled()&&d.NativeServices.canLoadFileData())},doExecute:function(e){var t=e.getElement().ownerDocument,r=this,n=this.getInvoker();this.loadFileData(t,(function(e,t,i){r.dataLoaded(t,i,!!e,n)}))},loadFileData:function(e,t){return d.NativeServices.loadFileData(e,t,{filters:this.getFilters(),binaryDetector:this.getBinaryDetector()})},reactFileLoad:function(e,t,r){this.dataLoaded(t,r,!!e)},dataLoaded:function(e,t,r,n){this.doDataLoaded(e,t,r,n),this.invokeEvent("load",{fileName:t,data:e,success:r})},doDataLoaded:function(e,t,r,n){}}),d.ActionFileSave=Class.create(d.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionFileSave",initialize:function(e,t){this.tryApplySuper("initialize"),e&&this.setData(e),t&&this.setFileName(t)},initProperties:function(){this.defineProp("data",{dataType:DataType.STRING,serializable:!1}),this.defineProp("fileName",{dataType:DataType.STRING,serializable:!1}),this.defineProp("filters",{dataType:DataType.ARRAY})},doUpdate:function(){this.tryApplySuper("doUpdate"),this.setEnabled(this.getEnabled()&&d.NativeServices.canSaveFileData())},doExecute:function(e){var t;t=e?e.getElement().ownerDocument:document,d.NativeServices.saveFileData(t,this.getData(),null,{initialFileName:this.getFileName(),filters:this.getFilters()})}}),d.ActionManager={_namedActionMap:null,_getNamedActionMap:function(t){var r=e._namedActionMap;return!r&&t&&(r=new d.MapEx,e._namedActionMap=r),r},getRegisteredActionsOfClass:function(t,r){var n=e._getNamedActionMap(r);if(n){var i=n.get(t);return!i&&r&&(i={},n.set(t,i)),i}return null},registerNamedActionClass:function(t,r,n){e.getRegisteredActionsOfClass(n,!0)[t]=r},unregisterNamedActionClass:function(t,r){var n=e.getRegisteredActionsOfClass(r,!1);n&&n[t]&&delete n[t]},getActionClassOfName:function(t,r,n){var i=ClassEx.isClass(r)?r:r.getClass&&r.getClass();if(!i)return null;var o=e.getRegisteredActionsOfClass(i,!1),a=o&&o[t];if(!a&&n){var s=ClassEx.getSuperClass(i);a=s?e.getActionClassOfName(t,s,n):null}return a}};var e=d.ActionManager}(),function(){"use strict";d.Widget={DEF_EVENT_HANDLER_PREFIX:"react_",getEventHandleFuncName:function(e){return d.Widget.DEF_EVENT_HANDLER_PREFIX+e},getTouchGestureHandleFuncName:function(e){return d.Widget.DEF_EVENT_HANDLER_PREFIX+e}}}(),function(){"use strict";d.DataBingItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DataBingItem",initialize:function(e,t,r,n){this.tryApplySuper("initialize"),this.setSource(e),this.setSourceName(t),this.setTarget(r),this.setTargetName(n)},initProperties:function(){this.defineProp("source",{dataType:DataType.OBJECTEX,serializable:!1}),this.defineProp("sourceName",{dataType:DataType.STRING,serializable:!1}),this.defineProp("target",{dataType:DataType.OBJECTEX,serializable:!1}),this.defineProp("targetName",{dataType:DataType.STRING,serializable:!1})},updateData:function(e){var t=this.getSource(),r=this.getTarget(),n=this.getSourceName(),i=this.getTargetName();if(t&&r&&n&&i)if(e){var o=r.getDataByBindingName(i);t.setDataByBindingName(n,o)}else o=t.getDataByBindingName(n),r.setDataByBindingName(i,o)}}),ClassEx.extend(ObjectEx,{getDataByBindingName:function(e){return this.hasProperty(e)?this.getPropValue(e):DataType.isFunctionValue(this[e])?this[e]():void 0},setDataByBindingName:function(e,t){var r=t,n=this.getPropInfo(e);if(n){var i=n.dataType,o=DataType.getType(t);i!==o&&o===DataType.STRING&&(r=DataType.StringUtils.deserializeValue(t))}return this.setPropValue(e,r),this},createDataBinding:function(e,t,r){var n=new d.DataBingItem(e,t,this,r);return this.getDataBindings(!0).push(n),n},removeDataBinding:function(e){d.ArrayUtils.remove(this.getDataBindings(),e)},updateBindingData:function(e){var t=this.getDataBindings();if(t&&t.length)for(var r=0,n=t.length;r<n;++r)t[r].updateData(e)}}),ClassEx.defineProp(ObjectEx,"dataBindings",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PRIVATE,getter:function(e){var t=this.getPropStoreFieldValue("dataBindings");return!t&&e&&(t=[],this.setPropStoreFieldValue("dataBindings",t)),t}})}(),function(){"use strict";d.globalOptions.add("widget.events",{forceSimulatePointerEvent:!1}),d.Widget.UiEvents=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","keydown","keyup","keypress","touchstart","touchend","touchcancel","touchmove","pointerdown","pointermove","pointerout","pointerover","pointerup","drag","dragend","dragenter","dragexit","dragleave","dragover","dragstart","drop"],d.Widget.UiLocalEvents=["blur","focus","mouseenter","mouseleave","mousewheel","pointerenter","pointerleave"],d.Widget.TouchGestures=["hold","tap","doubletap","swipe","swipeup","swipedown","swipeleft","swiperight","transform","transformstart","transformend","rotate","rotatestart","rotatemove","rotateend","rotatecancel","pinch","pinchstart","pinchmove","pinchend","pinchcancel","pinchin","pinchout","pan","panstart","panmove","panend","pancancel","panleft","panright","panup","pandown"];var e=d.ArrayUtils;d.Widget.HtmlEventMatcher=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.HtmlEventMatcher",initialize:function(e){this.tryApplySuper("initialize",[]),this.setEventParams(e||{})},initProperties:function(){this.defineProp("eventParams",{dataType:DataType.HASH}),this._defineEventParamProp("eventType",DataType.STRING,"type")},doFinalize:function(){this.tryApplySuper("doFinalize")},_defineEventParamProp:function(e,t,r){var n=e||r;return this.defineProp(e,{dataType:t,serializable:!1,getter:function(){return this.getEventParams()[n]},setter:function(e){this.getEventParams()[n]=e}})},match:function(e){return(e.getType&&e.getType()||e.type)===this.getEventType()},execOnMatch:function(e,t){var r=this.match(e);return r&&t&&(r=this.doExecTarget(e,t)),r},doExecTarget:function(e,t){var r;return r=DataType.isFunctionValue(t)?t.apply(null,[e,this]):!(!t.execute||!DataType.isFunctionValue(t.execute))&&(DataType.isObjectExValue(t)?t instanceof d.Widget.BaseWidget?t.execute(e):t instanceof d.Action?t.execute(this,e):t.execute(e,this):t.execute(e,this)),d.ObjUtils.isUnset(r)&&(r=!0),r}}),d.Widget.HtmlEventResponser=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.HtmlEventResponser",initialize:function(e,t,r){this.setPropStoreFieldValue("eventMatcher",e),this.setPropStoreFieldValue("execTarget",t),this.tryApplySuper("initialize",[]),this.setExclusive(r||!1)},initProperties:function(){this._defineMatcherRelatedProp("eventParams",{dataType:DataType.HASH}),this._defineMatcherRelatedProp("eventType",DataType.STRING,"type"),this.defineProp("execTarget",{dataType:DataType.VARIANT,serializable:!1}),this.defineProp("exclusive",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("eventMatcher",{dataType:"Kekule.Widget.HtmlEventMatcher",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE})},doFinalize:function(){this.setExecTarget(null);var e=this.getEventMatcher();e&&e.finalize(),this.tryApplySuper("doFinalize")},_defineMatcherRelatedProp:function(e,t,r){var n=e||r;return this.defineProp(e,{dataType:t,getter:function(){return this.getEventMatcher().getPropValue(n)},setter:function(e){this.getEventMatcher().setPropValue(n,e)}})},reactTo:function(e){var t=!1,r=this.getEventMatcher();if(r&&(t=r.match(e))){var n=this.getExecTarget();n&&(t=r.doExecTarget(e,n)),t=t&&this.getExclusive(),this.invokeEvent("execute",{htmlEvent:e,execTarget:n})}return t}}),d.Widget.HtmlEventDispatcher=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.HtmlEventDispatcher",initialize:function(){this.setPropStoreFieldValue("responsers",{}),this.tryApplySuper("initialize",[])},initProperties:function(){this.defineProp("responsers",{dataType:DataType.HASH,scope:Class.PropertyScope.PRIVATE,serializable:!1,setter:null})},doFinalize:function(){for(var e=this.getResponsers(),t=Object.getOwnPropertyNames(e),r=0,n=t.length;r<n;++r){var i=e[t[r]];if(i&&i.length)for(var o=i.length-1;o>=0;--o)i[o].finalize()}this.tryApplySuper("doFinalize")},getResponsersForType:function(e,t){var r=this.getResponsers()[e];return r||(r=[],this.getResponsers()[e]=r),r},registerResponser:function(t){var r=t.getEventType();if(r){var n=this.getResponsersForType(r,!0);e.pushUnique(n,t)}},unregisterResponser:function(e,t){var r=e.getEventType();if(r){var n=this.getResponsersForType(r);if(n&&n.length){var i=n.indexOf(e);i>=0&&(n.splice(i,1),t&&e.finalize())}}},addResponser:function(e,t,r){var n=new d.Widget.HtmlEventResponser(e,t,r);return this.registerResponser(n),n},dispatch:function(e){var t=e.getType&&e.getType()||e.type;if(t){var r=this.getResponsersForType(t);if(r&&r.length)for(var n=r.length-1;n>=0&&(!r[n].reactTo(e)&&!e.cancelBubble);--n);}}})}(),function(){var e=d.ArrayUtils,t=d.HtmlElementUtils;d.Widget.HtmlTagNames={CHILD_SLOT_HOLDER:"slot",CHILD_HOLDER:"span"},d.Widget.HtmlNames={CHILD_HOLDER:"children"},d.Widget.HtmlClassNames={BASE:"K-Widget",DYN_CREATED:"K-Dynamic-Created",CHILD_HOLDER:"K-Child-Holder",TOP_LAYER:"K-Top-Layer",ISOLATED_LAYER:"K-Isolated-Layer",NORMAL_BACKGROUND:"K-Normal-Background",NONSELECTABLE:"K-NonSelectable",SELECTABLE:"K-Selectable",STYLE_INHERITED:"K-Style-Inherited",STYLE_UNDEPENDENT:"K-Style-Undependent",STATE_NORMAL:"K-State-Normal",STATE_DISABLED:"K-State-Disabled",STATE_HOVER:"K-State-Hover",STATE_ACTIVE:"K-State-Active",STATE_FOCUSED:"K-State-Focused",STATE_SELECTED:"K-State-Selected",STATE_CURRENT_SELECTED:"K-State-Current-Selected",STATE_CHECKED:"K-State-Checked",STATE_READONLY:"K-State-ReadOnly",SHOW_POPUP:"K-Show-Popup",SHOW_DIALOG:"K-Show-Dialog",SHOW_ACTIVE_MODAL:"K-Show-ActiveModal",SECTION:"K-Section",PART_CONTENT:"K-Content",PART_TEXT_CONTENT:"K-Text-Content",PART_ASSOC_TEXT_CONTENT:"K-Assoc-Text-Content",PART_IMG_CONTENT:"K-Img-Content",PART_GLYPH_CONTENT:"K-Glyph-Content",PART_PRI_GLYPH_CONTENT:"K-Pri-Glyph-Content",PART_ASSOC_GLYPH_CONTENT:"K-Assoc-Glyph-Content",PART_DECORATION_CONTENT:"K-Decoration-Content",PART_ERROR_REPORT:"K-Error-Report",FIRST_CHILD:"K-First-Child",LAST_CHILD:"K-Last-Child",TEXT_NO_WRAP:"K-No-Wrap",LAYOUT_H:"K-Layout-H",LAYOUT_V:"K-Layout-V",LAYOUT_G:"K-Layout-G",CORNER_ALL:"K-Corner-All",CORNER_LEFT:"K-Corner-Left",CORNER_RIGHT:"K-Corner-Right",CORNER_TOP:"K-Corner-Top",CORNER_BOTTOM:"K-Corner-Bottom",CORNER_TL:"K-Corner-TL",CORNER_TR:"K-Corner-TR",CORNER_BL:"K-Corner-BL",CORNER_BR:"K-Corner-BR",CORNER_LEADING:"K-Corner-Leading",CORNER_TAILING:"K-Corner-Tailing",FULLFILL:"K-Fulfill",NOWRAP:"K-No-Wrap",HIDE_TEXT:"K-Text-Hide",HIDE_GLYPH:"K-Glyph-Hide",SHOW_TEXT:"K-Text-Show",SHOW_GLYPH:"K-Glyph-Show",MODAL_BACKGROUND:"K-Modal-Background",DUMB_WIDGET:"K-Dumb-Widget",PLACEHOLDER:"K-PlaceHolder"};var r=d.Widget.HtmlClassNames;d.Widget.StyleMode={UNDEPENDENT:0,INHERITED:1},d.Widget.Layout={HORIZONTAL:1,VERTICAL:2,GRID:4},d.Widget.Position={AUTO:0,TOP:1,LEFT:2,BOTTOM:4,RIGHT:8,TOP_LEFT:3,TOP_RIGHT:9,BOTTOM_LEFT:6,BOTTOM_RIGHT:12},d.Widget.Direction={AUTO:0,LTR:1,TTB:2,RTL:4,BTT:8,isInHorizontal:function(e){var t=d.Widget.Direction;return!!(e&t.LTR||e&t.RTL)},isInVertical:function(e){var t=d.Widget.Direction;return!!(e&t.TTB||e&t.BTT)}},d.Widget.State={NORMAL:0,FOCUSED:1,HOVER:2,ACTIVE:3,DISABLED:-1};var n=d.Widget.State;d.Widget.ShowHideType={DROPDOWN:1,POPUP:2,DIALOG:3,DEFAULT:0},d.Widget.DragDrop={ELEM_INDEX_DATA_TYPE:"application/x-kekule-dragdrop-elem-index"},d.Widget._PointerHoldParams={DURATION_THRESHOLD:1e3,MOVEMENT_THRESHOLD:10},d.Widget.BaseWidget=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseWidget",BINDABLE_TAG_NAMES:null,DEF_PERIODICAL_EXEC_DELAY:500,DEF_PERIODICAL_EXEC_INTERVAL:100,STYLE_RES_FIELD:"__$style_resources__",initialize:function(e,t){this._stateClassName=null,this._isDismissed=!1,this._pendingHtmlClassNames="",this._enableShowHideEvents=!0,this._reactElemAttribMutationBind=this._reactElemAttribMutation.bind(this),this.reactTouchGestureBind=this.reactTouchGesture.bind(this),this.setPropStoreFieldValue("inheritEnabled",!0),this.setPropStoreFieldValue("inheritStatic",!0),this.setPropStoreFieldValue("selfEnabled",!0),this.setPropStoreFieldValue("selfStatic",!1),this.setPropStoreFieldValue("periodicalExecDelay",this.DEF_PERIODICAL_EXEC_DELAY),this.setPropStoreFieldValue("periodicalExecInterval",this.DEF_PERIODICAL_EXEC_INTERVAL),this.setPropStoreFieldValue("useNormalBackground",!0),this.setPropStoreFieldValue("inheritedStyles",[]),this.setPropStoreFieldValue("droppableDataKinds",["string"]),this.setPropStoreFieldValue("htmlEventDispatcher",new d.Widget.HtmlEventDispatcher),this._touchActionNoneTouchStartHandlerBind=this._touchActionNoneTouchStartHandler.bind(this),this.tryApplySuper("initialize"),this.setPropStoreFieldValue("isDumb",!!t),t||(this.reactUiEventBind=this.reactUiEvent.bind(this)),e&&(e instanceof d.Widget.BaseWidget?(this.setDocument(e.getDocument()),this.createElement(),this.setParent(e)):e.documentElement?(this.setDocument(e),this.createElement()):(this.setDocument(e.ownerDocument),this.setElement(e))),this._stateClassName=null,this._layoutClassName=null,this.getLayout()||this.setLayout(d.Widget.Layout.HORIZONTAL),this._periodicalExecBind=this._periodicalExec.bind(this),this.setBubbleEvent(!0),this.setInheritBubbleUiEvents(!0),this.stateChanged();var r=this.getGlobalManager();r&&r.notifyWidgetCreated(this)},initProperties:function(){this.defineProp("isDumb",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){if(this.getIsDumb()!=e){this.setPropStoreFieldValue("isDumb",e);var t=this.getElement();t&&(e?this.uninstallUiEventHandlers(t):this.installUiEventHandlers(t))}}}),this.defineProp("bubbleUiEvents",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("inheritBubbleUiEvents",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("touchAction",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getCoreElement();t&&(t.style.touchAction=e,"none"===e?d.X.Event.addListener(t,"touchstart",this._touchActionNoneTouchStartHandlerBind,{passive:!1}):d.X.Event.removeListener(t,"touchstart",this._touchActionNoneTouchStartHandlerBind,{passive:!1}))}}),this.defineProp("parent",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:function(e){var t=this.getParent();t&&t._removeChild(this),e&&e._addChild(this),this.setPropStoreFieldValue("parent",e)}}),this.defineProp("childWidgets",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("childWidgets");return e||(e=[],this.setPropStoreFieldValue("childWidgets",e)),e}}),this.defineProp("document",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("element",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getElement();e!==t&&(this.setPropStoreFieldValue("element",e),this.elementChanged(e,t))}}),this.defineProp("observeElementAttribChanges",{dataType:DataType.BOOL,setter:function(e){!!e!=!!this.getObserveElementAttribChanges()&&(this.setPropStoreFieldValue("observeElementAttribChanges",e),this.observeElementAttribChangesChanged(!!e))}}),this.defineElemAttribMappingProp("id","id"),this.defineProp("draggable",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return d.StrUtils.strToBool(this.getElement().getAttribute("draggable")||"")},setter:function(e){this.getElement().setAttribute("draggable",e?"true":"false")}}),this.defineProp("droppable",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("droppableDataKinds",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("fileDroppable",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){if(!this.getDroppable())return!1;var e=this.getDroppableDataKinds();return!e||e&&e.indexOf&&e.indexOf("file")>=0},setter:function(e){e&&!this.getDroppable()&&this.setDroppable(!0);var t=this.getPropStoreFieldValue("droppableDataKinds");if(t){var r=t.indexOf("file");!e&&r>=0?t.splice(r,1):e&&r<0&&t.push("file")}else e||this.setDroppableDataKinds(["string"])}}),this.defineElemStyleMappingProp("width","width"),this.defineElemStyleMappingProp("height","height"),this.defineProp("offsetParent",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().offsetParent},setter:null}),this.defineProp("offsetLeft",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetLeft},setter:null}),this.defineProp("offsetTop",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetTop},setter:null}),this.defineProp("offsetWidth",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetWidth},setter:null}),this.defineProp("offsetHeight",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetHeight},setter:null}),this.defineProp("tabIndex",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().tabIndex},setter:function(e){this.getElement().tabIndex=e}}),this.defineProp("innerHTML",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().innerHTML},setter:function(e){this.getElement().innerHTML=e}}),this.defineProp("style",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().style},setter:null}),this.defineProp("cssText",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().style.cssText},setter:function(e){this.getElement().style.cssText=e}}),this.defineProp("htmlClassName",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().className},setter:function(e){this.getElement().className=e}}),this.defineProp("customHtmlClassName",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(e){var r=this.getElement(),n=this.getCustomHtmlClassName();r&&n!==e&&(n&&t.removeClass(r,n),e&&t.addClass(r,e),this.setPropStoreFieldValue("customHtmlClassName",e))}}),this.defineProp("visible",{dataType:DataType.BOOL,serializable:!1,getter:function(){return d.StyleUtils.isVisible(this.getElement())},setter:function(e,t){d.StyleUtils.setVisibility(this.getElement(),e),t||this.widgetShowStateChanged(this.isShown())}}),this.defineProp("displayed",{dataType:DataType.BOOL,serializable:!1,getter:function(){return d.StyleUtils.isDisplayed(this.getElement())},setter:function(e,t){d.StyleUtils.setDisplay(this.getElement(),e),t||this.widgetShowStateChanged(this.isShown())}}),this.defineProp("showHideType",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("showHideCaller",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("showHideCallerPageRect",{dataType:DataType.HASH,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("standaloneOnShowHide",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("finalizeAfterHiding",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("layout",{dataType:DataType.INT,setter:function(e){this.getPropStoreFieldValue("layout")!==e&&(this.setPropStoreFieldValue("layout",e),this.layoutChanged())}}),this.defineProp("useCornerDecoration",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("useCornerDecoration",e),e?this.addClassName(r.CORNER_ALL):this.removeClassName(r.CORNER_ALL)}}),this.defineProp("useNormalBackground",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("useNormalBackground",e),e?this.addClassName(r.NORMAL_BACKGROUND):this.removeClassName(r.NORMAL_BACKGROUND)}}),this.defineProp("styleMode",{dataType:DataType.INT,enumSource:d.Widget.StyleMode,setter:function(e){e!==this.getStyleMode()&&(this.getElement()&&(e===d.Widget.StyleMode.INHERITED?(this.removeClassName(r.STYLE_UNDEPENDENT),this.addClassName(r.STYLE_INHERITED)):(this.addClassName(r.STYLE_UNDEPENDENT),this.removeClassName(r.STYLE_INHERITED))),this.setPropStoreFieldValue("styleMode",e))}}),this.defineProp("inheritedStyles",{dataType:DataType.ARRAY,setter:function(e){this._applyToAllInheritedStyles(this.getInheritedStyles(),!1),this.setPropStoreFieldValue("inheritedStyles",e||[]),this._applyToAllInheritedStyles(this.getInheritedStyles(),!0)}}),this.defineProp("showText",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showText",e),e?(this.removeClassName(r.HIDE_TEXT),this.addClassName(r.SHOW_TEXT)):(this.addClassName(r.HIDE_TEXT),this.removeClassName(r.SHOW_TEXT))}}),this.defineProp("showGlyph",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showGlyph",e),e?(this.removeClassName(r.HIDE_GLYPH),this.addClassName(r.SHOW_GLYPH)):(this.addClassName(r.HIDE_GLYPH),this.removeClassName(r.SHOW_GLYPH))}}),this.defineProp("allowTextWrap",{dataType:DataType.BOOL,serialzable:!1,setter:function(e){e?this.removeClassName(r.TEXT_NO_WRAP):this.addClassName(r.TEXT_NO_WRAP)}}),this.defineProp("selfEnabled",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE}),this.defineProp("inheritEnabled",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("inheritEnabled",e),this.stateChanged()}}),this.defineProp("enabled",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("selfEnabled");if(this.getInheritEnabled()){var t=this.getParent();t&&(e=e&&t.getEnabled())}return e},setter:function(e){var t=this.getElement();e?t.removeAttribute("disabled"):t.setAttribute("disabled","true"),(t=this.getCoreElement())!=this.getElement()&&(e?t.removeAttribute("disabled"):t.setAttribute("disabled","true")),this.setPropStoreFieldValue("selfEnabled",e),this.stateChanged()}}),this.defineProp("selfStatic",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE}),this.defineProp("inheritStatic",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("inheritStatic",e),this.stateChanged()}}),this.defineProp("static",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("selfStatic");if(this.getInheritStatic()){var t=this.getParent();t&&(e=e||t.getStatic())}return e},setter:function(e){this.setPropStoreFieldValue("selfStatic",e),this.stateChanged()}}),this.defineProp("inheritState",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("inheritState",e),this.stateChanged()}}),this.defineProp("state",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var e;if(this.getInheritState()){var t=this.getParent();t&&(e=t.getState())}else e=this.getEnabled()?this.getIsActive()?n.ACTIVE:this.getIsHover()?n.HOVER:this.getIsFocused()?n.FOCUSED:n.NORMAL:n.DISABLED;return e}}),this.defineProp("shortcuts",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("shortcutKeys",{dataType:DataType.ARRAY,getter:function(){for(var e=[],t=this.getShortcuts()||[],r=0,n=t.length;r<n;++r)e.push(t[r].key);return e},setter:function(t){this._updateShortcuts(t&&e.toArray(t))}}),this.defineProp("shortcutKey",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getShortcutKeys()[0]},setter:function(e){this.setShortcutKeys(e)}}),this.defineProp("cursor",{dataType:DataType.VARIANT,serializable:!1,getter:function(){return this.getStyleProperty("cursor")},setter:function(e){DataType.isArrayValue(e)?d.StyleUtils.setCursor(this.getElement(),e):this.setStyleProperty("cursor",e)}}),this.defineProp("isHover",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("isHover",e),e||this.isCaptureMouse()||this.setPropStoreFieldValue("isActive",!1);var t=this.getGlobalManager();t&&t.notifyWidgetHoverChanged(this,e),this.stateChanged()}}),this.defineProp("isActive",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("isActive",e),e&&this.focus();var t=this.getGlobalManager();t&&t.notifyWidgetActiveChanged(this,e),this.stateChanged()}}),this.defineProp("isFocused",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getDocument(),t=this.getCoreElement();if(e&&t&&e.activeElement)return e.activeElement===t},setter:function(e){this.setPropStoreFieldValue("isFocused",e);var t=this.getGlobalManager();t&&t.notifyWidgetFocusChanged(this,e);var r=this.getCoreElement();r&&(r.focus&&e&&d.HtmlElementUtils.isFormCtrlElement(r)&&r.focus(),r.blur&&!e&&r.blur()),this.stateChanged()}}),this.defineProp("minDimension",{dataType:DataType.HASH}),this.defineProp("enableDimensionTransform",{dataType:DataType.BOOL}),this.defineProp("autoResizeConstraints",{dataType:DataType.HASH,setter:function(e){this.setPropStoreFieldValue("autoResizeConstraints",e);var t=this.getGlobalManager()||d.Widget.globalManager;e?(this.autoResizeToClient(),t.registerAutoResizeWidget(this)):t.unregisterAutoResizeWidget(this)}}),this.defineProp("observeElemResize",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("observeElemResize")&&d.BrowserFeature.resizeObserver},setter:function(e){this.getPropStoreFieldValue("observeElemResize")!=!!e&&(this.setPropStoreFieldValue("observeElemResize",!!e),e?this._installElemResizeObserver():this._uninstallElemResizeObserver())}}),this.defineProp("autoAdjustSizeOnPopup",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("isDialog",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("isPopup",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("popupCaller",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE}),this.defineProp("modalInfo",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLIC}),this.defineProp("enablePeriodicalExec",{dataType:DataType.BOOL}),this.defineProp("periodicalExecDelay",{dataType:DataType.INT}),this.defineProp("periodicalExecInterval",{dataType:DataType.INT}),this.defineElemAttribMappingProp("hint","title"),this.defineProp("action",{dataType:"Kekule.Action",serializable:!1,setter:function(e){var t=this.getAction();t!==e&&(t&&t.unlinkWidget&&(t.unlinkWidget(this),this.unlinkAction(t)),this.setPropStoreFieldValue("action",e),e&&e.linkWidget&&(e.linkWidget(this),this.linkAction(e)))}}),this.defineProp("defaultChildActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("defaultChildActions");return!t&&e&&(t=new d.ActionList,this.setPropStoreFieldValue("defaultChildActions",t)),t}}),this.defineProp("defaultChildActionMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("defaultChildActionMap");return!t&&e&&(t=new d.MapEx,this.setPropStoreFieldValue("defaultChildActionMap",t)),t}}),this.defineProp("iaControllerMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("iaControllerMap");return e||(e=new d.HashEx,this.setPropStoreFieldValue("iaControllerMap",e)),e}}),this.defineProp("defIaControllerId",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("defIaController",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.getIaControllerMap().get(this.getDefIaControllerId())}}),this.defineProp("activeIaControllerId",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){if(e!==this.getActiveIaControllerId()){this.setPropStoreFieldValue("activeIaControllerId",e);var t=this.getActiveIaController();t&&t.activated&&t.activated(this)}}}),this.defineProp("activeIaController",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.getIaControllerMap().get(this.getActiveIaControllerId())}}),this.defineProp("htmlEventDispatcher",{dataType:"Kekule.Widget.HtmlEventDispatcher",serializable:!1,scope:Class.PropertyScope.PRIVATE,setter:null}),this.defineProp("observingGestureEvents",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null})},doFinalize:function(){this._elemResizeObserver&&(this._elemResizeObserver.disconnect&&this._elemResizeObserver.disconnect(),this._elemResizeObserver=null),this._clearShortcuts(),this.getHtmlEventDispatcher().finalize();var e=this.getDefaultChildActionMap();e&&(e.finalize(),this.setPropStoreFieldValue("defaultChildActionMap",null));var t=this.getDefaultChildActions();t&&(t.finalize(),this.setPropStoreFieldValue("defaultChildActions",null)),this.setAction(null),this.setParent(null),this.releaseChildWidgets();var r=this.getElement();this.setElement(null),this.destroyElement(r),this.getGlobalManager()&&this.getGlobalManager().notifyWidgetFinalized(this),this.tryApplySuper("doFinalize")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableObjectChangeEvent(!0)},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]),e.indexOf("readOnly")>=0&&this.hasProperty("readOnly")&&(this.getPropValue("readOnly")?this.addClassName(r.STATE_READONLY):this.removeClassName(r.STATE_READONLY))},invokeEvent:function(e,t){t||(t={}),t.widget||(t.widget=this),this.tryApplySuper("invokeEvent",[e,t]);var r=this.getGlobalManager();r&&r.notifyWidgetEventFired(this,e,t)},getGlobalManager:function(){return d.Widget.Utils.getGlobalManager(this.getDocument())},getCoreElement:function(){return this.getElement()},getChildrenHolderElement:function(){return this.getCoreElement()},getTextSelectable:function(){return!1},canUsePlaceHolderOnElem:function(e){return!1},doPropChanged:function(e,t){"width"!==e&&"height"!==e||this.resized()},getActualBubbleUiEvents:function(){var e=this.getParent();return!!this.getBubbleUiEvents()||(this.getInheritBubbleUiEvents()&&e&&e.getActualBubbleUiEvents?e.getActualBubbleUiEvents():void 0)},releaseChildWidgets:function(){for(var e=this.getChildWidgets(),t=e.length-1;t>=0;--t)e[t].finalize()},defineElemAttribMappingProp:function(e,t,r){var n=Object.extend({dataType:DataType.STRING,serializable:!1,getter:function(){return this.getElement()&&this.getElement().getAttribute(t)},setter:function(e){this.getElement()&&this.getElement().setAttribute(t,e)}},r||{});return this.defineProp(e,n)},defineElemStyleMappingProp:function(e,t,r){var n=Object.extend({dataType:DataType.STRING,serializable:!1,getter:function(){return this.getStyleProperty(t)},setter:function(e){this.setStyleProperty(t,e)}},r||{});return this.defineProp(e,n)},getHigherLevelObj:function(){return this.getParent()},linkAction:function(e){},unlinkAction:function(e){},getChildActionClass:function(e,t){return d.ActionManager.getActionClassOfName(e,this,t)},getChildAction:function(e,t){var r=null,n=this.getChildActionClass(e,t);if(n){var i=this.getDefaultChildActionMap(!0);(r=i.get(n))||(r=new n,this.getDefaultChildActions(!0).add(r),i.set(n,r))}return r},_updateShortcuts:function(e){var t=this.getShortcuts()||[],r=t.length,n=e&&e.length||0;if(n<r)for(var i=n;i<r;++i)t[i].finalzie();else{var o=this.getDocument();for(i=r;i<n;++i){var a=new d.Widget.Shortcut(this);t.push(a),a.registerToGlobal(o)}}for(i=0;i<n;++i)t[i].setKey(e[i]);this.setPropStoreFieldValue("shortcuts",t)},_clearShortcuts:function(){var e=this.getShortcuts()||[],t=e.length;if(t){for(var r=0;r<t;++r)e[r].finalize();this.setShortcuts(null)}},linkStyleResource:function(e,t){var r=e instanceof d.Widget.StyleResource?e:d.Widget.StyleResourceManager.getResource(e);return r&&r.linkTo(t||this),this},unlinkStyleResource:function(e,t){var r=e instanceof d.Widget.StyleResource?e:d.Widget.StyleResourceManager.getResource(e);return r&&r.unlinkFrom(t||this),this},getStyleProperty:function(e,t){var r=t||this.getElement(),n=r[this.STYLE_RES_FIELD];return n&&n[e]?n[e]:r.style[e]},setStyleProperty:function(e,t,r){var n,i=r||this.getElement();if(i)if(t instanceof d.Widget.StyleResource?n=t:DataType.getType(t)===DataType.STRING&&t.startsWith(d.Widget.StyleResourceNames.PREFIX)&&(n=d.Widget.StyleResourceManager.getResource(t)),n){(a=i[this.STYLE_RES_FIELD])||(a={},i[this.STYLE_RES_FIELD]=a);var o=a[e];o&&this.unlinkStyleResource(o,i),n&&this.linkStyleResource(n,i),a[e]=n}else{var a;i.style[e]=t,(a=i[this.STYLE_RES_FIELD])&&a[e]&&this.unlinkStyleResource(a[e],i)}return this},removeStyleProperty:function(e,t){var r=t||this.getElement();return d.StyleUtils.removeStyleProperty(r.style,e),this},setStyleProperties:function(e,t){for(var r=Object.getOwnPropertyNames(e||{}),n=0,i=r.length;n<i;++n){var o=r[n],a=e[o];this.setStyleProperty(o,a,t)}return this},removeStyleProperties:function(t,r){for(var n=0,i=e.toArray(t).length;n<i;++n)this.removeStyleProperty(name,r);return this},getComputedStyle:function(e){return d.StyleUtils.getComputedStyle(this.getCoreElement(),e)},getComputedCustomStyle:function(e){var t;return t=e.indexOf("-")<0?e.dasherize():e,this.getComputedStyle("--"+t)},isStyleInherited:function(e){return(this.getInheritedStyles()||[]).indexOf(e)>=0},_setInheritedStyleValues:function(t,r,n){for(var i=e.toArray(t),o=this.getInheritedStyles()||{},a=0,s=i.length;a<s;++a){var l=i[a],d=o.indexOf(l);r?(!n&&d<0&&(o.push(l),this.notifyInheritedStyleChanged(l,!0)),this.setStyleProperty(l,"inherit")):(this.removeStyleProperty(l),!n&&d>=0&&(o.splice(d,1),this.notifyInheritedStyleChanged(l,!1)))}return this},notifyInheritedStyleChanged:function(e,t){},addInheritedStyle:function(e){return this._setInheritedStyleValues(e,!0)},removeInheritedStyle:function(e){return this._setInheritedStyleValues(e,!1)},clearInheritedStyles:function(){this.setPropStoreFieldValue("inheritedStyles",[])},_applyToAllInheritedStyles:function(e,t){d.ObjUtils.isUnset(t)&&(t=!0);for(var r=0,n=e.length;r<n;++r){var i=e[r];this._setInheritedStyleValues(i,t,!0)}},_addChild:function(e){if(e){var t=this.getChildWidgets();t.indexOf(e)<0&&(t.push(e),this.childWidgetAdded(e),this.childrenModified())}},_insertChild:function(e,t){if(e){var r=this.getChildWidgets(),n=t?r.indexOf(t):r.length;r.indexOf(e)>=0?n>=0&&this._moveChild(e,n):(n<0&&(n=r.length),r.splice(n,0,e),this.childWidgetAdded(e),this.childrenModified())}},_removeChild:function(e){if(e){var t=this.getChildWidgets(),r=t.indexOf(e);if(r>=0){t.splice(r,1);var n=this.getChildrenHolderElement(),i=e.getElement();i&&d.DomUtils.isDescendantOf(i,n)&&i.parentNode.removeChild(i),this.childWidgetRemoved(e),this.childrenModified()}}},_moveChild:function(e,t){e&&d.ArrayUtils.changeItemIndex(this.getChildWidgets(),e,t)&&(this.childWidgetMoved(e,t),this.childrenModified())},childrenModified:function(){},childWidgetAdded:function(e){},childWidgetRemoved:function(e){},childWidgetMoved:function(e,t){},indexOfChild:function(e){return this.getChildWidgets().indexOf(e)},hasChild:function(e,t){var r=this.getChildWidgets(),n=r.indexOf(e)>=0;if(!n)for(var i=0,o=r.length;i<o;++i){var a=r[i];if(a.hasChild&&(n=a.hasChild(e,t)))break}return n},getChildAtIndex:function(e){return this.getChildWidgets()[e]},getPrevSibling:function(){var e=this.getParent();if(e){var t=e.indexOfChild(this);return this.getChildAtIndex(--t)}return null},getNextSibling:function(){var e=this.getParent();if(e){var t=e.indexOfChild(this);return this.getChildAtIndex(++t)}return null},_haltPrevShowHideProcess:function(){d.Widget.showHideManager&&this.__$showHideTransInfo&&this.__$showHideTransInfo.halt()},_setEnableShowHideEvents:function(e){this._enableShowHideEvents=e},show:function(e,t,r,n){if(this.getElement()&&!this.__$isShowing)return this._haltPrevShowHideProcess(),this.doShow(e,t,r,n),this},doShow:function(e,r,n,i){this.__$isShowing=!0;var o=this,a=function(){o.__$showHideTransInfo=null,o.widgetShowStateDone(!0),o.__$isShowing=!1,r&&r()};this.setShowHideType(n),d.ObjUtils.notUnset(n)&&(this.setIsPopup(n===d.Widget.ShowHideType.DROPDOWN||n===d.Widget.ShowHideType.POPUP),n===d.Widget.ShowHideType.DIALOG?(this.setIsDialog(!0),n=d.Widget.ShowHideType.POPUP):this.setIsDialog(!1)),this.widgetShowStateBeforeChanging(!0);var s=this.getGlobalManager();n!==d.Widget.ShowHideType.DROPDOWN&&n!==d.Widget.ShowHideType.POPUP||s.preparePopupWidget(this,e,n),!d.Widget.showHideManager||i&&i.instantly?(this.setDisplayed(!0,!0),this.setVisible(!0,!0),a()):this.__$showHideTransInfo||(this.__$showHideTransInfo=d.Widget.showHideManager.show(this,e,a,n,i)),this.setShowHideCaller(e),e&&this.setShowHideCallerPageRect(t.getElemBoundingClientRect(e.getElement&&e.getElement()||e)),function(){o.widgetShowStateChanged(!0)}.defer()},flash:function(e,t,r,n){var i=this;return this.show(t,(function(){r&&r(),setTimeout(i.hide.bind(i),e)}),n),this},hide:function(e,t,r,n){if(this.getElement()&&!this.__$isHiding)return this.__$isHiding=!0,e||(e=this.getShowHideCaller()),r||(r=this.getShowHideType()),this._haltPrevShowHideProcess(),this.doHide(e,t,r,n),this},doHide:function(e,t,r,n){var i=Object.extend({callerPageRect:this.getShowHideCallerPageRect()},n),o=i.useVisible,a=this,s=this.getFinalizeAfterHiding(),l=function(){a.__$showHideTransInfo=null,a.widgetShowStateDone(!1);var e=a.getGlobalManager();r!==d.Widget.ShowHideType.DROPDOWN&&r!==d.Widget.ShowHideType.POPUP||e.unpreparePopupWidget(a),a.__$isHiding=!1,t&&t(),s&&a.finalize()};this.widgetShowStateBeforeChanging(!1),d.Widget.showHideManager&&!i.instantly?(this.__$showHideTransInfo&&this.__$showHideTransInfo.halt(),this.__$showHideTransInfo||(this.__$showHideTransInfo=d.Widget.showHideManager.hide(this,e,l,r,!1,i))):(o?this.setVisible(!1,!0):this.setDisplayed(!1,!0),l()),function(){a.widgetShowStateChanged(!1)}.defer()},dismiss:function(e,t,r,n){return this._isDismissed=!0,this.hide(e,t,r,n)},isShown:function(e){return(this.isInDomTree()||e)&&this.getElement()&&this.getVisible()&&this.getDisplayed()},widgetShowStateBeforeChanging:function(e){e&&this.autoResizeToClient()},widgetShowStateChanged:function(e,t){if(d.ObjUtils.isUnset(e)&&(e=this.isShown()),!d.ObjUtils.notUnset(this._lastShown)||this._lastShown!==e){this._lastShown=e,e&&(this._isDismissed=!1);var r=this.getGlobalManager();this.getIsPopup()&&(e?r.registerPopupWidget(this):r.unregisterPopupWidget(this)),this.getIsDialog()&&(e?r.registerDialogWidget(this):r.unregisterDialogWidget(this)),this.doWidgetShowStateChanged(e),this._enableShowHideEvents&&this.invokeEvent("showStateChange",{widget:this,isShown:e,isDismissed:this._isDismissed,byDomChange:t})}},doWidgetShowStateChanged:function(e){},widgetShowStateDone:function(e){},isInDomTree:function(){var e=this.getElement();return d.DomUtils.isInDomTree(e,null,{acrossShadowRoot:!0})},focus:function(){return this.setIsFocused(!0),this},blur:function(){return this.setIsFocused(!1),this},getBoundingClientRect:function(e){if(this.getDisplayed())return d.HtmlElementUtils.getElemBoundingClientRect(this.getElement(),e);var t=d.StyleUtils.getDisplayed(this.getElement()),r=d.StyleUtils.getVisibility(this.getElement());try{this.setVisible("hidden"),this.setDisplayed("");var n=d.HtmlElementUtils.getElemBoundingClientRect(this.getElement(),e)}finally{this.setDisplayed(t),this.setVisible(r)}return n},getPageRect:function(e){if(this.getDisplayed())return d.HtmlElementUtils.getElemPageRect(this.getElement(),e);var t=d.StyleUtils.getDisplayed(this.getElement()),r=d.StyleUtils.getVisibility(this.getElement());try{this.setVisible("hidden"),this.setDisplayed("");var n=d.HtmlElementUtils.getElemPageRect(this.getElement(),e)}finally{this.setDisplayed(t),this.setVisible(r)}return n},getDimension:function(){return this.getPageRect()},setDimension:function(e,t,r){var n=d.ObjUtils.notUnset,i=this.getMinDimension(),o=i&&i.width,a=i&&i.height,s=!1;if(this.getEnableDimensionTransform()){var l,u=n(e)&&o?e/o:null,c=n(t)&&a?t/a:null;if(l=u&&c?Math.min(u,c):u||c)return l>=1?(this._setTransformScale(1),s=!0,this.doSetDimension(e,t,r)):(!c||u<=c?(h=o,p=t&&t/l):(p=a,h=e&&e/l),this._setTransformScale(l),s=!0,this.doSetDimension(h,p,r));s=!1}if(!s){var h=n(e)?o?Math.max(e,o):e:null,p=n(t)?a?Math.max(t,a):t:null;return this._setTransformScale(1),this.doSetDimension(h,p,r)}},doSetDimension:function(e,t,r){var n=!1,i=d.ObjUtils.notUnset;return i(e)&&(this.getStyle().width="number"==typeof e?e+"px":e,n=!0),i(t)&&(this.getStyle().height="number"==typeof t?t+"px":t,n=!0),n&&!r&&(this.getObserveElemResize()||this.resized()),this.objectChange(["width","height"]),this},_setTransformScale:function(e){var t=this.getElement();1!==e?(t.style.transformOrigin="0 0",t.style.transform="scale("+e+")"):d.StyleUtils.removeStyleProperty(t.style,"transform")},updateDimensionTransform:function(){var e=this.getDimension();this.setDimension(e.width,e.height,!0)},autoResizeToClient:function(){var e=this.getAutoResizeConstraints();if(e){var t=d.DocumentUtils.getClientDimension(this.getDocument()),r=e.width?t.width*e.width:null,n=e.height?t.height*e.height:null;this.setDimension(r,n)}},resized:function(){if(!this._isResizing){this._isResizing=!0;try{this.doResize(),this.invokeEvent("resize",{widget:this})}finally{this._isResizing=!1}}},doResize:function(){},_installElemResizeObserver:function(){if(d.BrowserFeature.resizeObserver){if(!this._elemResizeObserver){var e=this;this._elemResizeObserver=new ResizeObserver((function(t){for(var r=0,n=t.length;r<n;++r){var i=t[r];i.target&&i.contentBoxSize&&i.target===e.getElement()&&e.resized()}}))}this._elemResizeObserver.observe(this.getElement())}},_uninstallElemResizeObserver:function(){d.BrowserFeature.resizeObserver&&this._elemResizeObserver&&this._elemResizeObserver.unobserve(this.getElement())},layoutChanged:function(){var e=this.getLayout();this._layoutClassName&&this.removeClassName(this._layoutClassName),this._layoutClassName=this.getLayoutClassName(e),this._layoutClassName&&this.addClassName(this._layoutClassName)},getLayoutClassName:function(e){var t=d.Widget.Layout;return e===t.VERTICAL?r.LAYOUT_V:e===t.HORIZONTAL?r.LAYOUT_H:e===t.GRID?r.LAYOUT_G:null},stateChanged:function(){this._stateClassName&&this.removeClassName(this._stateClassName),this._stateClassName=this.getStateClassName(this.getState()),this._stateClassName&&this.addClassName(this._stateClassName);for(var e=this.getChildWidgets(),t=0,r=e.length;t<r;++t)e[t].stateChanged()},getStateClassName:function(e){var t=d.Widget.State;return e===t.ACTIVE?r.STATE_ACTIVE:e===t.HOVER?r.STATE_HOVER:e===t.FOCUSED?r.STATE_FOCUSED:e===t.DISABLED?r.STATE_DISABLED:r.STATE_NORMAL},createElement:function(){var e=this.getDocument(),t=this.doCreateRootElement(e);return this.setElement(t),t},doCreateRootElement:function(e){},doCreateSubElements:function(e,t){return[]},destroyElement:function(e){(e=e||this.getElement())&&e.parentNode&&e.parentNode.removeChild(e)},appendToElem:function(e){return e&&e.appendChild(this.getElement()),this},insertToElem:function(e,t){return e.insertBefore(this.getElement(),t),this},removeFromDom:function(){var e=this.getElement(),t=e.parentNode;t&&t.removeChild(e)},appendToWidget:function(e){return this.setParent(e),this.appendToElem(e.getChildrenHolderElement()),this},insertToWidget:function(e,t){return this.setParent(e),t?this.insertToElem(e.getChildrenHolderElement(),t.getElement()):this.appendToElem(e.getChildrenHolderElement()),this},insertedToDom:function(){return this.widgetDomStateChanged(!0),this.widgetShowStateChanged(this.isShown(),!0),this.doInsertedToDom()},doInsertedToDom:function(){},removedFromDom:function(){return this.widgetDomStateChanged(!1),this.widgetShowStateChanged(!1,!0),this.doRemovedFromDom()},doRemovedFromDom:function(){},widgetDomStateChanged:function(e){this.doWidgetDomStateChanged(e),this.invokeEvent("domStateChange",{widget:this,isInDom:e})},doWidgetDomStateChanged:function(e){},domElemAdded:function(e){return this.doDomElemAdded(e)},doDomElemAdded:function(e){},domElemRemoved:function(e){return this.doDomElemRemoved(e)},doDomElemRemoved:function(e){},getWidgetClassName:function(){var e=d.Widget.HtmlClassNames.BASE;return e+=" "+(this.getStyleMode()===d.Widget.StyleMode.INHERITED?r.STYLE_INHERITED:r.STYLE_UNDEPENDENT),this.getElement()&&!d.HtmlElementUtils.isFormCtrlElement(this.getCoreElement())&&this.getUseNormalBackground()&&(e+=" "+d.Widget.HtmlClassNames.NORMAL_BACKGROUND),e+" "+this.doGetWidgetClassName()},doGetWidgetClassName:function(){return""},hasClassName:function(e){return t.hasClass(this.getElement(),e)},addClassName:function(e,r){if(this.getElement())if(r){var n=this.getCustomHtmlClassName();n=d.StrUtils.addTokens(n,e),this.setCustomHtmlClassName(n)}else t.addClass(this.getElement(),e);else this._pendingHtmlClassNames=d.StrUtils.addTokens(this._pendingHtmlClassNames,e);return this},removeClassName:function(e,r){if(this.getElement())if(r){var n=this.getCustomHtmlClassName();n=d.StrUtils.removeTokens(n,e),this.setCustomHtmlClassName(n)}else t.removeClass(this.getElement(),e);else this._pendingHtmlClassNames=d.StrUtils.removeTokens(this._pendingHtmlClassNames,e);return this},toggleClassName:function(e,r){if(this.getElement())if(r){var n=this.getCustomHtmlClassName();n=d.StrUtils.toggleTokens(n,e),this.setCustomHtmlClassName(n)}else t.toggleClass(this.getElement(),e);return this},isElementBindable:function(e){var t=this.getBindableElemTagNames();if(t){var r=e.tagName;return t.indexOf(r.toLowerCase())>=0}return!0},getBindableElemTagNames:function(){return this.getPrototype().hasOwnProperty("BINDABLE_TAG_NAMES")?this.BINDABLE_TAG_NAMES:null},bindElement:function(e){if(e){if(!this.isElementBindable(e))return void d.error(d.$L("ErrorMsg.WIDGET_CAN_NOT_BIND_TO_ELEM").format(this.getClassName(),e.tagName));this.beginUpdate();try{var n=e.className;n&&this.setCustomHtmlClassName(this.getCustomHtmlClassName()||" "+n);var i=this.getDefaultTabIndex();d.ObjUtils.notUnset(i)&&!e.getAttribute("tabindex")&&(e.tabIndex=i);var o=d.DomUtils,a=d.HtmlElementUtils;!function(e){for(var t=o.getDirectChildElems(e),n=t.length-1;n>=0;--n){var i=t[n];a.hasClass(i,r.DYN_CREATED)&&e.removeChild(i)}}(e);var s=this.getDocument().createDocumentFragment(),l=this.doCreateSubElements(this.getDocument(),s);if(l&&l.length)for(var u=0,c=l.length;u<c;++u){var h=l[u];a.addClass(h,r.DYN_CREATED)}(l&&l.length||s.children&&s.children.length||s.childNodes&&s.childNodes.length)&&e.appendChild(s),this.doBindElement(e),this._applyToAllInheritedStyles(this.getInheritedStyles(),!0),d.DomUtils.hasAttribute(e,"disabled")&&this.setEnabled(!1);var p=this.getWidgetClassName();t.addClass(e,p),(p=this.getCustomHtmlClassName())&&t.addClass(e,p),this.getTextSelectable()||t.addClass(e,r.NONSELECTABLE),this._pendingHtmlClassNames&&(t.addClass(e,this._pendingHtmlClassNames),this._pendingHtmlClassNames="");var g=e.getAttribute("width"),f=e.getAttribute("height");(d.ObjUtils.notUnset(g)||d.ObjUtils.notUnset(f))&&(g=parseFloat((g||"").toString())||0,f=parseFloat((f||"").toString())||0,this.setDimension(g,f));var m=d.DomUtils.getDataset(e);if(m)for(var C in m){var y=m[C];try{d.Widget.Utils.setWidgetPropFromElemAttrib(this,C,y)}catch(e){d.warn(e)}}var _=this.getTouchAction();d.ObjUtils.notUnset(_)&&this.setTouchAction(_),this.getIsDumb()||this.installUiEventHandlers(e),e.__$kekule_widget__=this,this.elementBound(e)}finally{this.endUpdate(),this.invokeEvent("bind",{widget:this,element:e})}}},doBindElement:function(e){},elementBound:function(e){},unbindElement:function(e){if(e){this.getIsDumb()||this.uninstallUiEventHandlers(e);var r=this.getWidgetClassName();t.removeClass(e,r),this.doUnbindElement(e),e.__$kekule_widget__=void 0;try{delete e.__$kekule_widget__}catch(e){}this.elementUnbound(e),this.invokeEvent("unbind",{widget:this,element:e})}},doUnbindElement:function(e){},elementUnbound:function(e){},elementChanged:function(e,t){t&&this.unbindElement(t),e&&this.bindElement(e)},getDefaultTabIndex:function(){return this.doGetDefaultTabIndex()},doGetDefaultTabIndex:function(){return 0},observeElementAttribChangesChanged:function(e){var t=this.getElement();e?this._installAttribMutationObserver(t):this._uninstallAttribMutationObserver(t)},_installAttribMutationObserver:function(e){if(d.X.MutationObserver){if(!this._attribMutationObserver){var t=new d.X.MutationObserver(this._reactElemAttribMutationBind);this._attribMutationObserver=t}this._attribMutationObserver.observe(e,{attributes:!0})}},_uninstallAttribMutationObserver:function(e){this._attribMutationObserver&&this._attribMutationObserver.disconnect()},_reactElemAttribMutation:function(e){for(var t=this.getElement(),r=this.getCoreElement(),n=0,i=e.length;n<i;++n){var o=e[n];if("attributes"===o.type&&(o.target===t||o.target===r)){var a=o.attributeName;if(a)if("style"===a.toLowerCase())this.notifyStyleAttribChanged(o.target);else if(d.DomUtils.isDataAttribName(a)){var s=d.DomUtils.getDataAttribCoreName(a);if(s){var l=t.getAttribute(a);d.Widget.Utils.setWidgetPropFromElemAttrib(this,s,l)}}}}},notifyStyleAttribChanged:function(e){},createDecorationContent:function(e,n){var i=e.ownerDocument.createElement("span");return t.addClass(i,[r.PART_CONTENT,r.PART_DECORATION_CONTENT,r.DYN_CREATED]),n?e.insertBefore(i,n):e.appendChild(i),i},createTextContent:function(e,n,i){var o=n.ownerDocument.createElement("span");return t.addClass(o,[r.PART_CONTENT,r.PART_TEXT_CONTENT,r.DYN_CREATED]),o.innerHTML=e,i?n.insertBefore(o,i):n.appendChild(o),o},createGlyphContent:function(e,n,i){var o=e.ownerDocument.createElement("span");return t.addClass(o,[r.PART_CONTENT,r.PART_GLYPH_CONTENT,r.DYN_CREATED]),i&&t.addClass(o,i),n?e.insertBefore(o,n):e.appendChild(o),o},_touchActionNoneTouchStartHandler:function(e){try{e.preventDefault()}catch(e){}},installUiEventHandlers:function(e){for(var t=d.Widget.UiLocalEvents,r=0,n=t.length;r<n;++r)d.X.Event.addListener(e,t[r],this.reactUiEventBind)},uninstallUiEventHandlers:function(e){for(var t=d.Widget.UiLocalEvents,r=0,n=t.length;r<n;++r)d.X.Event.removeListener(e,t[r],this.reactUiEventBind)},registerHtmlEventResponser:function(e){return this.getHtmlEventDispatcher().registerResponser(e),this},unregisterHtmlEventResponser:function(e){return this.getHtmlEventDispatcher().unregisterResponser(e),this},addHtmlEventResponser:function(e,t,r){return this.getHtmlEventDispatcher().addResponser(e,t,r)},reactUiEvent:function(e){if(this.getStatic());else if(this.getEnabled()){var t,r=!1,n=e.getType(),i=e.getTarget(),o=d.Widget.Utils.getBelongedResponsiveWidget(i)===this,a=d.X.Event.KeyCode;if("mousemove"===n||"pointermove"===n){this.reactPointerMoving(e);var s=this.getEventMouseRelCoord(e),l=this.testMouseCursor(s,e);d.ObjUtils.notUnset(l)&&this.getElement()&&(this.setCursor(l),r=!0)}else if("touchmove"===n){if(this.reactPointerMoving(e),this.getIsActive()&&!this.isCaptureMouse()){var u=e.touches[0];if(u){var c=this.getDocument().elementFromPoint(u.clientX,u.clientY);d.DomUtils.isOrIsDescendantOf(c,this.getElement())||(this.setIsHover(!1),this.setIsActive(!1))}else this.setIsHover(!1),this.setIsActive(!1)}r=!0}else if("focus"===n)o&&e.getTarget()===this.getCoreElement()&&(this.setIsFocused(!0),r=!0);else if("blur"===n){if(o&&e.getTarget()==this.getCoreElement()){var h=this.getDocument().activeElement,p=this.getElement();h&&(d.DomUtils.isDescendantOf(h,p)||h===p)||this.setIsFocused(!1),r=!0}}else if("pointerover"===n)"touch"===e.pointerType||e.ghostMouseEvent||this.setIsHover(!0),r=!0;else if("mouseout"===n||"touchleave"===n){if(!e.ghostMouseEvent){var g=e.getRelatedTarget();g&&d.DomUtils.isOrIsDescendantOf(g,this.getCoreElement())||(this.setIsHover(!1),this.isCaptureMouse()||(this.reactDeactiviting(e),r=!0))}}else"pointerdown"===n&&e.getButton()===d.X.Event.MouseButton.LEFT?(o&&!e.ghostMouseEvent&&this.reactActiviting(e),r=!0):"pointerup"===n&&e.getButton()===d.X.Event.MouseButton.LEFT||"touchcancel"===n?(o&&!e.ghostMouseEvent&&this.reactDeactiviting(e),r=!0):"keydown"===n?(t=e.getKeyCode())!==a.ENTER&&t!==a.SPACE||(o&&!this.getIsActive()&&this.reactActiviting(e),r=!0):"keyup"===n&&((t=e.getKeyCode())!==a.ENTER&&t!==a.SPACE||(o&&this.getIsActive()&&this.reactDeactiviting(e),r=!0));this.doBeforeDispatchUiEvent(e);var f=d.Widget.getEventHandleFuncName(e.getType());this[f]&&(r=this[f](e)),e.cancelBubble||(r=this.dispatchEventToIaControllers(e)||r),e.cancelBubble||this.getHtmlEventDispatcher().dispatch(e),this.doReactUiEvent(e),this.invokeEvent(n,{htmlEvent:e})}else e.stopPropagation();if(this.getActualBubbleUiEvents()&&!e.cancelBubble){var m=this.getParent();m&&m.reactUiEvent&&m.reactUiEvent(e)}},doReactUiEvent:function(e){},doBeforeDispatchUiEvent:function(e){},_supportGestureEvent:function(){return void 0!==d.$jsRoot.Hammer&&d.$jsRoot.document&&d.$jsRoot.document.addEventListener},startObservingGestureEvents:function(t){if(this._supportGestureEvent()){t||(t=d.Widget.TouchGestures);var r=e.exclude(t,this.getObservingGestureEvents()||[]);r.length&&this.installHammerTouchHandlers(r)}},stopObservingGestureEvents:function(t){if(this._supportGestureEvent()&&this.getObservingGestureEvents()){t||(t=d.Widget.TouchGestures);var r=e.intersect(t,this.getObservingGestureEvents());r.length&&this.uninstallHammerTouchHandlers(r)}},installHammerTouchHandlers:function(e){if(this._supportGestureEvent()){e||(e=d.Widget.TouchGestures);var t=this.getCoreElement(),r=new Hammer(t);return e.indexOf("pinch")>=0&&r.get("pinch").set({enable:!0}),e.indexOf("rotate")>=0&&r.get("rotate").set({enable:!0}),r.on(e.join(" "),this.reactTouchGestureBind),this._hammertime=r,this.setPropStoreFieldValue("observingGestureEvents",e),r}},uninstallHammerTouchHandlers:function(e){this._hammertime&&(e||(e=this.getObservingGestureEvents()),this._hammertime.off(e.join(" "),this.reactTouchGestureBind))},reactTouchGesture:function(e){var t=d.Widget.getTouchGestureHandleFuncName(e.getType&&e.getType()||e.type);this[t]?this[t](e):this.dispatchEventToIaControllers(e,"hammer")},reactActiviting:function(e){this.getIsActive()||(this.setIsActive(!0),this.doReactActiviting(e),this.invokeEvent("activate",{widget:this}))},doReactActiviting:function(e){},reactDeactiviting:function(e){this.getIsActive()&&(this.doReactDeactiviting(e),this.invokeEvent("deactivate",{widget:this}),this.setIsActive(!1))},doReactDeactiviting:function(e){},reactPointerMoving:function(e){this.doReactPointerMoving(e)},doReactPointerMoving:function(e){},dispatchEventToIaControllers:function(e,t){var r=!1,n=this.getActiveIaController();return n&&(r="hammer"===t?n.handleGestureEvent(e):n.handleUiEvent(e)),r||(n=this.getDefIaController())&&(r="hammer"===t?n.handerGestureEvent(e):n.handleUiEvent(e)),r},getEventMouseRelCoord:function(e,t){t||(t=this.getCoreElement());var r={x:e.getClientX(),y:e.getClientY()},n=d.HtmlElementUtils.getElemPageRect(t,!0),i={x:n.left-t.scrollLeft,y:n.top-t.scrollTop};return d.CoordUtils.substract(r,i)},testMouseCursor:function(e,t){var r=this.doTestMouseCursor(e,t);if(!r){var n=this.getActiveIaController();if(n){var i=n.testMouseCursor(e,t);d.ObjUtils.notUnset(i)&&(r=i)}!r&&(n=this.getDefIaController())&&(i=n.testMouseCursor(e,t),d.ObjUtils.notUnset(i)&&(r=i))}return r},doTestMouseCursor:function(e,t){return null},setMouseCapture:function(e){var t=this.getGlobalManager();e?t.setMouseCaptureWidget(this):this.isCaptureMouse()&&t.setMouseCaptureWidget(null)},isCaptureMouse:function(){return this.getGlobalManager().getMouseCaptureWidget()===this},_getEventMouseCoord:function(e,t){var r=t||this.getElement(),n=e.getTarget(),i=e.getOffsetCoord(!0);if(n===r)return i;var o=d.HtmlElementUtils.getElemPagePos(r),a=d.HtmlElementUtils.getElemPagePos(n),s={x:a.x-o.x,y:a.y-o.y};return d.CoordUtils.substract(i,s)},_filterDraggedDataItemByKinds:function(e,t){if(e.items){for(var r=[],n=0,i=e.items.length;n<i;++n){var o=e.items[n];t.indexOf(o.kind)>=0&&r.push(o)}return r}return null},dragStart:function(e){if(this.getDraggable()){var t=this.doDragStart(e);return this.invokeEvent("dragStart",{widget:this,dataTransfer:e.dataTransfer,startingElem:e.targetElem}),t}return!1},doDragStart:function(e,t){return!0},dragEnd:function(e){var t=this.doDragEnd(e);return this.invokeEvent("dragEnd",{widget:this,dataTransfer:e.dataTransfer,startingElem:e.targetElem}),t},doDragEnd:function(e){},acceptDragSrc:function(e){if(this.getDroppable()){var t=!0,r={widget:this,htmlEvent:e.htmlEvent,dataTransfer:e.dataTransfer,srcElem:e.srcElem,srcWidget:e.srcWidget,srcFiles:e.dataTransfer&&e.dataTransfer.files};if(this.invokeEvent("dragAcceptQuery",r),d.ObjUtils.notUnset(r.result))return r.result;var n=this.getDroppableDataKinds();return n&&(e.dataTransfer.items?t=!!this._filterDraggedDataItemByKinds(e.dataTransfer,n).length:n.indexOf("file")>=0&&e.dataTransfer.files&&e.dataTransfer.files.length&&(t=!0)),t&&this.doAcceptDragSrc(e)}return!1},doAcceptDragSrc:function(e){return!0},dragOver:function(e){if(this.getDroppable()&&this.acceptDragSrc(e)){var t=this.doDragOver(e);return this.invokeEvent("dragOver",{widget:this,htmlEvent:e.htmlEvent,dataTransfer:e.dataTransfer,srcElem:e.srcElem,srcWidget:e.srcWidget,srcFiles:e.dataTransfer&&e.dataTransfer.files}),t}return!1},doDragOver:function(e){return!0},dragLeave:function(e){var t=this.doDragLeave(e);return this.invokeEvent("dragLeave",{widget:this,htmlEvent:e.htmlEvent,dataTransfer:e.dataTransfer,srcElem:e.srcElem,srcWidget:e.srcWidget,srcFiles:e.dataTransfer&&e.dataTransfer.files}),t},doDragLeave:function(e){},dragDrop:function(e){if(this.getDroppable()&&this.acceptDragSrc(e)){var t=this.doDragDrop(e),r=this.getDroppableDataKinds();if(!r||r.indexOf("file")>=0){var n=e.dataTransfer.files;n&&n.length&&(t=t||this.doFileDragDrop(n))}var i={widget:this,htmlEvent:e.htmlEvent,dataTransfer:e.dataTransfer,srcElem:e.srcElem,srcWidget:e.srcWidget,srcFiles:e.dataTransfer&&e.dataTransfer.files};return this.invokeEvent("dragDrop",i),t||i._preventDefault}return!1},doDragDrop:function(e){return!1},doFileDragDrop:function(e){return!0},addIaController:function(e,t,r){this.getIaControllerMap().set(e,t),r&&this.setDefIaControllerId(e),t&&t.setWidget(this)},removeIaController:function(e){var t=this.getIaControllerMap().get(e);t&&(this.getIaControllerMap().remove(e),e===this.getDefIaControllerId()&&this.setDefIaControllerId(null),e===this.getActiveIaControllerId()&&this.setActiveIaControllerId(null),t.setWidget(null))},getIaController:function(e){return this.getIaControllerMap().get(e)},execute:function(e){this.doExecute(e),this.invokeEvent("execute",{widget:this,htmlEvent:e})},doExecute:function(e){},isPeriodicalExecuting:function(){return this._periodicalExecBind},startPeriodicalExec:function(e){var t=this.getPeriodicalExecDelay()||0;this._periodicalExecuting=!0,this._periodicalExecHtmlEvent=e,this._periodicalExecHtmlEvent.__$periodicalExecuting$__=!0,setTimeout(this._periodicalExecBind,t)},stopPeriodicalExec:function(){this._periodicalExecuting=!1,this._periodicalExecHtmlEvent=null},_periodicalExec:function(e){this.isPeriodicalExecuting()&&(this._waitPeriodicalProcess||(this._waitPeriodicalProcess=!0,this.execute(this._periodicalExecHtmlEvent),this._waitPeriodicalProcess=!1),setTimeout(this._periodicalExecBind,this.getPeriodicalExecInterval()||20))}}),d.Widget.InteractionController=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.InteractionController",initialize:function(e){this.tryApplySuper("initialize"),e&&this.setWidget(e)},doFinalize:function(){this.setWidget(null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1})},activated:function(e){},handleUiEvent:function(e){var t=e.getType(),r=d.Widget.getEventHandleFuncName(t);return!!this[r]&&this[r](e)},handleGestureEvent:function(e){var t=e.type,r=d.Widget.getEventHandleFuncName(t);return!!this[r]&&this[r](e)},_defEventHandler:function(e){return!1},testMouseCursor:function(e,t){return this.doTestMouseCursor(e,t)},doTestMouseCursor:function(e,t){return null},_getEventMouseCoord:function(e,t){return this.getWidget()._getEventMouseCoord(e,t)}}),d.Widget.DumbWidget=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.DumbWidget",initialize:function(e){this.tryApplySuper("initialize",[e,!0])},doGetDefaultTabIndex:function(){return null},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.DUMB_WIDGET},doCreateRootElement:function(e){return e.createElement("span")}}),d.Widget.PlaceHolder=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.PlaceHolder",initialize:function(e,t){this.setPropStoreFieldValue("targetWidgetClass",t),this.tryApplySuper("initialize",[e,!0])},initProperties:function(){this.defineProp("targetWidgetClass",{dataType:DataType.CLASS,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("targetWidgetClass");if(!e){var t=this.getPropStoreFieldValue("targetWidgetClassName");t&&(e=ClassEx.findClass(t))}return e}}),this.defineProp("targetWidgetClassName",{dataType:DataType.STRING,getter:function(){var e=this.getTargetWidgetClass();return e?ClassEx.getClassName(e):this.getPropStoreFieldValue("targetWidgetClassName")},setter:function(e){this.setPropStoreFieldValue("targetWidgetClassName",e),this.setTargetWidgetClass(ClassEx.findClass(e))}}),this.defineProp("target",{dataType:DataType.STRING,getter:function(){return this.getTargetWidgetClassName()},setter:function(e){this.setTargetWidgetClassName(e)}}),this.defineProp("targetWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:"false",setter:null,getter:function(){var e=this.getPropStoreFieldValue("targetWidget");return e||(e=this.createTargetWidget()),e}})},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+r.PLACEHOLDER,t=this.getTargetWidgetClass();if(t){var n=ClassEx.getPrototype(t).getWidgetClassName();e=d.StrUtils.addTokens(e,n)}return e},doCreateRootElement:function(e){return e.createElement("img")},doReactUiEvent:function(e){this.createTargetWidget()},createTargetWidget:function(){var t=this.getTargetWidgetClass();if(t){try{var r=this.getElement(),n=this.getParent();n&&n instanceof d.Widget.PlaceHolder&&(n=n.createTargetWidget());var i=e.clone(this.getChildWidgets());this.unbindElement(this.getElement()),this.setPropStoreFieldValue("element",null);var o=new t(r);if(o){if(n){var a=this.getNextSibling();this.setParent(null),o.setPropStoreFieldValue("parent",n),n._insertChild(o,a)}if(i)for(var s=0,l=i.length;s<l;++s)i[s].setParent(o)}}finally{this.finalize()}return o}d.error(d.$L("ErrorMsg.WIDGET_UNAVAILABLE_FOR_PLACEHOLDER"))}}),d.Widget.Utils={getWidgetOnElem:function(e,t){var r=e.__$kekule_widget__;return!t&&r instanceof d.Widget.PlaceHolder&&(r=r.getTargetWidget()),r},getWidgetsInsideElem:function(e,t){var r,n=d.Widget.Utils.getWidgetOnElem(e);if(n){if(r=[n],!t)return r}else r=[];for(var i=d.DomUtils.getDirectChildElems(e),o=0,a=i.length;o<a;++o){var s=i[o],l=d.Widget.Utils.getWidgetsInsideElem(s,t);r=r.concat(l)}return r},getWidgetById:function(e,t){t||(t=d.$jsRoot.document);var r=t.getElementById(e);return r?d.Widget.Utils.getWidgetOnElem(r):void 0},getBelongedWidget:function(e){for(var t=null;e&&!t;)t=d.Widget.Utils.getWidgetOnElem(e),e=e.parentNode;return t},getBelongedResponsiveWidget:function(e){for(var t=null;e&&!t;)(t=d.Widget.Utils.getWidgetOnElem(e))&&t.getStatic()&&(t=null),e=e.parentNode;return t},createFromHash:function(e,t){var r=t.widgetClass||t.widget;if("string"==typeof r&&(r=ClassEx.findClass(r)),!r)return d.error(d.$L("ErrorMsg.WIDGET_CLASS_NOT_FOUND")),null;for(var n=new r(e),i=d.ObjUtils.getOwnedFieldNames(t,!0),o=0,a=(i=d.ArrayUtils.exclude(i,["widget","widgetClass","htmlClass","children"])).length;o<a;++o){var s=i[o],l=t[s];if(s.startsWith("#")&&DataType.isFunctionValue(l)){var u=s.substr(1);n.addEventListener(u,l)}else n.hasProperty(s)&&n.setPropValue(s,l)}if(t.htmlClass&&n.addClassName(t.htmlClass,!0),t.children){var c=t.children;if(DataType.isArrayValue(c))for(o=0,a=c.length;o<a;++o){var h=c[o],p=d.Widget.Utils.createFromHash(n,h);p&&p.appendToWidget(n)}}return n},setWidgetPropFromElemAttrib:function(e,t,r){var n=t.camelize(),i=e.getPropertyDataType(n);if(i||(t.startsWith("data-")&&(n=t.substr(5).camelize(),i=e.getPropertyDataType(n)),i))if(i===DataType.STRING)e.setPropValue(n,r);else if(d.PredefinedResReferer.isResValue(r))d.PredefinedResReferer.loadResource(r,(function(t,r){e.loadPredefinedResDataToProp&&e.loadPredefinedResDataToProp(n,t,r)}),null,e.getDocument());else if(r&&r.startsWith("#")&&ClassEx.isOrIsDescendantOf(ClassEx.findClass(i),d.Widget.BaseWidget)){var o=r.substr(1).trim();d.Widget.Utils._setWidgetRefPropFromId(e,n,o)}else{var a=JSON.parse(r);if(d.ObjUtils.notUnset(a)){var s=Class.ObjSerializerFactory.getSerializer("json").load(null,a);e.setPropValue(n,s)}}},_setWidgetRefPropFromId:function(e,t,r){if(r){var n=d.Widget.getWidgetById(r,e.getDocument());n&&e.setPropValue(t,n)}},getGlobalManager:function(e){var t=e||d.$document,r=t&&d.DocumentUtils.getDefaultView(t),n=r&&r.Kekule;return n||(n=d),n.Widget.globalManager},getThemeUrl:function(e){var t=null;e||(e="default");var r=d.getScriptPath();return r&&(t=r+(d.isUsingMinJs()?"themes/":"widgets/themes/")+e+"/kekule.css"),t}},d.Widget.getWidgetOnElem=d.Widget.Utils.getWidgetOnElem,d.Widget.getWidgetById=d.Widget.Utils.getWidgetById,d.$W=d.Widget.Utils.getWidgetById,d.Widget.getBelongedWidget=d.Widget.Utils.getBelongedWidget,d.Widget.createFromHash=d.Widget.Utils.createFromHash,d.Widget.BaseEventsReceiver=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseEventsReceiver",initialize:function(e,t){this._document=e||d.$jsRoot.document,this._eventRootObj=t||this._document&&this._document.documentElement,this.reactUiEventBind=this.reactUiEvent.bind(this),this.reactDomNodeInsertEventBind=this.reactDomNodeInsertEvent.bind(this),this.reactDomNodeRemoveEventBind=this.reactDomNodeRemoveEvent.bind(this),this.tryApplySuper("initialize");var r=this;(function(){d.X.domReady(r.domReadyInit.bind(r),this._document)}).defer()},finalize:function(){var e=this.getEventRootObj();e&&(this.uninstallGlobalDomMutationHandlers(e),this.uninstallGlobalEventHandlers(e)),this.tryApplySuper("finalize")},getEventRootObj:function(){return this._eventRootObj},domReadyInit:function(){var e=this.getEventRootObj();e&&(this.installGlobalEventHandlers(e),this.installGlobalDomMutationHandlers(e))},installGlobalEventHandlers:function(e){if(!this._globalEventInstalled){for(var t=d.Widget.UiEvents,r=0,n=t.length;r<n;++r)"touchstart"===t[r]||"touchmove"===t[r]||"touchend"===t[r]?d.X.Event.addListener(e,t[r],this.reactUiEventBind,{passive:!0}):d.X.Event.addListener(e,t[r],this.reactUiEventBind);this._globalEventInstalled=!0}},uninstallGlobalEventHandlers:function(e){for(var t=d.Widget.UiEvents,r=0,n=t.length;r<n;++r)d.X.Event.removeListener(e,t[r],this.reactUiEventBind)},installGlobalDomMutationHandlers:function(e){var t=this;if(d.X.MutationObserver&&d.DomUtils.isElement(e)){var r=new d.X.MutationObserver((function(e){t.reactDomMutation(e)}));r.observe(e,{childList:!0,subtree:!0}),this._domMutationObserver=r}else d.X.Event.addListener(e,"DOMNodeInserted",this.reactDomNodeInsertEventBind),d.X.Event.addListener(e,"DOMNodeRemoved",this.reactDomNodeRemoveEventBind)},uninstallGlobalDomMutationHandlers:function(e){this._domMutationObserver&&this._domMutationObserver.disconnect(),this._reactDomNodeInserted&&d.X.Event.removeListener(e,"DOMNodeInserted",this.reactDomNodeInsertEventBind),this._reactDomNodeRemoved&&d.X.Event.removeListener(e,"DOMNodeRemoved",this.reactDomNodeRemoveEventBind)},reactUiEvent:function(e){},reactDomNodeInsertEvent:function(e){},reactDomNodeRemoveEvent:function(e){},reactDomMutation:function(e){}}),d.Widget.GlobalManager=Class.create(d.Widget.BaseEventsReceiver,{CLASS_NAME:"Kekule.Widget.GlobalManager",INFO_FIELD:"__$info__",ISOLATED_LAYER_FIELD:"__$isolated_layer__",TOPMOST_LAYER_FIELD:"__$topmost_layer__",THEME_LOADED_FIELD:"__$theme_loaded__",initialize:function(e){this._document=e||d.$jsRoot.document,this._touchEventSeq=[],this._hammertime=null,this._globalSysElems=[],this.setPropStoreFieldValue("popupWidgets",[]),this.setPropStoreFieldValue("dialogWidgets",[]),this.setPropStoreFieldValue("modalWidgets",[]),this.setPropStoreFieldValue("autoResizeWidgets",[]),this.setPropStoreFieldValue("widgets",[]),this.setPropStoreFieldValue("draggingElems",[]),this.setPropStoreFieldValue("preserveWidgetList",!0),this.setPropStoreFieldValue("enableMouseEventToPointerPolyfill",!0),this.setPropStoreFieldValue("enableHammerGesture",!1),this.setPropStoreFieldValue("htmlEventDispatcher",new d.Widget.HtmlEventDispatcher),this.reactTouchGestureBind=this.reactTouchGesture.bind(this),this.reactWindowResizeBind=this.reactWindowResize.bind(this),this.tryApplySuper("initialize",[this._document,this._document&&this._document.documentElement])},finalize:function(){this.getHtmlEventDispatcher().finalize(),this.uninstallWindowEventHandlers(d.DocumentUtils.getDefaultView(this._document)),this._hammertime=null,this.setPropStoreFieldValue("popupWidgets",null),this.setPropStoreFieldValue("widgets",null),this.setPropStoreFieldValue("draggingElems",null),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("mouseCaptureWidget",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("popupWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("dialogWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("modalWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("autoResizeWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("draggingElems",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("preserveWidgetList",{dataType:DataType.BOOL,serializable:!1,setter:function(e){this.setPropStoreFieldValue("preserveWidgetList",e),e||this.setPropStoreFieldValue("widgets",[])}}),this.defineProp("widgets",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("currHoverWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1}),this.defineProp("currActiveWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1}),this.defineProp("currFocusedWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1}),this.defineProp("modalBackgroundElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("enableHammerGesture",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableMouseEventToPointerPolyfill",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("htmlEventDispatcher",{dataType:"Kekule.Widget.HtmlEventDispatcher",serializable:!1,scope:Class.PropertyScope.PRIVATE,setter:null})},domReadyInit:function(){this.tryApplySuper("domReadyInit"),this.getEnableHammerGesture()&&(this._hammertime=this.installGlobalHammerTouchHandlers(this._document.body)),this.installWindowEventHandlers(d.DocumentUtils.getDefaultView(this._document))},getDefaultContextRootElem:function(){return this.getDocContextRootElem()},getDocContextRootElem:function(){return this._document.body},_detectIfThemeLoaded:function(e){var t=e[this.THEME_LOADED_FIELD];if(!t){var r=e.ownerDocument.createElement("span");r.className="K-StyleSheet-Detector",r.style.visibility="hidden",e.appendChild(r),-88888==d.StyleUtils.getComputedStyle(r,"z-index")?(t=!0,e[this.THEME_LOADED_FIELD]=t):t=!1,e.removeChild(r)}return t},loadTheme:function(e,t){if(e||(e=this.getDefaultContextRootElem()),!this._detectIfThemeLoaded(e)){var r=d.Widget.Utils.getThemeUrl(t);d.UrlUtils.extractProtocal(r)||(r=d.UrlUtils.normalizePath("file:///"+r));var n=e.ownerDocument.createElement("style");n.innerHTML='@import "'+r+'"',e.appendChild(n),e[this.THEME_LOADED_FIELD]=!0}},notifyWidgetCreated:function(e){this.getPreserveWidgetList()&&this.getWidgets().push(e),this.invokeEvent("widgetCreate",{widget:e})},notifyWidgetFinalized:function(e){this.getWidgets()&&d.ArrayUtils.remove(this.getWidgets(),e),this.getPopupWidgets()&&d.ArrayUtils.remove(this.getPopupWidgets(),e),this.getDialogWidgets()&&d.ArrayUtils.remove(this.getDialogWidgets(),e),this.getAutoResizeWidgets()&&d.ArrayUtils.remove(this.getAutoResizeWidgets(),e),e===this.getCurrActiveWidget()&&this.setCurrActiveWidget(null),e===this.getCurrFocusedWidget()&&this.setCurrFocusedWidget(null),this.invokeEvent("widgetFinalize",{widget:e})},notifyWidgetHoverChanged:function(e,t){var r=this.getCurrHoverWidget();t?e!==r&&(r&&r.setIsHover(!1),this.setCurrHoverWidget(e)):r===e&&this.setCurrHoverWidget(null)},notifyWidgetActiveChanged:function(e,t){var r=this.getCurrActiveWidget();t?e!==r&&(r&&r.setIsActive(!1),this.setCurrActiveWidget(e)):r===e&&this.setCurrActiveWidget(null)},notifyWidgetFocusChanged:function(e,t){var r=this.getCurrFocusedWidget();t?e!==r&&(r&&r.setIsFocused(!1),this.setCurrFocusedWidget(e)):r===e&&this.setCurrFocusedWidget(null)},hasPopupWidgets:function(){return!!this.getPopupWidgets().length},hasDialogWidgets:function(){return!!this.getDialogWidgets().length},getBelongedResponsiveWidget:function(e){return d.Widget.Utils.getBelongedResponsiveWidget(e)},notifyWidgetEventFired:function(e,t,r){var n=Object.extend({},r);n.widget=e,this.invokeEvent(t,n)},installWindowEventHandlers:function(e){d.X.Event.addListener(e,"resize",this.reactWindowResizeBind)},uninstallWindowEventHandlers:function(e){d.X.Event.removeListener(e,"resize",this.reactWindowResizeBind)},installGlobalHammerTouchHandlers:function(e){if(void 0!==d.$jsRoot.Hammer){var t=new Hammer(e);return t.get("pinch").set({enable:!0}),t.get("rotate").set({enable:!0}),t.on(d.Widget.TouchGestures.join(" "),this.reactTouchGestureBind),this._hammertime=t,t}},uninstallGlobalHammerTouchHandlers:function(e){this._hammertime&&this._hammertime.off(d.Widget.TouchGestures.join(" "),this.reactTouchGestureBind)},registerHtmlEventResponser:function(e){return this.getHtmlEventDispatcher().registerResponser(e),this},unregisterHtmlEventResponser:function(e){return this.getHtmlEventDispatcher().unregisterResponser(e),this},_handleDomAddedElem:function(e){for(var t=d.Widget.Utils.getWidgetsInsideElem(e,!0),r=0,n=t.length;r<n;++r)(i=t[r]).insertedToDom();var i;(i=d.Widget.Utils.getBelongedWidget(e))&&(i.getElement()===e?i.insertedToDom():i.domElemAdded(e))},_handleDomRemovedElem:function(e){for(var t=d.Widget.Utils.getWidgetsInsideElem(e,!0),r=0,n=t.length;r<n;++r)(i=t[r]).removedFromDom();var i;(i=d.Widget.Utils.getBelongedWidget(e))&&i.domElemRemoved(e)},isMouseEvent:function(e){return e.startsWith("mouse")||"click"===e},isTouchEvent:function(e){return e.startsWith("touch")},isPointerEvent:function(e){return e.startsWith("pointer")},isKeyEvent:function(e){return e.startsWith("key")},mapTouchToPointerEvent:function(e){var t,r=e.getType(),n=e;if(n.pointerType="touch","touchstart"===r?t="pointerdown":"touchmove"===r?t="pointermove":"touchleave"===r?t="pointerout":"touchend"===r&&(t="pointerup"),t){n.setType(t),n.button=d.X.Event.MouseButton.LEFT;var i=e.touches[0],o=["clientX","clientY","pageX","pageY","screenX","screenY"];if(i){for(var a={},s=0,l=o.length;s<l;++s)n[c=o[s]]=i[c],a[c]=i[c];this._document;var u=this._retrieveTouchEventActualTarget(n);n.setTarget(u),this._touchPointerMapData={positionCache:a,targetCache:n.getTarget()}}else{if(this._touchPointerMapData)for(s=0,l=o.length;s<l;++s){var c;n[c=o[s]]=this._touchPointerMapData.positionCache[c]}n.setTarget(this._touchPointerMapData.targetCache)}return n}return null},_retrieveTouchEventActualTarget:function(e){var t=e.getTarget();return this._retrieveElementFromClientCoord(t,e.getClientX(),e.getClientY())},_retrieveElementFromClientCoord:function(e,t,r){var n=e;if(e.shadowRoot&&e.getRootNode){var i=e.shadowRoot;if(i.elementFromPoint){var o=i.elementFromPoint(t,r);o&&o!==e&&(n=this._retrieveElementFromClientCoord(o,t,r))}}return n},reactDomNodeInsertEvent:function(e){this.tryApplySuper("reactDomNodeInsertEvent",[e]);var t=e.getTarget();t.nodeType===Node.ELEMENT_NODE&&(this._isGlobalSysElement(t)||this._handleDomAddedElem(t))},reactDomNodeRemoveEvent:function(e){this.tryApplySuper("reactDomNodeRemoveEvent",[e]);var t=e.getTarget();t.nodeType===Node.ELEMENT_NODE&&(this._isGlobalSysElement(t)||this._handleDomRemovedElem(t))},reactDomMutation:function(e){this.tryApplySuper("reactDomMutation",[e]);for(var t=0,r=e.length;t<r;++t){var n=e[t];if("childList"===n.type){for(var i=0,o=(a=n.addedNodes).length;i<o;++i)(s=a[i]).nodeType===Node.ELEMENT_NODE&&(this._isGlobalSysElement(s)||this._handleDomAddedElem(s));var a;for(i=0,o=(a=n.removedNodes).length;i<o;++i){var s;(s=a[i]).nodeType===Node.ELEMENT_NODE&&(this._isGlobalSysElement(s)||this._handleDomRemovedElem(s))}}}},reactUiEvent:function(e){this.tryApplySuper("reactUiEvent",[e]);var t,r=e.getType();if(this.getMouseCaptureWidget()&&(this.isMouseEvent(r)||this.isTouchEvent(r)||this.isPointerEvent(r)))t=this.getMouseCaptureWidget();else{var n=e.getTarget();!(t=this.getBelongedResponsiveWidget(n))&&this.isKeyEvent(r)&&(t=this.getCurrFocusedWidget()||null)}if("touchstart"===r?(this._touchEventSeq=["touchstart"],this._touchDoneTimeStamp=null):"touchcancel"===r?this._touchEventSeq=[]:"touchend"===r?"touchstart"===this._touchEventSeq[0]&&(this._touchEventSeq.push("touchend"),this._touchDoneTimeStamp=Date.now()):["mousedown","mouseup","mouseover","mouseout","click"].indexOf(r)>=0&&("touchstart"===this._touchEventSeq[0]&&"touchend"===this._touchEventSeq[1]?(e.ghostMouseEvent=!0,"click"===r&&(this._touchEventSeq=[],this._touchDoneTimeStamp=Date.now())):this._touchDoneTimeStamp&&Date.now()-this._touchDoneTimeStamp<1e3&&(e.ghostMouseEvent=!0)),this.getHtmlEventDispatcher().dispatch(e),this.doReactUiEvent(e,t),!e.ghostMouseEvent&&(d.globalOptions.widget.events.forceSimulatePointerEvent||!d.BrowserFeature.pointerEvent)&&this.getEnableMouseEventToPointerPolyfill()){var i=["mousedown","mousemove","mouseout","mouseover","mouseup"].indexOf(r);if(i>=0)e.setType(["pointerdown","pointermove","pointerout","pointerover","pointerup"][i]),e.pointerType="mouse",this.doReactUiEvent(e,t);else if(["touchstart","touchmove","touchleave","touchend","touchcancel"].indexOf(r)>=0){var o=this.mapTouchToPointerEvent(e);o&&this.reactUiEvent(o)}}},doReactUiEvent:function(e,t){var r=d.Widget.getEventHandleFuncName(e.getType());this[r]&&this[r](e),t&&(this._htmlEventOnWidgetInvoked(t,e),t.reactUiEvent(e))},reactTouchGesture:function(e){var t=d.Widget.getTouchGestureHandleFuncName(e.getType&&e.getType()||e.type);this[t]&&this[t](e);var r=d.Widget.getBelongedWidget(e.target);r&&r.reactTouchGesture(e)},reactWindowResize:function(e){for(var t=this.getAutoResizeWidgets(),r=0,n=t.length;r<n;++r)t[r].isShown()&&t[r].autoResizeToClient()},_htmlEventOnWidgetInvoked:function(e,t){this.invokeEvent("htmlEventOnWidget",{widget:e,htmlEvent:t}),this.invokeEvent(t.getType(),{widget:e,htmlEvent:t})},_startPointerHolderTimer:function(e){var t=this;return this._pointerHolderTimer={pointerType:e.pointerType,button:e.getButton(),coord:{x:e.getClientX(),y:e.getClientY()},target:e.getTarget(),_timeoutId:setTimeout((function(){var r=e;r.setType("pointerhold"),t._pointerHolderTimer=null,t.reactUiEvent(r)}),d.Widget._PointerHoldParams.DURATION_THRESHOLD),cancel:function(){clearTimeout(t._pointerHolderTimer._timeoutId),t._pointerHolderTimer=null}},this._pointerHolderTimer},react_pointerdown:function(e){if(this.hasPopupWidgets()&&!e.ghostMouseEvent&&e.getButton()===d.X.Event.MouseButton.LEFT){var t=e.getTarget();this.hidePopupWidgets(t)}this._pointerHolderTimer?e.pointerType===this._pointerHolderTimer.pointerType&&e.getButton()===this._pointerHolderTimer.button||this._pointerHolderTimer.cancel():this._startPointerHolderTimer(e)},react_pointerup:function(e){this._pointerHolderTimer&&this._pointerHolderTimer.cancel()},react_pointermove:function(e){if(this._pointerHolderTimer)if(e.getTarget()!==this._pointerHolderTimer.target)this._pointerHolderTimer.cancel();else{var t=this._pointerHolderTimer.coord,r={x:e.getClientX(),y:e.getClientY()};d.CoordUtils.getDistance(t,r)>d.Widget._PointerHoldParams.MOVEMENT_THRESHOLD&&this._pointerHolderTimer.cancel()}},react_keydown:function(e){e.getKeyCode()===d.X.Event.KeyCode.ESC&&(this.hasPopupWidgets()?this.hidePopupWidgets(null,!0):this.hasDialogWidgets()&&this.hideTopmostDialogWidget(null,!0))},react_touchstart:function(e){if(this.hasPopupWidgets()){var t=e.getTarget();this.hidePopupWidgets(t)}},react_dragstart:function(e){this._clearDraggingElems();var t=e.getTarget();if(t&&e.dataTransfer){var r=this._appendDraggingElem(t);if(e.dataTransfer.setData)try{e.dataTransfer.setData(d.Widget.DragDrop.ELEM_INDEX_DATA_TYPE,""+r)}catch(e){}var n=d.Widget.getBelongedWidget(t);n&&n.dragStart({htmlEvent:e,dataTransfer:e.dataTransfer,startingElem:t})}},react_dragend:function(e){var t=e.getTarget();if(t){var r=d.Widget.getBelongedWidget(t);r&&r.dragEnd({htmlEvent:e,dataTransfer:e.dataTransfer,startingElem:t})}this._dragDone(e)},react_dragover:function(e){var t=e.getTarget(),r=this._getNearestDragDropDestWidget(d.Widget.getBelongedWidget(t));if(r&&r.getDroppable()&&e.dataTransfer){var n=this._getElemAndWidgetInDraggingTransfer(e.dataTransfer),i={htmlEvent:e,dataTransfer:e.dataTransfer,srcElem:n.elem,srcWidget:n.widget};r.acceptDragSrc(i)&&(e.preventDefault(),r.dragOver(i))}},react_dragleave:function(e){var t=e.getTarget(),r=this._getNearestDragDropDestWidget(d.Widget.getBelongedWidget(t));if(r&&r.getDroppable()&&e.dataTransfer){var n=this._getElemAndWidgetInDraggingTransfer(e.dataTransfer),i={htmlEvent:e,dataTransfer:e.dataTransfer,srcElem:n.elem,srcWidget:n.widget};r.acceptDragSrc(i)&&r.dragLeave(i)}},react_drop:function(e){var t=e.getTarget(),r=this._getNearestDragDropDestWidget(d.Widget.getBelongedWidget(t));if(r&&r.getDroppable()){var n=this._getElemAndWidgetInDraggingTransfer(e.dataTransfer),i={htmlEvent:e,dataTransfer:e.dataTransfer,srcElem:n.elem,srcWidget:n.widget};r.acceptDragSrc(i)&&r.dragDrop(i)&&e.preventDefault()}this._dragDone(e)},_dragDone:function(e){this._clearDraggingElems();var t=e.dataTransfer;t&&(t.items?t.items.clear():t.clearData())},_getNearestDragDropDestWidget:function(e){if(!e)return null;if(e.getDroppable())return e;var t=e.getParent();return t&&this._getNearestDragDropDestWidget(t)},_getElemAndWidgetInDraggingTransfer:function(e){var t,r;if(e.getData){try{var n=e.getData(d.Widget.DragDrop.ELEM_INDEX_DATA_TYPE);if(d.ObjUtils.notUnset(n)){var i=parseInt(n)||0;t=this.getDraggingElems()[i]}}catch(e){var o=this.getDraggingElems();o&&1===o.length&&(t=o[0])}t&&(r=d.Widget.getBelongedWidget(t))}return{elem:t,widget:r}},_clearDraggingElems:function(){this.setPropStoreFieldValue("draggingElems",[])},_appendDraggingElem:function(e){var t=this.getDraggingElems();return t.push(e),t.length-1},unpreparePopupWidget:function(e){e.setPopupCaller(null),this.restoreElem(e.getElement())},preparePopupWidget:function(e,t,r){e.setPopupCaller(t);var n,i,o=e.getElement(),a=o.ownerDocument,s=t?this.getContextRootElementOfCaller(t):o.ownerDocument.body,l=this.getTopmostLayer(a,!0,s),u=o.parentNode===l,c=d.Widget.ShowHideType,h=e.getAutoAdjustSizeOnPopup();if(r===c.DROPDOWN?(i=d.StyleUtils.isSelfOrAncestorPositionFixed(t.getElement()),n=this._calcDropDownWidgetPosInfo(e,t,i)):n=this._calcPopupWidgetPosInfo(e,t,u),h&&n){var p=t||e,g=(a=p.getDocument?p.getDocument():p.ownerDocument,d.DocumentUtils.getClientVisibleBox(a)),f=g.right-g.left,m=g.bottom-g.top,C=n.rect;C.left+C.width>f+g.left&&(n.width=g.right-C.left+"px",n.widthChanged=!0),C.top+C.height>m+g.top&&(n.height=g.bottom-C.top+"px",n.heightChanged=!0)}if(u?this.moveElemToTopmostLayer(o,!0,s):this.moveElemToTopmostLayer(o,null,s),n){var y=["left","top","right","bottom"];n.widthChanged&&y.push("width"),n.heightChanged&&y.push("height");var _={},E=o.style;r===c.DROPDOWN&&i?E.position="fixed":d.StyleUtils.isAbsOrFixPositioned(o)||(E.position="absolute");for(var T=0,O=y.length;T<O;++T){var v=y[T],S=n[v];S&&(_[v]=E[v]||"",E[v]=S)}this._getElemStoredInfo(o).styles=_}},_calcPopupWidgetPosInfo:function(e,t,r){var n,i=d.HtmlElementUtils,o=e.getElement();e.isShown()||(o.style.visible="hidden",o.style.display="");var a,s=!1;if(!d.DomUtils.isInDomTree(o,null,{acrossShadowRoot:!0})){var l=t?this.getContextRootElementOfCaller(t):o.ownerDocument.body;(a=this.getIsolatedLayer(e.getDocument(),!0,l)).appendChild(o),s=!0}var u=i.getElemBoundingClientRect(o,!0);return n={rect:u},r||"fixed"!==d.StyleUtils.getComputedStyle(o,"position")&&(n.top=u.top+"px",n.left=u.left+"px"),s&&a.removeChild(o),n},_calcDropDownWidgetPosInfo:function(e,t,r){var n=d.HtmlElementUtils,i=d.Widget.Position,o=t.getDropPosition?t.getDropPosition():null,a=t.getParent(),s=a&&a.getLayout()||d.Widget.Layout.HORIZONTAL,l=t.getElement(),u=this.getContextRootElementOfCaller(t),c=n.getElemBoundingClientRect(l,!0),h=d.DocumentUtils.getClientVisibleBox(t.getDocument()),p=e.getElement();p.style.visible="hidden",p.style.display="";var g=this.getIsolatedLayer(p.ownerDocument,!0,u);g.appendChild(p),p.style.position="relative";var f=n.getElemOffsetDimension(p),m=n.getElemScrollDimension(p),C=n.getElemPageRect(p,!0);if(p.style.position="absolute",g.removeChild(p),!o||o===i.AUTO)if(o=0,s===d.Widget.Layout.VERTICAL){var y=c.x-h.left,_=h.right-c.x-c.width;_>=f.width?o|=i.RIGHT:o|=y>_?i.LEFT:i.RIGHT}else{var E=c.y-h.top,T=h.bottom-c.y-c.height;T>=f.height?o|=i.BOTTOM:o|=E>T?i.TOP:i.BOTTOM}d.StyleUtils,c=n.getElemBoundingClientRect(l,!r);var O,v,S=m.width,b=m.height;if(o&i.LEFT)O=c.left-C.width;else if(o&i.RIGHT)O=c.right;else{var A=c.right-h.left;O=h.right-c.left>=C.width?c.left:A>=C.width?c.right-C.width:Math.max(h.left,h.right-C.width)}if(o&i.TOP)v=c.top-C.height;else if(o&i.BOTTOM)v=c.bottom;else{var I=c.bottom-h.top;v=h.bottom-c.top>=C.height?c.bottom:I>=C.height?c.bottom-C.height:Math.max(h.top,h.bottom-C.height)}var R={};return R.rect={left:O,top:v,width:S,height:b},O+="px",v+="px",S+="px",b+="px",R.left=O,R.top=v,R.width=S,R.height=b,R},_fillPersistentPopupWidgetsInHidden:function(e,t,r,n){var i,o,a;n.push(e);try{e&&e instanceof d.Widget.BaseWidget?(i=e.getElement(),o=e.getParent(),a=e.getPopupCaller()):i=e instanceof HTMLElement?e:null}catch(e){i=null}if(i){for(var s=0,l=t.length;s<l;++s){var u=t[s];if(u===e)r.push(u);else{var c=u.getElement();d.DomUtils.isDescendantOf(i,c)&&r.push(u)}}o&&n.indexOf(o)<=0&&this._fillPersistentPopupWidgetsInHidden(o,t,r,n),a&&n.indexOf(a)<=0&&this._fillPersistentPopupWidgetsInHidden(a,t,r,n)}},hidePopupWidgets:function(e,t){var r=this.getPopupWidgets(),n=d.Widget.getBelongedWidget(e),i=[];n&&this._fillPersistentPopupWidgetsInHidden(n,r,i,[]);for(var o=r.length-1;o>=0;--o){var a=r[o],s=a.getElement();if(s){if(i.indexOf(a)>=0)continue;e&&(s===e||d.DomUtils.isDescendantOf(e,s))||(t?a.dismiss():a.hide())}else d.ArrayUtils.remove(this.getPopupWidgets(),a)}},hideTopmostDialogWidget:function(e,t){var r=this.getDialogWidgets()||[],n=r[r.length-1];n&&(n.getElement()?t?n.dismiss():n.hide():d.ArrayUtils.remove(this.geDialogWidgets(),n))},registerPopupWidget:function(e){e.addClassName(r.SHOW_POPUP),d.ArrayUtils.pushUnique(this.getPopupWidgets(),e)},unregisterPopupWidget:function(e){e.removeClassName(r.SHOW_POPUP),d.ArrayUtils.remove(this.getPopupWidgets(),e)},registerDialogWidget:function(e){e.addClassName(r.SHOW_DIALOG),d.ArrayUtils.pushUnique(this.getDialogWidgets(),e)},unregisterDialogWidget:function(e){e.removeClassName(r.SHOW_DIALOG),d.ArrayUtils.remove(this.getDialogWidgets(),e)},registerModalWidget:function(e){var t=this.getCurrModalWidget();t&&t.removeClassName(r.SHOW_ACTIVE_MODAL),d.ArrayUtils.pushUnique(this.getModalWidgets(),e),e.addClassName(r.SHOW_ACTIVE_MODAL)},unregisterModalWidget:function(e){e.removeClassName(r.SHOW_ACTIVE_MODAL),d.ArrayUtils.remove(this.getModalWidgets(),e);var t=this.getCurrModalWidget();t&&t.addClassName(r.SHOW_ACTIVE_MODAL)},getCurrModalWidget:function(){var e=this.getModalWidgets();return e&&e.length?e[0]:null},prepareModalWidget:function(e,t){var n=e.getDocument(),i=this.getModalBackgroundElem();i||((i=n.createElement("div")).className=r.MODAL_BACKGROUND,this.setPropStoreFieldValue("modalBackgroundElem",i),this._globalSysElems.push(i));var o=e.getElement();e.setModalInfo({oldParent:o.parentNode,oldSibling:o.nextSibling}),o.parentNode&&o.parentNode.removeChild(o),i.parentNode&&i.parentNode.removeChild(i);var a=t?this.getContextRootElementOfCaller(t):o.ownerDocument.body,s=this.getTopmostLayer(n,!1,a);s&&s.parentNode===a?(a.insertBefore(i,s),a.insertBefore(o,s)):(a.appendChild(i),a.appendChild(o)),this.registerModalWidget(e)},unprepareModalWidget:function(e){e.getDocument(),this.unregisterModalWidget(e);var t=e.getElement().parentNode;t&&t.removeChild(e.getElement());var r=e.getModalInfo();r&&(r.oldParent&&r.oldParent.insertBefore(e.getElement(),r.oldSibling),e.setModalInfo(null));var n=this.getCurrModalWidget(),i=this.getModalBackgroundElem();i&&(n?(i.parentNode&&i.parentNode.removeChild(i),n.getElement().parentNode.insertBefore(i,n.getElement())):i.parentNode&&i.parentNode.removeChild(i))},registerAutoResizeWidget:function(e){d.ArrayUtils.pushUnique(this.getAutoResizeWidgets(),e)},unregisterAutoResizeWidget:function(e){d.ArrayUtils.remove(this.getAutoResizeWidgets(),e)},getWidgetContextRootElement:function(e){return e&&e.getDocument?e.getDocument().body:this._document.body},getContextRootElementOfCaller:function(e){return e instanceof d.Widget.BaseWidget?this.getWidgetContextRootElement(e):e.ownerDocument?e.ownerDocument.body:this._document.body},getTopmostLayer:function(e,t,r){e=r.ownerDocument;var n=r[this.TOPMOST_LAYER_FIELD];return n||t&&(n=this._createTopmostLayer(e,r),r.appendChild(n),r[this.TOPMOST_LAYER_FIELD]=n,this._globalSysElems.push(n)),n},_createTopmostLayer:function(e,t){var n=e.createElement("div");return n.className=r.TOP_LAYER,n},getIsolatedLayer:function(e,t,r){var n=r[this.ISOLATED_LAYER_FIELD];if(!n&&t){n=this._createIsolatedLayer(e,r),this._globalSysElems.push(n);var i=r.firstChild;i?r.insertBefore(n,i):r.appendChild(n),r[this.ISOLATED_LAYER_FIELD]=n}return n},_createIsolatedLayer:function(e,t){var n=e.createElement("div");return n.className=r.ISOLATED_LAYER,n},_isGlobalSysElement:function(e){return this._globalSysElems.indexOf(e)>=0},_getElemStoredInfo:function(e){var t=null;return e&&((t=e[this.INFO_FIELD])||(t={},e[this.INFO_FIELD]=t)),t},_clearElemStoredInfo:function(e){e[this.INFO_FIELD]&&(e[this.INFO_FIELD]=void 0)},moveElemToTopmostLayer:function(e,t,r){if(!t){var n=this._getElemStoredInfo(e);n.parentElem=e.parentNode,n.nextSibling=e.nextSibling}this.getTopmostLayer(e.ownerDocument,!0,r).appendChild(e)},restoreElem:function(e){if(e){var t=this._getElemStoredInfo(e);if(t){for(var r=t.styles,n=d.ObjUtils.getOwnedFieldNames(r),i=e.style,o=0,a=n.length;o<a;++o){var s=n[o],l=r[s];l?i[s]=l:d.StyleUtils.removeStyleProperty(i,s)}t.parentElem&&(t.nextSibling?t.parentElem.insertBefore(e,t.nextSibling):t.parentElem.appendChild(e)),e[this.INFO_FIELD]=null}}}}),d.ClassUtils.makeSingleton(d.Widget.GlobalManager),d.Widget.globalManager=d.Widget.GlobalManager.getInstance()}(),function(){"use strict";var e,t=function(){var e=["monospace","sans-serif","serif"],t=document.getElementsByTagName("body")[0],r=document.createElement("span");r.style.fontSize="72px",r.innerHTML="mmmmmmmmmmlli";var n={},i={};for(var o in e)r.style.fontFamily=e[o],t.appendChild(r),n[e[o]]=r.offsetWidth,i[e[o]]=r.offsetHeight,t.removeChild(r);this.detect=function(o){var a=!1;for(var s in e){r.style.fontFamily=o+","+e[s],t.appendChild(r);var l=r.offsetWidth!=n[e[s]]||r.offsetHeight!=i[e[s]];t.removeChild(r),a=a||l}return a}};d.Widget.FontDetector={detect:function(r){var n=e;return n||(n=new t,e=n),n.detect(r)}};var r=["Arial, Helvetica, sans-serif","Georgia, Times New Roman, Times, serif","Courier New, Courier, monospace","Tahoma, Geneva, sans-serif","Trebuchet MS, Arial, Helvetica, sans-serif","Arial Black, Gadget, sans-serif","Palatino Linotype, Book Antiqua, Palatino, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","MS Serif, New York, serif","Lucida Console, Monaco, monospace","Comic Sans MS, cursive"];d.Widget.FontEnumerator={getAvailableFontFamilies:function(e){e||(e=r);for(var t=[],n=0,i=e.length;n<i;++n){var o=e[n];d.Widget.FontDetector.detect(o)&&t.push(o)}return t}}}(),function(){"use strict";var e=d.ObjUtils;d.globalOptions.add("widget.shortcut",{enabled:!0}),d.Widget.KeyboardUtils={DEF_COMBINATION_KEY_DELIMITER:"+",_initShiftKeyMap:function(){for(var e=[["`","~"],["1","!"],["2","@"],["3","#"],["4","$"],["5","%"],["6","^"],["7","&"],["8","*"],["9","("],["0",")"],["-","_"],["=","+"],["[","{"],["]","}"],[";",":"],["'",'"'],["\\","|"],[",","<"],[".",">"],["/","?"]],t={},r=0,n=e.length;r<n;++r)t[e[r][0]]=e[r][1],t[e[r][1]]=e[r][0];return t},isPrintableKey:function(e){return!!e&&e.length<=1},getShiftedKey:function(e){if(e&&e.length<=1){var t=e.charAt(0);return t>="a"&&t<="z"?t.toUpperCase():t>="A"&&t<="Z"?t.toLowerCase():d.Widget.KeyboardUtils._shiftKeyMap[t]||t}return e},shortcutLabelToKeyParams:function(e,t,r){for(var n,i,o=t?[t]:["+","-","_"],a=-1,s=0,l=o.length;s<l;++s){var d=o[s],u=e.split(d);u.length>a&&(n=d,a=u.length,i=u)}var c={};if(a<=0)c.key=n;else for(s=0,l=i.length;s<l;++s){var h=i[s];h||s!==l-1||(h=n);var p=h.toLowerCase();"shift"===p?c.shiftKey=!0:"alt"===p?c.altKey=!0:"ctrl"===p||"control"===p?c.ctrlKey=!0:"meta"===p?c.metaKey=!0:c.key="esc"===p?"Escape":"del"===p?"Delete":"ins"===p?"Insert":"pgup"===p?"PageUp":"pgdown"===p||"pgdn"===p?"PageDown":"space"===p?" ":h,c.key||s!==l-1||(c.key="ctrl"===p?"Control":h)}return!r&&c.key&&(c.key=c.key.charAt(0).toUpperCase()+c.key.substr(1)),c},keyParamsToShortcutLabel:function(e,t,r){t||(t=d.Widget.KeyboardUtils.DEF_COMBINATION_KEY_DELIMITER);var n=[];e.ctrlKey&&n.push("Ctrl"),e.altKey&&n.push("Alt"),e.metaKey&&n.push("Meta"),e.shiftKey&&n.push("Shift");var i=e.key;if(i){"Escape"===i?i="Esc":"Insert"===i?i="Ins":"Delete"===i?i="Del":"Control"===i?i="Ctrl":" "===i&&(i="Space"),r||(i=i.charAt(0).toUpperCase()+i.substr(1));var o=n.indexOf(i);o>=0&&n.splice(o,1),n.push(i)}return n.join(t)},_standardizeEventKeyValue:function(e){return"Esc"===e?"Escape":"Del"===e?"Delete":"Spacebar"===e?" ":"Left"===e?"ArrowLeft":"Right"===e?"ArrowRight":"Up"===e?"ArrowUp":"Down"===e?"ArrowDown":"OS"===e?"Meta":"Scroll"===e?"ScrollLock":"Apps"===e?"ContextMenu":"Crsel"===e?"CrSel":"Exsel"===e?"ExSel":e},getKeyParamsFromEvent:function(e){return{altKey:e.getAltKey(),ctrlKey:e.getCtrlKey(),shiftKey:e.getShiftKey(),metaKey:e.getMetaKey(),key:d.Widget.KeyboardUtils._standardizeEventKeyValue(e.getKey()),code:e.getCode(),repeat:e.getRepeat()}},matchKeyParams:function(e,t,r){var n,i,o,a=function(e,t){return null===t||!t==!e};return a(e.altKey,t.altKey)&&a(e.ctrlKey,t.ctrlKey)&&a(e.shiftKey,t.shiftKey)&&a(e.metaKey,t.metaKey)&&(!t.key||(n=e.key,i=t.key,o=d.Widget.KeyboardUtils._standardizeEventKeyValue,r?o(i)===o(n):o(i)===o(n)||o(n)===d.Widget.KeyboardUtils.getShiftedKey(i)))&&(!t.code||t.code===e.code)&&a(e.repeat,t.repeat)}},d.Widget.KeyboardUtils._shiftKeyMap=d.Widget.KeyboardUtils._initShiftKeyMap(),d.Widget.HtmlKeyEventMatcher=Class.create(d.Widget.HtmlEventMatcher,{CLASS_NAME:"Kekule.Widget.HtmlKeyEventMatcher",initialize:function(e){var t=Object.extend({strictMatch:!0},e);this.tryApplySuper("initialize",[t])},initProperties:function(){for(var e=d.Widget.HtmlKeyEventMatcher.KEY_PARAM_PROPS,t=0,r=e.length;t<r;++t){var n="key"===e[t]||"code"===e[t]?DataType.STRING:DataType.BOOL;this._defineEventParamProp(e[t],n)}},match:function(e){var t=this.tryApplySuper("match",[e]);return t&&(t=this._matchKeyEvent(e,this.getEventParams())),t},_isKeyIgnored:function(e){return null===e},_matchKeyEvent:function(t,r){var n=this._isKeyIgnored;return(n(r.altKey)||!!t.getAltKey()==!!r.altKey)&&(n(r.ctrlKey)||!!t.getCtrlKey()==!!r.ctrlKey)&&(n(r.shiftKey)||!!t.getShiftKey()==!!r.shiftKey)&&(n(r.metaKey)||!!t.getMetaKey()==!!r.metaKey)&&(!r.key||this._matchKey(t,r.key))&&(!r.code||t.getCode()===r.code)&&(e.isUnset(r.repeat)||!!t.getRepeat()==!!r.repeat)},_matchKey:function(e,t){var r=d.Widget.KeyboardUtils._standardizeEventKeyValue,n=e.getKey();return this.getStrictMatch()?r(n)===r(t):r(n)===r(t)||n===d.Widget.KeyboardUtils.getShiftedKey(t)}}),d.Widget.HtmlKeyEventMatcher.KEY_PARAM_PROPS=["key","code","shiftKey","ctrlKey","altKey","metaKey","repeat","strictMatch"],d.Widget.Shortcut=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.Shortcut",initialize:function(e,t){var r=new d.Widget.HtmlEventResponser(new d.Widget.HtmlKeyEventMatcher({eventType:this._getKeyEventType(),strictMatch:!1}),this);this.setPropStoreFieldValue("eventResponser",r),d.ObjUtils.notUnset(t)?r.setExclusive(t):r.setExclusive(!0),e&&this.setPropStoreFieldValue("execTarget",e),this.tryApplySuper("initialize",[]),this._registeredDocs=[]},initProperties:function(){this.defineProp("strictMatch",{dataType:DataType.BOOL,getter:function(){return this.getEventResponser().getEventMatcher().getStrictMatch()},setter:function(e){this.getEventResponser().getEventMatcher().setStrictMatch(e)}}),this.defineProp("exclusive",{dataType:DataType.BOOL,getter:function(){return this.getEventResponser().getEventMatcher().getExclusive()},setter:function(e){this.getEventResponser().getEventMatcher().setExclusive(e)}}),this.defineProp("key",{dataType:DataType.STRING,getter:function(){var e=this.getEventResponser().getEventParams();return d.Widget.KeyboardUtils.keyParamsToShortcutLabel(e,null,this.getStrictMatch())},setter:function(e){if(e!==this.getKey())for(var t=d.Widget.KeyboardUtils.shortcutLabelToKeyParams(e,null,this.getStrictMatch()),r=this.getEventResponser().getEventParams(),n=d.Widget.HtmlKeyEventMatcher.KEY_PARAM_PROPS,i=d.ObjUtils.notUnset,o=0,a=n.length;o<a;++o){var s=n[o];i(t[s])&&(r[s]=t[s])}}}),this.defineProp("execTarget",{dataType:DataType.VARIANT,serializable:!1,setter:null}),this.defineProp("targetWidget",{dataType:"Kekule.Widget.BaseWidget",setter:null,serializable:!1,getter:function(){var e=this.getExecTarget();return e&&e instanceof d.Widget.BaseWidget?e:null}}),this._defineEventResponserRelatedProp("eventParams",DataType.HASH),this.defineProp("eventResponser",{dataType:"Kekule.Widget.HtmlEventResponser",serializable:!1,setter:null})},doFinalize:function(){this.unregisterFromAll();var e=this.getEventResponser();this.setPropStoreFieldValue("eventResponser",null),e.finalize(),this.tryApplySuper("doFinalize")},_defineEventResponserRelatedProp:function(e,t,r){var n=e||r;return this.defineProp(e,{dataType:t,serializable:!1,getter:function(){return this.getEventResponser().getPropValue(n)},setter:function(e){this.getEventResponser().setPropValue(n,e)}})},_getKeyEventType:function(){return"keydown"},execute:function(e){if(d.globalOptions.widget.shortcut.enabled){var t=this.getExecTarget();return t&&this.doExecTarget(e,t),this.invokeEvent({htmlEvent:e,execTarget:t}),!0}return!1},doExecTarget:function(e,t){var r=!0;return DataType.isFunctionValue(t)?t.apply(null,[e,this]):t.execute&&DataType.isFunctionValue(t.execute)?DataType.isObjectExValue(t)?t instanceof d.Widget.BaseWidget?t.execute(e):t instanceof d.Action?t.execute(this,e):t.execute(e,this):t.execute(e,this):r=!1,r},registerToGlobal:function(e){var t=e||d.$document;t&&this._registeredDocs.indexOf(t)<0&&(d.Widget.Utils.getGlobalManager(t).registerHtmlEventResponser(this.getEventResponser()),d.ArrayUtils.pushUnique(this._registeredDocs,t))},unregisterFromGlobal:function(e){var t=e||d.$document;t&&this._registeredDocs.indexOf(t)>=0&&(d.Widget.Utils.getGlobalManager(t).unregisterHtmlEventResponser(this.getEventResponser()),d.ArrayUtils.remove(this._registeredDocs,t))},unregisterFromAll:function(){for(var e=this._registeredDocs,t=0,r=e.length;t<r;++t)this.unregisterFromGlobal(e[t])}})}(),function(){"use strict";d.Widget.Clipboard=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.Clipboard",STORAGE_KEY:"__$kekule_widget_clipboard__",initialize:function(){if(this.tryApplySuper("initialize"),this._data=new d.MapEx(!0),d.BrowserFeature.localStorage){this._crossPageStorage=window.localStorage,this.setEnableCrossPageClipboard(!0);var e=this;d.X.Event.addListener(window,"storage",(function(t){if(e.getEnableCrossPageClipboard()){var r=t.key,n=e._extractSessionDataType(r);n&&e.invokeEvent("setData",{dataType:n,data:e.deserializeData(t.newValue)})}}))}},finalize:function(){this._data.finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("enableCrossPageClipboard",{dataType:DataType.BOOL})},_useSessionClipboard:function(){return this.getEnableCrossPageClipboard()&&d.BrowserFeature.localStorage},_extractSessionDataType:function(e){return e.startsWith(this.STORAGE_KEY)?e.substr(this.STORAGE_KEY.length):null},serializeData:function(e){var t;if(DataType.isSimpleValue(e))t=JSON.stringify(e);else{var r={};Class.ObjSerializerFactory.getSerializer("json").save(e,r),t=JSON.stringify(r)}return t},deserializeData:function(e){var t=JSON.parse(e);return DataType.isSimpleValue(t)?t:Class.ObjSerializerFactory.getSerializer("json").load(null,t)},setData:function(e,t){if(this._useSessionClipboard()){var r,n=this.serializeData(t);try{this._crossPageStorage.setItem(this.STORAGE_KEY+e,n),r=!0}catch(e){d.warn(e)}r||this._data.set(e,t)}else this._data.set(e,t);return this.invokeEvent("setData",{dataType:e,data:t}),this},getData:function(e){if(this._useSessionClipboard()){var t,r;try{t=this._crossPageStorage.getItem(this.STORAGE_KEY+e),r=!0}catch(e){d.warn(e)}if(r)return t?this.deserializeData(t):null}return this._data.get(e)},hasData:function(e){if(this._useSessionClipboard()){var t,r;try{t=this._crossPageStorage.getItem(this.STORAGE_KEY+e),r=!0}catch(e){d.warn(e)}if(r)return d.ObjUtils.notUnset(t)}return d.ObjUtils.notUnset(this._data.get(e))},clearData:function(){if(this._useSessionClipboard())for(var e=this.getTypes(),t=0,r=e.length;t<r;++t)this._crossPageStorage.removeItem(this.STORAGE_KEY+e[t]);else this._data.clear();return this.invokeEvent("setData",{dataType:null,data:null}),this},getTypes:function(){if(this._useSessionClipboard()){for(var e=[],t=0,r=this._crossPageStorage.length;t<r;++t){var n=this._crossPageStorage.key(t),i=this._extractSessionDataType(n);i&&e.push(i)}return e}return this._data.getKeys()},setObjects:function(e,t){for(var r=[],n=Class.ObjSerializerFactory.getSerializer("json"),i=0,o=t.length;i<o;++i){var a=t[i],s={};n.save(a,s),r.push(s)}var l=JSON.stringify(r);return this.setData(e,l)},getObjects:function(e){var t=this.getData(e);if(DataType.isSimpleValue(t)){var r=JSON.parse(t);DataType.isArrayValue(r)||(r=[r]);for(var n=[],i=Class.ObjSerializerFactory.getSerializer("json"),o=0,a=r.length;o<a;++o){var s=r[o],l=i.load(null,s);n.push(l)}return n}return t}}),d.ClassUtils.makeSingleton(d.Widget.Clipboard),d.Widget.clipboard=d.Widget.Clipboard.getInstance()}(),function(){d.Widget.EvokeMode={ALWAYS:0,EVOKEE_CLICK:1,EVOKEE_MOUSE_ENTER:2,EVOKEE_MOUSE_LEAVE:3,EVOKEE_MOUSE_DOWN:4,EVOKEE_MOUSE_UP:5,EVOKEE_MOUSE_MOVE:6,EVOKEE_TOUCH:7,EVOKER_CLICK:11,EVOKER_MOUSE_ENTER:12,EVOKER_MOUSE_LEAVE:13,EVOKER_MOUSE_DOWN:14,EVOKER_MOUSE_UP:15,EVOKER_MOUSE_MOVE:16,EVOKER_TOUCH:17,EVOKEE_TIMEOUT:21,EVOKER_TIMEOUT:22};var e=d.Widget.EvokeMode;d.Widget.DynamicEvokeHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.DynamicEvokeHelper",evokeEvents:["click","mouseenter","mouseleave","mousedown","mouseup","touchstart"],DEF_TIMEOUT:5e3,initialize:function(e,t,r,n,i){this.tryApplySuper("initialize"),this._timeoutRevokeHandle=null,this.reactEvokeEventsBind=this.reactEvokeEvents.bind(this),this.checkTimeoutRevokeBind=this.checkTimeoutRevoke.bind(this),this.setTimeout(i||this.DEF_TIMEOUT),this.setPropStoreFieldValue("evokeModes",r||[]),this.setPropStoreFieldValue("revokeModes",n||[]),this.linkWidgets(e,t)},finalize:function(){this.unlinkWidgets(this.getEvokee(),this.getEvoker()),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("evokee",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("evoker",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("evokeModes",{dataType:DataType.ARRAY}),this.defineProp("revokeModes",{dataType:DataType.ARRAY}),this.defineProp("timeout",{dataType:DataType.INT}),this.defineProp("showHideType",{dataType:DataType.INT})},evoke:function(){this.getEvoker()&&(clearTimeout(this._timeoutRevokeHandle),this.getEvoker().show(this.getEvokee(),null,this.getShowHideType()),this.postponeTimeoutCheck())},revoke:function(){this.getEvoker()&&(clearTimeout(this._timeoutRevokeHandle),this.getEvoker().getDocument().body.focus(),this.getEvoker().hide(this.getEvokee(),null,this.getShowHideType()))},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]),d.ArrayUtils.intersect(e,["evokeModes","revokeModes"]).length>0&&this.evokeModesChanged()},linkWidgets:function(e,t){this.setPropStoreFieldValue("evokee",e),this.setPropStoreFieldValue("evoker",t),this.installEventHandlers(e,this.evokeEvents,this.reactEvokeEventsBind),this.installEventHandlers(t,this.evokeEvents,this.reactEvokeEventsBind),this.updateOnAlwaysMode()},unlinkWidgets:function(e,t){this.uninstallEventHandlers(e,this.evokeEvents,this.reactEvokeEventsBind),this.uninstallEventHandlers(t,this.evokeEvents,this.reactEvokeEventsBind)},installEventHandlers:function(e,t,r){for(var n=0,i=t.length;n<i;++n)e.addEventListener(t[n],r)},uninstallEventHandlers:function(e,t,r){for(var n=0,i=t.length;n<i;++n)e.removeEventListener(t[n],r)},evokeModesChanged:function(){this.updateOnAlwaysMode()},updateOnAlwaysMode:function(){this.getEvokeModes().indexOf(e.ALWAYS)>=0?this.evoke():this.getRevokeModes().indexOf(e.ALWAYS)>=0&&this.revoke()},checkTimeoutRevoke:function(t){if(this.getEvoker()){var r=d.DomUtils,n=this.getEvoker().getDocument().activeElement,i=this.getRevokeModes(),o=[];i.indexOf(e.EVOKEE_TIMEOUT)>=0&&o.push(this.getEvokee().getElement()),i.indexOf(e.EVOKER_TIMEOUT)>=0&&o.push(this.getEvoker().getElement());for(var a=!1,s=0,l=o.length;s<l;++s){var u=o[s];if(n===u||r.isDescendantOf(n,u)){a=!0;break}}a?this.postponeTimeoutCheck():this.revoke()}},postponeTimeoutCheck:function(){if(this.hasTimeoutMode(this.getRevokeModes())){if(this.getEvokeModes().indexOf(e.ALWAYS)>=0)return;this._timeoutRevokeHandle=setTimeout(this.checkTimeoutRevokeBind,this.getTimeout())}},hasTimeoutMode:function(t){return d.ArrayUtils.intersect([e.EVOKEE_TIMEOUT,e.EVOKER_TIMEOUT],t).length>0},getEventTypeOfMode:function(t){switch(t){case e.EVOKEE_CLICK:case e.EVOKER_CLICK:return"click";case e.EVOKEE_MOUSE_ENTER:case e.EVOKER_MOUSE_ENTER:return"mouseenter";case e.EVOKEE_MOUSE_LEAVE:case e.EVOKER_MOUSE_LEAVE:return"mouseleave";case e.EVOKEE_MOUSE_DOWN:case e.EVOKER_MOUSE_DOWN:return"mousedown";case e.EVOKEE_MOUSE_UP:case e.EVOKER_MOUSE_UP:return"mouseup";case e.EVOKEE_MOUSE_MOVE:case e.EVOKER_MOUSE_MOVE:return"mousemove";case e.EVOKEE_TOUCH:case e.EVOKER_TOUCH:return"touchstart"}},isEvokeTargetOnEvokee:function(t){return t>=e.EVOKEE_CLICK&&t<=e.EVOKEE_TOUCH},reactEvokeEvents:function(t){var r=t.htmlEvent.getType(),n=t.target;if(n===this.getEvokee()||n===this.getEvoker()){var i=t.target===this.getEvokee();if(this.getEvoker().isShown()){if(this.getEvokeModes().indexOf(e.ALWAYS)>=0)return;var o;for(a=0,s=(o=this.getRevokeModes()).length;a<s;++a)if(i===this.isEvokeTargetOnEvokee(o[a])&&r===this.getEventTypeOfMode(o[a]))return void this.revoke()}else{if(this.getRevokeModes().indexOf(e.ALWAYS)>=0)return;for(var a=0,s=(o=this.getEvokeModes()).length;a<s;++a)if(i===this.isEvokeTargetOnEvokee(o[a])&&r===this.getEventTypeOfMode(o[a]))return void this.evoke()}}}})}(),function(){"use strict";var e=d.HtmlElementUtils;d.Widget.StyleResource=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.StyleResource",initialize:function(e,t){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("name",e),t&&this.setCssClassName(t)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,setter:null}),this.defineProp("cssClassName",{dataType:DataType.STRING})},linkTo:function(t){return e.addClass(this._getElement(t),this.getCssClassName()),this},unlinkFrom:function(t){e.removeClass(this._getElement(t),this.getCssClassName())},_getElement:function(e){return e instanceof d.Widget.BaseWidget?e.getElement():e}}),d.Widget.StyleResourceManager={_resources:{},register:function(e){var r=e.getName();return r&&(t._resources[r]=e),t},unregister:function(e){var r;return"string"==typeof e?r=e:e.getName&&(r=e.getName()),r&&delete t._resources[r],t},getResource:function(e){return t._resources[e]}},d.Widget.StyleResourceNames={PREFIX:"$$",CURSOR_ROTATE:"$$cursor_rotate",CURSOR_ROTATE_NE:"$$cursor_rotate_ne",CURSOR_ROTATE_NW:"$$cursor_rotate_nw",CURSOR_ROTATE_SE:"$$cursor_rotate_se",CURSOR_ROTATE_SW:"$$cursor_rotate_sw",ICON_COLOR_PICK:"$$icon_color_pick",ICON_COLOR_NOTSET:"$$icon_color_default",ICON_COLOR_MIXED:"$$icon_color_mixed",BUTTON_YES_OK:"$$btn_yes_ok",BUTTON_NO_CANCEL:"$$btn_no_cancel",BUTTON_RESET:"$$btn_reset",BUTTON_LOAD_FILE:"$$btn_load_file",ICON_REMOVE:"$$icon_remove"};var t=d.Widget.StyleResourceManager,r=d.Widget.StyleResource,n=d.Widget.StyleResourceNames;t.register(new r(n.CURSOR_ROTATE,"K-Res-Cursor-Rotate")),t.register(new r(n.CURSOR_ROTATE_NE,"K-Res-Cursor-Rotate-NE")),t.register(new r(n.CURSOR_ROTATE_NW,"K-Res-Cursor-Rotate-NW")),t.register(new r(n.CURSOR_ROTATE_SE,"K-Res-Cursor-Rotate-SE")),t.register(new r(n.CURSOR_ROTATE_SW,"K-Res-Cursor-Rotate-SW")),t.register(new r(n.ICON_COLOR_PICK,"K-Res-Icon-Color-Pick")),t.register(new r(n.ICON_COLOR_NOTSET,"K-Res-Icon-Color-NotSet")),t.register(new r(n.ICON_COLOR_MIXED,"K-Res-Icon-Color-Mixed")),t.register(new r(n.BUTTON_YES_OK,"K-Res-Button-YesOk")),t.register(new r(n.BUTTON_NO_CANCEL,"K-Res-Button-NoCancel")),t.register(new r(n.BUTTON_RESET,"K-Res-Button-Reset")),t.register(new r(n.BUTTON_LOAD_FILE,"K-Res-Button-LoadFile")),t.register(new r(n.ICON_REMOVE,"K-Res-Icon-Remove"))}(),function(){var e=d.DomUtils;d.ArrayUtils,d.Widget.AutoLauncher=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.AutoLauncher",WIDGET_ATTRIB:"data-widget",WIDGET_ATTRIB_ALT:"data-kekule-widget",PLACEHOLDER_ATTRIB:"data-placeholder",FIELD_PARENT_WIDGET_ELEM:"__$kekule_parent_widget_elem$__",initialize:function(){this.tryApplySuper("initialize"),this._executingFlag=0,this._pendingWidgetRefMap=new d.MapEx(!0),this._pendingElems=[],this._handlingPendings=!1,this._execOnPendingBind=this._execOnPending.bind(this);var e=this;d.Widget.Utils._setWidgetRefPropFromId=function(t,r,n){if(n){var i=d.Widget.getWidgetById(n,t.getDocument());if(i)t.setPropValue(r,i);else{var o=t.getDocument().getElementById(n);o&&e.isExecuting()&&e.addPendingWidgetRefItem(o,t,r)}}}},finalize:function(){this._pendingElems=null,this._pendingWidgetRefMap=null,this.tryApplySuper("finalize")},getPendingElems:function(){return this._pendingElems},addPendingElem:function(e,t,r,n,i){this._pendingElems.push({doc:e,elem:t,parent:r,widgetClass:n,execOnChildren:i})},handlePendingElems:function(e){this._handlingPendings||(this._handlingPendings=!0,e&&this._pendingElems.push({callback:e}),this.beginExec(),setTimeout(this._execOnPendingBind,0))},_execOnPending:function(){var e=this._pendingElems.shift();if(e)try{e.elem?this.createWidgetOnElem(e.doc,e.elem,e.parent):e.callback&&setTimeout(e.callback,0)}finally{setTimeout(this._execOnPendingBind,0)}else this._handlingPendings=!1,this.endExec()},getPendingWidgetRefMap:function(){return this._pendingWidgetRefMap},addPendingWidgetRefItem:function(e,t,r){this._pendingWidgetRefMap.set(e,{widget:t,propName:r})},removePendingWidgetRefItem:function(e){this._pendingWidgetRefMap.remove(e)},handlePendingWidgetRef:function(){for(var e=this._pendingWidgetRefMap.getKeys(),t=0,r=e.length;t<r;++t){var n=e[t],i=d.Widget.getWidgetOnElem(n);if(i){var o=this._pendingWidgetRefMap.get(n);o.widget.setPropValue(o.propName,i)}this.removePendingWidgetRefItem(n)}},beginExec:function(){++this._executingFlag},endExec:function(){this._executingFlag>0&&--this._executingFlag,this._executingFlag<=0&&this.handlePendingWidgetRef()},isExecuting:function(){return this._executingFlag>0},execute:function(e,t,r){var n=d.ObjUtils.notUnset(t)?t:d.Widget.AutoLauncher.deferring;n||this.beginExec();try{"function"==typeof e.querySelector?this.executeOnElemBySelector(e.ownerDocument,e,null,n):this.executeOnElem(e.ownerDocument,e,null,n),n&&this.handlePendingElems(r)}finally{n||(this.endExec(),r&&r())}},executeOnElem:function(t,r,n,i){if(this.isElemLaunchable(r)){var o=null,a=this.getElemWidgetClass(r),s=n;if(i)a&&(this.addPendingElem(t,r,n,a,!1),s=r);else{var l=n;!l||l instanceof d.Widget.BaseWidget||(l=d.Widget.getWidgetOnElem(n)),s=(o=this.createWidgetOnElem(t,r,l,a))||r}if(i&&!a||!i&&!o||d.Widget.AutoLauncher.enableCascadeLaunch)for(var u=e.getDirectChildElems(r),c=0,h=u.length;c<h;++c){var p=u[c];this.executeOnElem(t,p,s,i)}}},executeOnElemBySelector:function(e,t,r,n){var i="["+this.WIDGET_ATTRIB+"],["+this.WIDGET_ATTRIB_ALT+"]",o=t.querySelectorAll(i);if(this.getElemWidgetClass(t)&&(o=Array.prototype.slice.call(o)).unshift(t),o&&o.length){for(var a=0,s=o.length;a<s;++a){var l=o[a],u=this._findParentCandidateElem(l,o,0,a-1);u&&(l[this.FIELD_PARENT_WIDGET_ELEM]=u)}for(a=0,s=o.length;a<s;++a)if(l=o[a],this.isElemLaunchable(l)){var c=l[this.FIELD_PARENT_WIDGET_ELEM]||null;!d.Widget.AutoLauncher.enableCascadeLaunch&&c||(n?this.addPendingElem(e,l,c,null,!1):this.createWidgetOnElem(e,l,c))}}},_findParentCandidateElem:function(e,t,r,n){for(var i=null,o=e.parentNode;o&&!i;){for(var a=n;a>=r;--a)if(o===t[a])return t[a];i||(o=o.parentNode)}return i},createWidgetOnElem:function(e,t,r,n){var i=null,o=d.Widget.getWidgetOnElem(t);if(o)return o;if(n||(n=this.getElemWidgetClass(t)),n){var a=d.Widget.AutoLauncher,s=!1;if(a.placeHolderStrategy!==a.PlaceHolderStrategies.DISABLED){var l=t.getAttribute(this.PLACEHOLDER_ATTRIB)||"";s=(s=a.placeHolderStrategy===a.PlaceHolderStrategies.EXPLICIT&&d.StrUtils.strToBool(l)||a.placeHolderStrategy===a.PlaceHolderStrategies.IMPLICIT)&&ClassEx.getPrototype(n).canUsePlaceHolderOnElem(t)}if(i=s?new d.Widget.PlaceHolder(t,n):new n(t)){var u=r;!u||u instanceof d.Widget.BaseWidget||(u=d.Widget.getWidgetOnElem(r)),u&&i.setParent(u)}}return i},isElemLaunchable:function(e){return!(e.isContentEditable&&!d.HtmlElementUtils.isFormCtrlElement(e)&&!d.Widget.AutoLauncher.enableOnEditable)},getElemWidgetClass:function(e){var t=null,r=e.getAttribute(this.WIDGET_ATTRIB);return r||(r=e.getAttribute(this.WIDGET_ATTRIB_ALT)),r&&(t=this.getWidgetClass(r)),t},getWidgetClass:function(e){return ClassEx.findClass(e)}}),d.ClassUtils.makeSingleton(d.Widget.AutoLauncher),d.Widget.autoLauncher=d.Widget.AutoLauncher.getInstance(),d.Widget.AutoLauncher.PlaceHolderStrategies={DISABLED:"disabled",IMPLICIT:"implicit",EXPLICIT:"explicit"},d.Widget.AutoLauncher.enabled=d.oneOf(d.environment.getEnvVar("kekule.widget.autoLauncher.enabled"),!0),d.Widget.AutoLauncher.enableCascadeLaunch=!0,d.Widget.AutoLauncher.enableDynamicDomCheck=!0,d.Widget.AutoLauncher.enableOnEditable=!1,d.Widget.AutoLauncher.placeHolderStrategy=d.Widget.AutoLauncher.PlaceHolderStrategies.EXPLICIT,d.Widget.AutoLauncher.deferring=!1,d.Widget.WidgetsReady={isReady:!1,funcs:[],ready:function(e){t.isReady?e():t.funcs.push(e)},fireReady:function(){if(!t.isReady){t.isReady=!0;for(var e=t.funcs;e.length;)e.shift()()}}};var t=d.Widget.WidgetsReady;d.Widget.ready=t.ready;d.X.domReady((function e(){if(!e.done)if(d._isLoaded()){var r=d.Widget.AutoLauncher.deferring?function(){d.X.DomReady.resume()}:null,n=function(){try{t.fireReady()}finally{r&&r()}};d.Widget.AutoLauncher.enabled?(d.Widget.AutoLauncher.deferring&&d.X.DomReady.suspend(),d.Widget.autoLauncher.execute(document.body,null,n)):n(),d.X.MutationObserver?new d.X.MutationObserver((function(e){if(d.Widget.AutoLauncher.enableDynamicDomCheck&&d.Widget.AutoLauncher.enabled)for(var t=0,r=e.length;t<r;++t){var n=e[t];if("childList"===n.type)for(var i=n.addedNodes,o=0,a=i.length;o<a;++o){var s=i[o];s.nodeType===Node.ELEMENT_NODE&&d.Widget.autoLauncher.execute(s)}}})).observe(document.body,{childList:!0,subtree:!0}):d.X.Event.addListener(document,"DOMNodeInserted",(function(e){if(d.Widget.AutoLauncher.enableDynamicDomCheck&&d.Widget.AutoLauncher.enabled){var t=e.getTarget();t.nodeType===(Node.ELEMENT_NODE||1)&&d.Widget.autoLauncher.execute(t)}})),e.done=!0}else d._ready(e)}))}(),function(){var e=d.Widget.Direction,t=d.StyleUtils,r=d.ArrayUtils;d.Widget.BaseTransition=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseTransition",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("element",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("caller",{dataType:DataType.OBJECT,serializable:!1})},canExecute:function(e,t){return!0},prepare:function(e,t,r){},finish:function(e,t,r){},execute:function(e,t,r,n){this.setElement(e),t&&this.setCaller(t);var i=Object.extend({from:0,to:1},n),o=this,a=function n(){n.__$applied__||(n.__$applied__=!0,o.finish(e,t,i),r&&r(),o.invokeEvent("finish"))};a.__$applied__=!1,this.prepare(e,t,i),this.invokeEvent("execute"),o=this;var s={element:e,caller:t,callback:r,doneCallback:a,options:n,executor:this,halt:function(){o.halt(s)}};return this.doExecute(e,t,a,i),s},doExecute:function(e,t,r,n){},halt:function(e){e.executor!==this?e.executor.halt(e):(this.doHalt(e),e.doneCallback&&e.doneCallback(),this.invokeEvent("halt"))},doHalt:function(e){},setElementProp:function(e,t,r){},storeCssInlineValues:function(e,t){for(var r=e.style,n={},i=0,o=t.length;i<o;++i){var a=t[i];n[a]=r[a]}return n},restoreCssInlineValues:function(e,t,r){for(var n=e.style,i=0,o=t.length;i<o;++i){var a=t[i];if(r[a])n[a]=r[a];else try{n.removeProperty(a)}catch(e){n[a]=""}}},storeCssComputedValues:function(e,r){for(var n={},i=0,o=r.length;i<o;++i){var a=r[i],s=t.getComputedStyle(e,a);n[a]=s}return n}}),d.Widget.Css3TransitionRunner=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.Css3TransitionRunner",initProperties:function(){this.defineProp("parent",{dataType:"Kekule.Widget.BaseTransition"})},getCaller:function(){var e=this.getParent();return e&&e.getCaller()},getElement:function(){var e=this.getParent();return e&&e.getElement()},getAffectedCssPropNames:function(e){return[]},getTransCssPropNames:function(e){return[]},prepare:function(e,t,r){},setElementProp:function(e,t,r){}}),d.Widget.Css3OpacityTransRunner=Class.create(d.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3OpacityTransRunner",getAffectedCssPropNames:function(e){return["opacity"]},getTransCssPropNames:function(e){return["opacity"]},prepare:function(e,t,r){},setElementProp:function(e,t,r){var n=this.getParent();if(n){var i=parseFloat(n.getComputedCssValues().opacity)||1;e.style.opacity=i*t}}}),d.Widget.Css3SlideTransRunner=Class.create(d.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3SlideTransRunner",initialize:function(e){this.tryApplySuper("initialize"),d.ObjUtils.notUnset(e)&&this.setDirection(e)},initProperties:function(){this.defineProp("direction",{dataType:DataType.INT})},prepare:function(e,r,n){t.setDisplay(e,!0),this._direction=this.getActualDirection(e,n),this.tryApplySuper("prepare",[e,r,n]),e.style.overflow="hidden",this._clearDimesionConstraints(e)},_clearDimesionConstraints:function(e){var t=e.style;t.minWidth="0",t.minHeight="0",t.maxWidth="none",t.maxHeight="none"},getComputedCssValues:function(){return this.getParent().getComputedCssValues()},setElementProp:function(r,n,i){var o,a=this._direction;if(e.isInHorizontal(a)){o=this.getComputedCssValues().width;var s=t.analysisUnitsValue(o);if(r.style.width=s.value*n+s.units,o=this.getComputedCssValues().left){var l=t.analysisUnitsValue(o);l.units===s.units&&(r.style.left=s.value*(1-n)+l.value+l.units)}}if(e.isInVertical(a)){o=this.getComputedCssValues().height;var d=t.analysisUnitsValue(o);if(r.style.height=d.value*n+d.units,o=this.getComputedCssValues().top){var u=t.analysisUnitsValue(o);u.units===d.units&&(r.style.top=d.value*(1-n)+u.value+u.units)}}},getAffectedCssPropNames:function(e){var t=[].concat(this.getTransCssPropNames(e));return t.concat(["overflow","min-width","min-height","max-width","max-height"])},getTransCssPropNames:function(t){var r=this.getActualDirection(this.getElement(),t),n=[];return e.isInHorizontal(r)&&(n.push("width"),r&e.RTL&&n.push("left")),e.isInVertical(r)&&(n.push("height"),r&e.BTT&&n.push("top")),n},getRefRect:function(e){return d.Widget.TransitionUtils.getCallerRefRect(this.getCaller(),e)},getActualDirection:function(t,r){t||(t=this.getElement());var n=this.getDirection();return n&&n!==e.AUTO||(n=d.Widget.TransitionUtils.getPreferredSlideDirection(t,this.getCaller(),r)),n}}),d.Widget.Css3ClipPathSlideTransRunner=Class.create(d.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3ClipPathSlideTransRunner",initialize:function(e){this.tryApplySuper("initialize"),d.ObjUtils.notUnset(e)&&this.setDirection(e)},initProperties:function(){this.defineProp("direction",{dataType:DataType.INT})},prepare:function(e,t,r){this._direction=this.getActualDirection(e,r),this.tryApplySuper("prepare",[e,t,r])},setElementProp:function(t,r,n){var i=this._direction,o=100*(1-r)+"%",a=["0%","0%","0%","0%"];a[i===e.TTB?2:i===e.BTT?0:i===e.RTL?3:1]=o;var s="inset("+a.join(" ")+")";t.style.clipPath=s},getAffectedCssPropNames:function(e){return(this.tryApplySuper("getAffectedCssPropNames",[e])||[]).concat(["clip-path"])},getTransCssPropNames:function(e){return(this.tryApplySuper("getTransCssPropNames",[e])||[]).concat(["clip-path"])},getActualDirection:function(t,r){t||(t=this.getElement());var n=this.getDirection();return n&&n!==e.AUTO||(n=d.Widget.TransitionUtils.getPreferredSlideDirection(t,this.getCaller(),r)),n}}),d.Widget.Css3GrowTransRunner=Class.create(d.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3GrowTransRunner",initialize:function(e){this.tryApplySuper("initialize"),e&&(e.ownerDocument?this.setBaseElement(e):this.setCaller(e))},initProperties:function(){this.defineProp("baseRect",{dataType:DataType.HASH})},getRefRect:function(e){var t=d.HtmlElementUtils,r=null;return this.getBaseRect()?r=this.getBaseRect():this.getCaller()&&(r=t.getElemBoundingClientRect(this.getCaller(),!0),d.RectUtils.isZero(r)&&(r=(e||{}).callerPageRect||null)),r||(r={x:0,y:0,width:0,height:0}),r},prepare:function(e,r,n){t.setDisplay(e,!0),this.tryApplySuper("prepare",[e,r,n]),e.style.overflow="hidden",d.HtmlElementUtils.makePositioned(e);var i=this.getRefRect(n),o=d.HtmlElementUtils.getElemBoundingClientRect(e,!0),a={x:o.x-i.x,y:o.y-i.y,width:o.width-i.width,height:o.height-i.height};this._delta=a,this._clearDimesionConstraints(e)},_clearDimesionConstraints:function(e){var t=e.style;t.minWidth="0",t.minHeight="0",t.maxWidth="none",t.maxHeight="none"},setElementProp:function(e,r,n){var i,o=this.getParent().getComputedCssValues(),a=this._delta,s=1-r,l=e.style;"px"===(i=t.analysisUnitsValue(o.left)).units&&(l.left=i.value-s*a.x+"px"),"px"===(i=t.analysisUnitsValue(o.top)).units&&(l.top=i.value-s*a.y+"px"),"px"===(i=t.analysisUnitsValue(o.width)).units&&(l.width=i.value-s*a.width+"px"),"px"===(i=t.analysisUnitsValue(o.height)).units&&(l.height=i.value-s*a.height+"px")},getAffectedCssPropNames:function(e){var t=[].concat(this.getTransCssPropNames(e));return t.concat(["overflow","min-width","min-height","max-width","max-height"])},getTransCssPropNames:function(e){return["left","top","width","height","position"]}}),d.BrowserFeature&&d.BrowserFeature.cssTranform&&(d.Widget.Css3TransformTransRunner=Class.create(d.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3TransformTransRunner",getAffectedCssPropNames:function(e){return["transform","transformOrigin"]},getTransCssPropNames:function(e){return["transform","transformOrigin"]},prepare:function(e,t,r){this.tryApplySuper("prepare",[e,t,r]);var n=d.StyleUtils.getTransformMatrixValues(e);n&&(n.scaleX=n.a,n.scaleY=n.d),this._computedTransMatrixInfo=n},setElemTransform:function(e,t,r,n,i){var o=[n,0,0,i,t,r];d.StyleUtils.setTransformMatrixArrayValues(e,o)}}),d.Widget.Css3TransformGrowTransRunner=Class.create(d.Widget.Css3TransformTransRunner,{CLASS_NAME:"Kekule.Widget.Css3TransformGrowTransRunner",initialize:function(e){this.tryApplySuper("initialize"),e&&(e.ownerDocument?this.setBaseElement(e):this.setCaller(e))},initProperties:function(){this.defineProp("baseRect",{dataType:DataType.HASH})},getRefRect:function(e){var t=d.HtmlElementUtils,r=null;return this.getBaseRect()?r=this.getBaseRect():this.getCaller()&&(r=t.getElemBoundingClientRect(this.getCaller(),!0),d.RectUtils.isZero(r)&&(r=(e||{}).callerPageRect||null)),r||(r={x:0,y:0,width:0,height:0}),r},prepare:function(e,r,n){t.setDisplay(e,!0),this.tryApplySuper("prepare",[e,r,n]),e.style.overflow="hidden",d.HtmlElementUtils.makePositioned(e);var i=this.getRefRect(n),o=d.HtmlElementUtils.getElemBoundingClientRect(e,!0),a={x:o.x-i.x,y:o.y-i.y};this._translateDelta=a,this._initialScale={x:i.width/o.width,y:i.height/o.height},this._computedTransMatrixInfo?(this._endScale={x:this._computedTransMatrixInfo.scaleX,y:this._computedTransMatrixInfo.scaleY},this._endTranslate={x:this._computedTransMatrixInfo.tx,y:this._computedTransMatrixInfo.ty}):(this._endScale={x:1,y:1},this._endTranslate={x:0,y:0})},setElementProp:function(e,t,r){this.getParent().getComputedCssValues();var n=this._translateDelta,i=this._initialScale,o=this._endScale,a={x:this._endTranslate.x-(1-t)*n.x,y:this._endTranslate.y-(1-t)*n.y},s={x:t*o.x+(1-t)*i.x,y:t*o.y+(1-t)*i.y};e.style.transformOrigin="0 0 0",this.setElemTransform(e,a.x,a.y,s.x,s.y)}})),d.Widget.Css3Transition=Class.create(d.Widget.BaseTransition,{CLASS_NAME:"Kekule.Widget.Css3Transition",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("timingFunc",{dataType:DataType.STRING}),this.defineProp("childRunners",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("cssProperty",{dataType:DataType.STRING})},getRunners:function(){var e=this.getChildRunners();return e?r.toArray(e):[]},iterateRunners:function(e){for(var t=this.getRunners(),r=0,n=t.length;r<n;++r)e(t[r],r,t)},getAffectedCssPropNames:function(e){var t=[];return this.iterateRunners((function(e){var r=e.getAffectedCssPropNames()||[];t=t.concat(r)})),t},getTransCssPropNames:function(e){var t=[];return this.iterateRunners((function(e){var r=e.getTransCssPropNames()||[];t=t.concat(r)})),t},setElementProp:function(e,t,r){this.iterateRunners((function(n){n.setElementProp(e,t,r)}))},canExecute:function(e,t){return!!d.BrowserFeature.cssTransition},isSupported:function(){return!!d.BrowserFeature.cssTransition},isAppear:function(e){return!!e.isAppear},isDisappear:function(e){return!!e.isDisappear},getTransitionPropValue:function(e,t){for(var r=[t,"Webkit"+t.capitalizeFirst(),"Moz"+t.capitalizeFirst()],n=null,i=0,o=r.length;i<o&&!(n=d.StyleUtils.getComputedStyle(e,r[i]));++i);return n},setTransitionPropValue:function(e,t,r){for(var n=["Moz"+t.capitalizeFirst(),"Webkit"+t.capitalizeFirst(),t],i=0,o=n.length;i<o;++i)e[n[i]]=r},getOriginCssInlineValues:function(){return this._originCssInlineValues},getComputedCssValues:function(){return this._computedCssValues},prepare:function(e,t,r){this.tryApplySuper("prepare",[e,t,r]),this.setCssProperty(this.getTransCssPropNames(r).join(","));var n=this.getAffectedCssPropNames(r);this._affectedCssPropNames=n,this._originCssInlineValues=this.storeCssInlineValues(e,n),this._computedCssValues=this.storeCssComputedValues(e,n);var i=this;this.iterateRunners((function(n){n.setParent(i),n.prepare(e,t,r)}))},finish:function(e,t,r){(1===r.to||this.isAppear(r)||this.isDisappear(r))&&this.restoreCssInlineValues(e,this._affectedCssPropNames,this._originCssInlineValues),this.tryApplySuper("finish",[e,t,r])},doExecute:function(e,t,r,n){var i=d.StyleUtils,o=e.style;if(this.isAppear(n),this.isDisappear(n),this.isSupported()){this.setElementProp(e,n.from,n),i.isDisplayed(e)||i.setDisplay(e,!0),i.isVisible(e)||i.setVisibility(e,!0);var a,s=this.getCssProperty();this.setTransitionPropValue(o,"transitionProperty",s),(s=this.getTimingFunc()||n.timingFunc)&&this.setTransitionPropValue(o,"transitionTimingFunction",s),s=n.duration.toString()+"ms",this.setTransitionPropValue(o,"transitionDuration",s);var l=this,u=function t(n){d.X.Event.removeListener(e,"transitionend",t),l.setTransitionPropValue(o,"transition",""),a&&clearTimeout(a),r&&r()};this._currEventHandler=u,d.X.Event.addListener(e,"transitionend",u),a=setTimeout(u,n.duration+100),setTimeout((function(){l.setElementProp(e,n.to,n)}),0)}else{try{this.setElementProp(e,n.to,n)}catch(e){}r&&setTimeout(r,0)}},doHalt:function(e){var t=e.element;t&&this.setTransitionPropValue(t.style,"transitionProperty","none")}}),d.Widget.Css3Transition.createConcreteClass=function(e,t){return Class.create(d.Widget.Css3Transition,{CLASS_NAME:e,CHILD_RUNNER_CLASSES:r.toArray(t),initialize:function(){this.tryApplySuper("initialize");for(var e=[],t=0,r=this.CHILD_RUNNER_CLASSES.length;t<r;++t)e.push(new this.CHILD_RUNNER_CLASSES[t]);this.setChildRunners(e)}})},d.Widget.Css3OpacityTrans=d.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3OpacityTrans",[d.Widget.Css3OpacityTransRunner]),d.Widget.Css3ClipPathSlideTransition=d.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3ClipPathSlideTransition",[d.Widget.Css3ClipPathSlideTransRunner]),d.Widget.Css3SlideTransition=d.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3SlideTransition",[d.Widget.Css3SlideTransRunner]),d.Widget.Css3GrowTransition=d.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3GrowTransition",[d.Widget.Css3GrowTransRunner]),d.Widget.Css3ClipPathSlideOpacityTransition=d.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3ClipPathSlideOpacityTransition",[d.Widget.Css3ClipPathSlideTransRunner,d.Widget.Css3OpacityTransRunner]),d.Widget.Css3GrowOpacityTransition=d.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3GrowOpacityTransition",[d.Widget.Css3GrowTransRunner,d.Widget.Css3OpacityTransRunner]),d.Widget.Css3TransformGrowTransRunner&&(d.Widget.Css3TransformGrowTransition=d.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3TransformGrowTransition",[d.Widget.Css3TransformGrowTransRunner]),d.Widget.Css3TransformGrowOpacityTransition=d.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3TransformGrowOpacityTransition",[d.Widget.Css3TransformGrowTransRunner,d.Widget.Css3OpacityTransRunner])),d.Widget.TransitionUtils={getCallerRefRect:function(e,t){var r,n=d.HtmlElementUtils;return e?(r=n.getElemPageRect(e),d.RectUtils.isZero(r)&&(r=(t||{}).callerPageRect||null)):r=null,r},getPreferredSlideDirection:function(e,t,r){var n=d.Widget.Direction,i=d.HtmlElementUtils,o=null,a=d.Widget.TransitionUtils.getCallerRefRect(t,r);if(a){var s={x:a.x+a.width/2,y:a.y+a.height/2},l=i.getElemPagePos(e),u=i.getElemClientDimension(e),c={x:l.x+(u.width||0)/2,y:l.y+(u.height||0)/2},h=d.CoordUtils.substract(c,s);o=a.width<1?h.x>=0?n.LTR:n.RTL:h.x<1?h.y>=0?n.TTB:n.BTT:Math.abs(a.height/a.width)>Math.abs(h.y/h.x)?h.x>=0?n.LTR:n.RTL:h.y>=0?n.TTB:n.BTT}else o=n.TTB;return o}}}(),function(){d.StyleUtils,d.Widget.ShowHideManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.ShowHideManager",initialize:function(){this.tryApplySuper("initialize"),this.setEnableTransition(!0),this.setShowDuration(250),this.setHideDuration(250)},initProperties:function(){this.defineProp("enableTransition",{dataType:DataType.BOOL}),this.defineProp("transitionSelector",{dataType:"Kekule.Widget.ShowHideTransitionSelector",serializable:!1}),this.defineProp("showDuration",{dataType:DataType.INT}),this.defineProp("hideDuration",{dataType:DataType.INT})},_getCallerElement:function(e){return e?e.getElement?e.getElement():d.DomUtils.isElement(e)?e:null:null},isUsingTransition:function(){return this.getEnableTransition()&&this.getTransitionSelector()},selectTransition:function(e,t,r){var n=this.getTransitionSelector();if(!n)return null;var i=n.selectTransition(e,t,r);return i&&t&&i.setCaller(this._getCallerElement(t)),i},show:function(e,t,r,n,i){var o=Object.extend(i||{},{from:0,to:1,isAppear:!0,duration:this.getShowDuration()}),a=e.getStandaloneOnShowHide()?null:t,s=this.selectTransition(e,a,n);if(s&&this.isUsingTransition()&&s.canExecute(e.getElement(),o)){var l=this._getCallerElement(a);return s.execute(e.getElement(),l,(function(t){e.setVisible(!0,!0),e.setDisplayed(!0,!0),r&&r()}),o)}return e.setVisible(!0,!0),e.setDisplayed(!0,!0),r&&r(),null},hide:function(e,t,r,n,i,o){var a=Object.extend(o,{from:1,to:0,isDisappear:!0,duration:this.getHideDuration()}),s=(i=!!o.useVisible,e.getStandaloneOnShowHide()?null:t),l=this.selectTransition(e,s,n);return l&&this.isUsingTransition()&&l.canExecute(e.getElement(),a)?l.execute(e.getElement(),this._getCallerElement(s),(function(){e&&(i?e.setVisible(!1,!0):e.setDisplayed(!1,!0)),r&&r()}),a):(i?e.setVisible(!1,!0):e.setDisplayed(!1,!0),r&&r(),null)}}),d.ClassUtils.makeSingleton(d.Widget.ShowHideManager),d.Widget.showHideManager=d.Widget.ShowHideManager.getInstance(),d.Widget.ShowHideTransitionSelector=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.ShowHideTransitionSelector",initialize:function(){this.tryApplySuper("initialize"),this.setTransitionClassMap({})},initProperties:function(){this.defineProp("transitionClassMap",{dataType:DataType.OBJECT,serializable:!1})},_getTransClassOfType:function(e){var t=this.getTransitionClassMap();return t[e]||t[d.Widget.ShowHideType.DEFAULT]},addTransitionClass:function(e,t){this.getTransitionClassMap()[e]=t},selectTransition:function(e,t,r){var n;return d.Widget.ShowHideType,(n=t?this._getTransClassOfType(r):this._getTransClassOfType(d.Widget.ShowHideType.DEFAULT))?new n:null}});var e=new d.Widget.ShowHideTransitionSelector,t=d.Widget.ShowHideType;e.addTransitionClass(t.DEFAULT,d.Widget.Css3OpacityTrans),e.addTransitionClass(t.DROPDOWN,d.Widget.Css3ClipPathSlideOpacityTransition),e.addTransitionClass(t.POPUP,d.Widget.Css3TransformGrowOpacityTransition||d.Widget.Css3GrowOpacityTransition),e.addTransitionClass(t.DIALOG,d.Widget.Css3TransformGrowOpacityTransition||d.Widget.Css3GrowOpacityTransition),d.Widget.showHideManager.setTransitionSelector(e)}(),function(){"use strict";d.HtmlElementUtils;var e=d.X.Event,t=d.Widget.HtmlClassNames;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{RESIZEGRIPPER:"K-Resize-Gripper"});var r=Class.PropertyScope;d.Widget.ResizeGripper=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ResizeGripper",BINDABLE_TAG_NAMES:["div","span"],initialize:function(e){if(this.reactMousemoveBind=this.reactMousemove.bind(this),this.reactMouseupBind=this.reactMouseup.bind(this),this.reactTouchmoveBind=this.reactTouchmove.bind(this),this.reactTouchendBind=this.reactTouchend.bind(this),this.tryApplySuper("initialize",[e]),!this.getTarget())if(this.getParent())this.setTarget(this.getParent());else{var t=this.getElement().parentNode;t&&this.setTarget(t)}},initProperties:function(){this.defineProp("target",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){this.getTarget()!==e&&(this.setPropStoreFieldValue("target",e),this.targetChanged(e))}}),this.defineProp("retainAspectRatio",{dataType:DataType.BOOL}),this.defineProp("isUnderResizing",{dataType:DataType.BOOL,serializable:!1,setter:null,scope:r.PRIVATE}),this.defineProp("baseCoord",{dataType:DataType.HASH,serializable:!1,scope:r.PRIVATE}),this.defineProp("baseDimension",{dataType:DataType.HASH,serializable:!1,scope:r.PRIVATE}),this.defineProp("baseAspectRatio",{dataType:DataType.FLOAT,serializable:!1,scope:r.PRIVATE})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.RESIZEGRIPPER},doCreateRootElement:function(e){return e.createElement("span")},targetChanged:function(e){var t;(t=this.targetIsWidget(e)?e.getResizerElement?e.getResizerElement():e.getChildrenHolderElement():e)&&this.appendToElem(t)},targetIsWidget:function(e){return e instanceof d.Widget.BaseWidget},getTargetDimension:function(e){var t=e||this.getTarget();return this.targetIsWidget(t)?t.getDimension():d.HtmlElementUtils.getElemPageRect(t,!0)},setTargetDimension:function(e,t,r){var n=e||this.getTarget();if(this.targetIsWidget(n))n.setDimension(t,r);else{var i=n.style;i.width=t+"px",i.height=r+"px"}},prepareResizing:function(e,t){if(!this.getIsUnderResizing()){var r=this._getMoveEventReceiverElem(this.getElement());this._installEventHandlers(r),this._setMouseCapture(this.getElement(),!0,t),this.setBaseCoord(e);var n=this.getTargetDimension();this.setBaseDimension(n),this.setBaseAspectRatio(n.width/n.height),this.setPropStoreFieldValue("isUnderResizing",!0)}},doneResizing:function(e){this._setMouseCapture(this.getElement(),!1,e);var t=this._getMoveEventReceiverElem(this.getElement());this._uninstallEventHandlers(t),this.setBaseCoord(null),this.setBaseDimension(null),this.setPropStoreFieldValue("isUnderResizing",!1)},resizeTo:function(e){var t=d.CoordUtils.substract(e,this.getBaseCoord()),r=this.getBaseDimension(),n=r.width+t.x,i=r.height+t.y;if(this.getRetainAspectRatio()){var o=this.getBaseAspectRatio();n/i>o?n=o*i:n/i<o&&(i=n/o)}this.setTargetDimension(this.getTarget(),n,i)},reactMousemove:function(e){if(this.getIsUnderResizing()){var t={x:e.getScreenX(),y:e.getScreenY()};this.resizeTo(t),e.stopPropagation(),e.preventDefault()}},reactMouseup:function(e){e.getButton()===d.X.Event.MouseButton.LEFT&&this.getIsUnderResizing()&&(this.doneResizing(e),e.preventDefault())},reactTouchmove:function(e){if(this.getIsUnderResizing()){var t={x:e.getScreenX(),y:e.getScreenY()};this.resizeTo(t),e.stopPropagation(),e.preventDefault()}},reactTouchend:function(e){this.getIsUnderResizing()&&(this.doneResizing(e),e.preventDefault())},_elemSupportCapture:function(e){return!!e.setCapture},_setMouseCapture:function(e,t,r){e&&(t?(e.setCapture&&e.setCapture(!0),e.setPointerCapture&&d.ObjUtils.notUnset(r.pointerId)&&e.setPointerCapture(r.pointerId)):(e.releaseCapture&&e.releaseCapture(),e.releasePointerCapture&&d.ObjUtils.notUnset(r.pointerId)&&e.releasePointerCapture(r.pointerId)))},_getMoveEventReceiverElem:function(e){return this._elemSupportCapture(e)?e:e.ownerDocument.documentElement},_installEventHandlers:function(t){e.addListener(t,"mousemove",this.reactMousemoveBind),e.addListener(t,"touchmove",this.reactTouchmoveBind),e.addListener(t,"mouseup",this.reactMouseupBind),e.addListener(t,"touchend",this.reactTouchendBind)},_uninstallEventHandlers:function(t){e.removeListener(t,"mousemove",this.reactMousemoveBind),e.removeListener(t,"touchmove",this.reactTouchmoveBind),e.removeListener(t,"mouseup",this.reactMouseupBind),e.removeListener(t,"touchend",this.reactTouchendBind)},doReactActiviting:function(e){this.tryApplySuper("doReactActiviting",[e]);var t={x:e.getScreenX(),y:e.getScreenY()};this.prepareResizing(t,e)}}),ClassEx.extend(d.Widget.BaseWidget,{resizableChanged:function(){var e;this.getResizable()?((e=new d.Widget.ResizeGripper(this)).setRetainAspectRatio(this.getResizeWithAspectRatio()),this.setPropStoreFieldValue("resizeGripper",e)):((e=this.getResizeGripper())&&e.finalize(),this.setPropStoreFieldValue("resizeGripper",null))}}),ClassEx.defineProps(d.Widget.BaseWidget,[{name:"resizable",dataType:DataType.BOOL,setter:function(e){e!==this.getResizable()&&(this.setPropStoreFieldValue("resizable",e),this.resizableChanged())}},{name:"resizeWithAspectRatio",dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("resizeWithAspectRatio",e),this.getResizeGripper()&&this.getResizeGripper().setRetainAspectRatio(e)}},{name:"isResizing",dataType:DataType.BOOL,serializable:!1,scope:r.PRIVATE,setter:null,getter:function(){var e=this.getResizeGripper();return!!e&&e.getIsUnderResizing()}},{name:"resizeGripper",dataType:"Kekule.Widget.ResizeGripper",serializable:!1,setter:null,scope:r.PRIVATE}])}(),function(){"use strict";var e=d.HtmlElementUtils,t=d.StyleUtils,r=d.X.Event,n=Class.PropertyScope;d.Widget.MoveHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.MoveHelper",initialize:function(e,t){this.tryApplySuper("initialize"),this.reactMouseDownBind=this.reactMouseDown.bind(this),this.reactMouseUpBind=this.reactMouseUp.bind(this),this.reactMouseMoveBind=this.reactMouseMove.bind(this),this.reactTouchDownBind=this.reactTouchDown.bind(this),this.reactTouchEndBind=this.reactTouchEnd.bind(this),this.reactTouchMoveBind=this.reactTouchMove.bind(this),this.__$K_initialMoverInfo__={},this.setCssPropX("left").setCssPropY("top").setMovingCursor("move").setMovingCursorDelay(500),this.setTarget(e),this.setGripper(t),this.setEnabled(!0)},doFinalize:function(){this.setGripper(null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL}),this.defineProp("target",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("gripper",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getPropStoreFieldValue("gripper")||this.getTarget()},setter:function(e){var t=this.getPropStoreFieldValue("gripper");e!==t&&(this.setPropStoreFieldValue("gripper",e),this.gripperChanged(e,t))}}),this.defineProp("isMoving",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("cssPropX",{dataType:DataType.STRING}),this.defineProp("cssPropY",{dataType:DataType.STRING}),this.defineProp("movingCursor",{dataType:DataType.STRING}),this.defineProp("movingCursorDelay",{dataType:DataType.INT}),this.defineProp("movable",{dataType:DataType.BOOL,setter:null,getter:function(){return this.getEnabled()&&this.getGripper()}})},_objIsWidget:function(e){return e instanceof d.Widget.BaseWidget},_getElement:function(e){return this._objIsWidget(e)?e.getElement():e},getTargetElement:function(){var e=this.getTarget();return this._objIsWidget(e)?e.getElement():e},getGripperElement:function(){var e=this.getGripper();return this._objIsWidget(e)?e.getElement():e},gripperChanged:function(e,t){t&&this.installEventHandlers(this._getElement(t)),e&&this.installEventHandlers(this._getElement(e))},installEventHandlers:function(e){e&&(r.addListener(e,"mousedown",this.reactMouseDownBind),r.addListener(e,"touchstart",this.reactTouchDownBind))},uninstallEventHandlers:function(e){e&&(r.removeListener(e,"mousedown",this.reactMouseDownBind),r.removeListener(e,"touchstart",this.reactTouchDownBind))},_elemSupportCapture:function(e){return!!e.setCapture},_getMoveEventReceiverElem:function(e){return this._elemSupportCapture(e)?e:e.ownerDocument.documentElement},setMouseCapture:function(e){var t=this.getGripperElement();t&&(e?t.setCapture&&t.setCapture(!0):t.releaseCapture&&t.releaseCapture())},beginMoving:function(t){if(!this.getIsMoving()){var n=this.getTargetElement();e.makePositioned(n),this.saveInitialInformation(t);var i=this._getMoveEventReceiverElem(this.getGripperElement());r.addListener(i,"mousemove",this.reactMouseMoveBind),r.addListener(i,"touchmove",this.reactTouchMoveBind),r.addListener(i,"mouseup",this.reactMouseUpBind),r.addListener(i,"touchend",this.reactTouchEndBind),this.setMouseCapture(!0),this._setCursorHandle=this.delaySetMoveCursor(),this.setIsMoving(!0)}},endMoving:function(){this.setIsMoving(!1),this.setMouseCapture(!1);var e=this.getGripperElement(),t=this._getMoveEventReceiverElem(e);if(r.removeListener(t,"mousemove",this.reactMouseMoveBind),r.removeListener(t,"touchmove",this.reactTouchMoveBind),r.removeListener(t,"mouseup",this.reactMouseUpBind),r.removeListener(t,"touchend",this.reactTouchEndBind),this.clearCursorSetter(),e){var n=this.__$K_initialMoverInfo__.cursor;e.style.cursor=n||"",this.__$K_initialMoverInfo__.cursor=null}},moveTo:function(e){this.clearCursorSetter(),this.doSetMoveCursor();var t=this.getTargetElement();if(t){var r=this.__$K_initialMoverInfo__,n=d.CoordUtils.substract(e,r.pointerCoord);"right"===(this.getCssPropX()||"").toLowerCase()?t.style.right=r.elemCoord.x-n.x+"px":t.style.left=r.elemCoord.x+n.x+"px","bottom"===(this.getCssPropY()||"").toLowerCase()?t.style.bottom=r.elemCoord.y-n.y+"px":t.style.top=r.elemCoord.y+n.y+"px"}},delaySetMoveCursor:function(){return setTimeout(this.doSetMoveCursor.bind(this),this.getMovingCursorDelay()||0)},doSetMoveCursor:function(){var e=this.getGripperElement();e&&this.getMovingCursor()&&(e.style.cursor=this.getMovingCursor())},clearCursorSetter:function(){this._setCursorHandle&&clearTimeout(this._setCursorHandle)},saveInitialInformation:function(r){var n=this.getTargetElement();if(n){var i;this.__$K_initialMoverInfo__.pointerCoord=r;var o=(t.getComputedStyle(n,"position")||"").toLowerCase(),a=(this.getCssPropX()||"left").toLowerCase(),s=(this.getCssPropY()||"top").toLowerCase();"relative"===o?(i={x:t.analysisUnitsValue(t.getComputedStyle(n,"left")).value||0,y:t.analysisUnitsValue(t.getComputedStyle(n,"top")).value||0},a="left",s="top"):i={x:n.offsetLeft,y:n.offsetTop};var l=e.getElemOffsetDimension(n);"right"===a&&(i.x+=l.width),"bottom"===s&&(i.y+=l.height),this.__$K_initialMoverInfo__.elemCoord=i,this.getGripperElement()&&(this.__$K_initialMoverInfo__.cursor=this.getGripperElement().style.cursor)}},reactMouseDown:function(e){this.getTargetElement()&&this.getEnabled()&&e.getButton()===r.MouseButton.LEFT&&(this.beginMoving({x:e.getScreenX(),y:e.getScreenY()},e.getTarget()),e.preventDefault())},reactMouseUp:function(e){e.getButton()===r.MouseButton.LEFT&&this.getIsMoving()&&(this.endMoving(),e.preventDefault())},reactMouseMove:function(e){if(this.getIsMoving()){var t={x:e.getScreenX(),y:e.getScreenY()};this.moveTo(t),e.preventDefault()}},reactTouchDown:function(e){this.getEnabled()&&(this.beginMoving({x:e.getScreenX(),y:e.getScreenY()},e.getTarget()),e.preventDefault())},reactTouchEnd:function(e){this.getIsMoving()&&(this.endMoving(),e.preventDefault())},reactTouchMove:function(e){if(this.getIsMoving()){var t={x:e.getScreenX(),y:e.getScreenY()};this.moveTo(t),e.preventDefault()}}}),ClassEx.extend(d.Widget.BaseWidget,{_getMoveHelper:function(e){var t=this.getMoveHelper();return!t&&e&&(t=new d.Widget.MoveHelper(this)),t},movingGripperChanged:function(){var e,t=this.getMovingGripper();t?(e=this._getMoveHelper(!0)).setGripper(t):(e=this._getMoveHelper(!1))&&e.setGripper(null)}}),ClassEx.defineProps(d.Widget.BaseWidget,[{name:"movable",dataType:DataType.BOOL,getter:function(){return this._getMoveHelper()&&this._getMoveHelper().getMovable()},setter:function(e){if(e!==this.getMovable())if(e)this.setMovingGripper(this.getDefaultMovingGripper&&this.getDefaultMovingGripper()||this);else{var t=this._getMoveHelper();t&&t.setEnabled(!1)}}},{name:"movingGripper",dataType:DataType.OBJECT,setter:function(e){e!==this.getMovingGripper()&&(this.setPropStoreFieldValue("movingGripper",e),this.movingGripperChanged())}},{name:"isMoving",dataType:DataType.BOOL,serializable:!1,scope:n.PRIVATE,setter:null,getter:function(){var e=this.getMoveHelper();return!!e&&e.getIsMoving()}},{name:"moveHelper",dataType:"Kekule.Widget.MoveHelper",serializable:!1,setter:null,scope:n.PRIVATE}])}(),function(){var e=d.HtmlElementUtils,t=d.Widget.HtmlClassNames;d.Widget.Glyph=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Glyph",initialize:function(e,t){this._imgElem=null,this.tryApplySuper("initialize",[e]),t&&this.setNormalInfo(t)},initProperties:function(){this.defineImgInfoProp("normalInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("hoverInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("focusedInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("activeInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("disabledInfo",{dataType:DataType.HASH})},defineImgInfoProp:function(e,t){var r=Object.extend({setter:function(t){t?this.setPropStoreFieldValue(e,Object.extend({},t)):this.setPropStoreFieldValue(e,null),this.imgInfoChanged()}},t);return this.defineProp(e,r)},doGetWidgetClassName:function(){return"K-Glyph"},doCreateRootElement:function(e){return e.createElement("span")},doBindElement:function(e){this.tryApplySuper("doBindElement"),this.createImgContainer(e)},createImgContainer:function(e,r){var n=e.ownerDocument;this._imgElem=n.createElement("span"),this._imgElem.className=t.FULLFILL,e.innerHTML="",e.appendChild(this._imgElem)},imgInfoChanged:function(){this.updateImg()},stateChanged:function(){this.tryApplySuper("stateChanged"),this.updateImg()},updateImg:function(){var e=d.Widget.State,t=this.getState(),r=t===e.DISABLED?this.getDisabledInfo():t===e.ACTIVE?this.getActiveInfo()||this.getHoverInfo()||this.getFocusedInfo():t===e.HOVER?this.getHoverInfo():t===e.FOCUSED?this.getFocusedInfo():this.getNormalInfo();r=r||this.getNormalInfo(),this.showImgOfInfo(r)},showImgOfInfo:function(r){var n=this._imgElem;n&&(r?(r.className?(n.className=t.FULLFILL,e.addClass(n,r.className)):n.className=t.FULLFILL,n.style.backgroundImage=r.src?"url("+r.src+")":"",n.style.backgroundPosition=r.position||"",n.style.backgroundRepeat=r.repeat||"no-repeat"):n.style.backgroundImage="")}})}(),function(){d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{CONTAINER:"K-Container",PANEL:"K-Panel",PANEL_CAPTION:"K-Panel-Caption",TOOLBAR:"K-Toolbar"});var e=d.DomUtils,t=(d.HtmlElementUtils,d.Widget.HtmlClassNames),r=d.StyleUtils;d.Widget.Container=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Container",initialize:function(e){this._defContainerElem=null,this.tryApplySuper("initialize",[e]),this.reactShowStateChangeBind=this.reactShowStateChange.bind(this),this.addEventListener("showStateChange",this.reactShowStateChangeBind)},finalize:function(){this.removeEventListener("showStateChange",this.reactShowStateChangeBind),this.clearWidgets(),this.tryApplySuper("finalize")},initProperties:function(){this.defineChildDimensionRelatedProp("childWidth"),this.defineChildDimensionRelatedProp("childHeight"),this.defineChildDimensionRelatedProp("childMargin"),this.defineProp("firstChild",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("lastChild",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("allowChildWrap",{dataType:DataType.BOOL,serializable:!1,setter:function(e){this.setPropStoreFieldValue("allowChildWrap",e),e?this.removeClassName(t.NOWRAP):this.addClassName(t.NOWRAP)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAllowChildWrap(!0)},defineChildDimensionRelatedProp:function(e,t){var r=Object.extend({dataType:DataType.STRING,setter:function(t){this.setPropStoreFieldValue(e,t),this.updateChildSizes()}},t||{});return this.defineProp(e,r)},doGetWidgetClassName:function(){return t.CONTAINER},doCreateRootElement:function(e){return e.createElement("span")},doCreateContainerElement:function(e,r,n){var i=d.BrowserFeature.htmlSlot?d.Widget.HtmlTagNames.CHILD_HOLDER:n||"span",o=e.createElement(i);return o.className=t.CHILD_HOLDER,o},getContainerElement:function(){return this.getElement()},getChildrenHolderElement:function(){return this.getContainerElement()},appendWidget:function(e){return e.setParent(this),this},insertWidgetBefore:function(e,t){return e.insertToWidget(this,t),this},removeWidget:function(e,t){e.setParent(null),t||e.finalize()},clearWidgets:function(e){for(var t=this.getChildWidgets(),r=t.length-1;r>=0;--r){var n=t[r];this.removeWidget(n,e)}},_insertChildWidget:function(e,t){var r=t?t.getElement():null,n=this.getChildrenHolderElement();n&&(r?n.insertBefore(e.getElement(),r):n.appendChild(e.getElement()))},reactShowStateChange:function(e){this.childrenModified()},childrenModified:function(){this.tryApplySuper("childrenModified");for(var e=this.getChildWidgets(),r=e.length,n=e[o=0];n&&!n.isShown(!0)&&o<r;)n=e[++o];var i=o<r?n:null,o=r-1;for(n=e[r-1];n&&!n.isShown(!0)&&o>=0;)n=e[--o];var a=o>=0?n:null,s=this.getFirstChild(),l=this.getLastChild();i!==s&&(s&&s.removeClassName(t.FIRST_CHILD),i&&i.addClassName(t.FIRST_CHILD),this.setPropStoreFieldValue("firstChild",i)),a!==l&&(l&&l.removeClassName(t.LAST_CHILD),a&&a.addClassName(t.LAST_CHILD),this.setPropStoreFieldValue("lastChild",a))},childWidgetAdded:function(e){this.tryApplySuper("childWidgetAdded",[e]);var t=this.getChildWidth();t&&e.setWidth(t);var r=this.getChildHeight();r&&e.setHeight(r);var n=this.getChildMargin();n&&(e.getStyle().margin=n),this._insertChildWidget(e,null)},childWidgetRemoved:function(e){this.tryApplySuper("childWidgetRemoved",[e])},childWidgetMoved:function(e,t){this.tryApplySuper("childWidgetMoved",[e,t]);var r=e.getElement(),n=this.getChildWidgets()[t+1],i=n?n.getElement():null;i?this.getContainerElement().insertBefore(r,i):this.getContainerElement().appendChild(r)},updateChildSizes:function(){for(var e=this.getChildWidgets(),t=this.getChildWidth()||"",r=this.getChildHeight()||"",n=this.getChildMargin()||"",i=(this.getLayout(),0),o=e.length;i<o;++i){var a=e[i];a.setWidth(t),a.setHeight(r),a.getStyle().margin=n}}}),d.Widget.Panel=Class.create(d.Widget.Container,{CLASS_NAME:"Kekule.Widget.Panel",initProperties:function(){this.defineProp("caption",{dataType:DataType.STRING,getter:function(){return this.getCaptionElem(!1)&&e.getElementText(this.getCaptionElem())},setter:function(t){e.setElementText(this.getCaptionElem(!0),t),r.setDisplay(this.getCaptionElem(),!!t)}}),this.defineProp("captionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(r){var n=this.getPropStoreFieldValue("captionElem");if(!n&&r){(n=this.getDocument().createElement("div")).className=t.PANEL_CAPTION;var i=this.getElement();i.insertBefore(n,e.getFirstChildElem(i)),this.setPropStoreFieldValue("captionElem",n)}return n}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.PANEL}}),d.Widget.WidgetGroup=Class.create(d.Widget.Container,{CLASS_NAME:"Kekule.Widget.WidgetGroup",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!0)},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]),e.indexOf("useCornerDecoration")>=0&&this._updateChildStyles()},childWidgetAdded:function(e){e.setUseCornerDecoration&&e.setUseCornerDecoration(!1),this.tryApplySuper("childWidgetAdded",[e])},layoutChanged:function(){this.tryApplySuper("layoutChanged"),this._updateChildStyles()},childrenModified:function(){this.tryApplySuper("childrenModified"),this._updateChildStyles()},_updateChildStyles:function(){d.Widget.Layout,this.getLayout();for(var e=this.getFirstChild(),r=this.getLastChild(),n=this.getUseCornerDecoration(),i=this.getChildWidgets(),o=[t.CORNER_LEADING,t.CORNER_TAILING],a=0,s=i.length;a<s;++a){var l=i[a];l.removeClassName(o),l===e&&n&&l.addClassName(t.CORNER_LEADING),l===r&&n&&l.addClassName(t.CORNER_TAILING)}}}),d.Widget.Toolbar=Class.create(d.Widget.WidgetGroup,{CLASS_NAME:"Kekule.Widget.Toolbar",finalize:function(){var e=this.getChildWidgetInternalNameMap();e&&e.finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("childDefs",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("childDefs",e),this.recreateChildrenByDefs()}}),this.defineProp("childWidgetInternalNameMap",{dataType:DataType.OBJECT,serializable:!1})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.TOOLBAR},doSetShowText:function(e){this.tryApplySuper("doSetShowText",[e]),this._updateAllChildTextGlyphStyles()},doSetShowGlyph:function(e){this.tryApplySuper("doSetShowGlyph",[e]),this._updateAllChildTextGlyphStyles()},childWidgetAdded:function(e){this.tryApplySuper("childWidgetAdded",[e]),this._updateChildTextGlyphStyles(e)},_updateChildTextGlyphStyles:function(e){e.setShowText&&e.setShowText(this.getShowText()),e.setShowGlyph&&e.setShowGlyph(this.getShowGlyph())},_updateAllChildTextGlyphStyles:function(){for(var e=this.getChildWidgets(),t=e.length-1;t>=0;--t)this._updateChildTextGlyphStyles(e[t])},recreateChildrenByDefs:function(){var e=this.getChildDefs()||[];this.clearWidgets();var t=new d.MapEx(!0);this.setChildWidgetInternalNameMap(t);for(var r=this.getDefaultChildWidgetClassName(),n=0,i=e.length;n<i;++n){var o=e[n];o.widget||o.widgetClass||!r||(o=Object.extend({widget:r},o));var a=d.Widget.createFromHash(this,o);a&&(a.appendToWidget(this),o.internalName&&t.set(o.internalName,a))}},getDefaultChildWidgetClassName:function(){return null},getChildWidgetByInternalName:function(e){var t=this.getChildWidgetInternalNameMap();return t?t.get(e):null}})}(),function(){"use strict";var e=d.DomUtils,t=(d.HtmlElementUtils,d.Widget.HtmlClassNames);d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{MENU:"K-Menu",POPUPMENU:"K-PopupMenu",MENUBAR:"K-MenuBar",MENUITEM:"K-MenuItem",MENUITEM_NORMAL:"K-MenuItem-Normal",MENUITEM_SEPARATOR:"K-MenuItem-Separator",SUBMENU_MARKER:"K-SubMenu-Marker",CHECKMENU_MARKER:"K-CheckMenu-Marker"}),d.Widget.MenuItem=Class.create(d.Widget.Container,{CLASS_NAME:"Kekule.Widget.MenuItem",BINDABLE_TAG_NAMES:["li"],SUB_MENU_TAGS:["ol","ul"],initialize:function(e,t){this.tryApplySuper("initialize",[e]),t&&this.setText(t),this._subMenuMarker=null,this._checkMarker=null},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return d.HtmlElementUtils.getInnerText(this.getElement())},setter:function(e){e===d.Widget.MenuItem.SEPARATOR_TEXT?this.setIsSeparator(!0):(e&&this.setIsSeparator(!1),this.changeContentText(e))}}),this.defineProp("checked",{dataType:DataType.BOOL,setter:function(e){this.getPropStoreFieldValue("checked")!==e&&(this.setPropStoreFieldValue("checked",e),this.checkChanged())}}),this.defineProp("autoCheck",{dataType:DataType.BOOL}),this.defineProp("isSeparator",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("isSeparator",e),this.isSeparatorChanged(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!1),this.setIsSeparator(!1)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MENUITEM},doCreateRootElement:function(e){return e.createElement("li")},changeContentText:function(e){this.getElement().innerHTML=e||""},isSeparatorChanged:function(e){e?(this.setText("&nbsp;"),this.removeClassName(t.MENUITEM_NORMAL),this.addClassName(t.MENUITEM_SEPARATOR),this.setStatic(!0)):(this.removeClassName(t.MENUITEM_SEPARATOR),this.addClassName(t.MENUITEM_NORMAL),this.setStatic(!1))},doBindElement:function(t){this.tryApplySuper("doBindElement",[t]);for(var r=e.getDirectChildElems(t),n=0,i=r.length;n<i;++n){var o=r[n];o.nodeType===Node.ELEMENT_NODE&&this.bindSubMenu(o),o=o.nextSibling}},doDomElemAdded:function(e){d.Widget.getWidgetOnElem(e)||this.bindSubMenu(e)},checkChanged:function(){this.getChecked()?(this._createCheckMarker(),this.addClassName(t.STATE_CHECKED),this.invokeEvent("check")):this.removeClassName(t.STATE_CHECKED)},_createCheckMarker:function(){var e;return(e=this._checkMarker)||((e=this.getDocument().createElement("span")).className=t.CHECKMENU_MARKER,this.getElement().appendChild(e),this._checkMarker=e),e},_removeCheckMarker:function(){this._checkMarker&&(this._checkMarker.parentNode.removeChild(this._checkMarker),this._checkMarker=null)},childWidgetAdded:function(e){if(this.tryApplySuper("childWidgetAdded",[e]),e instanceof d.Widget.Menu)e.setIsSubMenu(!0);else if(e instanceof d.Widget.MenuItem){var t=this.getSubMenu(!0);(function(){e.setParent(t),e.appendToWidget(t)}).defer(10)}},childrenModified:function(){this.tryApplySuper("childrenModified"),this.subMenuChanged()},bindSubMenu:function(e){var t=e.tagName.toLowerCase();if("ul"===t||"ol"===t){var r=new d.Widget.PopupMenu(e);return this.addSubMenu(r),r}},subMenuChanged:function(){var e=this.getSubMenu();e?this._createSubMenuMarker(e):this._removeSubMenuMarker()},getSubMenu:function(e){for(var t=this.getChildWidgets(),r=0,n=t.length;r<n;++r){var i=t[r];if(i instanceof d.Widget.Menu)return i}return e?this.createSubMenu():null},addSubMenu:function(e){return e.appendToWidget(this),this},removeSubMenu:function(e){return e.setParent(null),e},createSubMenu:function(){var e=new d.Widget.PopupMenu(this);return this.addSubMenu(e),e},_createSubMenuMarker:function(e){var r;return(r=this._subMenuMarker)||((r=this.getDocument().createElement("span")).className=t.SUBMENU_MARKER,this.getElement().appendChild(r),this._subMenuMarker=r),r},_removeSubMenuMarker:function(){this._subMenuMarker&&(this._subMenuMarker.parentNode.removeChild(this._subMenuMarker),this._subMenuMarker=null)},isLeafItem:function(){var e=this.getElement();return!(e.getElementsByTagName("ul").length||e.getElementsByTagName("ol").length)},isPeriodicalExecuting:function(){return this.tryApplySuper("isPeriodicalExecuting")&&this.getIsActive()},doReactActiviting:function(e){this.tryApplySuper("doReactActiviting",[e]),this.isLeafItem()&&this.getEnablePeriodicalExec()&&this.startPeriodicalExec(e)},doReactDeactiviting:function(e){this.isLeafItem()&&(this.stopPeriodicalExec(),this.getIsActive()&&(this.execute(e),this.getAutoCheck()&&this.setChecked(!this.getChecked()),this.notifyDeactivated()))},notifyDeactivated:function(){var e=this.getParent();e&&e.childDeactivated&&e.childDeactivated(this)},childDeactivated:function(e){var t=this.getParent();t&&t.childDeactivated&&t.childDeactivated(this)}}),d.Widget.MenuItem.SEPARATOR_TEXT="-",d.Widget.MenuItem.createFromHash=function(e,t){var r=t;return DataType.isSimpleValue(r)&&(r=r===d.Widget.MenuItem.SEPARATOR_TEXT?{isSeparator:!0}:{text:r}),r.widget||r.widgetClass||(r.widget=d.Widget.MenuItem),d.Widget.createFromHash(e,r)},d.Widget.Menu=Class.create(d.Widget.Container,{CLASS_NAME:"Kekule.Widget.Menu",BINDABLE_TAG_NAMES:["ol","ul"],MENU_ITEM_TAG:"li",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("isSubMenu",{dataType:DataType.BOOL,serializable:!1,setter:function(e){this.setPropStoreFieldValue("isSubMenu",e),e&&this.setLayout(d.Widget.Layout.VERTICAL)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MENU},doCreateRootElement:function(e){return e.createElement("ul")},doBindElement:function(e){this.tryApplySuper("doBindElement",[e]);for(var t=d.DomUtils.getDirectChildElems(e),r=0,n=t.length;r<n;++r){var i=t[r];i.nodeType===Node.ELEMENT_NODE&&this.bindMenuItem(i),i=i.nextSibling}},doDomElemAdded:function(e){this.bindMenuItem(e)},bindMenuItem:function(e){if("li"===e.tagName.toLowerCase()){var t=new d.Widget.MenuItem(e);return t.setParent(this),t}},getSubMenuTagName:function(){return this.getElement().tagName},getMenuItems:function(t){t||(t=this.getElement());for(var r=e.getDirectChildElems(t,this.MENU_ITEM_TAG),n=[],i=0,o=r.length;i<o;++i){var a=d.Widget.getWidgetOnElem(r[i]);a&&a instanceof d.Widget.MenuItem&&n.push(a)}return n},insertMenuItem:function(e,t){return e.insertToWidget(this,t),this},appendMenuItem:function(e){return e.appendToWidget(this),this},removeMenuItem:function(e,t){e.setParent(null),t||e.finalize()},clearMenuItems:function(e){return this.clearWidgets(e),this},isTopLevel:function(){var e=this.getParent();return!e||!(e instanceof d.Widget.MenuItem||e instanceof d.Widget.Menu)},childDeactivated:function(e){var t=this.getParent();t&&t.childDeactivated&&t.childDeactivated(this)},createChildrenByDefs:function(e){for(var t=0,r=e.length;t<r;++t){var n=e[t];d.Widget.MenuItem.createFromHash(this,n)}return this}}),d.Widget.PopupMenu=Class.create(d.Widget.Menu,{CLASS_NAME:"Kekule.Widget.PopupMenu",initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(d.Widget.Layout.VERTICAL)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.POPUPMENU},childDeactivated:function(e){}}),d.Widget.MenuBar=Class.create(d.Widget.Menu,{CLASS_NAME:"Kekule.Widget.MenuBar",doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MENUBAR}})}(),function(){"use strict";var e=d.HtmlElementUtils,t=d.Widget.HtmlClassNames;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{BUTTON:"K-Button",BUTTON_KINDED:"K-Button-Kinded",BUTTON_GROUP:"K-Button-Group",COMPACT_BUTTON:"K-Compact-Button",BTN_COMPACT_MARK:"K-Compact-Mark"}),d.Widget.Button=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Button",BINDABLE_TAG_NAMES:["input","button","a","label"],CSS_DROPDOWN_CLASS_NAME:"K-DropDownMark",DEF_GLYPH_WIDTH:"16px",DEF_GLYPH_HEIGHT:"16px",initialize:function(e,t){this._elemTextPart=null,this._elemLeadingGlyphPart=null,this._elemTailingGlyphPart=null,this.tryApplySuper("initialize",[e]),t&&this.setText(t)},initProperties:function(){this.defineElemAttribMappingProp("actionType","type"),this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this._elemTextPart||this.getElement();return e?e.innerHTML:null},setter:function(e){this.changeContentText(e)}}),this.defineProp("leadingGlyph",{dataType:"Kekule.Widget.Glyph",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("leadingGlyph");return!t&&e&&(t=this._createDefaultGlyphWidget(this._elemLeadingGlyphPart),this.setPropStoreFieldValue("leadingGlyph",t)),t}}),this.defineProp("tailingGlyph",{dataType:"Kekule.Widget.Glyph",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("tailingGlyph");return!t&&e&&(t=this._createDefaultGlyphWidget(this._elemTailingGlyphPart),this.setPropStoreFieldValue("tailingGlyph",t)),t}}),this.defineProp("showLeadingGlyph",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("showLeadingGlyph",e),this._elemLeadingGlyphPart.style.display=e&&this.getShowGlyph()?"":"none"}}),this.defineProp("showTailingGlyph",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("showTailingGlyph",e),this._elemTailingGlyphPart.style.display=e&&this.getShowGlyph()?"":"none"}}),this.defineProp("buttonKind",{dataType:DataType.STRING,setter:function(e){var t=this.getButtonKind();e!==t&&(this.cancelButtonKind(t),this.applyButtonKind(e),this.setPropStoreFieldValue("buttonKind",e))}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("showText",!0),this.setPropStoreFieldValue("showGlyph",!0),this.setPropStoreFieldValue("showLeadingGlyph",!0),this.setPropStoreFieldValue("showTailingGlyph",!0),this.setPropStoreFieldValue("useCornerDecoration",!0),this.setAllowTextWrap(!1)},_createDefaultGlyphWidget:function(e){var t=new d.Widget.Glyph(this);return t.setWidth(this.DEF_GLYPH_WIDTH).setHeight(this.DEF_GLYPH_HEIGHT),t.setStatic(!0).setInheritState(!0).setInheritStatic(!0).setInheritEnabled(!0),t.appendToElem(e),t},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.BUTTON},doCreateRootElement:function(e){var t=e.createElement("button");return t.setAttribute("type","button"),t},doBindElement:function(r){this.tryApplySuper("doBindElement",[r]);var n=r.innerHTML||"";r.innerHTML="",this._elemTextPart=this.createTextContent(n,r),this._elemLeadingGlyphPart=this.createGlyphContent(r,this._elemTextPart,t.PART_PRI_GLYPH_CONTENT),this._elemTailingGlyphPart=this.createGlyphContent(r,null,t.PART_ASSOC_GLYPH_CONTENT),this.getUseCornerDecoration()&&e.addClass(r,t.CORNER_ALL)},changeContentText:function(e){this._elemTextPart.innerHTML=e||""},isPeriodicalExecuting:function(){return this.tryApplySuper("isPeriodicalExecuting")&&this.getIsActive()},doReactActiviting:function(e){this.tryApplySuper("doReactActiviting",[e]),this.getEnablePeriodicalExec()&&this.startPeriodicalExec(e)},doReactDeactiviting:function(e){this.stopPeriodicalExec(),this.getIsActive()&&this.execute(e)},cancelButtonKind:function(e){e&&(this.removeClassName(e),this.removeClassName(t.BUTTON_KINDED))},applyButtonKind:function(e){e&&(this.addClassName(t.BUTTON_KINDED),this.addClassName(e))}}),d.Widget.Button.Kinds={DROPDOWN:"K-Kind-DropDown",POPUP:"K-Kind-Popup",SEARCH:"K-Kind-Search",EDIT:"K-Kind-Edit",ENTER:"K-Kind-Enter"},d.Widget.CheckButton=Class.create(d.Widget.Button,{CLASS_NAME:"Kekule.Widget.CheckButton",initialize:function(e,t){this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("checked",{dataType:DataType.BOOL,setter:function(e){this.getPropStoreFieldValue("checked")!==e&&(this.setPropStoreFieldValue("checked",e),this.checkChanged(),this.stateChanged())}}),this.defineProp("autoCheck",{dataType:DataType.BOOL})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoCheck(!0)},checkChanged:function(){this.getChecked()?this.invokeEvent("check"):this.invokeEvent("uncheck"),this.invokeEvent("checkChange",{checked:this.getChecked()})},getStateClassName:function(e){var t=this.getChecked()?d.Widget.State.ACTIVE:e;return this.tryApplySuper("getStateClassName",[t])},doReactDeactiviting:function(e){var t=this.getChecked();this.tryApplySuper("doReactDeactiviting",[e]),this.getAutoCheck()&&this._doToggleCheckOnSelf(t)},_doToggleCheckOnSelf:function(e){this.getEnabled()&&this.setChecked(!e)}}),d.Widget.RadioButton=Class.create(d.Widget.CheckButton,{CLASS_NAME:"Kekule.Widget.RadioButton",initialize:function(e,t){this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("group",{dataType:DataType.STRING})},checkChanged:function(){this.tryApplySuper("checkChanged"),this.getChecked()&&this.uncheckSiblings()},uncheckSiblings:function(){var e=this.getParent(),t=this.getGroup();if(e)for(var r=e.getChildWidgets(),n=0,i=r.length;n<i;++n){var o=r[n];o!==this&&o.getGroup&&o.setChecked&&o.getGroup()===t&&o.setChecked(!1)}},doReactDeactiviting:function(e){this.tryApplySuper("doReactDeactiviting",[e])},_doToggleCheckOnSelf:function(e){e||this.tryApplySuper("_doToggleCheckOnSelf",[e])},_doCheckOnSelf:function(){this.getEnabled()&&this.setChecked(!0)}}),d.Widget.DropDownButton=Class.create(d.Widget.Button,{CLASS_NAME:"Kekule.Widget.DropDownButton",doFinalize:function(){this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("dropDownWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("dropDownWidget");if(!e){var t=this.getDropDownWidgetGetter();t&&(e=t(this),this.setPropStoreFieldValue("dropDownWidget",e))}return e},setter:function(e){this.setPropStoreFieldValue("dropDownWidget",e),e&&e.setDisplayed(!1)}}),this.defineProp("dropDownWidgetGetter",{dataType:DataType.FUNCTION,serializable:!1}),this.defineProp("dropPosition",{dataType:DataType.INT})},doCreateRootElement:function(e){return this.tryApplySuper("doCreateRootElement",[e])},calcActualDropPosition:function(){var e=d.Widget.Position,t=this.getDropPosition();if(!t){var r=this.getParent(),n=r?r.getLayout():d.Widget.Layout.HORIZONTAL,i=d.HtmlElementUtils.getElemPageRect(this.getElement(),!0),o=d.HtmlElementUtils.getViewportDimension(this.getElement()),a=this.getDropDownWidget().getElement();a.style.visible="hidden",a.style.display="",this.getElement().appendChild(a);var s=d.HtmlElementUtils.getElemOffsetDimension(a);if(this.getElement().removeChild(a),n)if(n===d.Widget.Layout.VERTICAL){var l=i.x,u=o.width-l-i.width;t=u>=s.width?e.RIGHT:l>u?e.LEFT:e.RIGHT}else{var c=i.y,h=o.height-c-i.height;t=h>=s.height?e.BOTTOM:c>h?e.TOP:e.BOTTOM}}return t},showDropDownWidget:function(){var e=this.getDropDownWidget();e.getElement().style.position="absolute",this.getElement(),e.show(this,null,d.Widget.ShowHideType.DROPDOWN),this.invokeEvent("dropDown",{dropDown:e})},hideDropDownWidget:function(){this.getDropDownWidget().hide(this)},isDropDownWidgetShown:function(){var e=this.getDropDownWidget();return e&&e.isShown()},doExecute:function(e){this.getDropDownWidget()&&(this.isDropDownWidgetShown()?this.hideDropDownWidget():this.showDropDownWidget()),this.tryApplySuper("doExecute",[e])}}),d.Widget.ButtonGroup=Class.create(d.Widget.Toolbar,{CLASS_NAME:"Kekule.Widget.ButtonGroup",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("showText",!0),this.setPropStoreFieldValue("showGlyph",!0),this.setAllowChildWrap(!1)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.BUTTON_GROUP},doCreateRootElement:function(e){return e.createElement("span")},getDefaultChildWidgetClassName:function(){return"Kekule.Widget.Button"}}),d.Widget.CompactButtonSet=Class.create(d.Widget.DropDownButton,{CLASS_NAME:"Kekule.Widget.CompactButtonSet",initialize:function(e,t){this.reactSetButtonExecuteBind=this.reactSetButtonExecute.bind(this),this.setPropStoreFieldValue("showCompactMark",!0),this.setPropStoreFieldValue("cloneSelectedOutlook",!0),this.tryApplySuper("initialize",[e,t]),this.getButtonSet()||this.initButtonGroup()},initProperties:function(){this.defineProp("buttonSet",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1,setter:function(e){var t=this.getButtonSet();t!==e&&(t&&t.finalize(),this.initButtonGroup(e))}}),this.defineProp("buttonSetLayout",{dataType:DataType.INT}),this.defineProp("selected",{dataType:"Kekule.Widget.Button",serializable:!1,setter:function(e){if(e)this.getButtonSet().hasChild(e)&&(this.getCloneSelectedOutlook()&&this.cloneSetButton(e),e.setChecked&&e.setChecked(!0));else{var t=this.getSelected();t&&t.setChecked(!1)}this.setPropStoreFieldValue("selected",e)}}),this.defineProp("cloneSelectedOutlook",{dataType:DataType.BOOL}),this.defineProp("showCompactMark",{dataType:DataType.BOOL,setter:function(e){this.getShowCompactMark()!==e&&(this.setPropStoreFieldValue("showCompactMark",e),e?this.createCompactMark():this.removeCompactMark())}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.COMPACT_BUTTON},doSetShowText:function(e){return this.getButtonSet()&&this.getButtonSet().setShowText(e),this.tryApplySuper("doSetShowText",[e])},doSetShowGlyph:function(e){return this.getButtonSet()&&this.getButtonSet().setShowGlyph(e),this.tryApplySuper("doSetShowGlyph",[e])},createCompactMark:function(){var e=this.getElement();this._compactMark&&e.removeChild(this._compactMark);var r=this.getDocument().createElement("span");return r.className=t.BTN_COMPACT_MARK,e.appendChild(r),this._compactMark=r,r},removeCompactMark:function(){var e=this.getElement();this._compactMark&&e.removeChild(this._compactMark)},initButtonGroup:function(e){if(e)var t=this._getCheckedButtonInGroup(e);else e=new d.Widget.ButtonGroup(this);e.setDisplayed(!1),e.setShowText(this.getShowText()),e.setShowGlyph(this.getShowGlyph()),this.setPropStoreFieldValue("buttonSet",e),this.setDropDownWidget(e),e.addEventListener("execute",this.reactSetButtonExecuteBind),e.addEventListener("check",this.reactSetButtonExecuteBind),t&&this.cloneSetButton(t)},_getCheckedButtonInGroup:function(e){for(var t=e.getChildWidgets(),r=0,n=t.length;r<n;++r){var i=t[r];if(i.getChecked&&i.getChecked())return i}return null},cloneSetButton:function(e){if(this.getCloneSelectedOutlook()){for(var t=this.getElement(),r=this.getButtonSet().getElement(),n=d.DomUtils,i=n.getDirectChildElems(t),o=n.getDirectChildElems(e.getElement()),a=!1,s=0,l=i.length;s<l;++s)(u=i[s])!==r?t.removeChild(u):a=!0;for(s=0,l=o.length;s<l;++s){var u=o[s].cloneNode(!0);a?t.insertBefore(u,r):t.appendChild(u)}this._clonedCustomHtmlClassName&&this.removeClassName(this._clonedCustomHtmlClassName),this._clonedCustomHtmlClassName=e.getCustomHtmlClassName(),this._clonedCustomHtmlClassName&&this.addClassName(this._clonedCustomHtmlClassName),this._compactMark=null,this.createCompactMark()}},calcActualButtonSetLayout:function(){var e=d.Widget.Layout,t=this.getButtonSetLayout();if(!t){var r=this.getParent();t=(r?r.getLayout():e.HORIZONTAL)===e.VERTICAL?e.HORIZONTAL:e.VERTICAL}return t},showDropDownWidget:function(){var e=this.calcActualButtonSetLayout();this.getButtonSet().setLayout(e),this.tryApplySuper("showDropDownWidget")},reactSetButtonExecute:function(e){if(e.target instanceof d.Widget.Button&&e.target!==this.getSelected()&&(!this._currExecButton||this._currExecButton!==e.target))try{this._currExecButton=e.target,e.target.setIsFocused(!1),e.target.setIsHover(!1),e.target.setIsActive(!1),this.setSelected(e.target),this.getButtonSet().isShown()&&this.getButtonSet().hide(),this.invokeEvent("select",{selected:e.target})}finally{this._currExecButton=null}},append:function(e,t){return this.getButtonSet().appendWidget(e),t&&this.setSelected(e),this},insertBefore:function(e,t,r){return this.getButtonSet().insertWidgetBefore(e),r&&this.setSelected(e),this},remove:function(e,t){return this.getButtonSet().removeWidget(e,t),this}})}(),function(){var e=d.DomUtils,t=d.HtmlElementUtils,r=d.Widget.HtmlClassNames,n=d.ObjUtils;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{OVERLAP:"K-Overlap",FORMCONTROL:"K-FormControl",CHECKBOX:"K-CheckBox",TEXTBOX:"K-TextBox",COMBOTEXTBOX:"K-ComboTextBox",COMBOTEXTBOX_ASSOC_WIDGET:"K-ComboTextBox-Assoc-Widget",BUTTONTEXTBOX:"K-ButtonTextBox",TEXTAREA:"K-TextArea",SELECTBOX:"K-SelectBox",COMBOBOX:"K-ComboBox",COMBOBOX_TEXTWRAPPER:"K-ComboBox-TextWrapper",NUMINPUT:"K-NumInput"}),d.Widget.FormWidget=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.FormWidget",initialize:function(e,t){this.reactValueChangeBind=this.reactValueChange.bind(this),this.reactInputBind=this.reactInput.bind(this),this.setPropStoreFieldValue("isDirty",!1),this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,getter:function(){return this.getCoreElement().name},setter:function(e){this.getCoreElement().name=e}}),this.defineProp("value",{dataType:DataType.VARIANT,serializable:!1,getter:function(){return this.getCoreElement().value},setter:function(e){this.getCoreElement().value=e}}),this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("readOnly",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getCoreElement().readOnly},setter:function(e){this.getCoreElement().readOnly=e}})},getTextSelectable:function(){return!0},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.FORMCONTROL},doBindElement:function(e){this.tryApplySuper("doBindElement",[e]);var t=this.getCoreElement();if(t){var r=d.Browser.IE&&8===d.Browser.IEVersion;d.X.Event.addListener(t,"change",this.reactValueChangeBind),d.X.Event.addListener(t,"input",this.reactInputBind),r?(this._bindKeyupEvent=!0,d.X.Event.addListener(t,"keyup",this.reactInputBind)):this._bindKeyupEvent=!1}},doUnbindElement:function(e){var t=this.getCoreElement();t&&(d.X.Event.removeListener(t,"change",this.reactValueChangeBind),d.X.Event.removeListener(t,"input",this.reactInputBind),this._bindKeyupEvent&&d.X.Event.removeListener(t,"keyup",this.reactInputBind)),this.tryApplySuper("doUnbindElement",[e])},notifyValueChanged:function(){this.setIsDirty(!0),this.invokeEvent("valueChange",{widget:this,value:this.getValue()})},selectAll:function(){var e=this.getCoreElement();return e&&e.select&&e.select(),this},reactValueChange:function(){this.notifyValueChanged()},reactInput:function(e){this.setIsDirty(!0),this.invokeEvent("valueInput",{widget:this,value:this.getValue()})}}),d.Widget.CheckBox=Class.create(d.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.CheckBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function(e,t){this.tryApplySuper("initialize",[e]),d.ObjUtils.notUnset(t)&&this.setChecked(!!t)},initProperties:function(){this.defineProp("checked",{dataType:DataType.BOOL,getter:function(){var e=this.getCoreElement();return!!e&&e.checked},setter:function(e){var t=this.getCoreElement();t&&(t.checked=!!e)}}),this.defineProp("text",{dataType:DataType.STRING,getter:function(){return d.DomUtils.getElementText(this.getLabelElem())},setter:function(e){d.DomUtils.setElementText(this.getLabelElem(),e)}})},getCoreElement:function(){return this.getInputElem()},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.CHECKBOX},getInputElem:function(){var e=this.getElement();if(e){var t=e.getElementsByTagName("input");if(t&&t.length)return t[0]}return null},getLabelElem:function(){var e=this.getElement();if(e){if("label"===e.tagName.toLowerCase())return e;var t=e.getElementsByTagName("label");if(t&&t.length)return t[0]}return null},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=e.createElement("label");t.appendChild(r);var n=e.createElement("input");return n.setAttribute("type","checkbox"),r.appendChild(n),[r,n]}}),d.Widget.TextBox=Class.create(d.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextBox",BINDABLE_TAG_NAMES:["input"],initialize:function(e,t){this.tryApplySuper("initialize",[e]),t&&this.setText(t)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return this.getElement().value},setter:function(e){this.getElement().value=e||""}}),this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getElement().placeholder},setter:function(e){this.getElement().placeholder=e}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.TEXTBOX},doCreateRootElement:function(e){return e.createElement("input")},doBindElement:function(e){this.tryApplySuper("doBindElement",[e]),e.setAttribute("type","text")}}),d.Widget.ComboTextBox=Class.create(d.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ComboTextBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function(e,t){this.tryApplySuper("initialize",[e]),t&&this.setText(t)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this.getTextBox();return e?e.getText():null},setter:function(e){var t=this.getTextBox();t&&t.setText(e)}}),this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getTextBox().getPlaceholder()},setter:function(e){this.getTextBox().setPlaceholder(e)}}),this.defineProp("overlapOnTextBox",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("overlapOnTextBox",e),e?this.addClassName(r.OVERLAP):this.removeClassName(r.OVERLAP),this.adjustWidgetsSize()}}),this.defineProp("textBox",{dataType:"Kekule.Widget.TextBox",serializable:!1,setter:null}),this.defineProp("headingWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:function(e){var t=this.getHeadingWidget();if(e!==t&&(this.setPropStoreFieldValue("headingWidget",e),t&&(t.setParent(null),t.removeClassName(r.COMBOTEXTBOX_ASSOC_WIDGET)),e)){var n=this.getTextBox()?this.getTextBox().getElement():this.getTailingWidget()?this.getTailingWidget().getElement():null;e.setParent(this),e.addClassName(r.COMBOTEXTBOX_ASSOC_WIDGET),e.insertToElem(this.getElement(),n)}}}),this.defineProp("tailingWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:function(e){var t=this.getTailingWidget();e!==t&&(this.setPropStoreFieldValue("tailingWidget",e),t&&(t.setParent(null),t.removeClassName(r.COMBOTEXTBOX_ASSOC_WIDGET)),e&&(e.setParent(this),e.addClassName(r.COMBOTEXTBOX_ASSOC_WIDGET),e.appendToElem(this.getElement())))}})},finalize:function(){this._finalizeSubWidgets(),this.tryApplySuper("finalize")},_finalizeSubWidgets:function(){var e,t=this.getTextBox();t&&t.finalize(),(e=this.getHeadingWidget())&&e.finalize(),(e=this.getTailingWidget())&&e.finalize()},getCoreElement:function(){var e=this.getTextBox();return e?e.getElement():this.tryApplySuper("getCoreElement")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMBOTEXTBOX},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var n=this.tryApplySuper("doCreateSubElements",[e,t]);this._finalizeSubWidgets();var i=new d.Widget.TextBox(this);return i.addClassName(r.TEXTBOX),i.appendToElem(this.getElement()),this.setPropStoreFieldValue("textBox",i),n.push(i.getElement()),n},elementBound:function(e){this.setObserveElemResize(!0)},relayEvent:function(e,t){var r=t.widget;return r!==this.getTextBox()&&r!==this.getHeadingWidget()&&r!==this.getTailingWidget()||(t.widget=this),this.tryApplySuper("relayEvent",[e,t])},doSetEnabled:function(e){var t=this.getTextBox();t&&t.setEnabled(e);var r=this.getHeadingWidget();r&&r.setEnabled(e),(r=this.getTailingWidget())&&r.setEnabled(e)},doResize:function(){this.adjustWidgetsSize()},widgetShowStateChanged:function(e,t){this.tryApplySuper("widgetShowStateChanged",[e,t]),e&&this.adjustWidgetsSize()},doInsertedToDom:function(){this.isShown()&&this.adjustWidgetsSize()},assocWidgetChanged:function(){this.adjustWidgetsSize()},adjustWidgetsSize:function(){var e=d.StyleUtils,t=this.getOverlapOnTextBox(),r=t?"absolute":"relative",n=this.getTextBox().getElement();if(n){var i,o,a,s=d.HtmlElementUtils.getElemPageRect(n);if((o=(i=this.getHeadingWidget())?i.getElement():null)&&i.isShown())if((a=o.style).position=r,t){var l=d.HtmlElementUtils.getElemPageRect(o);a.left=0,a.top=(s.height-l.height)/2+"px",n.style.paddingLeft=l.width+"px"}else e.removeStyleProperty(a,"left"),e.removeStyleProperty(a,"top"),e.removeStyleProperty(n.style,"paddingLeft");else e.removeStyleProperty(n.style,"paddingLeft");(o=(i=this.getTailingWidget())?i.getElement():null)&&i.isShown()?((a=o.style).position=r,t?(l=d.HtmlElementUtils.getElemPageRect(o),a.right=0,a.top=(s.height-l.height)/2+"px",n.style.paddingRight=l.width+"px"):(e.removeStyleProperty(a,"right"),e.removeStyleProperty(a,"top"),e.removeStyleProperty(n.style,"paddingRight"))):e.removeStyleProperty(n.style,"paddingRight")}}}),d.Widget.ButtonTextBox=Class.create(d.Widget.ComboTextBox,{CLASS_NAME:"Kekule.Widget.ButtonTextBox",initialize:function(e,t){this.tryApplySuper("initialize",[e,t]),this.setOverlapOnTextBox(!0)},initProperties:function(){this.defineProp("button",{dataType:"Kekule.Widget.Button",serializable:!1,setter:null,getter:function(){return this.getTailingWidget()}}),this.defineProp("buttonKind",{dataType:DataType.STRING,getter:function(){return this.getButton().getButtonKind()},setter:function(e){this.getButton().setButtonKind(e)}}),this.defineProp("buttonText",{dataType:DataType.STRING,getter:function(){return this.getButton().getText()},setter:function(e){this.getButton().setText(e).setShowText(!!e)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.BUTTONTEXTBOX},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),n=this.createAssocButton();return n&&r.push(n.getElement()),r},createAssocButton:function(){var e=new d.Widget.Button(this);return e.setShowText(!1),this.setTailingWidget(e),e.addEventListener("change",this.adjustWidgetsSize,this),e.addEventListener("execute",(function(e){this.invokeEvent("buttonExecute",{widget:this})}),this),e},execBtn:function(e){var t=this.getButton();if(t)return t.execute(e),!0},react_keypress:function(e){13===e.getKeyCode()&&this.execBtn(e)},react_keydown:function(e){if(this.getButtonKind()===d.Widget.Button.Kinds.DROPDOWN){var t=d.X.Event.KeyCode;e.getKeyCode()===t.DOWN&&this.execBtn(e)}}}),d.Widget.TextArea=Class.create(d.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextArea",BINDABLE_TAG_NAMES:["textarea"],initialize:function(e,t){this.tryApplySuper("initialize",[e]),t&&this.setText(t)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return this.getValue()},setter:function(e){this.setValue(e),this.adjustAutoSize()}}),this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getElement().placeholder},setter:function(e){this.getElement().placeholder=e}}),this.defineProp("autoSizeX",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoSizeX",e),this._autoSizeChanged()}}),this.defineProp("autoSizeY",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoSizeY",e),this._autoSizeChanged()}}),this.defineProp("wrap",{dataType:DataType.STRING,getter:function(){return this.getElement().wrap},setter:function(e){this.getElement().wrap=e}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.TEXTAREA},doCreateRootElement:function(e){return e.createElement("textarea")},doBindElement:function(e){this.tryApplySuper("doBindElement",[e]),this.adjustAutoSize()},setValue:function(e){this.tryApplySuper("setValue",[e]),this.adjustAutoSize()},widgetShowStateChanged:function(e,t){this.tryApplySuper("widgetShowStateChanged",[e,t]),e&&this.adjustAutoSize()},doFileDragDrop:function(e){if(e){if(d.BrowserFeature.fileapi){var t=this,r=new FileReader;r.onload=function(e){var n=r.result;t.setText(n)},r.readAsText(e[0])}return!0}return this.tryApplySuper("doFileDragDrop")},reactValueChange:function(){this.adjustAutoSize(),this.tryApplySuper("reactValueChange")},react_keyup:function(){this.adjustAutoSize()},react_keypress:function(){this.adjustAutoSize()},doWidgetShowStateChanged:function(e){e&&this.adjustAutoSize()},_autoSizeChanged:function(){var e=this.getCoreElement().style;this.getAutoSizeX()?(e.overflowX="hidden",this.setWrap("off")):(e.overflowX="auto",this.setWrap("")),this.getAutoSizeY()?e.overflowY="hidden":e.overflowY="auto",this.adjustAutoSize()},adjustAutoSize:function(){(this.getAutoSizeX()||this.getAutoSizeY())&&this.adjustSizeByContent()},adjustSizeByContent:function(){var e=this.getCoreElement(),t=!this.getText(),r=e.style;this.getAutoSizeX()&&(r.width="1px"),this.getAutoSizeY()&&(r.height="1px");var n=d.HtmlElementUtils.getElemScrollDimension(e),i=d.HtmlElementUtils.getElemClientDimension(e);this.getAutoSizeX()&&(t?r.width="1em":n.width>i.width&&(r.width=n.width+"px")),this.getAutoSizeY()&&(t&&(r.height="1em"),n.height>i.height&&(r.height=n.height+"px"))}}),d.Widget.SelectBox=Class.create(d.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.SelectBox",BINDABLE_TAG_NAMES:["select"],ITEM_DATA_FIELD:"__$item_data__",ITEM_VALUE_FIELD:"__$item_value__",initialize:function(e,t){this.tryApplySuper("initialize",[e]),t&&this.setItems(t)},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY,serializable:!1,getter:function(){for(var e=this.getAllItemElems(),t=[],r=0,n=e.length;r<n;++r){var i=e[r],o=this._getBoxItemInfo(i);t.push(o)}return t},setter:function(e){var t=this.getElement();if(this.clear(),e)for(var r=d.ArrayUtils.toArray(e),n=0,i=r.length;n<i;++n){var o=r[n];if(o){var a=this._createBoxItemElem(t);this._setBoxItemInfo(a,o)}}}}),this.defineProp("index",{dataType:DataType.INT,getter:function(){return this.getElement().selectedIndex},setter:function(e){this.getElement().selectedIndex=e}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.SELECTBOX},doCreateRootElement:function(e){return e.createElement("select")},_createBoxItemElem:function(e,t){var r=e.ownerDocument.createElement("option");return t?e.insertBefore(r,t):e.appendChild(r),r},doBindElement:function(e){this.tryApplySuper("doBindElement",[e])},doGetValue:function(){var e=this.getSelectedItemElem();return e?this._getBoxItemInfo(e).value:void 0},doSetValue:function(e){for(var t=this.getAllItemElems(),r=0,n=t.length;r<n;++r){var i=t[r];if(this._getBoxItemInfo(i).value===e)return void this.setIndex(r)}this.setIndex(-1)},getAllItemElems:function(){return e.getDirectChildElems(this.getElement(),"option")},getSelectedItemElem:function(){for(var e=this.getAllItemElems(),t=0,r=e.length;t<r;++t){var n=e[t];if(n.selected)return n}return null},getItemData:function(e){var t=this._getBoxItemInfo(e);return t&&t.data},getSelectedItemData:function(){var e=this.getSelectedItemElem();return e&&this.getItemData(e)},clear:function(){this.getElement().innerHTML=""},dropDown:function(){this.getDocument(),this.getElement();var e=this.getDocument().createEvent("MouseEvents");e.initEvent("mousedown",!0,!0),this.getElement().dispatchEvent(e)},_getBoxItemInfo:function(e){var r={};return r.text=t.getInnerText(e),r.value=e[this.ITEM_VALUE_FIELD],n.notUnset(e.title)&&(r.title=e.title),n.notUnset(e[this.ITEM_DATA_FIELD])&&(r.data=e[this.ITEM_DATA_FIELD]),r},_setBoxItemInfo:function(e,t){DataType.isSimpleValue(t)&&(t={value:t});var r=t.text||t.value;return n.notUnset(r)&&d.DomUtils.setElementText(e,r),e.value=""+t.value,e[this.ITEM_VALUE_FIELD]=t.value,n.notUnset(t.title)&&(e.title=t.title),n.notUnset(t.data)&&(e[this.ITEM_DATA_FIELD]=t.data),t.selected?e.setAttribute("selected","selected"):e.selected=!1,this}}),d.Widget.ComboBox=Class.create(d.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ComboBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this.getTextBox();return e?e.getText():null},setter:function(e){var t=this.getTextBox();t&&(t.setText(e),this.textChanged())}}),this.defineProp("items",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getSelectBox();return e?e.getItems():null},setter:function(e){var t=this.getSelectBox();t&&t.setItems(e)}}),this.defineProp("textBox",{dataType:"Kekule.Widget.TextBox",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("selectBox",{dataType:"Kekule.Widget.SelectBox",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE})},finalize:function(){this._finalizeSubElements(),this.tryApplySuper("finalize")},_finalizeSubElements:function(){var e=this.getTextBox();e&&e.finalize();var t=this.getSelectBox();t&&t.finalize()},getCoreElement:function(){var e=this.getTextBox();return e?e.getElement():this.tryApplySuper("getCoreElement")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMBOBOX},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var n=this;this._finalizeSubElements();var i=e.createElement("span");i.className=r.COMBOBOX_TEXTWRAPPER,t.appendChild(i);var o=new d.Widget.TextBox(this);o.appendToElem(i),this.setPropStoreFieldValue("textBox",o);var a=new d.Widget.SelectBox(this);return a.appendToElem(t),this.setPropStoreFieldValue("selectBox",a),a.addEventListener("valueChange",(function(e){var t=a.getSelectedItemElem();if(t){var r=t.value,i=t.text||t.value;i!==o.getText()&&(o.setText(i),n.notifyValueChanged()),o.selectAll(),o.focus(),n.invokeEvent("valueSelect",{widget:n,value:r})}})),o.addEventListener("valueChange",(function(e){n.textChanged()})),d.X.Event.addListener(o.getElement(),"keydown",(function(e){e.getKeyCode()===d.X.Event.KeyCode.DOWN&&a.dropDown()})),[i]},relayEvent:function(e,t){var r=t.widget;if(r!==this.getTextBox()&&r!==this.getSelectBox()||(t.widget=this,"valueChange"!==e))return this.tryApplySuper("relayEvent",[e,t])},textChanged:function(){var e=this.getText(),t=this._getValueOfText(e);this.getSelectBox().setValue(t)},_getValueOfText:function(e){for(var t=this.getSelectBox().getItems(),r=0,n=t.length;r<n;++r){var i=t[r];if(i.text&&i.text===e)return i.value}return e},doSetEnabled:function(e){var t=this.getTextBox();t&&t.setEnabled(e);var r=this.getSelectBox();r&&r.setEnabled(e)},doGetValue:function(){var e=this.tryApplySuper("doGetValue");return this._getValueOfText(e)},doSetValue:function(e){var t=e,r=this.getSelectBox().getItems();this.getSelectBox().setIndex(-1);for(var n=0,i=r.length;n<i;++n){var o=r[n];if(o.value===e){t=o.text||o.value,this.getSelectBox().setIndex(n);break}}this.tryApplySuper("doSetValue",[t])}}),d.Widget.NumInput=Class.create(d.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.NumInput",BINDABLE_TAG_NAMES:["input"],DEF_MIN_VALUE:0,DEF_MAX_VALUE:100,DEF_STEP:1,initialize:function(e,t,r,i,o){this.tryApplySuper("initialize",[e]),n.notUnset(t)&&this.setMinValue(t),n.notUnset(r)&&this.setMaxValue(r),n.notUnset(i)&&this.setStep(i),o&&this.setControlType(o)},initProperties:function(){this.defineProp("minValue",{dataType:DataType.NUMBER,getter:function(){return parseFloat(this.getElement().min)||null},setter:function(e){this.getElement().min=e}}),this.defineProp("maxValue",{dataType:DataType.NUMBER,getter:function(){return parseFloat(this.getElement().max)||null},setter:function(e){this.getElement().max=e}}),this.defineProp("step",{dataType:DataType.NUMBER,getter:function(){return parseFloat(this.getElement().step)||null},setter:function(e){this.getElement().step=e}}),this.defineProp("controlType",{dataType:DataType.STRING,getter:function(){return this.getElement().getAttribute("type")},setter:function(e){this.getElement().setAttribute("type",e)}})},doGetValue:function(){var e=this.tryApplySuper("doGetValue");return e?parseFloat(e):0},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.NUMINPUT},doCreateRootElement:function(e){return e.createElement("input")},doBindElement:function(e){this.tryApplySuper("doBindElement",[e]),e.setAttribute("type","range")}})}(),function(){"use strict";d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{STATE_COLLAPSED:"K-State-Collapsed",STATE_EMPTY:"K-State-Empty",NESTED_CONTAINER:"K-NestedContainer",NESTED_CONTAINER_ITEM:"K-NestedContainer-Item"}),d.Widget.NestedContainer=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.NestedContainer",DEF_CONTAINER_TAG:"ul",DEF_ITEM_TAG:"li",ITEM_DATA_FIELD:"__$itemData__",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("itemInitialExpanded",{dataType:DataType.BOOL})},doCreateRootElement:function(e){return e.createElement("div")},doBindElement:function(e){this.tryApplySuper("doBindElement",[e])},getContainerElemTag:function(){return this.DEF_CONTAINER_TAG},getItemElemTag:function(){return this.DEF_ITEM_TAG},_createChildItemElem:function(){var e=this.doCreateChildItemElem();return d.HtmlElementUtils.addClass(e,d.Widget.HtmlClassNames.NESTED_CONTAINER_ITEM),d.HtmlElementUtils.addClass(e,d.Widget.HtmlClassNames.STATE_EMPTY),e},doCreateChildItemElem:function(){return this.getDocument().createElement(this.getItemElemTag())},_createChildContainerElem:function(){var e=this.doCreateChildContainerElem();return d.HtmlElementUtils.addClass(e,d.Widget.HtmlClassNames.NESTED_CONTAINER),e},doCreateChildContainerElem:function(){return this.getDocument().createElement(this.getContainerElemTag())},getChildContainerElem:function(e,t){e||(e=this.getElement());var r=e.getElementsByTagName(this.getContainerElemTag()),n=r.length?r[0]:null;return!n&&t&&(n=this._createChildContainerElem(),e.appendChild(n)),n},getItemData:function(e){return e[this.ITEM_DATA_FIELD]},setItemData:function(e,t){this.doSetItemData(e,t),e[this.ITEM_DATA_FIELD]=t;var r=t.children;if(r&&d.ArrayUtils.isArray(r)){this.clearChildItems(e);for(var n=0,i=r.length;n<i;++n){var o=r[n];this.appendChildItem(e,o)}}return this},doSetItemData:function(e,t){},hasChildItem:function(e){return this.getChildItemCount(e)>0},getChildItemCount:function(e){return this.getChildren(e).length},getChildren:function(e){var t=this.getChildContainerElem(e);return t?d.DomUtils.getDirectChildElems(t,this.getItemElemTag()):[]},getChildItemAt:function(e,t){var r=this.getChildren(e);return r.length&&r.length>t?r[t]:null},insertChildItem:function(e,t,r){var n=this.getChildContainerElem(e,!0);if(t&&d.DomUtils.isElement(t))i=t;else{var i=this._createChildItemElem();this.getItemInitialExpanded()||d.HtmlElementUtils.addClass(i,d.Widget.HtmlClassNames.STATE_COLLAPSED),t&&this.setItemData(i,t)}var o=DataType.isSimpleType(r)?this.getChildren(e)[r]:r;return o?n.insertBefore(i,o):n.appendChild(i),this.childItemsChanged(e),i},appendChildItem:function(e,t){return this.insertChildItem(e,t)},removeChildItem:function(e,t){var r=this.getChildContainerElem(e);return r&&(r.removeChild(t),this.hasChildItem(e)||e.removeChild(r),this.childItemsChanged(e)),this},removeChildItemAt:function(e,t){var r=this.getChildItemAt(e,t);return r&&this.removeChildItem(e,r),this},clearChildItems:function(e){var t=this.getChildContainerElem(e);e||(e=this.getElement()),t&&e.removeChild(t),this.childItemsChanged(e)},childItemsChanged:function(e){if(e){var t=d.Widget.HtmlClassNames.STATE_EMPTY;this.hasChildItem(e)?d.HtmlElementUtils.removeClass(e,t):d.HtmlElementUtils.addClass(e,t)}},expandItem:function(e){return d.HtmlElementUtils.removeClass(e,d.Widget.HtmlClassNames.STATE_COLLAPSED),this},collapseItem:function(e){return d.HtmlElementUtils.addClass(e,d.Widget.HtmlClassNames.STATE_COLLAPSED),this},toggleExpandStateOfItem:function(e){return d.HtmlElementUtils.toggleClass(e,d.Widget.HtmlClassNames.STATE_COLLAPSED),this},isChildItem:function(e){return d.HtmlElementUtils.hasClass(e,d.Widget.HtmlClassNames.NESTED_CONTAINER_ITEM)},getBelongedChildItem:function(e){for(var t=e,r=this.getElement(),n=this.getDocument().body;t!==r&&t!==n;)if(t=t.parentNode,this.isChildItem(t))return t;return null},getAllChildItems:function(e){var t=[],r=this.getChildContainerElem(e,!1);if(r)for(var n=d.DomUtils.getDirectChildElems(r),i=0,o=n.length;i<o;++i){var a=n[i];if(this.isChildItem(a)){t.push(a);var s=this.getAllChildItems(a);t=t.concat(s)}}return t},getChildItemRange:function(e,t,r){var n=this.getAllChildItems(r),i=n.indexOf(e),o=n.indexOf(t);if(i>=0&&o>=0){if(i>o){var a=!0,s=i;i=o,o=s}var l=n.slice(i,o+1);return a&&(l=l.reverse()),l}return[]}})}(),function(){"use strict";d.HtmlElementUtils;var e=d.Widget.HtmlClassNames;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{TREEVIEW:"K-TreeView",TREEVIEW_EXPANDMARK:"K-TreeView-ExpandMark",TREEVIEW_ITEMCONTENT:"K-TreeView-ItemContent"}),d.Widget.TreeView=Class.create(d.Widget.NestedContainer,{CLASS_NAME:"Kekule.Widget.TreeView",BELONGED_ITEM_FIELD:"__$treeItem__",initProperties:function(){this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("selection");return e||(e=[],this.setPropStoreFieldValue("selection",e)),e},setter:function(e){this.select(e)}}),this.defineProp("selectedItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getSelection();return e.length?e[e.length-1]:null},setter:function(e){this.select(e)}}),this.defineProp("autoScrollToSelected",{dataType:DataType.BOOL}),this.defineProp("enableMultiSelect",{dataType:DataType.BOOL})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TREEVIEW},doCreateChildItemElem:function(){var t=this.tryApplySuper("doCreateChildItemElem");if(t){var r=this.createGlyphContent(t,null,e.TREEVIEW_EXPANDMARK);r[this.BELONGED_ITEM_FIELD]=t,t._expandMarkerElem=r;var n=this.getDocument().createElement("span");n.className=e.TREEVIEW_ITEMCONTENT,t.appendChild(n),n[this.BELONGED_ITEM_FIELD]=t,t._contentElem=n}return t},doSetItemData:function(e,t){this.setItemText(e,t.text)},getExpandMarkerElem:function(e){return e._expandMarkerElem},getItemContentElem:function(e){return e._contentElem},getTextPartElem:function(e,t){var r=e._textPartElem;return!r&&t&&(r=this.createTextContent("",this.getItemContentElem(e)),e._textPartElem=r),r},setItemText:function(e,t){this.getTextPartElem(e,!0).innerHTML=t},isItemSelected:function(e){var t=this.getSelection();return!!t&&t.indexOf(e)>=0},selectionChanged:function(){if(this.getAutoScrollToSelected()){var e=this.getSelectedItem();e&&e.scrollIntoView&&e.scrollIntoViewIfNeeded()}this.notifyPropSet("selection",this.getSelection()),this.invokeEvent("selectionChange",{selection:this.getSelection(),selectedItem:this.getSelectedItem()})},clearSelection:function(){var t=this.getSelection();if(t.length){for(var r=0,n=t.length;r<n;++r){var i=t[r];d.HtmlElementUtils.removeClass(this.getItemContentElem(i),e.STATE_SELECTED)}this.setPropStoreFieldValue("selection",[]),this.selectionChanged()}return this},removeFromSelection:function(t){if(t){var r=d.ArrayUtils.toArray(t);if(r&&r.length){for(var n=this.getSelection(),i=0,o=r.length;i<o;++i){var a=r[i];d.ArrayUtils.remove(n,a)&&d.HtmlElementUtils.removeClass(this.getItemContentElem(a),e.STATE_SELECTED)}this.selectionChanged()}}return this},addToSelection:function(t){if(t){var r=d.ArrayUtils.toArray(t);if(r&&r.length){this.getEnableMultiSelect()||(this.clearSelection(),r=[r[r.length-1]]);for(var n=this.getSelection(),i=0,o=r.length;i<o;++i){var a=r[i];this.isItemSelected(a)||(d.HtmlElementUtils.addClass(this.getItemContentElem(a),e.STATE_SELECTED),n.push(a))}this.selectionChanged()}}return this},toggleSelectionState:function(e){if(e){this.beginUpdate();try{var t=d.ArrayUtils.toArray(e);if(this.getSelection(),t&&t.length)for(var r=0,n=t.length;r<n;++r){var i=t[r];this.isItemSelected(i)?this.removeFromSelection(i):this.addToSelection(i)}}finally{this.endUpdate()}}},select:function(e,t){this.beginUpdate();try{if(this.clearSelection(),e)if(this.getEnableMultiSelect())this.addToSelection(e);else{var r=d.ArrayUtils.toArray(e);this.addToSelection(r[r.length-1])}}finally{this.endUpdate()}},react_click:function(e){var t=e.getTarget(),r=t[this.BELONGED_ITEM_FIELD];if(r&&this.isChildItem(r))this.toggleExpandStateOfItem(r);else if(r=this.getBelongedChildItem(t),e.getShiftKey()){var n=this.getSelectedItem();if(n){var i=this.getChildItemRange(n,r);i.length&&(e.getCtrlKey()?this.addToSelection(i):this.select(i))}else this.select(r)}else e.getCtrlKey()?this.toggleSelectionState(r):r&&this.select(r)},react_dblclick:function(e){var t=e.getTarget(),r=this.getBelongedChildItem(t);r&&this.toggleExpandStateOfItem(r)}})}(),function(){"use strict";var e=d.DomUtils,t=d.HtmlElementUtils,r=d.Widget.HtmlClassNames;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{LISTVIEW:"K-ListView",LISTVIEW_ITEM_HOLDER:"K-ListView-ItemHolder",LISTVIEW_ITEM:"K-ListView-Item",LISTVIEW_ITEMCONTENT:"K-ListView-ItemContent"}),d.Widget.ListView=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ListView",ITEM_DATA_FIELD:"__$itemData__",initialize:function(e){this.setPropStoreFieldValue("enableSelect",!0),this.setPropStoreFieldValue("enableMultiSelect",!0),this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY,serializable:!1,getter:function(){for(var t=[],r=e.getDirectChildElems(this.getChildrenHolderElement()),n=0,i=r.length;n<i;++n){var o=r[n];this.isChildItemElem(o)&&t.push(o)}return t}}),this.defineProp("enableSelect",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableSelect",e),e||this.clearSelection()}}),this.defineProp("enableMultiSelect",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableMultiSelect",e),e||this.clearSelection()}}),this.defineProp("enableSelectInSelection",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableSelectInSelection",e);var n=this.getSelectedItem();n&&(e?t.addClass(n,r.STATE_CURRENT_SELECTED):t.removeClass(n,r.STATE_CURRENT_SELECTED))}}),this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("selection");return e||(e=[],this.setPropStoreFieldValue("selection",e)),e},setter:function(e){this.select(e)}}),this.defineProp("currSelectedItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getSelectedItem()},setter:function(e){this.setSelectedItem(e)}}),this.defineProp("selectedItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getSelection();return e.length?e[e.length-1]:null},setter:function(e){var t=this.getBelongedChildItem(e);if(t)if(this.getEnableSelectInSelection()){var r=this.getSelection(),n=r.indexOf(t);n>=0?(this.prepareChangingSelection(),r.splice(n,1),r.push(t),this.selectionChanged()):this.select(t)}else this.select(t);else this.clearSelection()}})},doCreateSubElements:function(e,t){var n=this.tryApplySuper("doCreateSubElements",[]);return this._holderElem=e.createElement("ul"),this._holderElem.className=r.LISTVIEW_ITEM_HOLDER,t.appendChild(this._holderElem),n.concat(this._holderElem)},getChildrenHolderElement:function(){return this._holderElem},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.LISTVIEW},doCreateRootElement:function(e){return e.createElement("ul")},getItemClassName:function(){return r.LISTVIEW_ITEM},createChildItem:function(e){var r=this.doCreateChildItem(e);return r&&(t.addClass(r,this.getItemClassName()),e&&this.setItemData(r,e)),r},doCreateChildItem:function(e){return this.getDocument().createElement("li")},getItemData:function(e){return e[this.ITEM_DATA_FIELD]},setItemData:function(e,t){return this.doSetItemData(e,t),e[this.ITEM_DATA_FIELD]=t,this},doSetItemData:function(t,r){r&&(r.text&&e.setElementText(t,r.text),r.hint&&t.setAttribute("title",r.hint))},isChildItemElem:function(e){return e.parentNode===this.getChildrenHolderElement()&&t.hasClass(e,r.LISTVIEW_ITEM)},getBelongedChildItem:function(t){return e.isDescendantOf(t,this.getElement())?this.isChildItemElem(t)?t:this.getBelongedChildItem(t.parentNode):null},getAllChildItems:function(){for(var t=[],r=e.getDirectChildElems(this.getChildrenHolderElement()),n=0,i=r.length;n<i;++n){var o=r[n];this.isChildItemElem(o)&&t.push(o)}return t},getChildItemElemRange:function(e,t){var r=this.getAllChildItems(),n=r.indexOf(e),i=r.indexOf(t);if(n>=0&&i>=0){if(n>i){var o=!0,a=n;n=i,i=a}var s=r.slice(n,i+1);return o&&(s=s.reverse()),s}return[]},indexOfItem:function(e){var t=-1,r=this.getBelongedChildItem(e);return r&&(t=this.getAllChildItems().indexOf(r)),t},getItemAt:function(e){return this.getAllChildItems()[e]},_itemBeforeInsert:function(e){},_itemInserted:function(e){t.addClass(e,this.getItemClassName())},_itemBeforeRemove:function(e){this.isItemSelected(e)&&this.removeFromSelection(e),t.removeClass(e,this.getItemClassName())},_itemRemoved:function(e){},appendItem:function(t){return t?e.isElement(t)||(t=this.createChildItem(t)):t=this.createChildItem(),this._itemBeforeInsert(t),this.getChildrenHolderElement().appendChild(t),this._itemInserted(t),t},insertItemBefore:function(t,r){t?e.isElement(t)||(t=this.createChildItem(t)):t=this.createChildItem();var n=r&&this.getBelongedChildItem(r);return n?(this._itemBeforeInsert(t),this.getChildrenHolderElement().insertBefore(t,n),this._itemInserted(t),t):this.appendItem(t)},removeItem:function(e){var t=this.getBelongedChildItem(e);return this._itemBeforeRemove(t),this.getChildrenHolderElement().removeChild(t),this._itemRemoved(t),e},removeItems:function(e){for(var t=e.length-1;t>=0;--t)this.removeItem(e[t]);return this},clearItems:function(){this.select();var e=this.getItems();return this.removeItems(e),this},isItemSelected:function(e){var t=this.getSelection();return!!t&&t.indexOf(e)>=0},prepareChangingSelection:function(){this._prevSelectedItem=this.getSelectedItem()},selectionChanged:function(e,n){var i={selection:this.getSelection(),selectedItem:this.getSelectedItem(),added:e,removed:n},o=this.getSelectedItem();this._prevSelectedItem&&this._prevSelectedItem!==o&&(i.prevSelectedItem=this._prevSelectedItem,t.removeClass(this._prevSelectedItem,r.STATE_CURRENT_SELECTED),this._prevSelectedItem=null),o&&this.getEnableSelectInSelection()&&t.addClass(o,r.STATE_CURRENT_SELECTED),this.notifyPropSet("selection",this.getSelection()),this.invokeEvent("selectionChange",i)},clearSelection:function(){var e=this.getSelection();return e.length&&(this.prepareChangingSelection(),this.doClearSelection(),this.selectionChanged(null,e)),this},doClearSelection:function(){var e=this.getSelection();if(e.length){for(var n=0,i=e.length;n<i;++n){var o=this.getBelongedChildItem(e[n]);t.removeClass(o,[r.STATE_SELECTED,r.STATE_CURRENT_SELECTED])}this.setPropStoreFieldValue("selection",[])}},removeFromSelection:function(e){if(e){var n=[],i=d.ArrayUtils.toArray(e);if(i&&i.length){var o=this.getSelection();this.prepareChangingSelection();for(var a=0,s=i.length;a<s;++a){var l=i[a];d.ArrayUtils.remove(o,l)&&(t.removeClass(this.getBelongedChildItem(l),[r.STATE_SELECTED,r.STATE_CURRENT_SELECTED]),n.push(l))}this.selectionChanged(null,n)}}return this},addToSelection:function(e){if(e){var t=d.ArrayUtils.toArray(e);if(t&&t.length){this.prepareChangingSelection();var r=this.doAddToSelection(t);this.selectionChanged(r)}}return this},doAddToSelection:function(e){var n=[],i=d.ArrayUtils.toArray(e);if(i&&i.length){this.getEnableMultiSelect()||this.clearSelection();for(var o=this.getSelection(),a=0,s=i.length;a<s;++a){var l=i[a];this.isItemSelected(l)||(t.addClass(this.getBelongedChildItem(l),r.STATE_SELECTED),o.splice(o.length-1,0,l),n.push(l))}}return n},toggleSelectionState:function(e){if(e){this.beginUpdate();try{var t=d.ArrayUtils.toArray(e);if(this.getSelection(),t&&t.length)for(var r=0,n=t.length;r<n;++r){var i=t[r];this.isItemSelected(i)?this.removeFromSelection(i):this.addToSelection(i)}}finally{this.endUpdate()}}},select:function(e){this.beginUpdate();try{if(this.getSelection().length&&this.clearSelection(),e){var t=d.ArrayUtils.toArray(e),r=this.getEnableMultiSelect()?t:t[t.length-1];this.addToSelection(r)}}finally{this.endUpdate()}},react_click:function(e){if(this.getEnableSelect()){var t=e.getTarget(),r=this.getBelongedChildItem(t);if(r)if(this.getEnableMultiSelect())if(e.getShiftKey()){var n=this.getSelectedItem();if(n){var i=this.getChildItemElemRange(n,r);i.length&&(e.getCtrlKey()?this.addToSelection(i):this.select(i))}else this.select(r)}else e.getCtrlKey()?this.toggleSelectionState(r):r&&(this.getEnableSelectInSelection()&&this.isItemSelected(r)?this.setSelectedItem(r):this.select(r));else this.select(r);else this.select(null)}return this.tryApplySuper("react_click",[e])}})}(),function(){"use strict";var e=d.DomUtils,t=(d.HtmlElementUtils,d.StyleUtils),r=d.Widget.HtmlClassNames;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{DIALOG:"K-Dialog",DIALOG_INSIDE:"K-Dialog-Inside",DIALOG_OVERFLOW:"K-Dialog-Overflow",DIALOG_CLIENT:"K-Dialog-Client",DIALOG_CAPTION:"K-Dialog-Caption",DIALOG_BTN_PANEL:"K-Dialog-Button-Panel"}),d.Widget.DialogButtons={OK:"ok",CANCEL:"cancel",YES:"yes",NO:"no",isPositive:function(e){var t=d.Widget.DialogButtons;return[t.OK,t.YES].indexOf(e)>=0},isNegative:function(e){var t=d.Widget.DialogButtons;return[t.CANCEL,t.NO].indexOf(e)>=0}},d.Widget.Location={DEFAULT:1,CENTER:2,FULLFILL:3,CENTER_OR_FULLFILL:4},d.Widget.Dialog=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Dialog",BINDABLE_TAG_NAMES:["div","span"],BTN_NAME_FIELD:"__$btnName__",initialize:function(e,t,r){this._dialogCallback=null,this._modalInfo=null,this._childButtons=[],this.setPropStoreFieldValue("location",d.Widget.Location.CENTER),this.tryApplySuper("initialize",[e]),this._dialogOpened=!1,this.setUseCornerDecoration(!0),t&&this.setCaption(t),r&&this.setButtons(r),this.setDisplayed(!1)},doFinalize:function(){this.getModalInfo()&&this.getGlobalManager().unprepareModalWidget(this),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("caption",{dataType:DataType.STRING,getter:function(){return e.getElementText(this.getCaptionElem())},setter:function(r){e.setElementText(this.getCaptionElem(),r),t.setDisplay(this.getCaptionElem(),!!r)}}),this.defineProp("buttons",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("buttons",e),this.getBtnPanelElem()&&t.setDisplay(this.getBtnPanelElem(),e&&e.length),this.buttonsChanged()}}),this.defineProp("result",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("location",{dataType:DataType.INT}),this.defineProp("clientElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("captionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("btnPanelElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMovable&&this.setMovable(!0)},getDefaultMovingGripper:function(){return this.getCaptionElem()},getCoreElement:function(){return this.getClientElem()},doGetWidgetClassName:function(){return r.DIALOG},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var n,i=[];return(n=e.createElement("div")).className=r.DIALOG_CAPTION,t.appendChild(n),this.setPropStoreFieldValue("captionElem",n),i.push(n),this.setMovingGripper&&this.setMovingGripper(n),(n=e.createElement("div")).className=r.DIALOG_CLIENT,t.appendChild(n),this.setPropStoreFieldValue("clientElem",n),this.doCreateClientContents(n),i.push(n),(n=e.createElement("div")).className=r.DIALOG_BTN_PANEL,t.appendChild(n),this.setPropStoreFieldValue("btnPanelElem",n),i.push(n),this.buttonsChanged(),i},doCreateClientContents:function(e){},buttonsChanged:function(){for(var e=this._childButtons.length-1;e>=0;--e)this._childButtons[e].finalize();for(var t=this.getButtons()||[],r=(e=0,t.length);e<r;++e)this.createDialogButton(t[e])},createDialogButton:function(e,t,r,n){var i=this._getPredefinedButtonInfo(e);if(i||(i={text:e}),i){var o=new d.Widget.Button(this,i.text);o[this.BTN_NAME_FIELD]=e,o.addEventListener("execute",this._reactDialogBtnExec,this),o.appendToElem(this.getBtnPanelElem()),o.__$name__=e;var a=t||this._getDialogButtonResName(e);return a&&o.linkStyleResource(a),this._childButtons.push(o),o}return null},_getDialogButtonResName:function(e){var t=d.Widget.DialogButtons;return[t.OK,t.YES].indexOf(e)>=0?d.Widget.StyleResourceNames.BUTTON_YES_OK:[t.CANCEL,t.NO].indexOf(e)>=0?d.Widget.StyleResourceNames.BUTTON_NO_CANCEL:null},_reactDialogBtnExec:function(e){var t=d.Widget.DialogButtons,r=[t.OK,t.YES,t.CANCEL,t.NO],n=e.target;if(n){var i=n.__$name__;r.indexOf(i)>=0&&(this.setResult(i),this.close(i))}},_getPredefinedButtonInfo:function(e){var t=d.Widget.DialogButtons,r=[t.OK,t.CANCEL,t.YES,t.NO],n=[d.$L("WidgetTexts.CAPTION_OK"),d.$L("WidgetTexts.CAPTION_CANCEL"),d.$L("WidgetTexts.CAPTION_YES"),d.$L("WidgetTexts.CAPTION_NO")],i=r.indexOf(e);return i>=0?{text:n[i]}:null},getDialogButton:function(e){for(var t=this._childButtons.length-1;t>=0;--t){var r=this._childButtons[t];if(r[this.BTN_NAME_FIELD]===e)return r}return null},needAdjustPosition:function(){return this.getShowHideType()!==d.Widget.ShowHideType.DROPDOWN},_storePositionInfo:function(){if(this.needAdjustPosition()){var e=this.getElement().style;this._posInfo={left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height,position:e.position}}},_restorePositionInfo:function(){if(this.needAdjustPosition()){var e=this.getElement();if(e){var t=e.style,r=this._posInfo;r&&(t.left=r.left,t.top=r.top,t.right=r.right,t.bottom=r.bottom,t.width=r.width,t.height=r.height,t.position=r.position)}}},adjustLocation:function(){if(this.needAdjustPosition()){this._storePositionInfo();var e=d.Widget.Location,t=this.getLocation()||e.DEFAULT,n=!1;if(t!==e.DEFAULT){var i,o,a,s,l,u,c=this.getDisplayed(),h=this.getVisible();try{this.setDisplayed(!0,!0),this.setVisible(!0,!0);var p=d.DocumentUtils.getInnerClientDimension(this.getDocument()),g=d.HtmlElementUtils.getElemPageRect(this.getElement(),!0),f=g.right-g.left,m=g.bottom-g.top,C=this.getOffsetParent();C&&d.HtmlElementUtils.getElemPageRect(C,!0),n=f>=p.width||m>=p.height}finally{this.setVisible(h,!0),this.setDisplayed(c,!0)}if(t===e.CENTER_OR_FULLFILL&&(n?(d.DocumentUtils.getClientVisibleBox(this.getDocument()),f>=p.width?(i=0,l=0):i=(p.width-f)/2,m>=p.height?(o=0,u=0):o=(p.height-m)/2):t=e.CENTER),t===e.FULLFILL?(i=0,o=0,l=0,u=0):t===e.CENTER&&(i=(p.width-f)/2,o=(p.height-m)/2),n){this.removeClassName(r.DIALOG_INSIDE),this.addClassName(r.DIALOG_OVERFLOW);var y=d.DocumentUtils.getScrollPosition(this.getDocument());(i+=y.left)<0&&(i=0),(o+=y.top)<0&&(o=0)}else this.removeClassName(r.DIALOG_OVERFLOW),this.addClassName(r.DIALOG_INSIDE);var _=this.getElement().style,E=d.ObjUtils.notUnset;E(i)&&(_.left=i+"px"),E(o)&&(_.top=o+"px"),E(l)&&(_.right=l+"px"),E(u)&&(_.bottom=l+"px"),E(a)&&(_.width=a+"px"),E(s)&&(_.height=s+"px"),this.adjustClientSize(a,s,n)}this._posAdjusted=!0}},adjustClientSize:function(e,t,r){},prepareShow:function(e,t){var r=this.getElement();if(!r.parentNode){var n=this.getGlobalManager();(t?n.getContextRootElementOfCaller(t):r.ownerDocument.body).appendChild(r)}var i=this;setTimeout((function(){i._dialogCallback=e}),0)},openModal:function(e,t){return this.getGlobalManager().prepareModalWidget(this,t),this.open(e,t)},openPopup:function(e,t){return this.open(e,t,d.Widget.ShowHideType.POPUP)},open:function(e,t,r){return this.prepareShow(e,t),this.show(t,null,r||d.Widget.ShowHideType.DIALOG),this._dialogOpened=!0,this},close:function(e){this.setResult(e),this.hide()},isPositiveResult:function(e){return d.Widget.DialogButtons.isPositive(e||this.getResult())},isNegativeResult:function(e){return d.Widget.DialogButtons.isNegative(e||this.getResult())},widgetShowStateBeforeChanging:function(e){this.tryApplySuper("widgetShowStateBeforeChanging",[e]),e&&(this.adjustLocation(),this.setResult(null))},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),e||this._dialogCallback&&(this._dialogCallback(this.getResult()),this._dialogCallback=null)},widgetShowStateDone:function(e){this.tryApplySuper("widgetShowStateDone",[e]),!e&&this._dialogOpened&&(this.getModalInfo()&&this.getGlobalManager().unprepareModalWidget(this),this.isShown()||this._restorePositionInfo(),this._dialogOpened=!1)}})}(),function(){"use strict";var e=d.HtmlElementUtils,t=d.Widget.HtmlClassNames;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{MSGPANEL:"K-MsgPanel",MSGPANEL_CONTENT:"K-MsgPanel-Content",MSGGROUP:"K-MsgGroup",MSGGROUP_FOR_WIDGET:"K-Widget-MsgGroup",MSG_NORMAL:"K-Msg-Normal",MSG_INFO:"K-Msg-Info",MSG_WARNING:"K-Msg-Warning",MSG_ERROR:"K-Msg-Error"}),d.Widget.MsgType={NORMAL:"",INFO:"info",WARNING:"warning",ERROR:"error"},d.Widget.MsgPanel=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.MsgPanel",BINDABLE_TAG_NAMES:["span","div"],initialize:function(e,t,r){this._contentElem=null,this._elemTextPart=null,this._elemLeadingGlyphPart=null,this._elemTailingGlyphPart=null,this.setPropStoreFieldValue("showText",!0),this.tryApplySuper("initialize",[e]),t&&this.setText(t),r&&this.setMsgType(r),this.setUseCornerDecoration(!0)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){return d.HtmlElementUtils.getInnerText(this.getElement())},setter:function(e){this.changeContentText(e)}}),this.defineProp("showLeadingGlyph",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showLeadingGlyph",e),this._elemLeadingGlyphPart.style.display=e?"":"none"}}),this.defineProp("showTailingGlyph",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showTailingGlyph",e),this._elemTailingGlyphPart.style.display=e?"":"none"}}),this.defineProp("msgType",{dataType:DataType.STRING,setter:function(e){var t=this.getMsgType();if(t!==e){var r=this.getClassNameForMsgType(t),n=this.getClassNameForMsgType(e);r!==n&&(this.removeClassName(r),this.addClassName(n)),this.setPropStoreFieldValue("msgType",e)}}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MSGPANEL},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(r,n){var i=this.tryApplySuper("doCreateSubElements",[r,n])||[],o=e.getInnerText(n);n.innerHTML="";var a=r.createElement("span");return a.className=t.MSGPANEL_CONTENT,n.appendChild(a),this._contentElem=a,this._elemTextPart=this.createTextContent(o,a),this._elemLeadingGlyphPart=this.createGlyphContent(a,this._elemTextPart,t.PART_PRI_GLYPH_CONTENT),this._elemTailingGlyphPart=this.createGlyphContent(a,null,t.PART_ASSOC_GLYPH_CONTENT),i.push(a),i},doSetUseCornerDecoration:function(e){this.tryApplySuper("doSetUseCornerDecoration",[e]),e?d.HtmlElementUtils.addClass(this._contentElem,t.CORNER_ALL):d.HtmlElementUtils.removeClass(this._contentElem,t.CORNER_ALL)},getTextSelectable:function(){return!0},changeContentText:function(e){d.DomUtils.setElementText(this._elemTextPart,e||"",!0)},getClassNameForMsgType:function(e){var r=d.Widget.MsgType;switch(e){case r.INFO:return t.MSG_INFO;case r.WARNING:return t.MSG_WARNING;case r.ERROR:return t.MSG_ERROR;default:return t.MSG_NORMAL}}}),d.Widget.MsgGroup=Class.create(d.Widget.WidgetGroup,{CLASS_NAME:"Kekule.Widget.MsgGroup",BINDABLE_TAG_NAMES:["span","div"],initialize:function(e){this.tryApplySuper("initialize",[e]),this.setLayout(d.Widget.Layout.VERTICAL)},initProperties:function(){this.defineProp("reversedOrder",{dataType:DataType.BOOL}),this.defineProp("maxMsgCount",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("maxMsgCount",e),this.clearExcessiveMsgs()}}),this.defineProp("msgFlashTime",{dataType:DataType.INT})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMsgFlashTime(6e3)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MSGGROUP},doCreateRootElement:function(e){return e.createElement("div")},addMessage:function(e,t,r,n){if(e||t){var i=new d.Widget.MsgPanel(this,e,t);i.setFinalizeAfterHiding(!0),n&&i.addClassName(n),this.getReversedOrder()?i.insertToWidget(this,this.getChildAt(0)):i.appendToWidget(this);var o=d.ObjUtils.isUnset(r)?this.getMsgFlashTime():r;return o?i.flash(o,this):i.show(this),this.clearExcessiveMsgs(),i}},clearExcessiveMsgs:function(){var e=this.getMaxMsgCount();if(e&&e>0){var t=this.getChildWidgets().length-e;if(t>0){var r,n=0,i=this;!function e(){n<t&&(r=i.getOldestMsgPanel(),i.hideMsgPanel(r,e),++n)}()}}},getOldestMsgPanel:function(){return this.getReversedOrder()?this.getLastChild():this.getFirstChild()},hideMsgPanel:function(e,t){return e.hide(this,t),e}}),ClassEx.defineProp(d.Widget.BaseWidget,"msgReporter",{dataType:"Kekule.Widget.MsgGroup",serializable:!1,setter:null,getter:function(e){var r=this.getPropStoreFieldValue("msgReporter");return!r&&e&&((r=new d.Widget.MsgGroup(this)).addClassName(t.MSGGROUP_FOR_WIDGET),r.appendToWidget(this),this.setPropStoreFieldValue("msgReporter",r)),r}}),ClassEx.extend(d.Widget.BaseWidget,{reportMessage:function(e,t,r,n){var i=this.getMsgReporter(!0),o=i.addMessage(e,t,r||0,n);return i.setDisplayed(!0),o},flashMessage:function(e,t,r,n){return this.reportMessage(e,t,r||this.getMsgReporter(!0).getMsgFlashTime(),n)},removeMessage:function(e){e.hide()}})}(),function(){"use strict";d.HtmlElementUtils;var e=d.Widget.HtmlClassNames,t=d.ArrayUtils;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{TABVIEW:"K-TabView",TABVIEW_TABBUTTON:"K-TabView-TabButton",TABVIEW_CLIENT:"K-TabView-Client",TABVIEW_PAGE:"K-TabView-Page",TABVIEW_ACTIVE_PAGE:"K-TabView-Active-Page",TABVIEW_TABBUTTON_CONTAINER:"K-TabView-TabButton-Container",TABVIEW_PAGE_CONTAINER:"K-TabView-Page-Container",TABBUTTONGROUP:"K-TabButtonGroup",TAB_AT_LEFT:"K-TabAtLeft",TAB_AT_RIGHT:"K-TabAtRight",TAB_AT_TOP:"K-TabAtTop",TAB_AT_BOTTOM:"K-TabAtBottom"}),d.Widget.TabPage=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.TabPage",initProperties:function(){this.defineProp("text",{dataType:DataType.STRING}),this.defineProp("active",{dataType:DataType.STRING,getter:function(){var e=this.getTabView();return e?e.getActiveTabPage()===this:this.getPropStoreFieldValue("active")},setter:function(e){this.setPropStoreFieldValue("active",e);var t=this.getTabView();t&&e&&t.setActiveTabPage(this)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TABVIEW_PAGE},doCreateRootElement:function(e){return e.createElement("div")},getTabView:function(){var e=this.getParent();return e instanceof d.Widget.TabView?e:null}}),d.Widget.TabButtonGroup=Class.create(d.Widget.ButtonGroup,{CLASS_NAME:"Kekule.Widget.TabButtonGroup",initialize:function(e){this.tryApplySuper("initialize",[e]),this.addEventListener("execute",(function(e){var t=e.target;t instanceof d.Widget.RadioButton&&this.invokeEvent("switch",{button:t})}),this),this.tabButtonPosChanged()},initProperties:function(){this.defineProp("tabButtonPosition",{dataType:DataType.INT,enumSource:d.Widget.Position,setter:function(e){this.getTabButtonPosition()!==e&&(this.setPropStoreFieldValue("tabButtonPosition",e),this.tabButtonPosChanged())}}),this.defineProp("activeTabIndex",{dataType:DataType.INT,getter:function(){for(var e=this.getTabButtons(),t=0,r=e.length;t<r;++t)if(e[t].getChecked())return t;return-1},setter:function(e){for(var t=this.getTabButtons(),r=0,n=t.length;r<n;++r)t[r].setChecked(r===e)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!1)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TABBUTTONGROUP},getTabButtons:function(){for(var e=[],t=this.getChildWidgets(),r=0,n=t.length;r<n;++r){var i=t[r];i instanceof d.Widget.RadioButton&&e.push(i)}return e},tabButtonPosChanged:function(){var t=d.Widget.Position,r=this.getTabButtonPosition(),n=r&t.LEFT||r&t.RIGHT,i=r&t.RIGHT?e.TAB_AT_RIGHT:r&t.BOTTOM?e.TAB_AT_BOTTOM:r&t.LEFT?e.TAB_AT_LEFT:e.TAB_AT_TOP;this._lastTabBtnPosClassName&&this.removeClassName(this._lastTabBtnPosClassName),this._lastTabBtnPosClassName=i,this.addClassName(this._lastTabBtnPosClassName),this.setLayout(n?d.Widget.Layout.VERTICAL:d.Widget.Layout.HORIZONTAL)}}),d.Widget.TabView=Class.create(d.Widget.Container,{CLASS_NAME:"Kekule.Widget.TabView",TAB_BTN_FIELD:"__$tabButton__",initialize:function(e){this._tabBtnContainer=null,this._pageContainer=null,this.tryApplySuper("initialize",[e]),d.ObjUtils.isUnset(this.getUseCornerDecoration())&&this.setUseCornerDecoration(!0),this.tabButtonPosChanged(),this.addEventListener("change",this.reactTabPagePropChange,this)},doFinalize:function(){this.getTabGroup()&&this.getTabGroup().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("tabPages",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("tabPages");return e||(e=[],this.setPropStoreFieldValue("tabPages",e)),e},setter:null}),this.defineProp("activeTabPage",{dataType:"Kekule.Widget.TabPage",serializable:!1,setter:function(t){var r=this.getActiveTabPage();r!==t&&this.hasChild(t)&&(this.setPropStoreFieldValue("activeTabPage",t),r&&(r.removeClassName(e.TABVIEW_ACTIVE_PAGE),this._getPageTabButton(r).setChecked(!1)),t&&(t.addClassName(e.TABVIEW_ACTIVE_PAGE),this._getPageTabButton(t).setChecked(!0),this.invokeEvent("switchTab",{tabPage:t})))}}),this.defineProp("activeTabIndex",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getTabPages().indexOf(this.getActiveTabPage())},setter:function(e){var t=this.getTabPages()[e];t&&this.setActiveTabPage(t)}}),this.defineProp("tabButtonPosition",{dataType:DataType.INT,enumSource:d.Widget.Position,setter:function(e){this.getTabButtonPosition()!==e&&(this.setPropStoreFieldValue("tabButtonPosition",e),this.tabButtonPosChanged())}}),this.defineProp("showTabButtons",{dataType:DataType.BOOL,getter:function(){var e=this.getTabGroup();return e&&e.getDisplayed()},setter:function(e){var t=this.getTabGroup();t&&t.setDisplayed(e)}}),this.defineProp("tabGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TABVIEW},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(t,r){var n=t.createElement("div");n.className=e.TABVIEW_TABBUTTON_CONTAINER;var i=this.doCreateContainerElement(t,null,"div");return i.className=e.TABVIEW_PAGE_CONTAINER,this._tabBtnContainer=n,this._pageContainer=i,r.appendChild(n),r.appendChild(i),this.setPropStoreFieldValue("tabGroup",this.doCreateTabbar(t,n)),[n,i]},doCreateTabbar:function(e,t){var r=new d.Widget.TabButtonGroup(e);return r.setParent(this),r.appendToElem(t),r.addEventListener("switch",(function(e){var t=e.button,r=this._getPageOfTabButton(t);r&&this.setActiveTabPage(r)}),this),r},getChildrenHolderElement:function(){return this._pageContainer},getContainerElement:function(){return this._pageContainer},_getPageTabButton:function(e){return e[this.TAB_BTN_FIELD]},_setPageTabButton:function(e,t){e[this.TAB_BTN_FIELD]=t},_getPageOfTabButton:function(e){for(var t=this.getTabPages(),r=0,n=t.length;r<n;++r){var i=t[r];if(this._getPageTabButton(i)===e)return i}return null},childWidgetAdded:function(e){if(this.tryApplySuper("childWidgetAdded",[e]),e instanceof d.Widget.TabPage){var t=!this.getTabPages().length;e.appendToElem(this._pageContainer),this.getTabPages().push(e),this._insertTabButtonBefore(e),(t||e.getActive())&&this.setActiveTabPage(e)}},childWidgetRemoved:function(e){this.tryApplySuper("childWidgetRemoved",[e]),e instanceof d.Widget.TabPage&&(t.remove(this.getTabPages(),e),this._removeTabButton(e))},childWidgetMoved:function(e,t){this.tryApplySuper("childWidgetMoved",[e,t]),e instanceof d.Widget.TabPage&&this._changeTabIndex(e,t)},_insertTabButtonBefore:function(e,t){var r=this.getTabGroup(),n=new d.Widget.RadioButton(this.getDocument());this._updateTabButton(e,n),this._setPageTabButton(e,n),t?n.insertToWidget(r,t):n.appendToWidget(r)},_updateTabButton:function(e,t){t||(t=this._getPageTabButton(e)),t.setText(e.getText()||""),e.getHint()&&t.setHint(e.getHint())},_removeTabButton:function(e){var t=this._getPageTabButton(e);t&&t.finalize()},_changeTabIndex:function(e,r){var n=this._getPageTabButton(e);this.getTabGroup()._moveChild(n,r);var i=this.getTabPages(),o=i.indexOf(e);o>=0&&o!==r&&t.changeItemIndex(i,e,r)},reactTabPagePropChange:function(e){var t=e.target;if(t instanceof d.Widget.TabPage){var r=this._getPageTabButton(t);r&&this._updateTabButton(t,r)}},tabButtonPosChanged:function(){var t=d.Widget.Position,r=this.getTabButtonPosition(),n=r&t.BOTTOM||r&t.RIGHT,i=(r&t.LEFT||t.RIGHT,r&t.RIGHT?e.TAB_AT_RIGHT:r&t.BOTTOM?e.TAB_AT_BOTTOM:r&t.LEFT?e.TAB_AT_LEFT:e.TAB_AT_TOP);this._lastTabBtnPosClassName&&this.removeClassName(this._lastTabBtnPosClassName),this._lastTabBtnPosClassName=i,this.addClassName(this._lastTabBtnPosClassName),this.getTabGroup().setTabButtonPosition(r),n?this.getElement().appendChild(this._tabBtnContainer):this.getElement().insertBefore(this._tabBtnContainer,this._pageContainer)},createNewTabPage:function(e,t,r){var n=this.getDocument(),i=new d.Widget.TabPage(n);if(i.setText(e),t&&i.setHint(t),i.appendToWidget(this),r){var o=this.getChildWidgets().indexOf(r);this._moveChild(i,o)}return i}})}(),function(){"use strict";var e=d.DomUtils,t=d.HtmlElementUtils,r=d.Widget.HtmlClassNames;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{VALUELISTEDITOR:"K-ValueListEditor",VALUELISTEDITOR_ROW:"K-ValueListEditor-Row",VALUELISTEDITOR_CELL:"K-ValueListEditor-Cell",VALUELISTEDITOR_INDICATORCELL:"K-ValueListEditor-IndicatorCell",VALUELISTEDITOR_KEYCELL:"K-ValueListEditor-KeyCell",VALUELISTEDITOR_VALUECELL:"K-ValueListEditor-ValueCell",VALUELISTEDITOR_CELL_CONTENT:"K-ValueListEditor-CellContent",VALUELISTEDITOR_VALUECELL_TEXT:"K-ValueListEditor-ValueCellText",VALUELISTEDITOR_INLINE_EDIT:"K-ValueListEditor-InlineEdit",VALUELISTEDITOR_EXPANDMARK:"K-ValueListEditor-ExpandMark",VALUELISTEDITOR_ACTIVE_ROW:"K-ValueListEditor-ActiveRow"}),d.Widget.ValueListEditor=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ValueListEditor",BINDABLE_TAG_NAMES:["table"],ROW_ELEM_TAG:"tr",CELL_ELEM_TAG:"td",ROW_DATA_FIELD:"__$row_data__",ROW_EDIT_INFO_FIELD:"__$row_edit_info__",initialize:function(e){this.tryApplySuper("initialize",[e]),this._inlineEdit=null,this._isActivitingRow=!1},initProperties:function(){this.defineProp("hash",{dataType:DataType.HASH,getter:function(){return this._getTotalHash()},setter:function(e){this._setTotalHash(e),this.setPropStoreFieldValue("hash",e)}}),this.defineProp("readOnly",{dataType:DataType.BOOL}),this.defineProp("useKeyHint",{dataType:DataType.BOOL}),this.defineProp("valueDisplayMode",{dataType:DataType.INT,enumSource:d.Widget.ValueListEditor.ValueDisplayMode,setter:function(e){this.getValueDisplayMode()!==e&&(this.setPropStoreFieldValue("valueDisplayMode",e),this.valueDisplayModeChanged())}}),this.defineProp("activeRow",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var n=this.getActiveRow();n!==e&&(n&&(this.finishEditing(),t.removeClass(n,r.VALUELISTEDITOR_ACTIVE_ROW),this._showValueCellText(n)),this._inlineEdit&&this._inlineEdit.finalize(),e&&(t.addClass(e,r.VALUELISTEDITOR_ACTIVE_ROW),this.createValueEditWidget(e)),this.setPropStoreFieldValue("activeRow",e),this.invokeEvent("activeRowChange",{row:e}))}})},doGetWidgetClassName:function(){return r.VALUELISTEDITOR},doCreateRootElement:function(e){return e.createElement("table")},doBindElement:function(e){this.tryApplySuper("doBindElement",[e])},getRootElem:function(){return this.getElement()},createRowElem:function(e){var n=e.createElement(this.ROW_ELEM_TAG);return t.addClass(n,r.VALUELISTEDITOR_ROW),n},createCellElem:function(e){var n=e.createElement(this.CELL_ELEM_TAG);return t.addClass(n,r.VALUELISTEDITOR_CELL),n},createIndicatorCellElem:function(e){var n=this.createCellElem(e);t.addClass(n,r.VALUELISTEDITOR_INDICATORCELL);var i=e.createElement("span");return n.appendChild(i),n},createKeyCellElem:function(e){var n=this.createCellElem(e);return t.addClass(n,r.VALUELISTEDITOR_KEYCELL),n},createValueCellElem:function(e){var n=this.createCellElem(e);return t.addClass(n,r.VALUELISTEDITOR_VALUECELL),n},createValueEditWidget:function(e){var n=null;if(e===this.getActiveRow()?n=this._inlineEdit:this._inlineEdit&&(this._inlineEdit.finalize(),this._inlineEdit=null),!n){(n=this.getReadOnly()?this.doCreateReadOnlyValueEditWidget(e):this.doCreateValueEditWidget(e)).setBubbleUiEvents(!0),t.addClass(n.getElement(),r.VALUELISTEDITOR_INLINE_EDIT);var i=this.getValueCell(e),o=this.getCellContentWrapper(i,!0);n.appendToElem(o)}return n&&(n.focus&&n.focus(),n.selectAll&&n.selectAll(),this._inlineEdit=n,this._hideValueCellText(e)),n},doCreateValueEditWidget:function(e){var t=this.getValueEditWidgetInfo(e);return this._doCreateValueEditWidgetByWidgetInfo(e,t)},doCreateDefaultValueEditWidget:function(e){return this._doCreateValueEditWidgetByWidgetInfo(e,this.getDefaultValueEditWidgetInfo())},doCreateReadOnlyValueEditWidget:function(e){var t=this._doCreateValueEditWidgetByWidgetInfo(e,this.getReadOnlyValueEditWidgetInfo());return t.setReadOnly&&t.setReadOnly(!0),t},_doCreateValueEditWidgetByWidgetInfo:function(e,t){var r=this.getRowData(e),n=this.getValueCellText(e,r),i=new(0,t.widgetClass)(this);return t.propValues&&i.setPropValues(t.propValues),i.setValue(n),i},getDefaultValueEditWidgetInfo:function(){return{widgetClass:d.Widget.TextBox}},getReadOnlyValueEditWidgetInfo:function(){return{widgetClass:d.Widget.TextBox}},getValueEditWidgetInfo:function(e){return this.getRowEditInfo(e)||this.getDefaultValueEditWidgetInfo()},getRowElems:function(){return this.getRootElem()?e.getDirectChildElems(this.getRootElem(),this.ROW_ELEM_TAG):[]},getRows:function(){return this.getRowElems()},getRowCount:function(){var e=this.getRowElems();return e?e.length:0},getRowAt:function(e){var t=this.getRowElems();return t?t[e]:null},getPrevRow:function(e){for(var t=this.ROW_ELEM_TAG.toLowerCase(),r=e.previousSibling;r&&(r.nodeType!==Node.ELEMENT_NODE||r.tagName.toLowerCase()!==t);)r=r.previousSibling;return r},getNextRow:function(e){for(var t=this.ROW_ELEM_TAG.toLowerCase(),r=e.nextSibling;r&&(r.nodeType!==Node.ELEMENT_NODE||r.tagName.toLowerCase()!==t);)r=r.nextSibling;return r},getKeyCell:function(t){return e.getDirectChildElems(t,this.CELL_ELEM_TAG)[1]},getCellContentWrapper:function(n,i){var o=e.getDirectChildElems(n),a=o?o[0]:null;return!a&&i&&(a=n.ownerDocument.createElement("span"),n.appendChild(a),t.addClass(a,r.VALUELISTEDITOR_CELL_CONTENT)),a},getValueCellTextWrapper:function(e,n){var i=null,o=this.getCellContentWrapper(e,n);if(o){var a=o.getElementsByTagName("span");!(i=a?a[0]:null)&&n&&(i=e.ownerDocument.createElement("span"),o.appendChild(i),t.addClass(i,r.VALUELISTEDITOR_VALUECELL_TEXT))}return i},_hideValueCellText:function(e){var t=this.getValueCellTextWrapper(this.getValueCell(e));t&&(t.style.visibility="hidden")},_showValueCellText:function(e){var t=this.getValueCellTextWrapper(this.getValueCell(e));t&&(t.style.visibility="visible")},getValueCell:function(t){return e.getDirectChildElems(t,this.CELL_ELEM_TAG)[2]},getParentCell:function(t){return e.getNearestAncestorByTagName(t,this.CELL_ELEM_TAG,!0)},getParentRow:function(t){return e.getNearestAncestorByTagName(t,this.ROW_ELEM_TAG,!0)},_createNewRow:function(e){var t=this.getDocument(),r=this.createRowElem(t);if(r){var n=this.createIndicatorCellElem(t);r.appendChild(n);var i=this.createKeyCellElem(t);r.appendChild(i);var o=this.createValueCellElem(t);r.appendChild(o),e&&this.setRowData(r,e)}return r},insertRowBefore:function(e,t){var r=this._createNewRow(e);return r&&this.getRootElem().insertBefore(r,t||null),r},appendRow:function(e){return this.insertRowBefore(e,null)},removeRow:function(e){return e===this.getActiveRow()&&this.setActiveRow(null),this.getRootElem().removeChild(e),this},removeRowAt:function(e){var t=this.getRowAt(e);return t&&this.removeRow(t),this},clear:function(){this.setActiveRow(null),this.getRootElem()&&d.DomUtils.clearChildContent(this.getRootElem())},updateAll:function(){for(var e=this.getRowElems(),t=0,r=e.length;t<r;++t){var n=e[t],i=this.getRowData(n);this.setRowData(n,i)}return this},valueDisplayModeChanged:function(){this.updateAll()},getKeyCellText:function(e,t){return t.title||t.key},getKeyCellHint:function(e,t){return t.hint||this.getKeyCellText(e,t)},getValueCellText:function(e,t){return this.getValueDisplayMode()===n.JSON?JSON.stringify(t.value):""+t.value},valueCellTextToValue:function(e,t,r){return this.getValueDisplayMode()===n.JSON?JSON.parse(e):e},setValueCellText:function(e,t){var r=this.getRowData(t),n=this.valueCellTextToValue(e,t,r);return r.value=n,this.setRowData(t,r),this},getRowData:function(e){return e[this.ROW_DATA_FIELD]},setRowData:function(e,t){e[this.ROW_DATA_FIELD]=t,this.setRowKeyCellContent(e,this.getKeyCellText(e,t),this.getKeyCellHint(e,t)),this.setRowValueCellContent(e,this.getValueCellText(e,t)),e===this.getActiveRow()&&this._inlineEdit&&this.createValueEditWidget(e)},setRowKeyCellContent:function(e,t,r){var n=this.getKeyCell(e),i=this.getCellContentWrapper(n,!0);i.innerHTML=t,this.getUseKeyHint()&&(i.title=r)},setRowValueCellContent:function(e,t){var r=this.getValueCell(e),n=this.getValueCellTextWrapper(r,!0),i=t;""===i?n.innerHTML="&nbsp;":d.DomUtils.setElementText(n,i)},getRowEditInfo:function(e){return e[this.ROW_EDIT_INFO_FIELD]},setRowEditInfo:function(e,t){e[this.ROW_EDIT_INFO_FIELD]=t,e===this.getActiveRow()&&(this.setActiveRow(null),this.setActiveRow(e))},editRow:function(e){this.setActiveRow(e)},finishEditing:function(){var e=this.getActiveRow();return e&&this._inlineEdit&&(this.setValueCellText(this._inlineEdit.getValue(),e),this.invokeEvent("editFinish",{row:e})),this},cancelEditing:function(){var e=this.getActiveRow();if(e&&this._inlineEdit){var t=this.getRowData(e);this.setRowData(e,t),this.invokeEvent("editCancel",{row:e})}return this},_getTotalHash:function(){for(var e={},t=this.getRowElems(),r=0,n=t.length;r<n;++r){var i=t[r],o=this.getRowData(i);o&&(e[o.key]=o.value)}return e},_setTotalHash:function(e){for(var t=this.getRowElems(),r=t.length,n=d.ObjUtils.getOwnedFieldNames(e),i=n.length,o=0;o<i;++o){var a,s=n[o],l=e[s];o<r?(a=this.getRowAt(o),this.setRowData(a,{key:s,value:l})):a=this.appendRow({key:s,value:l})}if(r>i)for(o=r-1;o>=i;--o)this.removeRow(t[o]);var u=this.getActiveRow();return u&&(this.setActiveRow(null),this.setActiveRow(u)),this},react_click:function(e){var t=e.getTarget(),r=this.getParentRow(t);r&&this.setActiveRow(r)},react_keydown:function(e){var t=e.getKeyCode();if(!(e.getAltKey()||e.getShiftKey()||e.getCtrlKey())){var r,n=this.getActiveRow();n&&(t===d.X.Event.KeyCode.UP?r=this.getPrevRow(n):t===d.X.Event.KeyCode.DOWN&&(r=this.getNextRow(n)),r&&this.setActiveRow(r))}},react_keyup:function(e){var t=e.getKeyCode();t===d.X.Event.KeyCode.ESC?this.cancelEditing():t===d.X.Event.KeyCode.ENTER&&this.finishEditing()},react_blur:function(e){}}),d.Widget.ValueListEditor.ValueDisplayMode={SIMPLE:0,JSON:1};var n=d.Widget.ValueListEditor.ValueDisplayMode}(),function(){"use strict";d.DomUtils,d.HtmlElementUtils;var e=d.Widget.HtmlClassNames;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{COLORPICKER:"K-ColorPicker",COLORPICKER_HEADER:"K-ColorPicker-Header",COLORPICKER_SPEC_COLOR_PALETTE:"K-ColorPicker-Spec-Color-Palette",COLORPICKER_HEXBOX:"K-ColorPicker-HexBox",COLORPICKER_PREVIEWER:"K-ColorPicker-Previewer",COLORPICKER_INPUT:"K-ColorPicker-Input",COLORPICKER_BROWSE_BTN:"K-ColorPicker-Browse-Btn",COLORPICKER_PALETTE:"K-ColorPicker-Palette",COLORPICKER_PALETTE_LINE:"K-ColorPicker-Palette-Line",COLORPICKER_PALETTE_CELL:"K-ColorPicker-Palette-Cell",COLORPICKER_PALETTE_CELL_TRANSPARENT:"K-ColorPicker-Palette-Cell-Transparent",COLORPICKER_SPEC_COLOR_UNSET:"K-Color-Unset",COLORPICKER_SPEC_COLOR_DEFAULT:"K-Color-Default",COLORPICKER_SPEC_COLOR_MIXED:"K-Color-Mixed",COLORPICKER_SPEC_COLOR_TRANSPARENT:"K-Color-Transparent",COLORDROPTEXTBOX:"K-ColorDropTextBox",COLORDROPBUTTON:"K-ColorDropButton",COLORPREVIEWER:"K-ColorPreviewer"}),d.Widget.ColorPicker=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ColorPicker",COLOR_VALUE_FIELD:"__$colorValue__",COLOR_TEXT_FIELD:"__$colorText__",COLOR_CLASS_FIELD:"__ $colorClass__",BINDABLE_TAG_NAMES:["div","span"],initialize:function(e){this.tryApplySuper("initialize",[e]),this.setUseCornerDecoration(!0),this.setValue("#000000"),this.setTouchAction("none")},initProperties:function(){this.defineProp("value",{dataType:DataType.STRING,setter:function(e){this.setPropStoreFieldValue("value",e),this.getHexBox().innerHTML=e||"&nbsp;",this.getPreviewer().style.backgroundColor=e||"transparent",this.getColorInput()&&(this.getColorInput().value=e)}}),this.defineProp("colorClassName",{dataType:DataType.STRING}),this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e),this._recreateSpecialColorPaletteCells(this.getDocument(),this.getSpecialColorPalette())}}),this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("hexBox",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("palette",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("previewer",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("colorInput",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("specialColorPalette",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("isPicking",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PRIVATE})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.COLORPICKER},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=[];return r.push(this.doCreateHeader(e,t)),r.push(this.doCreatePalette(e,t)),r},doCreateHeader:function(t,r){var n=t.createElement("div");n.className=e.COLORPICKER_HEADER,n.appendChild(this.doCreateSpecialColorPalette(t)),n.appendChild(this.doCreateHexBox(t)),n.appendChild(this.doCreatePreviewer(t));var i=this.doCreateColorInput(t);if(i){n.appendChild(i);var o=this.doCreateColorDialogBtn(t);o&&o.appendToElem(n)}return r.appendChild(n),n},doCreateSpecialColorPalette:function(t){var r=t.createElement("div");return r.className=e.COLORPICKER_SPEC_COLOR_PALETTE,this._recreateSpecialColorPaletteCells(t,r),this.setSpecialColorPalette(r),r},_isPredefinedSpecialColor:function(e){var t=d.Widget.ColorPicker.SpecialColors;return[t.UNSET,t.DEFAULT,t.MIXED,t.TRANSPARENT].indexOf(e)>=0},_getPredefinedSpecialColorInfo:function(t){var r=d.Widget.ColorPicker.SpecialColors,n=[r.UNSET,r.DEFAULT,r.MIXED,r.TRANSPARENT],i=[e.COLORPICKER_SPEC_COLOR_UNSET,e.COLORPICKER_SPEC_COLOR_DEFAULT,e.COLORPICKER_SPEC_COLOR_MIXED,e.COLORPICKER_SPEC_COLOR_TRANSPARENT],o=[d.$L("WidgetTexts.S_COLOR_UNSET"),d.$L("WidgetTexts.S_COLOR_DEFAULT"),d.$L("WidgetTexts.S_COLOR_MIXED"),d.$L("WidgetTexts.S_COLOR_TRANSPARENT")],a={value:t},s=n.indexOf(t);return s>=0&&(a.text=o[s],a.className=i[s]),a},_recreateSpecialColorPaletteCells:function(e,t){d.DomUtils.clearChildContent(t);var r=this.getSpecialColors();if(r&&r.length)for(var n=0,i=r.length;n<i;++n){var o,a=r[n],s={};DataType.isObjectValue(a)?s=a:this._isPredefinedSpecialColor(a)?s=this._getPredefinedSpecialColorInfo(a):s.value=a,o=this.doCreatePaletteCell(e,s.value,s.text,s.className),s.className&&d.HtmlElementUtils.addClass(o,s.className),t.appendChild(o)}},doCreateHexBox:function(t){var r=t.createElement("span");return r.className=e.COLORPICKER_HEXBOX,r.innerHTML="&nbsp",this.setHexBox(r),r},doCreatePreviewer:function(t){var r=t.createElement("span");return r.className=e.COLORPICKER_PREVIEWER,r.innerHTML="&nbsp",this.setPreviewer(r),r},doCreateColorInput:function(t){if(d.BrowserFeature.html5Form.supportType("color")){var r=t.createElement("input");r.setAttribute("type","color"),r.className=e.COLORPICKER_INPUT;var n=this;return d.X.Event.addListener(r,"change",(function(e){var t=r.value;n.setValue(t),n.notifyColorSet()})),this.setColorInput(r),r}return null},doCreateColorDialogBtn:function(t){if(d.BrowserFeature.html5Form.supportType("color")){var r=new d.Widget.Button(t);return r.setText(d.$L("WidgetTexts.CAPTION_BROWSE_COLOR")),r.setHint(d.$L("WidgetTexts.HINT_BROWSE_COLOR")),r.setShowText(!1),r.doSetShowGlyph(!0),r.linkStyleResource(d.Widget.StyleResourceNames.ICON_COLOR_PICK),r.addClassName(e.COLORPICKER_BROWSE_BTN),r.addEventListener("execute",this.openColorDialog,this),r}},doCreatePalette:function(t,r){var n=t.createElement("div");n.className=e.COLORPICKER_PALETTE;for(var i=["00","00","11","22","33","44","55","66","77","88","99","AA","BB","CC","DD","EE","FF",null],o=i.length,a=this.doCreatePaletteLine(t),s=0;s<o;s++){var l=i[s]?"#"+i[s]+i[s]+i[s]:"transparent",d=this.doCreatePaletteCell(t,l);a.appendChild(d)}for(n.appendChild(a),o=(i=["00","33","66","99","CC","FF"]).length,s=0;s<o;s++){a=this.doCreatePaletteLine(t);for(var u=0;u<o>>1;u++)for(var c=0;c<o;c++)l="#"+i[u]+i[s]+i[c],d=this.doCreatePaletteCell(t,l),a.appendChild(d);n.appendChild(a)}for(s=0;s<o;s++){for(a=this.doCreatePaletteLine(t),u=o>>1;u<o;u++)for(c=0;c<o;c++)l="#"+i[u]+i[s]+i[c],d=this.doCreatePaletteCell(t,l),a.appendChild(d);n.appendChild(a)}return r.appendChild(n),this.setPalette(n),n},doCreatePaletteCell:function(t,r,n,i){var o=t.createElement("span"),a=e.COLORPICKER_PALETTE_CELL;if("transparent"===r)a+=" "+e.COLORPICKER_PALETTE_CELL_TRANSPARENT;else try{o.style.backgroundColor=r}catch(e){}return o[this.COLOR_VALUE_FIELD]=r,o[this.COLOR_TEXT_FIELD]=n||r,o[this.COLOR_CLASS_FIELD]=i,o.className=a,o.title=n||r,o},doCreatePaletteLine:function(t){var r=t.createElement("div");return r.className=e.COLORPICKER_PALETTE_LINE,r},_isPaletteCellElem:function(t){return d.HtmlElementUtils.hasClass(t,e.COLORPICKER_PALETTE_CELL)},openColorDialog:function(){return this.getColorInput()&&this.getColorInput().click(),this},applyColor:function(e){var t=e[this.COLOR_VALUE_FIELD];t&&this.setValue(t);var r=e[this.COLOR_TEXT_FIELD];r&&(this.getHexBox().innerHTML=r);var n=e[this.COLOR_CLASS_FIELD];this.setColorClassName(n)},notifyColorSet:function(){this.setIsDirty(!0),this.invokeEvent("valueSet",{value:this.getValue(),colorClassName:this.getColorClassName()}),this.invokeEvent("valueChange",{value:this.getValue(),colorClassName:this.getColorClassName()})},doReactActiviting:function(e){this.tryApplySuper("doReactActiviting",[e]);var t=e.getTarget();if(this._isPaletteCellElem(t))return this.setIsPicking(!0),this.applyColor(t),!0},doReactDeactiviting:function(e){if(this.getIsPicking()){this.setIsPicking(!1);var t=e.getTarget();return this._isPaletteCellElem(t)&&this.applyColor(t),this.notifyColorSet(),!0}this.tryApplySuper("doReactDeactiviting",[e])},reactPointerMoving:function(e){if(this.tryApplySuper("reactPointerMoving",[e]),this.getIsPicking()){var t=e.getTarget();if(e.getTouches()){var r={x:e.getClientX(),y:e.getClientY()},n=this.getDocument();t=n.elementFromPoint&&n.elementFromPoint(r.x,r.y)||t,e.preventDefault()}return t&&this._isPaletteCellElem(t)&&this.applyColor(t),e.preventDefault(),!0}}}),d.Widget.ColorPicker.SpecialColors={UNSET:"(unset)",DEFAULT:"(default)",MIXED:"(mixed)",TRANSPARENT:"transparent"},d.Widget.ColorDropTextBox=Class.create(d.Widget.ButtonTextBox,{CLASS_NAME:"Kekule.Widget.ColorDropTextBox",initialize:function(e,t){this.tryApplySuper("initialize",[e]),this.setButtonKind(d.Widget.Button.Kinds.DROPDOWN),this.addEventListener("buttonExecute",this.reactDropbuttonExecute,this),this.setShowPreview(!0),t&&this.setValue(t)},initProperties:function(){this.defineProp("showPreview",{dataType:DataType.BOOL,setter:function(e){this.getPreviewElem().style.display=e?"inherit":""}}),this.defineProp("colorClassName",{dataType:DataType.STRING,setter:function(e){var t=this.getPreviewElem();if(t){var r=this.getColorClassName();r&&d.HtmlElementUtils.removeClass(t,r),e&&d.HtmlElementUtils.addClass(t,e)}this.setPropStoreFieldValue("colorClassName",e)}}),this.defineProp("colorPicker",{dataType:"Kekule.Widget.ColorPicker",setter:null,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("colorPicker");return e||((e=new d.Widget.ColorPicker(this)).setDisplayed(!1),e.getElement().style.position="absolute",e.setSpecialColors(this.getSpecialColors()),e.addEventListener("valueChange",this.reactColorPickerValueSet,this),e.appendToElem(this.getElement()),this.setPropStoreFieldValue("colorPicker",e)),e}}),this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e);var t=this.getPropStoreFieldValue("colorPicker");t&&t.setSpecialColors(e)}})},doFinalize:function(){var e=this.getPropStoreFieldValue("colorPicker");e&&e.finalize(),this.tryApplySuper("doFinalize")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.COLORDROPTEXTBOX},doCreateSubElements:function(t,r){this.tryApplySuper("doCreateSubElements",[t,r]);var n=new d.Widget.DumbWidget(this);return n.addClassName(e.COLORPREVIEWER),this.setHeadingWidget(n),[n.getElement()]},getPreviewElem:function(){var e=this.getHeadingWidget();if(e)return e.getElement()},showColorPicker:function(){var e=this.getColorPicker();e.isShown()||(e.setValue(this.getValue()),e.show(this,null,d.Widget.ShowHideType.DROPDOWN))},hideColorPicker:function(){var e=this.getPropStoreFieldValue("colorPicker");e&&e.isShown()&&e.hide()},reactDropbuttonExecute:function(e){this.showColorPicker()},reactColorPickerValueSet:function(e){var t=e.value;this.setValue(t),this.setIsDirty(this.getIsDirty()||this.getColorPicker().getIsDirty()),this.setColorClassName(e.colorClassName),this.hideColorPicker(),e.stopPropagation()},doSetValue:function(e){this.tryApplySuper("doSetValue",[e]);var t=this.getPreviewElem();t&&(t.style.backgroundColor="transparent",t.style.backgroundColor=e)}}),d.Widget.ColorDropButton=Class.create(d.Widget.DropDownButton,{CLASS_NAME:"Kekule.Widget.ColorDropButton",initialize:function(e,t){this.tryApplySuper("initialize",[e]),this.setButtonKind(d.Widget.Button.Kinds.DROPDOWN),this.setShowPreview(!0),t&&this.setValue(t)},initProperties:function(){this.defineProp("showPreview",{dataType:DataType.BOOL,setter:function(e){try{this.getPreviewElem().style.display=e?"inherit":""}catch(e){}}}),this.defineProp("value",{dataType:DataType.STRING,getter:function(){return this.getText()},setter:function(e){this.setText(e),this.updateColorPreview(e);var t=this.getPropStoreFieldValue("colorPicker");t&&t.setValue(e)}}),this.defineProp("colorClassName",{dataType:DataType.STRING,setter:function(e){var t=this.getPreviewElem();if(t){var r=this.getColorClassName();r&&d.HtmlElementUtils.removeClass(t,r),e&&d.HtmlElementUtils.addClass(t,e)}this.setPropStoreFieldValue("colorClassName",e)}}),this.defineProp("colorPicker",{dataType:"Kekule.Widget.ColorPicker",setter:null,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("colorPicker");return e||((e=new d.Widget.ColorPicker(this)).setDisplayed(!1),e.getElement().style.position="absolute",e.setSpecialColors(this.getSpecialColors()),e.addEventListener("valueChange",this.reactColorPickerValueSet,this),this.setPropStoreFieldValue("colorPicker",e)),e}}),this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e);var t=this.getPropStoreFieldValue("colorPicker");t&&t.setSpecialColors(e)}}),this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getColorPicker().getIsDirty()},setter:function(e){this.getColorPicker().setIsDirty(e)}})},doFinalize:function(){var e=this.getPropStoreFieldValue("colorPicker");e&&e.finalize(),this.tryApplySuper("doFinalize")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.COLORDROPBUTTON},doGetDropDownWidget:function(){return this.getColorPicker()},getPreviewElem:function(){return this._elemLeadingGlyphPart},showColorPicker:function(){var e=this.getColorPicker();e.isShown()||(e.setValue(this.getValue()),e.show(this,null,d.Widget.ShowHideType.DROPDOWN))},hideColorPicker:function(){var e=this.getPropStoreFieldValue("colorPicker");e&&e.isShown()&&e.hide()},reactColorPickerValueSet:function(e){var t=e.value,r=e.colorClassName;this.setValue(t),this.setColorClassName(r),this.hideColorPicker(),this.invokeEvent("valueChange",{value:t}),e.stopPropagation()},updateColorPreview:function(e){var t=this.getPreviewElem();t&&(t.style.backgroundColor="transparent",t.style.backgroundColor=e)}})}(),function(){"use strict";d.DomUtils,d.HtmlElementUtils;var e=d.Widget.HtmlClassNames;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{TEXTEDITOR:"K-TextEditor",TEXTEDITOR_TOOLBAR:"K-TextEditor-Toolbar",TEXTEDITOR_TEXTAREA:"K-TextEditor-TextArea",TEXTEDITOR_FONTBOX:"K-TextEditor-FontBox",TEXTEDITOR_BTN_FONTSIZEINC:"K-TextEditor-Btn-FontSizeInc",TEXTEDITOR_BTN_FONTSIZEDEC:"K-TextEditor-Btn-FontSizeDec",TEXTEDITOR_BTN_TEXTWRAP:"K-TextEditor-Btn-TextWrap"}),d.Widget.TextEditor=Class.create(d.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextEditor",BINDABLE_TAG_NAMES:["div","span"],DEF_TOOLBAR_COMPONENTS:["fontFamily","fontSizeInc","fontSizeDec","textWrap"],DEF_AUTOWRAP_THRESHOLD:80,initialize:function(e){this._toolCompWidgets=[],this.setPropStoreFieldValue("showToolbar",!0),this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this.getTextArea();return e?e.getText():null},setter:function(e){var t=this.getTextArea();t&&(t.setText(e),this._checkAutoWrap())}}),this.defineProp("readOnly",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getTextArea().getReadOnly()},setter:function(e){return this.getTextArea().setReadOnly(e)}}),this.defineProp("wrap",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getTextArea().getWrap()},setter:function(e){var t=this.getTextArea().setWrap(e);return this.updateToolButtonStates(),t}}),this.defineProp("autoWrapThreshold",{dataType:DataType.INT,setter:function(e){var t=!0===e?this.DEF_AUTOWRAP_THRESHOLD:e;this.setPropStoreFieldValue("autoWrapThreshold",t),this._checkAutoWrap()}}),this.defineProp("textArea",{dataType:"Kekule.Widget.TextArea",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE,getter:function(){var e=this.getPropStoreFieldValue("textArea");return e||(e=this.createTextArea(),this.setPropStoreFieldValue("textArea",e)),e}}),this.defineProp("toolbar",{dataType:"Kekule.Widget.Toolbar",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE,getter:function(){var e=this.getPropStoreFieldValue("toolbar");return e||this.getShowToolbar()&&(e=this.createToolbar(),this.setPropStoreFieldValue("styleToolbar",e)),e}}),this.defineProp("showToolbar",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showToolbar",e),this.getToolbar().setDisplayed(e)}}),this.defineProp("toolbarPos",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("toolbarPos",e),this.updateChildWidgetPos()}}),this.defineProp("toolbarComponents",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("toolbarComponents");return e||(e=null,this.setPropStoreFieldValue("toolbarComponents",e)),e},setter:function(e){this.setPropStoreFieldValue("toolbarComponents",e),this.recreateToolbarComponents(e)}}),this.defineProp("candidateFontFamilies",{dataType:DataType.ARRAY}),this.defineProp("fontSizeLevel",{dataType:DataType.FLOAT,setter:function(e){this.setPropStoreFieldValue("fontSizeLevel",e),this.setTextStyle({fontSize:e+"em"})}})},finalize:function(){this._finalizeSubElements(),this.tryApplySuper("finalize")},_finalizeSubElements:function(){var e=this.getTextArea();e&&e.finalize()},getCoreElement:function(){var e=this.getTextArea();return e?e.getElement():this.tryApplySuper("getCoreElement")},getChildrenHolderElement:function(){return this.getElement()},doSetValue:function(e){this.tryApplySuper("doSetValue",[e]),this._checkAutoWrap()},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TEXTEDITOR},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=this.createToolbar();r&&r.appendToElem(t);var n=this.createTextArea();return n.appendToElem(t),this.updateChildWidgetPos(),[r.getElement(),n.getElement()]},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),e&&(this.updateChildWidgetPos(),this.updateToolButtonStates())},doFileDragDrop:function(e){if(e){if(d.BrowserFeature.fileapi){var t=this,r=new FileReader;r.onload=function(e){var n=r.result;t.setText(n)},r.readAsText(e[0])}return!0}return this.tryApplySuper("doFileDragDrop")},createToolbar:function(){if(this.getShowToolbar()){var t=new d.Widget.Toolbar(this);return this.setPropStoreFieldValue("toolbar",t),t.addClassName(e.TEXTEDITOR_TOOLBAR),this.recreateToolbarComponents(),t}return null},recreateToolbarComponents:function(e){e||(e=this.getToolbarComponents());var t=e||this.DEF_TOOLBAR_COMPONENTS,r=this.getToolbar();if(r){var n;this._toolCompWidgets.length=0,r.clearWidgets(),r.setShowText(!1),r.setShowGlyph(!0);for(var i=0,o=t.length;i<o;++i){var a=t[i];n="fontFamily"===a?this.createFontFamilyComboBox(r):this.createToolButton(r,a),this._toolCompWidgets[a]=n}this.updateToolButtonStates()}},createFontFamilyComboBox:function(t){for(var r=new d.Widget.ComboBox(t),n=d.Widget.FontEnumerator.getAvailableFontFamilies(this.getCandidateFontFamilies()),i=[],o=0,a=n.length;o<a;++o)i.push({text:n[o],value:n[o]});return r.setHint(d.$L("WidgetTexts.HINT_CHOOSE_FONT_FAMILY")),r.addClassName(e.TEXTEDITOR_FONTBOX),r.setItems(i),r.appendToWidget(t),r.addEventListener("valueChange",(function(e){this.setTextStyle({fontFamily:r.getValue()})}),this),r},createToolButton:function(t,r){var n,i,o,a=new("textWrap"===r?d.Widget.CheckButton:d.Widget.Button)(t);return a.appendToWidget(t),"textWrap"===r?(n=d.$L("WidgetTexts.CAPTION_TOGGLE_TEXTWRAP"),i=d.$L("WidgetTexts.HINT_TOGGLE_TEXTWRAP"),o=e.TEXTEDITOR_BTN_TEXTWRAP,a.setChecked("off"!==this.getWrap()),a.addEventListener("checkChange",(function(e){var t=a.getChecked();this.setWrap(t?"soft":"off")}),this)):"fontSizeInc"===r?(n=d.$L("WidgetTexts.CAPTION_INC_TEXT_SIZE"),i=d.$L("WidgetTexts.HINT_INC_TEXT_SIZE"),o=e.TEXTEDITOR_BTN_FONTSIZEINC,a.addEventListener("execute",this.increaseTextSize,this)):"fontSizeDec"===r&&(n=d.$L("WidgetTexts.CAPTION_DEC_TEXT_SIZE"),i=d.$L("WidgetTexts.HINT_DEC_TEXT_SIZE"),o=e.TEXTEDITOR_BTN_FONTSIZEDEC,a.addEventListener("execute",this.decreaseTextSize,this)),a.setText(n),a.setHint(i),a.addClassName(o),a},createToolCheckButton:function(e,t){var r=new d.Widget.CheckButton(e);return r.appendToWidget(e),r},getToolbarComponentWidget:function(e){return this._toolCompWidgets[e]},createTextArea:function(){var t=new d.Widget.TextArea(this);return this.setPropStoreFieldValue("textArea",t),t.addClassName(e.TEXTEDITOR_TEXTAREA),t.addEventListener("valueChange",this._checkAutoWrap,this),t.addEventListener("valueInput",this._checkAutoWrap,this),t},updateChildWidgetPos:function(){var e=this.getToolbarPos(),t=this.getToolbar().getElement(),r=this.getTextArea().getElement(),n=t.parentNode;e===d.Widget.Position.BOTTOM?n.insertBefore(r,t):n.insertBefore(t,r)},updateToolButtonStates:function(){var e=this._toolCompWidgets.textWrap;e&&e.setChecked("off"!==this.getWrap())},setTextStyle:function(e){var t=this.getTextArea();if(t)for(var r=d.ObjUtils.getOwnedFieldNames(e),n=0,i=r.length;n<i;++n){var o=r[n];t.setStyleProperty(o,e[o])}return this},increaseTextSize:function(){var e=this.getFontSizeLevel()||1,t=d.ZoomUtils.getNextZoomInRatio(e);this.setFontSizeLevel(t)},decreaseTextSize:function(){var e=this.getFontSizeLevel()||1,t=d.ZoomUtils.getNextZoomOutRatio(e);this.setFontSizeLevel(t)},_checkAutoWrap:function(){var e=this.getAutoWrapThreshold();if(e){var t=this.getToolbarComponentWidget("textWrap"),r=((this.getWrap()||"").toLowerCase(),this.getValue()||""),n=r.split("\n").length,i=r.length/n;t.setChecked(i>e)}}})}(),function(){"use strict";var e=d.ArrayUtils,t=d.StyleUtils,r=d.DomUtils,n=d.HtmlElementUtils;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{WIDGET_GRID:"K-Widget-Grid",WIDGET_GRID_CELL:"K-Widget-Grid-Cell",WIDGET_GRID_ADD_CELL:"K-Widget-Grid-Add-Cell",WIDGET_GRID_INTERACTION_AREA:"K-Widget-Grid-Interaction-Area",WIDGET_GRID_WIDGET_PARENT:"K-Widget-Grid-Widget-Parent",WIDGET_GRID_BUTTON_REMOVE:"K-Widget-Grid-Button-Remove",WIDGET_GRID_ENABLE_CELL_INTERACTION:"K-Widget-Grid-Enable-Cell-Interaction"});var i=d.Widget.HtmlClassNames;d.Widget.WidgetGrid=Class.create(d.Widget.Container,{CLASS_NAME:"Kekule.Widget.WidgetGrid",CELL_FIELD:"__$cell__",WIDGET_FIELD:"__$cellWidget__",INTERACTION_AREA_FIELD:"__$interactionArea__",EXCEED_TOPRIGHT_FIELD:"__$exceedTopRight__",BTN_REMOVE_CELL_FIELD:"__$removeCell__",initialize:function(e){this._floatClearer=null,this.reactCellMouseEnterBind=this.reactCellMouseEnter.bind(this),this.reactCellMouseLeaveBind=this.reactCellMouseLeave.bind(this),this.reactCellClickBind=this.reactCellClick.bind(this),this.tryApplySuper("initialize",[e]),this.addEventListener("change",this.reactChildWidgetChange,this)},initProperties:function(){this.defineProp("childWidgetClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("cellWidth",{dataType:DataType.STRING}),this.defineProp("cellHeight",{dataType:DataType.STRING}),this.defineProp("widgetPos",{dataType:DataType.INT,enumSource:d.Widget.Position}),this.defineProp("autoShrinkWidgets",{dataType:DataType.BOOL}),this.defineProp("keepWidgetAspectRatio",{dataType:DataType.BOOL}),this.defineProp("restoreWidgetSizeOnHotTrack",{dataType:DataType.BOOL}),this.defineProp("enableAdd",{dataType:DataType.BOOL,setter:function(e){if(this.setPropStoreFieldValue("enableAdd",e),e)this.setAddingCell(this.createAddCell());else{var t=this.getAddingCell();t&&this.getContainerElement().removeChild(t)}}}),this.defineProp("enableRemove",{dataType:DataType.BOOL,getter:function(){return this.hasClassName(i.WIDGET_GRID_ENABLE_CELL_INTERACTION)},setter:function(e){e?this.addClassName(i.WIDGET_GRID_ENABLE_CELL_INTERACTION):this.removeClassName(i.WIDGET_GRID_ENABLE_CELL_INTERACTION)}}),this.defineProp("hotCell",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){this.getHotCell()!==e&&(this.hotCellChanged(this.getHotCell(),e),this.setPropStoreFieldValue("hotCell",e))}}),this.defineProp("addingCell",{dataType:DataType.OBJECT,serializable:!1})},initPropValues:function(){this.setPropStoreFieldValue("autoShrinkWidgets",!0),this.setPropStoreFieldValue("keepWidgetAspectRatio",!0),this.setPropStoreFieldValue("restoreWidgetSizeOnHotTrack",!0),this.setEnableRemove(!0),this.setUseCornerDecoration(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.WIDGET_GRID},doCreateRootElement:function(e){return e.createElement("div")},doSetUseCornerDecoration:function(e){this.tryApplySuper("doSetUseCornerDecoration",[e]),this.updateAllCells()},doObjectChange:function(t){this.tryApplySuper("doObjectChange",[t]),e.intersect(t,["autoShrinkWidgets","keepWidgetAspectRatio","cellWidth","cellHeight","widgetPos"]).length>0&&this.updateAllCells()},doWidgetShowStateChanged:function(e){return e&&this.updateAllCells(),this.tryApplySuper("doWidgetShowStateChanged",[e])},each:function(e){for(var t=d.ArrayUtils.clone(this.getChildWidgets()),r=0,n=t.length;r<n;++r)e(t[r])},addWidget:function(e){e.setParent(this)},removeWidget:function(e,t){this.hasChild(e)&&(e.setParent(null),t&&e.finalize())},createWidget:function(){var e=this.doCreateNewChildWidget(this.getDocument());if(e)return e.setParent(this),e},doCreateNewChildWidget:function(e){return null},getFloatClearer:function(){return this._floatClearer||(this._floatClearer=this.getDocument().createElement("div"),this._floatClearer.style.clear="both",this.getContainerElement().appendChild(this._floatClearer)),this._floatClearer},createCell:function(e){var t=!e,r=this.getDocument(),n=r.createElement("div");n.className=i.WIDGET_GRID_CELL+" "+i.DYN_CREATED+(t?" "+i.WIDGET_GRID_ADD_CELL:""),n[this.WIDGET_FIELD]=e,d.X.Event.addListener(n,"mouseenter",this.reactCellMouseEnterBind),d.X.Event.addListener(n,"mouseleave",this.reactCellMouseLeaveBind),d.X.Event.addListener(n,"click",this.reactCellClickBind);var o=r.createElement("div");if(o.className=i.WIDGET_GRID_WIDGET_PARENT+" "+i.DYN_CREATED,o[this.WIDGET_FIELD]=e,t&&(o.innerHTML=d.$L("WidgetTexts.CAPTION_ADD_CELL"),o.title=d.$L("WidgetTexts.HINT_ADD_CELL")),n.appendChild(o),e&&(e.appendToElem(o),e[this.CELL_FIELD]=n),!t){var a=r.createElement("div");a.className=i.WIDGET_GRID_INTERACTION_AREA+" "+i.DYN_CREATED,n.appendChild(a),o[this.INTERACTION_AREA_FIELD]=a,n[this.INTERACTION_AREA_FIELD]=a,this.createCellInteractionWidgets(a,n)}return this.getAddingCell()&&!t?this.getContainerElement().insertBefore(n,this.getAddingCell()):this.getContainerElement().insertBefore(n,this.getFloatClearer()),this.updateCell(n),n},createAddCell:function(){return this.createCell(null)},createCellInteractionWidgets:function(e,t){var r=new d.Widget.Button(e.ownerDocument);r.setText(d.$L("WidgetTexts.CAPTION_REMOVE_CELL")),r.setHint(d.$L("WidgetTexts.HINT_REMOVE_CELL")),r.addClassName(i.WIDGET_GRID_BUTTON_REMOVE),r[this.BTN_REMOVE_CELL_FIELD]=!0;var n=this.getContainingWidget(t);r[this.WIDGET_FIELD]=n,r.setShowText(!1),r.setShowGlyph(!0),r.addEventListener("execute",(function(e){var t=e.widget[this.WIDGET_FIELD];this.removeWidget(t,!0)}),this),r.appendToElem(e)},getWidgetCell:function(e){return e[this.CELL_FIELD]},getWidgetParentElem:function(e){var t=e.getElement();return t&&t.parentNode},getWidgetParentElemOfCell:function(e){return e.children[0]},getInteractionAreaElemOfCell:function(e){return e[this.INTERACTION_AREA_FIELD]},getContainingWidget:function(e){return e[this.WIDGET_FIELD]},childWidgetAdded:function(e){this.tryApplySuper("childWidgetAdded",[e]),this.createCell(e)},childWidgetRemoved:function(e){this.tryApplySuper("childWidgetRemoved",[e]);var t=this.getWidgetCell(e);this.getContainerElement().removeChild(t)},childWidgetMoved:function(e,t){this.tryApplySuper("childWidgetMoved",[e,t]);var r=this.getWidgetCell(e),n=this.getChildWidgets()[t+1],i=n?this.getWidgetCell(n):null;i?this.getContainerElement().insertBefore(r,i):this.getContainerElement().appendChild(r)},childrenModified:function(){this.getContainerElement().appendChild(this.getFloatClearer())},getAllCells:function(){for(var e=this.getChildWidgets(),t=[],r=0,n=e.length;r<n;++r)t.push(this.getWidgetCell(e[r]));return this.getAddingCell()&&t.push(this.getAddingCell()),t},updateCell:function(e,r){var o=e.style,a=this.getCellWidth(),s=this.getCellHeight();a?o.width=a:t.removeStyleProperty(o,"width"),s?o.height=s:t.removeStyleProperty(o,"height"),this.getUseCornerDecoration()?n.addClass(e,i.CORNER_ALL):n.removeClass(e,i.CORNER_ALL),this.adjustCellWidgetPos(e,r),this.adjustInteractionArea(e,r)},adjustCellWidgetPos:function(e,r){for(var i=this.getWidgetParentElemOfCell(e),o=n.getElemOffsetDimension(i),a=n.getElemClientDimension(e),s=["top","right","bottom","left"],l={},u=0,c=s.length;u<c;++u){var h=t.getComputedStyle(e,"padding-"+s[u]);l[s[u]]=t.analysisUnitsValue(h).value||0}var p=Object.extend({},a);p.width-=l.left+l.right,p.height-=l.top+l.bottom;var g=this.getWidgetPos(),f=d.Widget.Position,m=g&f.LEFT?l.left:g&f.RIGHT?a.width-o.width-l.right:(p.width-o.width)/2+l.left,C=g&f.TOP?l.top:g&f.BOTTOM?a.height-o.height-l.bottom:(p.height-o.height)/2+l.top;i.style.left=m+"px",i.style.top=C+"px";var y=this.getInteractionAreaElemOfCell(e);if(y){var _=n.getElemClientDimension(y),E=m+o.width+_.width>=a.width&&C<=_.height;e[this.EXCEED_TOPRIGHT_FIELD]=E}if(this.getAutoShrinkWidgets()&&!r||!this.getRestoreWidgetSizeOnHotTrack()){var T=o.width>p.width?p.width/o.width:null,O=o.height>p.height?p.height/o.height:1;if(this.getKeepWidgetAspectRatio()){var v=T&&O?Math.min(T,O):T||O;T=v,O=v}i.style.transform="scale("+T+", "+O+")";var S=g&f.LEFT?"0":g&f.RIGHT?"100%":"50%",b=g&f.TOP?"0":g&f.BOTTOM?"100%":"50%";i.style.transformOrigin=S+" "+b}else i.style.transform="none"},adjustInteractionArea:function(e,t){var r=this.getInteractionAreaElemOfCell(e);r&&(t?e[this.EXCEED_TOPRIGHT_FIELD]&&this.getWidgetParentElemOfCell(e).appendChild(r):e.appendChild(r))},updateAllCells:function(){for(var e=this.getAllCells(),t=0,r=e.length;t<r;++t)this.updateCell(e[t],e[t]===this.getHotCell())},restoreCellShrink:function(e){var t=this.getWidgetParentElemOfCell(e);t&&(t.style.transform="none")},hotCellChanged:function(e,t){e&&(this.updateCell(e,!1),n.removeClass(e,i.STATE_HOVER)),t&&(n.addClass(t,i.STATE_HOVER),this.getRestoreWidgetSizeOnHotTrack()&&(this.restoreCellShrink(t),this.adjustInteractionArea(t,!0)))},reactCellMouseEnter:function(e){var t=e.getTarget();this.setHotCell(t)},reactCellMouseLeave:function(e){var t=e.getTarget();this.getHotCell()===t&&this.setHotCell(null)},reactCellClick:function(e){var t=e.getTarget();(r.isDescendantOf(t,this.getAddingCell())||t===this.getAddingCell())&&this.createWidget()},reactChildWidgetChange:function(e){var t=e.widget;t&&this.hasChild(t)&&this.updateCell(this.getWidgetCell(t),this.getHotCell()===this.getWidgetCell(t))}})}(),function(){"use strict";var e=d.DomUtils,t=d.HtmlElementUtils,r=d.StyleUtils,n=d.Widget.HtmlClassNames;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{PROPLISTEDITOR:"K-PropListEditor",PROPLISTEDITOR_PROPEXPANDMARKER:"K-PropListEditor-PropExpandMarker",PROPLISTEDITOR_PROPEXPANDED:"K-PropListEditor-PropExpanded",PROPLISTEDITOR_PROPCOLLAPSED:"K-PropListEditor-PropCollapsed",PROPLISTEDITOR_INDENTDECORATOR:"K-PropListEditor-IndentDecorator",PROPLISTEDITOR_READONLY:"K-PropListEditor-ReadOnly",OBJINSPECTOR:"K-ObjInspector",OBJINSPECTOR_FLEX_LAYOUT:"K-ObjInspector-Flex-Layout",OBJINSPECTOR_SUBPART:"K-ObjInspector-SubPart",OBJINSPECTOR_OBJSINFOPANEL:"K-ObjInspector-ObjsInfoPanel",OBJINSPECTOR_PROPINFOPANEL:"K-ObjInspector-PropInfoPanel",OBJINSPECTOR_PROPINFO_TITLE:"K-ObjInspector-PropInfoPanel-Title",OBJINSPECTOR_PROPINFO_DESCRIPTION:"K-ObjInspector-PropInfoPanel-Description",OBJINSPECTOR_PROPLISTEDITOR_CONTAINER:"K-ObjInspector-PropListEditorContainer"}),d.Widget.ObjPropListEditor=Class.create(d.Widget.ValueListEditor,{CLASS_NAME:"Kekule.Widget.ObjPropListEditor",PARENT_ROW_FIELD:"__$parentRow__",SUB_ROWS_FIELD:"__$subRows__",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setValueDisplayMode(d.Widget.ValueListEditor.ValueDisplayMode.SIMPLE),this.setPropStoreFieldValue("displayedPropScopes",[Class.PropertyScope.PUBLISHED]),this.setEnableLiveUpdate(!0),this.setSubPropNamePadding("1em"),this.setUseKeyHint(!0)},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=d.ArrayUtils.toArray(e),r=this.getObjects();this.setPropStoreFieldValue("objects",t),this.inspectedObjectsChanged(t,r)}}),this.defineProp("displayedPropScopes",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("displayedPropScopes",e),this.updateAll()}}),this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL}),this.defineProp("subPropNamePadding",{dataType:DataType.STRING}),this.defineProp("activePropEditor",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getActiveRow();return e?this.getRowPropEditor(e):null}}),this.defineProp("keyField",{dataType:DataType.STRING}),this.defineProp("sortField",{dataType:DataType.STRING}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,scope:Class.PropertyScope.PUBLIC})},doFinalize:function(){this.tryApplySuper("doFinalize")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setKeyField("title"),this.setSortField("key")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.PROPLISTEDITOR},inspectedObjectsChanged:function(e,t){var r=d.ArrayUtils.toArray(e);t&&this._uninstallObjectsEventHandlers(t),e&&this._installObjectsEventHandlers(r),this.updateAll(r)},_installObjectsEventHandlers:function(e){for(var t=0,r=e.length;t<r;++t){var n=e[t];n.addEventListener&&n.addEventListener("change",this.reactObjectsChange,this)}},_uninstallObjectsEventHandlers:function(e){for(var t=0,r=e.length;t<r;++t){var n=e[t];n.removeEventListener&&n.removeEventListener("change",this.reactObjectsChange,this)}},reactObjectsChange:function(e){if(this.getEnableLiveUpdate()){var t=e.changedPropNames;this.updateValues(t)}},getKeyCellExpandMarker:function(r,i){var o=null,a=this.getCellContentWrapper(r,i);if(a){for(var s=e.getDirectChildElems(a)||[],l=0,d=s.length;l<d;++l){var u=s[l];if(t.hasClass(u,n.PROPLISTEDITOR_PROPEXPANDMARKER)){o=u;break}}if(!o&&i){o=this.getDocument().createElement("span"),t.addClass(o,n.PROPLISTEDITOR_PROPEXPANDMARKER);var c=e.getChildNodesOfTypes(a,[Node.ELEMENT_NODE,Node.TEXT_NODE])[0];a.insertBefore(o,c)}}return o},getKeyCellIndentDecorator:function(r,i){var o=null,a=this.getCellContentWrapper(r,i);if(a){for(var s=e.getDirectChildElems(a)||[],l=0,d=s.length;l<d;++l){var u=s[l];if(t.hasClass(u,n.PROPLISTEDITOR_INDENTDECORATOR)){o=u;break}}if(!o&&i){o=this.getDocument().createElement("div"),t.addClass(o,n.PROPLISTEDITOR_INDENTDECORATOR);var c=e.getChildNodesOfTypes(a,[Node.ELEMENT_NODE,Node.TEXT_NODE])[0];a.insertBefore(o,c)}}return o},setRowKeyCellContent:function(e,t,r){var n=this.tryApplySuper("setRowKeyCellContent",[e,t,r]),i=this.getKeyCell(e),o=(this.getKeyCellExpandMarker(i,!0),this.getRowSubLevel(e)),a=this.getSubPropNamePadding();if(a){d.StyleUtils.multiplyUnitsValue(a,o),a=d.StyleUtils.multiplyUnitsValue(a,o);var s=this.getKeyCell(e);this.getCellContentWrapper(s,!0).style.paddingLeft=a}return n},updateAll:function(e){if(e||(e=this.getObjects()),e&&e.length){this.setActiveRow(null),this.collapseAllRows(),e[0];var t=this.getDisplayPropEditors(e);this.sortPropEditors(t),e.length;var r=this.getRows(),n=r.length,i=t.length,o=0,a=0,s=this.getValueDisplayMode();for(o=0;o<i;++o){var l=t[o];if(l.setValueTextMode(s),this.isPropEditorVisible(l)){var d=a<n?r[a]:this.appendRow();this.setRowPropEditor(d,l),++a}}if(n>a)for(o=n-1;o>=a;--o)this.removeRow(r[o]);return this}this.clear()},updateValues:function(e){for(var t=e&&e.length,r=this.getRows(),n=0,i=r.length;n<i;++n){var o=r[n];if(t){var a=this.getRowPropEditor(o);if(!a||e.indexOf(a.getPropertyName())<0)continue}this.updateRowPropValue(o)}},updateRowPropValue:function(e){var t=this.getRowPropEditor(e).getValueText(),r=this.getRowData(e);r.value=t,this.setRowData(e,r),this.updateRowExpandState(e);var n=this.getSubPropRows(e);if(n)for(var i=0,o=n.length;i<o;++i)this.updateRowPropValue(n[i])},setRowPropEditor:function(e,r){var i,o=this.getKeyField()||"title";o&&(i="name"===o?r.getPropertyName():"title"===o?r.getTitle():r.getPropertyInfo()[o]),i||(i=r.getTitle()||r.getPropertyName());var a={key:r.getPropertyName(),value:r.getValueText(),title:i,hint:r.getHint(),propEditor:r,expanded:!1};r.isReadOnly()?t.addClass(e,n.PROPLISTEDITOR_READONLY):t.removeClass(e,n.PROPLISTEDITOR_READONLY),this.setRowData(e,a),this.updateRowExpandState(e)},getRowCascadeKey:function(e){if(e&&this.getRowData(e)){var t=this.getRowData(e).key,r=this.getParentPropRow(e);return r&&(t=this.getRowCascadeKey(r)+"."+t),t}return null},getActiveRowCascadeKey:function(){var e=this.getActiveRow();return e&&this.getRowCascadeKey(e)},getRowPropEditor:function(e){var t=this.getRowData(e);return t?t.propEditor:null},getPropEditor:function(e,t){var r=d.PropertyEditor.findEditorClass(e,t);return r?new r:null},getPropEditorForType:function(e,t){var r=d.PropertyEditor.findEditorClassForType(e,t);return r?new r:null},isPropEditorVisible:function(e){var t=!0;if(t=!(e.getObjects().length>1)||e.getAttributes()&d.PropertyEditor.EditorAttributes.MULTIOBJS){var r=e.getPropertyInfo();if(r){var n=r.scope||Class.PropertyScope.DEFAULT;if(n){var i=this.getDisplayedPropScopes();i&&(t=i.indexOf(n)>=0)}}}return t},isRowExpandable:function(e){var t=this.getRowPropEditor(e);return!!t&&t.hasSubPropertyEditors()},isRowExpanded:function(e){return!!this.getRowData(e).expanded},updateRowExpandState:function(e){var r=this.isRowExpandable(e);r||this.removeSubPropertyRows(e),t.removeClass(e,n.PROPLISTEDITOR_PROPCOLLAPSED),t.removeClass(e,n.PROPLISTEDITOR_PROPEXPANDED),r&&(this.isRowExpanded(e)?t.addClass(e,n.PROPLISTEDITOR_PROPEXPANDED):t.addClass(e,n.PROPLISTEDITOR_PROPCOLLAPSED))},expandRow:function(e){return this._doExpandRow(e),this},_doExpandRow:function(e){if(this.isRowExpandable(e)&&!this.isRowExpanded(e)){t.removeClass(e,n.PROPLISTEDITOR_PROPCOLLAPSED),t.addClass(e,n.PROPLISTEDITOR_PROPEXPANDED),this.getRowData(e).expanded=!0;var r=this.getRowPropEditor(e).getSubPropertyEditors(this.getDisplayedPropScopes());return e[this.SUB_ROWS_FIELD]=this.addSubPropertyRows(e,r),e[this.SUB_ROWS_FIELD]}return null},collapseRow:function(e){return this.isRowExpandable(e)&&this.isRowExpanded(e)&&(t.removeClass(e,n.PROPLISTEDITOR_PROPEXPANDED),t.addClass(e,n.PROPLISTEDITOR_PROPCOLLAPSED),this.getRowData(e).expanded=!1,this.removeSubPropertyRows(e)),this},toggleRowExpandState:function(e){return this.isRowExpanded(e)?this.collapseRow(e):this.expandRow(e),this},collapseAllRows:function(){for(var e=this.getRows(),t=0,r=e.length;t<r;++t)this.collapseRow(e[t]);return this},expandAllRows:function(e){var t=this;return function e(r,n){for(var i=0,o=r.length;i<o;++i){var a=t._doExpandRow(r[i]);a&&n&&e(a,n)}}(this.getRows(),e),this},addSubPropertyRows:function(e,t){var r=this.getNextRow(e),n=[];if(t&&t.length){this.sortPropEditors(t);for(var i=0,o=t.length;i<o;++i){var a=t[i];this.isPropEditorVisible(a)&&n.push(this.addSubPropRow(e,a,r))}}return n},addSubPropRow:function(e,t,r){var n=this.insertRowBefore(null,r);return n[this.PARENT_ROW_FIELD]=e,this.setRowPropEditor(n,t),n},removeSubPropertyRows:function(e){for(var t=this.getSubPropRows(e),r=t.length-1;r>=0;--r)this.removeSubPropertyRows(t[r]),this.removeRow(t[r]);e[this.SUB_ROWS_FIELD]=null},getSubPropRows:function(e){return e[this.SUB_ROWS_FIELD]||[]},getParentPropRow:function(e){return e[this.PARENT_ROW_FIELD]},getRowSubLevel:function(e){for(var t=0,r=this.getParentPropRow(e);r;)++t,r=this.getParentPropRow(r);return t},getValueCellText:function(e,t){return t.value},finishEditing:function(){var e=this.getActiveRow(),t=this.getRowPropEditor(e);if(t){var r=this.getOperHistory(),n=this.getEnableOperHistory()&&r,i=t.getValue();if(t.saveEditValue()){if(n){var o=new d.Widget.PropEditorModifyOperation(t,t.getValue(),i);r.push(o)}this.updateValues(),this.invokeEvent("propertyChange",{propertyEditor:t,propertyInfo:t.getPropertyInfo(),oldValue:i,newValue:t.getValue()}),this.invokeEvent("editFinish",{row:e})}}return this},doCreateValueEditWidget:function(e){var t=this.getRowPropEditor(e),r=t.createEditWidget(this);return r?(this.getReadOnly()||t.isReadOnly())&&r.setReadOnly&&r.setReadOnly(!0):r=this.doCreateDefaultValueEditWidget(e),r},doCreateDefaultValueEditWidget:function(e){var t=new d.Widget.TextBox(this);t.setReadOnly(!0);var r=this.getRowData(e).value;return t.setValue(r),t},isOperHistoryAvailable:function(){return this.getOperHistory()&&this.getEnableOperHistory()},undo:function(){return this.isOperHistoryAvailable()&&this.getOperHistory().undo(),this},redo:function(){return this.isOperHistoryAvailable()&&this.getOperHistory().redo(),this},getCommonSuperClass:function(e){return ClassEx.getCommonSuperClass(e)},getCommonPropNames:function(e){var t=[],r=this.getCommonSuperClass(e);if(r)for(var n=ClassEx.getPropListOfScopes(r,this.getDisplayedPropScopes()),i=0,o=n.getLength();i<o;++i){var a=n.getPropInfoAt(i);t.push(a.name)}return t},getDisplayPropNames:function(e){return this.getCommonPropNames(e)},getDisplayPropEditors:function(e){var t=[],r=this.getCommonSuperClass(e);if(r)(n=this.getPropEditor(null,{dataType:ClassEx.getClassName(r)}))&&(n.setObjects(e),t=t.concat(n.getSubPropertyEditors(this.getDisplayedPropScopes())||[]));else if(1===e.length){var n,i=e[0];DataType.isObjectValue(i)&&(n=this.getPropEditorForType("object"))&&(n.setObjects(i),t=t.concat(n.getSubPropertyEditors()||[]))}return t},sortPropEditors:function(e){var t=this.getSortField();if(t){"key"===t&&this.getKeyField();var r=function(e,t){return e[t]||e.name};e.sort((function(e,n){var i=r(e.getPropertyInfo(),t),o=r(n.getPropertyInfo(),t);return i<o?-1:i>o?1:0}))}},getObjPropValue:function(e,t){return e instanceof ObjectEx?e.getPropValue(t):e instanceof Object?e[t]:void 0},getObjsPropValue:function(e,t){for(var r=e[0],n=this.getObjPropValue(r,t),i=1,o=e.length;i<o;++i)if(r=e[i],this.getObjPropValue(r,t)!==n)return;return n},react_click:function(e){var t=e.getTarget(),r=this.getParentRow(t);r&&t===this.getKeyCellExpandMarker(this.getKeyCell(r),!1)&&this.toggleRowExpandState(r),this.tryApplySuper("react_click",[e])},react_dblclick:function(e){var t=e.getTarget(),r=this.getParentCell(t);if(r){var n=this.getParentRow(r);r===this.getKeyCell(n)&&this.toggleRowExpandState(n)}},react_keydown:function(e){this.tryApplySuper("react_keydown",[e]);var t=e.getKeyCode();if(!(e.getAltKey()||e.getShiftKey()||e.getCtrlKey())){var r=this.getActiveRow();r&&(t===d.X.Event.KeyCode.RIGHT?this.expandRow(r):t===d.X.Event.KeyCode.LEFT&&this.collapseRow(r))}}}),d.Widget.ObjectInspector=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ObjectInspector",initialize:function(e){this._propListElem=null,this._objsInfoElem=null,this._propInfoElem=null,this.setPropStoreFieldValue("showObjsInfoPanel",!0),this.setPropStoreFieldValue("showPropInfoPanel",!0),this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=d.ArrayUtils.toArray(e);this.setPropStoreFieldValue("objects",t),this.inspectedObjectsChanged(t)}}),this.defineProp("readOnly",{dataType:DataType.BOOL,getter:function(){var e=this.getPropEditor();return e&&e.getReadOnly()},setter:function(e){var t=this.getPropEditor();t&&t.setReadOnly(e)}}),this.defineProp("propEditor",{dataType:"Kekule.Widget.ObjPropListEditor",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("showObjsInfoPanel",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showObjsInfoPanel",e),r.setDisplay(this._objsInfoElem,!!e),this._updateChildElemSize()}}),this.defineProp("showPropInfoPanel",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showPropInfoPanel",e),r.setDisplay(this._propInfoElem,!!e),this._updateChildElemSize()}}),this.defineProp("keyField",{dataType:DataType.STRING,getter:function(){var e=this.getPropEditor();return e&&e.getKeyField()},setter:function(e){var t=this.getPropEditor();t&&t.setKeyField(e)}}),this.defineProp("sortField",{dataType:DataType.STRING,getter:function(){var e=this.getPropEditor();return e&&e.getSortField()},setter:function(e){var t=this.getPropEditor();t&&t.setSortField(e)}}),this.defineProp("activeRow",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropEditor();return e&&e.getActiveRow()},setter:function(e){var t=this.getPropEditor();t&&t.setActiveRow(e)}}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getPropEditor();return!!e&&e.getEnableOperHistory()},setter:function(e){var t=this.getPropEditor();return t?t.setEnableOperHistory(e):null}}),this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropEditor();return e?e.getOperHistory():null},setter:function(e){var t=this.getPropEditor();return t?t.setOperHistory(e):null}})},doFinalize:function(){this._finalizeChildWidgets(),this.tryApplySuper("doFinalize")},getChildrenHolderElement:function(){return this._propListElem||this.tryApplySuper("getChildrenHolderElement")},doGetWidgetClassName:function(){var e=n.OBJINSPECTOR;return this._isUsingFlexLayout()&&(e+=" "+n.OBJINSPECTOR_FLEX_LAYOUT),e},_isUsingFlexLayout:function(){return!!d.BrowserFeature.cssFlex},doBindElement:function(e){this.tryApplySuper("doBindElement",[e]),this._updateChildElemSize()},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,r){var i=this.tryApplySuper("doCreateSubElements",[e,r])||[],o=this._createSubPartElem(e);t.addClass(o,n.OBJINSPECTOR_OBJSINFOPANEL),r.appendChild(o),this._objsInfoElem=o;var a=this._createSubPartElem(e);t.addClass(a,n.OBJINSPECTOR_PROPINFOPANEL),r.appendChild(a),this._propInfoElem=a;var s=this._createSubPartElem(e);return t.addClass(s,n.OBJINSPECTOR_PROPLISTEDITOR_CONTAINER),r.appendChild(s),this._propListElem=s,this._createChildWidgets(s),i.concat([o,a,s])},_createSubPartElem:function(e){var t=e.createElement("div");return t.className=n.OBJINSPECTOR_SUBPART,t},_createChildWidgets:function(e){this._finalizeChildWidgets();var t=new d.Widget.ObjPropListEditor(this);t.appendToWidget(this);var r=this;t.addEventListener("activeRowChange",(function(e){r._updatePropInfo()})),this.setPropStoreFieldValue("propEditor",t)},_finalizeChildWidgets:function(){var e=this.getPropEditor();e&&e.finalize()},inspectedObjectsChanged:function(e){var t=this.getPropEditor();t&&t.setObjects(e),this._updateObjectsInfo(e),this._updatePropInfo()},_updateObjectsInfo:function(t){if(this._objsInfoElem){var r;if(t.length<=0)r=d.$L("WidgetTexts.S_INSPECT_NONE");else if(1===t.length){var n=t[0],i=n.getId?n.getId():null,o=DataType.getType(n);r=i?d.$L("WidgetTexts.S_INSPECT_ID_OBJECT").format(i,o):d.$L("WidgetTexts.S_INSPECT_ANONYMOUS_OBJECT").format(o)}else r=d.$L("WidgetTexts.S_INSPECT_OBJECTS").format(t.length);e.setElementText(this._objsInfoElem,r)}},_updatePropInfo:function(){if(this._propInfoElem){this._propInfoElem.innerHTML="";var t=this.getPropEditor().getActivePropEditor();if(t){var r,i=t.getTitle(),o=t.getDescription()||t.getPropertyType()||"",a=this._propInfoElem.ownerDocument;(r=a.createElement("div")).className=n.OBJINSPECTOR_PROPINFO_TITLE,e.setElementText(r,i),this._propInfoElem.appendChild(r),(r=a.createElement("div")).className=n.OBJINSPECTOR_PROPINFO_DESCRIPTION,e.setElementText(r,o),this._propInfoElem.appendChild(r)}}},undo:function(){return this.getPropEditor()&&this.getPropEditor().undo(),this},redo:function(){return this.getPropEditor()&&this.getPropEditor().redo(),this},getRowCascadeKey:function(e){var t=this.getPropEditor();return t&&t.getRowCascadeKey(e)},getActiveRowCascadeKey:function(){var e=this.getPropEditor();return e&&e.getActiveRowCascadeKey()},isRowExpandable:function(e){var t=this.getPropEditor();return t&&t.isRowExpandable(e)},isRowExpanded:function(e){var t=this.getPropEditor();return t&&t.isRowExpanded(e)},expandRow:function(e){var t=this.getPropEditor();return t&&t.expandRow(e),this},collapseRow:function(e){var t=this.getPropEditor();return t&&t.collapseRow(e),this},toggleRowExpandState:function(e){var t=this.getPropEditor();return t&&t.toggleRowExpandState(e),this},collapseAllRows:function(){var e=this.getPropEditor();return e&&e.collapseAllRows(),this},expandAllRows:function(e){var t=this.getPropEditor();return t&&t.expandAllRows(e),this},_updateChildElemSize:function(){var e=this;this._isUsingFlexLayout()||setTimeout((function(){var t,n;t=e.getShowObjsInfoPanel()?r.getComputedStyle(e._objsInfoElem,"height"):0,n=e.getShowPropInfoPanel()?r.getComputedStyle(e._propInfoElem,"height"):0,e._propListElem.style.top=t,e._propListElem.style.bottom=n}),100)},setUseCornerDecoration:function(e){return this.tryApplySuper("setUseCornerDecoration",[e])}})}(),function(){"use strict";var e=d.ArrayUtils;d.Widget.PropertyEditor={},d.PropertyEditor=d.Widget.PropertyEditor,d.PropertyEditor.BaseEditor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.PropertyEditor.BaseEditor",initialize:function(){this.tryApplySuper("initialize"),this._editWidget=null},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){var t=d.ArrayUtils;this.setPropStoreFieldValue("objects",t.clone(t.toArray(e)))}}),this.defineProp("propertyInfo",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("propertyName",{dataType:DataType.VARIANT,serializable:!1,setter:null,getter:function(){var e=this.getPropertyInfo();return e?e.name:null}}),this.defineProp("propertyType",{dataType:DataType.VARIANT,serializable:!1,setter:null,getter:function(){var e=this.getPropertyInfo();return e?e.dataType:null}}),this.defineProp("parentEditor",{dataType:"Kekule.PropertyEditor.BaseEditor",serializable:!1}),this.defineProp("valueTextMode",{dataType:DataType.INT}),this.defineProp("readOnly",{dataType:DataType.BOOL}),this.defineProp("allowEmpty",{dataType:DataType.BOOL})},finalize:function(){this.finalizeWidget(),this.tryApplySuper("finalize")},finalizeWidget:function(){this._editWidget&&(this._editWidget.finalize(),this._editWidget=null)},getEditWidget:function(){return this._editWidget},getObjPropValue:function(e,t){return d.ObjUtils.isUnset(t)?e:e instanceof ObjectEx?e.getPropValue(t):DataType.isArrayValue(e)||e instanceof Object?e[t]:void 0},setObjPropValue:function(e,t,r){return e instanceof ObjectEx?e.setPropValue(t,r):e instanceof Object&&(e[t]=r),this},getObjsPropValue:function(e,t){if(e){if(d.ObjUtils.isUnset(t))return e;for(var r=e[0],n=this.getObjPropValue(r,t),i=1,o=e.length;i<o;++i)if(r=e[i],this.getObjPropValue(r,t)!==n)return;return n}},setObjsPropValue:function(e,t,r){if(!e||!t)return this;for(var n=0,i=e.length;n<i;++n){var o=e[n];this.setObjPropValue(o,t,r)}return this},isReadOnly:function(){return!!(this.getAttributes()&t.READONLY)},hasSubPropertyEditors:function(){return!!(this.getAttributes()&t.SUBPROPS)},getAttributes:function(){var e=t.MULTIOBJS|t.SIMPLEVALUE,r=this.getPropertyInfo();return d.ObjUtils.isUnset(this.getReadOnly())?r&&!r.setter&&(e|=t.READONLY):this.getReadOnly()&&(e|=t.READONLY),e},getSubPropertyEditors:function(e){return null},getTitle:function(){var e=this.getPropertyInfo();return e?e.title||e.name:""},getHint:function(){return this.getTitle()},getDescription:function(){return this.getPropertyInfo().description},getValue:function(){return this.getObjsPropValue(this.getObjects(),this.getPropertyName())},getValueText:function(){var e=d.Widget.ValueListEditor.ValueDisplayMode,t=this.getValue(),r=this.getValueTextMode();try{var n=r===e.JSON?JSON.stringify(t):d.ObjUtils.isUnset(t)?"":""+t}catch(e){return""+t}return n},setValue:function(e){var t=this.setObjsPropValue(this.getObjects(),this.getPropertyName(),e);return this.getParentEditor()&&this.getParentEditor().notifyChildEditorValueChange&&this.getParentEditor().notifyChildEditorValueChange(this.getPropertyName(),e),t},createEditWidget:function(e){var t=this.getValue(),r=this.doCreateEditWidget(e,t);return r&&r.setIsDirty&&r.setIsDirty(!1),this._editWidget=r,r},doCreateEditWidget:function(e){},saveEditValue:function(){if(this._editWidget){if(!this._editWidget.getIsDirty||this._editWidget.getIsDirty()){var e=this.doSaveEditValue();return this._editWidget.setIsDirty&&this._editWidget.setIsDirty(!1),e}return!1}return!1},doSaveEditValue:function(){},notifyChildEditorValueChange:function(e,t){}}),d.PropertyEditor.EditorAttributes={MULTIOBJS:1,SUBPROPS:2,SIMPLEVALUE:4,VALUELIST:8,CUSTOMEDIT:16,READONLY:32,INLINE_EDIT:128,DROP_EDIT:256,POPUP_EDIT:512};var t=d.PropertyEditor.EditorAttributes;d.PropertyEditor.EditorMananger=Class.create({initialize:function(){this._registeredItems=[],this._defaultItems=[]},register:function(e,t,r,n,i){var o={editorClass:e,propType:t,objClass:r,propName:n,matchFunc:i};return this._registeredItems.push(o),t||r||n||i||this._defaultItems.push(o),this},unregister:function(e){for(var t=(r=this._registeredItems).length-1;t>=0;--t)r[t].editorClass===e&&r.splice(t,1);var r;for(t=(r=this._defaultItems).length-1;t>=0;--t)r[t].editorClass===e&&r.splice(t,1);return this},_getDefaultItem:function(){var e=this._defaultItems;return e[e.length-1]},_getSuperiorItem:function(e,t){for(var r=["matchFunc","propName","objClass","propType"],n=0,i=r.length;n<i;++n)if(!!e[r]!=!!t[r])return e[r]?e:t;return e},_isMatchedPropType:function(e,t){var r=e===t;if(!r&&DataType.isObjectExType(e)&&DataType.isObjectExType(t)){var n=ClassEx.findClass(e),i=ClassEx.findClass(t);r=ClassEx.isOrIsDescendantOf(n,i)}return r},_testOnPropType:function(e,t){return e.propType&&t.dataType?this._isMatchedPropType(t.dataType,e.propType)?1:-1:0},_testOnObjClass:function(e,t){return e.objClass&&t?ClassEx.isOrIsDescendantOf(t,e.objClass)?1:-1:0},_testOnPropName:function(e,t){return e.propName&&t.name?e.propName===t.name?1:-1:0},_testOnMatchFunc:function(e,t,r){return e.matchFunc?e.matchFunc(t,r)?1:-1:0},findEditorClass:function(e,t){for(var r=null,n=this._registeredItems,i=n.length-1;i>=0;--i){var o=n[i],a=this._testOnPropType(o,t);if(!(a<0)){var s=this._testOnObjClass(o,e);if(!(s<0)){var l=this._testOnPropName(o,t);if(!(l<0)){var d=this._testOnMatchFunc(o,e,t);if(!(d<0)&&a+s+l+d>0&&(r=r?this._getSuperiorItem(r,o.editorClass):o.editorClass)&&o.matchFunc)break}}}}return r||(r=(o=this._getDefaultItem())?o.editorClass:null),r},findEditorClassForType:function(e,t){var r={dataType:e,name:t};return this.findEditorClass(null,r)}}),d.ClassUtils.makeSingleton(d.PropertyEditor.EditorMananger),d.PropertyEditor.findEditorClass=d.PropertyEditor.EditorMananger.getInstance().findEditorClass.bind(d.PropertyEditor.EditorMananger.getInstance()),d.PropertyEditor.findEditorClassForType=d.PropertyEditor.EditorMananger.getInstance().findEditorClassForType.bind(d.PropertyEditor.EditorMananger.getInstance()),d.PropertyEditor.register=d.PropertyEditor.EditorMananger.getInstance().register.bind(d.PropertyEditor.EditorMananger.getInstance()),d.PropertyEditor.unregister=d.PropertyEditor.EditorMananger.getInstance().unregister.bind(d.PropertyEditor.EditorMananger.getInstance()),d.PropertyEditor.SimpleEditor=Class.create(d.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.SimpleEditor",convertStrToValue:function(e,t){return DataType.isSimpleType(t)?!e&&this.getAllowEmpty()?null:d.StrUtils.convertToType(e,t):e},setValueText:function(e){if(e===this._originValueText)return!1;var t,r=this.getPropertyType();return!(r&&!DataType.isSimpleType(r))&&(t=r?this.convertStrToValue(e,r):e,this.setValue(t),!0)},doCreateEditWidget:function(e){var t=this.getValueText();return this._originValueText=t,new d.Widget.TextBox(e,t)},doSaveEditValue:function(){return this.setValueText(this.getEditWidget().getValue())}}),d.PropertyEditor.register(d.PropertyEditor.SimpleEditor),d.PropertyEditor.TextEditor=Class.create(d.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.TextEditor",LINE_BREAK_REPLACER:"\\n",textToSingleLine:function(e){return e.split("\n").join(this.LINE_BREAK_REPLACER)},textToMultiLine:function(e){return e.split(this.LINE_BREAK_REPLACER).join("\n")},doCreateEditWidget:function(e){this._parentWidget=e;var t=this.getValueText();this._originValueText=t;var r=new d.Widget.ButtonTextBox(e,this.textToSingleLine(t));return this._textbox=r,r.setButtonKind(d.Widget.Button.Kinds.POPUP),r.addEventListener("buttonExecute",this.reactButtonExecute,this),r},reactButtonExecute:function(e){this.openPopupEditor()},openPopupEditor:function(){var e=this._popupDialog;e||(e=this.createPopupDialog(),this._popupDialog=e);var t=this._popupEditor;t.setValue(this.getValueText());var r=this;e.openPopup((function(e){e===d.Widget.DialogButtons.OK&&(r._textbox.setValue(r.textToSingleLine(t.getValue())),r._textbox.setIsDirty(!0),r.saveEditValue())}),this._textbox)},createPopupDialog:function(){var e=this._parentWidget.getDocument(),t=new d.Widget.Dialog(e,this.getPropertyName(),[d.Widget.DialogButtons.OK,d.Widget.DialogButtons.CANCEL]);t.setLocation(d.Widget.Location.CENTER_OR_FULLFILL);var r=new(0,d.Widget.TextArea)(e),n=r.getElement().style;return n.width="40em",n.height="20em",r.appendToWidget(t),this._popupEditor=r,t},doSaveEditValue:function(){var e=this.getEditWidget().getValue();return(e=this.textToMultiLine(e))!==this._originValueText&&(this.setValueText(e),!0)}}),d.PropertyEditor.register(d.PropertyEditor.TextEditor,DataType.STRING),d.PropertyEditor.BoolEditor=Class.create(d.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.BoolEditor",boolToStr:function(e){return d.StrUtils.boolToStr(e)},doCreateEditWidget:function(e){this._originValue=this.getValue();var t=new d.Widget.CheckBox(e,this._originValue);t.setText(this.boolToStr(this._originValue));var r=this;return t.addEventListener("valueChange",(function(e){var n=t.getChecked();t.setText(r.boolToStr(n))})),t},getValueText:function(){var e=this.getValue();return d.ObjUtils.isUnset(e)?d.$L("WidgetTexts.S_VALUE_UNSET"):this.tryApplySuper("getValueText")},doSaveEditValue:function(){var e=this.getEditWidget().getChecked();return e!==this._originValue&&(this.setValue(e),!0)}}),d.PropertyEditor.register(d.PropertyEditor.BoolEditor,DataType.BOOL),d.PropertyEditor.SelectEditor=Class.create(d.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.SelectEditor",getValueText:function(){for(var e=this.getValue(),t=this.getSelectItems()||[],r=0,n=t.length;r<n;++r){var i=t[r];if(i.value===e)return i.text}return this.tryApplySuper("getValueText")},getSelectItems:function(){return[]},doCreateEditWidget:function(e){var t=new d.Widget.SelectBox(e,this.getSelectItems());return this._originalValue=this.getValue(),t.setValue(this._originalValue),t},doSaveEditValue:function(){var e=this.getEditWidget().getValue();return e!==this._originalValue&&(this.setValue(e),!0)}}),d.PropertyEditor.EnumEditor=Class.create(d.PropertyEditor.SelectEditor,{CLASS_NAME:"Kekule.PropertyEditor.EnumEditor",initialize:function(){this.tryApplySuper("initialize"),this.enumInfos=[]},setPropertyInfo:function(e){if(this.tryApplySuper("setPropertyInfo",[e]),e){var t=e.enumSource;if(t&&DataType.isObjectValue(t)){var r=d.ObjUtils.getOwnedFieldNames(t);this.enumInfos=[];for(var n=0,i=r.length;n<i;++n)this.enumInfos.push({text:r[n],value:t[r[n]]})}}},getSelectItems:function(){var e=this.getValue();if(d.ObjUtils.isUnset(e)){var t=d.ArrayUtils.clone(this.enumInfos);return t.unshift({text:d.$L("WidgetTexts.S_VALUE_UNSET"),value:e}),t}return this.enumInfos}}),d.PropertyEditor.register(d.PropertyEditor.EnumEditor,null,null,null,(function(e,t){return!!t.enumSource})),d.PropertyEditor.ObjectExEditor=Class.create(d.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectExEditor",getAttributes:function(){return this.tryApplySuper("getAttributes")|t.SUBPROPS},hasSubPropertyEditors:function(){return this.tryApplySuper("hasSubPropertyEditors")&&this.getValue()},getSubPropertyEditors:function(e){var t=[],r=this.getValue();if(r){if(r instanceof ObjectEx)var n=r.getClass();else n=ClassEx.getCommonSuperClass(r);for(var i=ClassEx.getPropListOfScopes(n,e),o=0,a=i.getLength();o<a;++o){var s=i.getPropInfoAt(o),l=d.PropertyEditor.findEditorClass(n,s);if(l){var u=new l;u.setObjects(d.ArrayUtils.toArray(r)),u.setPropertyInfo(s),u.setValueTextMode(this.getValueTextMode()),t.push(u)}}}return t},getValueText:function(){var e=this.getValue();return d.ObjUtils.notUnset(e)?e.getClassName?"["+e.getClassName()+"]":this.tryApplySuper("getValueText"):d.$L("WidgetTexts.S_OBJECT_UNSET")}}),d.PropertyEditor.register(d.PropertyEditor.ObjectExEditor,"ObjectEx"),d.PropertyEditor.ObjectFieldEditor=Class.create(d.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectFieldEditor",initialize:function(){},doCreateEditWidget:function(e){if(!this.getPropertyType()){var t=this.getValue();this.getPropertyInfo().dataType=DataType.getType(t)}return this.tryApplySuper("doCreateEditWidget",[e])}}),d.PropertyEditor.ObjectEditor=Class.create(d.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectEditor",initialize:function(){this.tryApplySuper("initialize"),this._initialObjValue=void 0},getFieldEditorClass:function(e,t){return d.PropertyEditor.findEditorClass(null,t)||d.PropertyEditor.ObjectFieldEditor},getFieldValueType:function(e,t){var r=e[t];return d.ObjUtils.notUnset(r)?DataType.getType(r):null},createFieldEditor:function(e,t){var r=new(this.getFieldEditorClass(e,t));return r.setParentEditor(this),r.setReadOnly(!1),r.setAllowEmpty(this.getAllowEmpty()),r.setPropertyInfo(t),r.setObjects(e),r.setValueTextMode(this.getValueTextMode()),r},getObjFields:function(e){return e?d.ObjUtils.getOwnedFieldNames(e):[]},getObjFieldInfos:function(e){for(var t=this.getObjFields(e),r=[],n=0,i=t.length;n<i;++n){var o={name:t[n],dataType:this.getFieldValueType(e,t[n])};r.push(o)}return r},notifyChildEditorValueChange:function(e,t){var r=this.getValue()||this._initialObjValue;r[e]=t,this.setValue(r)},getAttributes:function(){return this.tryApplySuper("getAttributes")|t.SUBPROPS},hasSubPropertyEditors:function(){return this.tryApplySuper("hasSubPropertyEditors")&&this.getObjFieldInfos(this.getValue()).length},getValueText:function(){var e=d.Widget.ValueListEditor.ValueDisplayMode;return this.getValueTextMode()===e.JSON?this.tryApplySuper("getValueText"):this.getValue()?"["+d.$L("WidgetTexts.S_OBJECT")+"]":""},setValue:function(e){var t=this.tryApplySuper("setValue",[e]);return this._initialObjValue=e,t},getSubPropertyEditors:function(t){var r=[],n=e.toArray(this.getValue());if(n.length>1)return[];var i=n[0];this._initialObjValue=i||{};for(var o=this.getObjFieldInfos(i),a=[this._initialObjValue],s=0,l=o.length;s<l;++s){var d=this.createFieldEditor(a,o[s]);r.push(d)}return r}}),d.PropertyEditor.register(d.PropertyEditor.ObjectEditor,DataType.OBJECT),d.PropertyEditor.ArrayEditor=Class.create(d.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ArrayEditor",getAttributes:function(){return this.tryApplySuper("getAttributes")|t.SUBPROPS},hasSubPropertyEditors:function(){var e=this.getValue();return this.tryApplySuper("hasSubPropertyEditors")&&e&&e.length},getSubPropertyEditors:function(e){var t=[],r=this.getValue();if(DataType.isArrayValue(r)&&r.length)for(var n=this.getPropertyInfo().elementType,i=0,o=r.length;i<o;++i){var a=r[i],s=n||DataType.getType(a),l=d.PropertyEditor.findEditorClassForType(s);if(l){var u=new l;u.setParentEditor(this),u.setObjects([r]);var c={name:i,title:i,dataType:s};u.setPropertyInfo(c),u.setValueTextMode(this.getValueTextMode()),t.push(u)}}return t},getValueText:function(){var e=this.getValue();return DataType.isArrayValue(e)?"["+e.length+" "+d.$L("WidgetTexts.S_ITEMS")+"]":this.tryApplySuper("getValueText")}}),d.PropertyEditor.register(d.PropertyEditor.ArrayEditor,DataType.ARRAY),d.PropertyEditor.ColorEditor=Class.create(d.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ColorEditor",doCreateEditWidget:function(e){this._parentWidget=e;var t=this.getValue();this._originValue=t;var r=new d.Widget.ColorDropTextBox(e,t);return r.setSpecialColors([d.Widget.ColorPicker.SpecialColors.UNSET]),r.addEventListener("valueSet",(function(e){this.saveEditValue()}),this),this._textbox=r,r},doSaveEditValue:function(){var e=this.getEditWidget().getValue();return(e===d.Widget.ColorPicker.SpecialColors.UNSET||""===e)&&(e=void 0),e!==this._originValue&&(this.setValue(e),!0)}}),d.PropertyEditor.register(d.PropertyEditor.ColorEditor,DataType.STRING,null,null,(function(e,t){var r=t.name;return r&&r.toLowerCase().indexOf("color")>=0}))}(),function(){"use strict";d.Widget.PropEditorModifyOperation=Class.create(d.Operation,{CLASS_NAME:"Kekule.Widget.PropEditorModifyOperation",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setPropEditor(e),this.setNewValue(t),this.setOldValue(r)},initProperties:function(){this.defineProp("propEditor",{dataType:"Kekule.PropertyEditor.BaseEditor",serializable:!1}),this.defineProp("newValue",{dataType:DataType.VARIANT,serializable:!1}),this.defineProp("oldValue",{dataType:DataType.VARIANT,serializable:!1})},doExecute:function(){var e=this.getPropEditor();void 0===this.getOldValue()&&this.setOldValue(e.getValue()),e.setValue(this.getNewValue())},doReverse:function(){this.getPropEditor().setValue(this.getOldValue())}})}(),function(){"use strict";d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{WIDGET_CONFIGURATOR:"K-Widget-Configurator",WIDGET_CONFIGURATOR_CLIENT:"K-Widget-Configurator-Client",ACTION_OPEN_CONFIGURATOR:"K-Action-Open-Configurator"});var e=d.Widget.HtmlClassNames;d.Widget.Configurator=Class.create(d.Widget.Panel,{CLASS_NAME:"Kekule.Widget.Configurator",TAB_BTN_DATA_FIELD:"__$data__",DEF_TAB_POSITION:d.Widget.Position.RIGHT,initialize:function(e){this.setPropStoreFieldValue("widget",e),this._objInspector=null,this._tabGroup=null,this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1}),this.defineProp("autoUpdate",{dataType:DataType.BOOL}),this.defineProp("tabPosition",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("tabPosition",e),this._tabGroup&&this._tabGroup.setTabButtonPosition(e||this.DEF_TAB_POSITION)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(d.Widget.Layout.HORIZONTAL)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.WIDGET_CONFIGURATOR},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(t,r){var n=[],i=t.createElement("div");i.className=e.WIDGET_CONFIGURATOR_CLIENT,n.push(i);var o=new d.Widget.ObjectInspector(this);o.setShowObjsInfoPanel(!1),o.setSortField(null),o.appendToElem(i),this._objInspector=o,o.addEventListener("propertyChange",(function(e){this.invokeEvent("configChange",{obj:o.getObjects()[0],propertyName:e.propertyInfo.name,oldValue:e.oldValue,newValue:e.newValue})}),this);var a,s=this.getCategoryInfos(),l=new d.Widget.TabButtonGroup(this);this._tabGroup=l,l.setTabButtonPosition(this.getTabPosition()||this.DEF_TAB_POSITION);for(var u=0,c=s.length;u<c;++u){var h=s[u],p=new d.Widget.RadioButton(l);p.setText(h.title||h.name),p.setHint(h.description||""),p[this.TAB_BTN_DATA_FIELD]=h.obj,p.appendToWidget(l),0===u&&(a=p)}return l.addEventListener("execute",(function(e){var t=e.widget;t instanceof d.Widget.RadioButton&&this._switchToTab(t)}),this),l.appendToElem(i),s.length<=1&&l.setDisplayed("none"),a.setChecked(!0),this._switchToTab(a),r.appendChild(i),n},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),this.getAutoUpdate()&&(e?this.loadConfigValues():this.saveConfigValues())},loadConfigValues:function(){},saveConfigValues:function(){},getCategoryInfos:function(){var e=this.getWidget(),t=[],r=e.getSettingFacade();if(r){var n=e.getPropInfo("settingFacade");t.push({obj:r,name:n.name,title:n.title,descrption:n.description})}return t},_switchToTab:function(e){var t=e[this.TAB_BTN_DATA_FIELD];this._objInspector.setObjects(t)}}),d.Widget.ActionOpenConfigWidget=Class.create(d.Action,{CLASS_NAME:"Kekule.Widget.ActionOpenConfigWidget",HTML_CLASSNAME:e.ACTION_OPEN_CONFIGURATOR,initialize:function(e){this.tryApplySuper("initialize"),this.setWidget(e),this.setText(d.$L("WidgetTexts.CAPTION_CONFIG")),this.setHint(d.$L("WidgetTexts.HINT_CONFIG"))},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1})},doUpdate:function(){var e=this.getWidget();this.setEnabled(e&&e.getEnabled())},doExecute:function(e){this.getWidget().openConfigurator(e)}}),ClassEx.extend(d.Widget.BaseWidget,{getSettingFacadeClass:function(){var e=this.getClass(),t=null;do{var r=ClassEx.getClassName(e)+".Settings";t=ClassEx.findClass(r),e=ClassEx.getSuperClass(e)}while(e&&!t);return t},getConfiguratorClass:function(){var e=this.getClass(),t=null;do{var r=ClassEx.getClassName(e)+".Configurator";t=ClassEx.findClass(r),e=ClassEx.getSuperClass(e)}while(e&&!t);return t},createConfigurator:function(){return new(this.getConfiguratorClass())(this)},getConfigurator:function(){return this._configurator||(this._configurator=this.createConfigurator()),this._configurator},openConfigurator:function(e){this.getConfigurator().show(e||this,null,d.Widget.ShowHideType.DROPDOWN)}}),ClassEx.defineProp(d.Widget.BaseWidget,"settingFacade",{dataType:DataType.OBJECTEX,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var e=this.getPropStoreFieldValue("settingFacade");if(!e){var t=this.getSettingFacadeClass();t&&(e=new t(this),this.setPropStoreFieldValue("settingFacade",e))}return e}}),d.Widget.BaseWidget.Settings=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseWidget.Settings",initialize:function(e){this._basedClass=null,this.tryApplySuper("initialize"),this.setWidget(e)},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,scope:Class.PropertyScope.PUBLIC})},getBasedClass:function(){if(!this.hasOwnProperty("_basedClass")||!this._basedClass){var e=this.getClassName(),t=e.split(".");t.pop(),e=t.join("."),this._basedClass=ClassEx.findClass(e)}return this._basedClass},defineDelegatedProp:function(e,t){t||(t=e);var r=ClassEx.getPropInfo(this.getBasedClass(),t),n=Object.create(r);n.setter=null,n.getter=null,r.getter&&(n.getter=function(){return this.getWidget().getPropValue(t)}),r.setter&&(n.setter=function(e){this.getWidget().setPropValue(t,e)}),this.defineProp(e,n)},defineDelegatedProps:function(e,t){t||(t=[]);for(var r=0,n=e.length;r<n;++r){var i=e[r],o=t[r]||i;this.defineDelegatedProp(i,o)}}})}(),function(){"use strict";d.Widget.BaseDataSet=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseDataSet",PREFIX_SORT_DESC:"!",initProperties:function(){this.defineProp("enableCache",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableCache")&&this.getCacheAvailable()},setter:function(e){this.setPropStoreFieldValue("enableCache",e),e||this.clearCache()}}),this.defineProp("defaultTimeout",{dataType:DataType.INT}),this.defineProp("sortFields",{dataType:DataType.ARRAY,setter:function(e){var t=e?d.ArrayUtils.toArray(e):null;this.setPropStoreFieldValue("sortFields",t),this.sortFieldsChanged(t)}}),this.defineProp("cache",{dataType:DataType.ARRAY})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableCache(!0),this.setCache([]),this.setDefaultTimeout(2e4)},finalize:function(){this.clearCache(),this.setCache(null),this.tryApplySuper("finalize")},dataChanged:function(){this.clearCache(),this.invokeEvent("dataChange")},sortFieldsChanged:function(e){this.clearCache(),this.doSortFieldsChanged(e)},doSortFieldsChanged:function(e){},getTotalCount:function(){return this.doGetTotalCount()||0},doGetTotalCount:function(){},totalCountChanged:function(e){this.invokeEvent("totalCountChange",{totalCount:e})},getFirstIndex:function(){return 0},getLastIndex:function(){return(this.getTotalCount()||0)-1},getCacheAvailable:function(){return!0},clearCache:function(){return this.getCache().length=0,this},saveCacheData:function(e,t){for(var r=this.getCache(),n=t,i=0;i<e.length;++i)r[n]=e[i]||null,++n},loadCacheData:function(e,t){if(this.getEnableCache()){var r=this.getCache();if(r.length<e+t)return null;for(var n=[],i=e,o=e+t;i<o;++i){var a=r[i];if(void 0===a)return null;n.push(a)}return n}return null},fetch:function(e){var t=Object.extend({fromIndex:0,count:0},e);if(t.timeout=t.timeout||this.getDefaultTimeout(),this.getEnableCache()){var r=this.loadCacheData(t.fromIndex,t.count);if(r)return void t.callback(r)}var n=this,i=!1;if(t.timeout>0)var o=setTimeout((function(){o&&clearTimeout(o),i=!0,t.timeoutCallback?t.timeoutCallback():e.errCallback&&e.errCallback(d.$L("ErrorMsg.FETCH_DATA_TIMEOUT"))}),t.timeout);t.callback=function(r){i||(o&&clearTimeout(o),e.callback&&e.callback(r),n.getEnableCache()&&n.saveCacheData(r,t.fromIndex))},t.errCallback=function(t){i||(o&&clearTimeout(o),e.errCallback&&e.errCallback(t))},this.doFetch(t.fromIndex,t.count,t.callback,t.errCallback)},doFetch:function(e,t,r,n){}}),d.Widget.ArrayDataSet=Class.create(d.Widget.BaseDataSet,{CLASS_NAME:"Kekule.Widget.ArrayDataSet",initialize:function(e){this.tryApplySuper("initialize"),this.setData(e)},initProperties:function(){this.defineProp("data",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("data",e);var t=this.getSortFields();t&&this.doSortFieldsChanged(t),this.dataChanged()}})},getCacheAvailable:function(){return!1},doSortFieldsChanged:function(e){var t=this.getData()||[];return d.ArrayUtils.sortHashArray(t,e),this.dataChanged(),this},doGetTotalCount:function(){return(this.getData()||[]).length},doFetch:function(e,t,r,n){for(var i=[],o=this.getData()||[],a=e,s=Math.min(e+t,o.length);a<s;++a){var l=o[a];i.push(l)}r(i)}}),d.Widget.DataPager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.DataPager",initialize:function(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("pageSize",10),this.setDataSet(e)},initProperties:function(){this.defineProp("dataSet",{dataType:"Kekule.Widget.BaseDataSet",setter:function(e){var t=this.getDataSet();e!==t&&(this.setPropStoreFieldValue("dataSet",e),this.dataSetChange(t,e),this.switchToPage(this.getCurrPageIndex()||0))}}),this.defineProp("pageSize",{dataType:DataType.INT,setter:function(e){e!==this.getPageSize()&&(this.setPropStoreFieldValue("pageSize",e),this.pageCountChanged(this.getPageCount()),this.switchToPage(this.getCurrPageIndex()||0))}}),this.defineProp("currPageIndex",{dataType:DataType.INT}),this.defineProp("currPageData",{dataType:DataType.ARRAY}),this.defineProp("sortFields",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getDataSet()&&this.getDataSet().getSortFields()},setter:function(e){this.getDataSet()&&this.getDataSet().setSortFields(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setCurrPageIndex(0)},dataSetChange:function(e,t){e&&(e.RemoveEventListener("dataChange",this.reactDataSetDataChange,this),e.RemoveEventListener("totalCountChange",this.reactDataSetTotalCountChange,this)),t&&(t.addEventListener("dataChange",this.reactDataSetDataChange,this),t.addEventListener("totalCountChange",this.reactDataSetTotalCountChange,this)),this.pageCountChanged(this.getPageCount())},reactDataSetDataChange:function(e){this.dataChanged()},dataChanged:function(){this.pageCountChanged(this.getPageCount()),this.switchToPage(this.getCurrPageIndex()||0)},reactDataSetTotalCountChange:function(e){this.pageCountChanged(this.getPageCount())},getPageCount:function(){var e=this.getDataSet(),t=e&&e.getTotalCount()||0;return Math.ceil(t/this.getPageSize())},pageCountChanged:function(e){this.invokeEvent("pageCountChange",{pageCount:e})},fetchPageData:function(e){var t=this.getPageSize()*(d.ObjUtils.isUnset(e.pageIndex)?this.getCurrPageIndex():e.pageIndex),r=this.getPageSize(),n=Object.create(e);return Object.extend(n,{fromIndex:t,count:r}),this.getDataSet().fetch(n),this},switchToPage:function(e,t){var r=this,n={pageIndex:e,timeout:t,callback:function(t){r.setCurrPageData(t),r.setCurrPageIndex(e),r.invokeEvent("dataFetched",{pageIndex:e,data:t})},errCallback:function(e){r.invokeEvent("dataError",{error:e}),d.error(e)}};this.invokeEvent("pageRetrieve",{pageIndex:e}),this.fetchPageData(n)}})}(),function(){"use strict";var e=d.DomUtils,t=d.HtmlElementUtils,r=d.Widget.HtmlClassNames;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{DATAGRID:"K-DataGrid",DATATABLE:"K-DataTable",DATATABLE_ROW_ODD:"K-Odd",DATATABLE_ROW_EVEN:"K-Even",DATATABLE_CELL_WRAPPER:"K-DataTable-CellWrapper",DATATABLE_HEADCELL_INTERACTABLE:"K-DataTable-HeadCellInteractable",DATATABLE_OPER_COL:"K-DataTable-OperCol",DATATABLE_OPER_CELL:"K-DataTable-OperCell",DATATABLE_CHECK_COL:"K-DataTable-CheckCol",DATATABLE_CHECK_CELL:"K-DataTable-CheckCell",DATATABLE_DATA_COL:"K-DataTable-DataCol",DATATABLE_DATA_CELL:"K-DataTable-DataCell",DATATABLE_SORTMARK:"K-DataTable-SortMark",DATATABLE_SORTASC:"K-Sort-Asc",DATATABLE_SORTDESC:"K-Sort-Desc",DATATABLE_EDIT:"K-DataTable-Edit",DATATABLE_DELETE:"K-DataTable-Delete",DATATABLE_INSERT:"K-DataTable-Insert",PAGENAVIGATOR:"K-PageNavigator",PAGENAVIGATOR_FIRST:"K-PageNavigator-First",PAGENAVIGATOR_LAST:"K-PageNavigator-Last",PAGENAVIGATOR_PREV:"K-PageNavigator-Prev",PAGENAVIGATOR_NEXT:"K-PageNavigator-Next",PAGENAVIGATOR_PAGEINDEXER:"K-PageNavigator-PageIndexer",PAGENAVIGATOR_PAGEINPUT:"K-PageNavigator-PageInput",PAGENAVIGATOR_PAGESELECTOR:"K-PageNavigator-PageSelector"}),d.Widget.DataTableColNames={OPER:"OPER",CHECK:"CHECK",ALL:"*"};var n=d.Widget.DataTableColNames;d.Widget.DataTable=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.DataTable",BINDABLE_TAG_NAMES:["div","span"],PREFIX_SORT_DESC:"!",COLDEF_FIELD:"__$colDef__",ROWDATA_FIELD:"__$rowData__",ROW_OPER_TOOLBAR_FIELD:"__$rowOperToolbar__",ROW_CHECKBOX_FIELD:"__$rowCheckBox__",COLNAME_OPER:n.OPER,COLNAME_CHECK:n.CHECK,COLNAME_ALL:n.ALL,initialize:function(e){this._displayData=null,this.setPropStoreFieldValue("showTableHead",!0),this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("data",{dataType:DataType.ARRAY}),this.defineProp("columns",{dataType:DataType.ARRAY}),this.defineProp("operColShowMode",{dataType:DataType.STRING}),this.defineProp("operWidgets",{dataType:DataType.ARRAY}),this.defineProp("sortFields",{dataType:DataType.ARRAY,setter:function(e){var t=e?d.ArrayUtils.toArray(e):null;this.setPropStoreFieldValue("sortFields",t),this.getDataPager()&&this.getDataPager().setSortFields(t)}}),this.defineProp("sortFunc",{dataType:DataType.FUNCTION}),this.defineProp("showTableHead",{dataType:DataType.BOOL}),this.defineProp("enableHeadInteraction",{dataType:DataType.BOOL}),this.defineProp("enableActiveRow",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableActiveRow",e),e||this.setActiveCell(null)}}),this.defineProp("activeCell",{dataType:DataType.OBJECT,setter:function(e){var n=this.getActiveCell();if(n!==e)if(n&&t.removeClass(n,r.STATE_ACTIVE),this.setPropStoreFieldValue("activeCell",e),e){t.addClass(e,r.STATE_ACTIVE);var i=this.getParentRow(e);i&&this.setActiveRow(i)}else this.setActiveRow(null)}}),this.defineProp("activeRow",{dataType:DataType.OBJECT,setter:function(e){var t=this.getActiveRow();t!==e&&(this.activeRowChanged(t,e),this.setPropStoreFieldValue("activeRow",e))}}),this.defineProp("hoverCell",{dataType:DataType.OBJECT,setter:function(e){var n=this.getHoverCell();if(n!==e)if(n&&t.removeClass(n,r.STATE_HOVER),this.setPropStoreFieldValue("hoverCell",e),e){t.addClass(e,r.STATE_HOVER);var i=this.getParentRow(e);i&&this.setHoverRow(i)}else this.setHoverRow(null)}}),this.defineProp("hoverRow",{dataType:DataType.OBJECT,setter:function(e){var t=this.getHoverRow();t!==e&&(this.hoverRowChanged(t,e),this.setPropStoreFieldValue("hoverRow",e))}}),this.defineProp("dataPager",{dataType:"Kekule.Widget.DataPager",setter:function(e){var t=this.getDataPager();t!==e&&(this.setPropStoreFieldValue("dataPager",e),this.dataPagerChanged(e,t))}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.reactOperEditBind=this.reactOperEdit.bind(this),this.reactOperDeleteBind=this.reactOperDelete.bind(this),this.reactOperInsertBind=this.reactOperInsert.bind(this)},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]),d.ArrayUtils.intersect(e,["data","columns","sortFields","sortFunc","showTableHead","enableHeadInteraction","operColShowMode","operWidgets"]).length&&this.recreateChildContent()},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.DATATABLE},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){return this.doCreateDataTable(e,t)},doCreateDataTable:function(e,t){var r=e.createElement("table");return this.recreateChildContent(e,r),t.appendChild(r),r},getTableElement:function(){return this.getElement()&&this.getElement().getElementsByTagName("table")[0]},getShowOperCol:function(){return(this.getOperColShowMode()||d.Widget.DataTable.OperColShowMode.NONE)!==d.Widget.DataTable.OperColShowMode.NONE},recreateChildContent:function(t,r){this.setActiveCell(null),this.setHoverCell(null);var n=this.prepareData(),i=r||this.getTableElement(),o=[];return i&&(e.clearChildContent(i),t||(t=i.ownerDocument),o.push(this.doCreateDataTableColGroup(t,i,n.columns)),this.getShowTableHead()&&o.push(this.doCreateDataTableHead(t,i,n.columns)),o.push(this.doCreateDataTableBody(t,i,n.columns,n.data))),o},doCreateDataTableColGroup:function(e,t,r){for(var n=r||[],i=e.createElement("colgroup"),o=0,a=n.length;o<a;++o){var s=n[o]||{},l=e.createElement("col");s.colClassName&&(l.className=s.colClassName),s.colStyle&&(l.style.cssText=s.colStyle),i.appendChild(l)}return t.appendChild(i),i},doCreateDataTableCellWrapper:function(e,t){var n=e.createElement("span");return n.className=r.DATATABLE_CELL_WRAPPER,t.appendChild(n),n},doCreateDataTableHead:function(e,t,r){for(var n=r||[],i=this.getEnableHeadInteraction(),o=e.createElement("thead"),a=e.createElement("tr"),s=0,l=n.length;s<l;++s){var d=n[s]||{};this.doCreateDataTableHeadCell(e,a,d,i)}return o.appendChild(a),t.appendChild(o),o},doCreateDataTableHeadCell:function(n,i,o,a){var s=n.createElement("th");o.className&&(s.className=o.className),o.style&&(s.style.cssText=o.style);var l=this.doCreateDataTableCellWrapper(n,s);(d.ObjUtils.notUnset(o.disableInteract)?!o.disableInteract:a)&&t.addClass(s,r.DATATABLE_HEADCELL_INTERACTABLE),e.setElementText(l,o.text||o.name);var u=this.doCreateDataTableHeadCellSortMark(n,s);return 1===o.sorting?t.addClass(u,r.DATATABLE_SORTASC):-1===o.sorting&&t.addClass(u,r.DATATABLE_SORTDESC),l.title=o.hint||"",s[this.COLDEF_FIELD]=o,i.appendChild(s),s},doCreateDataTableHeadCellSortMark:function(e,t){var n=e.createElement("span");return n.className=r.DATATABLE_SORTMARK,t.appendChild(n),n},doCreateDataTableBody:function(e,t,n,i){var o=n||[],a=(i=i||[],e.createElement("tbody"));if(this.getShowOperCol())var s=this.getOperWidgetDefinitions();for(var l=!0,d=0,u=i.length;d<u;++d){var c=e.createElement("tr");c.className=l?r.DATATABLE_ROW_ODD:r.DATATABLE_ROW_EVEN,l=!l;var h=i[d]||{};c[this.ROWDATA_FIELD]=h;for(var p=0,g=o.length;p<g;++p){var f=o[p],m=f.name,C=h[m],y=e.createElement("td");f.className&&(y.className=f.className),f.style&&(y.style.cssText=f.style);var _=this.doCreateDataTableCellWrapper(e,y);if(f.isOperCol){var E={rowData:h,rowIndex:d,colIndex:p,childWidgetDefinitions:s},T=this.doCreateOperCellContent(_,E);c[this.ROW_OPER_TOOLBAR_FIELD]=T}else if(f.isCheckCol){E={rowData:h,rowIndex:d,colIndex:p};var O=this.doCreateCheckCellContent(_,E);c[this.ROW_CHECKBOX_FIELD]=O}else E={rowData:h,cellKey:m,cellValue:C,rowIndex:d,colIndex:p},this.doCreateDataCellContent(_,E);y.appendChild(_),c.appendChild(y)}a.appendChild(c)}return t.appendChild(a),a},doCreateDataCellContent:function(t,r){var n="";d.ObjUtils.notUnset(r.cellValue)&&(n=""+r.cellValue),e.setElementText(t,n)},doCreateCheckCellContent:function(e,t){var r=new d.Widget.CheckBox(this);return r.appendToElem(e),r},doCreateOperCellContent:function(e,t){var r=this.doCreateOperToolbar(e,t.childWidgetDefinitions),n=d.Widget.DataTable.OperColShowMode;return this.getOperColShowMode()!==n.ALL&&r.setVisible(!1),r},doCreateOperToolbar:function(e,t){var r=new d.Widget.ButtonGroup(this);return r.setChildDefs(t),r.appendToElem(e),r},getDefaultOperButtons:function(){var e=d.Widget.DataTable.Components;return[e.EDIT,e.DELETE]},getOperWidgetDefinitions:function(){for(var e=[],t=this.getOperWidgets()||this.getDefaultOperButtons(),r=0,n=t.length;r<n;++r){var i=t[r];if(DataType.isObjectValue(i))e.push(i);else{var o=this.getDefaultComponentDefinitionHash(i);o&&e.push(o)}}return e},getDefaultComponentDefinitionHash:function(e){var t,n=d.Widget.DataTable.Components;return e===n.EDIT?t={widget:"Kekule.Widget.Button",htmlClass:r.DATATABLE_EDIT,text:d.$L("WidgetTexts.CAPTION_DATATABLE_EDIT"),hint:d.$L("WidgetTexts.HINT_DATATABLE_EDIT"),"#execute":this.reactOperEditBind}:e===n.DELETE?t={widget:"Kekule.Widget.Button",htmlClass:r.DATATABLE_DELETE,text:d.$L("WidgetTexts.CAPTION_DATATABLE_DELETE"),hint:d.$L("WidgetTexts.HINT_DATATABLE_DELETE"),"#execute":this.reactOperDeleteBind}:e===n.INSERT&&(t={widget:"Kekule.Widget.Button",htmlClass:r.DATATABLE_INSERT,text:d.$L("WidgetTexts.CAPTION_DATATABLE_INSERT"),hint:d.$L("WidgetTexts.HINT_DATATABLE_INSERT"),"#execute":this.reactOperInsertBind}),t&&(t.internalName=e),t},hasExternalDataProvider:function(){return!!this.getDataPager()},needSort:function(){return this.getSortFields()||this.getSortFunc()},sortData:function(){var e=this.getData()||[];if(this.needSort()&&!this.hasExternalDataProvider()){var t=d.ArrayUtils.clone(e);return d.ArrayUtils.sortHashArray(t,this.getSortFields()),t}return e},prepareData:function(){var e={},t=this.sortData();e.data=t;var n=function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=d.ObjUtils.getOwnedFieldNames(e[r]);d.ArrayUtils.pushUnique(t,i)}var o=[];for(r=0,n=t.length;r<n;++r)o.push({name:t[r],text:t[r]});return o};this.getColumns()?e.columns=d.ArrayUtils.clone(this.getColumns()):e.columns=n(t);for(var i=0;i<e.columns.length;){var o=e.columns[i];if("string"==typeof o&&(o={name:o}),o.name===this.COLNAME_OPER)e.columns[i]={name:"",text:"",disableInteract:!0,isOperCol:!0,colClassName:r.DATATABLE_OPER_COL,className:r.DATATABLE_OPER_CELL};else if(o.name===this.COLNAME_CHECK)e.columns[i]={name:"",text:"",disableInteract:!0,isCheckCol:!0,colClassName:r.DATATABLE_CHECK_COL,className:r.DATATABLE_CHECK_CELL};else if(o.name===this.COLNAME_ALL){var a=n(t);a.unshift(1),a.unshift(i),e.columns.splice.apply(e.columns,a)}else o.colClassName=r.DATATABLE_DATA_COL+" "+(o.colClassName||""),o.className=r.DATATABLE_DATA_CELL+" "+(o.className||"");++i}if(this.needSort()&&!this.getSortFunc())for(var s=this.getSortFields(),l=(i=0,e.columns.length);i<l;++i){var u=e.columns[i].name;s.indexOf(u)>=0?e.columns[i].sorting=1:s.indexOf(this.PREFIX_SORT_DESC+u)>=0?e.columns[i].sorting=-1:e.columns[i].sorting=0}return e},activeRowChanged:function(e,n){var i=d.Widget.DataTable.OperColShowMode,o=this.getOperColShowMode();e&&(t.removeClass(e,r.STATE_ACTIVE),o!==i.ACTIVE&&o!==i.HOVER||this.hideRowOperToolbar(e)),n&&(t.addClass(n,r.STATE_ACTIVE),o!==i.ACTIVE&&o!==i.HOVER||this.showRowOperToolbar(n))},hoverRowChanged:function(e,n){var i=d.Widget.DataTable.OperColShowMode,o=this.getOperColShowMode();e&&(t.removeClass(e,r.STATE_HOVER),o===i.HOVER&&e!==this.getActiveRow()&&this.hideRowOperToolbar(e)),n&&(t.addClass(n,r.STATE_HOVER),o===i.HOVER&&this.showRowOperToolbar(n))},getParentCell:function(t){return e.isDescendantOf(t,this.getElement())?e.getNearestAncestorByTagName(t,"td",!0):null},getParentHeadCell:function(t){return e.isDescendantOf(t,this.getElement())?e.getNearestAncestorByTagName(t,"th",!0):null},getParentRow:function(t){return e.isDescendantOf(t,this.getElement())?e.getNearestAncestorByTagName(t,"tr",!0):null},getColCount:function(){return(this.getColumns()||[]).length},getRowCount:function(){return(this.getData()||[]).length},getDataRows:function(){var e=this.getElement().getElementsByTagName("tbody")[0];return e&&e.getElementsByTagName("tr")},getCheckedRows:function(){for(var e=[],t=this.getDataRows(),r=0,n=t.length;r<n;++r)this.isRowChecked(t[r])&&e.push(t[r]);return e},getRowData:function(e){return e?e[this.ROWDATA_FIELD]:null},isRowChecked:function(e){var t=this.getRowCheckBox(e);return t&&t.getChecked&&t.getChecked()},getRowCheckBox:function(e){return e&&e[this.ROW_CHECKBOX_FIELD]},getRowOperToolbar:function(e){return e?e[this.ROW_OPER_TOOLBAR_FIELD]:null},showRowOperToolbar:function(e){var t=this.getRowOperToolbar(e);t&&t.setVisible(!0)},hideRowOperToolbar:function(e){var t=this.getRowOperToolbar(e);t&&t.setVisible(!1)},dataPagerChanged:function(e,t){t&&(t.removeEventListener("pageRetrieve",this.reactPagerRetrieve,this),t.removeEventListener("dataFetched",this.reactPagerFetched,this),t.removeEventListener("dataError",this.reactPagerError,this)),e&&(e.addEventListener("pageRetrieve",this.reactPagerRetrieve,this),e.addEventListener("dataFetched",this.reactPagerFetched,this),e.addEventListener("dataError",this.reactPagerError,this),this.setData(e.getCurrPageData()))},reactPagerRetrieve:function(e){this.reportMessage&&(this._loadingDataMsg=this.reportMessage(d.$L("WidgetTexts.MSG_RETRIEVING_DATA"),d.Widget.MsgType.INFO))},reactPagerFetched:function(e){this.setData(e.data),this._loadingDataMsg&&this.removeMessage&&this.removeMessage(this._loadingDataMsg)},reactPagerError:function(e){this._loadingDataMsg&&this.removeMessage&&this.removeMessage(this._loadingDataMsg),this.flashMessage&&this.flashMessage(e.error.message||e.error,d.Widget.MsgType.ERROR)},reactOperEdit:function(e){return this.reactOperExecute(i.EDIT,e)},reactOperDelete:function(e){return this.reactOperExecute(i.DELETE,e)},reactOperInsert:function(e){return this.reactOperExecute(i.INSERT,e)},reactOperExecute:function(e,t){var r=t.target,n=this.getParentRow(r.getElement()),i=this.getRowData(n);return this.doReactOperExecute(e,i,n,t)},doReactOperExecute:function(e,t,r,n){},react_click:function(e){this.tryApplySuper("react_click",[e]);var t=e.getTarget(),r=this.getParentHeadCell(t);if(r)this._autoSortOnHeadCell(r);else if(this.getEnableActiveRow()){var n=this.getParentCell(t);n&&this.setActiveCell(n)}},react_pointerover:function(e){this.tryApplySuper("react_pointerover",[e]);var t=e.getTarget();if(this.getEnableActiveRow()){var r=this.getParentCell(t);r?this.setHoverCell(r):this.setHoverCell(null)}},react_pointerleave:function(e){this.tryApplySuper("react_pointerleave",[e]),e.getTarget(),this.getEnableActiveRow()&&this.setHoverCell(null)},_autoSortOnHeadCell:function(e){if(e&&this.getEnableHeadInteraction()){var t=e[this.COLDEF_FIELD];if(t&&!t.disableInteract){var r=t.name;1===t.sorting&&(r=this.PREFIX_SORT_DESC+r),this.setSortFields([r])}}},load:function(e,t,r,n){this.beginUpdate();try{this.setData(e),this.setColumns(t),this.setSortFields(r?d.ArrayUtils.toArray(r):null),this.setSortFunc(n)}finally{this.endUpdate()}return this},reload:function(){return this.recreateChildContent(),this}}),d.Widget.DataTable.OperColShowMode={NONE:"none",ACTIVE:"active",HOVER:"hover",ALL:"all"},d.Widget.DataTable.Components={EDIT:"edit",DELETE:"delete",INSERT:"insert"};var i=d.Widget.DataTable.Components;d.Widget.PageNavigator=Class.create(d.Widget.ButtonGroup,{CLASS_NAME:"Kekule.Widget.PageNavigator",initProperties:function(){this.defineProp("components",{dataType:DataType.ARRAY}),this.defineProp("firstIndex",{dataType:DataType.INT}),this.defineProp("lastIndex",{dataType:DataType.INT}),this.defineProp("currIndex",{dataType:DataType.INT}),this.defineProp("dataPager",{dataType:"Kekule.Widget.DataPager",setter:function(e){var t=this.getDataPager();t!==e&&(this.setPropStoreFieldValue("dataPager",e),this.dataPagerChanged(e,t))}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setShowText(!0),this.setShowGlyph(!0),this.setFirstIndex(1),this.reactFirstBind=this.reactFirst.bind(this),this.reactLastBind=this.reactLast.bind(this),this.reactPrevBind=this.reactPrev.bind(this),this.reactNextBind=this.reactNext.bind(this),this.reactPageInputChangeBind=this.reactPageInputChange.bind(this)},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]),d.ArrayUtils.intersect(e,["firstIndex","lastIndex","currIndex"]).length&&this.updateChildComponent(),e.indexOf("currIndex")>=0&&this.invokeEvent("pageChange",{currIndex:this.getCurrIndex()})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.PAGENAVIGATOR},doCreateSubElements:function(e,t){return this.recreateChildContent(e,t)},getDefaultComponents:function(){return[o.FIRST,o.PREV,o.PAGESELECTOR,o.NEXT,o.LAST]},recreateChildContent:function(){for(var e=this.getComponents()||this.getDefaultComponents(),t=[],r=0,n=e.length;r<n;++r){var i=e[r];if(DataType.isObjectValue(i))t.push(i);else{var o=this.getDefaultComponentDefinitionHash(i);o&&t.push(o)}}this.setChildDefs(t),this.updateChildComponent()},getDefaultComponentDefinitionHash:function(e){var t;return(t=e===o.FIRST?{widget:"Kekule.Widget.Button",htmlClass:r.PAGENAVIGATOR_FIRST,text:d.$L("WidgetTexts.CAPTION_FIRST_PAGE"),hint:d.$L("WidgetTexts.HINT_FIRST_PAGE"),"#execute":this.reactFirstBind}:e===o.LAST?{widget:"Kekule.Widget.Button",htmlClass:r.PAGENAVIGATOR_LAST,text:d.$L("WidgetTexts.CAPTION_LAST_PAGE"),hint:d.$L("WidgetTexts.HINT_LAST_PAGE"),"#execute":this.reactLastBind}:e===o.PREV?{widget:"Kekule.Widget.Button",htmlClass:r.PAGENAVIGATOR_PREV,text:d.$L("WidgetTexts.CAPTION_PREV_PAGE"),hint:d.$L("WidgetTexts.HINT_PREV_PAGE"),"#execute":this.reactPrevBind}:e===o.NEXT?{widget:"Kekule.Widget.Button",htmlClass:r.PAGENAVIGATOR_NEXT,text:d.$L("WidgetTexts.CAPTION_NEXT_PAGE"),hint:d.$L("WidgetTexts.HINT_NEXT_PAGE"),"#execute":this.reactNextBind}:e===o.PAGEINPUT?{widget:"Kekule.Widget.TextBox",htmlClass:[r.PAGENAVIGATOR_PAGEINPUT,r.PAGENAVIGATOR_PAGEINDEXER],hint:d.$L("WidgetTexts.HINT_CURR_PAGE"),"#valueChange":this.reactPageInputChangeBind}:e===o.PAGESELECTOR?{widget:"Kekule.Widget.SelectBox",htmlClass:[r.PAGENAVIGATOR_PAGESELECTOR,r.PAGENAVIGATOR_PAGEINDEXER],hint:d.$L("WidgetTexts.HINT_CURR_PAGE"),"#valueChange":this.reactPageInputChangeBind}:null)&&(t.internalName=e),t},getComponent:function(e){return this.getChildWidgetByInternalName(e)},setChildComponentEnabled:function(e,t){var r=this.getComponent(e);r&&r.setEnabled(t)},updateChildComponent:function(){var e=this.getFirstIndex()||0,t=this.getLastIndex()||0,r=this.getCurrIndex()||0,n=r<=e,i=r>=t;this.setChildComponentEnabled(o.FIRST,!n),this.setChildComponentEnabled(o.PREV,!n),this.setChildComponentEnabled(o.NEXT,!i),this.setChildComponentEnabled(o.LAST,!i),this.setChildComponentEnabled(o.PAGEINPUT,t>e),this.setChildComponentEnabled(o.PAGESELECTOR,t>e);var a=this.getComponent(o.PAGEINPUT);a&&a.setValue(r);var s=this.getComponent(o.PAGESELECTOR);if(s){for(var l=[],d=e;d<=t;++d)l.push({value:d});s.setItems(l),s.setValue(r)}},dataPagerChanged:function(e,t){t&&(t.removeEventListener("dataFetched",this.reactPagerFetched,this),e.removeEventListener("pageCountChange",this.reactPagerPageCountChange,this)),e&&(e.addEventListener("dataFetched",this.reactPagerFetched,this),e.addEventListener("pageCountChange",this.reactPagerPageCountChange,this),this.updatePageDetails(e),this.setCurrIndex(e.getCurrPageIndex()+this.getFirstIndex()))},reactPagerFetched:function(e){this.setCurrIndex(e.pageIndex+this.getFirstIndex())},reactPagerPageCountChange:function(e){this.updatePageDetails(this.getDataPager())},updatePageDetails:function(e){var t=this.getFirstIndex();this.setLastIndex(e.getPageCount()+t-1)},requestChangeCurrIndex:function(e){var t=this.getDataPager();t?t.switchToPage(e-this.getFirstIndex()):this.setCurrIndex(e)},reactFirst:function(e){this.requestChangeCurrIndex(this.getFirstIndex()||0)},reactLast:function(e){this.requestChangeCurrIndex(this.getLastIndex()||0)},reactPrev:function(e){var t=this.getFirstIndex()||0,r=this.getCurrIndex()||0;this.requestChangeCurrIndex(Math.max(r-1,t))},reactNext:function(e){var t=this.getLastIndex()||0,r=this.getCurrIndex()||0;this.requestChangeCurrIndex(Math.min(r+1,t))},reactPageInputChange:function(e){var t=e.target.getValue();"string"==typeof t&&(t=parseInt(t));var r=this.getFirstIndex()||0,n=this.getLastIndex()||0;t>=r&&t<=n?this.requestChangeCurrIndex(t):d.error(d.$L("ErrorMsg.PAGE_INDEX_OUTOF_RANGE"))}}),d.Widget.PageNavigator.Components={FIRST:"first",LAST:"last",PREV:"prev",NEXT:"next",PAGEINPUT:"pageInput",PAGESELECTOR:"pageSelector"};var o=d.Widget.PageNavigator.Components}(),function(){"use strict";d.HtmlElementUtils;var e=d.Widget.HtmlClassNames;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{SYSMSGGROUP:"K-SysMsgGroup"}),d.Widget.SysMsgGroup=Class.create(d.Widget.MsgGroup,{CLASS_NAME:"Kekule.Widget.SysMsgGroup",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMaxMsgCount(6)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.SYSMSGGROUP}}),d.Widget.ExceptionHandler=Class.create(d.ExceptionHandler,{CLASS_NAME:"Kekule.Widget.ExceptionHandler",initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getPropStoreFieldValue("document")||document}}),this.defineProp("sysMsgGroup",{dataType:"Kekule.Widget.SysMsgGroup",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("sysMsgGroup");if(!e){var t=(e=new d.Widget.SysMsgGroup(this.getDocument())).getGlobalManager();e.appendToElem(t.getDefaultContextRootElem()),this.setPropStoreFieldValue("sysMsgGroup",e)}return e}})},throwException:function(e,t){var r,n=d.ExceptionLevel,i=d.Widget.MsgType;if(t||(t=n.ERROR),r="string"==typeof e?e:e.message){var o=t!==n.ERROR&&t!==n.NOT_FATAL_ERROR&&t?t===n.WARNING?i.WARNING:t===n.NOTE?i.INFO:i.NORMAL:i.ERROR;this.getSysMsgGroup().addMessage(r,o)}return this.tryApplySuper("throwException",[e,t])}}),d.ClassUtils.makeSingleton(d.Widget.ExceptionHandler),d.X.domReady((function(){d.exceptionHandler=d.Widget.ExceptionHandler.getInstance()}))}(),function(){"use strict";var e=d.Widget.HtmlClassNames;d.Widget.HtmlClassNames=Object.extend(d.Widget.HtmlClassNames,{OPER_HISTORY_TREE_VIEW:"K-OperHistory-TreeView"}),d.Widget.OperHistoryTreeView=Class.create(d.Widget.TreeView,{CLASS_NAME:"Kekule.Widget.OperHistoryTreeView",initialize:function(e,t){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("objMap",new d.MapEx(!0)),this.setEnableLiveUpdate(!0),this.setEnableMultiSelect(!0),this.setOperHistory(t)},initProperties:function(){this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("operHistory");this.setPropStoreFieldValue("operHistory",e),this.operHistoryChanged(e,t)}}),this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL}),this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:!1})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.OPER_HISTORY_TREE_VIEW},operHistoryChanged:function(e,t){this.clearChildItems(),this.getObjMap().clear(),t&&this._uninstallRootEventHandler(t),e&&(this._fillTree(e),this._installRootEventHandler(e))},_installRootEventHandler:function(e){e.addEventListener("operChange",this.reactOperChange,this)},_uninstallRootEventHandler:function(e){e.removeEventListener("operChange",this.reactOperChange,this)},reactOperChange:function(e){this.getEnableLiveUpdate()&&(e.target,this._fillTree(e.target))},_fillTree:function(e){if(e){this.clearChildItems(),this._updateTreeItem(this.appendChildItem(),e);var t=e.getCurrOperation(),r=t?this.getObjMap().get(t):null;this.select(r)}},_getOperChildCount:function(e){return e instanceof d.OperationHistory?e.getOperationCount():e instanceof d.MacroOperation?e.getChildCount():0},_getChildOperAt:function(e,t){return e instanceof d.OperationHistory?e.getOperationAt(t):e instanceof d.MacroOperation?e.getChildAt(t):null},_updateTreeItem:function(e,t){var r={text:this._getOperDisplayTitle(t),obj:t};this.setItemData(e,r),this.getObjMap().set(t,e);for(var n=this.getChildItemCount(e),i=this._getOperChildCount(t),o=0;o<i;++o){var a,s=this._getChildOperAt(t,o);a=o<n?this.getChildItemAt(e,o):this.appendChildItem(e),this._updateTreeItem(a,s)}if(n>i)for(o=n-1;o>=i;--o)this.removeChildItemAt(e,o)},_getOperDisplayTitle:function(e){var t=e.getClassName(),r=e.getTarget?e.getTarget():null;return r&&r.getId&&(t+="(target: "+r.getId()+")"),t}})}(),d.ChemWidget={},d.ChemWidget.AbstractWidget=d.Widget.BaseWidget,d.ChemWidget.ComponentWidgetNames={menu:"menu",newDoc:"newDoc",clearObjs:"clearObjs",loadFile:"loadFile",loadData:"loadData",saveData:"saveData",zoomIn:"zoomIn",zoomOut:"zoomOut",resetZoom:"resetZoom",rotateRight:"rotateRight",rotateLeft:"rotateLeft",rotateX:"rotateX",rotateY:"rotateY",rotateZ:"rotateZ",reset:"reset",molDisplayType:"molDisplayType",molDisplayTypeCondensed:"molDisplayTypeCondensed",molDisplayTypeSkeletal:"molDisplayTypeSkeletal",molDisplayTypeWire:"molDisplayTypeWire",molDisplayTypeSticks:"molDisplayTypeSticks",molDisplayTypeBallStick:"molDisplayTypeBallStick",molDisplayTypeSpaceFill:"molDisplayTypeSpaceFill",molHideHydrogens:"molHideHydrogens",openEditor:"openEditor",config:"config",objInspector:"objInspector",issueInspector:"issueInspector",undo:"undo",redo:"redo",copy:"copy",cut:"cut",paste:"paste",cloneSelection:"cloneSelection",selectAll:"selectAll",toggleSelect:"toggleSelect",eraseSelection:"eraseSelection",recheckIssues:"recheckIssues",toggleShowAllIssues:"toggleShowAllIssues",dragScroll:"dragScroll",erase:"erase",manipulate:"manipulate",trackInput:"trackInput",molBond:"bond",molAtom:"atom",molFormula:"formula",molAtomAndFormula:"atomAndFormula",molCharge:"charge",textBlock:"textBlock",imageBlock:"imageBlock",molRing:"ring",glyph:"glyph",textImage:"textImage",fontName:"fontName",fontSize:"fontSize",color:"color",textDirection:"textDirection",textAlign:"textAlign",nodeDisplayMode:"nodeDisplayMode"},d.ChemWidget.HtmlClassNames={PREFIX:"K-Chem-",INNER_TOOLBAR:"K-Chem-InnerToolbar"},function(){"use strict";Class.PropertyScope,d.ChemWidget,d.Widget.HtmlClassNames;var e=d.ChemWidget.HtmlClassNames;d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{DIALOG_LOADDATA:"K-Chem-Dialog-LoadData",DIALOG_LOADDATA_FORMATBOX:"K-Chem-Dialog-LoadData-FormatBox",DIALOG_LOADDATA_SRCEDITOR_REGION:"K-Chem-Dialog-LoadData-SrcEditorRegion",DIALOG_LOADDATA_SRCEDITOR:"K-Chem-Dialog-LoadData-SrcEditor",DIALOG_LOADDATA_BTN_LOADFROMFILE:"K-Chem-Dialog-LoadData-Btn-LoadFromFile",DIALOG_LOADAPPENDDATA:"K-Chem-Dialog-LoadAppendData",DIALOG_LOADAPPENDDATA_APPENDCHECKBOX:"K-Chem-Dialog-LoadAppendData-AppendCheckBox"}),d.ChemWidget.LoadDataDialog=Class.create(d.Widget.Dialog,{CLASS_NAME:"Kekule.ChemWidget.LoadDataDialog",initialize:function(e,t,r){this._openFileAction=new d.ActionLoadFileData,this._openFileAction.setBinaryDetector(this._detectBinaryFormat),this._openFileAction.update(),this._openFileAction.addEventListener("load",this.reactFileLoad,this),this._sBtnLoadFromFile=d.$L("ChemWidgetTexts.CAPTION_LOADDATA_FROM_FILE"),this._formatItems=null,this.tryApplySuper("initialize",[e,t||d.$L("ChemWidgetTexts.CAPTION_LOADDATA_DIALOG"),r||[d.Widget.DialogButtons.OK,d.Widget.DialogButtons.CANCEL]]),this.setResizable&&this.setResizable(!0)},finalize:function(){this._openFileAction.finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:null,getter:function(){var e=this.getDataDetails();return e&&e.data?d.IO.loadTypedData(e.data,e.mimeType,e.fileName):null}}),this.defineProp("allowedFormatIds",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("allowedFormatIds",e),this.updateFormatItems()}}),this.defineProp("dataDetails",{dataType:DataType.HASH,setter:null,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoAdjustSizeOnPopup(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.DIALOG_LOADDATA},doCreateClientContents:function(t){this.tryApplySuper("doCreateClientContents");var r=this.getDocument();(n=r.createElement("div")).innerHTML=d.$L("ChemWidgetTexts.CAPTION_DATA_FORMAT"),t.appendChild(n),n=r.createElement("div"),t.appendChild(n);var n,i=new d.Widget.SelectBox(this);i.addClassName(e.DIALOG_LOADDATA_FORMATBOX),i.appendToElem(n),this._formatSelector=i,this.updateFormatItems(),(n=r.createElement("div")).innerHTML=d.$L("ChemWidgetTexts.CAPTION_DATA_SRC"),t.appendChild(n),(n=r.createElement("div")).className=e.DIALOG_LOADDATA_SRCEDITOR_REGION,t.appendChild(n);var o=new d.Widget.TextEditor(this);o.setWrap("off").setAutoWrapThreshold(!0).setFileDroppable(!0),o.setToolbarPos(d.Widget.Position.BOTTOM),o.addClassName(e.DIALOG_LOADDATA_SRCEDITOR),o.appendToElem(n),this._dataEditor=o},getFormatSelectorItems:function(e){for(var t=[],r=this.getAllowedFormatIds()||d.IO.ChemDataReaderManager.getAllReadableFormatIds(),n=0,i=r.length;n<i;++n){var o=d.IO.DataFormatsManager.getFormatInfo(r[n]);if(o){for(var a=d.ArrayUtils.clone(d.ArrayUtils.toArray(o.fileExts)),s=0,l=a.length;s<l;++s)a[s]="*."+a[s];var u=a.join(", "),c=o.title;u&&(c+=" ("+u+")"),t.push({value:o.id,formatId:o.id,text:c,title:o.mimeType,data:o})}}return t.sort((function(e,t){return e.text<t.text?-1:e.text>t.text?1:0})),t},getFileFilters:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r],o=i.data,a=i.text||i.title||i.value,s=d.ArrayUtils.toArray(o.fileExts);t.push({title:a,filter:"."+s.join(",.")})}return t.push(d.NativeServices.FILTER_ALL_SUPPORT),t.push(d.NativeServices.FILTER_ANY),t},updateFormatItems:function(){this._formatItems=this.getFormatSelectorItems(),this._formatSelector.setItems(this._formatItems);var e=this.getFileFilters(this._formatItems);this._openFileAction.setFilters(e)},doSetButtons:function(t){var r=t||[];r.indexOf(this._sBtnLoadFromFile)<0&&r.unshift(this._sBtnLoadFromFile),this.tryApplySuper("doSetButtons",[r]);var n=this.getDialogButton(this._sBtnLoadFromFile);n.setAction(this._openFileAction),n.linkStyleResource(d.Widget.StyleResourceNames.BUTTON_LOAD_FILE),n.addClassName(e.DIALOG_LOADDATA_BTN_LOADFROMFILE),n.setEnabled(this._openFileAction.getEnabled())},reactFileLoad:function(e){var t=e.data,r=e.fileName;try{if(e.success&&t&&r){this.setPropStoreFieldValue("dataDetails",{data:t,fileName:r});var n=d.Widget.DialogButtons.OK;this.close(n)}}catch(e){d.error(e)}},open:function(e,t,r){return this.setPropStoreFieldValue("dataDetails",{}),this.tryApplySuper("open",[e,t,r])},close:function(e){if(!this.getChemObj()&&this.isPositiveResult(e)){var t=this._dataEditor.getValue(),r=this._formatSelector.getSelectedItemData(),n=r.id,i=r.mimeType;try{this.setPropStoreFieldValue("dataDetails",{data:t,mimeType:i,formatId:n})}catch(e){d.raise(e,d.ExceptionLevel.ERROR)}}return this.tryApplySuper("close",[e])},_detectBinaryFormat:function(e,t){if(t&&e){var r=d.UrlUtils.extractFileExt(e),n=d.IO.DataFormatsManager.findFormat(null,r);if(n)return d.IO.ChemDataType.isBinaryType(n.dataType)}return!1}}),d.ChemWidget.LoadOrAppendDataDialog=Class.create(d.ChemWidget.LoadDataDialog,{CLASS_NAME:"Kekule.ChemWidget.LoadOrAppendDataDialog",initialize:function(e,t,r){this._appendCheckBox=null,this.tryApplySuper("initialize",[e,t,r])},initProperties:function(){this.defineProp("displayAppendCheckBox",{dataType:DataType.BOOL}),this.defineProp("isAppending",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._appendCheckBox&&this._appendCheckBox.getChecked()},setter:function(e){this._appendCheckBox&&this._appendCheckBox.setChecked(!!e)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.DIALOG_LOADAPPENDDATA},doCreateClientContents:function(t){this.tryApplySuper("doCreateClientContents",[t]),this.getDocument();var r=new d.Widget.CheckBox(this);r.addClassName(e.DIALOG_LOADAPPENDDATA_APPENDCHECKBOX),r.setText(d.$L("ChemWidgetTexts.CAPTION_LOADDATA_DIALOG_APPENDMODE")),r.appendToElem(t),r.setDisplayed(this.getDisplayAppendCheckBox()),this._appendCheckBox=r},open:function(e,t,r){return this.setIsAppending(!1),this._appendCheckBox.setDisplayed(this.getDisplayAppendCheckBox()),this.tryApplySuper("open",[e,t,r])}})}(),function(){"use strict";var e=d.DomUtils,t=d.HtmlElementUtils,r=d.Widget.HtmlClassNames,n=d.ChemWidget.HtmlClassNames;d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{PERIODIC_TABLE:"K-Chem-Periodic-Table",PERIODIC_TABLE_MINI:"K-Chem-Periodic-Table-Mini",PERIODIC_TABLE_LEGEND:"K-Chem-Periodic-Table-Legend",PERIODIC_TABLE_LEGEND_CONTENT:"K-Chem-Periodic-Table-Legend-Content",PERIODIC_TABLE_LEGEND_COLORS:"K-Chem-Periodic-Table-Legend-Colors",PERIODIC_TABLE_LEGEND_COLOR:"K-Chem-Periodic-Table-Legend-Color",PERIODIC_TABLE_MAINTABLE:"K-Chem-Periodic-Table-MainTable",PERIODIC_TABLE_EXTRATABLE:"K-Chem-Periodic-Table-ExtraTable",PERIODIC_TABLE_ELEM_CELL:"K-Chem-Periodic-Table-Elem-Cell",PERIODIC_TABLE_ELEM_STUBSCELL:"K-Chem-Periodic-Table-Elem-StubsCell",PERIODIC_TABLE_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_HEAD_CELL:"K-Chem-Periodic-Table-Head-Cell",PERIODIC_TABLE_HEAD_CELL_CONTENT:"K-Chem-Periodic-Table-Head-Cell-Content",PERIODIC_TABLE_HEAD_CELL_GROUP:"K-Chem-Periodic-Table-Head-Cell-Group",PERIODIC_TABLE_HEAD_CELL_PERIOD:"K-Chem-Periodic-Table-Head-Cell-Period",ELEM_SYMBOL:"K-Chem-Elem-Symbol",ELEM_SYMBOL_STUBS:"K-Chem-Elem-Symbol-Stubs",ELEM_NAME:"K-Chem-Elem-Name",ATOMIC_NUM:"K-Chem-Atomic-Num",ATOMIC_WEIGHT:"K-Chem-Atomic-Weight"}),d.globalOptions.add("chemWidget.periodicTable",{displayedComponents:["symbol","name","atomicNumber","groupHead","legend"]}),d.ChemWidget.PeriodicTable=Class.create(d.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.PeriodicTable",BINDABLE_TAG_NAMES:["span","div"],ELEM_DATA_FIELD:"__$elemData__",MAX_GROUP:18,MAX_PERIOD:7,LA_SERIES:["La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu"],AC_SERIES:["Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr"],initialize:function(e,t){this.setPropStoreFieldValue("displayedComponents",t||this.getDefaultDisplayedComponents()),this._elemCells=[],this._selectedElemCells=[],this.tryApplySuper("initialize",[e]),this.setEnableSelect(!0),this.setEnableMultiSelect(!0)},initProperties:function(){this.defineProp("displayedComponents",{dataType:DataType.ARRAY,getter:function(){return this.getPropStoreFieldValue("displayedComponents")||this.getDefaultDisplayedComponents()}}),this.defineProp("startingAtomNum",{dataType:DataType.INT}),this.defineProp("endingAtomNum",{dataType:DataType.INT}),this.defineProp("startingElementSymbol",{dataType:DataType.INT,serializable:!1,getter:function(){var e=this.getStartingAtomNum();return e&&d.ChemicalElementsDataUtil.getElementSymbol(e)},setter:function(e){this.setStartingAtomNum(e&&d.ChemicalElementsDataUtil.getAtomicNumber(e)||null)}}),this.defineProp("endingElementSymbol",{dataType:DataType.INT,serializable:!1,getter:function(){var e=this.getEndingAtomNum();return e&&d.ChemicalElementsDataUtil.getElementSymbol(e)},setter:function(e){this.setEndingAtomNum(e&&d.ChemicalElementsDataUtil.getAtomicNumber(e)||null)}}),this.defineProp("enabledElementSymbols",{dataType:DataType.ARRAY}),this.defineProp("disabledElementSymbols",{dataType:DataType.ARRAY}),this.defineProp("useMiniMode",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("useMiniMode",e),e?this.addClassName(n.PERIODIC_TABLE_MINI):this.removeClassName(n.PERIODIC_TABLE_MINI)}}),this.defineProp("enableSelect",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableSelect")||this.getEnableMultiSelect()}}),this.defineProp("enableMultiSelect",{dataType:DataType.BOOL}),this.defineProp("selected",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(){return this.getSelection()?this.getSelection()[0]:null}}),this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,setter:null,getter:function(){for(var e=[],t=this._selectedElemCells||[],r=0,n=t.length;r<n;++r){var i=t[r][this.ELEM_DATA_FIELD];i&&e.push(i)}return e}}),this.defineProp("selectedSymbol",{dataType:DataType.STRING,getter:function(){return this.getSelectedSymbols()[0]},setter:function(e){this.setSelectedSymbols([e])}}),this.defineProp("selectedSymbols",{dataType:DataType.ARRAY,getter:function(){var e=this.getSelection();if(e){for(var t=[],r=0,n=e.length;r<n;++r)t.push(e[r].symbol);return t}return[]},setter:function(e){this.selectSymbols(e)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.PERIODIC_TABLE},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),n=this.createMainTable(e,t);return r.concat([n])},doObjectChange:function(e){var t=["displayedComponents","startingAtomNum","endingAtomNum"];d.ArrayUtils.intersect(e,t).length&&this.recreateMainTable(),t=["enabledElementSymbols","disabledElementSymbols"],d.ArrayUtils.intersect(e,t).length&&this.updateCellEnableStates()},getDefaultDisplayedComponents:function(){return d.globalOptions.chemWidget.periodicTable.displayedComponents},getShowElemSymbol:function(){return this.getDisplayedComponents().indexOf("symbol")>=0},getShowElemName:function(){return this.getDisplayedComponents().indexOf("name")>=0},getShowAtomicNum:function(){return this.getDisplayedComponents().indexOf("atomicNumber")>=0},getShowAtomicWeight:function(){return this.getDisplayedComponents().indexOf("atomicWeight")>=0},getShowGroupHead:function(){return this.getDisplayedComponents().indexOf("groupHead")>=0},getShowPeriodHead:function(){return this.getDisplayedComponents().indexOf("periodHead")>=0},getShowLegend:function(){return this.getDisplayedComponents().indexOf("legend")>=0},recreateMainTable:function(){this.deselectAll();var t=this.getElement();e.clearChildContent(t),this.createMainTable(t.ownerDocument,t)},createMainTable:function(t,i){var o=d.chemicalElementsData,a=[];this._elemCells=[];for(var s=[],l=[],u=t.createElement("table"),c=0;c<=this.MAX_PERIOD;++c){for(var h=t.createElement("tr"),p=[],g=0;g<=this.MAX_GROUP;++g){var f=t.createElement("td");h.appendChild(f),p.push(f)}u.appendChild(h),a.push(p)}var m=t.createElement("table");for(c=0;c<2;++c){for(h=t.createElement("tr"),p=[],g=0;g<this.LA_SERIES.length;++g)f=t.createElement("td"),h.appendChild(f),p.push(f);m.appendChild(h),s.push(p)}for(var C=this.getStartingAtomNum()||0,y=this.getEndingAtomNum()||3e5,_=0,E=o.length;_<E;++_){var T=o[_],O=T.atomicNumber;if(!(O<C||O>y)){var v=T.symbol,S=T.period,b=T.group,A=T.chemicalSerie.replace(/\s/g,"");d.ArrayUtils.pushUnique(l,T.chemicalSerie);var I=this.LA_SERIES.indexOf(v),R=this.AC_SERIES.indexOf(v);I>=0?f=s[0][I]:R>=0?f=s[1][R]:S&&b&&(f=a[S][b]),f&&(f.className=n.PERIODIC_TABLE_ELEM_CELL,f.appendChild(this.createElemCellContent(t,T,A.upperFirst())),f[this.ELEM_DATA_FIELD]=T,this._elemCells.push(f)),0!==I&&0!==R||((f=a[S][b]).className=n.PERIODIC_TABLE_ELEM_STUBSCELL,f.appendChild(this.createElemCellStubsContent(t,T,A.upperFirst())))}}if(this.getShowGroupHead()){var D=["IA","IIA","IIIB","IVB","VB","VIB","VIIB","","VIII","","IB","IIB","IIIA","IVA","VA","VIA","VIIA","VIIIA"];for(g=1;g<=this.MAX_GROUP;++g)(f=a[c=1===g||18===g?0:2===g||g>=13?1:3][g]).className=n.PERIODIC_TABLE_HEAD_CELL+" "+n.PERIODIC_TABLE_HEAD_CELL_GROUP,f.appendChild(this.createHeadContent(t,D[g-1]))}if(this.getShowPeriodHead())for(c=1;c<=this.MAX_PERIOD;++c)(f=a[c][0]).className=n.PERIODIC_TABLE_HEAD_CELL+" "+n.PERIODIC_TABLE_HEAD_CELL_PERIOD,f.appendChild(this.createHeadContent(t,c));if(i.appendChild(u),this.getShowLegend()){var N=t.createElement("a");N.href="javascript:void(0)",N.className=n.PERIODIC_TABLE_LEGEND+" "+r.CORNER_ALL,e.setElementText(N,d.$L("ChemWidgetTexts.LEGEND_CAPTION"));var P=t.createElement("div");P.className=n.PERIODIC_TABLE_LEGEND_CONTENT+" "+r.CORNER_ALL;var x={symbol:d.$L("ChemWidgetTexts.LEGEND_ELEM_SYMBOL"),atomicNumber:d.$L("ChemWidgetTexts.LEGEND_ATOMIC_NUM"),naturalMass:d.$L("ChemWidgetTexts.LEGEND_ATOMIC_WEIGHT"),name:d.$L("ChemWidgetTexts.LEGEND_ELEM_NAME")},M=this.createElemCellContent(t,x,n.PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT);P.appendChild(M);var L=t.createElement("div");for(L.className=n.PERIODIC_TABLE_LEGEND_COLORS,_=0,E=l.length;_<E;++_){var w=t.createElement("div");w.className=n.PERIODIC_TABLE_LEGEND_COLOR+" "+l[_].replace(/\s/g,""),e.setElementText(w,l[_]),L.appendChild(w)}P.appendChild(L),N.appendChild(P),i.appendChild(N)}return i.appendChild(m),this.updateCellEnableStates(),u},createElemCellContent:function(e,t,r){var i=e.createElement("div"),o=n.PERIODIC_TABLE_ELEM_CELL_CONTENT;if(r&&(o+=" "+r),i.className=o,this.getShowAtomicNum()&&i.appendChild(this.createElemContentComponent(e,t.atomicNumber,n.ATOMIC_NUM)),this.getShowAtomicWeight()){var a=t.naturalMass;if(a){var s="number"==typeof a?a.toFixed(3):a;i.appendChild(this.createElemContentComponent(e,s,n.ATOMIC_WEIGHT))}else i.appendChild(this.createElemContentComponent(e,"\xa0",n.ATOMIC_WEIGHT))}return this.getShowElemSymbol()&&i.appendChild(this.createElemContentComponent(e,t.symbol,n.ELEM_SYMBOL)),this.getShowElemName()&&i.appendChild(this.createElemContentComponent(e,t.name,n.ELEM_NAME)),i},createElemCellStubsContent:function(e,t,r){var i,o,a,s=e.createElement("div");return s.className=n.PERIODIC_TABLE_ELEM_CELL_CONTENT+" "+(r||""),a=t.chemicalSerie,"La"===t.symbol?(i="57-71",o="La-Lu"):(i="89-103",o="Ac-Lr"),this.getShowAtomicNum()&&s.appendChild(this.createElemContentComponent(e,i,n.ATOMIC_NUM)),this.getShowElemSymbol()&&s.appendChild(this.createElemContentComponent(e,o,n.ELEM_SYMBOL_STUBS,!0)),this.getShowElemName()&&s.appendChild(this.createElemContentComponent(e,a,n.ELEM_NAME)),s},createElemContentComponent:function(t,r,n,i){var o=t.createElement("span");if(o.className=n,i){var a=t.createElement("span");o.appendChild(a)}return e.setElementText(a||o,r),o},createHeadContent:function(t,r,i){var o=t.createElement("div");return o.className=n.PERIODIC_TABLE_HEAD_CELL_CONTENT+" "+(i||""),e.setElementText(o,r),o},updateCellEnableStates:function(){var e=this.getEnabledElementSymbols()||[],t=!e.length&&this.getDisabledElementSymbols()||[];if(t.length||e.length)for(var r=this._elemCells,n=0,i=r.length;n<i;++n){var o=this._getCellData(r[n]).symbol;e.length?e.indexOf(o)<0&&this.setCellEnableState(r[n],!1):t.length&&t.indexOf(o)>=0&&this.setCellEnableState(r[n],!1)}},setCellEnableState:function(e,n){n?(t.removeClass(e,r.STATE_DISABLED),this._getCellData(e).disabled=null):(t.addClass(e,r.STATE_DISABLED),this._getCellData(e).disabled=!0)},_getCellData:function(e){return e[this.ELEM_DATA_FIELD]},_isCellDisabled:function(e){return!!this._getCellData(e).disabled},_getAtomCellElem:function(t){var r=e.getNearestAncestorByTagName(t,"td",!0);return r&&this._elemCells.indexOf(r)>=0?r:null},_getCellElemOfSymbol:function(e){for(var t=this._elemCells,r=0,n=t.length;r<n;++r){var i=t[r];if(i[this.ELEM_DATA_FIELD].symbol===e)return i}return null},isCellSelected:function(e){return this._selectedElemCells.indexOf(e)>=0},selectCell:function(e){e&&(t.addClass(e,r.STATE_SELECTED),d.ArrayUtils.pushUnique(this._selectedElemCells,e),this.invokeEvent("select",{elemData:e[this.ELEM_DATA_FIELD]}))},deselectCell:function(e){e&&(t.removeClass(e,r.STATE_SELECTED),d.ArrayUtils.remove(this._selectedElemCells,e),this.invokeEvent("deselect",{elemData:e[this.ELEM_DATA_FIELD]}))},toggleCell:function(e){this.isCellSelected(e)?this.deselectCell(e):this.selectCell(e)},deselectAll:function(){for(var e=this._selectedElemCells,t=e.length-1;t>=0;--t)this.deselectCell(e[t]);return this},selectSymbols:function(e){this.deselectAll();for(var t=d.ArrayUtils.toArray(e),r=0,n=t.length;r<n;++r){var i=this._getCellElemOfSymbol(t[r]);i&&this.selectCell(i)}return this},react_click:function(e){if(this.getEnableSelect()){var t=e.getTarget(),r=this._getAtomCellElem(t);if(r&&!this._isCellDisabled(r))return this.getEnableMultiSelect()?this.toggleCell(r):(this.deselectAll(),this.selectCell(r)),!0}this.tryApplySuper("react_click",[e])}})}(),function(){"use strict";var e=Class.PropertyScope,t=(d.DomUtils,d.ZoomUtils),r=(d.ChemWidget,d.Widget.HtmlClassNames),n=d.ChemWidget.HtmlClassNames;d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{DISPLAYER_DRAWCONTEXT_PARENT:"K-Chem-Displayer-DrawContext-Parent",ACTION_MOL_DISPLAY_TYPE:"K-Chem-MolDisplayType",ACTION_MOL_DISPLAY_SKELETAL:"K-Chem-MolDisplaySkeletal",ACTION_MOL_DISPLAY_CONDENSED:"K-Chem-MolDisplayCondensed",ACTION_MOL_DISPLAY_WIRE:"K-Chem-MolDisplayWire",ACTION_MOL_DISPLAY_BALLSTICK:"K-Chem-MolDisplayBallStick",ACTION_MOL_DISPLAY_STICKS:"K-Chem-MolDisplaySticks",ACTION_MOL_DISPLAY_SPACEFILL:"K-Chem-MolDisplaySpaceFill",ACTION_MOL_HIDE_HYDROGENS:"K-Chem-MolHideHydrogens",ACTION_ZOOMIN:"K-Chem-ZoomIn",ACTION_ZOOMOUT:"K-Chem-ZoomOut",ACTION_RESET:"K-Chem-Reset",ACTION_COPY:"K-Chem-Copy",ACTION_RESET_ZOOM:"K-Chem-ResetZoom",ACTION_LOADFILE:"K-Chem-LoadFile",ACTION_LOADDATA:"K-Chem-LoadData",ACTION_SAVEFILE:"K-Chem-SaveFile",ACTION_CLEAROBJS:"K-Chem-ClearObjs",ACTION_CONFIG:"K-Chem-Config",DIALOG_CHOOSE_FILE_FORAMT:"K-Chem-Dialog-Choose-File-Format",DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX:"K-Chem-Dialog-Choose-File-Format-FormatBox",DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER_REGION:"K-Chem-Dialog-Choose-File-Format-PreviewerRegion",DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER:"K-Chem-Dialog-Choose-File-Format-Previewer"}),d.ChemWidget.ChemObjDisplayerConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerConfigs",initProperties:function(){this.addConfigProp("ioConfigs","Kekule.ChemWidget.ChemObjDisplayerIOConfigs"),this.addConfigProp("environment2DConfigs","Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs"),this.addConfigProp("environment3DConfigs","Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("ioConfigs",new d.ChemWidget.ChemObjDisplayerIOConfigs),this.setPropStoreFieldValue("environment2DConfigs",new d.ChemWidget.ChemObjDisplayerEnvironmentConfigs),this.setPropStoreFieldValue("environment3DConfigs",new d.ChemWidget.ChemObjDisplayerEnvironmentConfigs)}}),d.ChemWidget.ChemObjDisplayerIOConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerIOConfigs",initProperties:function(){this.addBoolConfigProp("canonicalizeBeforeSave",!0),this.addBoolConfigProp("autoGenerateCoordsAfterLoad",!0)}}),d.ChemWidget.ChemObjDisplayerEnvironmentConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs",initProperties:function(){this.addBoolConfigProp("antialias",!1),this.addFloatConfigProp("antialiasBlurRatio",0),this.addFloatConfigProp("overSamplingRatio",1)}}),d.ChemWidget.ChemObjDisplayer=Class.create(d.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer",initialize:function(e,t,r,n){this._paintFlag=0,this._bgColorMap={},this._contextTransformOpsMap=new d.MapEx,this.setPropStoreFieldValue("resetAfterLoad",!0),this.setPropStoreFieldValue("renderType",r||d.Render.RendererType.R2D),this.setPropStoreFieldValue("displayerConfigs",n||this.createDefaultConfigs()),this.tryApplySuper("initialize",[e]),t&&this.setChemObj(t),this.setEnableLoadNewFile(!0)},doFinalize:function(){this.setPropStoreFieldValue("chemObj",null),this.getPainter().finalize();var e=this.getPropStoreFieldValue("drawBridge"),t=this.getPropStoreFieldValue("drawContext");t&&e&&e.releaseContext(t),e&&e.finalize&&e.finalize(),this.setPropStoreFieldValue("drawBridge",null),this.setPropStoreFieldValue("drawContext",null),this._contextTransformOpsMap&&this._contextTransformOpsMap.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("displayerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:!1,scope:e.PUBLIC}),this.defineProp("enableLoadNewFile",{dataType:DataType.BOOL}),this.defineProp("allowedInputFormatIds",{dataType:DataType.ARRAY}),this.defineProp("allowedOutputFormatIds",{dataType:DataType.ARRAY}),this.defineProp("standardizationOptions",{dataType:DataType.HASH}),this.defineProp("resetAfterLoad",{dataType:DataType.BOOL}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:e.PUBLISHED,setter:function(e){var t=this.getPropStoreFieldValue("chemObj");this.setPropStoreFieldValue("chemObj",e),this.chemObjChanged(e,t)}}),this.defineProp("chemObjData",{dataType:DataType.STRING,serializable:!1,getter:null,setter:function(e){var t,r;(t="object"==typeof e?e:JSON.parse(e))&&(r=t.format?d.IO.loadFormatData(t.data,t.format):t.mimeType?d.IO.loadMimeData(t.data,t.mimeType):null)&&this._tryAutoGenerateChemObjCoordsAndLoad(r)}}),this.defineProp("chemObjLoaded",{dataType:DataType.BOOL,serializable:!1,scope:e.PUBLIC,setter:null,getter:function(){return this.getChemObj()&&this.getPropStoreFieldValue("chemObjLoaded")}}),this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,enumSource:d.Render.RendererType,scope:e.PUBLISHED,setter:function(e){if(this.getAllowRenderTypeChange()){var t=this.getRenderType();e!==t&&(this.setPropStoreFieldValue("renderType",e),this.resetRenderType(t,e))}else d.error(d.$L("ErrorMsg.RENDER_TYPE_CHANGE_NOT_ALLOWED"))}}),this.defineProp("renderConfigs",{dataType:DataType.OBJECT,serializable:!1,scope:e.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("renderConfigs");return e||(e=this.getRenderType()===d.Render.RendererType.R3D?d.Render.Render3DConfigs.getInstance():d.Render.Render2DConfigs.getInstance()),e},setter:function(e){this.setPropStoreFieldValue("renderConfigs",e);var t=this.getPropStoreFieldValue("painter");t&&t.setRenderConfigs(this.getRenderConfigs())}}),this.defineProp("backgroundColor",{dataType:DataType.STRING,scope:e.PUBLISHED,setter:function(e){this.setPropStoreFieldValue("backgroundColor",e),this._bgColorMap[this.getRenderType().toString()]=e,this.backgroundColorChanged()}}),this.defineProp("inheritedRenderStyles",{dataType:DataType.ARRAY,scope:e.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("inheritedRenderStyles");return e||(e=[],this.setPropStoreFieldValue("inheritedRenderStyles",e)),e},setter:function(e){this.setPropStoreFieldValue("inheritedRenderStyles",e||[]),this.requestRepaint()}}),this.defineProp("inheritedRenderColor",{dataType:DataType.BOOL,scope:e.PUBLISHED,getter:function(){var e=this.getInheritedRenderStyles();return!!(e&&e.indexOf("color")>=0)},setter:function(e){if(!!e!==this.getInheritedRenderColor()){var t=this.getInheritedRenderStyles();e?t.push("color"):d.ArrayUtils.remove(t,"color"),this.setInheritedRenderStyles(t)}}}),this.defineProp("inheritedRenderBackgroundColor",{dataType:DataType.BOOL,scope:e.PUBLISHED,getter:function(){var e=this.getInheritedRenderStyles();return!!(e&&e.indexOf("backgroundColor")>=0)},setter:function(e){if(!!e!==this.getInheritedRenderBackgroundColor()){var t=this.getInheritedRenderStyles();e?t.push("backgroundColor"):d.ArrayUtils.remove(t,"backgroundColor"),this.setInheritedRenderStyles(t)}}}),this.defineProp("enableCustomCssProperties",{dataType:DataType.BOOL,setter:function(e){e!=this.getEnableCustomCssProperties()&&(this.setPropStoreFieldValue("enableCustomCssProperties",!!e),this.requestRepaint())}}),this.defineProp("transformParams",{dataType:DataType.HASH,serializable:!1,scope:e.PUBLIC,getter:function(){var e=Object.extend({},this.getDrawOptions());return e.screenCoordOffset=this.getBaseCoordOffset(),e},setter:function(e){var t=e||{};this.setDrawOptions(t),this.setBaseCoordOffset(t.baseCoordOffset),this.drawOptionChanged()}}),this.defineProp("drawOptions",{dataType:DataType.HASH,serializable:!1,scope:e.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("drawOptions");return e||(e={},this.setPropStoreFieldValue("drawOptions",e)),e},setter:function(e){this.setPropStoreFieldValue("drawOptions",e),this.drawOptionChanged()}}),this.defineProp("zoom",{dataType:DataType.FLOAT,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).zoom},setter:function(e){return this.zoomTo(e),this}}),this.defineProp("initialZoom",{dataType:DataType.FLOAT}),this.defineProp("autofit",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).autofit},setter:function(e){var t=this.getDrawOptions()||{};return t.autofit=e,this.setDrawOptions(t)}}),this.defineProp("autoShrink",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).autoShrink},setter:function(e){var t=this.getDrawOptions()||{};return t.autoShrink=e,this.setDrawOptions(t)}}),this.defineProp("moleculeDisplayType",{dataType:DataType.INT,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).moleculeDisplayType},setter:function(e){return this.getDrawOptions().moleculeDisplayType=e,this.drawOptionChanged(),this}}),this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL,serializable:!1,scope:e.PUBLIC,getter:function(){return d.oneOf(this.getDrawOptions().allowCoordBorrow,this.getRenderConfigs().getGeneralConfigs().getAllowCoordBorrow())}}),this.defineProp("autoSize",{dataType:DataType.BOOL,serializable:!1,setter:function(e){e!=this.getAutoSize()&&(this.setPropStoreFieldValue("autoSize",e),e&&this.allowAutoSize()&&this.drawOptionChanged())}}),this.defineProp("padding",{dataType:DataType.INT,serializable:!1,setter:function(e){e!=this.getPadding()&&(this.setPropStoreFieldValue("padding",e),this.getDrawOptions().autofitContextPadding=e,this.drawOptionChanged())}}),this.defineProp("baseCoordOffset",{dataType:DataType.Hash,serializable:!1,setter:function(e){this.setPropStoreFieldValue("baseCoordOffset",e),this.getChemObjLoaded()&&this.repaint()}}),this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:!1,scope:e.PRIVATE,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("drawBridge");return t||this.__$drawBridgeInitialized$__||(this.__$drawBridgeInitialized$__=!0,t=this.createDrawBridge(),this.setPropStoreFieldValue("drawBridge",t)),t}}),this.defineProp("drawContext",{dataType:DataType.OBJECT,serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPropStoreFieldValue("drawContext");if(!e){var t=this.getDrawBridge();if(t){var r=this.getDrawContextParentElem();if(!r)return null;var n=d.HtmlElementUtils.getElemOffsetDimension(r);e=t.createContext(r,n.width,n.height,this.getContextCreationParams(this.getRenderType(),t)),this.setPropStoreFieldValue("drawContext",e)}}return e}}),this.defineProp("painter",{dataType:"Kekule.Render.ChemObjPainter",serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPropStoreFieldValue("painter");return e||(e=this.createNewPainter()),e}}),this.defineProp("rootRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPainter();return e?e.getRenderer():null}}),this.defineProp("boundInfoRecorder",{dataType:"Kekule.Render.BoundInfoRecorder",serializable:!1,setter:null,getter:function(){var e=this.getRootRenderer();return e&&e.getBoundInfoRecorder()}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setStandardizationOptions({unmarshalSubFragments:!1,clearHydrogens:!1})},doEndUpdate:function(e){this.tryApplySuper("doEndUpdate",[e]),this._requestRepainting&&this.repaint(this._requestRepainting.overrideOptions)},elementBound:function(e){this.setObserveElemResize(!0)},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),e&&this.setChemObj(this.getChemObj())},doFileDragDrop:function(e){if(e){var t=this;return function(){d.IO.loadFileData(e[0],(function(e,r){r&&t.setChemObj(e)}))}.defer(),!0}return this.tryApplySuper("doFileDragDrop")},notifyStyleAttribChanged:function(e){this.tryApplySuper("notifyStyleAttribChanged",[e]),(this.getInheritedRenderStyles()||[]).length&&this.requestRepaint()},getAllowRenderTypeChange:function(){return!1},resetRenderType:function(e,t){var r=this.getChemObj(),n=this.getPropStoreFieldValue("drawBridge"),i=this.getPropStoreFieldValue("drawContext");n&&i&&n.releaseContext(i),this.setPropStoreFieldValue("drawContext",null),this.setPropStoreFieldValue("drawBridge",null),this.__$drawBridgeInitialized$__=!1;var o=this.getBackgroundColorOfType(t);this.getDrawOptions().moleculeDisplayType=this.getDefaultMoleculeDisplayType(t),this.setPropStoreFieldValue("backgroundColor",o),this.backgroundColorChanged(!0),this.setChemObj(r||null)},resetRenderEnvironment:function(){return this.resetRenderType(null,this.getRenderType()),this},getDisplayerEnvironmentConfigs:function(){return this.getCoordMode()===d.CoordMode.COORD3D?this.getDisplayerConfigs().getEnvironment3DConfigs():this.getDisplayerConfigs().getEnvironment2DConfigs()},getContextCreationParams:function(e,t){var r=this.getRenderConfigs(),n=this.getDisplayerConfigs();return e===d.Render.RendererType.R3D?{alpha:!0,antialias:r.getEnvironmentConfigs().getAntialias()}:{alpha:!0,antialias:n.getEnvironment2DConfigs().getAntialias(),antialiasBlurRatio:n.getEnvironment2DConfigs().getAntialiasBlurRatio(),overSamplingRatio:n.getEnvironment2DConfigs().getOverSamplingRatio()}},createDefaultConfigs:function(){return new d.ChemWidget.ChemObjDisplayerConfigs},getCoordMode:function(){return this.getRenderType()===d.Render.RendererType.R3D?d.CoordMode.COORD3D:d.CoordMode.COORD2D},setCoordMode:function(e){var t=e===d.CoordMode.COORD3D?d.Render.RendererType.R3D:d.Render.RendererType.R2D;this.setRenderType(t)},loadPredefinedResDataToProp:function(e,t,r){if("chemObj"===e)if(r)try{var n=d.IO.loadTypedData(t.data,t.resType,t.resUri);n||(n=d.IO.loadFormatData(t.data,t.resType)),n?this._tryAutoGenerateChemObjCoordsAndLoad(n):d.error(d.$L("ErrorMsg.LOAD_CHEMDATA_FAILED"))}catch(e){this.reportException(e)}else this.reportException(d.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+t.resUri||"")},reportException:function(e,t){d.raise(e,t||d.ExceptionLevel.ERROR)},createDrawBridge:function(e){var t=this.getRenderType()===d.Render.RendererType.R3D?d.Render.DrawBridge3DMananger:d.Render.DrawBridge2DMananger,r=t.getPreferredBridgeInstance();if(!r&&!e){var n=t.getUnavailableMessage()||d.error(d.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"));n&&this.reportException(n,d.ExceptionLevel.NOT_FATAL_ERROR)}return r},getDrawContextParentElem:function(e){var t=this._drawContextParentElem;if(!t&&!e){t=this.getDocument().createElement("div"),this._drawContextParentElem=t,d.HtmlElementUtils.addClass(t,r.DYN_CREATED),d.HtmlElementUtils.addClass(t,n.DISPLAYER_DRAWCONTEXT_PARENT),t.style.width="100%",t.style.height="100%";var i=this.getElement(),o=d.DomUtils.getFirstChildElem(i);o?i.insertBefore(t,o):i.appendChild(t)}return t},allowAutoSize:function(){return this.getRenderType()===d.Render.RendererType.R2D},canModifyPartialGraphic:function(e){var t=this.getDrawBridge();return!!t.canModifyGraphic&&t.canModifyGraphic(e||this.getDrawContext())},doInsertedToDom:function(){this.doResize()},doResize:function(){this.refitDrawContext(this.isPainting())},refitDrawContext:function(e){if(this.getDrawBridge()&&this.getDrawContext()){var t=d.HtmlElementUtils.getElemClientDimension(this.getDrawContextParentElem()),r=this.changeContextDimension(t);!e&&r&&this.repaint()}},getContextDimension:function(){return this.getDrawBridge()&&this.getDrawContext()?this.getDrawBridge().getContextDimension(this.getDrawContext()):null},_getContextOverSamplingRatio:function(){var e=this.getDisplayerEnvironmentConfigs();return e.getAntialias&&e.getAntialias()&&e.getOverSamplingRatio&&e.getOverSamplingRatio()||1},changeContextDimension:function(e){if(this.getDrawBridge()&&this.getDrawContext()){var t=e.width,r=e.height,n=this.getDrawBridge().getContextElem(this.getDrawContext());if(n){var i=this._getContextOverSamplingRatio();if(1!==i&&d.BrowserFeature.cssTranform){var o=1/i;n.style.transform="scale("+o+","+o+")",n.style.transformOrigin="0 0",this.getDrawBridge().setContextParam(this.getDrawContext(),"overSamplingRatio",i)}else n.style.transform="",this.getDrawBridge().setContextParam(this.getDrawContext(),"overSamplingRatio",null)}return this._resizeContext(this.getDrawContext(),this.getDrawBridge(),t,r),!0}return!1},_resizeContext:function(e,t,r,n){e&&t&&t.setContextDimension(e,r,n)},clearContext:function(){var e=this.getPropStoreFieldValue("drawContext");if(e){var t=this.getPropStoreFieldValue("painter");t&&t.clear(e),this.getDrawBridge().clearContext(e)}},createNewPainter:function(e){var t=this.getPropStoreFieldValue("painter");t&&t.finalize();var r=this.getDrawBridge()?new d.Render.ChemObjPainter(this.getRenderType(),e,this.getDrawBridge()):null;return this.setPropStoreFieldValue("painter",r),r},isRenderable:function(){return!!(this.getPainter()&&this.getDrawBridge()&&this.getDrawContext())},chemObjChanged:function(e,t){this.doLoad(e),this.getResetAfterLoad()&&t&&this.resetDisplay()},load:function(e){this.setChemObj(e)},doLoad:function(e){this.refitDrawContext(!0),this.setPropStoreFieldValue("chemObjLoaded",!1);try{if(e){var t=this.createNewPainter(e);t&&t.setRenderConfigs(this.getRenderConfigs()),this.repaint(),this.setPropStoreFieldValue("chemObjLoaded",!0),this.invokeEvent("load",{obj:e})}else this.clearContext(),this.invokeEvent("load",{obj:e})}catch(e){this.clearContext(),this.reportException(e)}finally{this.doLoadEnd(this.getChemObj())}},doLoadEnd:function(e){},_tryAutoGenerateChemObjCoords:function(e,t){if(e instanceof d.Molecule&&this.getDisplayerConfigs().getIoConfigs().getAutoGenerateCoordsAfterLoad()&&d.Calculator&&d.Calculator.generateStructure){var r=this.getCoordMode()===d.CoordMode.COORD3D;if(e.nodesHasCoordOfMode(this.getCoordMode(),this.getAllowCoordBorrow(),!0))t(e);else{var n=r?d.Calculator.Services.GEN3D:d.Calculator.Services.GEN2D;d.Calculator.generateStructure(e,n,{modifySource:!0},(function(e){t(e)}),(function(r){t(e),d.error(r)}))}}else t(e)},_tryAutoGenerateChemObjCoordsAndLoad:function(e){var t=this;this._tryAutoGenerateChemObjCoords(e,(function(e){t.setChemObj(e)}))},loadFromData:function(e,t,r,n){try{var i;return e?(n?i=d.IO.loadFormatData(e,n):(t||r)&&(i=d.IO.loadTypedData(e,t,r)),i?this._tryAutoGenerateChemObjCoordsAndLoad(i):d.error(d.$L("ErrorMsg.LOAD_CHEMDATA_FAILED")),i):(this.setChemObj(null),null)}catch(e){this.reportException(e)}},loadFromFile:function(e){if(e){var t=this;try{d.IO.loadFileData(e,(function(e,r){r&&t._tryAutoGenerateChemObjCoordsAndLoad(e)}))}catch(e){this.reportException(e)}}else this.setChemObj(null)},getSavingTargetObj:function(){return this.getChemObj()},saveData:function(e,t,r){r=r||this.getSavingTargetObj(),this.prepareSaveData(r);var n=d.IO.ChemDataWriterManager.getWriterByFormat(e,null,r);return n?(this._needToCanonicalizeBeforeSaving()&&this.getDisplayerConfigs().getIoConfigs().getCanonicalizeBeforeSave()&&r.standardize&&(r=r.clone?r.clone(!0):r).standardize(this.getStandardizationOptions()),t||(t=d.IO.DataFormatsManager.getFormatInfo(e).dataType),n.writeData(r,t,e)):(d.error(d.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT")),null)},_needToCanonicalizeBeforeSaving:function(){return!1},prepareSaveData:function(e){},getDrawClientDimension:function(){return d.HtmlElementUtils.getElemClientDimension(this.getCoreElement())},setDrawDimension:function(e,t){this.setDimension(e,t)},calcDrawBaseCoord:function(e){var t,r,n=this.getDrawContext(),i=this.getPainter();if(!this._isContinuousRepainting&&this.getAutoSize()&&this.allowAutoSize()){var o=this.getPadding()||0,a=i.estimateScreenBox(n,t,e,this.getAllowCoordBorrow());if(a){var s=a.x2-a.x1+2*o,l=a.y2-a.y1+2*o;this.changeContextDimension({width:s,height:l}),this.setDrawDimension(s,l),r={width:s,height:l},t={x:s/2,y:l/2}}}else if(!(t=e?e.baseCoord:null)){var u=this.getDrawClientDimension();t={x:u.width/2,y:u.height/2};var c=this.getBaseCoordOffset();c&&(t=d.CoordUtils.add(t,c))}return{baseCoord:t=this.getDrawBridge().transformScreenCoordToContext(n,t),baseCoordPos:d.Render.CoordPos.CENTER,newWidgetDimension:r}},getActualDrawOptions:function(){return this.getDrawOptions()},calcDrawParams:function(e){var t=this.getActualDrawOptions();e&&(t=Object.extend(t,e));var r=this.calcDrawBaseCoord(t);return{drawOptions:t,baseCoord:r.baseCoord,baseCoordPos:r.baseCoordPos,newWidgetDimension:r.newWidgetDimension}},_savePainterInitialRenderTransformOptions:function(e,t){var r=t.getActualInitialRenderTransformOptions(e);this._contextTransformOpsMap.set(e,r)},requestRepaint:function(e){this._requestRepainting={overrideOptions:e};var t=this;(function(){t._requestRepainting&&t._repaintCore(t._requestRepainting.overrideOptions),t._requestRepainting=null}).delay(0)},repaint:function(e){if(!this.isUpdating()){try{var t=this._repaintCore(e)}finally{this._requestRepainting=null}return t}this._requestRepainting={overrideOptions:e}},_repaintCore:function(e){if(this.getElement()&&!this.isPainting()&&this.isRenderable()){this.beginPaint();try{if(this.getInheritedRenderBackgroundColor()){var t=this.getComputedStyle("backgroundColor");this.backgroundColorChanged(!0,t||null)}else this.backgroundColorChanged(!0);if(e&&e.doNotClear||this.clearContext(),!this.getChemObj())return;var r,n,i=this.getPainter(),o=this.getDrawContext(),a=!0;if(e&&e.preserveTransformOptions?(n=this._contextTransformOpsMap.get(o)||null,a=!1,r=this.calcDrawParams(n)):r=this.calcDrawParams(e),this._lastBaseCoord=r.baseCoord,this.getInheritedRenderColor()){var s=this.getComputedStyle("color");r.drawOptions.color=s}else r.drawOptions.color=null;this.getEnableCustomCssProperties()&&this._applyCustomCssProps(r.drawOptions),this._setupRenderingEnvironment(o,this.getDrawBridge()),i.draw(o,r.baseCoord,r.drawOptions),a&&this._savePainterInitialRenderTransformOptions(o,i),this.invokeEvent("repaint",{obj:this.getChemObj()})}finally{this.endPaint()}}},_setupRenderingEnvironment:function(e,t){var r=this.getDisplayerEnvironmentConfigs();if(r.getAntialias&&r.getAntialias()&&(i=r.getAntialiasBlurRatio&&r.getAntialiasBlurRatio()||0)){var n=this.getRenderConfigs().getLengthConfigs(),i=r.getAntialiasBlurRatio()||0,o=n.getActualLength("bondLineWidth")*i||0,a=t||this.getDrawBridge();a.setFilter&&a.clearFilter&&(o?a.setFilter(e,"blur("+o+"px)"):a.clearFilter(e))}},beginPaint:function(){this._paintFlag||(this._paintFlag=0),++this._paintFlag},endPaint:function(){this._paintFlag>0&&--this._paintFlag,this._paintFlag<0&&(this._paintFlag=0)},isPainting:function(){return this._paintFlag>0},getBackgroundColorOfType:function(e){return this._bgColorMap[e.toString()]},setBackgroundColorOfType:function(e,t){this._bgColorMap[t.toString()]=e,t===this.getRenderType()&&this.setBackgroundColor(e)},backgroundColorChanged:function(e,t){var r=t;void 0===r&&(r=this.getBackgroundColor()),"transparent"===r&&(r=null);var n=this.getDrawBridge();n&&n.setClearColor&&(n.setClearColor(this.getDrawContext(),r),e||this.requestRepaint())},_getApplicableCustomCssPropNames:function(){return{r2d:["unitLength","moleculeDisplayType","hydrogenDisplayLevel","showCharge","chargeMarkFontSize","chargeMarkMargin","chemMarkerFontSize","chemMarkerMargin","distinguishSingletAndTripletRadical","fontSize","fontFamily","supFontSizeRatio","subFontSizeRatio","superscriptOverhang","subscriptOversink","bondLineWidth","boldBondLineWidth","hashSpacing","multipleBondSpacingRatio","multipleBondSpacingAbs","multipleBondMaxAbsSpacing","bondArrowLength","bondArrowWidth","bondWedgeWidth","bondWedgeHashMinWidth","bondLengthScaleRatio","color","atomColor","bondColor","useAtomSpecifiedColor","opacity","fillColor","strokeColor","strokeWidth","atomRadius"],r3d:["displayMultipleBond","useVdWRadius","nodeRadius","connectorRadius","nodeRadiusRatio","connectorRadiusRatio","color","atomColor","bondColor","useAtomSpecifiedColor","hideHydrogens","bondSpliceMode"]}},_getRenderOptionDefinitionsHash:function(){if(!this.__$renderOptionDefinitionsHash__){this.__$renderOptionDefinitionsHash__={};var e,t,r=d.Render.RenderOptionUtils.getOptionDefinitions(),n=d.Render.Render3DOptionUtils.getOptionDefinitions();for(e=0,t=r.length;e<t;++e)this.__$renderOptionDefinitionsHash__[r[e].name]=r[e];for(e=0,t=n.length;e<t;++e)this.__$renderOptionDefinitionsHash__[n[e].name]=n[e]}return this.__$renderOptionDefinitionsHash__},_applyCustomCssProps:function(e){var t,r,n=this._getRenderOptionDefinitionsHash(),i=this._getApplicableCustomCssPropNames();for(t=0,r=i.r2d.length;t<r;++t){var o=i.r2d[t];this._applyCustomCssPropValue(o,n,e)}if(this.getRenderType()===d.Render.RendererType.R3D)for(t=0,r=i.r3d.length;t<r;++t)o=i.r3d[t],this._applyCustomCssPropValue(o,n,e)},_applyCustomCssPropValue:function(e,t,r){if(t[e]){var n=this.getComputedCustomStyle(e);if(n&&n.trim){n=n.trim();var i=d.StrUtils.convertToType(n,t.dataType);d.ObjUtils.notUnset(i)&&(r[e]=i)}}},drawOptionChanged:function(){this.repaint()},geometryOptionChanged:function(){var e=this.getPainter(),t=this.getDrawOptions();if(e&&e.supportGeometryOptionChange()){var r=this.getDrawContext();e.changeGeometryOptions(r,t.baseCoord||this._lastBaseCoord,t),this._savePainterInitialRenderTransformOptions(r,e)}else this.drawOptionChanged()},beginContinuousRepainting:function(){this._isContinuousRepainting=!0},endContinuousRepainting:function(){this._isContinuousRepainting&&(this._isContinuousRepainting=!1,this.repaint())},resetDisplay:function(){var e=this.getDrawOptions();return e.zoom=this.getInitialZoom()||1,e.rotateX=0,e.rotateY=0,e.rotateZ=0,e.rotateAngle=0,e.rotateAxisVector=null,e.rotateMatrix=null,this.setBaseCoordOffset(null),this.geometryOptionChanged(),this},getCurrZoom:function(){return this.getDrawOptions().zoom||1},zoomTo:function(e,t){return this.getDrawOptions().zoom=e,t||this.geometryOptionChanged(),this},zoomIn:function(e){var r=this.getCurrZoom(),n=t.getNextZoomInRatio(r,e||1);return this.zoomTo(n)},zoomOut:function(e){var r=this.getCurrZoom(),n=t.getNextZoomOutRatio(r,e||1);return this.zoomTo(n)},resetZoom:function(){return this.zoomTo(this.getInitialZoom()||1)},getDefaultMoleculeDisplayType:function(e){return e===d.Render.RendererType.R3D?d.Render.Molecule3DDisplayType.DEFAULT:d.Render.Molecule2DDisplayType.DEFAULT},getCurrMoleculeDisplayType:function(){var e=this.getDrawOptions().moleculeDisplayType;return e||(e=this.getDefaultMoleculeDisplayType(this.getRenderType())),e},setHideHydrogens:function(e){return this.getDrawOptions().hideHydrogens=e,this.drawOptionChanged(),this},exportToDataUri:function(e,t){return this.getDrawBridge().exportToDataUri(this.getDrawContext(),e,t)},createConfigurator:function(){var e=this.tryApplySuper("createConfigurator");return e.addEventListener("configChange",(function(e){this.repaint()}),this),e}}),d.ChemWidget.ChemObjDisplayer.Settings=Class.create(d.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Settings",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineDelegatedProps(["enableLoadNewFile"])},getDisplayer:function(){return this.getWidget()}}),d.ChemWidget.ChemObjDisplayer.Configurator=Class.create(d.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(d.Widget.Layout.HORIZONTAL)},getCategoryInfos:function(){for(var e=this.tryApplySuper("getCategoryInfos"),t=this.getDisplayer(),r=[t.getDisplayerConfigs(),t.getRenderConfigs()],n=0,i=r.length;n<i;++n)for(var o=r[n],a=o.getPropListOfScopes([Class.PropertyScope.PUBLISHED]),s=0,l=a.getLength();s<l;++s){var d=a.getPropInfoAt(s),u=o.getPropValue(d.name);u&&e.push({obj:u,name:d.name,title:d.title,description:d.description})}return e},getDisplayer:function(){return this.getWidget()}}),d.ChemWidget.ActionDisplayerLoadFile=Class.create(d.ActionLoadFileData,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadFile",HTML_CLASSNAME:n.ACTION_LOADFILE,initialize:function(e){this.tryApplySuper("initialize"),this.setDisplayer(e),this.setText(d.$L("ChemWidgetTexts.CAPTION_LOADFILE")),this.setHint(d.$L("ChemWidgetTexts.HINT_LOADFILE"))},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:!1})},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this.setEnabled(this.getEnabled()&&e&&e.getEnabled()&&e.getEnableLoadNewFile())},doDataLoaded:function(e,t,r){r&&this.getDisplayer().loadFromData(e,null,t)}}),d.ChemWidget.ActionOnDisplayer=Class.create(d.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionOnDisplayer",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setDisplayer(e),this.setText(t),this.setHint(r)},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:!1})},doUpdate:function(){var e=this.getDisplayer();this.setEnabled(e&&e.getChemObj()&&e.getChemObjLoaded()&&e.getEnabled())},execute:function(e,t){return!this.getDisplayer()&&e instanceof d.ChemWidget.ChemObjDisplayer&&this.setDisplayer(e),this.tryApplySuper("execute",[e,t])}}),d.ChemWidget.ActionDisplayerClear=Class.create(d.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerClear",HTML_CLASSNAME:n.ACTION_CLEAROBJS,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_CLEAROBJS"),d.$L("ChemWidgetTexts.HINT_CLEAROBJS")])},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this.setEnabled(e&&e.getEnabled()&&e.getChemObj())},doExecute:function(e){this.getDisplayer().setChemObj(null)}}),d.ChemWidget.ActionDisplayerLoadData=Class.create(d.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadData",HTML_CLASSNAME:n.ACTION_LOADDATA,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_LOADDATA"),d.$L("ChemWidgetTexts.HINT_LOADDATA")])},finalize:function(){this.tryApplySuper("finalize")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setDialogShowType(d.Widget.ShowHideType.DROPDOWN)},initProperties:function(){this.defineProp("dataDialog",{dataType:"Kekule.ChemWidget.LoadDataDialog",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("dataDialog");return e||(e=this.createDataDialog(),this.setPropStoreFieldValue("dataDialog",e)),e}}),this.defineProp("dialogShowType",{dataType:DataType.INT})},createDataDialog:function(){var e=this.getDisplayer().getDocument();return new d.ChemWidget.LoadDataDialog(e)},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this.setEnabled(e&&e.getEnabled()&&e.getEnableLoadNewFile())},doExecute:function(e){var t=this,r=this.getDataDialog();r.setAllowedFormatIds(this.getDisplayer().getAllowedInputFormatIds()||d.IO.ChemDataReaderManager.getAllReadableFormatIds()),r._formatSelector;var n=this.getDialogShowType();(n===d.Widget.ShowHideType.DIALOG?r.openModal:r.open).apply(r,[function(e){if(r.isPositiveResult(e)){var n=r.getDataDetails()||{};t.getDisplayer().loadFromData(n.data,n.mimeType,n.fileName,n.formatId)}},e,n])}}),d.ChemWidget.ActionDisplayerSaveFile=Class.create(d.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerSaveFile",HTML_CLASSNAME:n.ACTION_SAVEFILE,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_SAVEFILE"),d.$L("ChemWidgetTexts.HINT_SAVEFILE")]),this._saveAction=new d.ActionFileSave},finalize:function(){this._saveAction.finalize(),this.tryApplySuper("finalize")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setDialogShowType(d.Widget.ShowHideType.DROPDOWN)},initProperties:function(){this.defineProp("formatDialog",{dataType:"Kekule.Widget.Dialog",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("formatDialog");return e||(e=this.createFormatDialog(),this.setPropStoreFieldValue("formatDialog",e)),e}}),this.defineProp("lastFormat",{dataType:DataType.STRING,serializable:!1}),this.defineProp("currSaveData",{dataType:DataType.VARIANT,serializable:!1}),this.defineProp("dialogShowType",{dataType:DataType.INT})},getChemObjSrcInfo:function(e){var t=this.getDisplayer();return t.getChemObjSrcInfo?t.getChemObjSrcInfo(e):e.getSrcInfo?e.getSrcInfo():null},getChemObjSrcFormat:function(e){var t=this.getChemObjSrcInfo(e);return t?t.format:null},createFormatDialog:function(){var e=this.getDisplayer().getDocument(),t=new d.Widget.Dialog(e,d.$L("ChemWidgetTexts.CAPTION_SAVEDATA_DIALOG"),[d.Widget.DialogButtons.OK,d.Widget.DialogButtons.CANCEL]);t.addClassName(n.DIALOG_CHOOSE_FILE_FORAMT),t.setAutoAdjustSizeOnPopup(!0),(r=e.createElement("div")).innerHTML=d.$L("ChemWidgetTexts.CAPTION_SELECT_FORMAT"),t.getClientElem().appendChild(r),r=e.createElement("div"),t.getClientElem().appendChild(r);var r,i=new d.Widget.SelectBox(t);i.addClassName(n.DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX),i.appendToElem(r),i.addEventListener("valueChange",this.reactFormatSelectorChange,this),t._formatSelector=i,(r=e.createElement("div")).innerHTML=d.$L("ChemWidgetTexts.CAPTION_PREVIEW_FILE_CONTENT"),t.getClientElem().appendChild(r),(r=e.createElement("div")).className=n.DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER_REGION,t.getClientElem().appendChild(r);var o=new d.Widget.TextEditor(t);return o.setReadOnly(!0),o.setWrap("off").setAutoWrapThreshold(!0),o.setToolbarPos(d.Widget.Position.BOTTOM),o.addClassName(n.DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER),o.appendToElem(r),t._previewTextArea=o,t.setResizable&&t.setResizable(!0),t},getAvailableWriterInfos:function(e){return e?d.IO.ChemDataWriterManager.getAvailableWriterInfos(null,e):[]},getFormatSelectorItems:function(e,t){for(var r=[],n=[],i=this.getChemObjSrcInfo(e),o=i?i.format:null,a=0,s=t.length;a<s;++a){var l=t[a];d.ArrayUtils.pushUnique(n,l.formatId)}for(a=0,s=(n=d.ArrayUtils.intersect(this.getAllowedFormatIds(),n)).length;a<s;++a){var u=d.IO.DataFormatsManager.getFormatInfo(n[a]);if(u){for(var c=d.ArrayUtils.clone(d.ArrayUtils.toArray(u.fileExts)),h=0,p=c.length;h<p;++h)c[h]="*."+c[h];var g=c.join(", "),f=u.title;g&&(f+=" ("+g+")");var m=o?n[a]===o:this.getLastFormat()?this.getLastFormat()===n[a]:0===a;r.push({value:u.id,text:f,title:u.mimeType,data:u,selected:m})}}return r.sort((function(e,t){return e.text<t.text?-1:e.text>t.text?1:0})),r},getAllowedFormatIds:function(){return this.getDisplayer().getAllowedOutputFormatIds()||d.IO.ChemDataWriterManager.getAllWritableFormatIds()},getFileFilters:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r],o=i.data,a=i.text||i.title||i.value,s=d.ArrayUtils.toArray(o.fileExts);t.push({title:a,filter:"."+s.join(",.")})}return t.push(d.NativeServices.FILTER_ALL_SUPPORT),t.push(d.NativeServices.FILTER_ANY),t},updateFormatItems:function(e){this._formatItems=this.getFormatSelectorItems(e,this.getAvailableWriterInfos()),this._formatSelector.setItems(this._formatItems);var t=this.getFileFilters(this._formatItems);this._saveAction.setFilters(t)},reactFormatSelectorChange:function(){var e=this.getFormatDialog()._formatSelector.getValue();this.updatePreview(e,this.getFormatDialog())},updatePreview:function(e,t){var r=t._previewTextArea;if(r.setValue(""),e){var n=d.IO.DataFormatsManager.getFormatInfo(e),i=this.getTargetObj(),o=this.getChemObjSrcInfo(i);if(o&&o.format===e&&o.data)r.setValue(o.data),this.setCurrSaveData(o.data);else{var a=this.getDisplayer().saveData(e,n.dataType,i);r.setValue(a),this.setCurrSaveData(a)}}},getTargetObj:function(e){return this.getDisplayer().getSavingTargetObj()},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this._saveAction&&this._saveAction.update(),this.setEnabled(e&&e.getEnabled()&&e.getChemObj())},doExecute:function(e){var t=this,r=this.getFormatDialog(),n=this.getTargetObj(),i=r._formatSelector,o=this.getAvailableWriterInfos(n),a=this.getFormatSelectorItems(n,o);i.setItems(a),this.reactFormatSelectorChange();var s=!1;this._saveAction&&(s=this._saveAction.getEnabled());var l=r.getDialogButton(d.Widget.DialogButtons.OK);l&&l.setEnabled(s);var u=this.getDialogShowType();(u===d.Widget.ShowHideType.DIALOG?r.openModal:r.open).apply(r,[function(n){if(n===d.Widget.DialogButtons.OK){var i=t.getCurrSaveData();t._saveAction.setData(i);var o=r._formatSelector.getValue();t.setLastFormat(o);var a=d.IO.DataFormatsManager.getFormatInfo(o),s=a.fileExts,l=d.ArrayUtils.toArray(s[0]||s),u=[{title:a.title||a.mimeType,filter:"."+l.join(",.")},d.NativeServices.FILTER_ANY],c=d.$L("ChemWidgetTexts.S_DEF_SAVE_FILENAME")+"."+l;t._saveAction.setFileName(c),t._saveAction.setFilters(u),t._saveAction.execute(e)}},e,u])}}),d.ChemWidget.ActionDisplayerCopy=Class.create(d.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerCopy",HTML_CLASSNAME:n.ACTION_COPY,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_COPY_WHOLE"),d.$L("ChemWidgetTexts.HINT_COPY_WHOLE")])},doUpdate:function(){if(this.tryApplySuper("doUpdate"),this.getEnabled()){var e=this.getDisplayer().getChemObj();this.setEnabled(e&&e.clone)}},doExecute:function(){var e=this.getDisplayer();if(e){var t=e.getChemObj();t&&d.Widget.clipboard.setObjects(d.IO.MimeType.JSON,[t])}}}),d.ChemWidget.ActionDisplayerReset=Class.create(d.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerReset",HTML_CLASSNAME:n.ACTION_RESET,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_RESETVIEW"),d.$L("ChemWidgetTexts.HINT_RESETVIEW")])},doExecute:function(){this.getDisplayer().resetDisplay()}}),d.ChemWidget.ActionDisplayerZoomIn=Class.create(d.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomIn",HTML_CLASSNAME:n.ACTION_ZOOMIN,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_ZOOMIN"),d.$L("ChemWidgetTexts.HINT_ZOOMIN")])},doExecute:function(){this.getDisplayer().zoomIn()}}),d.ChemWidget.ActionDisplayerZoomOut=Class.create(d.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomOut",HTML_CLASSNAME:n.ACTION_ZOOMOUT,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_ZOOMOUT"),d.$L("ChemWidgetTexts.HINT_ZOOMOUT")])},doExecute:function(){this.getDisplayer().zoomOut()}}),d.ChemWidget.ActionDisplayerResetZoom=Class.create(d.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerResetZoom",HTML_CLASSNAME:n.ACTION_RESET_ZOOM,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_RESETZOOM"),d.$L("ChemWidgetTexts.HINT_RESETZOOM")])},doExecute:function(){this.getDisplayer().resetZoom()}}),d.ChemWidget.ActionDisplayerHideHydrogens=Class.create(d.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerHideHydrogens",HTML_CLASSNAME:n.ACTION_MOL_HIDE_HYDROGENS,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_HIDEHYDROGENS"),d.$L("ChemWidgetTexts.HINT_HIDEHYDROGENS")])},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer(),t=e&&e.getRenderType()===d.Render.RendererType.R3D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t)},doExecute:function(){var e=!this.getChecked();this.setChecked(e),this.getDisplayer().setHideHydrogens(e)}}),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase=Class.create(d.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e,t,r]),this._displayType=n,this.setCheckGroup("__molDisplayType__")},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer();this.setChecked(e&&e.getCurrMoleculeDisplayType()===this.getMolDisplayType())},doExecute:function(){this.getDisplayer().setMoleculeDisplayType(this._displayType),this.setChecked(!0)},getMolDisplayType:function(){return this._displayType}}),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D=Class.create(d.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D",doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer(),t=e&&e.getRenderType()===d.Render.RendererType.R2D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t)}}),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D=Class.create(d.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D",doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getDisplayer(),t=e&&e.getRenderType()===d.Render.RendererType.R3D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t)}}),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal=Class.create(d.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal",HTML_CLASSNAME:n.ACTION_MOL_DISPLAY_SKELETAL,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_SKELETAL"),d.$L("ChemWidgetTexts.HINT_SKELETAL"),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE])}}),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE=d.Render.Molecule2DDisplayType.SKELETAL,d.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed=Class.create(d.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed",HTML_CLASSNAME:n.ACTION_MOL_DISPLAY_CONDENSED,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_CONDENSED"),d.$L("ChemWidgetTexts.HINT_CONDENSED"),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE])}}),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE=d.Render.Molecule2DDisplayType.CONDENSED,d.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire=Class.create(d.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire",HTML_CLASSNAME:n.ACTION_MOL_DISPLAY_WIRE,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_WIRE"),d.$L("ChemWidgetTexts.HINT_WIRE"),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE])}}),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE=d.Render.Molecule3DDisplayType.WIRE,d.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks=Class.create(d.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks",HTML_CLASSNAME:n.ACTION_MOL_DISPLAY_STICKS,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_STICKS"),d.$L("ChemWidgetTexts.HINT_STICKS"),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE])}}),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE=d.Render.Molecule3DDisplayType.STICKS,d.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick=Class.create(d.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick",HTML_CLASSNAME:n.ACTION_MOL_DISPLAY_BALLSTICK,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_BALLSTICK"),d.$L("ChemWidgetTexts.HINT_BALLSTICK"),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE])}}),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE=d.Render.Molecule3DDisplayType.BALL_STICK,d.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill=Class.create(d.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill",HTML_CLASSNAME:n.ACTION_MOL_DISPLAY_SPACEFILL,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_SPACEFILL"),d.$L("ChemWidgetTexts.HINT_SPACEFILL"),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE])}}),d.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE=d.Render.Molecule3DDisplayType.SPACE_FILL}(),function(){"use strict";var e=d.ChemWidget.HtmlClassNames;d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{CHEM_STRUCT_TREE_VIEW:"K-Chem-Struct-TreeView",CHEM_STRUCT_TREE_VIEW_ITEM_TITLE:"K-Chem-Struct-TreeView-ItemTitle",CHEM_STRUCT_TREE_VIEW_ITEM_TYPE:"K-Chem-Struct-TreeView-ItemType"}),d.ChemWidget.StructureTreeView=Class.create(d.Widget.TreeView,{CLASS_NAME:"Kekule.ChemWidget.StructureTreeView",initialize:function(e,t){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("objMap",new d.MapEx(!0)),this.setEnableLiveUpdate(!0),this.setEnableMultiSelect(!0),this.setRootObj(t),this._pauseLiveUpdateFlag=0,this._changedObjects=[]},initProperties:function(){this.defineProp("rootObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("rootObj");this.setPropStoreFieldValue("rootObj",e),this.rootObjChanged(e,t)}}),this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL}),this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:!1})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.CHEM_STRUCT_TREE_VIEW},rootObjChanged:function(e,t){this.clearChildItems(),this.getObjMap().clear(),t&&this._uninstallRootEventHandler(t),e&&(this._fillTree(e),this._installRootEventHandler(e))},pauseLiveUpdate:function(){return this._pauseLiveUpdateFlag>=0&&(this._pauseLiveUpdateFlag=0,this._changedObjects=[]),--this._pauseLiveUpdateFlag,this},resumeLiveUpdate:function(){if(++this._pauseLiveUpdateFlag,this._pauseLiveUpdateFlag>=0){this._pauseLiveUpdateFlag=0;for(var e=0,t=this._changedObjects.length;e<t;++e)this.refreshObject(this._changedObjects[e])}},isLiveUpdatePaused:function(){return this._pauseLiveUpdateFlag<0},_installRootEventHandler:function(e){e.addEventListener("change",this.reactChemObjChange,this)},_uninstallRootEventHandler:function(e){e.removeEventListener("change",this.reactChemObjChange,this)},reactChemObjChange:function(e){this.getEnableLiveUpdate()&&(this.isLiveUpdatePaused()?this.getObjMap().get(e.target)&&d.ArrayUtils.pushUnique(this._changedObjects,e.target):this.refreshObject(e.target))},refreshObject:function(e){var t=this.getObjMap().get(e);return t&&this._updateTreeItem(t,e),this},_fillTree:function(e){e&&(this.clearChildItems(),this._updateTreeItem(this.appendChildItem(),e))},_updateTreeItem:function(e,t){var r={text:this._getChemObjDisplayTitle(t),obj:t};this.setItemData(e,r),this.getObjMap().set(t,e);for(var n=this.getChildItemCount(e),i=t.getChildCount(),o=0;o<i;++o){var a,s=t.getChildAt(o);a=o<n?this.getChildItemAt(e,o):this.appendChildItem(e),this._updateTreeItem(a,s)}if(n>i)for(o=n-1;o>=i;--o)this.removeChildItemAt(e,o)},_getChemObjDisplayTitle:function(t){var r="",n=t.getId();n&&(r+='<span class="'+e.CHEM_STRUCT_TREE_VIEW_ITEM_TITLE+'">'+n+"</span>");var i=t.getClassName(),o=i.split("."),a=o.length?o[o.length-1]:i;return r+'<span class="'+e.CHEM_STRUCT_TREE_VIEW_ITEM_TYPE+'">('+a+")</span>"},selectChemObjs:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r],o=this.getObjMap().get(i);o&&t.push(o)}return this.select(t),this},getSelectedChemObjs:function(){var e=[],t=this.getSelection();if(t&&t.length)for(var r=0,n=t.length;r<n;++r){var i=this.getItemData(t[r]);i&&i.obj&&e.push(i.obj)}return e}})}(),function(){"use strict";d.oneOf,d.ChemWidget.AbstractUIMarker=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.AbstractUIMarker",initialize:function(){this.tryApplySuper("initialize"),this.setVisible(!0)},initProperties:function(){this.defineProp("drawStyles",{dataType:DataType.OBJECT}),this.defineProp("visible",{dataType:DataType.BOOL})}}),d.ChemWidget.MetaShapeUiMarker=Class.create(d.ChemWidget.AbstractUIMarker,{CLASS_NAME:"Kekule.ChemWidget.MetaShapeUiMarker",initialize:function(e){this.tryApplySuper("initialize"),e&&this.setShapeInfo(e)},initProperties:function(){this.defineProp("shapeInfo",{dataType:DataType.OBJECT}),this.defineProp("shapeType",{dataType:DataType.INT,serializable:!1,setter:null,getter:function(){var e=this.getShapeInfo();return e?e.shapeType:null}})}}),d.ChemWidget.MetaShapeUIMarker=d.ChemWidget.MetaShapeUiMarker,d.ChemWidget.TextUiMarker=Class.create(d.ChemWidget.AbstractUIMarker,{CLASS_NAME:"Kekule.ChemWidget.TextUiMarker",initialize:function(e,t){this.tryApplySuper("initialize"),e&&this.setText(e),t&&this.setCoord(t)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING}),this.defineProp("coord",{dataType:DataType.HASH})}}),d.ChemWidget.UiMarkerCollection=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerCollection",initProperties:function(){this.defineProp("markers",{dataType:DataType.ARRAY,getter:function(){var e=this.getPropStoreFieldValue("markers");return e||(e=[],this.setPropStoreFieldValue("markers",e)),e},setter:null})},getMarkerCount:function(){return this.getMarkers().length},getMarkerAt:function(e){return this.getMarkers()[e]},addMarker:function(e){return this.getMarkers().push(e)},indexOfMarker:function(e){return this.getMarkers().indexOf(e)},removeMarker:function(e){var t=this.getMarkers(),r=t.indexOf(e);r>=0&&t.splice(r,1)},clearMarkers:function(){this.setPropStoreFieldValue("markers",[])}}),d.ChemWidget.UiMarker2DRenderer=Class.create(d.Render.Base2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerRenderer"}),d.ChemWidget.MetaShapeUiMarker2DRenderer=Class.create(d.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.MetaShapeUiMarker2DRenderer",doDrawSelf:function(e,t,r){var n=this.getChemObj(),i=n.getShapeInfo();if(!i)return null;var o,a=Object.create(r);if((a=Object.extend(a,n.getDrawStyles()||{})).color&&(a.strokeColor||(a.strokeColor=a.color),a.fillColor||(a.fillColor=a.color)),d.Render.MetaShapeUtils.isCompositeShape(i))if(i.length>1){o=this.createDrawGroup(e);for(var s=0,l=i.length;s<l;++s){var u=i[s];this.doDrawShape(e,o,u,a)}}else{if(1!==i.length)return null;o=this.doDrawShape(e,null,i[0],a)}else o=this.doDrawShape(e,null,i,a);return o},doDrawShape:function(e,t,r,n){var i,o=d.Render.MetaShapeType;if(d.Render.MetaShapeUtils.isCompositeShape(r)){i=this.createDrawGroup(e);for(var a=0,s=r.length;a<s;++a)this.doDrawShape(e,i,r[a],n)}else{var l=r.coords;switch(r.shapeType){case o.POINT:i=this.drawCircle(e,l[0],1,n);break;case o.CIRCLE:i=this.drawCircle(e,l[0],r.radius,n);break;case o.LINE:var u=n;r.width&&((u=Object.create(n)).strokeWidth=r.width),i=this.drawLine(e,l[0],l[1],u);break;case o.RECT:i=this.drawRect(e,l[0],l[1],n);break;case o.ARC:(u=Object.extend({},n)).strokeWidth=r.width,u.fillColor=null,i=this.drawArc(e,l[0],r.radius,r.startAngle,r.endAngle,r.anticlockwise,u);break;case o.POLYGON:case o.POLYLINE:var c=[];for(a=0,s=l.length;a<s;++a){var h=0===a?"M":"L";c.push(h);var p=[l[a].x,l[a].y];c.push(p)}r.shapeType===o.POLYGON&&(c.push("L"),p=[l[0].x,l[0].y],c.push(p));var g=d.Render.DrawPathUtils.makePath.apply(this,c);i=this.drawPath(e,g,n)}}return t&&this.addToDrawGroup(i,t),i}}),d.ChemWidget.TextUiMarker2DRenderer=Class.create(d.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.TextUiMarker2DRenderer",doDrawSelf:function(e,t,r){var n=this.getChemObj(),i={textBoxXAlignment:d.Render.BoxXAlignment.CENTER,textBoxYAlignment:d.Render.BoxYAlignment.CENTER};i=Object.extend(i,r),i=Object.extend(i,n.getDrawStyles()||{});var o=n.getCoord();return n.getText()&&o?this.drawText(e,o,n.getText(),i):null}}),d.ChemWidget.UiMarkerCollection2DRenderer=Class.create(d.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerCollection2DRenderer",getChildObjs:function(){for(var e=this.getChemObj().getMarkers(),t=[],r=0,n=e.length;r<n;++r)e[r].getVisible()&&t.push(e[r]);return t}}),d.Render.Renderer2DFactory.register(d.ChemWidget.MetaShapeUiMarker,d.ChemWidget.MetaShapeUiMarker2DRenderer),d.Render.Renderer2DFactory.register(d.ChemWidget.TextUiMarker,d.ChemWidget.TextUiMarker2DRenderer),d.Render.Renderer2DFactory.register(d.ChemWidget.UiMarkerCollection,d.ChemWidget.UiMarkerCollection2DRenderer),d.ChemWidget.UiMarkersRenderer=Class.create(d.Render.Base2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkersRenderer",DRAW_ELEM_FIELD:"__$drawElem__",initialize:function(e,t){this.tryApplySuper("initialize",[e,t]),this._drawGroup=null},initProperties:function(){},getObjDrawElem:function(e,t){return this.getExtraProp2(e,t,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(e,t,r){this.setExtraProp2(e,t,this.DRAW_ELEM_FIELD,r)},doEstimateRenderBox:function(e,t,r,n){return null},doDraw:function(e,t,r){this.tryApplySuper("doDraw",[e,t,r]);var n=this.getChemObj(),i=this.createDrawGroup(e);return this.setObjDrawElem(e,n,i),n.getMarkerCount()>0&&this.doDrawMarkers(e,i,n.getMarkers(),r),i},doUpdate1:function(e,t,r){if(this.canModifyGraphic(e)){var n=!1,i=d.Render.ObjectUpdateType;switch(r){case i.ADD:n=this.doAddNew(e,t);break;case i.MODIFY:n=this.doModify(e,t);break;case i.REMOVE:var o=this._extractObjsOfUpdateObjDetails(t);n=this.doRemove(e,o);break;default:return this.tryApplySuper("doUpdate1",[e,t,r])}return n}return this.tryApplySuper("doUpdate1",[e,t,r])},doAddNew:function(e,t){return!!this.canRemoveElem()&&this.doModify(e,t)},doModify:function(e,t){if(!this.canRemoveElem())return!1;var r=this._extractObjsOfUpdateObjDetails(t);this.remove(e,r);var n=this.getChemObj(),i=this.getObjDrawElem(n),o=this.getDrawParams();r.indexOf(n)>=0?this.draw(e,o.baseCoord,o.options):this.doDrawMarkers(e,i,r,o.options)},doRemove:function(e,t){if(!this.canRemoveElem())return!1;var r=this.getObjDrawElem(t);if(r){var n=this.getObjDrawElem(this.getChemObj());this.doRemoveFromGroup(r,n),this.doRemoveElem(e,r),this.setObjDrawElem(t,null)}},doDrawMarkers:function(e,t,r,n){for(var i=0,o=r.length;i<o;++i){var a=r[i];a.getVisible()&&this.doDrawMarker(e,t,a,n)}},doDrawMarker:function(e,t,r,n){var i=r.getShapeInfo();if(!i)return null;var o,a=Object.create(n);if((a=Object.extend(r.getDrawStyles()||{})).color&&(a.strokeColor||(a.strokeColor=a.color),a.fillColor||(a.fillColor=a.color)),d.ArrayUtils.isArray(i))if(i.length>1){o=this.createDrawGroup(e);for(var s=0,l=i.length;s<l;++s){var u=i[s];this.doDrawShape(e,o,u,a)}}else{if(1!==i.length)return null;o=this.doDrawShape(e,null,i[0],a)}else o=this.doDrawShape(e,null,i,a);return o&&(this.setObjDrawElem(e,r,o),t&&this.addToDrawGroup(o,t)),o},doDrawShape:function(e,t,r,n){var i,o=d.Render.MetaShapeType;if(d.Render.MetaShapeUtils.isCompositeShape(r)){i=this.createDrawGroup(e);for(var a=0,s=r.length;a<s;++a)this.doDrawShape(e,i,r[a],n)}else{var l=r.coords;switch(r.shapeType){case o.POINT:i=this.drawCircle(e,l[0],1,n);break;case o.CIRCLE:i=this.drawCircle(e,l[0],r.radius,n);break;case o.LINE:var u=n;r.width&&((u=Object.create(n)).strokeWidth=r.width),i=this.drawLine(e,l[0],l[1],u);break;case o.RECT:i=this.drawRect(e,l[0],l[1],n);break;case o.POLYGON:case o.POLYLINE:var c=[];for(a=0,s=l.length;a<s;++a){var h=0===a?"M":"L";c.push(h);var p=[l[a].x,l[a].y];c.push(p)}r.shapeType===o.POLYGON&&(c.push("L"),p=[l[0].x,l[0].y],c.push(p));var g=d.Render.DrawPathUtils.makePath.apply(this,c);i=this.drawPath(e,g,n)}}return t&&this.addToDrawGroup(i,t),i}}),d.ClassDefineUtils.addExtraTwoTupleObjMapSupport(d.ChemWidget.UiMarkersRenderer)}(),function(){"use strict";var e=Class.PropertyScope,t=d.ArrayUtils,r=(d.ZoomUtils,d.ChemWidget.ComponentWidgetNames),n=d.ChemWidget,i=d.Widget.EvokeMode;d.globalOptions.add("chemWidget.viewer",{toolButtons:[r.loadData,r.saveData,r.molDisplayType,r.molHideHydrogens,r.zoomIn,r.zoomOut,r.rotateX,r.rotateY,r.rotateZ,r.rotateLeft,r.rotateRight,r.reset,r.copy,r.openEditor],menuItems:[r.loadData,r.saveData,d.Widget.MenuItem.SEPARATOR_TEXT,r.molDisplayType,r.molHideHydrogens,r.zoomIn,r.zoomOut,{text:d.$L("ChemWidgetTexts.CAPTION_ROTATE"),hint:d.$L("ChemWidgetTexts.HINT_ROTATE"),children:[r.rotateLeft,r.rotateRight,r.rotateX,r.rotateY,r.rotateZ]},r.reset,d.Widget.MenuItem.SEPARATOR_TEXT,r.copy,r.openEditor,r.config],toolbar:{evokeModes:[i.EVOKEE_CLICK,i.EVOKEE_MOUSE_ENTER,i.EVOKEE_TOUCH],revokeModes:[i.EVOKEE_MOUSE_LEAVE,i.EVOKER_TIMEOUT],pos:d.Widget.Position.AUTO,marginHorizontal:10,marginVertical:10},editor:{modal:!0,restrainEditorWithCurrObj:!0,shareEditorInstance:!0},enableToolbar:!1,enableDirectInteraction:!0,enableTouchInteraction:!1,showCaption:!1,useNormalBackground:!1,enableCustomCssProperties:!0,restraintRotation3DEdgeRatio:.18,enableRestraintRotation3D:!0}),d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{VIEWER:"K-Chem-Viewer",VIEWER2D:"K-Chem-Viewer2D",VIEWER3D:"K-Chem-Viewer3D",VIEWER_CAPTION:"K-Chem-Viewer-Caption",VIEWER_EMBEDDED_TOOLBAR:"K-Chem-Viewer-Embedded-Toolbar",VIEWER_MENU_BUTTON:"K-Chem-Viewer-Menu-Button",VIEWER_EDITOR_FULLCLIENT:"K-Chem-Viewer-Editor-FullClient",ACTION_ROTATE_LEFT:"K-Chem-RotateLeft",ACTION_ROTATE_RIGHT:"K-Chem-RotateRight",ACTION_ROTATE_X:"K-Chem-RotateX",ACTION_ROTATE_Y:"K-Chem-RotateY",ACTION_ROTATE_Z:"K-Chem-RotateZ",ACTION_VIEWER_EDIT:"K-Chem-Viewer-Edit"});var o=d.Widget.HtmlClassNames,a=d.ChemWidget.HtmlClassNames;d.ChemWidget.Viewer=Class.create(d.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.ChemWidget.Viewer",BINDABLE_TAG_NAMES:["div","span","img"],DEF_BGCOLOR_2D:null,DEF_BGCOLOR_3D:"#000000",DEF_TOOLBAR_EVOKE_MODES:[i.EVOKEE_CLICK,i.EVOKEE_MOUSE_ENTER,i.EVOKEE_TOUCH],DEF_TOOLBAR_REVOKE_MODES:[i.EVOKEE_MOUSE_LEAVE,i.EVOKER_TIMEOUT],initialize:function(e,t,r,n){this.setPropStoreFieldValue("renderType",r||d.Render.RendererType.R2D),this.setPropStoreFieldValue("useCornerDecoration",!0);var i=d.oneOf,o=d.globalOptions.get("chemWidget.viewer")||{};this.setPropStoreFieldValue("enableToolbar",i(o.enableToolbar)),this.setPropStoreFieldValue("enableDirectInteraction",i(o.enableDirectInteraction,!0)),this.setPropStoreFieldValue("showCaption",i(o.showCaption,!1)),o=o.toolbar||{},this.setPropStoreFieldValue("toolbarEvokeModes",i(o.evokeModes,this.DEF_TOOLBAR_EVOKE_MODES)),this.setPropStoreFieldValue("toolbarRevokeModes",i(o.revokeModes,this.DEF_TOOLBAR_REVOKE_MODES)),this.setPropStoreFieldValue("toolbarPos",i(o.pos,d.Widget.Position.AUTO)),this.setPropStoreFieldValue("toolbarMarginHorizontal",i(o.marginHorizontal,10)),this.setPropStoreFieldValue("toolbarMarginVertical",i(o.marginVertical,10)),this.tryApplySuper("initialize",[e,t,r]),this.setPropStoreFieldValue("viewerConfigs",n||this.createDefaultConfigs()),this.beginUpdate();try{this.setPadding(this.getRenderConfigs().getLengthConfigs().getActualLength("autofitContextPadding")),this._isContinuousRepainting=!1;var a=d.Render.RendererType,s=this.getRenderType()===a.R2D&&this.getBackgroundColor()||this.DEF_BGCOLOR_2D,l=this.getRenderType()===a.R3D&&this.getBackgroundColor()||this.DEF_BGCOLOR_3D;this.setBackgroundColorOfType(s,a.R2D),this.setBackgroundColorOfType(l,a.R3D),this.useCornerDecorationChanged(),this.doResize()}finally{this.endUpdate()}this.addIaController("default",new d.ChemWidget.ViewerBasicInteractionController(this),!0)},doFinalize:function(){var e=this.getToolbar();this.tryApplySuper("doFinalize"),e&&e.finalize(),this._composerDialog&&this._composerDialog.finalize(),this._composerPanel&&this._composerPanel.finalize()},initProperties:function(){this.defineProp("viewerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:!1,getter:function(){return this.getDisplayerConfigs()},setter:function(e){return this.setDisplayerConfigs(e)}}),this.defineProp("allowedMolDisplayTypes",{dataType:DataType.ARRAY,scope:e.PUBLIC,setter:function(e){this.setPropStoreFieldValue("allowedMolDisplayTypes",e),this.updateUiComps()}}),this.defineProp("enableRestraintRotation3D",{dataType:DataType.BOOL}),this.defineProp("restraintRotation3DEdgeRatio",{dataType:DataType.FLOAT}),this.defineProp("enableHotKey",{dataType:DataType.FLOAT}),this.defineProp("enableEdit",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableEdit")&&this.getCoordMode()!==d.CoordMode.COORD3D}}),this.defineProp("shareEditorInstance",{dataType:DataType.BOOL}),this.defineProp("enableEditFromVoid",{dataType:DataType.BOOL}),this.defineProp("restrainEditorWithCurrObj",{dataType:DataType.BOOL}),this.defineProp("modalEdit",{dataType:DataType.BOOL}),this.defineProp("editorProperties",{dataType:DataType.HASH}),this.defineProp("toolButtons",{dataType:DataType.ARRAY,scope:e.PUBLIC,getter:function(){return this.getPropStoreFieldValue("toolButtons")},setter:function(e){this.setPropStoreFieldValue("toolButtons",e),this.updateToolbar()}}),this.defineProp("menuItems",{dataType:DataType.ARRAY,scope:e.PUBLIC,setter:function(e){this.setPropStoreFieldValue("menuItems",e),this.updateMenu()}}),this.defineProp("menu",{dataType:"Kekule.Widget.Menu",serializable:!1,scope:e.PRIVATE,setter:function(e){var t=this.getMenu();e!==t&&(t&&(t.finalize(),t=null),this.setPropStoreFieldValue("menu",e))}}),this.defineProp("toolbar",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1,scope:e.PRIVATE,setter:function(e){var t=this.getToolbar(),r=this.getToolbarEvokeHelper();if(e!==t){if(t){t.finalize();var n=this.getToolbarEvokeHelper();n&&n.finalize(),t=null}r&&r.finalize(),this.setPropStoreFieldValue("toolbar",e),e&&this.setPropStoreFieldValue("toolbarEvokeHelper",new d.Widget.DynamicEvokeHelper(this,e,this.getToolbarEvokeModes(),this.getToolbarRevokeModes()))}}}),this.defineProp("enableToolbar",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableToolbar",e),this.updateToolbar()}}),this.defineProp("toolbarPos",{dataType:DataType.INT,enumSource:d.Widget.Position,setter:function(e){this.setPropStoreFieldValue("toolbarPos",e),this.adjustToolbarPos()}}),this.defineProp("toolbarMarginVertical",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("toolbarMarginVertical",e),this.adjustToolbarPos()}}),this.defineProp("toolbarMarginHorizontal",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("toolbarMarginHorizontal",e),this.adjustToolbarPos()}}),this.defineProp("toolbarEvokeHelper",{dataType:"Kekule.Widget.DynamicEvokeHelper",serializable:!1,setter:null,scope:e.PRIVATE}),this.defineProp("toolbarEvokeModes",{dataType:DataType.ARRAY,scope:e.PUBLIC,setter:function(e){this.setPropStoreFieldValue("toolbarEvokeModes",e||[]),this.getToolbarEvokeHelper()&&this.getToolbarEvokeHelper().setEvokeModes(e||[])}}),this.defineProp("toolbarRevokeModes",{dataType:DataType.ARRAY,scope:e.PUBLIC,setter:function(e){this.setPropStoreFieldValue("toolbarRevokeModes",e||[]),this.getToolbarEvokeHelper()&&this.getToolbarEvokeHelper().setRevokeModes(e||[])}}),this.defineProp("toolbarRevokeTimeout",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("toolbarRevokeTimeout",e),this.getToolbarEvokeHelper()&&this.getToolbarEvokeHelper().setTimeout(e)}}),this.defineProp("toolbarParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){this.getToolbarParentElem()!==e&&(this.setPropStoreFieldValue("toolbarParentElem",e),this.updateToolbar())}}),this.defineProp("caption",{dataType:DataType.STRING,setter:function(e){this.setPropStoreFieldValue("caption",e),d.DomUtils.setElementText(this.getCaptionElem(),e||""),this.captionChanged()}}),this.defineProp("showCaption",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showCaption",e),this.captionChanged()}}),this.defineProp("captionPos",{dataType:DataType.INT,enumSource:d.Widget.Position,setter:function(e){this.setPropStoreFieldValue("captionPos",e),this.captionChanged()}}),this.defineProp("autoCaption",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoCaption",e),e&&this.autoDetectCaption()}}),this.defineProp("captionElem",{dataType:DataType.OBJECT,scope:e.PRIVATE,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("captionElem");return t||e||(t=this.doCreateCaptionElem(),this.setPropStoreFieldValue("captionElem",t)),t}}),this.defineProp("actions",{dataType:"Kekule.ActionList",serializable:!1,scope:e.PUBLIC,setter:null,getter:function(){var e=this.getPropStoreFieldValue("actions");return e||(e=new d.ActionList,this.setPropStoreFieldValue("actions",e)),e}}),this.defineProp("actionMap",{dataType:"Kekule.MapEx",serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPropStoreFieldValue("actionMap");return e||(e=new d.MapEx(!0),this.setPropStoreFieldValue("actionMap",e)),e}}),this.defineProp("enableDirectInteraction",{dataType:DataType.BOOL}),this.defineProp("enableTouchInteraction",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableTouchInteraction",!!e),this.setTouchAction(e?"none":null)}})},initPropValues:function(){this.setStyleMode(d.Widget.StyleMode.INHERITED);var e=d.oneOf,t=d.globalOptions.get("chemWidget.viewer")||{};this.setUseNormalBackground(e(t.useNormalBackground,!1)),this.setEnableCustomCssProperties(e(t.enableCustomCssProperties,!0)),this.setRestraintRotation3DEdgeRatio(e(t.restraintRotation3DEdgeRatio,.18)),this.setEnableRestraintRotation3D(e(t.enableRestraintRotation3D,!0)),this.setEnableTouchInteraction(e(t.enableTouchInteraction,!1)),t=t.editor||{},this.setModalEdit(e(t.modal,!0)),this.setRestrainEditorWithCurrObj(e(t.restrainEditorWithCurrObj,!0)),this.setShareEditorInstance(e(t.shareEditorInstance,!0))},createDefaultConfigs:function(){return new d.ChemWidget.ViewerConfigs},canUsePlaceHolderOnElem:function(e){var t=e.getAttribute("src");return"img"===e.tagName.toLowerCase()&&!!t},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]),this.updateActions()},doSetElement:function(e){var t=e;return t&&"img"===t.tagName.toLowerCase()&&(t=d.DomUtils.replaceTagName(t,"span")),this.tryApplySuper("doSetElement",[t])},doUnbindElement:function(e){return this._drawContextParentElem&&this._drawContextParentElem.parentNode&&(this._drawContextParentElem.parentNode.removeChild(this._drawContextParentElem),this._drawContextParentElem=null),this.tryApplySuper("doUnbindElement",[e])},elementBound:function(e){this.setObserveElemResize(!0)},doCreateRootElement:function(e){return e.createElement("div")},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+a.VIEWER;try{var t=this.getRenderType();e+=" "+this._getRenderTypeSpecifiedHtmlClassName(t)}catch(e){}return e},_getRenderTypeSpecifiedHtmlClassName:function(e){return e===d.Render.RendererType.R3D?a.VIEWER3D:a.VIEWER2D},getResizerElement:function(){return this.getElement()},doResize:function(){this.adjustDrawParentDim(),this.adjustToolbarPos(),this.tryApplySuper("doResize")},doWidgetShowStateChanged:function(e){e&&this.updateActions()},refitDrawContext:function(e){this.tryApplySuper("refitDrawContext",[e]),this.adjustToolbarPos()},getAllowRenderTypeChange:function(){return!0},resetRenderType:function(e,t){this.tryApplySuper("resetRenderType",[e,t]);var r=this._getRenderTypeSpecifiedHtmlClassName(e),n=this._getRenderTypeSpecifiedHtmlClassName(t);this.removeClassName(r),this.addClassName(n),this.updateUiComps()},doLoadEnd:function(e){this.updateActions(),this.autoDetectCaption()},doSetUseCornerDecoration:function(e){this.tryApplySuper("doSetUseCornerDecoration",[e]),this.useCornerDecorationChanged()},useCornerDecorationChanged:function(){var e=this.getDrawContextParentElem();e&&(this.getUseCornerDecoration()?d.HtmlElementUtils.addClass(e,o.CORNER_ALL):d.HtmlElementUtils.removeClass(e,o.CORNER_ALL))},adjustDrawParentDim:function(){var e=this.getDrawContextParentElem(),t=e.parentNode,r=this.getCaptionElem(!0);if(d.HtmlElementUtils.getElemClientDimension(t),r&&this.captionIsShown()&&r.parentNode===t){var n=d.HtmlElementUtils.getElemClientDimension(r).height||0;this.getCaptionPos()&d.Widget.Position.TOP?(e.style.top=n+"px",e.style.bottom="0px"):(e.style.top="0px",e.style.bottom=n+"px"),d.StyleUtils.removeStyleProperty(e.style,"height")}else d.StyleUtils.removeStyleProperty(e.style,"top"),d.StyleUtils.removeStyleProperty(e.style,"bottom"),e.style.height="100%"},getInteractionReceiverElem:function(){return this.getDrawContextParentElem()},setDrawDimension:function(e,t){var r=t;this.captionIsShown()&&(r+=d.HtmlElementUtils.getElemClientDimension(this.getCaptionElem()).height||0),this.tryApplySuper("setDrawDimension",[e,r])},doCreateCaptionElem:function(){var e=this.getDocument().createElement("span");return e.className=o.DYN_CREATED+"  "+o.SELECTABLE+" "+a.VIEWER_CAPTION,this.getElement().appendChild(e),e},captionChanged:function(){if(this.captionIsShown()){var e=(t=this.getCaptionElem()).style;this.getCaptionPos()&d.Widget.Position.TOP?(e.top=0,e.bottom="auto"):(e.bottom=0,e.top="auto"),e.display="block"}else{var t;(t=this.getCaptionElem(!0))&&(t.style.display="none")}this.doResize()},captionIsShown:function(){return this.getCaption()&&this.getShowCaption()},getAllowEditing:function(){return this.getCoordMode()!==d.CoordMode.COORD3D&&this.getEnableEdit()&&(this.getChemObj()||this.getEnableEditFromVoid())},getComposerDialog:function(){var e;return(e=this.getShareEditorInstance()?d.ChemWidget.Viewer._composerDialog:this._composerDialog)||d.Editor.ComposerDialog&&(e=new d.Editor.ComposerDialog(this.getDocument(),d.$L("ChemWidgetTexts.CAPTION_EDIT_OBJ"),[d.Widget.DialogButtons.OK,d.Widget.DialogButtons.CANCEL])),this.getShareEditorInstance()?d.ChemWidget.Viewer._composerDialog=e:this._composerDialog=e,e},getComposerPanel:function(){var e;if(!(e=this.getShareEditorInstance()?d.ChemWidget.Viewer._composerPanel:this._composerPanel)&&d.Editor.Composer){(e=new d.Editor.Composer(this.getDocument())).addClassName(a.VIEWER_EDITOR_FULLCLIENT),e.setUseNormalBackground(!0);var n=d.Editor.Composer.getMinPreferredDimension();e.setMinDimension(n),e.setEnableDimensionTransform(!0),e.setAutoResizeConstraints({width:1,height:1});var i=d.globalOptions.chemWidget.composer.commonToolButtons;i=t.exclude(i,[r.cut,r.config,r.objInspector]),e.setCommonToolButtons(i);var o=[{text:d.$L("ChemWidgetTexts.CAPTION_EDITOR_DONE"),hint:d.$L("ChemWidgetTexts.HINT_EDITOR_DONE"),htmlClass:"K-Res-Button-YesOk",showText:!0,"#execute":function(){e._doneEditCallback(),e.hide()}},{text:d.$L("ChemWidgetTexts.CAPTION_EDITOR_CANCEL"),hint:d.$L("ChemWidgetTexts.HINT_EDITOR_CANCEL"),htmlClass:"K-Res-Button-NoCancel",showText:!0,"#execute":function(){e.hide()}}];e._customEndEditButtons=o}return this.getShareEditorInstance()?d.ChemWidget.Viewer._composerPanel=e:this._composerPanel=e,e._invokerViewer=this,e._doneEditCallback=null,e},openEditor:function(e){if(this.getAllowEditing()){var t=this.getChemObj(),r=!t,n=t&&t.isEmpty&&t.isEmpty(),i=this.getRestrainEditorWithCurrObj(),o=d.DocumentUtils.getClientDimension(this.getDocument()),a=d.Editor.Composer.getMinPreferredDimension();o.width<=a.width+50||o.height<a.height+100?this._openEditComposer(e,t,i,r,n):this._openEditComposerDialog(e,t,i,r,n)}},_prepareEditComposer:function(e,t,r,n){e.setEnableCreateNewDoc(r||!t),e.setEnableLoadNewFile(r||!t),e.setAllowCreateNewChild(r||!t);var i=this.getEditorProperties();i&&e.setPropValues(i)},_feedbackEditResult:function(e,t,r){if(e.isDirty()){var n=e.getSavingTargetObj();r?this.setChemObj(n.clone()):this.getRestrainEditorWithCurrObj()?(t.getClass()===n.getClass()?t.assign(n.clone()):t.assign(n),t.setSrcInfo(null),this.setChemObj(t)):this.setChemObj(n),this.invokeEvent("editingDone",{obj:this.getChemObj()})}},_openEditComposerDialog:function(e,t,r,n,i){var o=this.getComposerDialog();if(o){var a,s=o.getComposer();this._prepareEditComposer(s,r,n,i),n||i?o.getComposer().newDoc():(a=t.clone(),o.setChemObj(a));var l=this,u=function(e){e===d.Widget.DialogButtons.OK&&o.getComposer().isDirty()&&l._feedbackEditResult(o.getComposer(),t,n)};this.getModalEdit()?o.openModal(u,e||this):o.openPopup(u,e||this)}else d.error(d.$L("ErrorMsg.CAN_NOT_CREATE_EDITOR"))},_openEditComposer:function(e,t,r,n,i){var o=this.getComposerPanel();if(o){this._prepareEditComposer(o,r,n,i);for(var a=o._customEndEditButtons,s=o.getCommonToolButtons()||[],l=!1,u=0,c=a.length;u<c;++u){var h=a[u];s.indexOf(h)<0&&(s.push(h),l=!0)}if(l&&o.setCommonToolButtons(s),n||i)o.newDoc();else{var p=t.clone();o.setChemObj(p)}var g=this;o._doneEditCallback=function(){g._feedbackEditResult(o,t,n)},o.show(e,(function(){n||i||o.setChemObj(p)}),d.Widget.ShowHideType.POPUP)}else d.error(d.$L("ErrorMsg.CAN_NOT_CREATE_EDITOR"))},resetView:function(){return this.resetDisplay()},getCurr2DRotationAngle:function(){return this.getDrawOptions().rotateAngle||0},rotate2DBy:function(e,t){return this.rotate2DTo(this.getCurr2DRotationAngle()+e,t)},rotate2DTo:function(e,t){return this.getDrawOptions().rotateAngle=e,t||this.geometryOptionChanged(),this},getCurr3DRotationInfo:function(){for(var e={},t=["rotateMatrix","rotateX","rotateY","rotateZ","rotateAngle"],r=this.getDrawOptions(),n=0,i=t.length;n<i;++n){var o=t[n];e[o]=r[o]||0}return e.rotateAxisVector=r.rotateAxisVector||null,e},setRotate3DMatrix:function(e,t){return this.getDrawOptions().rotateMatrix=e,t||this.geometryOptionChanged(),this},rotate3DBy:function(e,t,r,n){var i=this.getCurr3DRotationInfo().rotateMatrix||d.MatrixUtils.createIdentity(4),o=d.CoordUtils.calcRotate3DMatrix({rotateX:e,rotateY:t,rotateZ:r}),a=d.MatrixUtils.multiply(o,i);return this.setRotate3DMatrix(a,n),this},rotate3DByAxis:function(e,t,r){var n=this.getCurr3DRotationInfo().rotateMatrix||d.MatrixUtils.createIdentity(4),i=d.CoordUtils.calcRotate3DMatrix({rotateAngle:e,rotateAxisVector:t}),o=d.MatrixUtils.multiply(i,n);return this.setRotate3DMatrix(o,r),this},getDefaultToolBarButtons:function(){return d.globalOptions.chemWidget.viewer.toolButtons},isToolbarEmbedded:function(){return!this.getToolbarParentElem()},adjustToolbarPos:function(){var e=this.getToolbar();if(e)if(this.isToolbarEmbedded()){var t=d.Widget.Position,r=d.HtmlElementUtils.getElemPageRect(this.getDrawContextParentElem()),n=d.HtmlElementUtils.getElemPageRect(e),i=this.getToolbarPos(),o=this.getToolbarMarginHorizontal(),a=this.getToolbarMarginVertical(),s="left",l="top",u="right",c="bottom",h=(r.width-n.width)/2,p=(r.height-n.height)/2;if(i===t.AUTO||!i){var g=2*(o>0?o:0)+n.width,f=2*(a>0?a:0)+n.height;g>r.width?(i|=t.LEFT,o=0):i|=t.RIGHT,f>r.height/2?(i|=t.BOTTOM,a=-1):i|=t.BOTTOM}i&t.LEFT?(s="left",u="right",h=o>=0?o:o-n.width):i&t.RIGHT&&(s="right",u="left",h=o>=0?o:o-n.width),i&t.TOP?(l="top",c="bottom",p=a>=0?a:a-n.height):i&t.BOTTOM&&(l="bottom",c="top",p=a>=0?a:a-n.height),e.removeStyleProperty(u),e.removeStyleProperty(c),e.setStyleProperty(s,h+"px"),e.setStyleProperty(l,p+"px")}else e.removeStyleProperty("left"),e.removeStyleProperty("top"),e.removeStyleProperty("width"),e.removeStyleProperty("height")},updateToolbar:function(){this.getEnableToolbar()?(this.createToolbar(),this.adjustToolbarPos()):this.setToolbar(null)},updateMenu:function(){this.createMenu()},updateUiComps:function(){this.updateToolbar(),this.updateMenu()},updateActions:function(){this.getActions()&&this.getActions().updateAll()},clearActions:function(){this.getActions().clear(),this.getActionMap().clear()},getCompActionClass:function(e){return this.getChildActionClass(e,!0)},_getActionOfComp:function(e,t,r){var n=this.getActionMap(),i=n.get(e);if(!i&&t){var o=this.getCompActionClass(e)||r;o&&(i=new o(this),n.set(e,i),this.getActions().add(i))}return i},getChildAction:function(e,t){var r=this._getActionOfComp(e,!0);return r||(r=this.tryApplySuper("getChildAction",[e,t])),r},createToolbar:function(){this.clearActions();var e=new d.Widget.ButtonGroup(this);e.addClassName(o.DYN_CREATED),e.setDisplayed(!1),e.setShowText(!1),e.doSetShowGlyph(!0);for(var t=this.getToolButtons()||this.getDefaultToolBarButtons(),r=0,n=t.length;r<n;++r){var i=t[r];this.createToolButton(i,e)}return e.addClassName(a.INNER_TOOLBAR),this.isToolbarEmbedded()&&e.addClassName(a.VIEWER_EMBEDDED_TOOLBAR),e.appendToElem(this.getToolbarParentElem()||this.getElement()),this.setToolbar(e),e},createToolButton:function(e,t){var n=null,i=this.beginContinuousRepainting.bind(this),o=this.endContinuousRepainting.bind(this),a=[r.rotateX,r.rotateY,r.rotateZ,r.rotateLeft,r.rotateRight];if(DataType.isObjectValue(e)){var s=Object.extend({widget:d.Widget.Button},e);n=d.Widget.Utils.createFromHash(t,s),(u=s.actionClass)&&"string"==typeof u&&(u=ClassEx.findClass(s.actionClass)),u&&(l=this._getActionOfComp(n,!0,u))&&n.setAction(l)}else{if(e===r.molDisplayType)return this.createMolDisplayTypeButton(t);if(e===r.menu)return this.createMenuButton(t);var l,u=this.getCompActionClass(e),c=d.Widget.Button;e===r.molHideHydrogens&&(c=d.Widget.CheckButton),n=new c(t),(l=this._getActionOfComp(e,!0))&&n.setAction(l),a.indexOf(e)>=0&&(n.setPeriodicalExecInterval(20),n.setEnablePeriodicalExec(!0),n.addEventListener("activate",i),n.addEventListener("deactivate",o))}return n},createMenuButton:function(e){var t=new d.Widget.DropDownButton(e);return t.setText(d.$L("WidgetTexts.CAPTION_MENU")).setHint(d.$L("WidgetTexts.HINT_MENU")),t.addClassName(a.VIEWER_MENU_BUTTON),this.getMenu()||this.createMenu(),t.setDropDownWidget(this.getMenu()),t},createMolDisplayTypeButton:function(e){var t=new d.Widget.CompactButtonSet(e);t.getButtonSet().addClassName(a.INNER_TOOLBAR),t.setShowText(!1);var n=this._getActionOfComp(r.molDisplayType,!0);t.setAction(n),this.getActions().add(n);for(var i=this.getDocument(),o=this.getAllowedMolDisplayTypes(),s=this._getUsableMolDisplayActionClasses(o),l=0,u=s.length;l<u;++l){var c=s[l].TYPE,h=new d.Widget.RadioButton(i);n=this._getActionOfComp(r.molDisplayType+c,!0,s[l]),h.setAction(n),t.append(h,c===this.getCurrMoleculeDisplayType())}return t},_getUsableMolDisplayActionClasses:function(e){for(var t=[],r=this.getRenderType()===d.Render.RendererType.R3D?n.Viewer.molDisplayType3DActionClasses:n.Viewer.molDisplayType2DActionClasses,i=0,o=r.length;i<o;++i){var a=r[i].TYPE;e&&e.indexOf(a)<0&&a!==this.getCurrMoleculeDisplayType()||t.push(r[i])}return t},getDefaultMenuItems:function(){return d.globalOptions.chemWidget.viewer.menuItems},prepareMenuItems:function(e){for(var t=[],r=d.Widget.MenuItem.SEPARATOR_TEXT,n=0,i=e.length;n<i;++n){var o=e[n];if("string"==typeof o){if(o!==r){var a=this.createPredefinedMenuItemDefHash(o);a&&t.push(a)}}else{var s=Object.extend({},o);if(o.widget||o.widgetClass||(s.widget=d.Widget.MenuItem),o.children&&o.children.length){var l=this.prepareMenuItems(o.children);s.children=l}t.push(s)}}return t},createPredefinedMenuItemDefHash:function(e){if(e===r.molDisplayType)return this.createMolDisplayMenuDefHash();var t=[r.rotateX,r.rotateY,r.rotateZ,r.rotateLeft,r.rotateRight],n=this.beginContinuousRepainting.bind(this),i=this.endContinuousRepainting.bind(this),o=(this.getCompActionClass(e),d.Widget.MenuItem),a=null,s=this._getActionOfComp(e,!0);return s&&(a={widget:o,action:s},t.indexOf(e)>=0&&(a=Object.extend(a,{periodicalExecInterval:20,enablePeriodicalExec:!0,"#activate":n,"@deactivate":i}))),a},createMolDisplayMenuDefHash:function(){for(var e=this._getActionOfComp(r.molDisplayType,!0),t={widget:d.Widget.MenuItem,action:e},n=[],i=this.getAllowedMolDisplayTypes(),o=this._getUsableMolDisplayActionClasses(i),a=0,s=o.length;a<s;++a){var l=o[a].TYPE;e=this._getActionOfComp(r.molDisplayType+l,!0,o[a]),n.push({widget:d.Widget.MenuItem,action:e})}return n.length&&(t.children=[{widget:d.Widget.PopupMenu,children:n}]),t},createMenu:function(){var e=this.getMenu();e?e.clearMenuItems():((e=new d.Widget.PopupMenu(this)).addClassName(o.DYN_CREATED),e.setDisplayed(!1));var t=this.getMenuItems()||this.getDefaultMenuItems();return t=this.prepareMenuItems(t),e.createChildrenByDefs(t),this.setMenu(e),e},autoDetectCaption:function(){if(this.getAutoCaption()){var e=this.getChemObj();if(e){var t=e&&e.getInfo(),r=e&&e.getSrcInfo();if(t&&r){var n=t.title||t.caption||e.getName()||r.fileName;n&&this.setCaption(n)}}}},reactHotKeys:function(e){if(this.getEnableHotKey()){for(var t=this.getCoordMode()||d.CoordMode.COORD2D,r=this.getViewerConfigs().getHotKeyConfigs().getHotKeys(),n=d.Widget.KeyboardUtils.getKeyParamsFromEvent(e),i=!1,o=r.length-1;o>=0;--o){var a=r[o],s=d.Widget.KeyboardUtils.shortcutLabelToKeyParams(r[o].key,null,!1);if(s.repeat=a.repeat,d.Widget.KeyboardUtils.matchKeyParams(n,s,!1)){var l=a.action;if(l&&(!a.coordMode||a.coordMode===t)){var u=this.getChildAction(l,!0);u&&(i=u.execute(this,e)||i)}}}if(i)return e.stopPropagation(),e.preventDefault(),!0}},react_keydown:function(e){if(!this.tryApplySuper("react_keydown",[e]))return this.reactHotKeys(e)}});var s=d.X.Event;d.ChemWidget.ViewerBasicInteractionController=Class.create(d.Widget.InteractionController,{CLASS_NAME:"Kekule.ChemWidget.ViewerBasicInteractionController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._enableMouseRotate=!0,this._transformInfo={isTransforming:!1,lastCoord:null,lastZoom:null},this._restraintCoord=null,this._doInteractiveTransformStepBind=this._doInteractiveTransformStep.bind(this)},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,getter:function(){return this.getWidget()},setter:function(e){this.setWidget(e)}})},getViewerRenderType:function(){return this.getViewer().getRenderType()},getEnableInteraction:function(){var e=this.getViewer();return!!(e&&e.getEnableDirectInteraction()&&e.getChemObjLoaded())},getEnableTouchInteraction:function(){var e=this.getViewer();return!!(e&&e.getEnableDirectInteraction()&&e.getEnableTouchInteraction()&&e.getChemObjLoaded())},_initTransform:function(){var e,t=this.getViewer(),r=t.getOffsetWidth(),n=t.getOffsetHeight(),i=this._transformInfo,o=this._restraintCoord;o?(e="x"===o?n:r,i.angleRatio=1/e*Math.PI*2):(e=Math.min(r,n),i.angleRatio=1/e*Math.PI)},zoomViewer:function(e){var t=this.getViewer();t&&t.getChemObj()&&(e>0?t.zoomIn&&t.zoomIn(e):e<0&&t.zoomOut&&t.zoomOut(-e))},isEventFromInteractionArea:function(e){var t=e.getTarget(),r=this.getViewer().getInteractionReceiverElem();return t===r||d.DomUtils.isDescendantOf(t,r)},_beginInteractTransformAtCoord:function(e,t,r,n){var i=this.getViewer();if(i&&i.getChemObj()){var o=this._transformInfo;o.isTransforming=!0,o.lastCoord={x:e,y:t},this._restraintCoord=this._calcRestraintRotateCoord(r,n),this._initTransform(),this._requestInteractiveTransform(e,t)}},_endInteractTransform:function(){this._transformInfo.isTransforming=!1,this._doInteractiveTransformEnd()},_calcRestraintRotateCoord:function(e,t){var r=this.getViewer(),n=null,i=this._getRestraintRotate3DEdgeSize();if(i>0){var o,a,s,l,u=r.getInteractionReceiverElem(),c=d.HtmlElementUtils.getElemPageRect(u,!0),h=e-c.left,p=t-c.top,g=c.right-e,f=c.bottom-t;h<=g?(s=1,o=h):(s=-1,o=g),p<=f?(l=1,a=p):(l=-1,a=f);var m=Math.min(o,a);if(m>i)return null;a>m?s<0&&(n="x"):n=l>0?"z":"y"}return n},_interactTransformAtCoord:function(e,t){var r=this._transformInfo.lastCoord;if(r){var n={x:e,y:t};if(d.CoordUtils.getDistance(r,n)<5)return}this._requestInteractiveTransform(e,t)},_requestInteractiveTransform:function(e,t){this._transformInfo.interactScreenCoord={x:e,y:t},this._interactiveTransformStepId||(this._interactiveTransformStepId=window.requestAnimationFrame(this._doInteractiveTransformStepBind))},_doInteractiveTransformStep:function(){if(this._transformInfo&&this._transformInfo.isTransforming){var e=this._transformInfo.interactScreenCoord;this.getViewerRenderType()===d.Render.RendererType.R3D?this.rotateByXYDistance(e.x,e.y):this.moveByXYDistance(e.x,e.y),this._interactiveTransformStepId=window.requestAnimationFrame(this._doInteractiveTransformStepBind)}},_doInteractiveTransformEnd:function(){this._interactiveTransformStepId&&(window.cancelAnimationFrame(this._interactiveTransformStepId),this._interactiveTransformStepId=null)},_getRestraintRotate3DEdgeSize:function(){var e=this.getViewer();if(e.getEnableRestraintRotation3D()&&e.getRenderType()===d.Render.RendererType.R3D){var t=e.getDimension();return Math.min(t.width,t.height)*(e.getRestraintRotation3DEdgeRatio()||0)}return 0},needReactEvent:function(e){return this.getEnableInteraction()&&this.isEventFromInteractionArea(e)},react_dblclick:function(e){this.needReactEvent(e)&&this.getViewer().resetDisplay()},react_mousewheel:function(e){if(this.needReactEvent(e)){var t=e.wheelDeltaY||e.wheelDelta;return t&&(t/=120),this.zoomViewer(t),e.preventDefault(),!0}},react_pointerdown:function(e){this.needReactEvent(e)&&e.getButton()===s.MouseButton.LEFT&&(e.getPointerType()!==s.PointerType.TOUCH||this.getEnableTouchInteraction())&&this._beginInteractTransformAtCoord(e.getScreenX(),e.getScreenY(),e.getClientX(),e.getClientY())},react_pointerhold:function(e){this.needReactEvent(e)&&e.getPointerType()===s.PointerType.TOUCH&&(e.getButton(),s.MouseButton.LEFT)},react_pointerleave:function(e){this._endInteractTransform()},react_pointerup:function(e){e.getButton()===s.MouseButton.LEFT&&this._endInteractTransform()},react_pointermove:function(e){if(this.needReactEvent(e)&&this._transformInfo.isTransforming){this._interactTransformAtCoord(e.getScreenX(),e.getScreenY());try{e.preventDefault()}catch(e){}}},moveByXYDistance:function(e,t){var r=this._transformInfo;if(r&&r.isTransforming&&!r.calculating){var n=this.getViewer();if(n.getRenderType()===d.Render.RendererType.R3D)return;r.calculating=!0;try{var i={x:e,y:t},o=d.CoordUtils.substract(i,r.lastCoord),a=n.getBaseCoordOffset()||{};a=d.CoordUtils.add(a,o),n.setBaseCoordOffset(a),r.lastCoord=i}finally{r.calculating=!1}}},rotateByXYDistance:function(e,t){var r=this._transformInfo;if(r&&r.isTransforming&&!r.calculating){var n=this.getViewer();if(n.getRenderType()!==d.Render.RendererType.R3D)return;r.calculating=!0;try{var i,o,a,s={x:e,y:t},l=d.CoordUtils.substract(s,r.lastCoord);if(l.y=-l.y,this._restraintCoord){var u=this._restraintCoord;"x"===u?(i=l.y,a={x:1,y:0,z:0}):(i=l.x,a="y"===u?{x:0,y:-1,z:0}:{x:0,y:0,z:1}),o=-i*r.angleRatio}else o=(i=d.CoordUtils.getDistance({x:0,y:0},l))*r.angleRatio,a={x:-l.y,y:l.x,z:0};n.rotate3DByAxis(o,a),r.lastCoord=s,r.calculating=!1}catch(e){}finally{r.calculating=!1}}},doTestMouseCursor:function(e,t){var r="";return this._transformInfo.isTransforming&&(r="move"),r}}),d.ChemWidget.Viewer2D=Class.create(d.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer2D",initialize:function(e,t){this.tryApplySuper("initialize",[e,t,d.Render.RendererType.R2D])},getAllowRenderTypeChange:function(){return!1}}),d.ChemWidget.Viewer3D=Class.create(d.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer3D",initialize:function(e,t){this.tryApplySuper("initialize",[e,t,d.Render.RendererType.R3D])},getAllowRenderTypeChange:function(){return!1}});var l=d.ObjPropSettingManager;l.register("Kekule.ChemWidget.Viewer.fullFunc",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!0,enableEdit:!0,toolButtons:null}),l.register("Kekule.ChemWidget.Viewer.basic",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!1,toolButtons:[r.saveData,r.molDisplayType,r.zoomIn,r.zoomOut],menuItems:[r.saveData,"-",r.molDisplayType,r.zoomIn,r.zoomOut]}),l.register("Kekule.ChemWidget.Viewer.mini",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!1,toolButtons:[r.menu],menuItems:[r.saveData,"-",r.molDisplayType,r.zoomIn,r.zoomOut]}),l.register("Kekule.ChemWidget.Viewer.static",{enableToolbar:!1,enableDirectInteraction:!1,enableTouchInteraction:!1,toolButtons:[],menuItems:[]}),l.register("Kekule.ChemWidget.Viewer.editOnly",{enableToolbar:!0,enableEdit:!0,toolButtons:[r.openEditor],menuItems:[r.openEditor]}),d.ChemWidget.Viewer.Settings=Class.create(d.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.ChemWidget.Viewer.Settings",initProperties:function(){this.defineDelegatedProps(["enableDirectInteraction","enableTouchInteraction","enableToolbar","toolbarPos","toolbarMarginHorizontal","toolbarMarginVertical","enableEdit","modalEdit"])},getViewer:function(){return this.getWidget()}}),d.ChemWidget.ViewerConfigs=Class.create(d.ChemWidget.ChemObjDisplayerConfigs,{CLASS_NAME:"Kekule.ChemWidget.ViewerConfigs",initProperties:function(){this.addConfigProp("hotKeyConfigs","Kekule.ChemWidget.ViewerHotKeyConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("hotKeyConfigs",new d.ChemWidget.ViewerHotKeyConfigs)}}),d.ChemWidget.ViewerHotKeyConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ViewerHotKeyConfigs",initProperties:function(){this.defineProp("hotKeys",{dataType:DataType.ARRAY})},initPropValues:function(){var e=d.ChemWidget.ComponentWidgetNames;this.tryApplySuper("initPropValues"),this.setHotKeys([{key:"Ctrl+C",action:e.copy},{key:"+",action:e.zoomIn},{key:"-",action:e.zoomOut},{key:"Space",action:e.reset},{key:"R",action:e.rotateLeft,repeat:null,coordMode:2},{key:"Shift-R",action:e.rotateRight,repeat:null,coordMode:2},{key:"X",action:e.rotateX,repeat:null,coordMode:3},{key:"Shift+X",action:e.rotateX,repeat:null,coordMode:3},{key:"Y",action:e.rotateY,repeat:null,coordMode:3},{key:"Shift+Y",action:e.rotateY,repeat:null,coordMode:3},{key:"Z",action:e.rotateZ,repeat:null,coordMode:3},{key:"Shift+Z",action:e.rotateZ,repeat:null,coordMode:3},{key:"H",action:e.molHideHydrogens,coordMode:3},{key:"1",action:e.molDisplayTypeSkeletal,coordMode:2},{key:"1",action:e.molDisplayTypeCondensed,coordMode:2},{key:"1",action:e.molDisplayTypeWire,coordMode:3},{key:"2",action:e.molDisplayTypeSticks,coordMode:3},{key:"3",action:e.molDisplayTypeBallStick,coordMode:3},{key:"4",action:e.molDisplayTypeSpaceFill,coordMode:3}])}}),d.ChemWidget.ActionOnViewer=Class.create(d.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionOnViewer",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},doUpdate:function(){var e=this.getDisplayer();this.setEnabled(e&&e.getChemObj()&&e.getChemObjLoaded()&&e.getEnabled())},getViewer:function(){var e=this.getDisplayer();return e instanceof d.ChemWidget.Viewer?e:null}}),d.ChemWidget.ActionViewerRotateBase=Class.create(d.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r]),this.setDelta(2*Math.PI/180)},initProperties:function(){this.defineProp("delta",{dataType:DataType.FLOAT})},isShiftModified:function(e){return e&&e.getShiftKey()}}),d.ChemWidget.ActionViewerRotateBase2D=Class.create(d.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase2D",doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getViewer(),t=e&&e.getRenderType()===d.Render.RendererType.R2D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t)}}),d.ChemWidget.ActionViewerRotateBase3D=Class.create(d.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase3D",doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getViewer(),t=e&&e.getRenderType()===d.Render.RendererType.R3D;this.setDisplayed(t).setEnabled(this.getEnabled()&&t)}}),d.ChemWidget.ActionViewerRotateLeft=Class.create(d.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateLeft",HTML_CLASSNAME:a.ACTION_ROTATE_LEFT,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_ROTATELEFT"),d.$L("ChemWidgetTexts.HINT_ROTATELEFT")])},doExecute:function(e,t){var r=this.getDelta();this.getViewer().rotate2DBy(r)}}),d.ChemWidget.ActionViewerRotateRight=Class.create(d.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateRight",HTML_CLASSNAME:a.ACTION_ROTATE_RIGHT,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_ROTATERIGHT"),d.$L("ChemWidgetTexts.HINT_ROTATERIGHT")])},doExecute:function(e,t){var r=-this.getDelta();this.getViewer().rotate2DBy(r)}}),d.ChemWidget.ActionViewerRotateX=Class.create(d.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateX",HTML_CLASSNAME:a.ACTION_ROTATE_X,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_ROTATEX"),d.$L("ChemWidgetTexts.HINT_ROTATEX")])},doExecute:function(e,t){var r=this.isShiftModified(t),n=-this.getDelta();r&&(n=-n),this.getViewer().rotate3DBy(n,0,0)}}),d.ChemWidget.ActionViewerRotateY=Class.create(d.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateY",HTML_CLASSNAME:a.ACTION_ROTATE_Y,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_ROTATEY"),d.$L("ChemWidgetTexts.HINT_ROTATEY")])},doExecute:function(e,t){var r=this.isShiftModified(t),n=-this.getDelta();r&&(n=-n),this.getViewer().rotate3DBy(0,n,0)}}),d.ChemWidget.ActionViewerRotateZ=Class.create(d.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateZ",HTML_CLASSNAME:a.ACTION_ROTATE_Z,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_ROTATEZ"),d.$L("ChemWidgetTexts.HINT_ROTATEZ")])},doExecute:function(e,t){var r=this.isShiftModified(t),n=-this.getDelta();r&&(n=-n),this.getViewer().rotate3DBy(0,0,n)}}),d.ChemWidget.ActionViewerChangeMolDisplayTypeStub=Class.create(d.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub",initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_MOL_DISPLAY_TYPE"),d.$L("ChemWidgetTexts.HINT_MOL_DISPLAY_TYPE")])},doExecute:function(e){}}),d.ChemWidget.ActionViewerEdit=Class.create(d.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerEdit",HTML_CLASSNAME:a.ACTION_VIEWER_EDIT,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_OPENEDITOR"),d.$L("ChemWidgetTexts.HINT_OPENEDITOR")])},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getViewer();this.setEnabled(e&&e.getAllowEditing()&&e.getEnabled()),this.setDisplayed(e&&e.getEnableEdit())},doExecute:function(e){this.getViewer().openEditor(e)}}),d.ChemWidget.Viewer.rotate2DActionClasses=[n.ActionViewerRotateLeft,n.ActionViewerRotateRight],d.ChemWidget.Viewer.rotate3DActionClasses=[n.ActionViewerRotateX,n.ActionViewerRotateY,n.ActionViewerRotateZ],d.ChemWidget.Viewer.molDisplayType2DActionClasses=[n.ActionDisplayerChangeMolDisplayTypeSkeletal,n.ActionDisplayerChangeMolDisplayTypeCondensed],d.ChemWidget.Viewer.molDisplayType3DActionClasses=[n.ActionDisplayerChangeMolDisplayTypeWire,n.ActionDisplayerChangeMolDisplayTypeSticks,n.ActionDisplayerChangeMolDisplayTypeBallStick,n.ActionDisplayerChangeMolDisplayTypeSpaceFill],d._registerAfterLoadSysProc((function(){var e=d.ActionManager,t=d.ChemWidget,n=d.ChemWidget.Viewer,i=e.registerNamedActionClass;i(r.loadFile,t.ActionDisplayerLoadFile,n),i(r.loadData,t.ActionDisplayerLoadData,n),i(r.saveData,t.ActionDisplayerSaveFile,n),i(r.clearObjs,t.ActionDisplayerClear,n),i(r.zoomIn,t.ActionDisplayerZoomIn,n),i(r.zoomOut,t.ActionDisplayerZoomOut,n),i(r.rotateLeft,t.ActionViewerRotateLeft,n),i(r.rotateRight,t.ActionViewerRotateRight,n),i(r.rotateX,t.ActionViewerRotateX,n),i(r.rotateY,t.ActionViewerRotateY,n),i(r.rotateZ,t.ActionViewerRotateZ,n),i(r.reset,t.ActionDisplayerReset,n),i(r.molHideHydrogens,t.ActionDisplayerHideHydrogens,n),i(r.molDisplayType,t.ActionViewerChangeMolDisplayTypeStub,n),i(r.copy,t.ActionDisplayerCopy,n),i(r.openEditor,t.ActionViewerEdit,n),i(r.config,d.Widget.ActionOpenConfigWidget,n),i(r.molDisplayTypeCondensed,t.ActionDisplayerChangeMolDisplayTypeCondensed,n),i(r.molDisplayTypeSkeletal,t.ActionDisplayerChangeMolDisplayTypeSkeletal,n),i(r.molDisplayTypeWire,t.ActionDisplayerChangeMolDisplayTypeWire,n),i(r.molDisplayTypeSticks,t.ActionDisplayerChangeMolDisplayTypeSticks,n),i(r.molDisplayTypeBallStick,t.ActionDisplayerChangeMolDisplayTypeBallStick,n),i(r.molDisplayTypeSpaceFill,t.ActionDisplayerChangeMolDisplayTypeSpaceFill,n)}))}(),function(){"use strict";var e=Class.PropertyScope;d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{VIEWER_GRID:"K-Chem-Viewer-Grid"}),d.Widget.HtmlClassNames;var t=d.ChemWidget.HtmlClassNames;d.ChemWidget.ViewerGrid=Class.create(d.Widget.WidgetGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid",initialize:function(e,t,r){this.setPropStoreFieldValue("renderType",t),this.setPropStoreFieldValue("viewerConfigs",r),this.tryApplySuper("initialize",[e])},initProperties:function(){this._shadowedPropPairs=[],this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,setter:null,scope:e.PUBLIC}),this.defineProp("chemObjs",{dataType:DataType.ARRAY,serializable:!1,setter:null,getter:function(){var e=[];return this.each((function(t){e.push(t.getChemObj())})),e}}),this.defineViewerShadowProps(["drawOptions","moleculeDisplayType","zoom","autoSize","enableLoadNewFile","viewerConfigs","allowedMolDisplayTypes","enableEdit","modalEdit","toolButtons","enableToolbar","toolbarPos","toolbarMarginVertical","toolbarMarginHorizontal","toolbarEvokeModes","toolbarRevokeModes","toolbarRevokeTimeout","caption","showCaption","autoCaption","captionPos","enableDirectInteraction","enableTouchInteraction"]),this.defineViewerShadowProps(["viewerPredefinedSetting"],["predefinedSetting"]),this.defineProp("actionLoadData",{dataType:"Kekule.ChemWidget.ActionDisplayerLoadData",serializable:!1,scope:e.PRIVATE,setter:null,getter:function(){var e=this.getPropStoreFieldValue("actionLoadData");return e||(e=new d.ChemWidget.ActionDisplayerLoadData,this.setPropStoreFieldValue("actionLoadData",e)),e}})},defineViewerShadowProps:function(e,t){t||(t=[]);for(var r=0,n=e.length;r<n;++r){var i=e[r],o=t[r]||e[r];this.defineViewerShadowProp(i,o)}},defineViewerShadowProp:function(e,t){t||(t=e);var r=d.ChemWidget.Viewer,n=ClassEx.getPropInfo(r,t);if(n){var i=Object.create(n);i.getter=void 0,i.setter=function(r){this.setPropStoreFieldValue(e,r),this.each((function(e){e.setPropValue(t,r)}))},this.defineProp(e,i),this._shadowedPropPairs.push({prop:e,viewerProp:t})}},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.VIEWER_GRID},createWidget:function(){var e=this.getDocument(),t=new d.ChemWidget.LoadDataDialog(e),r=this;t.openModal((function(n){if(t.isPositiveResult(n)){var i=t.getDataDetails();if(a=t.getChemObj()){var o=r.doCreateNewChildWidget(e,null,a),a=o.loadFromData(i.data,i.mimeType,i.fileName,i.formatId);o.setParent(r)}else i.data&&d.error(d.$L("ErrorMsg.LOAD_CHEMDATA_FAILED"))}}),this.getAddingCell())},doCreateNewChildWidget:function(e,t){var r=new d.ChemWidget.Viewer(e,null,this.getRenderType(),this.getViewerConfigs());return this.doSetShadowedPropValuesToViewer(r),t&&r.setChemObj(t),r},doSetShadowedPropValuesToViewer:function(e){for(var t=0,r=this._shadowedPropPairs.length;t<r;++t){var n=this._shadowedPropPairs[t],i=this.getPropValue(n.prop);void 0!==i&&e.setPropValue(n.viewerProp,i)}},addChemObj:function(e){return this.doCreateNewChildWidget(this.getDocument(),e).setParent(this),this},removeChemObj:function(e){var t=this;return this.each((function(r){r.getChemObj()===e&&t.removeWidget(r,!0)})),this}}),d.ChemWidget.ViewerGrid2D=Class.create(d.ChemWidget.ViewerGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid2D",initialize:function(e,t){this.tryApplySuper("initialize",[e,d.Render.RendererType.R2D,t])}}),d.ChemWidget.ViewerGrid3D=Class.create(d.ChemWidget.ViewerGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid3D",initialize:function(e,t){this.tryApplySuper("initialize",[e,d.Render.RendererType.R3D,t])}})}(),function(){"use strict";var e=Class.PropertyScope,t=d.DomUtils,r=d.ArrayUtils;d.ChemWidget,d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{CHEMOBJSETTER:"K-Chem-Obj-Setter",CHEMOBJSETTER_FLEX_LAYOUT:"K-Chem-Obj-Setter-Flex-Layout",CHEMOBJSETTER_TOOLBAR_AREA:"K-Chem-Obj-Setter-Toolbar-Area",CHEMOBJSETTER_CLIENT:"K-Chem-Obj-Setter-Client",CHEMOBJSETTER_VIEWER:"K-Chem-Obj-Setter-Viewer",CHEMOBJSETTER_TABGROUP:"K-Chem-Obj-Setter-TabGroup",CHEMOBJSETTER_INFOLABEL:"K-Chem-Obj-Setter-InfoLabel",CHEMOBJSETTER_REGION:"K-Chem-Obj-Setter-Region",CHEMOBJSETTER_REGION_LABEL:"K-Chem-Obj-Setter-Region-Label",CHEMOBJSETTER_LINE:"K-Chem-Obj-Setter-Line",CHEMOBJSETTER_CONFIGURATOR:"K-Chem-Obj-Setter-Configurator"});var n=d.Widget.HtmlClassNames,i=d.ChemWidget.HtmlClassNames;d.globalOptions.add("chemWidget.ChemObjInserter",{autoSizeExport:!0,backgroundColor3D:"#000000",exportViewerPredefinedSetting:"basic"}),d.ChemWidget.ChemObjInserter=Class.create(d.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjInserter",DEF_BGCOLOR_2D:"transparent",DEF_BGCOLOR_3D:"#000000",initialize:function(e,t,r,n){this._configAction=new d.Widget.ActionOpenConfigWidget(this),this._toolbarParentElem=null,this._infoLabel=null,this._infoLabelTemplate=d.$L("ChemWidgetTexts.CAPTION_WIDTH_HEIGHT"),this.tryApplySuper("initialize",[e]);var i=this.getViewer();r&&i.setRenderType(r),n&&i.setViewerConfigs(n),this.adjustChildrenSizes()},doFinalize:function(){this._configAction&&this._configAction.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("viewer");return e||(e=this.createViewer(),this.setPropStoreFieldValue("viewer",e)),e}}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:e.PUBLIC,getter:function(){var e=this.getPropStoreFieldValue("viewer");return e?e.getChemObj():this.getPropStoreFieldValue("chemObj")},setter:function(e){this.setPropStoreFieldValue("chemObj",e),this.getViewer()&&this.getViewer().setChemObj(e)}}),this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,scope:e.PUBLIC,setter:function(e){if(e!==this.getRenderType()){this.setPropStoreFieldValue("renderType",e),this.getViewer().setRenderType(e);var t=this.getTabs();if(t){var r=e===d.Render.RendererType.R3D?1:0;t.getChildWidgets()[r].setChecked(!0)}}}}),this.defineProp("is3D",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getRenderType()===d.Render.RendererType.R3D},setter:function(e){this.setRenderType(e?d.Render.RendererType.R3D:d.Render.RendererType.R2D)}}),this.defineProp("showInfo",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._infoLabel&&d.StyleUtils.isShown(this._infoLabel)},setter:function(e){this._infoLabel&&d.StyleUtils.setDisplay(this._infoLabel,e)}}),this.defineProp("autoSizeExport",{dataType:DataType.BOOL}),this.defineProp("backgroundColor2D",{dataType:DataType.STRING,setter:function(e){this.setPropStoreFieldValue("backgroundColor2D",e),this.backgroundColorChange()}}),this.defineProp("backgroundColor3D",{dataType:DataType.STRING,setter:function(e){this.setPropStoreFieldValue("backgroundColor3D",e),this.backgroundColorChange()}}),this.defineProp("exportViewerPredefinedSetting",{dataType:DataType.STRING}),this.defineProp("clientPanel",{dataType:DataType.OBJECT,serializable:!1,setter:!1,scope:e.PRIVATE}),this.defineProp("tabs",{dataType:DataType.OBJECT,serializable:!1,setter:!1,scope:e.PRIVATE}),this._defineViewerDelegatedProp("chemObjLoaded"),this._defineViewerDelegatedProp("renderConfigs"),this._defineViewerDelegatedProp("drawOptions"),this._defineViewerDelegatedProp("allowCoordBorrow"),this._defineViewerDelegatedProp("autoSize"),this._defineViewerDelegatedProp("autofit"),this._defineViewerDelegatedProp("viewerConfigs"),this._defineViewerDelegatedProp("allowedMolDisplayTypes"),this._defineViewerDelegatedProp("enableEdit"),this._defineViewerDelegatedProp("enableEditFromVoid"),this._defineViewerDelegatedProp("modalEdit"),this._defineViewerDelegatedProp("restrainEditorWithCurrObj"),this._defineViewerDelegatedProp("editorProperties"),this._defineViewerDelegatedProp("toolButtons"),this._defineViewerDelegatedProp("enableDirectInteraction"),this._defineViewerDelegatedProp("enableTouchInteraction")},initPropValues:function(){this.tryApplySuper("initPropValues");var e=Object.extend({autoSizeExport:!0,backgroundColor3D:this.DEF_BGCOLOR_3D,exportViewerPredefinedSetting:"basic"},d.globalOptions.get("chemWidget.ChemObjInserter"),{});this.setAutoSizeExport(e.autoSizeExport),this.setBackgroundColor3D(e.backgroundColor3D),this.setExportViewerPredefinedSetting(e.exportViewerPredefinedSetting)},_defineViewerDelegatedProp:function(e,t){t||(t=e);var r=ClassEx.getPropInfo(d.ChemWidget.Viewer,t),n=Object.create(r);return n.getter=null,n.setter=null,r.getter&&(n.getter=function(){return this.getViewer().getPropValue(t)}),r.setter&&(n.setter=function(e){this.getViewer().setPropValue(t,e)}),this.defineProp(e,n)},loadPredefinedResDataToProp:function(e,t,r){if("chemObj"===e)if(r){var n=d.IO.loadTypedData(t.data,t.resType,t.resUri);this.setChemObj(n)}else d.error(d.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+t.resUri||"")},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+i.CHEMOBJSETTER;return this._isUsingFlexLayout()&&(e+=" "+i.CHEMOBJSETTER_FLEX_LAYOUT),e},_isUsingFlexLayout:function(){return d.BrowserFeature.cssFlex},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]);this.createToolbarParent(t);var n=new d.Widget.Panel(this);return n.addClassName(i.CHEMOBJSETTER_CLIENT),n.setUseCornerDecoration(!1),n.appendToElem(t),this.setPropStoreFieldValue("clientPanel",n),this.createViewer(n.getCoreElement()),this.createInfoLabel(t,this.getViewer()),this.createTabs(t),r},elementBound:function(e){this.setObserveElemResize(!0)},doResize:function(){this.adjustChildrenSizes()},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),this.adjustChildrenSizes()},getResizerElement:function(){return this.getClientPanel()?this.getClientPanel().getCoreElement():this.getCoreElement()},getBackgroundColor:function(e){var t=e===d.Render.RendererType.R3D?this.getBackgroundColor3D():this.getBackgroundColor2D();return t===d.Widget.ColorPicker.SpecialColors.TRANSPARENT&&(t="transparent"),t},setBackgroundColor:function(e,t){if(t===d.Render.RendererType.R3D){var r=e||this.DEF_BGCOLOR_3D;this.setBackgroundColor3D(r)}else r=e||this.DEF_BGCOLOR_2D,this.setBackgroundColor2D(r)},backgroundColorChange:function(){var e=this.getBackgroundColor(this.getRenderType()),t=this.getPropStoreFieldValue("viewer");t&&t.setBackgroundColor(e)},adjustChildrenSizes:function(){if(this._isUsingFlexLayout());else{this.getPageRect();var e=d.HtmlElementUtils.getElemPageRect(this._toolbarParentElem),t=this.getTabs(),r=(t&&t.getPageRect()).top-e.bottom;this.getClientPanel().setHeight(r+"px")}this.getViewer().resized()},createViewer:function(e){var t=d.ChemWidget.ComponentWidgetNames,o=d.Widget.EvokeMode,a=new d.ChemWidget.Viewer(this,null,this.getRenderType());a.addClassName([n.DYN_CREATED,i.CHEMOBJSETTER_VIEWER]),a.setRenderType(d.Render.RendererType.R2D),a.setEnableEdit(!0),a.setEnableEditFromVoid(!0),a.setRestrainEditorWithCurrObj(!1),a.setEnableToolbar(!0),a.setPredefinedSetting("fullFunc");var s=r.exclude(a.getDefaultToolBarButtons(),t.config);return s.push({action:this._configAction}),s.splice(2,0,t.clearObjs),a.setToolbarParentElem(this._toolbarParentElem),a.setToolButtons(s),a.setToolbarPos(d.Widget.Position.BOTTOM),a.setToolbarMarginVertical(-2),a.setToolbarEvokeModes([o.ALWAYS]),a.addEventListener("resize",this.updateInfoLabel,this),a.appendToElem(e),a.setChemObj(this.getChemObj()),this.setPropStoreFieldValue("viewer",a),this.backgroundColorChange(),a},createToolbarParent:function(e){var t=e.ownerDocument.createElement("div");return t.className=i.CHEMOBJSETTER_TOOLBAR_AREA,e.appendChild(t),this._toolbarParentElem=t,t},createTabs:function(e){var t=[d.$L("ChemWidgetTexts.CAPTION_2D"),d.$L("ChemWidgetTexts.CAPTION_3D")],r=this.getRenderType()===d.Render.RendererType.R3D?1:0,o=new d.Widget.TabButtonGroup(this);o.setTabButtonPosition(d.Widget.Position.BOTTOM),o.addClassName([n.DYN_CREATED,i.CHEMOBJSETTER_TABGROUP]);for(var a=[],s=0,l=t.length;s<l;++s){var u=new d.Widget.RadioButton(o);u.setText(t[s]),s===r&&u.setChecked(!0),a.push(u)}return o.addEventListener("switch",(function(e){var t=e.button,r=1===a.indexOf(t)?d.Render.RendererType.R3D:d.Render.RendererType.R2D;this.setRenderType(r),this.backgroundColorChange()}),this),o.appendToElem(e),this.setPropStoreFieldValue("tabs",o),o},createInfoLabel:function(e,t){var r=this.getDocument().createElement("div");return r.className=n.DYN_CREATED+" "+i.CHEMOBJSETTER_INFOLABEL,t.getElement().appendChild(r),this._infoLabel=r,r},updateInfoLabel:function(){var e=this.getViewer();if(e&&this._infoLabel){var t=e.getContextDimension(),r=t?this._infoLabelTemplate.format(Math.round(t.width),Math.round(t.height)):"";d.DomUtils.setElementText(this._infoLabel,r)}},getContextDimension:function(){return this.getViewer().getContextDimension()},setContextDimension:function(e){var t=this.getContextDimension(),r=e.width-t.width,n=e.height-t.height,i=this.getDimension(),o={width:i.width+r,height:i.height+n};return this.setDimension(o.width,o.height),this},exportToDataUri:function(e,t){return this.getViewer().exportToDataUri(e,t)},exportDetails:function(e,t){this.getAutoSizeExport()&&this.setAutoSize(!0);var r=this.getViewer().getActualDrawOptions(),n=this.getViewer().getContextDimension(),i={dataUri:this.exportToDataUri(e,t),drawOptions:r,drawOptionsJson:JSON.stringify(r),chemObj:this.getChemObj(),chemObjJson:d.IO.saveMimeData(this.getChemObj(),"chemical/x-kekule-json"),autoSize:this.getAutoSizeExport(),autofit:this.getAutofit(),width:Math.round(n.width),height:Math.round(n.height),renderType:this.getRenderType()||d.Render.RendererType.R2D,backgroundColor:this.getBackgroundColor(this.getRenderType()),predefinedSetting:this.getExportViewerPredefinedSetting()};if(this.getAutoSizeExport()){this.setAutoSize(!1);var o=this.getViewer().getElement();o.style.width="auto",o.style.height="auto",this.getViewer().resized()}return i},getExportImgElemAttributes:function(e,t){var r=this.exportDetails(e,t),n="width:"+r.width+"px; height:"+r.height+"px",i={src:r.dataUri,style:n,width:r.width,height:r.height,"data-kekule-widget":"Kekule.ChemWidget.Viewer","data-render-type":r.renderType,"data-chem-obj":r.chemObjJson,"data-draw-options":r.drawOptionsJson,"data-predefined-setting":r.predefinedSetting};return d.ObjUtils.notUnset(r.autoSize)&&(i["data-auto-size"]=r.autoSize),d.ObjUtils.notUnset(r.autofit)&&(i["data-auto-fit"]=r.autofit),d.ObjUtils.notUnset(r.backgroundColor)&&(i["data-background-color"]=r.backgroundColor),i},createExportImgElement:function(e,t,r){var n=e.createElement("img"),i=this.getExportImgElemAttributes(t,r);return d.DomUtils.setElemAttributes(n,i),n},importChemObjWithDetails:function(e,t){return this.setChemObj(e),this.setRenderType(t.renderType||d.Render.RendererType.R2D),d.ObjUtils.notUnset(t.autoSize)&&this.setAutoSizeExport(!!t.autoSize),d.ObjUtils.notUnset(t.autofit)&&this.setAutofit(!!t.autofit),!t.width||!t.height||t.autoSize&&t.renderType!==d.Render.RendererType.R3D||this.setContextDimension({width:t.width,height:t.height}),t.drawOptions&&this.getViewer().setDrawOptions(t.drawOptions),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,this.getRenderType()),this},importFromElemAttribs:function(e){e.width=DataType.JsonUtility.parse(e.width),e.height=DataType.JsonUtility.parse(e.height);var t=e["data-chem-obj"],r=t?d.IO.loadMimeData(t,"chemical/x-kekule-json"):null;return e["data-render-type"]&&(e.renderType=DataType.JsonUtility.parse(e["data-render-type"])),e["data-draw-options"]&&(e.drawOptions=DataType.JsonUtility.parse(e["data-draw-options"])),e["data-auto-size"]&&(e.autoSize=DataType.JsonUtility.parse(e["data-auto-size"])),e["data-autofit"]&&(e.autofit=DataType.JsonUtility.parse(e["data-autofit"])),e["data-background-color"]&&(e.backgroundColor=e["data-background-color"]),this.importChemObjWithDetails(r,e)},importFromElem:function(e){var t=d.HtmlElementUtils.getElemPageRect(e),r=d.DomUtils.fetchAttributeValuesToJson(e);return r.width||(r.width=t.width),r.height||(r.height=t.height),this.importFromElemAttribs(r)}}),d.ChemWidget.ChemObjInserter.Configurator=Class.create(d.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjInserter.Configurator",initialize:function(e){this._checkBoxAutoSize=null,this._checkBoxAutofit=null,this._checkBoxShowInfo=null,this._textBoxWidth=null,this._textBoxHeight=null,this._colorPicker=null,this.tryApplySuper("initialize",[e]),this.addEventListener("valueChange",(function(e){this.saveConfigValues()}),this)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoUpdate(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.CHEMOBJSETTER_CONFIGURATOR},doCreateSubElements:function(e,r){var o;(l=e.createElement("div")).className=i.CHEMOBJSETTER_REGION,(s=new d.Widget.CheckBox(this)).setText(d.$L("ChemWidgetTexts.CAPTION_AUTOSIZE")),s.addClassName(i.CHEMOBJSETTER_LINE),s.appendToElem(l),this._checkBoxAutoSize=s,(o=e.createElement("span")).className=n.PART_ASSOC_TEXT_CONTENT,t.setElementText(o,d.$L("ChemWidgetTexts.HINT_AUTOSIZE")),l.appendChild(o),(s=new d.Widget.CheckBox(this)).setText(d.$L("ChemWidgetTexts.CAPTION_AUTOFIT")),s.addClassName(i.CHEMOBJSETTER_LINE),s.appendToElem(l),this._checkBoxAutofit=s,(o=e.createElement("span")).className=n.PART_ASSOC_TEXT_CONTENT,t.setElementText(o,d.$L("ChemWidgetTexts.HINT_AUTOFIT")),l.appendChild(o),r.appendChild(l),(l=e.createElement("div")).className=i.CHEMOBJSETTER_REGION,(u=e.createElement("label")).className=i.CHEMOBJSETTER_REGION_LABEL,t.setElementText(u,d.$L("ChemWidgetTexts.CAPTION_LABEL_SIZE")),l.appendChild(u),l.appendChild(e.createElement("br")),(a=new d.Widget.TextBox(this)).setPlaceholder(d.$L("ChemWidgetTexts.PLACEHOLDER_WIDTH")),a.appendToElem(l),this._textBoxWidth=a;var a,s,l,u=e.createElement("span");t.setElementText(u,"\xd7"),l.appendChild(u),(a=new d.Widget.TextBox(this)).setPlaceholder(d.$L("ChemWidgetTexts.PLACEHOLDER_HEIGHT")),a.appendToElem(l),this._textBoxHeight=a,(s=new d.Widget.CheckBox(this)).setText(d.$L("ChemWidgetTexts.CAPTION_SHOWSIZEINFO")),s.appendToElem(l),this._checkBoxShowInfo=s,r.appendChild(l),(l=e.createElement("div")).className=i.CHEMOBJSETTER_REGION,(u=e.createElement("label")).className=i.CHEMOBJSETTER_REGION_LABEL,t.setElementText(u,d.$L("ChemWidgetTexts.CAPTION_BACKGROUND_COLOR")),l.appendChild(u),l.appendChild(e.createElement("br"));var c=new d.Widget.ColorPicker(this);c.setSpecialColors([d.Widget.ColorPicker.SpecialColors.TRANSPARENT]),c.appendToElem(l),this._colorPicker=c,r.appendChild(l)},loadConfigValues:function(){this.tryApplySuper("loadConfigValues");var e=this.getWidget();if(e){var t=!e.getIs3D();this._checkBoxAutoSize.setChecked(t&&e.getAutoSizeExport()),this._checkBoxAutoSize.setEnabled(t),this._checkBoxAutofit.setChecked(t&&e.getAutofit()),this._checkBoxAutofit.setEnabled(t),this._checkBoxShowInfo.setChecked(e.getShowInfo());var r=e.getContextDimension();this._textBoxWidth.setText(Math.round(r.width)),this._textBoxHeight.setText(Math.round(r.height));var n=t?e.getBackgroundColor2D():e.getBackgroundColor3D();this._colorPicker.setValue(n||d.Widget.ColorPicker.SpecialColors.TRANSPARENT)}},saveConfigValues:function(){this.tryApplySuper("saveConfigValues");var e=this.getWidget();if(e){e.getIs3D()?e.setBackgroundColor3D(this._colorPicker.getValue()):(e.setAutoSizeExport(this._checkBoxAutoSize.getChecked()),e.setAutofit(this._checkBoxAutofit.getChecked()),e.setBackgroundColor2D(this._colorPicker.getValue())),e.setShowInfo(this._checkBoxShowInfo.getChecked());var t={width:parseInt(this._textBoxWidth.getText()),height:parseInt(this._textBoxHeight.getText())};e.setContextDimension(t),e.invokeEvent("configSave")}}})}(),function(){var e=d.CoordMode,t=d.ArrayUtils;ClassEx.extend(d.ChemObject,{isStandalone:function(){return!this.getIsAttachedToParent()},getStandaloneAncestor:function(){for(var e=this;e.isStandalone&&!e.isStandalone()&&e.getParent&&e.getParent();)e=e.getParent();return e},getCascadeDeleteObjs:function(){return[]},cascadeRemove:function(e){var t=this.getParent();t&&t.notifyBeforeCascadeRemove&&t.notifyBeforeCascadeRemove(this),e?this.finalize():this.removeSelf(),t&&t.notifyAfterCascadeRemove&&t.notifyAfterCascadeRemove(this)},notifyBeforeCascadeRemove:function(e,t){},notifyAfterCascadeRemove:function(e,t){!this.getKeepEmptyEvenOnCascadeRemove()&&this.isEmpty()&&this.cascadeRemove(t)},isCoordDependent:function(){return!1},getCoordDependentObjects:function(){var e=[];return this.isCoordDependent()||e.push(this),e},getCoordDeterminateObjects:function(){var e=[];if(this.getAttachedMarkers)for(var r=this.getAttachedMarkers()||[],n=0,i=r.length;n<i;++n)e=e.concat(r[n].getCoordDependentObjects());var o=this.getAttachedCoordStickNodes();for(n=0,i=o.length;n<i;++n){var a=o[n];t.pushUnique(e,a),t.pushUnique(e,a.getCoordDeterminateObjects())}return e},getAllContainingConnectors:function(){return[]},getConstraintManipulationBaseObj:function(){if(this.isAttachedMarker&&this.isAttachedMarker()){var e=this.getParent();return e instanceof d.StructureFragment?null:e}return null},transformAbsCoordByMatrix:function(e,t,r,n,i,o){if(this.getChildCount&&(n||d.ObjUtils.isUnset(n)))for(var a=0,s=this.getChildCount();a<s;++a){var l=this.getChildAt(a);l&&l.transformAbsCoordByMatrix&&l.transformAbsCoordByMatrix(t,t,r,n,i,!0)}var u=r===d.CoordMode.COORD3D?d.CoordUtils.transform3DByMatrix:d.CoordUtils.transform2DByMatrix;if(o){if(this.getCoordOfMode&&this.setCoordOfMode){var c=u(this.getCoordOfMode(r,i),e);this.setCoordOfMode(c,r)}}else this.getAbsCoordOfMode&&this.setAbsCoordOfMode&&(c=u(this.getAbsCoordOfMode(r,i),e),this.setAbsCoordOfMode(c,r))},scaleSize:function(e,t,r,n){if(this.getSizeOfMode&&this.setSizeOfMode){var i=this.getSizeOfMode(t,n),o=d.CoordUtils.multiply(i,e);this.setSizeOfMode(o,t)}if(this.getChildCount&&(r||d.ObjUtils.isUnset(r)))for(var a=0,s=this.getChildCount();a<s;++a){var l=this.getChildAt(a);l&&l.scaleSize&&l.scaleSize(e,t,r,n)}}}),ClassEx.extendMethod(d.ChemObject,"_attachedMarkerAdded",(function(e,t){var r=e(t);return t&&t.setIsAttachedToParent(!0),r})),ClassEx.extendMethod(d.ChemObject,"_attachedMarkerRemoved",(function(e,t){var r=e(t);return t&&t.setIsAttachedToParent(!1),r})),ClassEx.defineProps(d.ChemObject,[{name:"keepEmptyEvenOnCascadeRemove",dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC},{name:"isAttachedToParent",dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}]),ClassEx.extend(d.ChemStructureObject,{getCascadeDeleteObjs:function(){for(var e=this.tryApplySuper("getCascadeDeleteObjs"),t=this.getLinkedConnectors?this.getLinkedConnectors():[],r=0,n=t.length;r<n;++r){var i=t[r];if(i.getConnectedObjs().length<=2){d.ArrayUtils.pushUnique(e,i);var o=i.getCascadeDeleteObjs();d.ArrayUtils.pushUnique(e,o)}}return e},isStandalone:function(){return!1},getCoordDeterminateObjects:function(){for(var e=this.tryApplySuper("getCoordDeterminateObjects"),r=this.getLinkedConnectors(),n=0,i=r.length;n<i;++n){var o=r[n];t.pushUnique(e,o),t.pushUnique(e,o.getCoordDeterminateObjects())}return e}}),ClassEx.extend(d.BaseStructureNode,{getCascadeDeleteObjs:function(){return this.tryApplySuper("getCascadeDeleteObjs")},isCoordDependent:function(){return!1},getCoordDependentObjects:function(){return this.tryApplySuper("getCoordDependentObjects")},move:function(e,t){var r=this.getCoordOfMode(t),n=d.CoordUtils.add(r,e);return this.setCoordOfMode(n,t),n},move2D:function(t){return this.move(t,e.COORD2D)},move3D:function(t){return this.move(t,e.COORD3D)}}),ClassEx.extend(d.BaseStructureConnector,{getCascadeDeleteObjs:function(){for(var e=this.tryApplySuper("getCascadeDeleteObjs"),t=this.getConnectedObjs(),r=0,n=t.length;r<n;++r){var i=t[r];i instanceof d.BaseStructureNode&&i.getLinkedConnectors().length<=1&&d.ArrayUtils.pushUnique(e,i)}return e},isCoordDependent:function(){return!0},getCoordDependentObjects:function(){for(var e=this.tryApplySuper("getCoordDependentObjects"),r=this.getConnectedObjs(),n=0,i=r.length;n<i;++n){var o=r[n];if(o.isExposed)var a=o.isExposed()?o:o.getExposedAncestor();else a=o;a&&t.pushUnique(e,a.getCoordDependentObjects())}return e},move:function(e,t){for(var r=0,n=this.getConnectedObjCount();r<n;++r){var i=this.getConnectedObjAt(r);i.move&&i.move(e,t)}},move2D:function(t){return this.move(t,e.COORD2D)},move3D:function(t){return this.move(t,e.COORD3D)},setAbsBaseCoord:function(e,t){var r=this.getAbsBaseCoord(),n=d.CoordUtils.substract(e,r);this.move(n,t)},setAbsBaseCoord2D:function(e){this.setAbsCoordOfMode(e,d.CoordMode.COORD2D)},setAbsBaseCoord3D:function(e){this.setAbsCoordOfMode(e,d.CoordMode.COORD3D)}}),ClassEx.extend(d.ChemStructureNode,{getConstraintManipulationBaseObj:function(){var e=this.getLinkedObjs();return 1===e.length?e[0]:this.tryApplySuper("getConstraintManipulationBaseObj")}}),ClassEx.extend(d.Glyph.PathGlyphNode,{getCascadeDeleteObjs:function(){return[this.getParent()]},getConstraintManipulationBaseObj:function(){var e=this.getLinkedObjs();return 1===e.length?e[0]:this.tryApplySuper("getConstraintManipulationBaseObj")}}),ClassEx.extend(d.Glyph.PathGlyphConnectorControlNode,{getCoordDeterminateObjects:function(){var e=this.tryApplySuper("getCoordDeterminateObjects"),t=this.getParentConnector();return t&&(e=(e||[]).concat([t])),e}}),ClassEx.extend(d.Glyph.PathGlyphConnector,{getCascadeDeleteObjs:function(){return[this.getParent()]},getCoordDependentObjects:function(){var e=this.tryApplySuper("getCoordDependentObjects"),t=this.getControlPoints&&this.getControlPoints();return t&&t.length&&(e=(e||[]).concat(t)),e}}),ClassEx.extend(d.StructureFragment,{isStandalone:function(){return!this.getCrossConnectors().length},notifyBeforeCascadeRemove:function(e,t){var r=this._getObjsNeedToBeCascadeRemoved(e);if(r&&r.length)for(var n=r.length-1;n>=0;--n){var i=r[n];t?i.finalize():i.removeSelf()}this.tryApplySuper("notifyBeforeCascadeRemove",[e,t])},getCoordDependentObjects:function(){if(this.isExpanded&&!this.isExpanded())return this.tryApplySuper("getCoordDependentObjects");if(this.hasCtab()){for(var e=[],r=this.getChildCount(),n=0;n<r;++n){var i=this.getChildAt(n);t.pushUnique(e,i.getCoordDependentObjects())}return e}return this.tryApplySuper("getCoordDependentObjects")},transformAbsCoordByMatrix:function(e,t,r,n,i,o){if(n||d.ObjUtils.isUnset(n))for(var a=0,s=this.getNodeCount();a<s;++a){var l=this.getNodeAt(a);l&&l.transformAbsCoordByMatrix&&l.transformAbsCoordByMatrix(t,t,r,n,i,!0)}this.tryApplySuper("transformAbsCoordByMatrix",[e,t,r,!1,i,o])}}),ClassEx.extend(d.Glyph.Base,{isStandalone:function(){return this.tryApplySuper("isStandalone")}}),ClassEx.extend(d.Glyph.PathGlyph,{getCoordDependentObjects:function(){for(var e=[],t=this.getNodeCount(),r=0;r<t;++r){var n=this.getNodeAt(r);e.push(n)}return e},transformAbsCoordByMatrix:function(e,t,r,n,i,o){if(n||d.ObjUtils.isUnset(n))for(var a=0,s=this.getNodeCount();a<s;++a){var l=this.getNodeAt(a);l&&l.transformAbsCoordByMatrix&&l.transformAbsCoordByMatrix(t,t,r,n,i,!0)}this.tryApplySuper("transformAbsCoordByMatrix",[e,t,r,!1,i,o])}}),ClassEx.extend(d.Glyph.BaseArc,{ownerChanged:function(e,t){var r=!t&&e,n=this.tryApplySuper("ownerChanged",[e,t]);return r&&this.getIsEditing()&&this._autoAdjustClass(),n},_getChemStickTargets:function(){for(var e=[],t=0,r=this.getNodeCount();t<r;++t){var n=this.getNodeAt(t).getCoordStickTarget();this._isValidChemNodeOrConnectorStickTarget(n)&&e.push(n)}return e},notifyChildCoordStickTargetChanged:function(e,t,r){this._autoAdjustClass()},_autoAdjustClass:function(){this.getIsEditing()&&(this._getChemStickTargets().length>=2?this instanceof d.Glyph.ElectronPushingArrow||this.__changeClass__(d.Glyph.ElectronPushingArrow):this instanceof d.Glyph.ElectronPushingArrow&&this.__changeClass__(d.Glyph.Arc))}}),ClassEx.extendMethod(d.Glyph.BaseArc,"createDefaultStructure",(function(e,t,r){var n=e(t,r);return this._autoAdjustClass(),n})),ClassEx.extend(d.Glyph.BaseTwinArc,{ownerChanged:function(e,t){var r=!t&&e,n=this.tryApplySuper("ownerChanged",[e,t]);return r&&this.getIsEditing()&&this._autoAdjustClass(),n},_getChemStickTargets:function(){for(var e=[],t=this._getArrowStartingNodes(),r=0,n=t.length;r<n;++r){var i=t[r].getCoordStickTarget();this._isValidChemNodeOrConnectorStickTarget(i)&&e.push(i)}return e},notifyChildCoordStickTargetChanged:function(e,t,r){this._autoAdjustClass()},_autoAdjustClass:function(){this.getIsEditing()&&(this._getChemStickTargets().length>=2?this instanceof d.Glyph.BondFormingElectronPushingArrow||(this.__changeClass__(d.Glyph.BondFormingElectronPushingArrow),this.getElectronCount()||this.setElectronCount(1)):this instanceof d.Glyph.BondFormingElectronPushingArrow&&this.__changeClass__(d.Glyph.TwinArc))}})}(),function(){"use strict";var e=d.ObjUtils,t=d.ArrayUtils,r=d.HtmlElementUtils,n=d.CoordUtils,i=d.Widget.HtmlClassNames,o=d.ChemWidget.HtmlClassNames;d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{EDITOR:"K-Chem-Editor",EDITOR_CLIENT:"K-Chem-Editor-Client",EDITOR_UIEVENT_RECEIVER:"K-Chem-Editor-UiEvent-Receiver",EDITOR2D:"K-Chem-Editor2D",EDITOR3D:"K-Chem-Editor3D"}),d.ChemWidget.Editor={},d.Editor=d.ChemWidget.Editor,d.Editor.CoordSys=d.Render.CoordSystem,d.Editor.BoxRegion={OUTSIDE:0,CORNER_TL:1,CORNER_TR:2,CORNER_BL:3,CORNER_BR:4,EDGE_TOP:11,EDGE_LEFT:12,EDGE_BOTTOM:13,EDGE_RIGHT:14,INSIDE:20},d.Editor.SelectMode={RECT:0,POLYGON:1,POLYLINE:2,ANCESTOR:10},d.globalOptions.add("chemWidget.editor",{enableIssueCheck:!0,enableCreateNewDoc:!0,enableOperHistory:!0,enableOperContext:!0,initOnNewDoc:!0,enableSelect:!0,enableMove:!0,enableResize:!0,enableAspectRatioLockedResize:!0,enableRotate:!0,enableGesture:!0}),d.globalOptions.add("chemWidget.editor.issueChecker",{enableAutoIssueCheck:!0,enableAutoScrollToActiveIssue:!0,enableIssueMarkerHint:!0,durationLimit:50}),d.Editor.BaseEditor=Class.create(d.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.Editor.BaseEditor",BINDABLE_TAG_NAMES:["div","span"],OBSERVING_GESTURES:["rotate","rotatestart","rotatemove","rotateend","rotatecancel","pinch","pinchstart","pinchmove","pinchend","pinchcancel","pinchin","pinchout"],initialize:function(e,t,r,n){this._objSelectFlag=0,this._objectUpdateFlag=0,this._objectManipulateFlag=0,this._uiMarkerUpdateFlag=0,this._updatedObjectDetails=[],this._operatingObjs=[],this._operatingRenderers=[],this._initialRenderTransformParams=null,this._objChanged=!1,this._lengthCaches={};var i=d.globalOptions.get;this.setPropStoreFieldValue("enableIssueCheck",i("chemWidget.editor.enableIssueCheck",!0)),this.setPropStoreFieldValue("enableCreateNewDoc",i("chemWidget.editor.enableCreateNewDoc",!0)),this.setPropStoreFieldValue("enableOperHistory",i("chemWidget.editor.enableOperHistory",!0)),this.setPropStoreFieldValue("enableOperContext",i("chemWidget.editor.enableOperContext",!0)),this.setPropStoreFieldValue("initOnNewDoc",i("chemWidget.editor.initOnNewDoc",!0)),this.tryApplySuper("initialize",[e,t,r]),!this.getChemObj()&&this.getInitOnNewDoc()&&this.getEnableCreateNewDoc()&&this.newDoc(),this.setPropStoreFieldValue("editorConfigs",n||this.createDefaultConfigs()),this.setEnableGesture(i("chemWidget.editor.enableGesture",!0))},initProperties:function(){this.defineProp("editorConfigs",{dataType:"Kekule.Editor.BaseEditorConfigs",serializable:!1,getter:function(){return this.getDisplayerConfigs()},setter:function(e){return this.setDisplayerConfigs(e)}}),this.defineProp("defBondLength",{dataType:DataType.FLOAT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("defBondLength");return e||(e=this.getEditorConfigs().getStructureConfigs().getDefBondLength()),e}}),this.defineProp("defBondScreenLength",{dataType:DataType.FLOAT,serializable:!1,setter:null,getter:function(){var e=this._lengthCaches.defBondScreenLength;if(e)return e;var t=this.getDefBondLength()||0,r=this.translateDistance(t,d.Render.CoordSystem.CHEM,d.Render.CoordSystem.SCREEN);return this._lengthCaches.defBondScreenLength=r,r}}),this.defineProp("currBoundInflation",{dataType:DataType.NUMBER,serializable:!1,setter:null,getter:function(){var e=this.getCurrPointerType();return this.getInteractionBoundInflation(e)}}),this.defineProp("currPointerType",{dataType:DataType.STRING,serializable:!1}),this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("operHistory");return e||(e=new d.OperationHistory,this.setPropStoreFieldValue("operHistory",e),e.addEventListener("push",this.reactOperHistoryPush,this),e.addEventListener("pop",this.reactOperHistoryPop,this),e.addEventListener("undo",this.reactOperHistoryUndo,this),e.addEventListener("redo",this.reactOperHistoryRedo,this),e.addEventListener("clear",this.reactOperHistoryClear,this),e.addEventListener("change",this.reactOperHistoryChange,this)),e},setter:null}),this.defineProp("operationsInCurrManipulation",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PRIVATE,serializable:!1}),this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("selection");return e||(e=[],this.setPropStoreFieldValue("selection",e)),e},setter:function(e){this.setPropStoreFieldValue("selection",e),this.selectionChanged()}}),this.defineProp("selectMode",{dataType:DataType.INT,getter:function(){var e=this.getPropStoreFieldValue("selectMode");return d.ObjUtils.isUnset(e)&&(e=d.Editor.SelectMode.RECT),e},setter:function(e){this.getSelectMode()!==e&&(this.setPropStoreFieldValue("selectMode",e),this.hideSelectingMarker())}}),this.defineProp("isToggleSelectOn",{dataType:DataType.BOOL}),this.defineProp("hotTrackedObjs",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){var t=e?d.ArrayUtils.toArray(e):[];if(this.getEditorConfigs()&&this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()){var r;if(this.setPropStoreFieldValue("hotTrackedObjs",t),t&&t.length){r=[];for(var n=0,i=t.length;n<i;++n){var o=this.getBoundInfoRecorder().getBound(this.getObjContext(),t[n]);r&&d.ArrayUtils.pushUnique(r,o)}}r?this.changeHotTrackMarkerBounds(r):this.getUiHotTrackMarker().getVisible()&&this.hideHotTrackMarker()}}}),this.defineProp("hotTrackedObj",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getHotTrackedObjs()&&this.getHotTrackedObjs()[0]},setter:function(e){this.setHotTrackedObjs(e)}}),this.defineProp("hoveredBasicObjs",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("enableOperContext",{dataType:DataType.BOOL,setter:function(e){if(this.setPropStoreFieldValue("enableOperContext",!!e),!e){var t=this.getPropStoreFieldValue("operContext"),r=this.getPropStoreFieldValue("drawBridge");r&&t&&r.releaseContext(t)}}}),this.defineProp("issueCheckExecutor",{dataType:"Kekule.IssueCheck.Executor",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("issueCheckExecutor");if(!e){e=this.createIssueCheckExecutor();var t=this;e.addEventListener("execute",(function(e){t.setIssueCheckResults(e.checkResults)})),this.setPropStoreFieldValue("issueCheckExecutor",e)}return e}}),this.defineProp("issueCheckerIds",{dataType:DataType.ARRAY,getter:function(){return this.getIssueCheckExecutor().getCheckerIds()},setter:function(e){this.getIssueCheckExecutor().setCheckerIds(e)}}),this.defineProp("enableIssueCheck",{dataType:DataType.BOOL,getter:function(){return this.getIssueCheckExecutor().getEnabled()},setter:function(e){this.getIssueCheckExecutor().setEnabled(!!e),e||this.setIssueCheckResults(null)}}),this.defineProp("issueCheckDurationLimit",{dataType:DataType.NUMBER,getter:function(){return this.getIssueCheckExecutor().getDurationLimit()},setter:function(e){this.getIssueCheckExecutor().setDurationLimit(e)}}),this.defineProp("enableAutoIssueCheck",{dataType:DataType.BOOL,setter:function(e){!!e!==this.getEnableAutoIssueCheck()&&(this.setPropStoreFieldValue("enableAutoIssueCheck",!!e),e&&this.checkIssues(),this.setShowAllIssueMarkers(!!e))}}),this.defineProp("issueCheckResults",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){var t=this.getActiveIssueCheckResult();this.setPropStoreFieldValue("issueCheckResults",e),t&&(e||[]).indexOf(t)<0&&this.setPropStoreFieldValue("activeIssueCheckResult",null),this.issueCheckResultsChanged()}}),this.defineProp("activeIssueCheckResult",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){this.getActiveIssueCheckResult()!==e&&(this.setPropStoreFieldValue("activeIssueCheckResult",e),e&&this.deselectAll(),this.issueCheckResultsChanged())}}),this.defineProp("enableAutoScrollToActiveIssue",{dataType:DataType.BOOL}),this.defineProp("showAllIssueMarkers",{dataType:DataType.BOOL,setter:function(e){!!e!==this.getShowAllIssueMarkers()&&(this.setPropStoreFieldValue("showAllIssueMarkers",!!e),this.recalcIssueCheckUiMarkers())}}),this.defineProp("enableIssueMarkerHint",{dataType:DataType.BOOL}),this.defineProp("enableGesture",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this.getEnableGesture()!==t&&(this.setPropStoreFieldValue("enableGesture",t),this.startObservingGestureEvents(this.OBSERVING_GESTURES))}}),this.defineProp("uiEventReceiverElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("objContextParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("operContextParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("uiContextParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("objContext",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){return this.getDrawContext()}}),this.defineProp("operContext",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){if(this.getEnableOperContext()){var e=this.getPropStoreFieldValue("operContext");if(!e){var t=this.getDrawBridge();if(t){var r=this.getOperContextParentElem();if(!r)return null;var n=d.HtmlElementUtils.getElemScrollDimension(r);e=t.createContext(r,n.width,n.height),this.setPropStoreFieldValue("operContext",e)}}return e}return null}}),this.defineProp("uiContext",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("uiContext");if(!e){var t=this.getUiDrawBridge();if(t){var r=this.getUiContextParentElem();if(!r)return null;var n=d.HtmlElementUtils.getElemScrollDimension(r);e=t.createContext(r,n.width,n.height),this.setPropStoreFieldValue("uiContext",e)}}return e}}),this.defineProp("objDrawBridge",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){return this.getDrawBridge()}}),this.defineProp("uiDrawBridge",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiDrawBridge");return e||this.__$uiDrawBridgeInitialized$__||(this.__$uiDrawBridgeInitialized$__=!0,e=this.createUiDrawBridge(),this.setPropStoreFieldValue("uiDrawBridge",e)),e}}),this.defineProp("uiPainter",{dataType:"Kekule.Render.ChemObjPainter",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiPainter");if(!e){var t=this.getUiMarkers();return(e=new d.Render.ChemObjPainter(d.Render.RendererType.R2D,t,this.getUiDrawBridge())).setCanModifyTargetObj(!0),this.setPropStoreFieldValue("uiPainter",e),e}return e}}),this.defineProp("uiRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:!1,setter:null,getter:function(){var e=this.getUiPainter();return e?(e.getRenderer()||e.prepareRenderer(),e.getRenderer()||null):null}}),this.defineProp("uiMarkers",{dataType:"Kekule.ChemWidget.UiMarkerCollection",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiMarkers");return e||(e=new d.ChemWidget.UiMarkerCollection,this.setPropStoreFieldValue("uiMarkers",e)),e}}),this._defineUiMarkerProp("uiHotTrackMarker"),this._defineUiMarkerProp("uiSelectionAreaMarker"),this._defineUiMarkerProp("uiSelectingMarker"),this._defineIssueCheckUiMarkerGroupProps(),this.defineProp("uiSelectionAreaContainerBox",{dataType:DataType.Object,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("objRendererMap",{dataType:"Kekule.MapEx",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("objRendererMap");return e||(e=new d.MapEx(!0),this.setPropStoreFieldValue("objRendererMap",e)),e}}),this.defineProp("zoomCenter",{dataType:DataType.HASH})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setOperationsInCurrManipulation([]);var e=d.IssueCheck.CheckerIds,t=d.globalOptions.get;this.setEnableAutoIssueCheck(t("chemWidget.editor.issueChecker.enableAutoIssueCheck",!0)),this.setEnableAutoScrollToActiveIssue(t("chemWidget.editor.issueChecker.enableAutoScrollToActiveIssue",!0)),this.setIssueCheckerIds(t("chemWidget.editor.issueChecker.issueCheckerIds",[e.ATOM_VALENCE,e.BOND_ORDER,e.NODE_DISTANCE_2D])),this.setIssueCheckDurationLimit(t("chemWidget.editor.issueChecker.durationLimit")||null),this.setEnableIssueMarkerHint(t("chemWidget.editor.issueChecker.enableIssueMarkerHint")||this.getEnableAutoIssueCheck())},_defineUiMarkerProp:function(e,t){return this.defineProp(e,{dataType:"Kekule.ChemWidget.AbstractUIMarker",serializable:!1,getter:function(){var t=this.getPropStoreFieldValue(e);return t||(t=this.createShapeBasedMarker(e,null,null,!1)),t},setter:function(r){t||(t=this.getUiMarkers());var n=this.getPropValue(e);n&&(t.removeMarker(n),n.finalize()),t.addMarker(r),this.setPropStoreFieldValue(e,r)}})},_defineIssueCheckUiMarkerGroupProps:function(e){for(var t=d.ErrorLevel,r=function(e,r){return e+"_"+t.levelToString(r)},n="issueCheckUiMarker",i=[t.ERROR,t.WARNING,t.NOTE,t.LOG],o=0,a=i.length;o<a;++o){var s=r(n,i[o]);this._defineUiMarkerProp(s,e)}this._defineUiMarkerProp(n+"_active",e),this["get"+n.upperFirst()]=function(e){var t=r(n,e);return this.getPropValue(t)},this["set"+n.upperFirst()]=function(e,t){var i=r(n,e);return this.setPropValue(i,t)},this["getActive"+n.upperFirst()]=function(){return this.getPropValue(n+"_active")},this["getAll"+n.upperFirst()+"s"]=function(){for(var e=[],t=0,r=i.length;t<r;++t)e.push(this.getIssueCheckUiMarker(i[t]));var n=this.getActiveIssueCheckUiMarker();return n&&e.push(n),e}},doFinalize:function(){var e=this.getPropStoreFieldValue("operHistory");e&&(e.finalize(),this.setPropStoreFieldValue("operHistory",null));var t=this.getPropStoreFieldValue("objDrawBridge"),r=this.getPropStoreFieldValue("operContext");t&&r&&t.releaseContext(r),this.setPropStoreFieldValue("operContext",null),t=this.getPropStoreFieldValue("uiDrawBridge"),r=this.getPropStoreFieldValue("uiContext"),t&&r&&t.releaseContext(r),this.setPropStoreFieldValue("uiDrawBridge",null),this.setPropStoreFieldValue("uiContext",null);var n=this.getPropStoreFieldValue("objRendererMap");n&&n.finalize(),this.setPropStoreFieldValue("objRendererMap",null);var i=this.getPropStoreFieldValue("issueCheckExecutor");i&&i.finalize(),this.setPropStoreFieldValue("issueCheckExecutor",null),this.tryApplySuper("doFinalize")},elementBound:function(e){this.setObserveElemResize(!0)},createDefaultConfigs:function(){return new d.Editor.BaseEditorConfigs},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var r=e.createElement("div");return r.className=o.EDITOR_CLIENT,t.appendChild(r),this._editClientElem=r,[r]},getCoreElement:function(){return this._editClientElem||this.tryApplySuper("getCoreElement")},getEditClientElem:function(){return this._editClientElem},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+o.EDITOR+" "+(this.getRenderType()===d.Render.RendererType.R3D?o.EDITOR3D:o.EDITOR2D)},doBindElement:function(e){this.createContextParentElems(),this.createUiEventReceiverElem()},doGetInitialZoom:function(){var e,t=this.getEditorConfigs();return t&&(e=t.getInteractionConfigs().getEditorInitialZoom()),e||(e=this.tryApplySuper("doGetInitialZoom")),e},doSetInitialZoom:function(e){var t=this.getEditorConfigs();t&&t.getInteractionConfigs().setEditorInitialZoom(e),this.tryApplySuper("doSetInitialZoom",[e])},zoomTo:function(e,t,r){var n=d.CoordUtils,i=this.getCurrZoom(),o=e,a=this.tryApplySuper("zoomTo",[e,t]),s=this.getElement(),l={x:s.scrollLeft,y:s.scrollTop};r||(r=this.getZoomCenter()),r||(r=n.add(l,{x:s.clientWidth/2,y:s.clientHeight/2}));var u=n.multiply(r,o/i-1);return s.scrollLeft+=u.x,s.scrollTop+=u.y,a},zoomIn:function(e,t){var r=this.getCurrZoom(),n=d.ZoomUtils.getNextZoomInRatio(r,e||1);return this.zoomTo(n,null,t)},zoomOut:function(e,t){var r=this.getCurrZoom(),n=d.ZoomUtils.getNextZoomOutRatio(r,e||1);return this.zoomTo(n,null,t)},resetZoom:function(e){return this.zoomTo(this.getInitialZoom()||1,null,e)},changeClientSize:function(e,t,r){this._initialRenderTransformParams=null;var n=this.getCoreElement().style;r||(r=1);var i=e*r,o=t*r;i&&(n.width=i+"px"),o&&(n.height=o+"px");for(var a=[this.getObjContext(),this.getOperContext(),this.getUiContext()],s=0,l=a.length;s<l;++s){var d=a[s];d&&this.getDrawBridge().setContextDimension(d,i,o)}this.repaint()},getVisibleClientScreenBox:function(){var e=this.getEditClientElem().parentNode,t=d.HtmlElementUtils.getElemClientDimension(e),r=this.getClientScrollPosition();return t.x1=r.x,t.y1=r.y,t.x2=t.x1+t.width,t.y2=t.y1+t.height,t},getVisibleClientBoxOfSys:function(e){var t=this.getVisibleClientScreenBox(),r=d.BoxUtils.getMinMaxCoords(t),n=this.translateCoord(r.min,d.Editor.CoordSys.SCREEN,e),i=this.translateCoord(r.max,d.Editor.CoordSys.SCREEN,e);return d.BoxUtils.createBox(n,i)},getVisibleClientObjBox:function(e){return this.getVisibleClientBoxOfSys(d.Editor.CoordSys.CHEM)},isDirty:function(){return this.getEnableOperHistory()?this.getOperHistory().getCurrIndex()>=0:this._objChanged},getChemObjSrcInfo:function(e){return this.isDirty()?null:e.getSrcInfo?e.getSrcInfo():null},getActualDrawOptions:function(){var e=this.tryApplySuper("getActualDrawOptions");if(this._initialRenderTransformParams){var t=Object.extend({},this._initialRenderTransformParams);return Object.extend(t,e)}return e},repaint:function(e){var t=e,r=this.tryApplySuper("repaint",[t]);return this.isRenderable()&&(this._initialRenderTransformParams||(this._initialRenderTransformParams=this.getPainter().getActualInitialRenderTransformOptions(this.getObjContext())),this.recalcUiMarkers()),r},newDoc:function(){this.load(this.doCreateNewDocObj())},doCreateNewDocObj:function(){return new d.Molecule},getExportableClasses:function(){var e=this.getChemObj();return e&&e.getClass?[e.getClass()]:[]},exportObj:function(e){return this.exportObjs(e)[0]},exportObjs:function(e){var t=this.getChemObj();return e?t&&t instanceof e?[t]:[]:[t]},doLoad:function(e){this.deselectAll(),this._initialRenderTransformParams=null,this.getObjRendererMap().clear(),this.getOperHistory()&&this.getOperHistory().clear(),this.tryApplySuper("doLoad",[e]),this._objChanged=!1,this.setPropStoreFieldValue("hoveredBasicObjs",null),this.setIssueCheckResults(null),this.requestAutoCheckIssuesIfNecessary()},doLoadEnd:function(e){this.tryApplySuper("doLoadEnd"),e||(this._initialRenderTransformParams=null)},doResize:function(){this._initialRenderTransformParams=null,this.tryApplySuper("doResize")},geometryOptionChanged:function(){var e=this.getDrawOptions().zoom;this.zoomChanged(e),this._clearLengthCaches(),this.tryApplySuper("geometryOptionChanged")},zoomChanged:function(e){},_clearLengthCaches:function(){this._lengthCaches={}},chemObjChanged:function(e,t){this.tryApplySuper("chemObjChanged",[e,t]),e!==t&&(t&&this._uninstallChemObjEventListener(t),e&&this._installChemObjEventListener(e))},_installChemObjEventListener:function(e){e.addEventListener("change",this.reactChemObjChange,this)},_uninstallChemObjEventListener:function(e){e.removeEventListener("change",this.reactChemObjChange,this)},createUiEventReceiverElem:function(){var e=this.getCoreElement();if(e){var t=e.ownerDocument.createElement("div");return t.className=o.EDITOR_UIEVENT_RECEIVER,e.appendChild(t),r.addClass(t,i.DYN_CREATED),this.setPropStoreFieldValue("uiEventReceiverElem",t),t}},createContextParentElems:function(){var e=this.getCoreElement();if(e){var t=e.ownerDocument;this._createContextParentElem(t,e,"objContextParentElem"),this._createContextParentElem(t,e,"operContextParentElem"),this._createContextParentElem(t,e,"uiContextParentElem")}},_createContextParentElem:function(e,t,r){var n=e.createElement("div");return n.style.position="absolute",n.style.width="100%",n.style.height="100%",n.className=r+" "+i.DYN_CREATED,this.setPropStoreFieldValue(r,n),t.appendChild(n),n},createNewPainter:function(e){var t=this.tryApplySuper("createNewPainter",[e]);return t&&(t.setCanModifyTargetObj(!0),this.installPainterEventHandlers(t)),t},getDrawContextParentElem:function(){return this.getObjContextParentElem()},createUiDrawBridge:function(){var e=d.Render.DrawBridge2DMananger.getPreferredBridgeInstance();if(!e){var t=d.Render.DrawBridge2DMananger.getUnavailableMessage()||d.error(d.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"));t&&this.reportException(t,d.ExceptionLevel.NOT_FATAL_ERROR)}return e},changeContextDimension:function(e){var t=this.tryApplySuper("changeContextDimension",[e]);return t&&(this._resizeContext(this.getOperContext(),this.getObjDrawBridge(),e.width,e.height),this._resizeContext(this.getUiContext(),this.getUiDrawBridge(),e.width,e.height)),t},_clearSpecContext:function(e,t){t&&e&&t.clearContext(e)},_renderSpecContext:function(e,t){t&&e&&t.renderContext(e)},clearObjContext:function(){this._clearSpecContext(this.getObjContext(),this.getDrawBridge()),this.getBoundInfoRecorder()&&this.getBoundInfoRecorder().clear(this.getObjContext())},clearOperContext:function(){this._clearSpecContext(this.getOperContext(),this.getDrawBridge())},clearUiContext:function(){this._clearSpecContext(this.getUiContext(),this.getUiDrawBridge())},clearContext:function(){this.clearObjContext(),this._operatingRenderers&&this.clearOperContext()},repaintOperContext:function(e){if(this._operatingRenderers&&this._operatingObjs){this.clearOperContext();try{var t={partialDrawObjs:this._operatingObjs,doNotClear:!0};this.repaint(t)}finally{this._renderSpecContext(this.getOperContext(),this.getDrawBridge())}}},getOperatingRenderers:function(){return this._operatingRenderers||(this._operatingRenderers=[]),this._operatingRenderers},setOperatingRenderers:function(e){this._operatingRenderers=e},installPainterEventHandlers:function(e){e.addEventListener("prepareDrawing",this.reactChemObjPrepareDrawing,this),e.addEventListener("clear",this.reactChemObjClear,this)},reactChemObjPrepareDrawing:function(e){var r=e.context,n=e.obj;if(n&&(r===this.getObjContext()||r===this.getOperContext())){var i=e.target;if(this.getObjRendererMap().set(n,i),this.getEnableOperContext()){for(var o=this._operatingObjs||[],a=!1,s=0,l=o.length;s<l;++s)if(this._isChemObjDirectlyRenderedByRenderer(this.getObjContext(),o[s],i)){a=!0;break}a&&(this._setRendererToOperContext(i),t.pushUnique(this.getOperatingRenderers(),i))}}},reactChemObjClear:function(e){var r=e.context,n=e.obj;if(n&&(r===this.getObjContext()||r===this.getOperContext())){var i=e.target;this.getObjRendererMap().remove(n),t.remove(this.getOperatingRenderers(),i)}},reactChemObjChange:function(e){var t=e.target,r=e.changedPropNames||[];!(r=d.ArrayUtils.exclude(r,["id","owner","ownedObjs"])).length&&e.changedPropNames||this.objectChanged(t,r)},reactOperHistoryPush:function(e){this.invokeEvent("operPush",e)},reactOperHistoryPop:function(e){this.invokeEvent("operPop",e)},reactOperHistoryUndo:function(e){this.invokeEvent("operUndo",e)},reactOperHistoryRedo:function(e){this.invokeEvent("operRedo",e)},reactOperHistoryClear:function(e){this.invokeEvent("operHistoryClear",e)},reactOperHistoryChange:function(e){this.invokeEvent("operChange",e)},beginUpdateObject:function(){this._objectUpdateFlag>=0&&this.invokeEvent("beginUpdateObject"),--this._objectUpdateFlag},endUpdateObject:function(){++this._objectUpdateFlag,this.isUpdatingObject()||(this._updatedObjectDetails&&this._updatedObjectDetails.length&&(this.objectsChanged(this._updatedObjectDetails),this._updatedObjectDetails=[]),this._execAfterUpdateObjectProcs(),this.invokeEvent("endUpdateObject"))},isUpdatingObject:function(){return this._objectUpdateFlag<0},_registerAfterUpdateObjectProc:function(e){this.isUpdatingObject()?(this.endUpdateObject.suspendedProcs||(this.endUpdateObject.suspendedProcs=[]),this.endUpdateObject.suspendedProcs.push(e)):e.apply(this)},_execAfterUpdateObjectProcs:function(){var e=this.endUpdateObject.suspendedProcs;if(e)for(;e.length;){var t=e.shift();t&&t.apply(this)}},_mergeObjUpdatedDetails:function(e,t){for(var r=0,n=t.length;r<n;++r)this._mergeObjUpdatedDetailItem(e,t[r])},_mergeObjUpdatedDetailItem:function(e,t){for(var r=0,n=e.length;r<n;++r){var i=e[r];if(i.obj===t.obj)return i.propNames||(i.propNames=[]),void(t.propNames&&d.ArrayUtils.pushUnique(i.propNames,t.propNames))}e.push(t)},_logUpdatedDetail:function(e){var t="";e.forEach((function(e){t+="Obj: "+e.obj.getId()+"["+e.obj.getClassName()+"]     ",t+="Props: ["+e.propNames.join(", ")+"]",t+="\n"})),console.log(t)},objectChanged:function(e,t){var r={obj:e,propNames:t},n=this.objectsChanged(r);return this.invokeEvent("editObjChanged",Object.extend({},r)),n},objectsChanged:function(e){var r=DataType.isArrayValue(e)?e:[e];if(this.isUpdatingObject())this._mergeObjUpdatedDetails(this._updatedObjectDetails,r);else{var n=d.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(r);this.doObjectsChanged(r,n),this.requestAutoCheckIssuesIfNecessary(),this.invokeEvent("editObjsUpdated",{details:Object.extend({},e)})}this._objChanged=!0,this.invokeEvent("editObjsChanged",{details:Object.extend({},e)});var i=this.getSelection();if(i&&n){var o=t.intersect(i,n);o.length&&this.invokeEvent("selectedObjsUpdated",{objs:o})}},doObjectsChanged:function(e,t){var r=d.ArrayUtils.clone(e);t||(t=d.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(r));var n=this._getAdditionalRenderRelatedObjs(t);if(n.length){var i=d.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(n);d.ArrayUtils.pushUnique(r,i)}d.ArrayUtils.pushUnique(t,n);var o=this._operatingRenderers,a=o&&this._isAllObjsRenderedByRenderers(this.getObjContext(),t,o);this.canModifyPartialGraphic()?(this.getRootRenderer().modify(this.getObjContext(),r),this.recalcUiMarkers()):a?this.repaintOperContext():this.repaint()},beginManipulateObject:function(){this._objectManipulateFlag>=0&&this.invokeEvent("beginManipulateObject"),--this._objectManipulateFlag},endManipulateObject:function(){++this._objectManipulateFlag,this.isManipulatingObject()||(this._objectManipulateFlag=0,this.doManipulationEnd(),this.requestAutoCheckIssuesIfNecessary())},isManipulatingObject:function(){return this._objectManipulateFlag<0},doManipulationEnd:function(){this.setOperationsInCurrManipulation([]),this.invokeEvent("endManipulateObject")},beginManipulateAndUpdateObject:function(){this.beginManipulateObject(),this.beginUpdateObject()},endManipulateAndUpdateObject:function(){this.endUpdateObject(),this.endManipulateObject()},_needToCanonicalizeBeforeSaving:function(){return!0},_getAdditionalRenderRelatedObjs:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r],o=i.getCoordDeterminateObjects?i.getCoordDeterminateObjects():[];d.ArrayUtils.pushUnique(t,o)}return t},_isAllObjsRenderedByRenderers:function(e,t,r){for(var n=0,i=t.length;n<i;++n){for(var o=t[n],a=!1,s=0,l=r.length;s<l;++s)if(r[s].isChemObjRenderedBySelf(e,o)){a=!0;break}if(!a)return!1}return!0},prepareOperatingObjs:function(e){this._operatingRenderers&&this._operatingRenderers.length&&this.endOperatingObjs(!0),this.getEnableOperContext()&&(this._prepareRenderObjsInOperContext(e),this._operatingObjs=e),this.repaint()},endOperatingObjs:function(e){this.getEnableOperContext()&&(this._endRenderObjsInOperContext(),this._operatingObjs=null,e||this.repaint())},_isChemObjDirectlyRenderedByRenderer:function(e,t,r){var n=t.getStandaloneAncestor?t.getStandaloneAncestor():t;return r.isChemObjRenderedDirectlyBySelf(e,n)},_getStandaloneRenderObjsInOperContext:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r];i.getStandaloneAncestor&&(i=i.getStandaloneAncestor()),d.ArrayUtils.pushUnique(t,i)}return t},_prepareRenderObjsInOperContext:function(e){for(var t=[],r=this.getObjRendererMap().getValues(),n=this.getObjContext(),i=this._getStandaloneRenderObjsInOperContext(e),o=0,a=i.length;o<a;++o)for(var s=i[o],l=0,u=r.length;l<u;++l)(c=r[l]).isChemObjRenderedDirectlyBySelf(n,s)&&d.ArrayUtils.pushUnique(t,c);if(t.length>0){for(o=0,a=t.length;o<a;++o){var c=t[o];this._setRendererToOperContext(c)}this._operatingRenderers=t}else this._operatingRenderers=null},_endRenderObjsInOperContext:function(){var e=this._operatingRenderers;if(e&&e.length){for(var t=0,r=e.length;t<r;++t){var n=e[t];this._unsetRendererToOperContext(n)}this.clearOperContext()}this._operatingRenderers=null},_setRendererToOperContext:function(e){e.setRedirectContext(this.getOperContext())},_unsetRendererToOperContext:function(e){e.setRedirectContext(null)},getInteractionBoundInflation:function(e){var t=this._lengthCaches.interactionBoundInflations,r=e||"default";if(t&&t[r])return t[r];var n,i=this.getEditorConfigs().getInteractionConfigs(),o=i.getPropValue("objBoundTrackInflationRatio");if(e){var a=e.upperFirst(),s="objBoundTrackInflationRatio"+a;i.hasProperty(s)&&(n=i.getPropValue(s))}var l,d=n||o,u=d&&this.getDefBondScreenLength()*d,c=i.getPropValue("objBoundTrackMinInflation");if(e){var h="objBoundTrackMinInflation"+a;i.hasProperty(h)&&(l=i.getPropValue(h))}var p=l||c,g=Math.max(u||0,p);return t||(t={},this._lengthCaches.interactionBoundInflations=t),t[r]=g,g},clearBoundMap:function(){this.getBoundInfoRecorder().clear(this.getObjContext())},findTopmostBoundInfo:function(e,t){if(e&&e.length){var r=null,n=e.length-1;for(r=e[n];n>=0&&t&&t.indexOf(r.obj)>=0;)r=e[--n];return r}return null},getBoundInfosAtCoord:function(e,t,r){var n=this.getBoundInfoRecorder(),i=r||this.getCurrBoundInflation()||this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackMinInflation(),o=this.screenCoordToContext(e),a=this.getRenderType()===d.Render.RendererType.R3D?{x:0,y:0}:null;return n.getIntersectionInfos(this.getObjContext(),o,a,i,t)},getTopmostBoundInfoAtCoord:function(e,t,r){if(!this.getEditorConfigs().getInteractionConfigs().getEnableTrackOnNearest())return this.findTopmostBoundInfo(this.getBoundInfosAtCoord(e,null,r),t,r);for(var n,i,o,a=d.Render.MetaShapeUtils,s=this.getBoundInfosAtCoord(e,null,r),l=function(t,r,s){n=t,i=r||t.boundInfo,o=d.ObjUtils.notUnset(s)?s:a.getDistance(e,i)},u=s.length-1;u>=0;--u){var c=s[u];if(!(t&&t.indexOf(c.obj)>=0))if(n){var h=c.boundInfo;if(h.shapeType<i.shapeType)l(c,h);else if(h.shapeType===i.shapeType){var p=a.getDistance(e,h);p<o&&l(c,h,p)}}else l(c)}return n},getBasicObjectsAtCoord:function(e,r,n,i){var o=this.getBoundInfosAtCoord(e,null,r),a=[];if(o){n&&(o=t.filter(o,(function(e){var t=o[u].obj;return!!t&&!(t&&n&&n.indexOf(t)>=0)})));var s=function(e){return e&&e.getCoordStickTarget&&e.getCoordStickTarget()?1:0};if(o.sort((function(e,t){return s(e.obj)-s(t.obj)})),this.getEditorConfigs().getInteractionConfigs().getEnableTrackOnNearest()){var l=d.Render.MetaShapeUtils;o.sort((function(t,r){var n=0,i=t.boundInfo,o=r.boundInfo;return(n=-(i.shapeType-o.shapeType))||(n=-(l.getDistance(e,i)-l.getDistance(e,o))),n}))}for(var u=o.length-1;u>=0;--u){var c=o[u].obj;c&&n&&n.indexOf(c)>=0||a.push(c)}a&&i&&(a=t.filter(a,(function(e){for(var t=0,r=i.length;t<r;++t)if(e instanceof i[t])return!0;return!1})))}return a},getTopmostBasicObjectAtCoord:function(e,t,r){var n=this.getBasicObjectsAtCoord(e,t,null,r);return n&&n[0]},getChemObjBounds:function(e,t){var r=[],n=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),e);if(n&&n.length)for(var i=0,o=n.length;i<o;++i){var a=n[i].boundInfo;a&&(a=d.Render.MetaShapeUtils.inflateShape(a,t),r.push(a))}return r},getUiMarkersAtCoord:function(e,t,r){for(var n=this.getUiMarkers(),i=r&&r.length?function(e){for(var t=0,n=r.length;t<n;++t)if(e instanceof r[t])return!0;return!1}:null,o=d.Render.MetaShapeUtils,a=[],s=n.getMarkerCount()-1;s>=0;--s){var l=n.getMarkerAt(s);if(l.getVisible()&&(!i||i(l))){var u=l.shapeInfo;o.isCoordInside(e,u,t)&&a.push(l)}}return a},beginUpdateUiMarkers:function(){--this._uiMarkerUpdateFlag},endUpdateUiMarkers:function(){++this._uiMarkerUpdateFlag,this.isUpdatingUiMarkers()||this.repaintUiMarker()},isUpdatingUiMarkers:function(){return this._uiMarkerUpdateFlag<0},recalcUiMarkers:function(){if(this.getUiDrawBridge()){this.beginUpdateUiMarkers();try{this.recalcHotTrackMarker(),this.recalcSelectionAreaMarker(),this.recalcIssueCheckUiMarkers()}finally{this.endUpdateUiMarkers()}}},repaintUiMarker:function(){if(!this.isUpdatingUiMarkers()&&this.getUiDrawBridge()&&this.getUiContext()){this.clearUiContext();var e=this.calcDrawParams();this.getUiPainter().draw(this.getUiContext(),e.baseCoord,e.drawOptions)}},createShapeBasedMarker:function(e,t,r,n){var i=new d.ChemWidget.MetaShapeUIMarker;return t&&i.setShapeInfo(t),r&&i.setDrawStyles(r),this.setPropStoreFieldValue(e,i),this.getUiMarkers().addMarker(i),n&&this.repaintUiMarker(),i},modifyShapeBasedMarker:function(e,t,r,n){d.Render.ObjectUpdateType.MODIFY,t&&e.setShapeInfo(t),r&&e.setDrawStyles(r),n&&this.repaintUiMarker()},hideUiMarker:function(e,t){e.setVisible(!1),t&&this.repaintUiMarker()},showUiMarker:function(e,t){e.setVisible(!0),t&&this.repaintUiMarker()},removeUiMarker:function(e){e&&(this.getUiMarkers().removeMarker(e),this.repaintUiMarker())},clearUiMarkers:function(){this.getUiMarkers().clearMarkers(),this.repaintUiMarker()},changeHotTrackMarkerBounds:function(e){for(var t=d.ArrayUtils.toArray(e),r=this.getEditorConfigs().getUiMarkerConfigs(),n={color:r.getHotTrackerColor(),opacity:r.getHotTrackerOpacity()},i=this.getCurrBoundInflation()||this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackMinInflation(),o=[],a=0,s=t.length;a<s;++a){var l=t[a],u=i?d.Render.MetaShapeUtils.inflateShape(l,i):l;u&&o.push(u)}var c=this.getUiHotTrackMarker();return c.setVisible(!0),this.modifyShapeBasedMarker(c,o,n,!0),this},hideHotTrackMarker:function(){var e=this.getUiHotTrackMarker();return e&&this.hideUiMarker(e,!0),this},showHotTrackMarker:function(){var e=this.getUiHotTrackMarker();return e&&this.showUiMarker(e,!0),this},hotTrackOnCoord:function(e){return this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()&&this.setHotTrackedObj(this.getTopmostBasicObjectAtCoord(e,this.getCurrBoundInflation())),this},hotTrackOnObj:function(e){return this.setHotTrackedObj(e),this},hideHotTrack:function(e){return this.hideHotTrackMarker(),e||this.clearHotTrackedObjs(),this},clearHotTrackedObjs:function(){this.setHotTrackedObjs([])},addHotTrackedObj:function(e){var t=this.getHotTrackedObjs()||[];return d.ArrayUtils.pushUnique(t,e),this.setHotTrackedObjs(t),this},recalcHotTrackMarker:function(){this.setHotTrackedObjs(this.getHotTrackedObjs())},updateHintForChemObject:function(e){var t=this.getEditClientElem();if(t){var r=e||"";r&&this.updateHintForChemObject._cache==r&&(r+="\f"),t.title=r,r&&(this.updateHintForChemObject._cache=r)}},getChemObjHint:function(e){return null},getChemObjsHint:function(e){for(var r=[],n=0,i=e.length;n<i;++n){var o=this.getChemObjHint(e[n]);o&&t.pushUnique(r,o)}var a=this._getChemObjsRelatedIssuesHints(e);return a.length&&t.pushUnique(r,a),r.length?r.join("\n"):null},_getChemObjsRelatedIssuesHints:function(e){var r=[];if(this.getEnableIssueMarkerHint()&&this.getEnableIssueCheck())for(var n=this.getObjectsRelatedIssueItems(e,!0)||[],i=0,o=n.length;i<o;++i){var a=n[i].getMessage();t.pushUnique(r,a)}return r},issueCheckResultsChanged:function(){this.recalcIssueCheckUiMarkers();var e=this.getActiveIssueCheckResult();if(e&&this.getEnableAutoScrollToActiveIssue()){var t=e.getTargets();if(t&&t.length){var r=this._getExposedSelfOrParentObjs(t);r&&r.length&&this.getObjectsBoxAndClientBoxRelation(r)!==d.IntersectionState.CONTAINED&&this.scrollClientToObject(r)}}},_needShowInactiveIssueMarkers:function(){return this.getEnableIssueCheck()&&this.getShowAllIssueMarkers()},recalcIssueCheckUiMarkers:function(){if(this.getChemObjLoaded()){this.beginUpdateUiMarkers();try{var e=this.getIssueCheckResults()||[];if(e.length&&this.getEnableIssueCheck()){var t=this._needShowInactiveIssueMarkers(),r=this.getActiveIssueCheckResult();this.getActiveIssueCheckUiMarker().setVisible(!!r);for(var n=this._groupUpIssueObjects(e,r,!0),i=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerInflation(),o=d.ErrorLevel.getAllLevels().concat("active"),a=0,s=o.length;a<s;++a){var l=[],u=o[a],c=n[u],h=c?c.level:u;if(c){var p="active"===u;if(p||t)for(var g=c.objs,f=0,m=g.length;f<m;++f)for(var C=g[f],y=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),C),_=0,E=y.length;_<E;++_){var T=y[_].boundInfo;T&&(T=d.Render.MetaShapeUtils.inflateShape(T,i),l.push(T))}}this.changeIssueCheckUiMarkerBound(h,l,p)}}else this.hideIssueCheckUiMarkers()}finally{this.endUpdateUiMarkers()}}},changeIssueCheckUiMarkerBound:function(e,t,r){var n=r?this.getActiveIssueCheckUiMarker():this.getIssueCheckUiMarker(e);if(n)if(t&&t.length){var i=d.ErrorLevel.levelToString(e),o=this.getEditorConfigs().getUiMarkerConfigs(),a=o.getIssueCheckMarkerColors()[i],s={strokeColor:r?a.activeStrokeColor:a.strokeColor,strokeWidth:r?o.getIssueCheckActiveMarkerStrokeWidth():o.getIssueCheckMarkerStrokeWidth(),fillColor:r?a.activeFillColor:a.fillColor,opacity:r?o.getIssueCheckActiveMarkerOpacity():o.getIssueCheckMarkerOpacity()};n.setVisible(!0),this.modifyShapeBasedMarker(n,t,s,!0)}else n.setVisible(!1);return this},_getExposedSelfOrParentObjs:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r];if(!i.isExposed||i.isExposed())t.push(i);else if(i.getExposedAncestor){var o=i.getExposedAncestor();o&&t.push(o)}}return t},_groupUpIssueObjects:function(e,r,n){for(var i={},o=0,a=e.length;o<a;++o){var s=e[o],l=s.getTargets(),u=s.getLevel();r&&s===r?i.active={level:u,objs:n?this._getExposedSelfOrParentObjs(l):l}:(i[u]||(i[u]={level:u,objs:[]}),i[u].objs=i[u].objs.concat(n?this._getExposedSelfOrParentObjs(l):l))}var c=d.ErrorLevel,h=[c.LOG,c.NOTE,c.WARNING,c.ERROR,"active"];for(o=0,a=h.length;o<a;++o){var p=i[o]&&i[o].objs;if(p)for(var g=o+1,f=h.length;g<f;++g){var m=i[g]&&i[g].objs;if(m){var C=t.exclude(p,m);i[o].objs=C}}}return i},hideIssueCheckUiMarkers:function(){for(var e=this.getAllIssueCheckUiMarkers()||[],t=0,r=e.length;t<r;++t)this.hideUiMarker(e[t])},isObjectRelatedToIssue:function(e,t,r){if((t.getTargets()||[]).indexOf(e)>=0)return!0;if(r){var n=e.getParent();return!!n&&this.isObjectRelatedToIssue(n,t,r)}},getObjectIssueItems:function(e,t){var r=this.getIssueCheckResults()||[];if(r.length&&this.getEnableIssueCheck()){for(var n=[],i=0,o=r.length;i<o;++i){var a=r[i];this.isObjectRelatedToIssue(e,a,t)&&n.push(a)}return n}return[]},getObjectsRelatedIssueItems:function(e,r){if(!(this.getIssueCheckResults()||[]).length||!this.getEnableIssueCheck())return[];var n=[],i=[].concat(e);if(r)for(var o=0,a=e.length;o<a;++o)t.pushUnique(i,e[o].getParentList());for(o=0,a=i.length;o<a;++o){var s=this.getObjectIssueItems(i[o],!1);t.pushUnique(n,s)}return n},changeSelectionAreaMarkerBound:function(e,t){var r=this.getEditorConfigs().getUiMarkerConfigs();t||(t={strokeColor:r.getSelectionMarkerStrokeColor(),strokeWidth:r.getSelectionMarkerStrokeWidth(),fillColor:r.getSelectionMarkerFillColor(),opacity:r.getSelectionMarkerOpacity()});var n=this.getUiSelectionAreaMarker();return n&&(n.setVisible(!0),this.modifyShapeBasedMarker(n,e,t,!0)),this},hideSelectionAreaMarker:function(){var e=this.getUiSelectionAreaMarker();e&&this.hideUiMarker(e,!0)},showSelectionAreaMarker:function(){var e=this.getUiSelectionAreaMarker();e&&this.showUiMarker(e,!0)},recalcSelectionAreaMarker:function(e){this.beginUpdateUiMarkers();try{var t=this.getSelection(),r=t.length;if(r<=0)this.hideSelectionAreaMarker();else{for(var n=[],i=null,o=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerInflation(),a=0;a<r;++a){var s=t[a],l=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),s);if(l&&l.length)for(var u=0,c=l.length;u<c;++u){var h=l[u].boundInfo;if(h){h=d.Render.MetaShapeUtils.inflateShape(h,o),n.push(h);var p=d.Render.MetaShapeUtils.getContainerBox(h);i=i?d.BoxUtils.getContainerBox(i,p):p}}}if(this.setUiSelectionAreaContainerBox(i),i){var g=d.Render.MetaShapeUtils.createShapeInfo(d.Render.MetaShapeType.RECT,[{x:i.x1,y:i.y1},{x:i.x2,y:i.y2}]);n.push(g)}else this.hideSelectionAreaMarker();n.length&&this.changeSelectionAreaMarkerBound(n)}}finally{this.endUpdateUiMarkers()}},_highlightSelectionAreaMarker:function(){var e=this.getEditorConfigs().getUiMarkerConfigs(),t={strokeColor:e.getSelectionMarkerStrokeColor(),strokeWidth:e.getSelectionMarkerStrokeWidth(),fillColor:e.getSelectionMarkerFillColor(),opacity:e.getSelectionMarkerEmphasisOpacity()};this.changeSelectionAreaMarkerBound(null,t)},_restoreSelectionAreaMarker:function(){var e=this.getEditorConfigs().getUiMarkerConfigs(),t={strokeColor:e.getSelectionMarkerStrokeColor(),strokeWidth:e.getSelectionMarkerStrokeWidth(),fillColor:e.getSelectionMarkerFillColor(),opacity:e.getSelectionMarkerOpacity()};this.changeSelectionAreaMarkerBound(null,t)},pulseSelectionAreaMarker:function(e,t){if(this.getUiSelectionAreaMarker()){if(e||(e=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerDefPulseDuration()||0),t||(t=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerDefPulseCount()||1),!e)return;var r=e/t;this.doPulseSelectionAreaMarker(r,t)}return this},doPulseSelectionAreaMarker:function(e,t){this._highlightSelectionAreaMarker(),setTimeout(this._restoreSelectionAreaMarker.bind(this),e),t>1&&setTimeout(this.doPulseSelectionAreaMarker.bind(this,e,t-1),2*e)},startSelecting:function(e,t){void 0===t&&(t=this.getIsToggleSelectOn()),t||this.deselectAll();var r=d.Editor.SelectMode,n=this.getSelectMode();return this._currSelectMode=n,n===r.POLYLINE||n===r.POLYGON?this.startSelectingCurveDrag(e,t):this.startSelectingBoxDrag(e,t)},addSelectingAnchorCoord:function(e){var t=d.Editor.SelectMode,r=this._currSelectMode;return r===t.POLYLINE||r===t.POLYGON?this.dragSelectingCurveToCoord(e):this.dragSelectingBoxToCoord(e)},endSelecting:function(e,t){void 0===t&&(t=this.getIsToggleSelectOn());var r,n=d.Editor.SelectMode,i=this._currSelectMode,o=this.getEditorConfigs().getInteractionConfigs().getEnablePartialAreaSelecting();if(i===n.POLYLINE||i===n.POLYGON){var a=this._selectingCurveCoords,s=this.getEditorConfigs().getInteractionConfigs().getSelectingCurveSimplificationDistanceThreshold(),l=d.GeometryUtils.simplifyCurveToLineSegments(a,s);if(this.endSelectingCurveDrag(e,t),i===n.POLYLINE){var u=this.getEditorConfigs().getInteractionConfigs().getSelectingBrushWidth();r=this.getObjectsIntersetExtendedPolyline(l,u)}else r=this.getObjectsInPolygon(l,o),this.endSelectingCurveDrag(e,t)}else{var c=this._selectingBoxStartCoord,h=d.BoxUtils.createBox(c,e);r=this.getObjectsInScreenBox(h,o),this.endSelectingBoxDrag(e,t)}r=this._getActualSelectedObjsInSelecting(r),t?this.toggleSelectingState(r):this.select(r),this.hideSelectingMarker()},cancelSelecting:function(){this.hideSelectingMarker()},_getActualSelectedObjsInSelecting:function(e){return e&&e.length?(this._isInAncestorSelectMode()&&(e=this._getAllStandaloneAncestorObjs(e)),e):[]},_isInAncestorSelectMode:function(){return this.getSelectMode()===d.Editor.SelectMode.ANCESTOR},_getAllStandaloneAncestorObjs:function(e){for(var r=[],n=0,i=e.length;n<i;++n){var o=e[n];o&&o.getStandaloneAncestor&&(o=o.getStandaloneAncestor()),t.pushUnique(r,o)}return r},startSelectingBoxDrag:function(e,t){this._selectingBoxStartCoord=e},dragSelectingBoxToCoord:function(e){var t=this._selectingBoxStartCoord,r=e;this.changeSelectingMarkerBox(t,r)},endSelectingBoxDrag:function(e,t){this._selectingBoxStartCoord,this._selectingBoxEndCoord=e},startSelectingCurveDrag:function(e,t){this._selectingCurveCoords=[e]},dragSelectingCurveToCoord:function(e){this._selectingCurveCoords.push(e),this.changeSelectingMarkerCurve(this._selectingCurveCoords,this._currSelectMode===d.Editor.SelectMode.POLYGON)},endSelectingCurveDrag:function(e,t){this._selectingCurveCoords.push(e)},selectOnCoord:function(e,t){void 0===t&&(t=this.getIsToggleSelectOn());var r=this.getTopmostBasicObjectAtCoord(e,this.getCurrBoundInflation());if(r){var n=this._getActualSelectedObjsInSelecting([r]);n&&(t?this.toggleSelectingState(n):this.select(n))}},changeSelectingMarkerBound:function(e,t){var r=this.getEditorConfigs().getUiMarkerConfigs();t||(t={strokeColor:r.getSelectingMarkerStrokeColor(),strokeWidth:r.getSelectingMarkerStrokeWidth(),strokeDash:r.getSelectingMarkerStrokeDash(),fillColor:r.getSelectingMarkerFillColor(),opacity:r.getSelectingMarkerOpacity()});var n=this.getUiSelectingMarker();return n.setVisible(!0),this.modifyShapeBasedMarker(n,e,t,!0),this},changeSelectingMarkerCurve:function(e,t){for(var r=[],n=0,i=e.length-1;n<i;++n)r.push(this.screenCoordToContext(e[n]));var o,a=d.Render.MetaShapeUtils.createShapeInfo(t?d.Render.MetaShapeType.POLYGON:d.Render.MetaShapeType.POLYLINE,r);if(!t){var s=this.getEditorConfigs().getUiMarkerConfigs();o={strokeColor:s.getSelectingBrushMarkerStrokeColor(),strokeWidth:this.getEditorConfigs().getInteractionConfigs().getSelectingBrushWidth(),strokeDash:s.getSelectingBrushMarkerStrokeDash(),lineCap:s.getSelectingBrushMarkerStrokeLineCap(),lineJoin:s.getSelectingBrushMarkerStrokeLineJoin(),opacity:s.getSelectingBrushMarkerOpacity()}}return this.changeSelectingMarkerBound(a,o)},changeSelectingMarkerBox:function(e,t){var r=this.screenCoordToContext(e),n=this.screenCoordToContext(t),i=d.Render.MetaShapeUtils.createShapeInfo(d.Render.MetaShapeType.RECT,[{x:Math.min(r.x,n.x),y:Math.min(r.y,n.y)},{x:Math.max(r.x,n.x),y:Math.max(r.y,n.y)}]);return this.changeSelectingMarkerBound(i)},hideSelectingMarker:function(){var e=this.getUiSelectingMarker();e&&this.hideUiMarker(e,!0)},showSelectingMarker:function(){var e=this.getUiSelectingMarker();e&&this.showUiMarker(e,!0)},getCoordRegionInSelectionMarker:function(e,t){var r=d.Editor.BoxRegion,n=d.CoordUtils,i=this.screenCoordToContext(e),o=this.getUiSelectionAreaMarker();if(o&&o.getVisible()){var a=this.getUiSelectionAreaContainerBox();d.ObjUtils.isUnset(t)&&(t=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerEdgeInflation());var s=t/2||0,l=n.substract({x:a.x1,y:a.y1},{x:s,y:s}),u=n.add({x:a.x2,y:a.y2},{x:s,y:s});if(i.x<l.x||i.y<l.y||i.x>u.x||i.y>u.y)return r.OUTSIDE;var c=n.substract(i,l),h=n.substract(u,i),p=c.x,g=h.x,f=c.y,m=h.y;return f<m?p<g?f<=t?p<=t?r.CORNER_TL:r.EDGE_TOP:p<=t?r.EDGE_LEFT:r.INSIDE:f<=t?g<=t?r.CORNER_TR:r.EDGE_TOP:g<=t?r.EDGE_RIGHT:r.INSIDE:p<g?m<=t?p<=t?r.CORNER_BL:r.EDGE_BOTTOM:p<=t?r.EDGE_LEFT:r.INSIDE:m<=t?g<=t?r.CORNER_BR:r.EDGE_BOTTOM:g<=t?r.EDGE_RIGHT:r.INSIDE}return r.OUTSIDE},isCoordInSelectionMarkerBound:function(e){return this.getCoordRegionInSelectionMarker(e)!==d.Editor.BoxRegion.OUTSIDE},getObjSelectedRenderOptions:function(){return this._selectedRenderOptions},_getObjRenderOptionItemAppendMethod:function(e){return this.getRenderType()===d.Render.RendererType.R3D?e.addOverrideRender3DOptionItem:e.addOverrideRenderOptionItem},_getObjRenderOptionItemRemoveMethod:function(e){return this.getRenderType()===d.Render.RendererType.R3D?e.removeOverrideRender3DOptionItem:e.removeOverrideRenderOptionItem},_addSelectRenderOptions:function(e){var t=this.getObjSelectedRenderOptions();return t?this._getObjRenderOptionItemAppendMethod(e).apply(e,[t]):null},_removeSelectRenderOptions:function(e){return this.getObjSelectedRenderOptions()?this._getObjRenderOptionItemRemoveMethod(e).apply(e,[this.getObjSelectedRenderOptions()]):null},beginUpdateSelection:function(){this.beginUpdateObject(),--this._objSelectFlag},endUpdateSelection:function(){++this._objSelectFlag,this._objSelectFlag>=0&&this.selectionChanged(),this.endUpdateObject()},isUpdatingSelection:function(){return this._objSelectFlag<0},selectionChanged:function(){if(!this.isUpdatingSelection())return this.notifyPropSet("selection",this.getSelection()),this.invokeEvent("selectionChange"),this.doSelectionChanged()},doSelectionChanged:function(){this.recalcSelectionAreaMarker()},isInSelection:function(e){return!!e&&this.getSelection().indexOf(e)>=0},addObjToSelection:function(e){if(!e)return this;var t=this.getSelection();return d.ArrayUtils.pushUnique(t,e.getNearestSelectableObject()),this._addSelectRenderOptions(e),this.selectionChanged(),this},removeObjFromSelection:function(e,t){if(!e)return this;var r=this.getSelection(),n=e.getNearestSelectableObject&&e.getNearestSelectableObject();d.ArrayUtils.remove(r,e),this._removeSelectRenderOptions(e),n&&(d.ArrayUtils.remove(r,n),this._removeSelectRenderOptions(n));for(var i=r.length-1;i>=0;--i){var o=r[i];o.isChildOf&&(o.isChildOf(e)||n&&o.isChildOf(n))&&this.removeObjFromSelection(o,!0)}return t||this.selectionChanged(),this},selectAll:function(){var e=[],t=this.getChemObj();if(t){var r=t.getChildren()||[];e=r.length?r:[t]}return this.select(e)},deselectAll:function(){var e=this.getSelection();return this.removeFromSelection(e)},select:function(e){this.beginUpdateSelection();try{this.deselectAll(),this.addToSelection(e)}finally{this.endUpdateSelection()}return this},addToSelection:function(e){if(e){var t=DataType.isArrayValue(e)?e:[e];this.beginUpdateSelection();try{for(var r=0,n=t.length;r<n;++r)this.addObjToSelection(t[r])}finally{this.endUpdateSelection()}return this}},removeFromSelection:function(e){if(e&&e.length){var t=DataType.isArrayValue(e)?e:[e];this.beginUpdateSelection();try{for(var r=t.length-1;r>=0;--r)this.removeObjFromSelection(t[r])}finally{this.endUpdateSelection()}return this}},toggleSelectingState:function(e){if(e){var t=DataType.isArrayValue(e)?e:[e];this.beginUpdateSelection();try{for(var r=0,n=t.length;r<n;++r){var i=t[r],o=i.getNearestSelectableObject&&i.getNearestSelectableObject();this.isInSelection(i)?this.removeObjFromSelection(i):o&&this.isInSelection(o)?this.removeObjFromSelection(o):this.addObjToSelection(i)}}finally{this.endUpdateSelection()}return this}},hasSelection:function(){return!!this.getSelection().length},deleteSelectedObjs:function(){},requestAutoCheckIssuesIfNecessary:function(){this.getEnableAutoIssueCheck()&&this._tryCheckIssueOnIdle()},_tryCheckIssueOnIdle:function(){return this.isUpdatingObject()||this.isManipulatingObject()?null:this.checkIssues()},createIssueCheckExecutor:function(){return new d.IssueCheck.ExecutorForEditor(this)},checkIssues:function(e){var t=null,r=e||this.getChemObj();return r&&this.getEnableIssueCheck()&&(t=this.getIssueCheckExecutor(!0).execute(r)),t},getObjectsIntersetExtendedPolyline:function(e,t){for(var r=[],n=0,i=e.length;n<i;++n)r.push(this.screenCoordToContext(e[n]));var o=[],a=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext()),s=d.Render.MetaShapeUtils.isIntersectingPolyline;for(n=0,i=a.length;n<i;++n){var l=a[n],u=l.boundInfo;u&&s(u,r,t)&&o.push(l.obj)}return o},getObjectsInPolygon:function(e,t){for(var r=[],n=0,i=e.length;n<i;++n)r.push(this.screenCoordToContext(e[n]));var o=[],a=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext()),s=t?d.Render.MetaShapeUtils.isIntersectingPolygon:d.Render.MetaShapeUtils.isInsidePolygon;for(n=0,i=a.length;n<i;++n){var l=a[n],u=l.boundInfo;u&&s(u,r)&&o.push(l.obj)}return o},getObjectsInScreenBox:function(e,t){for(var r=this.screenBoxToContext(e),n=[],i=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext()),o=t?d.Render.MetaShapeUtils.isIntersectingBox:d.Render.MetaShapeUtils.isInsideBox,a=0,s=i.length;a<s;++a){var l=i[a],u=l.boundInfo;u&&o(u,r)&&n.push(l.obj)}return n},selectObjectsInScreenBox:function(e,t){var r=this.getObjectsInScreenBox(e,t);return r&&r.length&&this.select(r),r},addObjectsInScreenBoxToSelection:function(e,t){var r=this.getObjectsInScreenBox(e,t);return r&&r.length&&this.addToSelection(r),r},removeObjectsInScreenBoxFromSelection:function(e,t){var r=this.getObjectsInScreenBox(e,t);return r&&r.length&&this.removeFromSelection(r),r},toggleSelectingStateOfObjectsInScreenBox:function(e,t){var r=this.getObjectsInScreenBox(e,t);return r&&r.length&&this.toggleSelectingState(r),r},getObjectsContainerBox:function(e,t){for(var r=d.ArrayUtils.toArray(e),n=t||0,i=null,o=0,a=r.length;o<a;++o){var s=r[o],l=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),s);if(l&&l.length)for(var u=0,c=l.length;u<c;++u){var h=l[u].boundInfo;if(h){n&&(h=d.Render.MetaShapeUtils.inflateShape(h,n));var p=d.Render.MetaShapeUtils.getContainerBox(h);i=i?d.BoxUtils.getContainerBox(i,p):p}}}return i},getObjectsBoxAndClientBoxRelation:function(e){var t=this.getObjectsContainerBox(e);if(t){var r=this.getVisibleClientScreenBox();return d.BoxUtils.getIntersectionState(t,r)}},getSelectionContainerBox:function(e){return this.getObjectsContainerBox(this.getSelection(),e)},isSelectionVisible:function(){var e=this.getSelectionContainerBox();if(e){var t=this.getVisibleClientScreenBox();return d.BoxUtils.hasIntersection(e,t)}return!1},getObjSize:function(e){return this.doGetObjSize(e)},doGetObjSize:function(e){var t=this.getCoordMode();return e.getSizeOfMode?e.getSizeOfMode(t):null},setObjSize:function(e,t){this.doSetObjSize(e,t),this.objectChanged(e)},doSetObjSize:function(e,t){e.setSizeOfMode&&e.setSizeOfMode(t,this.getCoordMode())},getObjCoord:function(e,t){return this.doGetObjCoord(e,t)},doGetObjCoord:function(e,t){if(!e)return null;var r=this.getCoordMode(),n=this.getAllowCoordBorrow(),i=e.getAbsBaseCoord?e.getAbsBaseCoord(r,n):e.getAbsCoordOfMode?e.getAbsCoordOfMode(r,n):e.getCoordOfMode?e.getCoordOfMode(r,n):null;if(r===d.CoordMode.COORD2D&&d.ObjUtils.notUnset(t)&&t!==d.Render.CoordPos.DEFAULT){n=this.getAllowCoordBorrow();var o=e.getExposedContainerBox?e.getExposedContainerBox(r,n):e.getContainerBox?e.getContainerBox(r,n):null;if(o&&t===d.Render.CoordPos.CORNER_TL){var a={x:(o.x2-o.x1)/2,y:(o.y2-o.y1)/2};i.x=i.x-a.x,i.y=i.y+a.y}}return i},setObjCoord:function(e,t,r){this.doSetObjCoord(e,t,r),this.objectChanged(e)},doSetObjCoord:function(e,t,r){var n=Object.create(t),i=this.getCoordMode();if(i===d.CoordMode.COORD2D&&d.ObjUtils.notUnset(r)&&r!==d.Render.CoordPos.DEFAULT){var o=this.getAllowCoordBorrow(),a=e.getExposedContainerBox?e.getExposedContainerBox(i,o):e.getContainerBox?e.getContainerBox(i,o):null;if(a){var s={x:(a.x2-a.x1)/2,y:(a.y2-a.y1)/2};r===d.Render.CoordPos.CORNER_TL&&(n.x=t.x+s.x,n.y=t.y-s.y)}}e.setAbsBaseCoord?e.setAbsBaseCoord(n,i):e.setAbsCoordOfMode?e.setAbsCoordOfMode(n,i):e.setAbsCoordOfMode&&e.setCoordOfMode(n,i)},getObjectContextCoord:function(e,t){var r=this.getObjCoord(e,t);return this.objCoordToContext(r)},setObjectContextCoord:function(e,t,r){var n=this.contextCoordToObj(t);n&&this.setObjCoord(e,n,r)},getObjectScreenCoord:function(e,t){var r=this.getObjCoord(e,t);return this.objCoordToScreen(r)},setObjectScreenCoord:function(e,t,r){var n=this.screenCoordToObj(t);n&&this.setObjCoord(e,n,r)},getCoord:function(e,t,r){var n=this.getObjCoord(e,r);return this.translateCoord(n,d.Editor.CoordSys.OBJ,t)},setCoord:function(e,t,r,n){var i=this.translateCoord(t,r,d.Editor.CoordSys.OBJ);this.setObjCoord(e,i,n)},getSize:function(e,t){var r=this.getObjSize(e);return this.translateCoord(r,d.Editor.CoordSys.OBJ,t)},setSize:function(e,t,r){var n=this.translateCoord(t,r,d.Editor.CoordSys.OBJ);this.setObjSize(e,n)},translateCoord:function(e,t,r){if(!e)return null;var n=d.Editor.CoordSys;if(t===n.SCREEN){if(r===n.SCREEN)return e;if(r===n.CONTEXT)return this.getObjDrawBridge()?this.getObjDrawBridge().transformScreenCoordToContext(this.getObjContext(),e):e;var i=this.getObjDrawBridge()?this.getObjDrawBridge().transformScreenCoordToContext(this.getObjContext(),e):e;return this.getObjContext()?this.getRootRenderer().transformCoordToObj(this.getObjContext(),this.getChemObj(),i):e}return t===n.CONTEXT?r===n.SCREEN?this.getObjDrawBridge()?this.getObjDrawBridge().transformContextCoordToScreen(this.getObjContext(),e):e:r===n.CONTEXT?e:this.getObjContext()?this.getRootRenderer().transformCoordToObj(this.getObjContext(),this.getChemObj(),e):e:r===n.SCREEN?(i=this.getRootRenderer().transformCoordToContext(this.getObjContext(),this.getChemObj(),e),this.getObjDrawBridge()?this.getObjDrawBridge().transformContextCoordToScreen(this.getObjContext(),i):e):r===n.CONTEXT&&this.getObjContext()?this.getRootRenderer().transformCoordToContext(this.getObjContext(),this.getChemObj(),e):e},translateDistance:function(e,t,r){var n={x:e,y:0,z:0},i=this.translateCoord({x:0,y:0,z:0},t,r),o=this.translateCoord(n,t,r);return d.CoordUtils.getDistance(i,o)},transformCoordAndSizeOfObjects:function(e,t){var r=this.getCoordMode(),n=this.getAllowCoordBorrow(),i=r===d.CoordMode.COORD3D?d.CoordUtils.calcTransform3DMatrix(t):d.CoordUtils.calcTransform2DMatrix(t),o=Object.extend({},t);o=Object.extend(o,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});for(var a=r===d.CoordMode.COORD3D?d.CoordUtils.calcTransform3DMatrix(o):d.CoordUtils.calcTransform2DMatrix(o),s=0,l=e.length;s<l;++s){var u=e[s];u.transformAbsCoordByMatrix(i,a,r,!0,n),u.scaleSize(t.scale,r,!0,n)}},objCoordToContext:function(e){var t=d.Editor.CoordSys;return this.translateCoord(e,t.OBJ,t.CONTEXT)},contextCoordToObj:function(e){var t=d.Editor.CoordSys;return this.translateCoord(e,t.CONTEXT,t.OBJ)},objCoordToScreen:function(e){var t=d.Editor.CoordSys;return this.translateCoord(e,t.OBJ,t.SCREEN)},screenCoordToObj:function(e){var t=d.Editor.CoordSys;return this.translateCoord(e,t.SCREEN,t.OBJ)},screenCoordToContext:function(e){var t=d.Editor.CoordSys;return this.translateCoord(e,t.SCREEN,t.CONTEXT)},contextCoordToScreen:function(e){var t=d.Editor.CoordSys;return this.translateCoord(e,t.CONTEXT,t.SCREEN)},screenBoxToContext:function(e){var t=this.screenCoordToContext({x:e.x1,y:e.y1}),r=this.screenCoordToContext({x:e.x2,y:e.y2});return{x1:t.x,y1:t.y,x2:r.x,y2:r.y}},createDefaultNode:function(e,t,r){var n=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId(),i=new d.Atom;return i.setIsotopeId(n),r&&r.appendNode(i),this.setCoord(i,e,t),i},operationDone:function(e){this.doOperationDone(e)},doOperationDone:function(e){},clearOperHistory:function(){var e=this.getOperHistory();e&&e.clear()},pushOperation:function(e,t){if(e){var r=this.getOperHistory();if(r&&r.push(e),this.getOperationsInCurrManipulation().push(e),t){this.beginUpdateObject();try{e.execute()}finally{this.endUpdateObject()}}}},popOperation:function(e){var t,r=this.getOperHistory();if(r){if(t=r.pop(),e){this.beginUpdateObject();try{t.reverse()}finally{this.endUpdateObject()}}var n=this.getOperationsInCurrManipulation(),i=n.indexOf(t);return i>=0&&n.splice(i,1),t}return null},execOperation:function(e){var r=t.toArray(e);this.beginManipulateAndUpdateObject();try{for(var n=0,i=r.length;n<i;++n){var o=r[n];o.execute(),this.getEnableOperHistory()&&this.pushOperation(o,!1)}}finally{this.endManipulateAndUpdateObject()}return this},execOperations:function(e){if(1===e.length)return this.execOperation(e[0]);var t=new d.MacroOperation(e);return this.execOperation(t)},replaceOperationInHistory:function(e,t){var r=this.getOperHistory();return r&&r.replaceOperation(e,t)},undo:function(){var e,t=this.getOperHistory();if(t){this.beginUpdateObject();try{e=t.undo()}finally{this.endUpdateObject(),e&&this.operationDone(e)}}return e},redo:function(){var e,t=this.getOperHistory();if(t){this.beginUpdateObject();try{e=t.redo()}finally{this.endUpdateObject(),e&&this.operationDone(e)}}return e},undoAll:function(){var e,t=this.getOperHistory();if(t){this.beginUpdateObject();try{e=t.undoAll()}finally{this.endUpdateObject()}}return e},canUndo:function(){var e=this.getOperHistory();return!!e&&e.canUndo()},canRedo:function(){var e=this.getOperHistory();return!!e&&e.canRedo()},modifyObjects:function(e,t,r){var n=d.ArrayUtils.toArray(e);try{for(var i=new d.MacroOperation,o=0,a=n.length;o<a;++o){var s=n[o],l=new d.ChemObjOperation.Modify(s,t,this);i.add(l)}i.execute()}finally{r&&this.getEnableOperHistory()&&i.getChildCount()&&this.pushOperation(i)}return this},modifyObjectsRenderOptions:function(e,t,r,n){var i=d.ArrayUtils.toArray(e),o=r?"render3DOptions":"renderOptions",a=r?"getRender3DOptions":"getRenderOptions";try{for(var s=new d.MacroOperation,l=0,u=i.length;l<u;++l){var c=i[l];if(c[a]){var h=c[a](),p=Object.extend({},h);p=Object.extend(p,t);var g={};g[o]=p;var f=new d.ChemObjOperation.Modify(c,g,this);s.add(f)}}this.beginManipulateAndUpdateObject(),s.execute()}finally{n&&this.getEnableOperHistory()&&s.getChildCount()&&this.pushOperation(s),this.endManipulateAndUpdateObject()}return this},getClientDimension:function(){var e=this.getElement();return{width:e.clientWidth,height:e.clientHeight}},getClientScrollPosition:function(){var e=this.getEditClientElem().parentNode;return e?{x:e.scrollLeft,y:e.scrollTop}:null},getClientScrollCoord:function(t){var r=this.getClientScrollPosition();return e.isUnset(t)||t===d.Editor.CoordSys.SCREEN?r:this.translateCoord(r,d.Editor.CoordSys.SCREEN,t)},getClientVisibleRect:function(){var e=this.getClientDimension(),t=this.getClientScrollPosition();return e.x1=e.left=t.x,e.y1=e.top=t.y,e.x2=e.x1+e.width,e.y2=e.y1+e.height,e},scrollClientTo:function(e,t){return this.scrollClientToCoord({y:e,x:t})},scrollClientToTop:function(){return this.scrollClientTo(0,null)},scrollClientToBottom:function(){var e=this.getEditClientElem(),t=d.HtmlElementUtils.getElemClientDimension(e);return this.scrollClientTo(t.height,null)},scrollClientToCoord:function(t,r,n){var i,o=e.notUnset(t.x),a=e.notUnset(t.y),s=n&&n.scrollToCenter;if(i=e.isUnset(r)?t:this.translateCoord(t,r,d.Editor.CoordSys.SCREEN),s){var l=this.getVisibleClientScreenBox(),u={x:l.width/2,y:l.height/2};i=d.CoordUtils.substract(i,u)}var c=this.getEditClientElem().parentNode;return a&&(c.scrollTop=i.y),o&&(c.scrollLeft=i.x),this},scrollClientToObject:function(e,r){if(d.BoxUtils,!e)return this;var n=this.getChemObj();if(!n)return this;var i=t.toArray(e),o=this._getTargetObjsExposedContainerBoxInfo(i,n),a=o.totalBox,s=o.boxes;if(a){var l=Object.extend({scrollToCenter:!0,coverMostObjs:!0},r||{});return this._scrollClientToContainerBox(a,s,l)}return this},_scrollClientToContainerBox:function(e,t,r){var n,i=d.BoxUtils,o=this.getVisibleClientBoxOfSys(d.Editor.CoordSys.CHEM);n=(e.x2-e.x1>o.x2-o.x1||e.y2-e.y1>o.y2-o.y1)&&r.coverMostObjs?this._getMostIntersectedContainerBox(o.x2-o.x1,o.y2-o.y1,t,e):e;var a=r.scrollToCenter?i.getCenterCoord(n):{x:n.x1,y:n.y2};return this.scrollClientToCoord(a,d.Editor.CoordSys.CHEM,r)},_getTargetObjsExposedContainerBoxInfo:function(e,t){var r=d.BoxUtils;if(t||(t=this.getChemObj()),t)for(var n=null,i=[],o=0,a=e.length;o<a;++o){var s=e[o];if(s.getExposedContainerBox&&s.isChildOf&&s.isChildOf(t)){var l=s.getExposedContainerBox(this.getCoordMode());l&&(i.push(l),n=n?r.getContainerBox(n,l):l)}}return{totalBox:n,boxes:i}},_getMostIntersectedContainerBox:function(e,t,r,i){for(var o,a=d.BoxUtils,s=function(r,o){var s=n.add(r,{x:e*o.x,y:t*o.y});s.x<i.x1?s.x=i.x1:s.x>i.x2&&(s.x=i.x2),s.y<i.y1?s.y=i.y1:s.y>i.y2&&(s.y=i.y2);var l=n.add(s,{x:-e*o.x,y:-t*o.y});return a.createBox(l,s)},l=function(e,t){for(var r=0,n=0,i=t.length;n<i;++n){var o=t[n];a.hasIntersection(o,e)&&++r}return r},u=0,c=0,h=r.length;c<h;++c)for(var p=a.getCornerCoords(r[c]),g=[s(p[0],{x:1,y:1}),s(p[1],{x:1,y:-1}),s(p[2],{x:-1,y:1}),s(p[3],{x:-1,y:-1})],f=0,m=g.length;f<m;++f){var C=l(g[f],r);C>u&&(u=C,o=g[f])}return o},doBeforeDispatchUiEvent:function(e){var r=e.getType();if(["pointerdown","pointermove","pointerup"].indexOf(r)>=0&&(this.setCurrPointerType(e.pointerType),"pointermove"===r&&this.isRenderable())){var n=this._getEventMouseCoord(e,this.getCoreElement()),i=this.getBasicObjectsAtCoord(n,this.getCurrBoundInflation())||[],o=this.getHoveredBasicObjs();this.setPropStoreFieldValue("hoveredBasicObjs",i),o&&i.length===o.length&&t.intersect(o,i).length===i.length||this.notifyHoverOnObjs(i)}return this.tryApplySuper("doBeforeDispatchUiEvent",[e])},notifyHoverOnObjs:function(e){var t=this.getChemObjsHint(e);this.updateHintForChemObject(t),this.invokeEvent("hoverOnObjs",{objs:e})},reactHotKeys:function(e){if(this.getEditorConfigs().getInteractionConfigs().getEnableHotKey()){for(var t=this.getEditorConfigs().getHotKeyConfigs().getHotKeys(),r=d.Widget.KeyboardUtils.getKeyParamsFromEvent(e),n=!1,i=[],o=t.length-1;o>=0;--o){var a=d.Widget.KeyboardUtils.shortcutLabelToKeyParams(t[o].key,null,!1);if(a.repeat=t[o].repeat,d.Widget.KeyboardUtils.matchKeyParams(r,a,!1)){var s=t[o].action;if(s){var l=this.getChildAction(s,!0);if(l)if(l instanceof d.Editor.ActionOperationCreate.Base){var u=l.createOperations(this);(n=!(!u||!u.length)||n)&&(i=i.concat(u))}else n=l.execute(this,e)||n}}}if(i.length&&this.execOperations(i),n)return e.stopPropagation(),e.preventDefault(),!0}},react_keydown:function(e){if(!this.tryApplySuper("react_keydown",[e]))return this.reactHotKeys(e)}}),d.Editor.BaseEditor.Settings=Class.create(d.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.Editor.BaseEditor.Settings",initProperties:function(){this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getEnableCreateNewDoc()},setter:function(e){this.getEditor().setEnableCreateNewDoc(e)}}),this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getInitOnNewDoc()},setter:function(e){this.getEditor().setInitOnNewDoc(e)}}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getEnableOperHistory()},setter:function(e){this.getEditor().setEnableOperHistory(e)}}),this.defineProp("enableIssueCheck",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getEnableIssueCheck()},setter:function(e){this.getEditor().setEnableIssueCheck(e)}})},getEditor:function(){return this.getDisplayer()}}),d.Editor.IaControllerManager={_controllerMap:new d.MapEx(!0),register:function(e,t){a._controllerMap.set(e,t)},unregister:function(e){a._controllerMap.remove(e)},getAllControllerClasses:function(){return a._controllerMap.getKeys()},getAvailableControllerClasses:function(e){for(var t=[],r=a.getAllControllerClasses(),n=0,i=r.length;n<i;++n){var o=r[n],s=a._controllerMap.get(o);s&&!ClassEx.isOrIsDescendantOf(e,s)||t.push(o)}return t}};var a=d.Editor.IaControllerManager;d.Editor.BaseEditorBaseIaController=Class.create(d.Widget.InteractionController,{CLASS_NAME:"Kekule.Editor.BaseEditorIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},_defineEditorConfigBasedProperty:function(e,t,r){var n={dataType:DataType.VARIANT,serializable:!1,setter:null};r&&r.overwrite?(n.getter=function(){var r=this.getPropStoreFieldValue(e),n=this.getEditorConfigs();return r&&n.getCascadePropValue(t)},n.setter=function(t){this.setPropStoreFieldValue(e,t)}):n.getter=function(){return this.getEditorConfigs().getCascadePropValue(t)};var i=Object.extend(n,r||{});this.defineProp(e,i)},getDefId:function(){return d.ClassUtils.getLastClassName(this.getClassName())},getEditor:function(){return this.getWidget()},setEditor:function(e){return this.setWidget(e)},getEditorConfigs:function(){var e=this.getEditor();return e?e.getEditorConfigs():null}}),d.Editor.BaseEditorIaController=Class.create(d.Editor.BaseEditorBaseIaController,{CLASS_NAME:"Kekule.Editor.BaseEditorIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("manuallyHotTrack",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("currBoundInflation",{dataType:DataType.NUMBER,serializable:!1,getter:function(){return this.getEditor().getCurrBoundInflation()},setter:null}),this.defineProp("activePointerType",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getEditor();return e&&e.getCurrPointerType()||this.getPropStoreFieldValue("activePointerType")},setter:function(e){var t=this.getEditor();t?t.setCurrPointerType(e):this.setStoreFieldValue("activePointerType",e)}})},notifyEditorBeginManipulateObjects:function(){this.getEditor().beginManipulateObject()},notifyEditorEndManipulateObjects:function(){this.getEditor().endManipulateObject()},getInteractionBoundInflation:function(e){return this.getEditor().getInteractionBoundInflation(e)},handleUiEvent:function(e){var t=!1,r=e.getTarget&&e.getTarget()||e.target,n=this.getEditor().getUiEventReceiverElem();n?(r===n||d.DomUtils.isDescendantOf(r,n))&&(t=!0):t=!0,t&&this.tryApplySuper("handleUiEvent",[e])},canInteractWithObj:function(e){return!!e},getInteractableTargetClasses:function(){return null},getAllInteractableObjsAtScreenCoord:function(e){return this.getEditor().getBasicObjectsAtCoord(e,this.getCurrBoundInflation(),null,this.getInteractableTargetClasses())},getTopmostInteractableObjAtScreenCoord:function(e){var t=this.getAllInteractableObjsAtScreenCoord(e);if(t)for(var r=0,n=t.length;r<n;++r)if(this.canInteractWithObj(t[r]))return t[r];return null},getTopmostInteractableObjAtCurrPointerPos:function(){var e=this.getEditor().getHoveredBasicObjs();if(e)for(var t=0,r=e.length;t<r;++t)if(this.canInteractWithObj(e[t]))return e[t];return null},hotTrackOnObj:function(e){this.getEditor().hotTrackOnObj(e)},zoomEditor:function(e,t){e>0?this.getEditor().zoomIn(e,t):e<0&&this.getEditor().zoomOut(-e,t)},_filterBasicObjectsInEditor:function(e){for(var t=this.getEditor().getChemObj(),r=[],n=0,i=e.length;n<i;++n){var o=e[n];o.isChildOf(t)&&r.push(o)}return r},doneInsertOrModifyBasicObjects:function(e){if(this.needAutoSelectNewlyInsertedObjects()){var t=this._filterBasicObjectsInEditor(e);this.getEditor().select(t)}},needAutoSelectNewlyInsertedObjects:function(){var e=this.getActivePointerType(),t=this.getEditorConfigs().getInteractionConfigs();return t.getAutoSelectNewlyInsertedObjectsOnTouch()&&"touch"===e||t.getAutoSelectNewlyInsertedObjects()},react_pointerdown:function(e){return this.setActivePointerType(e.pointerType),e.preventDefault(),!0},react_pointermove:function(e){var t=this.getTopmostInteractableObjAtCurrPointerPos();return this.getManuallyHotTrack()||(t?this.hotTrackOnObj(t):this.hotTrackOnObj(null)),e.preventDefault(),!0},react_mousewheel:function(e){if(e.getCtrlKey()){var t=this._getEventMouseCoord(e);try{var r=e.wheelDeltaY||e.wheelDelta;r&&(r/=120),this.zoomEditor(r,t)}finally{}return e.preventDefault(),!0}},_getEventMouseCoord:function(e,t){var r=t||this.getWidget().getCoreElement();return this.tryApplySuper("_getEventMouseCoord",[e,r])}}),d.Editor.ClientDragScrollIaController=Class.create(d.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.ClientDragScrollIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._isExecuting=!1},canInteractWithObj:function(e){return!1},doTestMouseCursor:function(e,t){return this.isExecuting()?["grabbing","-webkit-grabbing","-moz-grabbing","move"]:["grab","-webkit-grab","-moz-grab","pointer"]},isExecuting:function(){return this._isExecuting},startScroll:function(e){this._startCoord=e,this._originalScrollPos=this.getEditor().getClientScrollPosition(),this._isExecuting=!0},endScroll:function(){this._isExecuting=!1,this._startCoord=null,this._originalScrollPos=null},scrollTo:function(e){if(this.isExecuting()){var t=this._startCoord,r=d.CoordUtils.substract(t,e),n=d.CoordUtils.add(this._originalScrollPos,r);this.getEditor().scrollClientTo(n.y,n.x)}},react_pointerdown:function(e){if(this.setActivePointerType(e.pointerType),e.getButton()===d.X.Event.MouseButton.LEFT){if(!this.isExecuting()){var t={x:e.getScreenX(),y:e.getScreenY()};this.startScroll(t),e.preventDefault()}}else e.getButton()===d.X.Event.MouseButton.RIGHT&&this.isExecuting()&&(this.endScroll(),e.preventDefault())},react_pointerup:function(e){e.getButton()===d.X.Event.MouseButton.LEFT&&this.isExecuting()&&(this.endScroll(),e.preventDefault())},react_pointermove:function(e){if(this.tryApplySuper("react_pointermove",[e]),this.isExecuting()){var t={x:e.getScreenX(),y:e.getScreenY()};this.scrollTo(t),e.preventDefault()}return!0}}),d.Editor.IaControllerManager.register(d.Editor.ClientDragScrollIaController,d.Editor.BaseEditor),d.Editor.BasicEraserIaController=Class.create(d.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicEraserIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._isExecuting=!1},canInteractWithObj:function(e){return!!e},removeObjs:function(e){if(e&&e.length){var t=this.getEditor();t.beginUpdateObject();try{var r=this.doGetActualRemovedObjs(e);this.doRemoveObjs(r)}finally{t.endUpdateObject()}}},doRemoveObjs:function(e){},doGetActualRemovedObjs:function(e){return e},removeSelection:function(){var e=this.getEditor();this.removeObjs(e.getSelection()),e.deselectAll()},removeOnScreenCoord:function(e){var t=this.getEditor().getTopmostBasicObjectAtCoord(e);return!!t&&(this.removeObjs([t]),!0)},startRemove:function(){this._isExecuting=!0},endRemove:function(){this._isExecuting=!1},isRemoving:function(){return this._isExecuting},reactUiEvent:function(e){var t=this.tryApplySuper("reactUiEvent",[e]),r=e.getType();return["touchstart","touchend","touchcancel","touchmove"].indexOf(r)>=0&&e.preventDefault(),t},react_pointerdown:function(e){if(this.setActivePointerType(e.pointerType),e.getButton()===d.X.Event.MOUSE_BTN_LEFT){this.startRemove();var t=this._getEventMouseCoord(e);this.removeOnScreenCoord(t),e.preventDefault()}else e.getButton()===d.X.Event.MOUSE_BTN_RIGHT&&(this.endRemove(),e.preventDefault())},react_pointerup:function(e){e.getButton()===d.X.Event.MOUSE_BTN_LEFT&&(this.endRemove(),e.preventDefault())},react_pointermove:function(e){if(this.tryApplySuper("react_pointermove",[e]),this.isRemoving()){var t=this._getEventMouseCoord(e);this.removeOnScreenCoord(t),e.preventDefault()}return!0}}),d.Editor.IaControllerManager.register(d.Editor.BasicEraserIaController,d.Editor.BaseEditor),d.Editor.BasicManipulationIaController=Class.create(d.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicManipulationIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setState(d.Editor.BasicManipulationIaController.State.NORMAL),this._suppressConstrainedResize=!1,this._manipulationStepBuffer={},this._suspendedOperations=null,this.execManipulationStepBind=this.execManipulationStep.bind(this)},initProperties:function(){this.defineProp("selectMode",{dataType:DataType.INT,serializable:!1}),this.defineProp("enableSelect",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableMove",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableResize",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableRotate",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableGestureManipulation",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("state",{dataType:DataType.INT,serializable:!1}),this.defineProp("baseCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("startCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("endCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("startBox",{dataType:DataType.HASH,serializable:!1}),this.defineProp("endBox",{dataType:DataType.HASH,serializable:!1}),this.defineProp("lastRotateAngle",{dataType:DataType.FLOAT,serializable:!1}),this.defineProp("rotateRefCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("rotateCenter",{dataType:DataType.HASH,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("rotateCenter");if(!e){var t=this._getManipulateObjsCenterCoord();e=this.getEditor().objCoordToScreen(t),this.setPropStoreFieldValue("rotateCenter",e)}return e}}),this.defineProp("resizeStartingRegion",{dataType:DataType.INT,serializable:!1}),this.defineProp("enableAspectRatioLockedResize",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("rotateStartingRegion",{dataType:DataType.INT,serializable:!1}),this.defineProp("manipulateOriginObjs",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("manipulateObjs",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){this.setPropStoreFieldValue("manipulateObjs",e),e?this.getEditor().prepareOperatingObjs(e):this.getEditor().endOperatingObjs()}}),this.defineProp("manipulateObjInfoMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("manipulateObjInfoMap");return e||(e=new d.MapEx(!0),this.setPropStoreFieldValue("manipulateObjInfoMap",e)),e}}),this.defineProp("manipulateObjCurrInfoMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("manipulateObjCurrInfoMap");return e||(e=new d.MapEx(!0),this.setPropStoreFieldValue("manipulateObjCurrInfoMap",e)),e}}),this.defineProp("manipulationType",{dataType:DataType.INT,serializable:!1}),this.defineProp("isManipulatingSelection",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("isOffsetManipulating",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("manipulationPointerType",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getActivePointerType()},setter:function(e){this.setActivePointerType(e)}}),this.defineProp("moveOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("moveWrapperOperation",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("objOperationMap",{dataType:"Kekule.MapEx",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("objOperationMap");return e||(e=new d.MapEx(!0),this.setPropStoreFieldValue("objOperationMap",e)),e}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableSelect(!1),this.setEnableGestureManipulation(!1);var e=d.globalOptions.get("chemWidget.editor")||{},t=d.oneOf;this.setEnableMove(t(e.enableMove,!0)),this.setEnableResize(t(e.enableResize,!0)),this.setEnableAspectRatioLockedResize(t(e.enableAspectRatioLockedResize,!0)),this.setEnableRotate(t(e.enableRotate,!0))},doFinalize:function(){var e=this.getPropStoreFieldValue("manipulateObjInfoMap");e&&e.clear(),(e=this.getPropStoreFieldValue("objOperationMap"))&&e.clear(),this.tryApplySuper("doFinalize")},hotTrackOnObj:function(e){if(this.getEnableSelect()&&this.getSelectMode()===d.Editor.SelectMode.ANCESTOR){var t=this.getStandaloneAncestor(e);return e&&e.getStandaloneAncestor&&e.getStandaloneAncestor(),this.tryApplySuper("hotTrackOnObj",[t])}return this.tryApplySuper("hotTrackOnObj",[e])},getStandaloneAncestor:function(e){return e&&e.getStandaloneAncestor?e.getStandaloneAncestor():e},isInAncestorSelectMode:function(){return this.getEnableSelect()&&this.getSelectMode()===d.Editor.SelectMode.ANCESTOR},isAspectRatioLockedResize:function(){return this.getEnableAspectRatioLockedResize()&&!this._suppressConstrainedResize},getCoordOnSelectionRotationRegion:function(e){var t=d.Editor.BoxRegion,r=this.getEditor();if(r.getCoordRegionInSelectionMarker(e)!==t.OUTSIDE)return!1;var n=r.getEditorConfigs().getInteractionConfigs().getRotationRegionInflation(),i=r.getUiSelectionAreaContainerBox();if(i&&r.hasSelection()){for(var o=[t.CORNER_TL,t.CORNER_TR,t.CORNER_BR,t.CORNER_BL],a=[{x:i.x1,y:i.y1},{x:i.x2,y:i.y1},{x:i.x2,y:i.y2},{x:i.x1,y:i.y2}],s=!1,l=n,u=0,c=o.length;u<c;++u){var h=o[u],p=a[u],g=d.CoordUtils.getDistance(p,e);g<=l&&(s=h,l=g)}return s}return!1},createManipulateOperation:function(){return this.doCreateManipulateMoveAndResizeOperation()},doCreateManipulateMoveAndResizeOperation:function(){var e=[];this.setMoveOperations(e);var t=this.getManipulateObjs(),r=this.getManipulateObjInfoMap();this.getObjOperationMap().clear();var n=new d.ChemObjOperation.MoveAndResizeObjs([],[],this.getEditor().getCoordMode(),!0,this.getEditor());n.setDisableIndirectCoord(!0);for(var i=0,o=t.length;i<o;++i){var a=t[i],s=r.get(a),l=new d.ChemObjOperation.MoveAndResize(a,null,null,this.getEditor().getCoordMode(),!0,this.getEditor());l.setAllowCoordBorrow(this.getEditor().getAllowCoordBorrow()),l.setOldCoord(s.objCoord),l.setOldDimension(s.size),e.push(l),n.getChildOperations().push(l),this.setMoveWrapperOperation(n)}return[n]},updateChildMoveOperation:function(e,t,r){this.getMoveOperations()[e].setNewCoord(r)},updateChildResizeOperation:function(e,t,r){this.getMoveOperations()[e].setNewDimension(r)},getAllObjOperations:function(e){var t=this.getMoveOperations(),r=t?d.ArrayUtils.clone(t):[];if(r.length){var n=this.getMoveWrapperOperation();return n.setChildOperations(r),[n]}return[]},getActiveOperation:function(e){var t=this.getAllObjOperations(e);return(t=d.ArrayUtils.toUnique(t)).length<=0?null:1===t.length?t[0]:new d.MacroOperation(t)},reverseActiveOperation:function(){return this.getActiveOperation().reverse()},addOperationToEditor:function(){var e=this.getEditor();if(e&&e.getEnableOperHistory()){var t=this.getActiveOperation(!0);t&&e.pushOperation(t)}},getCurrAvailableManipulationTypes:function(){var e=d.Editor.BasicManipulationIaController.ManipulationType,t=this.getEditor().getSelectionContainerBox();if(t){var r=[];return this.getEnableMove()&&r.push(e.MOVE),d.NumUtils.isFloatEqual(t.x1,t.x2,1e-10)&&d.NumUtils.isFloatEqual(t.y1,t.y2,1e-10)||(this.getEnableResize()&&r.push(e.RESIZE),this.getEnableRotate()&&r.push(e.ROTATE),(this.getEnableResize()||this.getEnableRotate())&&r.push(e.TRANSFORM)),r}return[]},getActualManipulatingObjects:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r],o=i.getCoordDependentObjects?i.getCoordDependentObjects():[i];d.ArrayUtils.pushUnique(t,o)}return t},doPrepareManipulatingObjects:function(e,t){var r=this.getActualManipulatingObjects(e);this.setManipulateOriginObjs(e),this.setManipulateObjs(r);var n=this.getManipulateObjInfoMap();n.clear(),this.getEditor();for(var i=0,o=r.length;i<o;++i){var a=r[i],s=this.createManipulateObjInfo(a,i,t);n.set(a,s)}},doPrepareManipulatingStartingCoords:function(e,t,r,n){this.setStartBox(t),this.setRotateCenter(r),this.setRotateRefCoord(n),this.setLastRotateAngle(null)},prepareManipulating:function(e,t,r,n,i,o){this.setManipulationType(e),this.doPrepareManipulatingObjects(t,r),this.doPrepareManipulatingStartingCoords(r,n,i,o),this.createManipulateOperation(),this._cachedTransformCompareThresholds=null,this._runManipulationStepId=d.window.requestAnimationFrame(this.execManipulationStepBind)},cancelManipulate:function(){this.getEditor(),this.getManipulateObjs(),this.reverseActiveOperation(),this.notifyCoordChangeOfObjects(this.getManipulateObjs()),this.manipulateEnd()},_getManipulateObjsCenterCoord:function(){var e=this.getManipulateObjs();if(!e||!e.length)return null;for(var t=this.getEditor().getCoordMode(),r=this.getEditor().getAllowCoordBorrow(),n={x:0,y:0,z:0},i=0,o=e.length;i<o;++i){var a=e[i],s=a.getAbsBaseCoord?a.getAbsBaseCoord(t,r):a.getAbsCoord?a.getAbsCoord(t,r):a.getCoordOfMode?a.getCoordOfMode(t,r):null;s&&(n=d.CoordUtils.add(n,s))}return d.CoordUtils.divide(n,e.length)},_maniplateObjsFrameEnd:function(e){},_addManipultingObjNewInfo:function(e,t){var r=this.getManipulateObjCurrInfoMap(),n=r.get(e)||{};n=Object.extend(n,t),r.set(e,n)},applyManipulatingObjsInfo:function(e){var t=this.getManipulateObjs(),r=this.getManipulateObjCurrInfoMap(),n=this._getIndirectCoordObjs(t);this._setEnableIndirectCoordOfObjs(n,!1);try{for(var i=0,o=t.length;i<o;++i){var a=t[i],s=r.get(a);this.applySingleManipulatingObjInfo(i,a,s,e)}}finally{this._setEnableIndirectCoordOfObjs(n,!0)}},_getIndirectCoordObjs:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r];i.getEnableIndirectCoord&&i.getEnableIndirectCoord()&&t.push(i)}return t},_setEnableIndirectCoordOfObjs:function(e,t){if(e)for(var r=0,n=e.length;r<n;++r)e[r].setEnableIndirectCoord(t)},applySingleManipulatingObjInfo:function(e,t,r,n){r&&(r.screenCoord&&this.doMoveManipulatedObj(e,t,r.screenCoord,n),r.size&&this.doResizeManipulatedObj(e,t,r.size))},_calcRotateAngle:function(e){var t,r=d.CoordUtils,n=!1,i=this.getRotateCenter(),o=this.getRotateRefCoord()||this.getStartCoord(),a=this.getEditorConfigs().getInteractionConfigs().getRotationLocationPointDistanceThreshold();if(a){if(r.getDistance(o,i)<a)return t=0,n=!0,this.setStartCoord(e),!1;if(r.getDistance(e,i)<a)return t=0,n=!0,!1}if(!n){var s=r.substract(e,i),l=Math.atan2(s.y,s.x);s=r.substract(o,i);var u=Math.atan2(s.y,s.x);t=l-u}return{angle:t,startAngle:u,endAngle:l}},_calcActualRotateAngle:function(e,t,r,n){return t},_calcManipulateObjsRotationParams:function(e,t){if(!this.getEnableRotate())return!1;var r=this.getRotateCenter(),n=this._calcRotateAngle(t);if(!n)return!1;var i=this._calcActualRotateAngle(e,n.angle,n.startAngle,n.endAngle),o=this.getLastRotateAngle();return(!d.ObjUtils.notUnset(o)||!d.NumUtils.isFloatEqual(i,o,.0175))&&(this.setLastRotateAngle(i),{center:r,rotateAngle:i})},_calcActualResizeScales:function(e,t){return t},_calcManipulateObjsResizeParams:function(e,t,r){if(!this.getEnableResize())return!1;var n,i,o=d.Editor.BoxRegion,a=d.CoordUtils,s=this.getStartBox(),l=a.substract(r,this.getStartCoord());t===o.EDGE_TOP?(l.x=0,n={x:(s.x1+s.x2)/2,y:s.y2}):t===o.EDGE_BOTTOM?(l.x=0,n={x:(s.x1+s.x2)/2,y:s.y1}):t===o.EDGE_LEFT?(l.y=0,n={x:s.x2,y:(s.y1+s.y2)/2}):t===o.EDGE_RIGHT?(l.y=0,n={x:s.x1,y:(s.y1+s.y2)/2}):(this.isAspectRatioLockedResize()&&(i=!0),n=t===o.CORNER_TL?{x:s.x2,y:s.y2}:t===o.CORNER_TR?{x:s.x1,y:s.y2}:t===o.CORNER_BL?{x:s.x2,y:s.y1}:{x:s.x1,y:s.y1});var u,c,h=t===o.CORNER_TL||t===o.CORNER_BL||t===o.EDGE_LEFT,p=t===o.CORNER_TL||t===o.CORNER_TR||t===o.EDGE_TOP;if(u=d.NumUtils.isFloatEqual(s.x1,s.x2,1e-10)?1:1+l.x/(s.x2-s.x1)*(h?-1:1),c=d.NumUtils.isFloatEqual(s.y1,s.y2,1e-10)?1:1+l.y/(s.y2-s.y1)*(p?-1:1),i){var g=Math.abs(u),f=Math.abs(c);g>=f?c=(Math.sign(c)||1)*g:u=(Math.sign(u)||1)*f}var m=this._calcActualResizeScales(e,{scaleX:u,scaleY:c});return{center:n,scaleX:m.scaleX,scaleY:m.scaleY}},_calcManipulateObjsTransformInfo:function(e,t){for(var r=d.CoordUtils,n=r.calcTransform2DMatrix(t),i=t.scaleX||t.scale,o=t.scaleY||t.scale,a=this._isManipulatingSingleStickedObj(e),s=0,l=e.length;s<l;++s){var u=e[s],c=this.getManipulateObjInfoMap().get(u),h={};if(!c.hasNoCoord){var p=c.screenCoord;if(!c.stickTarget||a){var g=r.transform2DByMatrix(p,n);h.screenCoord=g}else h.screenCoord=p}if(c.size&&(i||o)){var f={x:c.size.x*Math.abs(i||1),y:c.size.y*Math.abs(o||1)};h.size=f}this._addManipultingObjNewInfo(u,h)}return!0},_isStickedObj:function(e){return e&&e.getCoordStickTarget&&e.getCoordStickTarget()},_isManipulatingSingleStickedObj:function(e){var t=!1;if(1===e.length){var r=e[0];t=!!this.getManipulateObjInfoMap().get(r).stickTarget}return t},doTransformManipulatedObjs:function(e,t,r){var n=d.Editor.BasicManipulationIaController.ManipulationType,i=this.getEditor(),o=this.getManipulateObjs(),a=r;if(a||(e===n.RESIZE?a=this._calcManipulateObjsResizeParams(o,this.getResizeStartingRegion(),t):e===n.ROTATE&&(a=this._calcManipulateObjsRotationParams(o,t))),(!this._lastTransformParams||!this._isSameTransformParams(this._lastTransformParams,a,null,i.getCoordMode()))&&a&&this._calcManipulateObjsTransformInfo(o,a)){this._lastTransformParams=a,i.beginUpdateObject(),this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(t),this._maniplateObjsFrameEnd(o),this.notifyCoordChangeOfObjects(o)}finally{i.endUpdateObject(),this.manipulateStepDone()}}},_isSameTransformParams:function(e,t,r,i){return r||(r=this._cachedTransformCompareThresholds),r||(r=this._getTransformCompareThresholds(),this._cachedTransformCompareThresholds=r),i===d.CoordMode.COORD2D?n.isSameTransform2DOptions(e,t,{translate:r.translate,scale:r.scale,rotate:r.rotate}):n.isSameTransform3DOptions(e,t,{translate:r.translate,scale:r.scale,rotate:r.rotate})},_getTransformCompareThresholds:function(e){return{translate:.1,scale:.1,rotate:.1}},_calcActualMovedScreenCoord:function(e,t,r){return r},_calcManipulateObjsMoveInfo:function(e,t){var r=d.CoordUtils,n=(this.getManipulateObjCurrInfoMap(),this.getEditor()),i=this._isManipulatingSingleStickedObj(e),o=this.isDirectManipulating()&&1===e.length,a=!o||e[0]&&e[0].getSizeOfMode&&e[0].getSizeOfMode(n.getCoordMode(),n.getAllowCoordBorrow()),s=o&&!a&&this.getEditorConfigs().getInteractionConfigs().getFollowPointerCoordOnDirectManipulatingSingleObj();if(s){var l=this.getStartCoord();r.getDistance(t,l)<=this.getEditorConfigs().getInteractionConfigs().getFollowPointerCoordOnDirectManipulatingSingleObjDistanceThreshold()&&(s=!1)}for(var u=0,c=e.length;u<c;++u){var h,p=e[u],g=this.getManipulateObjInfoMap().get(p);g.hasNoCoord||g.stickTarget&&!i||(h=s?t:r.add(t,g.screenCoordOffset),h=this._calcActualMovedScreenCoord(p,g,h),this._addManipultingObjNewInfo(p,{screenCoord:h}))}},moveManipulatedObjs:function(e){d.CoordUtils;var t=this.getEditor(),r=this.getManipulateObjs();this._calcManipulateObjsMoveInfo(r,e),t.beginUpdateObject(),this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(e),this._maniplateObjsFrameEnd(r),this.notifyCoordChangeOfObjects(r)}finally{t.endUpdateObject(),this.manipulateStepDone()}},doMoveManipulatedObj:function(e,t,r,n){var i=this.getEditor();this.updateChildMoveOperation(e,t,i.screenCoordToObj(r)),i.setObjectScreenCoord(t,r)},doResizeManipulatedObj:function(e,t,r){this.updateChildResizeOperation(e,t,r),t.setSizeOfMode&&t.setSizeOfMode(r,this.getEditor().getCoordMode())},isDirectManipulating:function(){return this.getState()===d.Editor.BasicManipulationIaController.State.MANIPULATING&&!this.getIsManipulatingSelection()},startDirectManipulate:function(e,t,r,n,i,o){return this.manipulateBegin(),this.doStartDirectManipulate(e,t,r,n,i,o)},doStartDirectManipulate:function(e,t,r,n,i,o){var a=d.ArrayUtils.toArray(t);this.setState(d.Editor.BasicManipulationIaController.State.MANIPULATING),this.setBaseCoord(r),this.setStartCoord(r),this.setRotateRefCoord(o),this.setIsManipulatingSelection(!1),this.prepareManipulating(e||d.Editor.BasicManipulationIaController.ManipulationType.MOVE,a,r,n,i,o)},manipulateStepDone:function(){},doManipulateObjectsEnd:function(e){for(var t=this.getManipulateObjInfoMap(),r=e.length-1;r>=0;--r)this.doManipulateObjectEnd(e[r],t.get(e[r]))},doManipulateObjectEnd:function(e,t){},manipulateBegin:function(){this.notifyEditorBeginManipulateObjects()},manipulateEnd:function(){this._runManipulationStepId&&(d.window.cancelAnimationFrame(this._runManipulationStepId),this._runManipulationStepId=null),this.doManipulateObjectsEnd(this.getManipulateObjs()),this._lastTransformParams=null,this.setIsOffsetManipulating(!1),this.setManipulateObjs(null),this.getManipulateObjInfoMap().clear(),this.getObjOperationMap().clear(),this.notifyEditorEndManipulateObjects()},manipulateBeforeStopping:function(){},stopManipulate:function(){this.manipulateEnd()},refreshManipulateObjs:function(){this.setManipulateObjs(this.getManipulateObjs())},createManipulateObjInfo:function(e,t,r){var n=this.getEditor(),i={objCoord:n.getObjCoord(e),screenCoord:n.getObjectScreenCoord(e),size:n.getObjSize(e),enableIndirectCoord:!(!e.getEnableIndirectCoord||!e.getEnableIndirectCoord())};return i.hasNoCoord=!i.objCoord,!i.hasNoCoord&&r&&(i.screenCoordOffset=d.CoordUtils.substract(i.screenCoord,r)),e.getCoordStickTarget&&(i.stickTarget=e.getCoordStickTarget()),i},notifyCoordChangeOfObjects:function(e){for(var t=[],r=this.getEditor(),n=this.getEditor().getCoordMode()===d.CoordMode.COORD3D?"coord3D":"coord2D",i=0,o=e.length;i<o;++i){var a=e[i];d.ArrayUtils.pushUnique(t,{obj:a,propNames:[n]});for(var s=a.getCoordDeterminateObjects?a.getCoordDeterminateObjects():[a],l=0,u=s.length;l<u;++l)d.ArrayUtils.pushUnique(t,{obj:s[l],propNames:[n]})}r.objectsChanged(t)},canInteractWithObj:function(e){return this.getState()===d.Editor.BasicManipulationIaController.State.NORMAL&&e},doTestMouseCursor:function(e,t){if(!this.getEditor().isRenderable())return"";var r="",n=this._getEventMouseCoord(t,this.getEditor().getEditClientElem());if(this.getState()===d.Editor.BasicManipulationIaController.State.NORMAL){var i=d.Editor.BoxRegion,o=this.getEditor().getCoordRegionInSelectionMarker(n);if(this.getEnableSelect()){var a=d.Editor.BasicManipulationIaController.ManipulationType,s=this.getCurrAvailableManipulationTypes();if(s.indexOf(a.MOVE)>=0&&(r=o===i.INSIDE?"move":""),!r&&s.indexOf(a.RESIZE)>=0&&(r=o===i.CORNER_TL?"nwse-resize":o===i.CORNER_TR||o===i.CORNER_BL?"nesw-resize":o===i.CORNER_BR?"nwse-resize":o===i.EDGE_TOP||o===i.EDGE_BOTTOM?"ns-resize":o===i.EDGE_LEFT||o===i.EDGE_RIGHT?"ew-resize":""),!r&&s.indexOf(a.ROTATE)>=0&&(o=this.getCoordOnSelectionRotationRegion(n))){var l=d.Widget.StyleResourceNames;r=o===i.CORNER_TL?l.CURSOR_ROTATE_NW:o===i.CORNER_TR?l.CURSOR_ROTATE_NE:o===i.CORNER_BL?l.CURSOR_ROTATE_SW:o===i.CORNER_BR?l.CURSOR_ROTATE_SE:l.CURSOR_ROTATE}}}return r},setSuspendedOperations:function(e,t,r){return this._suspendedOperations&&this.haltSuspendedOperations(),this._suspendedOperations={immediate:e,delayed:t,delayExecId:setTimeout(this.execSuspendedDelayOperation.bind(this),r)},this._suspendedOperations},execSuspendedImmediateOperation:function(){if(this._suspendedOperations){clearTimeout(this._suspendedOperations.delayExecId);var e=this._suspendedOperations.immediate;return this._suspendedOperations=null,e.apply(this)}},execSuspendedDelayOperation:function(){if(this._suspendedOperations){clearTimeout(this._suspendedOperations.delayExecId);var e=this._suspendedOperations.delayed;return this._suspendedOperations=null,e.apply(this)}},haltSuspendedOperations:function(){this._suspendedOperations&&(clearTimeout(this._suspendedOperations.delayExecId),this._suspendedOperations=null)},_startNewSelecting:function(e,t){this.getEnableSelect()&&(this.getEditor().startSelecting(e,t||this.getEditor().getIsToggleSelectOn()),this.setState(d.Editor.BasicManipulationIaController.State.SELECTING))},_startOffSelectionManipulation:function(e){this.setIsOffsetManipulating(!0),this.startManipulation(e,null,d.Editor.BasicManipulationIaController.ManipulationType.MOVE),this.getEditor().pulseSelectionAreaMarker()},startManipulation:function(e,t,r){var n=d.Editor.BasicManipulationIaController.State,i=d.Editor.BasicManipulationIaController.ManipulationType,o=this.getCurrAvailableManipulationTypes(),a=t&&"touch"===t.pointerType;t&&this.setManipulationPointerType(t&&t.pointerType),this.manipulateBegin(),this.setBaseCoord(e),this.setStartCoord(e),this._lastTransformParams=null;var s=e&&this.getEditor().getCoordRegionInSelectionMarker(e),l=d.Editor.BoxRegion,u=e&&this.getCoordOnSelectionRotationRegion(e),c=o.indexOf(i.TRANSFORM)>=0&&r===i.TRANSFORM;if(c)this._availTransformTypes=o;else var h=!a&&o.indexOf(i.RESIZE)>=0&&(r===i.RESIZE||s!==l.INSIDE&&s!==l.OUTSIDE),p=!h&&o.indexOf(i.MOVE)>=0&&(r===i.MOVE||s!==l.OUTSIDE),g=!a&&!h&&!p&&o.indexOf(i.ROTATE)>=0&&(r===i.ROTATE||!!u);if(!c&&!h&&!g){var f=this.getEditor().getTopmostBasicObjectAtCoord(e,this.getCurrBoundInflation());if(f&&!a&&(this.isInAncestorSelectMode()&&(f=this.getStandaloneAncestor(f)),f=f.getNearestMovableObject(),this.getEnableMove()))return void this.doStartDirectManipulate(null,f,e)}if(c)this.setState(n.MANIPULATING),this.setIsManipulatingSelection(!0),this.setResizeStartingRegion(s),this.setRotateStartingRegion(u),this.prepareManipulating(i.TRANSFORM,this.getEditor().getSelection(),e,this.getEditor().getSelectionContainerBox());else if(h)this.setState(n.MANIPULATING),this.setIsManipulatingSelection(!0),this.setResizeStartingRegion(s),this.prepareManipulating(i.RESIZE,this.getEditor().getSelection(),e,this.getEditor().getSelectionContainerBox());else if(p)this.setState(n.MANIPULATING),this.setIsManipulatingSelection(!0),this.prepareManipulating(i.MOVE,this.getEditor().getSelection(),e);else if(g)this.setState(n.MANIPULATING),this.setIsManipulatingSelection(!0),this.setRotateStartingRegion(u),this.prepareManipulating(i.ROTATE,this.getEditor().getSelection(),e,this.getEditor().getSelectionContainerBox());else if(f)this.getEnableMove()&&this.startDirectManipulate(null,f,e);else if(this.getEnableMove()&&this.getEnableSelect()&&this.getEditorConfigs().getInteractionConfigs().getEnableOffSelectionManipulation()&&this.getEditor().hasSelection()&&this.getEditor().isSelectionVisible()){this.setState(n.SUSPENDING);var m=this.getEditorConfigs().getInteractionConfigs().getOffSelectionManipulationActivatingTimeThreshold(),C=t&&t.getShiftKey();this.setSuspendedOperations(this._startNewSelecting.bind(this,e,C),this._startOffSelectionManipulation.bind(this,e),m)}else this.getEnableSelect()&&(C=t&&t.getShiftKey(),this._startNewSelecting(e,C))},execManipulationStep:function(e){if(this.getState()!==d.Editor.BasicManipulationIaController.State.MANIPULATING)return!1;var t=this._manipulationStepBuffer.coord,r=this._manipulationStepBuffer.event,n=this._manipulationStepBuffer.explicitTransformParams;t&&r?this.doExecManipulationStep(t,r,this._manipulationStepBuffer):n&&this.doExecManipulationStepWithExplicitTransformParams(n,this._manipulationStepBuffer),this._manipulationStepBuffer.coord=null,this._manipulationStepBuffer.event=null,this._manipulationStepBuffer.explicitTransformParams=null,this._runManipulationStepId=d.window.requestAnimationFrame(this.execManipulationStepBind)},doExecManipulationStep:function(e,t,r){var n=d.Editor.BasicManipulationIaController.ManipulationType,i=this.getManipulationType(),o=this.getEditor();o.beginUpdateObject();try{this._isBusy=!0,i===n.MOVE?this.moveManipulatedObjs(e):(i===n.RESIZE||i===n.ROTATE)&&this.doTransformManipulatedObjs(i,e)}finally{o.endUpdateObject(),this._isBusy=!1}},doExecManipulationStepWithExplicitTransformParams:function(e,t){var r=d.Editor.BasicManipulationIaController.ManipulationType,n=this.getManipulationType();if(n===r.TRANSFORM){var i=this.getEditor();i.beginUpdateObject();try{this._isBusy=!0,this.doTransformManipulatedObjs(n,null,e)}finally{i.endUpdateObject(),this._isBusy=!1}}},updateManipulationStepBuffer:function(e,t){Object.extend(e,t)},react_pointermove:function(e){if(this.tryApplySuper("react_pointermove",[e]),this._isBusy)return!0;var t,r=d.Editor.BasicManipulationIaController.State,n=(d.Editor.BasicManipulationIaController.ManipulationType,this.getState()),i=this._getEventMouseCoord(e);if((n===r.NORMAL||n===r.SUSPENDING)&&this._lastMouseMoveCoord){var o=d.CoordUtils.getDistance(i,this._lastMouseMoveCoord);if(t=o,o<4)return!0}if(this._lastMouseMoveCoord=i,n===r.SUSPENDING){var a=this.getEditorConfigs().getInteractionConfigs().getUnmovePointerDistanceThreshold()||0;d.ObjUtils.notUnset(t)&&t>a&&this.execSuspendedImmediateOperation()}return n===r.SELECTING?(this.getEnableSelect()&&this.getEditor().addSelectingAnchorCoord(i),e.preventDefault()):n===r.MANIPULATING&&(this.updateManipulationStepBuffer(this._manipulationStepBuffer,{coord:i,event:e}),e.preventDefault()),!0},react_pointerdown:function(e){this.tryApplySuper("react_pointerdown",[e]);var t=d.Editor.BasicManipulationIaController.State;if(e.getButton()===d.X.Event.MouseButton.LEFT){this._lastMouseMoveCoord=null;var r=this._getEventMouseCoord(e);if(this.getState()===t.NORMAL){var n=this,i=function(){n.getState()!==t.NORMAL&&n.getState()!==t.SUSPENDING||(n.startManipulation(r,e),e.preventDefault())};this.setState(t.SUSPENDING),this.setSuspendedOperations(i,i,50)}}else e.getButton()===d.X.Event.MouseButton.RIGHT&&(this.getState()===t.MANIPULATING?(this.cancelManipulate(),this.setState(t.NORMAL),e.stopPropagation(),e.preventDefault()):this.getState()===t.SUSPENDING&&this.haltSuspendedOperations());return!0},react_pointerup:function(e){if(e.getButton()===d.X.Event.MouseButton.LEFT){var t=this._getEventMouseCoord(e);this.setEndCoord(t);var r=this.getStartCoord(),n=t,i=e.getShiftKey(),o=d.Editor.BasicManipulationIaController.State;this.getState()===o.SUSPENDING&&this.execSuspendedImmediateOperation();var a=this.getState();a===o.SELECTING?(this.getEditor().endSelecting(t,i||this.getEditor().getIsToggleSelectOn()),this.setState(o.NORMAL),e.preventDefault(),this.getEditor().endManipulateObject()):a===o.MANIPULATING&&(d.CoordUtils.isEqual(r,n)?this.getEnableSelect()&&this.getEditor().selectOnCoord(r,i||this.getEditor().getIsToggleSelectOn()):(this.manipulateBeforeStopping(),this.addOperationToEditor()),this.stopManipulate(),this.setState(o.NORMAL),e.preventDefault())}return!0},react_mousewheel:function(e){if(e.getCtrlKey()){if(this.getState()===d.Editor.BasicManipulationIaController.State.NORMAL)return this.tryApplySuper("react_mousewheel",[e]);e.preventDefault()}},_isGestureManipulationEnabled:function(){return this.getEditorConfigs().getInteractionConfigs().getEnableGestureManipulation()},_isGestureZoomOnEditorEnabled:function(){return this.getEditorConfigs().getInteractionConfigs().getEnableGestureZoomOnEditor()},_isInGestureManipulation:function(){return!!this._initialGestureTransformParams},_isGestureZoomOnEditor:function(){return!!this._initialGestureZoomLevel},beginGestureTransform:function(e){this.getEditor().hasSelection()?(this._initialGestureZoomLevel=null,this._isGestureManipulationEnabled()?(this.haltSuspendedOperations(),this._initialGestureTransformParams={angle:e.rotation*Math.PI/180||0},this.getState()!==d.Editor.BasicManipulationIaController.State.MANIPULATING?this.startManipulation(null,null,d.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM):this.getManipulationType()!==d.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM&&this.setManipulationType(d.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM)):this._initialGestureTransformParams=null):this._isGestureZoomOnEditorEnabled()&&(this.getEditor().cancelSelecting(),this.setState(d.Editor.BasicManipulationIaController.State.NORMAL),this._initialGestureZoomLevel=this.getEditor().getZoom())},endGestureTransform:function(){this.getState()===d.Editor.BasicManipulationIaController.State.MANIPULATING&&this._isInGestureManipulation()&&(this.manipulateBeforeStopping(),this.addOperationToEditor(),this.stopManipulate(),this.setState(d.Editor.BasicManipulationIaController.State.NORMAL),this._initialGestureTransformParams=null),this._isGestureZoomOnEditor()&&(this._initialGestureZoomLevel=null)},doGestureTransformStep:function(e){var t=d.Editor.BasicManipulationIaController.ManipulationType;if(this.getState()===d.Editor.BasicManipulationIaController.State.MANIPULATING&&this.getManipulationType()===t.TRANSFORM&&this._isInGestureManipulation()){var r,n=this._availTransformTypes||[],i=this.getRotateCenter();if(n.indexOf(t.RESIZE)>=0){var o=e.scale;r=this._calcActualResizeScales(this.getManipulateObjs(),{scaleX:o,scaleY:o})}else r={scaleX:1,scaleY:1};if(n.indexOf(t.ROTATE)>=0){var a=e.rotation*Math.PI/180,s=a-this._initialGestureTransformParams.angle;s=this._calcActualRotateAngle(this.getManipulateObjs(),s,this._initialGestureTransformParams.angle,a)}else s=0;this.updateManipulationStepBuffer(this._manipulationStepBuffer,{explicitTransformParams:{center:i,scaleX:r.scaleX,scaleY:r.scaleY,rotateAngle:s}}),e.preventDefault()}else if(this._isGestureZoomOnEditor()){var l=this.getEditor(),u=(o=e.scale,this._initialGestureZoomLevel);l.zoomTo(u*o,null,e.center)}},react_rotatestart:function(e){this.getEnableGestureManipulation()&&this.beginGestureTransform(e)},react_rotate:function(e){this.getEnableGestureManipulation()&&this.doGestureTransformStep(e)},react_rotateend:function(e){this.getEnableGestureManipulation()&&this.endGestureTransform()},react_rotatecancel:function(e){this.getEnableGestureManipulation()&&this.endGestureTransform()},react_pinchstart:function(e){this.getEnableGestureManipulation()&&this.beginGestureTransform(e)},react_pinchmove:function(e){this.getEnableGestureManipulation()&&this.doGestureTransformStep(e)},react_pinchend:function(e){this.getEnableGestureManipulation()&&this.endGestureTransform()},react_pinchcancel:function(e){this.getEnableGestureManipulation()&&this.endGestureTransform()}}),d.Editor.BasicManipulationIaController.State={NORMAL:0,SELECTING:1,MANIPULATING:2,WAITING:10,SUSPENDING:11},d.Editor.BasicManipulationIaController.ManipulationType={MOVE:0,ROTATE:1,RESIZE:2,TRANSFORM:4},d.Editor.IaControllerManager.register(d.Editor.BasicManipulationIaController,d.Editor.BaseEditor)}(),function(){"use strict";var e=d.ArrayUtils;d.ChemObjOperation={},d.ChemObjOperation.Base=Class.create(d.Operation,{CLASS_NAME:"Kekule.ChemObjOperation.Base",initialize:function(e,t){this.tryApplySuper("initialize"),this.setTarget(e),t&&this.setEditor(t)},initProperties:function(){this.defineProp("target",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL}),this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1})},notifyBeforeAddingByEditor:function(e,t,r){e.beforeAddingByEditor&&e.beforeAddingByEditor(t,r)},notifyBeforeRemovingByEditor:function(e,t){e.beforeRemovingByEditor&&e.beforeRemovingByEditor(t)},notifyBeforeModifyingByEditor:function(e,t){e.beforeModifyingByEditor&&e.beforeModifyingByEditor(t)},notifyAfterAddingByEditor:function(e,t,r){e.afterAddingByEditor&&e.afterAddingByEditor(t,r)},notifyAfterRemovingByEditor:function(e,t){e.afterRemovingByEditor&&e.afterRemovingByEditor(t)},notifyAfterModifyingByEditor:function(e,t){e.afterModifyingByEditor&&e.afterModifyingByEditor(t)}}),d.ChemObjOperation.ChangeClass=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.ChangeClass",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),t&&this.setNewClass(t)},initProperties:function(){this.defineProp("newClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("oldClass",{dataType:DataType.CLASS,serializable:!1})},doExecute:function(){var e=this.getTarget();e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,{}),this.getOldClass()||this.setOldClass(e.getClass()),e.__changeClass__(this.getNewClass()),this.notifyAfterModifyingByEditor(e,{})}finally{e.endUpdate()}},doReverse:function(){var e=this.getTarget();e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,{}),e.__changeClass__(this.getOldClass()),this.notifyAfterModifyingByEditor(e,{})}finally{e.endUpdate()}}}),d.ChemObjOperation.Modify=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Modify",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),t&&this.setNewPropValues(t)},initProperties:function(){this.defineProp("newPropValues",{dataType:DataType.HASH}),this.defineProp("oldPropValues",{dataType:DataType.HASH})},doExecute:function(){var e={},t=this.getNewPropValues(),r=this.getTarget();r.beginUpdate();try{for(var n in this.notifyBeforeModifyingByEditor(r,t),t){var i=t[n];e[n]=r.getPropValue(n),r.setPropValue(n,i)}this.notifyAfterModifyingByEditor(r,t)}finally{r.endUpdate()}this.setOldPropValues(e)},doReverse:function(){var e=this.getOldPropValues(),t=this.getTarget();t.beginUpdate();try{for(var r in this.notifyBeforeModifyingByEditor(t,e),e){var n=e[r];t.setPropValue(r,n)}this.notifyAfterModifyingByEditor(t,e)}finally{t.endUpdate()}}}),d.ChemObjOperation.ModifyHashProp=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.ModifyHashProp",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e,n]),t&&this.setPropName(t),r&&this.setNewPropValue(r)},initProperties:function(){this.defineProp("propName",{dataType:DataType.STRING}),this.defineProp("newPropValue",{dataType:DataType.HASH}),this.defineProp("oldPropValue",{dataType:DataType.HASH})},_extendHash:function(e,t){},doExecute:function(){var e=this.getTarget(),t=this.getPropName(),r=e.getPropValue(this.getPropName()),n=Object.extend(Object.extend({},r),this.getNewPropValue(),!1),i={};i[t]=n,e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,i),e.setPropValue(t,n),this.notifyAfterModifyingByEditor(e,i)}finally{e.endUpdate()}this.getOldPropValue()||this.setOldPropValue(r)},doReverse:function(){var e=this.getTarget(),t=this.getPropName(),r=this.getOldPropValue(),n=(e.getPropValue(t),r),i={};i[t]=n,e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,i),e.setPropValue(t,n),this.notifyAfterModifyingByEditor(e,i)}finally{e.endUpdate()}}}),d.ChemObjOperation.MoveTo=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.MoveTo",initialize:function(e,t,r,n,i){this.tryApplySuper("initialize",[e,i]),t&&this.setNewCoord(t),this.setCoordMode(r||d.CoordMode.COORD2D),this.setUseAbsBaseCoord(!!n)},initProperties:function(){this.defineProp("newCoord",{dataType:DataType.HASH}),this.defineProp("oldCoord",{dataType:DataType.HASH}),this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("useAbsBaseCoord",{dataType:DataType.BOOL})},setObjCoord:function(e,t,r){if(e&&t&&r){var n=!1;if(this.getUseAbsBaseCoord()?e.setAbsBaseCoord&&(e.setAbsBaseCoord(t,r,this.getAllowCoordBorrow()),n=!0):e.setCoordOfMode&&(e.setCoordOfMode(t,r),n=!0),!n){var i=e.getClassName?e.getClassName():typeof e;d.warn(d.$L("ErrorMsg.CAN_NOT_SET_COORD_OF_CLASS").format(i))}}},getObjCoord:function(e,t){if(this.getUseAbsBaseCoord()){if(e.getAbsBaseCoord)return e.getAbsBaseCoord(t,this.getAllowCoordBorrow())}else if(e.getCoordOfMode)return e.getCoordOfMode(t,this.getAllowCoordBorrow());return null},doExecute:function(){var e=this.getTarget();this.getOldCoord()||this.setOldCoord(this.getObjCoord(e,this.getCoordMode())),this.getNewCoord()&&this.setObjCoord(this.getTarget(),this.getNewCoord(),this.getCoordMode())},doReverse:function(){this.getOldCoord()&&this.setObjCoord(this.getTarget(),this.getOldCoord(),this.getCoordMode())}}),d.ChemObjOperation.MoveAndResize=Class.create(d.ChemObjOperation.MoveTo,{CLASS_NAME:"Kekule.ChemObjOperation.MoveAndResize",initialize:function(e,t,r,n,i,o){this.tryApplySuper("initialize",[e,r,n,i,o])},initProperties:function(){this.defineProp("newDimension",{dataType:DataType.HASH}),this.defineProp("oldDimension",{dataType:DataType.HASH})},setObjSize:function(e,t,r){if(e&&t)if(e.setSizeOfMode)e.setSizeOfMode(t,r);else{var n=e.getClassName?e.getClassName():typeof e;d.warn(d.$L("ErrorMsg.CAN_NOT_SET_DIMENSION_OF_CLASS").format(n))}},getObjSize:function(e,t){return e.getSizeOfMode?e.getSizeOfMode(t,this.getAllowCoordBorrow()):null},doExecute:function(){this.tryApplySuper("doExecute");var e=this.getTarget();this.getOldDimension()||this.setOldDimension(this.getObjSize(e,this.getCoordMode())),this.getNewDimension()&&this.setObjSize(this.getTarget(),this.getNewDimension(),this.getCoordMode())},doReverse:function(){this.getOldDimension()&&this.setObjSize(this.getTarget(),this.getOldDimension(),this.getCoordMode()),this.tryApplySuper("doReverse")}}),d.ChemObjOperation.MoveAndResizeObjs=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.MoveAndResizeObjs",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[null,n]),e&&this.setObjCoordAndSizeInfo(e),this.setCoordMode(t||d.CoordMode.COORD2D),this.setUseAbsCoord(!!r),this.setPropStoreFieldValue("childOperations",[])},initProperties:function(){this.defineProp("objCoordAndSizeInfo",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("useAbsCoord",{dataType:DataType.BOOL}),this.defineProp("disableIndirectCoord",{dataType:DataType.BOOL}),this.defineProp("childOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("indirectCoordObjs",{dataType:DataType.ARRAY,serializable:!1})},_setEnableIndirectCoordOfObjs:function(e,t){if(e)for(var r=0,n=e.length;r<n;++r)e[r].setEnableIndirectCoord(t)},_prepareIndirectCoordObjs:function(e){var t=[];if(this.getDisableIndirectCoord())for(var r=0,n=e.length;r<n;++r){var i=e[r];if(i&&i instanceof d.ChemObjOperation.MoveAndResize){var o=i.getTarget();o.hasProperty("enableIndirectCoord")&&o.getEnableIndirectCoord()&&(o.setEnableIndirectCoord(!1),t.push(o))}}this.setIndirectCoordObjs(t)},_prepareExecute:function(){var e=this.getChildOperations();if(!e.length){e.length=0;for(var t=this.getObjCoordAndSizeInfo(),r=0,n=t.length;r<n;++r){var i=t[r],o=i.obj,a=new d.ChemObjOperation.MoveAndResize(o,i.newDimension,i.newCoord,this.getCoordMode(),this.getUseAbsCoord(),this.getEditor());a.setAllowCoordBorrow(this.getAllowCoordBorrow()),i.oldDimension&&a.setOldDimension(i.oldDimension),i.oldCoord&&a.setOldCoord(i.oldCoord),e.push(a)}}this._prepareIndirectCoordObjs(e)},_prepareReverse:function(){this.getDisableIndirectCoord()&&(this.getIndirectCoordObjs()||this._prepareIndirectCoordObjs(this.getChildOperations()),this._setEnableIndirectCoordOfObjs(this.getIndirectCoordObjs(),!1))},_doneMoveAndResize:function(){this._setEnableIndirectCoordOfObjs(this.getIndirectCoordObjs(),!0)},doExecute:function(){this.tryApplySuper("doExecute");try{this._prepareExecute();for(var e=this.getChildOperations(),t=0,r=e.length;t<r;++t)e[t].execute()}finally{this._doneMoveAndResize()}},doReverse:function(){try{this._prepareReverse();for(var e=this.getChildOperations(),t=e.length-1;t>=0;--t)e[t].reverse()}finally{this._doneMoveAndResize()}this.tryApplySuper("doReverse")}}),d.ChemObjOperation.StickTo=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.StickTo",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),t&&this.setStickTarget(t)},initProperties:function(){this.defineProp("stickTarget",{dataType:d.ChemObject,serializable:!1}),this.defineProp("oldStickTarget",{dataType:d.ChemObject,serializable:!1})},_canExecute:function(e){return e&&e.getAllowCoordStickTo&&e.getAllowCoordStickTo(this.getStickTarget())},doExecute:function(){this.tryApplySuper("doExecute");var e=this.getTarget();this._canExecute(e)&&(void 0===this.getOldStickTarget()&&this.setOldStickTarget(e.getCoordStickTarget()||null),e.setCoordStickTarget(this.getStickTarget()))},doReverse:function(){this.getTarget().setCoordStickTarget(this.getOldStickTarget()),this.tryApplySuper("doReverse")}}),d.ChemObjOperation.StickTo.canStick=function(e,t,r,n){var i=e&&e.getAllowCoordStickTo&&e.getAllowCoordStickTo(t);if(t&&(i=(i=(i=(i=(i=i&&t&&t.getAbsCoordOfMode)&&t!==e)&&t.getAcceptCoordStickFrom&&t.getAcceptCoordStickFrom(e))&&(!t.getCoordStickTarget||t.getCoordStickTarget()!==e))&&(r||!(t instanceof d.StructureFragment)))&&!n){var o=e.getParent(),a=t.getParent();i=o!==a||!o||!a}return i},d.ChemObjOperation.Add=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Add",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e,n]),this.setParentObj(t),this.setRefSibling(r)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:!1})},doExecute:function(){var e=this.getParentObj(),t=this.getTarget();if(e&&t){var r=this.getRefSibling()||null;this.notifyBeforeAddingByEditor(t,e,r),e.insertBefore(t,r),this.notifyAfterAddingByEditor(t,e,r)}},doReverse:function(){var e=this.getTarget(),t=this.getParentObj();if(t&&e){var r=this.getRefSibling();r||(r=e.getNextSibling(),this.setRefSibling(r)),this.notifyBeforeRemovingByEditor(e,t),t.removeChild(e),this.notifyAfterRemovingByEditor(e,t)}}}),d.ChemObjOperation.Remove=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Remove",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e,n]),this.setParentObj(t),this.setRefSibling(r)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("ownerObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("removedRelations",{dataType:DataType.ARRAY,serializable:!1})},_isInEditorSelection:function(e){var t=this.getEditor();return(t&&t.getSelection&&t.getSelection()||[]).indexOf(e)>=0},_getRelatedObjRefRelations:function(t){var r=[],n=t.getOwner();if(n){var i=n.findObjRefRelations({dest:t},{checkDestChildren:!0});if(i&&i.length)for(var o=0,a=i.length;o<a;++o){var s=Object.extend({},i[o]);e.isArray(s.dest)&&(s.dest=e.clone(s.dest)),r.push(s)}}return r},_restoreRelations:function(e){if(e)for(var t=0,r=e.length;t<r;++t){var n=e[t];n.srcObj.setPropValue(n.srcProp.name,n.dest)}},doExecute:function(){var e=this.getTarget(),t=this.getParentObj(),r=this.getOwnerObj();if(!t&&e.getParent&&(t=e.getParent(),this.setParentObj(t)),!r&&e.getOwner&&(r=e.getOwner(),this.setOwnerObj(r)),t&&e){if(!this.getRefSibling()){var n=e.getNextSibling?e.getNextSibling():null;this.setRefSibling(n)}var i=this._getRelatedObjRefRelations(e);this.setRemovedRelations(i);var o=this.getEditor(),a=this._isInEditorSelection(e);a&&o.beginUpdateSelection(),this.notifyBeforeRemovingByEditor(e,t),t.removeChild(e),this.notifyAfterRemovingByEditor(e,t),a&&(o.removeFromSelection(e),o.endUpdateSelection())}},doReverse:function(){var e=this.getParentObj(),t=this.getOwnerObj(),r=this.getTarget();if(e&&r){var n=this.getRefSibling();t&&r.setOwner(t),this.notifyBeforeAddingByEditor(r,e,n),e.insertBefore(r,n),this._restoreRelations(this.getRemovedRelations()),this.setRemovedRelations([]),this.notifyAfterAddingByEditor(r,e,n)}}}),d.ChemStructOperation={},d.ChemStructOperation.AddNode=Class.create(d.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddNode"}),d.ChemStructOperation.RemoveNode=Class.create(d.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveNode",initProperties:function(){this.defineProp("linkedConnectorInfos",{dataType:DataType.ARRAY,serializable:!1})},doExecute:function(){if(!this.getLinkedConnectorInfos()){for(var e=this.getTarget(),t=e.getLinkedConnectors(),r=[],n=0,i=t.length;n<i;++n){var o,a=t[n],s=e.getActualConnectedObjToConnector(a)||e,l=a.indexOfConnectedObj(e);o=l<0?null:a.getConnectedObjAt(l+1)||null,r.push({connector:a,refSibling:o}),s!==e&&(r.actualLinkedNode=s)}this.setLinkedConnectorInfos(r)}this.tryApplySuper("doExecute")},doReverse:function(){this.tryApplySuper("doReverse");var e=this.getLinkedConnectorInfos();if(e)for(var t=this.getTarget(),r=0,n=e.length;r<n;++r){var i=e[r].connector,o=e[r].refSibling,a=e[r].actualLinkedNode||t;i.insertConnectedObjBefore(a,o)}}}),d.ChemStructOperation.ReplaceNode=Class.create(d.Operation,{CLASS_NAME:"Kekule.ChemStructOperation.ReplaceNode",initialize:function(e,t,r,n){this.tryApplySuper("initialize"),this.setOldNode(e),this.setNewNode(t),this.setParentObj(r),this.setEditor(n)},initProperties:function(){this.defineProp("oldNode",{dataType:"Kekule.ChemStructureNode",serializable:!1}),this.defineProp("newNode",{dataType:"Kekule.ChemStructureNode",serializable:!1}),this.defineProp("parentObj",{dataType:"Kekule.ChemStructureFragment",serializable:!1}),this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1})},_isInEditorSelection:function(e){var t=this.getEditor();return(t&&t.getSelection&&t.getSelection()||[]).indexOf(e)>=0},doExecute:function(){var e=this.getOldNode(),t=this.getNewNode();if(e&&t){var r=this.getParentObj();if(r||(r=e.getParent(),this.setParentObj(r)),r.replaceNode){var n=this.getEditor(),i=this._isInEditorSelection(e);i&&n.beginUpdateSelection(),r.replaceNode(e,t),i&&(n.removeFromSelection(e),n.addObjToSelection(t),n.endUpdateSelection())}}},doReverse:function(){var e=this.getOldNode(),t=this.getNewNode();if(e&&t){var r=this.getParentObj()||t.getParent();if(r.replaceNode){var n=this.getEditor(),i=this._isInEditorSelection(t);i&&n.beginUpdateSelection(),r.replaceNode(t,e),i&&(n.removeFromSelection(t),n.addObjToSelection(e),n.endUpdateSelection())}}}}),d.ChemStructOperation.AddConnector=Class.create(d.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddConnector",initialize:function(e,t,r,n,i){this.tryApplySuper("initialize",[e,t,r,i]),this.setConnectedObjs(n)},initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:!1})},doExecute:function(){this.tryApplySuper("doExecute");var e=d.ArrayUtils.clone(this.getConnectedObjs());e&&e.length&&this.getTarget().setConnectedObjs(e)},doReverse:function(){this.tryApplySuper("doReverse")}}),d.ChemStructOperation.RemoveConnector=Class.create(d.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveConnector",initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:!1})},doExecute:function(){this.getConnectedObjs()||this.setConnectedObjs(d.ArrayUtils.clone(this.getTarget().getConnectedObjs())),this.tryApplySuper("doExecute")},doReverse:function(){this.tryApplySuper("doReverse");var e=this.getConnectedObjs();e&&e.length&&this.getTarget().setConnectedObjs(e)}}),d.ChemStructOperation.MergeNodesBase=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodesBase",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e,n]),this.setDest(t),this.setEnableStructFragmentMerge(r||!1),this._refSibling=null,this._nodeParent=null},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureNode",serializable:!1}),this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL}),this.defineProp("mergeConnectorPropsFromTarget",{dataType:DataType.BOOL})},getCommonSiblings:function(e,t){var r=e.getLinkedObjs(),n=t.getLinkedObjs();return d.ArrayUtils.intersect(r,n)},doExecute:function(){},doReverse:function(){}}),d.ChemStructOperation.MergeNodes=Class.create(d.ChemStructOperation.MergeNodesBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodes",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e,t,r,n]),this._refSibling=null,this._nodeParent=null,this._structFragmentMergeOperation=null,this._removeConnectorOperations=[],this._removeNodeOperation=null,this._modifyConnecorOperations=[]},initProperties:function(){this.defineProp("relinkedConnectors",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("removedConnectors",{dataType:DataType.ARRAY,serializable:!1})},getMergeConnPropsOperation:function(e,t){var r;if(e instanceof d.Bond&&t instanceof d.Bond&&e.getBondType()===t.getBondType()&&e.getBondType()===d.BondType.COVALENT){var n=e.getBondOrder();n>t.getBondOrder()&&(r=new d.ChemObjOperation.Modify(t,{bondOrder:n}))}return r},doExecute:function(){var e=this.getMergeConnectorPropsFromTarget(),t=this._modifyConnecorOperations||[],r=this.getTarget(),n=this.getDest(),i=r.getParentFragment(),o=n.getParentFragment();if(i!==o){if(!this.getEnableStructFragmentMerge())return null;this._structFragmentMergeOperation=new d.ChemStructOperation.MergeStructFragment(i,o,this.getEditor()),this._structFragmentMergeOperation.execute(),i=o}this._nodeParent=i,i.beginUpdate();try{var a,s=this.getEditor();if(!(l=this.getRemovedConnectors())){t=[],a=this.getCommonSiblings(r,n);var l=[];if(a.length)for(var u=0,c=a.length;u<c;++u){var h=a[u];(_=r.getConnectorTo(h))&&2==_.getConnectedObjCount()&&l.push(_)}var p=r.getConnectorTo(n);p&&l.push(p),this.setRemovedConnectors(l)}if(!(g=this.getRelinkedConnectors())){var g=d.ArrayUtils.clone(r.getLinkedConnectors())||[];g=d.ArrayUtils.exclude(g,l),this.setRelinkedConnectors(g)}for(this._refSibling=r.getNextSibling(),u=0,c=g.length;u<c;++u){var f=(_=g[u]).indexOfConnectedObj(r);_.removeConnectedObj(r),_.insertConnectedObjAt(n,f)}if(e&&!t.length&&l&&l.length)for(a||(a=this.getCommonSiblings(r,n)),u=0,c=a.length;u<c;++u){h=a[u];var m=r.getConnectorTo(h);if(l.indexOf(m)>=0){var C=n.getConnectorTo(h);if(C){var y=this.getMergeConnPropsOperation(m,C);y&&t.push(y)}}}for(this._removeConnectorOperations=[],u=0,c=l.length;u<c;++u){var _=l[u],E=new d.ChemStructOperation.RemoveConnector(_,null,null,s);E.execute(),this._removeConnectorOperations.push(E)}if(this._removeNodeOperation=new d.ChemStructOperation.RemoveNode(r,null,null,s),this._removeNodeOperation.execute(),t)for(this._modifyConnecorOperations=t,u=0,c=t.length;u<c;++u)t[u].execute()}finally{i.endUpdate()}},doReverse:function(){var e=this.getTarget(),t=this.getDest(),r=this._nodeParent;r.beginUpdate();try{var n=this._modifyConnecorOperations;if(n)for(var i=0,o=n.length;i<o;++i)n[i].reverse();if(this._removeNodeOperation.reverse(),this._removeConnectorOperations.length)for(i=this._removeConnectorOperations.length-1;i>=0;--i)this._removeConnectorOperations[i].reverse();this._removeConnectorOperations=[];var a=this.getRelinkedConnectors();for(i=0,o=a.length;i<o;++i){var s=a[i],l=s.indexOfConnectedObj(t);s.removeConnectedObj(t),s.insertConnectedObjAt(e,l)}}finally{r.endUpdate()}this._structFragmentMergeOperation&&this._structFragmentMergeOperation.reverse()}}),d.ChemStructOperation.MergeNodes.canMerge=function(e,t,r,n){if(e instanceof d.StructureFragment||t instanceof d.StructureFragment)return!1;if(!(e instanceof d.ChemStructureNode&&t instanceof d.ChemStructureNode))return!1;var i=e.getParent()===t.getParent()||r;return n||(i=i&&!e.getConnectorTo(t)),i},d.ChemStructOperation.MergeNodesPreview=Class.create(d.ChemStructOperation.MergeNodesBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodesPreview",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e,t,r,n]),this._nodeParent=null},doExecute:function(){this._moveNodeOperations=[];var e=this.getTarget(),t=this.getDest(),r=e.getParentFragment(),n=d.CoordMode,i=[n.COORD2D,n.COORD3D];r&&r.beginUpdate();try{for(var o=0,a=i.length;o<a;++o){var s=t.getAbsBaseCoord(i[o],!1),l=new d.ChemObjOperation.MoveTo(e,s,i[o],!0,this.getEditor());l.execute(),this._moveNodeOperations.push(l)}this._nodeParent=r}finally{r&&r.endUpdate()}},doReverse:function(){var e=this._nodeParent;e&&e.beginUpdate();try{for(var t=this._moveNodeOperations,r=t.length-1;r>=0;--r)t[r].reverse()}finally{e&&e.endUpdate()}this._moveNodeOperations=null}}),d.ChemStructOperation.MergeNodesPreview.canMerge=d.ChemStructOperation.MergeNodes.canMerge,d.ChemStructOperation.MergeConnectorsBase=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectorsBase",initialize:function(e,t,r,n,i){this.tryApplySuper("initialize",[e,i]),this.setDest(t),this.setCoordMode(r||d.CoordMode.COORD2D),this.setEnableStructFragmentMerge(n||!1),this._refSibling=null,this._nodeParent=null,this._nodeMergeOperations=[]},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureConnector",serializable:!1}),this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL}),this.defineProp("coordMode",{dataType:DataType.INT})},getMergeNodeOperationClass:function(){},doExecute:function(){d.ChemStructOperation.MergeConnectors.canMerge(this.getTarget(),this.getDest(),this.getEnableStructFragmentMerge())||d.error(d.$L("ErrorMsg.CAN_NOT_MERGE_CONNECTORS"));for(var e=this.getCoordMode(),t=[this.getTarget(),this.getDest()],r=d.ArrayUtils,n=r.clone(this.getTarget().getConnectedObjs()),i=r.clone(this.getDest().getConnectedObjs()),o=this.getAllowCoordBorrow(),a=0,s=t.length;a<s;++a){var l=t[a],u=l.getConnectedObjAt(0).getAbsCoordOfMode(e,o),c=l.getConnectedObjAt(1).getAbsCoordOfMode(e,o),h=d.CoordUtils.substract(u,c),p=Math.abs(h.x)>Math.abs(h.y)?"x":"y";d.ObjUtils.notUnset(u.z)&&Math.abs(h.z)>Math.abs(h.x)&&(p="z"),(0===a?n:i).sort((function(t,r){var n=t.getAbsCoordOfMode(e,o),i=r.getAbsCoordOfMode(e,o);return n[p]-i[p]||0}))}var g=r.intersect(n,i);n=r.exclude(n,g),i=r.exclude(i,g),this._nodeMergeOperations=[];var f=this.getMergeNodeOperationClass();for(a=0,s=n.length;a<s;++a){if(n[a]!==i[a]){var m=new f(n[a],i[a],this.getEnableStructFragmentMerge());m.execute()}this._nodeMergeOperations.push(m)}},doReverse:function(){for(var e=this._nodeMergeOperations.length-1;e>=0;--e)this._nodeMergeOperations[e].reverse();this._nodeMergeOperations=[]}}),d.ChemStructOperation.MergeConnectors=Class.create(d.ChemStructOperation.MergeConnectorsBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectors",getMergeNodeOperationClass:function(){return d.ChemStructOperation.MergeNodes}}),d.ChemStructOperation.MergeConnectors.canMerge=function(e,t,r){if(!r&&e.getParent()!==t.getParent())return!1;if(e.isConnectingConnector()||t.isConnectingConnector())return!1;var n=e.getConnectedExposedObjs(),i=t.getConnectedObjs();return n.length===i.length&&2===n.length&&!(d.ArrayUtils.intersect(n,i).length>=1)},d.ChemStructOperation.MergeConnectorsPreview=Class.create(d.ChemStructOperation.MergeConnectorsBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectors",getMergeNodeOperationClass:function(){return d.ChemStructOperation.MergeNodesPreview}}),d.ChemStructOperation.MergeConnectorsPreview.canMerge=d.ChemStructOperation.MergeConnectors.canMerge,d.ChemStructOperation.MergeStructFragment=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeStructFragment",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),this.setDest(t),this._removeOperation=null},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("mergedNodes",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergedConnectors",{dataType:DataType.ARRAY,serializable:!1})},moveChildBetweenStructFragment:function(e,t,r,n){d.ChemStructureUtils.moveChildBetweenStructFragment(e,t,r,n)},doExecute:function(){var e=this.getTarget(),t=this.getDest();if(e&&t){var r=d.ArrayUtils.clone(e.getNodes());this.setMergedNodes(r);var n=d.ArrayUtils.clone(e.getConnectors());this.setMergedConnectors(n),this.moveChildBetweenStructFragment(e,t,r,n);var i=e.getParent();i&&(this._removeOperation=new d.ChemObjOperation.Remove(e,i,null,this.getEditor()),this._removeOperation.execute())}},doReverse:function(){var e=this.getTarget(),t=this.getDest();if(e&&t){this._removeOperation&&(this._removeOperation.reverse(),this._removeOperation=null);var r=this.getMergedNodes(),n=this.getMergedConnectors();this.moveChildBetweenStructFragment(t,e,r,n)}}}),d.ChemStructOperation.SplitStructFragment=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.SplitStructFragment",initialize:function(e,t){this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("splittedFragments",{dataType:DataType.ARRAY,serializable:!1,setter:null})},doExecute:function(){var e=d.ChemStructureUtils.splitStructFragment(this.getTarget());if(e.length>1){this.setPropStoreFieldValue("splittedFragments",e);var t=this.getTarget().getParent(),r=this.getTarget().getNextSibling();t.beginUpdate();try{if(t)for(var n=1,i=e.length;n<i;++n){var o=e[n];t.insertBefore(o,r)}}finally{t.endUpdate()}}else this.setPropStoreFieldValue("splittedFragments",null)},doReverse:function(){var e=this.getSplittedFragments();if(e&&e.length)for(var t=this.getTarget(),r=0,n=e.length;r<n;++r){var i=e[r];if(i!==t){d.ChemStructureUtils.moveChildBetweenStructFragment(i,t,d.ArrayUtils.clone(i.getNodes()),d.ArrayUtils.clone(i.getConnectors()));var o=i.getParent();o&&o.removeChild(i),i.finalize()}}}}),d.ChemStructOperation.StandardizeStructFragment=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.StandardizeStructFragment",initialize:function(e,t){this.tryApplySuper("initialize",[e,t]),this.setEnableSplit(!0),this.setEnableRemove(!0),this._concreteOper=null},initProperties:function(){this.defineProp("enableRemove",{dataType:DataType.BOOL}),this.defineProp("enableSplit",{dataType:DataType.BOOL})},doExecute:function(){var e=this.getTarget(),t=e.getNodeCount();this._concreteOper=null;var r=this.getEditor();return t<=0?this.getEnableRemove()&&(this._concreteOper=new d.ChemObjOperation.Remove(e,null,null,r)):this.getEnableSplit()&&(this._concreteOper=new d.ChemStructOperation.SplitStructFragment(e,r)),this._concreteOper?this._concreteOper.execute():null},doReverse:function(){return this._concreteOper?this._concreteOper.reverse():null}}),d.ChemSpaceEditorOperation={},d.ChemSpaceEditorOperation.ChangeSpaceSize=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemSpaceEditorOperation.ChangeSpaceSize",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e,n]),this.setCoordMode(r||d.CoordMode.COORD2D),t&&this.setNewSize(t)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("newSize",{dataType:DataType.HASH}),this.defineProp("oldSize",{dataType:DataType.HASH})},doExecute:function(){var e=this.getEditor(),t=this.getTarget();try{var r=this.getCoordMode();this.getOldSize()||this.setOldSize(Object.extend({},t.getSizeOfMode(r,e.getAllowCoordBorrow()))),e.changeChemSpaceSize(this.getNewSize(),r)}finally{}},doReverse:function(){var e=this.getEditor();if(this.getTarget(),this.getOldSize())try{var t=this.getCoordMode();e.changeChemSpaceSize(this.getOldSize(),t)}finally{}}}),d.ChemSpaceEditorOperation.ShiftChildrenCoords=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemSpaceEditorOperation.ShiftChildrenCoords",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e,n]),this.setCoordMode(r||d.CoordMode.COORD2D),t&&this.setCoordDelta(t)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("coordDelta",{dataType:DataType.HASH})},doExecute:function(){var e=this.getEditor(),t=(this.getTarget(),this.getCoordDelta()),r=this.getCoordMode();try{e._shiftChemSpaceChildCoord(t,r)}finally{}},doReverse:function(){var e=this.getEditor(),t=(this.getTarget(),d.CoordUtils.multiply(this.getCoordDelta(),-1)),r=this.getCoordMode();try{e._shiftChemSpaceChildCoord(t,r)}finally{}}}),d.ChemSpaceEditorOperation.ChangeSpaceSizeAndShiftChildrenCoords=Class.create(d.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemSpaceEditorOperation.ChangeSpaceSizeAndShiftChildrenCoords",initialize:function(e,t,r,n,i){this.setPropStoreFieldValue("restoreScrollPosition",!0),this.tryApplySuper("initialize",[e,i]),this.setCoordMode(n||d.CoordMode.COORD2D),t&&this.setNewSize(t),r&&this.setCoordDelta(r)},initProperties:function(){this.defineProp("restoreScrollPosition",{dataType:DataType.BOOL}),this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("coordDelta",{dataType:DataType.HASH}),this.defineProp("newSize",{dataType:DataType.HASH}),this.defineProp("oldSize",{dataType:DataType.HASH,serializable:!1})},doExecute:function(){var e=this.getEditor(),t=this.getTarget();try{var r,n=this.getCoordMode(),i=this.getRestoreScrollPosition();i&&(r=e.getClientScrollCoord(d.Editor.CoordSys.CHEM)),this.getNewSize()&&(this.getOldSize()||this.setOldSize(Object.extend({},t.getSizeOfMode(n,e.getAllowCoordBorrow()))),e.changeChemSpaceSize(this.getNewSize(),n)),this.getCoordDelta()&&(e._shiftChemSpaceChildCoord(this.getCoordDelta(),n),r=d.CoordUtils.add(r,this.getCoordDelta())),i&&e._registerAfterUpdateObjectProc((function(){e.scrollClientToCoord(r,d.Editor.CoordSys.CHEM)}))}finally{}},doReverse:function(){var e=this.getEditor();if(this.getTarget(),this.getOldSize()||this.getCoordDelta())try{var t,r=this.getRestoreScrollPosition(),n=this.getCoordMode();r&&(t=e.getClientScrollCoord(d.Editor.CoordSys.CHEM)),this.getCoordDelta()&&(e._shiftChemSpaceChildCoord(d.CoordUtils.multiply(this.getCoordDelta(),-1),n),t=d.CoordUtils.substract(t,this.getCoordDelta())),this.getOldSize()&&e.changeChemSpaceSize(this.getOldSize(),n),this.getRestoreScrollPosition()&&t&&e._registerAfterUpdateObjectProc((function(){e.scrollClientToCoord(t,d.Editor.CoordSys.CHEM)}))}finally{}}})}(),d.Editor.StructureUtils={getCascadeDeleteObjs:function(e){return d.ChemStructureUtils.getCascadeDeleteObjs(e)},getSurroundingObjs:function(e){var t=e.getLinkedObjs();if(e instanceof d.ChemStructureConnector){var r=e.getConnectedObjs();d.ArrayUtils.pushUnique(t,r)}return t},calcMostEmptyDirectionAngleOfChemObj:function(e,t,r){var n=[];t||(t=e.getLinkedObjs());for(var i=e.getAbsBaseCoord2D(r),o=0,a=t.length;o<a;++o){var s=t[o].getAbsBaseCoord2D(r);s=d.CoordUtils.substract(s,i);var l=Math.atan2(s.y,s.x);l<0&&(l=2*Math.PI+l),n.push(l)}if(n.sort(),0===(a=n.length))return 0;if(1===a)return-n[0];var u=0,c=0;for(o=0;o<a;++o){var h=n[o],p=n[(o+1)%a]-h;p<0&&(p+=2*Math.PI),p>u&&(u=p,c=o)}return n[c]+u/2},calcPreferred2DBondGrowingDirection:function(e,t,r){var n=e.getAbsBaseCoord2D(r),i=d.Editor.StructureUtils.getSurroundingObjs(e);switch(i?i.length:0){case 0:return t;case 1:var o=i[0].getAbsBaseCoord2D(r),a=d.CoordUtils.substract(o,n),s=Math.atan2(a.y,a.x),l=s-t,u=s+t;return l<0&&(l+=2*Math.PI),u<0&&(u+=2*Math.PI),l!==u?Math.min(l>Math.PI?Math.abs(l-2*Math.PI):l,Math.abs(l-Math.PI))<=Math.min(u>Math.PI?Math.abs(u-2*Math.PI):u,Math.abs(u-Math.PI))?l:u:l;default:return d.Editor.StructureUtils.calcMostEmptyDirectionAngleOfChemObj(e,i,r)}},calcPreferred2DBondGrowingLocation:function(e,t,r,n){var i=e.getAbsBaseCoord2D(n),o=d.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(e,r,n);return d.CoordUtils.add(i,{x:t*Math.cos(o),y:t*Math.sin(o)})},isBondPropsMatch:function(e,t,r){var n=!0;return n&&r.indexOf("bondType")>=0&&(n=e.bondType==t.bondType||!e.bondType&&!t.bondType),n&&e.bondType===d.BondType.COVALENT&&((n&&r.indexOf("bondOrder")>=0||!e.bondOrder&&!t.bondOrder)&&(n=e.bondOrder==t.bondOrder),n&&r.indexOf("stereo")>=0&&(n=e.stereo==t.stereo||!e.stereo&&!t.stereo)),n&&(n=d.ObjUtils.equal(e,t,["bondType","bondOrder","stereo"])),n},getChemStructureNodeLabel:function(e,t,r){if(e.getIsotopeId){var n=e.getIsotopeId();if(r&&r.includeExplicitHydrogens){var i=e.getExplicitHydrogenCount&&e.getExplicitHydrogenCount();i>0&&(n+="H"),i>1&&(n+=i.toString())}return n}if(e instanceof d.SubGroup){var o=e.getAbbr()||e.getFormulaText();return t&&(o=o||t.getRgroup()),o}var a=e.getCoreDisplayRichTextItem(null,null,t);return d.Render.RichTextUtils.toText(a)},getAllChemStructureNodesLabel:function(e,t,r){for(var n,i=0,o=e.length;i<o;++i){var a=e[i],s=d.Editor.StructureUtils.getChemStructureNodeLabel(a,t,r);if(n){if(n!==s)return null}else n=s}return n},getAllChemStructureNodesHtmlCode:function(e,t,r,n){for(var i,o=0,a=e.length;o<a;++o){var s=e[o].getCoreDisplayRichTextItem(t,r,n),l=d.Render.RichTextUtils.toSimpleHtmlCode(s);if(i){if(i!==l)return null}else i=l}return i},getStructureCenterAbsBaseCoord:function(e,t,r){for(var n=null,i=d.CoordUtils.add,o=e.getNodeCount(),a=0;a<o;++a){var s=e.getNodeAt(a).getAbsBaseCoord(t,r);n=n?i(n,s):s}return d.CoordUtils.divide(n,o)}},d.Editor.RepositoryStructureUtils={_calcNodeMergeAdjustRotateAngle:function(e,t,r){var n=0,i=e.getCoordMode();if(i!==d.CoordMode.COORD3D){var o=e.getAllowCoordBorrow(),a=e.getEditorConfigs().getStructureConfigs(),s=d.Editor.StructureUtils.getSurroundingObjs(t),l=d.Editor.StructureUtils.getSurroundingObjs(r);if(1===s.length){var u=(p=t.getLinkedConnectorAt(0)).getBondOrder?p.getBondOrder():0,c=a.getNewBondDefAngle(r,u);g=d.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(r,c,o);var h=d.ChemStructureUtils.getAbsCoordVectorBetweenObjs(t,s[0],i,o);n=g-Math.atan2(h.y,h.x)}else if(1===l.length){u=(p=r.getLinkedConnectorAt(0)).getBondOrder?p.getBondOrder():0,c=a.getNewBondDefAngle(t,u);var p,g=d.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(t,c,o);h=d.ChemStructureUtils.getAbsCoordVectorBetweenObjs(r,l[0],i,o),n=Math.atan2(h.y,h.x)-g}else{c=a.getNewBondDefAngle(r,null),g=d.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(r,c,o);for(var f={},m=0,C=s.length;m<C;++m){h=d.ChemStructureUtils.getAbsCoordVectorBetweenObjs(t,s[m],i,o);var y=Math.atan2(h.y,h.x);(d.ObjUtils.isUnset(f.min)||y<f.min)&&(f.min=y),(d.ObjUtils.isUnset(f.max)||y>f.max)&&(f.max=y)}n=g-(f.max+f.min)/2}}return n},_calcConnectorMergeTransformParams:function(e,t,r){var n=t.getConnectedObjAt(0),i=t.getConnectedObjAt(1),o=r.getConnectedObjAt(0),a=r.getConnectedObjAt(1),s=e.getObjCoord(n),l=e.getObjCoord(i),u=e.getObjCoord(o),c=e.getObjCoord(a);return d.CoordUtils.calcCoordGroup2DTransformParams(s,l,c,u)},calcRepObjInitialTransformParams:function(e,t,r,n,i){var o,a=r.baseObjCoord,s=e.getDefBondLength()/t.getRefLength(),l=a;if(r.mergeObj&&(n=r.mergeDest||n))if(i=e.getObjectScreenCoord(n),r.mergeObj instanceof d.ChemStructureNode&&n instanceof d.ChemStructureNode)o=d.Editor.RepositoryStructureUtils._calcNodeMergeAdjustRotateAngle(e,r.mergeObj,n);else if(r.mergeObj instanceof d.ChemStructureConnector&&n instanceof d.ChemStructureConnector)return d.Editor.RepositoryStructureUtils._calcConnectorMergeTransformParams(e,r.mergeObj,n);var u=e.translateCoord(i,d.Editor.CoordSys.SCREEN,d.Editor.CoordSys.CHEM);return a&&(u=d.CoordUtils.substract(u,a)),{scale:s,translateX:u.x,translateY:u.y,translateZ:u.z,rotateAngle:o,center:l}},transformChemObjectsCoordAndSize:function(e,t,r){var n=e.getCoordMode(),i=e.getAllowCoordBorrow(),o=n===d.CoordMode.COORD3D?d.CoordUtils.calcTransform3DMatrix(r):d.CoordUtils.calcTransform2DMatrix(r),a=Object.extend({},r);a=Object.extend(a,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});for(var s=n===d.CoordMode.COORD3D?d.CoordUtils.calcTransform3DMatrix(a):d.CoordUtils.calcTransform2DMatrix(a),l=0,u=t.length;l<u;++l){var c=t[l];c.transformAbsCoordByMatrix(o,s,n,!0,i),c.scaleSize(r.scale,n,!0,i)}}},d.Editor.OperationUtils={createNodeModificationOperation:function(e,t,r,n,i){var o,a,s=e.getClass();if(t&&!r&&(r=t.getClass()),t||r!==s){o=new d.MacroOperation,t||(t=new r);var l=new d.ChemStructureNode;l.assign(e),t.assign(l);var u=new d.ChemStructOperation.ReplaceNode(e,t,null,i);o.add(u)}else t=e;return n&&(d.ObjUtils.match(t,n)||(a=new d.ChemObjOperation.Modify(t,n,i),o&&o.add(a))),o||a},createNodeModificationOperationFromData:function(e,t,r){if(!t)return null;var n,i=t.nodeClass,o=t.props,a=t.repositoryItem;if(a){var s=a.createObjects(e)||{},l=s.objects,u=d.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(r,a,s,e,null);r.transformCoordAndSizeOfObjects(l,u),i=(n=l[0]).getClass()}if(t.isUnknownPseudoatom&&!r.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()&&(i=null),i){if(o){var c=Object.extend({},o);if(e.getExplicitHydrogenCount&&e.getExplicitHydrogenCount()&&(c.explicitHydrogenCount=null),c.inputHydrogenCount&&c.isotopeId){var h,p=n||e;if(p&&p.getDisableImplicitHydrogenEstimation&&p.getDisableImplicitHydrogenEstimation())h=0;else{var g=e._getCurrCovalentBondsInfo&&e._getCurrCovalentBondsInfo()||{},f=e._getCurrIonicBondsInfo&&e._getCurrIonicBondsInfo()||{},m=d.IsotopesDataUtil.getIsotopeIdDetail(c.isotopeId).symbol,C=d.ChemicalElementsDataUtil.getAtomicNumber(m),y=Math.round(e.getCharge&&e.getCharge()||0),_=e.getRadical?d.RadicalOrder.getRadicalElectronCount(e.getRadical()):0;h=d.ChemStructureUtils.getImplicitHydrogenCount(C,{coValenceBondValenceSum:g.valenceSum||0,otherBondValenceSum:f.valenceSum||0,charge:y,radicalECount:_})}h!==c.inputHydrogenCount&&(c.explicitHydrogenCount=c.inputHydrogenCount,delete c.inputHydrogenCount)}}return d.Editor.OperationUtils.createNodeModificationOperation(e,n,i,c,r)}return d.error(d.$L("ErrorMsg.INVALID_ATOM_SYMBOL")),null}},function(){"use strict";var e=Class.PropertyScope;d.Editor.BaseEditorConfigs=Class.create(d.ChemWidget.ChemObjDisplayerConfigs,{CLASS_NAME:"Kekule.Editor.BaseEditorConfigs",initProperties:function(){this.addConfigProp("uiMarkerConfigs","Kekule.EditorConfigs.UiMarkerConfigs"),this.addConfigProp("interactionConfigs","Kekule.EditorConfigs.InteractionConfigs"),this.addConfigProp("structureConfigs","Kekule.Editor.StructureConfigs"),this.addConfigProp("hotKeyConfigs","Kekule.Editor.HotKeyConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("uiMarkerConfigs",new d.Editor.UiMarkerConfigs),this.setPropStoreFieldValue("interactionConfigs",new d.Editor.InteractionConfigs),this.setPropStoreFieldValue("structureConfigs",new d.Editor.StructureConfigs),this.setPropStoreFieldValue("hotKeyConfigs",new d.Editor.HotKeyConfigs)}}),d.Editor.ChemSpaceEditorConfigs=Class.create(d.Editor.BaseEditorConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditorConfigs",initProperties:function(){this.addConfigProp("chemSpaceConfigs","Kekule.Editor.ChemSpaceConfigs"),this.addConfigProp("styleSetterConfigs","Kekule.Editor.StyleSetterConfigs",void 0,{scope:e.PUBLIC})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("chemSpaceConfigs",new d.Editor.ChemSpaceConfigs),this.setPropStoreFieldValue("styleSetterConfigs",new d.Editor.StyleSetterConfigs)}}),d.ClassUtils.makeSingleton(d.Editor.ChemSpaceEditorConfigs),d.Editor.InteractionConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.InteractionConfigs",initProperties:function(){var t=Math.PI/180;this.addBoolConfigProp("enableTrackOnNearest",!0),this.addBoolConfigProp("enableHotTrack",!0),this.addBoolConfigProp("scrollToObjAfterLoading",!0),this.addBoolConfigProp("autoExpandClientSizeAfterLoading",!0),this.addBoolConfigProp("autoExpandClientSizeAfterManipulation",!1),this.addBoolConfigProp("autoSelectNewlyInsertedObjects",!1),this.addBoolConfigProp("autoSelectNewlyInsertedObjectsOnTouch",!0),this.addIntConfigProp("objBoundTrackMinInflation",5),this.addIntConfigProp("objBoundTrackMinInflationMouse",null),this.addIntConfigProp("objBoundTrackMinInflationPen",null),this.addIntConfigProp("objBoundTrackMinInflationTouch",10),this.addFloatConfigProp("objBoundTrackInflationRatio",.2),this.addFloatConfigProp("objBoundTrackInflationRatioMouse",null),this.addFloatConfigProp("objBoundTrackInflationRatioPen",null),this.addFloatConfigProp("objBoundTrackInflationRatioTouch",.33),this.addBoolConfigProp("enablePartialAreaSelecting",!1),this.addFloatConfigProp("selectingBrushWidth",12),this.addBoolConfigProp("enableOffSelectionManipulation",!0),this.addIntConfigProp("offSelectionManipulationActivatingTimeThreshold",800),this.addFloatConfigProp("unmovePointerDistanceThreshold",5,{scope:e.PUBLIC}),this.addIntConfigProp("selectingCurveSimplificationDistanceThreshold",2,{scope:e.PUBLIC}),this.addIntConfigProp("selectionMarkerInflation",5),this.addIntConfigProp("selectionMarkerEdgeInflation",5),this.addIntConfigProp("selectionMarkerDefPulseDuration",500),this.addIntConfigProp("selectionMarkerDefPulseCount",2),this.addBoolConfigProp("followPointerCoordOnDirectManipulatingSingleObj",!0),this.addIntConfigProp("followPointerCoordOnDirectManipulatingSingleObjDistanceThreshold",2),this.addFloatConfigProp("constrainedResizeStep",.125),this.addIntConfigProp("rotationRegionInflation",10),this.addFloatConfigProp("constrainedRotateStep",7.5*t),this.addIntConfigProp("rotationLocationPointDistanceThreshold",10),this.addIntConfigProp("directedMoveDistanceThreshold",10),this.addBoolConfigProp("enableMergePreview",!0),this.addBoolConfigProp("enableMagneticMerge",!0),this.addBoolConfigProp("enableNodeMerge",!0),this.addBoolConfigProp("enableNeighborNodeMerge",!0),this.addBoolConfigProp("enableConnectorMerge",!0),this.addBoolConfigProp("enableStructFragmentMerge",!0),this.addBoolConfigProp("enableGestureManipulation",!0),this.addBoolConfigProp("enableGestureZoomOnEditor",!0),this.addBoolConfigProp("enableHotKey",!0),this.addIntConfigProp("clonedObjectScreenOffset",10),this.addIntConfigProp("atomSetterFontSize",14),this.addBoolConfigProp("allowUnknownAtomSymbol",!0),this.addBoolConfigProp("enableBondKekulizeHucklize",!0),this.addIntConfigProp("trackSimplifierDistanceThreshold",8),this.addIntConfigProp("trackSimplifierIgnoreSegmentThreshold",10),this.addIntConfigProp("trackMergeDistanceThreshold",20),this.addFloatConfigProp("trackOptimizationAngleConstraint",30*t),this.addConfigProp("trackOptimizationDistanceConstraints",DataType.ARRAY,void 0,{scope:e.PUBLIC}),this.addIntConfigProp("trackOptimizationPrimaryDistanceConstraint",1),this.addFloatConfigProp("trackTouchRefLength",.5,{scope:e.PUBLIC}),this.addBoolConfigProp("autoAdjustZoomLevelOnTrackTouching",!1,{scope:e.PUBLIC}),this.addFloatConfigProp("editorInitialZoom",1.5)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setTrackOptimizationDistanceConstraints([.5,1,3,4,5])}}),d.Editor.UiMarkerConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.UiMarkerConfigs",initProperties:function(){this.addStrConfigProp("hotTrackerColor","#0000FF"),this.addFloatConfigProp("hotTrackerOpacity",.5),this.addStrConfigProp("selectionMarkerStrokeColor","#0000FF"),this.addFloatConfigProp("selectionMarkerStrokeWidth",2),this.addStrConfigProp("selectionMarkerFillColor","#0000FF"),this.addFloatConfigProp("selectionMarkerOpacity",.2),this.addFloatConfigProp("selectionMarkerEmphasisOpacity",.4),this.addFloatConfigProp("selectionTransformMarkerSize",8,{scope:e.PUBLIC}),this.addFloatConfigProp("selectionTransformMarkerOpacity",.4,{scope:e.PUBLIC}),this.addStrConfigProp("selectingMarkerStrokeColor","#000000"),this.addFloatConfigProp("selectingMarkerStrokeWidth",1),this.addStrConfigProp("selectingMarkerStrokeDash",!0),this.addStrConfigProp("selectingMarkerFillColor",null),this.addFloatConfigProp("selectingMarkerOpacity",.7),this.addStrConfigProp("selectingBrushMarkerStrokeColor","#0000FF"),this.addStrConfigProp("selectingBrushMarkerStrokeDash",!1),this.addFloatConfigProp("selectingBrushMarkerStrokeLineCap","round"),this.addFloatConfigProp("selectingBrushMarkerStrokeLineJoin","round"),this.addFloatConfigProp("selectingBrushMarkerOpacity",.3),this.addStrConfigProp("trackMarkerStrokeColor","#0000AA"),this.addFloatConfigProp("trackMarkerStrokeWidth",2),this.addStrConfigProp("trackMarkerStrokeDash",!1),this.addFloatConfigProp("trackMarkerOpacity",.5),this.addHashConfigProp("issueCheckMarkerColors",{error:{strokeColor:"#FF0000",fillColor:null,activeStrokeColor:"#FF0000",activeFillColor:"#FF6666"},warning:{strokeColor:"#f1a200",fillColor:null,activeStrokeColor:"#f1a200",activeFillColor:"#ffdb15"},note:{strokeColor:"#00b0f0",fillColor:null,activeStrokeColor:"#007ca8",activeFillColor:"#00b0f0"},log:{strokeColor:"#00b0f0",fillColor:null,activeStrokeColor:"#007ca8",activeFillColor:"#00b0f0"}}),this.addFloatConfigProp("issueCheckMarkerStrokeWidth",2),this.addFloatConfigProp("issueCheckActiveMarkerStrokeWidth",2),this.addStrConfigProp("issueCheckMarkerOpacity",.3),this.addStrConfigProp("issueCheckActiveMarkerOpacity",.6),this.addStrConfigProp("flexStructureAssocMarkerColor","#0000AA"),this.addFloatConfigProp("flexStructureAssocMarkerOpacity",.5),this.addIntConfigProp("flexStructureAssocMarkerFontSize",14),this.addStrConfigProp("flexStructureAssocMarkerFontFamily","Arial, Helvetica, sans-serif")}}),d.Editor.StructureConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StructureConfigs",initProperties:function(){this.addStrConfigProp("defBondType",d.BondType.DEFAULT,{enumSource:d.BondType}),this.addIntConfigProp("defBondOrder",d.BondOrder.SINGLE,{enumSource:d.BondOrder}),this.addFloatConfigProp("defBondLength",.8),this.addConfigProp("defBondAngles",DataType.ARRAY,void 0,{scope:e.PUBLIC}),this.addFloatConfigProp("bondConstrainedDirectionDelta",void 0,{scope:e.PUBLIC}),this.addConfigProp("bondConstrainedDirectionAngles",DataType.ARRAY,void 0,{scope:e.PUBLIC}),this.addFloatConfigProp("bondConstrainedDirectionAngleThreshold",void 0,{scope:e.PUBLIC}),this.addFloatConfigProp("initialBondDirection",void 0,{scope:e.PUBLIC}),this.addStrConfigProp("defIsotopeId","C"),this.addConfigProp("primaryOrgChemAtoms",DataType.ARRAY,void 0,{scope:e.PUBLIC}),this.addIntConfigProp("maxFlexChainAtomCount",0),this.addIntConfigProp("minFlexRingAtomCount",3),this.addIntConfigProp("maxFlexRingAtomCount",18),this.addHashConfigProp("enabledNonAtomNodeTypes",{RGroup:!0,pseudoatomDummy:!0,pseudoatomHetero:!0,pseudoatomAny:!0,variableAtomList:!0,variableAtomNotList:!0}),this.addHashConfigProp("enabledBondForms",{single:!0,double:!0,triple:!0,quad:!0,explicitAromatic:!0,up:!0,upInverted:!0,down:!0,downInverted:!0,upOrDown:!0,eOrZ:!0,closer:!0,ionic:!1,coordinate:!1,metallic:!1,hydrogen:!0})},initPropValues:function(){this.tryApplySuper("initPropValues");var e=Math.PI/180,t=[],r=d.BondOrder,n=2*Math.PI/3;t[0]=n,t[r.EXPLICIT_AROMATIC]=[n],t[r.TRIPLE]=[Math.PI],t[r.DOUBLE]=[n],t[r.DOUBLE][r.DOUBLE]=Math.PI,t[r.SINGLE]=[n],this.setDefBondAngles(t),this.setBondConstrainedDirectionDelta(10*Math.PI/180),this.setBondConstrainedDirectionAngles([0,90*e,180*e,270*e]),this.setBondConstrainedDirectionAngleThreshold(3*e),this.setInitialBondDirection(30*e),this.setPrimaryOrgChemAtoms(["C","H","O","N","P","S","F","Cl","Br","I","Si","D","C13"])},getDefAngleOfBonds:function(e,t){var r=e||0,n=t||0;r>n&&(r=t||0,n=e||0);var i=this.getDefBondAngles(),o=i[n];return o?o[r]||o[0]:i[0]},getNewBondDefAngle:function(e,t){var r;d.ObjUtils.isUnset(t)&&(t=this.getDefBondOrder());var n=d.Editor.StructureUtils.getSurroundingObjs(e);if(1===n.length){var i=e.getLinkedConnectorAt(0);if(i&&i.getConnectedObjs().indexOf(n[0])>=0){var o=i.getBondOrder?i.getBondOrder():null;d.ObjUtils.notUnset(o)&&(r=this.getDefAngleOfBonds(t,o))}}else r=0===n.length?this.getInitialBondDirection():this.getDefAngleOfBonds(t,0);return r}}),d.Editor.ChemSpaceConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceConfigs",initProperties:function(){this.addHashConfigProp("defScreenSize2D"),this.addHashConfigProp("defScreenSize3D"),this.addHashConfigProp("autoExpandScreenSize2D"),this.addHashConfigProp("autoExpandScreenSize3D"),this.addNumConfigProp("defPadding",50)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setDefScreenSize2D({x:900,y:1500}),this.setDefScreenSize3D({x:600,y:600,z:600}),this.setAutoExpandScreenSize2D({x:200,y:200}),this.setAutoExpandScreenSize3D({x:100,y:100,z:100})}}),d.Editor.StyleSetterConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StyleSetterConfigs",initProperties:function(){this.defineProp("listedFontSizes",{dataType:DataType.ARRAY}),this.defineProp("listedFontNames",{dataType:DataType.ARRAY})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setListedFontSizes([8,9,10,11,12,14,16,18,20,24,28,32,36,40,44,48,54,60,66,72,80,88,96]),this.setListedFontNames(d.Widget.FontEnumerator.getAvailableFontFamilies())}}),d.Editor.HotKeyConfigs=Class.create(d.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.HotKeyConfigs",initProperties:function(){this.defineProp("hotKeys",{dataType:DataType.ARRAY})},initPropValues:function(){var e=d.ChemWidget.ComponentWidgetNames;this.tryApplySuper("initPropValues"),this.setHotKeys([{key:"c",action:"atom_C"},{key:"h",action:"atom_H"},{key:"o",action:"atom_O"},{key:"n",action:"atom_N"},{key:"p",action:"atom_P"},{key:"s",action:"atom_S"},{key:"f",action:"atom_F"},{key:"Shift+C",action:"atom_Cl"},{key:"b",action:"atom_Br"},{key:"i",action:"atom_I"},{key:"Shift+B",action:"atom_B"},{key:"k",action:"atom_K"},{key:"Shift+N",action:"atom_Na"},{key:"d",action:"atom_D"},{key:"m",action:"subgroup_methyl"},{key:"e",action:"subgroup_ethyl"},{key:"t",action:"subgroup_TMS"},{key:"Shift+P",action:"subgroup_phenyl"},{key:"Shift+T",action:"subgroup_OTs"},{key:"Shift+E",action:"subgroup_COOCH3"},{key:"a",action:"atom_any"},{key:"q",action:"atom_hetero"},{key:"l",action:"atom_variable"},{key:"r",action:"subgroup_R"},{key:"1",action:"bond_single"},{key:"2",action:"bond_double"},{key:"3",action:"bond_triple"},{key:"4",action:"bond_quad"},{key:"b",action:"bond_closer"},{key:"w",action:"bond_up"},{key:"h",action:"bond_down"},{key:"Shift+W",action:"bond_down"},{key:"y",action:"bond_upOrDown"},{key:"Ctrl+A",action:e.selectAll},{key:"Ctrl+C",action:e.copy},{key:"Ctrl+X",action:e.cut},{key:"Ctrl+V",action:e.paste},{key:"Ctrl+Z",action:e.undo},{key:"Ctrl+Shift+Z",action:e.redo},{key:"+",action:e.zoomIn},{key:"-",action:e.zoomOut},{key:"Delete",action:e.eraseSelection},{key:"Backspace",action:e.eraseSelection}])}})}(),d.Editor.RepositoryData={subGroups:[{name:"methyl",inputTexts:["Me","CH3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Thu, 15 Sep 2016 15:49:02 GMT"},"__type__":"object"},"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Me","__type__":"Kekule.SubGroup"}'},{name:"ethyl",inputTexts:["Et","C2H5"],structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Et","__type__":"Kekule.SubGroup"}'},{name:"n-propyl",inputTexts:["n-Pr","nPr","C3H7"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"n-Pr","formulaText":"C3H7","__type__":"Kekule.SubGroup"}'},{name:"i-propyl",inputTexts:["i-Pr","iPr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"i-Pr","__type__":"Kekule.SubGroup"}'},{name:"n-butyl",inputTexts:["n-Bu","nBu","C4H9"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"n-Bu","formulaText":"C4H9","__type__":"Kekule.SubGroup"}'},{name:"i-butyl",inputTexts:["i-Bu","iBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.6928203230275507,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"i-Bu","__type__":"Kekule.SubGroup"}'},{name:"s-butyl",inputTexts:["s-Bu","sBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"s-Bu","__type__":"Kekule.SubGroup"}'},{name:"t-butyl",inputTexts:["t-Bu","tBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"t-Bu","__type__":"Kekule.SubGroup"}'},{name:"phenyl",inputTexts:["Ph","C6H5"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ph","formulaText":"C6H5","__type__":"Kekule.SubGroup"}'},{name:"benzyl",inputTexts:["Bn"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-1.1999999999999957,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":1.1999999999999957,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Bn","__type__":"Kekule.SubGroup"}'},{name:"benzoyl",inputTexts:["Bz"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,7]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Bz","__type__":"Kekule.SubGroup"}'},{inputTexts:["CF3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CF3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CCl3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CCl3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CBr3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CBr3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CI3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CI3","__type__":"Kekule.SubGroup"}'},{inputTexts:["OMe","OCH3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["OEt","OC2H5"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OEt","__type__":"Kekule.SubGroup"}'},{inputTexts:["Ot-Bu","OtBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275525,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.7763568394002505e-15,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275454,"y":0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275525,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.7763568394002505e-15,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ot-Bu","__type__":"Kekule.SubGroup"}'},{inputTexts:["CO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CO","__type__":"Kekule.SubGroup"}'},{inputTexts:["CHO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CHO","__type__":"Kekule.SubGroup"}'},{name:"carboxyl",inputTexts:["COOH","CO2H"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOH","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOOH","CO3H","CO2OH"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CO3H","__type__":"Kekule.SubGroup"}'},{inputTexts:["COONa"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Na"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COONa","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOK"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"K"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOK","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOCH3","COOMe"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOC2H5","COOEt"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.039230484541326,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOEt","__type__":"Kekule.SubGroup"}'},{inputTexts:["COCl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COCl","__type__":"Kekule.SubGroup"}'},{inputTexts:["COBr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COBr","__type__":"Kekule.SubGroup"}'},{inputTexts:["CONH2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CONH2","__type__":"Kekule.SubGroup"}'},{inputTexts:["Ac"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ac","__type__":"Kekule.SubGroup"}'},{inputTexts:["OAc"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OAc","__type__":"Kekule.SubGroup"}'},{inputTexts:["MeCO","COMe"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0.34641016151377535,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.3464101615137771,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.3464101615137771,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["EtCO","COEt"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275525,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.7763568394002505e-15,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COEt","__type__":"Kekule.SubGroup"}'},{name:"hydroxymethyl",inputTexts:["CH2OH"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3999999999999986,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.3999999999999968,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CH2OH","__type__":"Kekule.SubGroup"}'},{inputTexts:["NMe2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NMe2","__type__":"Kekule.SubGroup"}'},{name:"nitro",inputTexts:["NO2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NO2","__type__":"Kekule.SubGroup"}'},{name:"nitroso",inputTexts:["NO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,0]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NO","__type__":"Kekule.SubGroup"}'},{name:"diazo",inputTexts:["N2","NN","N2 +"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3999999999999986,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.3999999999999986,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2 +","__type__":"Kekule.SubGroup"}'},{inputTexts:["N2Cl","NNCl","N2 +Cl-"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.7763568394002505e-15,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":0,"__type__":"object"},"charge":-1,"radical":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"ionic","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2 +Cl-","__type__":"Kekule.SubGroup"}'},{inputTexts:["N2Br","NNBr","N2 +Br-"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.7763568394002505e-15,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":0,"__type__":"object"},"charge":-1,"radical":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"ionic","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2 +Br-","__type__":"Kekule.SubGroup"}'},{name:"nitrile group",inputTexts:["CN"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[1,0]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CN","__type__":"Kekule.SubGroup"}'},{name:"pyridyl",inputTexts:["Py"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-8.881784197001252e-16,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275498,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275498,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-8.881784197001252e-16,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Py","__type__":"Kekule.SubGroup"}'},{name:"sulfonic group",inputTexts:["SO3H"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000213,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000213,"y":0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.399999999999995,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO3H","__type__":"Kekule.SubGroup"}'},{inputTexts:["SO2Cl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO2Cl","__type__":"Kekule.SubGroup"}'},{inputTexts:["SO2Br"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO2Br","__type__":"Kekule.SubGroup"}'},{inputTexts:["TMS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Si"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"TMS","__type__":"Kekule.SubGroup"}'},{inputTexts:["OTMS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Si"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"OTMS","__type__":"Kekule.SubGroup"}'},{name:"OTs",inputTexts:["OTs","OTS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275525,"y":0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275525,"y":1.399999999999988,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":1.7999999999999936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.6928203230275507,"y":1.399999999999988,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":-0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":-0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.SubGroup","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275525,"y":-1.7999999999999936,"__type__":"object"},"charge":0,"parity":null}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,8]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[6,9]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[9,10]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"OTs","__type__":"Kekule.SubGroup"}'},{inputTexts:["MgCl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Mg"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"MgCl","__type__":"Kekule.SubGroup"}'},{inputTexts:["MgBr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Mg"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"MgBr","__type__":"Kekule.SubGroup"}'}],fragments:[{name:"methane",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Sat, 25 Feb 2017 04:21:08 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-1","__type__":"Kekule.Molecule"}'},{name:"fischer1",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"fischer2",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999972,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.7763568394002505e-15,"y":1.2000000000000028,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-1.2000000000000028,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8000000000000007,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,7]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"fischer3",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999972,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.7763568394002505e-15,"y":1.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999972,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-1.6000000000000085,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,8]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,9]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,10]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"sawhorseStaggered",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:51:35 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.34060000000000024,"y":-0.642199999999999,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":-0.37219999999999764,"y":-1.0575999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.0877999999999997,"y":-0.648899999999994,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3686000000000007,"y":-1.8829999999999991,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34060000000000024,"y":0.6422000000000061,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.0877999999999997,"y":0.6489000000000011,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.3686000000000007,"y":1.8829999999999991,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null,null],"zIndex2D":0,"coord2D":{"x":0.3722000000000012,"y":1.0576000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[7,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[7,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[6,7]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-6","__type__":"Kekule.Molecule"}'},{name:"sawhorseEclipsed",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:50:51 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3022000000000009,"y":0.4405000000000001,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.4229000000000003,"y":0.8340999999999994,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.1265,"y":0.4025999999999996,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null,null],"coord2D":{"x":0.44500000000000206,"y":1.657899999999998,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.1265,"y":-1.6214000000000084,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":-0.4015000000000004,"y":-1.2276999999999987,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.3013999999999992,"y":-1.657899999999998,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.38010000000000055,"y":-0.4025999999999996,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-5","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneChair1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:43:26 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.5715736151962387,"y":0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.9715297072546738,"y":-0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.20235354281841378,"y":-0.12653156366939555,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.5714766561436155,"y":-0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.9715297072546738,"y":0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.20225658376579414,"y":0.1266285227220152,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-1","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneChair2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:44:10 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.9716412105880998,"y":0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.5715992908679759,"y":-0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.20239696641355032,"y":-0.14362717166194017,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.9716412105880998,"y":-0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.571696270727303,"y":0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.20239696641355032,"y":0.14372415152126905,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-2","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneHaworth1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:47:35 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.47495070097202685,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.4999174283497734,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.47495070097202685,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.4999174283497734,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-3","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneHaworth2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:47:08 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.47495070097202685,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.49991742834977515,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":0.47495070097202685,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.49991742834977515,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":10,"isInAromaticRing":false,"connectedObjs":[4,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-3","__type__":"Kekule.Molecule"}'},{name:"cyclopentaneHaworth1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:48:11 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.48039814732735664,"y":0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.4815600495278858,"y":0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":0.7788133624967433,"y":-0.05620701895063007,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.7788133624967433,"y":-0.05620701895063007,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.0006293636919529888,"y":-0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-4","__type__":"Kekule.Molecule"}'},{name:"cyclopentaneHaworth2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:48:04 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.4804171472781027,"y":0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":-1,"coord2D":{"x":-0.48158784071773564,"y":0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.7788490794655241,"y":-0.05617585542339043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.0005848625620670234,"y":-0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":0.7788490794655241,"y":-0.05617585542339043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[4,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,4]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-4","__type__":"Kekule.Molecule"}'},{name:"substituentMark",dataFormat:"Kekule-JSON",scale:.7,structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Pseudoatom","coordPos2D":0,"coordPos3D":0,"renderOptions":{"nodeDisplayMode":-1,"__type__":"object"},"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"atomType":"any","symbol":"A"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"renderOptions":{"opacity":0.5,"__type__":"object"},"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'}]},function(){"use strict";d.Editor.AbstractRepositoryItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.AbstractRepositoryItem",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING})},getAvailableCoordModes:function(){return[]},createObjects:function(e,t){},getScale:function(){return this.doGetScale()||1},doGetScale:function(){return 1},getRefLength:function(){return this.doGetRefLength()/(this.getScale()||1)},doGetRefLength:function(){},isOneStructureFragmentObj:function(){return!1}}),d.Editor.MolRepositoryItem2D=Class.create(d.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.MolRepositoryItem2D",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("molScale",{dataType:DataType.FLOAT}),this.defineProp("molManipulationCenterCoord",{dataType:DataType.HASH}),this.defineProp("molManipulationDefDirectionCoord",{dataType:DataType.HASH})},doGetScale:function(){return this.getMolScale()||this.tryApplySuper("doGetScale")},getAvailableCoordModes:function(){return d.CoordMode.COORD2D},isOneStructureFragmentObj:function(){return!0},createObjects:function(e,t){var r=this.doCreateObjects(e,t);if(!r)return null;var n=null,i=null,o={x:0,y:0};return e&&(n=e instanceof d.ChemStructureNode?this.doGetMergableNode(r,e):e instanceof d.ChemStructureConnector?this.doGetMergableConnector(r,e):null)&&(i=e,o=n.getAbsBaseCoord2D()),{objects:[r],mergeObj:n,mergeDest:i,baseObjCoord:o,centerCoord:{x:0,y:0}}},doCreateObjects:function(e,t){return null},doGetMergableNode:function(e,t){return null},doGetMergableConnector:function(e,t){return null}}),d.Editor.StoredStructFragmentRepositoryItem2D=Class.create(d.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.StoredStructFragmentRepositoryItem2D",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.beginUpdate();try{t&&this.setDataFormat(t),e&&this.setStructData(e),r&&this.setMolScale(r)}finally{this.endUpdate()}},initProperties:function(){this.defineProp("structureFragment",{dataType:"Kekule.StructureFragment",setter:null,serializable:!1}),this.defineProp("structData",{dataType:DataType.STRING}),this.defineProp("dataFormat",{dataType:DataType.STRING})},objectChange:function(e){if(this.tryApplySuper("objectChange",[e]),e.indexOf("structData")>=0||e.indexOf("dataFormat")>=0){var t=null;this.getStructData()&&(t=this._createTemplateStructFragment()),this.setPropStoreFieldValue("structureFragment",t)}},_createTemplateStructFragment:function(){var e=null;return this.getStructData()&&(e=d.IO.loadFormatData(this.getStructData(),this.getDataFormat()||d.IO.DataFormat.KEKULE_JSON)),e&&this._adjustTemplateStructureFragmentCoords(e),e},_adjustTemplateStructureFragmentCoords:function(e){e.setCoord2D({x:0,y:0});var t=d.Render.ObjUtils.getContainerBox(e,d.CoordMode.COORD2D,!0);if(t){e.getCoordOfMode&&e.getCoordOfMode(d.CoordMode.COORD2D,!0);var r={};r.x=-(t.x2+t.x1)/2,r.y=-(t.y2+t.y1)/2,e.beginUpdate();try{for(var n=0,i=e.getNodeCount();n<i;++n){var o=e.getNodeAt(n),a=o.getCoord2D(!0);a=d.CoordUtils.add(a,r),o.setCoord2D(a)}}finally{e.endUpdate()}}},doGetRefLength:function(){var e=this.getStructureFragment();return e?e.getConnectorLengthMedian(d.CoordMode.COORD2D,!0):0},doCreateObjects:function(e,t){var r=this.getStructureFragment();return r?r.clone():null},doGetMergableNode:function(e,t){return e.getAnchorNodeAt(0)||e.getNodeAt(0)},doGetMergableConnector:function(e,t){return null}}),d.Editor.StoredSubgroupRepositoryItem2D=Class.create(d.Editor.StoredStructFragmentRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.StoredSubgroupRepositoryItem2D",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},initProperties:function(){this.defineProp("inputTexts",{dataType:DataType.STRING})},doCreateObjects:function(e,t){var r=this.getStructureFragment();if(r){var n=new d.SubGroup;return n.assign(r,!1),n}return null},createObjects:function(e){return this.tryApplySuper("createObjects",[e])},_adjustTemplateStructureFragmentCoords:function(e){e.setCoord2D({x:0,y:0});var t=e.getCurrConnectableObj();if(t){var r=d.CoordUtils.substract({x:0,y:0},t.getCoord2D(!0));e.beginUpdate();try{for(var n=0,i=e.getNodeCount();n<i;++n){var o=e.getNodeAt(n),a=o.getCoord2D(!0);a=d.CoordUtils.add(a,r),o.setCoord2D(a)}}finally{e.endUpdate()}}}}),d.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText=function(e){for(var t=d.Editor.RepositoryItemManager.getAllItems(d.Editor.StoredSubgroupRepositoryItem2D)||[],r=0,n=t.length;r<n;++r){var i=t[r];if((i.getInputTexts()||[]).indexOf(e)>=0)return i}return null},d.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems=function(){return d.Editor.RepositoryItemManager.getAllItems(d.Editor.StoredSubgroupRepositoryItem2D)||[]},d.Editor.MolRingRepositoryItem2D=Class.create(d.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.MolRingRepositoryItem2D",initialize:function(e,t){this.tryApplySuper("initialize"),this.setRingAtomCount(e),this.setBondLength(t||1)},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT}),this.defineProp("bondLength",{dataType:DataType.FLOAT,setter:function(e){e!==this.getBondLength()&&this.setPropStoreFieldValue("bondLength",e)}}),this.defineProp("isAromatic",{dataType:DataType.BOOL}),this.defineProp("enableCoordCache",{dataType:DataType.BOOL,setter:function(e){e!==this.getEnableCoordCache()&&(this.setPropStoreFieldValue("enableCoordCache",e),e&&!this._coordCache&&this._initCoordCache())}})},doGetRefLength:function(){return this.getBondLength()},doCreateObjects:function(e,t){var r=t&&t.originalStructFragment;return this.generateRing(r)},doGetMergableNode:function(e,t){return e.getNodeAt(0)},doGetMergableConnector:function(e,t){return e.getConnectorAt(0)},generateRing:function(e,t){var r;t||(t=d.Molecule),r=e||new t;var n=this.getRingAtomCount();r.beginUpdate();try{r.setCoord2D({x:0,y:0});var i,o=r.getNodeCount();if(o>n)for(var a=o-1;a>=n;--a)r.removeNodeAt(a);for(a=r.getConnectorCount()-1;a>=0;--a)r.removeConnectorAt(a);i=this.getEnableCoordCache()&&this._hasCoordCache(n)?this._getCachedCoords(n):this._calcAtomCoords(n);var s,l,u,c=this.getBondLength();for(a=0;a<n;++a){var h=r.getNodeAt(a);h||(h=this._generateAtom(a),r.appendNode(h));var p=i[a];if(1!==c&&(p=d.CoordUtils.multiply(p)),h.setCoord2D(p),0===a&&(u=h),s){var g=this._generateBond(l,a);r.appendConnector(g),g.appendConnectedObj(s),g.appendConnectedObj(h)}s=h,l=a}g=this._generateBond(n-1,0),r.appendConnector(g),g.appendConnectedObj(s),g.appendConnectedObj(u)}finally{r.endUpdate()}return r},_generateAtom:function(e){return new d.Atom(null,"C")},_generateBond:function(e,t){var r=d.BondOrder.SINGLE;return this.getIsAromatic()&&e%2&&(r=d.BondOrder.DOUBLE),new d.Bond(null,null,r)},_calcAtomCoords:function(e){for(var t=this.getEnableCoordCache(),r=Math.PI/e,n=2*r,i=.5/Math.sin(r),o=4===e||8===e?-Math.PI/2-n/2:-Math.PI/2,a=[],s=0;s<e;++s){var l={x:i*Math.cos(o),y:i*Math.sin(o)};a.push(l),t&&this._setCoordToCache(l,e,s),o+=n}return a},_initCoordCache:function(){this._coordCache=[];for(var e=3;e<13;++e)this._calcAtomCoords(e)},_clearCoordCache:function(){this._coordCache=[]},_setCoordToCache:function(e,t,r){var n=this._coordCache[t];n||(n=[],this._coordCache[t]=n),n[r]=e},_getCachedCoord:function(e,t){var r=this._coordCache[e];return r&&r[t]},_getCachedCoords:function(e){return this._coordCache[e]},_hasCoordCache:function(e){return!(!this._coordCache||!this._coordCache[e])}}),d.Editor.MolChainRepositoryItem2D=Class.create(d.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.MolChainRepositoryItem2D",STEP_X_INC:Math.cos(30/180*Math.PI),STEP_Y_INC:Math.sin(30/180*Math.PI),initialize:function(e,t){this.tryApplySuper("initialize"),this.setAtomCount(e),this.setBondLength(t||1)},initProperties:function(){this.defineProp("atomCount",{dataType:DataType.INT}),this.defineProp("bondLength",{dataType:DataType.FLOAT}),this.defineProp("negativeDirection",{dataType:DataType.BOOL}),this.defineProp("enableCoordCache",{dataType:DataType.BOOL,setter:function(e){e!==this.getEnableCoordCache()&&(this.setPropStoreFieldValue("enableCoordCache",e),e&&!this._coordCache&&this._initCoordCache())}})},doGetRefLength:function(){return this.getBondLength()},doCreateObjects:function(e,t){var r=t&&t.originalStructFragment;return this.generateChain(r)},doGetMergableNode:function(e,t){return e.getNodeAt(0)},doGetMergableConnector:function(e,t){return null},generateChain:function(e,t){t||(t=d.Molecule);var r=e||new t,n=this.getAtomCount(),i=this.getBondLength()||1,o=this.getNegativeDirection();r.beginUpdate();try{r.setCoord2D({x:0,y:0});var a=r.getNodeCount();if(a>n)for(var s=a-1;s>=n;--s)r.removeNodeAt(s);var l,u,c=r.getConnectorCount();if(c>n-1)for(s=c-1;s>=n-1;--s)r.removeConnectorAt(s);s=0;for(var h=n;s<h;++s){l=p;var p,g=!1;(p=r.getNodeAt(s))||(p=this._generateAtom(s),g=!0);var f=this._getCachedCoord(s);f||(f=this._calcAtomCoord(s)),1!==i&&(f=d.CoordUtils.multiply(f,i)),o&&(f={x:f.x,y:-f.y}),p.setCoord2D(f),g&&r.appendNode(p),l&&g&&(u=this._generateBond(s-1,s),r.appendConnector(u),u.appendConnectedObj(l),u.appendConnectedObj(p))}}finally{r.endUpdate()}return this.setMolManipulationCenterCoord({x:0,y:0}),this.setMolManipulationDefDirectionCoord({x:1,y:0}),r},_generateAtom:function(e){return new d.Atom(null,"C")},_generateBond:function(e,t){var r=d.BondOrder.SINGLE;return new d.Bond(null,null,r)},_calcAtomSetCoords:function(e){var t=this.getEnableCoordCache(),r={x:1*this.STEP_X_INC,y:1*this.STEP_Y_INC},n=[],i={x:0,y:0};n.push(i),this._coordCache[0]=i;for(var o=1,a=e;o<a;++o)i={x:i.x+r.x,y:o%2?r.y:0},n.push(i),t&&(this._coordCache[o]=i);return n},_calcAtomCoord:function(e){var t={x:1*this.STEP_X_INC,y:1*this.STEP_Y_INC},r={x:t.x*e,y:e%2?t.y:0};return this._coordCache&&(this._coordCache[e]=r),r},_initCoordCache:function(){this._coordCache=[],this._calcAtomSetCoords(30)},_clearCoordCache:function(){this._coordCache=[]},_getCachedCoord:function(e){return this._coordCache&&this._coordCache[e]}}),d.Editor.PathGlyphRepositoryItem2D=Class.create(d.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.PathGlyphRepositoryItem2D",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setGlyphClass(e),this.setGlyphRefLength(t||1),this.setGlyphInitialParams(r)},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT}),this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("glyphInitialParams",{dataType:DataType.HASH})},getAvailableCoordModes:function(){return d.CoordMode.COORD2D},doGetRefLength:function(){return this.getGlyphRefLength()},createObjects:function(e){var t={x:0,y:0};return{objects:[this.generateGlyph()],mergeObj:null,mergeDest:null,baseObjCoord:t,centerCoord:t}},generateGlyph:function(){return new(this.getGlyphClass())(null,this.getGlyphRefLength(),this.getGlyphInitialParams())}}),d.Editor.RepositoryItemManager={_itemClassMap:new d.MapEx(!0),_itemNameMap:new d.MapEx(!0),getAllItems:function(t){return e._itemClassMap.get(t)},getItem:function(t){return e._itemNameMap.get(t)},register:function(t){var r,n=t.getName();n&&(r=e.getItem(),e._itemNameMap.set(n,t));var i=t.getClass(),o=e.getAllItems(i);o?r?d.ArrayUtils.replace(o,r,t):d.ArrayUtils.pushUnique(o,t):(o=[t],e._itemClassMap.set(i,o))},unregister:function(t){var r=t.getClass(),n=e.getAllItems(r);n&&d.ArrayUtils.remove(n,t);var i=t.getName();i&&e._itemNameMap.remove(i)}};var e=d.Editor.RepositoryItemManager;d._registerAfterLoadSysProc((function(){if(d.Editor.RepositoryData){for(var t=0,r=(i=d.Editor.RepositoryData.subGroups||[]).length;t<r;++t){var n=i[t];(o=new d.Editor.StoredSubgroupRepositoryItem2D(n.structData,n.dataFormat,n.scale)).setInputTexts(n.inputTexts).setName(n.name||n.inputTexts[0]),e.register(o)}var i;for(t=0,r=(i=d.Editor.RepositoryData.fragments||[]).length;t<r;++t){var o;n=i[t],(o=new d.Editor.StoredStructFragmentRepositoryItem2D(n.structData,n.dataFormat,n.scale)).setName(n.name),e.register(o)}}}))}(),function(){"use strict";var e=d.ObjUtils,t=d.ArrayUtils,r=d.Widget.HtmlClassNames,n=d.ChemWidget.HtmlClassNames;d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{STRUCTURE_NODE_SELECT_PANEL:"K-Chem-StructureNodeSelectPanel",STRUCTURE_NODE_SELECT_PANEL_SET_BUTTON:"K-Chem-StructureNodeSelectPanel-SetButton",STRUCTURE_NODE_SETTER:"K-Chem-StructureNodeSetter",STRUCTURE_NODE_SETTER_INPUTBOX:"K-Chem-StructureNodeSetter-InputBox",STRUCTURE_CONNECTOR_SELECT_PANEL:"K-Chem-StructureConnectorSelectPanel",STRUCTURE_CONNECTOR_SELECT_PANEL_SET_BUTTON:"K-Chem-StructureConnectorSelectPanel-SetButton",STRUCTURE_CONNECTOR_SELECT_PANEL_ADV:"K-Chem-StructureConnectorSelectPanelAdv",STRUCTURE_CONNECTOR_SELECT_PANEL_ADV_EXTRA_SECTION:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection",STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection-Button",STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_KEKULIZE:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection-Button-Kekulize",STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_HUCKLIZE:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection-Button-Hucklize",CHARGE_SELECT_PANEL:"K-Chem-Charge-SelectPanel",CHARGE_SELECT_PANEL_BTNGROUP:"K-Chem-Charge-SelectPanel-BtnGroup",CHARGE_SELECT_PANEL_CHARGE_BUTTON:"K-Chem-Charge-SelectPanel-ChargeButton",GLYPH_PATH_ARROW_SETTING_PANEL:"K-Chem-GlyphPath-Arrow-SettingPanel",GLYPH_PATH_ARROW_STYLE_BTNGROUP:"K-Chem-GlyphPath-Arrow-StyleButtonGroup",GLYPH_PATH_ARROW_STYLE_BUTTON:"K-Chem-GlyphPath-Arrow-StyleButton",GLYPH_PATH_ARROW_CONTINUOUS_SIDES_BTNGROUP:"K-Chem-GlyphPath-Arrow-ContinuousSidesButtonGroup",GLYPH_PATH_ARROW_CONTINUOUS_SIDES_BUTTON:"K-Chem-GlyphPath-Arrow-ContinuousSidesButton",GLYPH_Path_ARROW_SIZE_SETTER:"K-Chem-GlyphPath-Arrow-SizeSetter",GLYPH_REACTION_ARROW_PRESET_SELECTOR:"K-Chem-Glyph-ReactionArrow-PresetSelector",GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET:"K-Chem-Glyph-ReactionArrow-PresetSelector-ButtonSet",GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET_DROPDOWN:"K-Chem-Glyph-ReactionArrow-PresetSelector-ButtonSet-DropDown",GLYPH_REACTION_ARROW_PRESET_SELECTOR_BUTTON:"K-Chem-Glyph-ReactionArrow-PresetSelector-Button",GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR:"K-Chem-Glyph-ElectronPushingArrow-PresetSelector",GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BTNGROUP:"K-Chem-Glyph-ReactionArrow-PresetSelector-ButtonGroup",GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BUTTON:"K-Chem-Glyph-ElectronPushingArrow-PresetSelector-Button",GLYPH_PATH_LINE_SETTING_PANEL:"K-Chem-GlyphPath-Line-SettingPanel",GLYPH_PATH_SETTING_PANEL:"K-Chem-GlyphPath-SettingPanel",GLYPH_PATH_SETTING_PANEL_SECTION:"K-Chem-GlyphPath-SettingPanel-Section",GLYPH_PATH_SETTING_PANEL_SECTION_TITLE:"K-Chem-GlyphPath-SettingPanel-Section-Title",GLYPH_PATH_SETTING_PANEL_SECTION_PANEL:"K-Chem-GlyphPath-SettingPanel-Section-Panel",GLYPH_MULTIPATH_SETTING_PANEL:"K-Chem-GlyphMultiPath-SettingPanel",GLYPH_MULTIPATH_SETTING_PANEL_PATH_TABGROUP:"K-Chem-GlyphMultiPath-SettingPanel-PathTabGroup",GLYPH_MULTIPATH_SETTING_PANEL_PATH_SETTING_PANEL:"K-Chem-GlyphMultiPath-SettingPanel-PathSettingPanel",GLYPH_REACTION_ARROW_PATH_SETTING_PANEL:"K-Chem-ReactionArrow-SettingPanel",GLYPH_REACTION_ARROW_PATH_SETTING_PANEL_ARROW_PRESET_SECTION:"K-Chem-ReactionArrow-SettingPanel-ArrowPresetSection",GLYPH_ARC_PATH_SETTING_PANEL:"K-Chem-ArcPath-SettingPanel",GLYPH_MULTIARC_PATH_SETTING_PANEL:"K-Chem-MultiArcPath-SettingPanel",GLYPH_ELECTRON_PUSHING_ARROW_SETTING_PANEL:"K-Chem-ElectronPusingArrow-SettingPanel",GLYPH_MULTI_ELECTRON_PUSHING_ARROW_SETTING_PANEL:"K-Chem-MultiElectronPusingArrow-SettingPanel"}),d.ChemWidget.StructureNodeSelectPanel=Class.create(d.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.StructureNodeSelectPanel",BTN_DATA_FIELD:"__$btn_data__",initialize:function(e){this.setPropStoreFieldValue("displayElements",!0),this.setPropStoreFieldValue("displayNonElements",!0),this.setPropStoreFieldValue("displaySubgroups",!0),this.tryApplySuper("initialize",[e]),this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,serializable:!1,setter:null}),this.defineProp("elementSymbols",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("nonElementInfos",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("subGroupInfos",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("subGroupRepItems",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("subGroupRepItems",e),this._updateSubGroupInfosFromRepItems(e)}}),this.defineProp("displayElements",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED}),this.defineProp("displayNonElements",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED}),this.defineProp("displaySubgroups",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED}),this.defineProp("activeNode",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){this.setPropStoreFieldValue("activeNode",e),this.activeNodeChanged(e)}}),this.defineProp("periodicTableDialog",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PRIVATE,serializable:!1,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("periodicTableDialog");if(!t&&e){var r=this.getCoreElement(),n=this.getDocument();t=this._createPeriodicTableDialogWidget(n,r),this.setPropStoreFieldValue("periodicTableDialog",t)}return t}})},initPropValues:function(){return this.tryApplySuper("initPropValues")},doFinalize:function(){var e=this.getPeriodicTableDialog();e&&e.finalize(),this.tryApplySuper("doFinalize")},setSelectableInfos:function(e){this.beginUpdate();try{this.setPropValues(e)}finally{this.endUpdate()}},reactSelButtonExec:function(e){var t=this,r=e.target;if(this._selButtons.indexOf(r)>=0){var n=r[this.BTN_DATA_FIELD];n&&(n.isPeriodicTable?this._openPeriodicTableDialog(r,(function(e){if(e===d.Widget.DialogButtons.OK){var r=t._periodicTable.getSelectedSymbol();t.doValueChanged(t.generateSelectableDataFromElementSymbol(r))}}),{isSimpleAtom:!0}):n.isVarList||n.isVarNotList?this._openPeriodicTableDialog(r,(function(e){if(e===d.Widget.DialogButtons.OK){var r=t._periodicTable.getSelectedSymbols(),i=d.VariableAtom,o=n.isVarList?{allowedIsotopeIds:r,disallowedIsotopeIds:null}:{allowedIsotopeIds:null,disallowedIsotopeIds:r};t.doValueChanged({nodeClass:i,props:o})}}),{isVarList:n.isVarList,isVarNotList:n.isVarNotList}):this.doValueChanged(n))}},doValueChanged:function(e){this.setPropStoreFieldValue("value",e),this.invokeEvent("valueChange",{value:{nodeClass:e.nodeClass,props:e.props,repositoryItem:e.repositoryItem}})},activeNodeChanged:function(e){},doObjectChange:function(e){d.ArrayUtils.intersect(e,["elementSymbols","nonElementInfos","subGroupInfos","displayElements","displayNonElements","displaySubGroups"]).length&&this.updatePanelContent(this.getDocument(),this.getCoreElement())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.STRUCTURE_NODE_SELECT_PANEL},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]);return this.updatePanelContent(e,this.getChildrenHolderElement()),r},_updateSubGroupInfosFromRepItems:function(e){var t=[];if(e&&e.length){for(var r=0,n=e.length;r<n;++r){var i=e[r],o=i.getStructureFragment(),a=o.getAbbr();if(!a){var s=o.getFormulaText(),l=d.FormulaUtils.textToFormula(s).getDisplayRichText();a=d.Render.RichTextUtils._toDebugHtml(l)}var u={text:a,repositoryItem:i,nodeClass:o.getClass(),node:o,hint:i.getName()};t.push(u)}this.setSubGroupInfos(t)}},updatePanelContent:function(e,t){if(this._selButtons)for(var r=this._selButtons.length-1;r>=0;--r){var n=this._selButtons[r];this.removeWidget(n)}this._selButtons=[],d.DomUtils.clearChildContent(t);var i=this.generateSelectableData(),o=this._getDisplayedTabPageNames(),a=new d.Widget.TabView(this);if(o.indexOf("atom")>=0){var s=a.createNewTabPage(d.$L("ChemWidgetTexts.CAPTION_ATOM"));this.getDisplayElements()&&this.doCreateSelButtonSection(e,s.getCoreElement(),i.elementData),this.getDisplayNonElements()&&this.doCreateSelButtonSection(e,s.getCoreElement(),i.nonElementData,!0)}if(o.indexOf("subgroup")>=0){var l=a.createNewTabPage(d.$L("ChemWidgetTexts.CAPTION_SUBGROUP"));this.doCreateSelButtonSection(e,l.getCoreElement(),i.subGroupData,!0)}a.setShowTabButtons(o.length>1)},_getDisplayedTabPageNames:function(){var e=[];return(this.getDisplayElements()||this.getDisplayNonElements())&&e.push("atom"),this.getDisplaySubgroups()&&e.push("subgroup"),e},generateSelectableDataFromElementSymbol:function(e){var t=e,r=d.IsotopesDataUtil.getIsotopeInfoById(e);return r&&(t=r.isotopeAlias?r.isotopeAlias:"<sup>"+r.massNumber+"</sup>"+r.elementSymbol),{text:t,nodeClass:d.Atom,props:{isotopeId:e}}},generateSelectableData:function(){for(var e=this.getElementSymbols()||[],t=[],r=0,n=e.length;r<n;++r){var i;i="..."===e[r]?{text:"\u2026",nodeClass:null,hint:d.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE"),isPeriodicTable:!0}:this.generateSelectableDataFromElementSymbol(e[r]),t.push(i)}return{elementData:t,nonElementData:this.getNonElementInfos(),subGroupData:this.getSubGroupInfos()}},doCreateSelButton:function(e,t,r,i){var o=r.text;i&&r.description&&(o+='<span style="font-size:80%"> '+r.description+"</span>");var a=new(0,d.Widget.Button)(e,o);return a.addClassName(n.STRUCTURE_NODE_SELECT_PANEL_SET_BUTTON),a.setGroup&&a.setGroup(this.getClassName()),r.hint&&a.setHint(r.hint),a[this.BTN_DATA_FIELD]=r,this._selButtons.push(a),a},doCreateSectionSelButtons:function(e,t,r,n){if(r)for(var i=0,o=r.length;i<o;++i){var a=this.doCreateSelButton(e,t,r[i],n);a.setParent(this),a.appendToElem(t)}},doCreateSection:function(e,t){var n=e.createElement("div");return n.className=r.SECTION,t&&t.appendChild(n),n},doCreateSelButtonSection:function(e,t,r,n){var i=this.doCreateSection(e,t);return this.doCreateSectionSelButtons(e,i,r,n),i},_createPeriodicTableDialogWidget:function(e,t){var r=new d.Widget.Dialog(e,d.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[d.Widget.DialogButtons.OK,d.Widget.DialogButtons.CANCEL]),n=new d.ChemWidget.PeriodicTable(e);return n.setUseMiniMode(!0).setEnableSelect(!0),n.setParent(r),n.appendToElem(r.getClientElem()),this._periodicTable=n,r},_openPeriodicTableDialog:function(e,t,r){var n=this.getPeriodicTableDialog(!0),i=r.isVarList||r.isVarNotList;this._periodicTable.setEnableMultiSelect(i).setSelectedSymbol(null);var o=this.getActiveNode();if((r.isVarList||r.isVarNotList)&&o instanceof d.VariableAtom){var a=o.getAllowedIsotopeIds(),s=o.getDisallowedIsotopeIds();this._periodicTable.setSelectedSymbols(r.isVarList?a:s)}!i&&o instanceof d.Atom&&this._periodicTable.setSelectedSymbol(o.getSymbol()),n.openPopup(t,e||this)}}),d.ChemWidget.StructureNodeSetter=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.ChemWidget.StructureNodeSetter",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueSetBySelectPanel=!1},initProperties:function(){this.defineProp("enableHydrogenCountInput",{dataType:DataType.BOOL}),this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){var t=d.ArrayUtils.toArray(e);this.setPropStoreFieldValue("nodes",t),this.nodesChanged(t)}}),this.defineProp("value",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("value");if(!e&&!this._valueSetBySelectPanel){var t=this.getNodeInputBox().getValue();e=this._getValueFromDirectInputText(t)}return e}}),this.defineProp("nodeLabel",{dataType:DataType.STRING,serializable:!1,setter:null,getter:function(){return this.getNodeInputBox().getValue()}}),this.defineProp("nodeInputBox",{dataType:"Kekule.Widget.ButtonTextBox",serializable:!1,setter:!1}),this.defineProp("nodeInputBoxFontSize",{dataType:DataType.STRING,serializable:!1,setter:function(e){this.getNodeInputBox().getTextBox().getElement().style.fontSize=e,this.setPropStoreFieldValue("nodeInputBoxFontSize",e)}}),this.defineProp("nodeSelectPanel",{dataType:"Kekule.ChemWidget.StructureNodeSelectPanel",serializable:!1,setter:!1}),this.defineProp("showInputBox",{dataType:DataType.BOOL,getter:function(){return this.getNodeInputBox().getDisplayed()},setter:function(e){this.getNodeInputBox().setDisplayed(e)}}),this.defineProp("showSelectPanel",{dataType:DataType.BOOL,getter:function(){return this.getNodeSelectPanel().getDisplayed()},setter:function(e){this.getNodeSelectPanel().setDisplayed(e)}}),this.defineProp("useDropDownSelectPanel",{dataType:DataType.BOOL,setter:function(e){this.getUseDropDownSelectPanel()!==e&&(this.setPropStoreFieldValue("useDropDownSelectPanel",e),this._updateDropDownSettings(e))}}),this.defineProp("labelConfigs",{dataType:DataType.OBJECT,serializable:!1}),this._defineSelectPanelDelegatedProp("selectableElementSymbols","elementSymbols"),this._defineSelectPanelDelegatedProp("selectableNonElementInfos","nonElementInfos"),this._defineSelectPanelDelegatedProp("selectableSubGroupInfos","subGroupInfos"),this._defineSelectPanelDelegatedProp("selectableSubGroupRepItems","subGroupRepItems"),this._defineSelectPanelDelegatedProp("displaySelectableElements","displayElements"),this._defineSelectPanelDelegatedProp("displaySelectableNonElements","displayNonElements"),this._defineSelectPanelDelegatedProp("displaySelectableSubgroups","displaySubgroups")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableHydrogenCountInput(!0)},doFinalize:function(){var e=this.getNodeSelectPanel();e&&e.finalize();var t=this.getNodeInputBox();t&&t.finalize(),this.tryApplySuper("doFinalize")},_defineSelectPanelDelegatedProp:function(e,t){t||(t=e);var r=ClassEx.getPropInfo(d.ChemWidget.StructureNodeSelectPanel,t),n=Object.create(r);return n.getter=null,n.setter=null,r.getter&&(n.getter=function(){return this.getNodeSelectPanel().getPropValue(t)}),r.setter&&(n.setter=function(e){this.getNodeSelectPanel().setPropValue(t,e)}),this.defineProp(e,n)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.STRUCTURE_NODE_SETTER},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=this,o=new d.Widget.ButtonTextBox(this);this.setPropStoreFieldValue("nodeInputBox",o),o.addClassName(n.STRUCTURE_NODE_SETTER_INPUTBOX),o.appendToElem(this.getCoreElement()),o.addEventListener("valueChange",(function(e){i._valueSetBySelectPanel=!1,e.stopPropagation()})),o.addEventListener("keyup",(function(e){var t=e.htmlEvent.getKeyCode();t===d.X.Event.KeyCode.ENTER&&i._applyDirectInput(),i.getUseDropDownSelectPanel()&&(t===d.X.Event.KeyCode.DOWN?i.showNodeSelectPanel():t===d.X.Event.KeyCode.UP&&i.hideNodeSelectPanel())})),o.addEventListener("blur",(function(e){e.target===o.getTextBox()&&o.getIsDirty()&&i._applyDirectInput()})),o.getButton().addEventListener("execute",(function(e){i.getUseDropDownSelectPanel()?i.toggleNodeSelectPanel():i._applyDirectInput()}));var a=new d.ChemWidget.StructureNodeSelectPanel(this);return this.setPropStoreFieldValue("nodeSelectPanel",a),a.appendToElem(this.getCoreElement()),a.addEventListener("valueChange",(function(e){Object.extend({},e),e.stopPropagation(),i._valueSetBySelectPanel=!0,i.doValueChanged(e.value,!0),i.getUseDropDownSelectPanel()&&a.hide()})),this._updateDropDownSettings(this.getUseDropDownSelectPanel()),r},_updateDropDownSettings:function(e){var t=this.getNodeInputBox(),r=this.getNodeSelectPanel();e?(t.setButtonKind(d.Widget.Button.Kinds.DROPDOWN),r.removeFromDom(),r.hide(null,null,d.Widget.ShowHideType.DEFAULT)):(t.setButtonKind(d.Widget.Button.Kinds.ENTER),r.appendToElem(this.getCoreElement()),r.setStyleProperty("position",""),r.show(null,null,d.Widget.ShowHideType.DEFAULT))},_indexOfNonElementLabel:function(e){for(var t=this.getNonAtomLabelInfos(),r=0,n=t.length;r<n;++r)if(t[r].nodeLabel===e)return r;return-1},_getNonAtomInfo:function(e){var t=this.getSelectableNonElementInfos();if(t)for(var r=0,n=t.length;r<n;++r){var i=t[r];if(i.text===e)return i}return null},_getNodeWithExplicitHInfo:function(e){var t={},r=e.trim().match(/^(\d*[A-Z][a-z]?\d*)H(\d*)$/);return r?(t.core=r[1],t.explicitHCount=parseInt(r[2])||1):t.core=e,t},_getValueFromDirectInputText:function(e){var t,r,n,i,o,a=this._getNonAtomInfo(e);if(a)t=a.nodeClass,r=a.props;else{var s=d.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText(e);if(n=s,s)t=s.getStructureFragment().getClass();else if(e){var l=e;if(!(t=d.ChemStructureNodeFactory.getClassByLabel(l,null))){if(this.getEnableHydrogenCountInput()){var u=this._getNodeWithExplicitHInfo(l);u.explicitHCount&&(t=d.ChemStructureNodeFactory.getClassByLabel(u.core,null))&&(o=u.explicitHCount,l=u.core)}t||(t=d.Pseudoatom,i=!0)}r=t===d.Atom?{isotopeId:l,inputHydrogenCount:o}:t===d.Pseudoatom?{symbol:e}:{}}}return{nodeClass:t,props:r,repositoryItem:n,isUnknownPseudoatom:i}},_applyDirectInput:function(){this._valueSetBySelectPanel=!1;var e=this.getNodeInputBox();if(e.getIsDirty()){var t=e.getValue(),r=this._getValueFromDirectInputText(t);this.doValueChanged(r),e.setIsDirty(!1)}else this.doValueChanged(null)},_getVarAtomListLabel:function(){var e=this.getLabelConfigs();return e?e.getVariableAtom():d.ChemStructureNodeLabels.VARIABLE_ATOM},_getVarAtomNotListLabel:function(){var e=this.getLabelConfigs();return"~"+(e?e.getVariableAtom():d.ChemStructureNodeLabels.VARIABLE_ATOM)},_getAllNodeLabels:function(e){var t={};return this.getEnableHydrogenCountInput()&&(t.includeExplicitHydrogens=!0),d.Editor.StructureUtils.getAllChemStructureNodesLabel(e,this.getLabelConfigs(),t)},nodesChanged:function(e){var t=this._getAllNodeLabels(e)||"",r=t?e[0]:null;this.getNodeSelectPanel().setActiveNode(r),this.getNodeInputBox().setValue(t),this.getNodeInputBox().setIsDirty(!1),this.setPropStoreFieldValue("value",null),this._valueSetBySelectPanel=!1},doValueChanged:function(e,t){this.setPropStoreFieldValue("value",e);var r=e&&{nodeClass:e.nodeClass,props:e.props,repositoryItem:e.repositoryItem,isUnknownPseudoatom:e.isUnknownPseudoatom};t&&this.invokeEvent("valueSelect",{value:r}),this.invokeEvent("valueChange",{value:r})},setSelectableInfos:function(e){this.getNodeSelectPanel().setSelectableInfos(e)},showNodeSelectPanel:function(){var e=this.getNodeSelectPanel();e.isShown()||e.show(this.getNodeInputBox(),null,d.Widget.ShowHideType.DROPDOWN)},hideNodeSelectPanel:function(){var e=this.getNodeSelectPanel();e.isShown()&&e.hide()},toggleNodeSelectPanel:function(){var e=this.getNodeSelectPanel();e.isShown()?e.hide():e.show(this.getNodeInputBox(),null,d.Widget.ShowHideType.DROPDOWN)}}),d.ChemWidget.StructureConnectorSelectPanel=Class.create(d.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.StructureConnectorSelectPanel",BTN_DATA_FIELD:"__$btn_data__",BTN_GROUP:"__$bond_btn_group__",initialize:function(e){this.tryApplySuper("initialize",[e]),this._selButtons=[],this._activeBtn=null,this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,serializable:!1,setter:null}),this.defineProp("bondData",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("activeBondPropValues",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLIC,setter:function(e){this.setPropStoreFieldValue("activeBondPropValues",e),this.activeBondPropsChanged(e)}}),this.defineProp("activeBondHtmlClass",{dataType:DataType.STRING,scope:Class.PropertyScope.PRIVATE,setter:null,getter:function(){var e=this._activeBtn;if(e){var t=e[this.BTN_DATA_FIELD];return t&&t.htmlClass}return null}}),this.defineProp("bondPropNames",{dataType:DataType.ARRAY,serializable:!1})},doObjectChange:function(e){d.ArrayUtils.intersect(e,["bondData"]).length&&this.updatePanelContent(this.getDocument(),this.getCoreElement())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.STRUCTURE_CONNECTOR_SELECT_PANEL},doCreateRootElement:function(e){return e.createElement("span")},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]);return this.updatePanelContent(e,t),r},activeBondPropsChanged:function(e){if(this._activeBtn&&(this._activeBtn.setChecked(!1),this._activeBtn=null),e)for(var t=this._selButtons,r=0,n=t.length;r<n;++r){var i=t[r][this.BTN_DATA_FIELD];if(i&&this._isBondPropsMatch(e,i.bondProps,this.getBondPropNames())){t[r].setChecked(!0),this._activeBtn=t[r];break}}},_isBondPropsMatch:function(e,t,r){return d.Editor.StructureUtils.isBondPropsMatch(e,t,r)},reactSelButtonExec:function(e){var t=e.target;if(this._selButtons.indexOf(t)>=0){this._activeBtn=t;var r=t[this.BTN_DATA_FIELD];r&&(this.setPropStoreFieldValue("activeBondPropValues",r.bondProps),this.doValueChanged(r.bondProps))}},doValueChanged:function(e){this.setPropStoreFieldValue("value",e),this.invokeEvent("valueChange",{value:e})},updatePanelContent:function(e,r){if(this._selButtons)for(var n=this._selButtons.length-1;n>=0;--n){var i=this._selButtons[n];this.removeWidget(i)}var o=[];this._selButtons=[];var a=this.getBondData();if(a){n=0;for(var s=a.length;n<s;++n){var l=a[n],u=l.bondProps;(i=this._createBondSelButton(e,l)).appendToElem(r),this._selButtons.push(i),u&&t.pushUnique(o,d.ObjUtils.getOwnedFieldNames(u))}}this.getBondPropNames()||this.setPropStoreFieldValue("bondPropNames",o)},_createBondSelButton:function(e,t){var r=new d.Widget.RadioButton(this);return r.addClassName(n.STRUCTURE_CONNECTOR_SELECT_PANEL_SET_BUTTON),r.setGroup(this.BTN_GROUP).setShowGlyph(!0).setShowText(!1),r.setText(t.text||null).setHint(t.hint||t.description||null),t.htmlClass&&r.addClassName(t.htmlClass),r[this.BTN_DATA_FIELD]=t,r}}),d.ChemWidget.StructureConnectorSelectPanelAdv=Class.create(d.ChemWidget.StructureConnectorSelectPanel,{CLASS_NAME:"Kekule.ChemWidget.StructureConnectorSelectPanelAdv",initialize:function(e){this.setPropStoreFieldValue("extraComponents",[d.ChemWidget.StructureConnectorSelectPanelAdv.Components.KEKULIZE]),this._additionalCompWidgets=[],this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("extraComponents",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.STRUCTURE_CONNECTOR_SELECT_PANEL_ADV},doObjectChange:function(e){this.tryApplySuper("doObjectChange",[e]),d.ArrayUtils.intersect(e,["extraComponents"]).length&&this.updatePanelContent(this.getDocument(),this.getCoreElement())},updatePanelContent:function(e,t){this.clearAdditionalSections(),this.tryApplySuper("updatePanelContent",[e,t]);var r=this.getExtraComponents();r&&r.indexOf(d.ChemWidget.StructureConnectorSelectPanelAdv.Components.KEKULIZE)>=0&&this._createKekulizeSection(e,t).appendToElem(t)},reactSelButtonExec:function(e){this.tryApplySuper("reactSelButtonExec",[e]);var t=e.target;t._command&&this.invokeEvent("command",{command:t._command})},clearAdditionalSections:function(){if(this._additionalCompWidgets){for(var e=0,t=this._additionalCompWidgets.length;e<t;++e)this._additionalCompWidgets[e].finalize();this._additionalCompWidgets=[]}},createAdditionalSection:function(e,t){var r=new d.Widget.Container(e);return r.addClassName(n.STRUCTURE_CONNECTOR_SELECT_PANEL_ADV_EXTRA_SECTION),this._additionalCompWidgets.push(r),r.appendToElem(t),r.setParent(this),r},_createKekulizeSection:function(e,t){var r=this.createAdditionalSection(e,t),i=new d.Widget.Button(r);i.addClassName([n.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON,n.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_KEKULIZE]).setText(d.$L("ChemWidgetTexts.CAPTION_MOL_BOND_KEKULIZE")).setHint(d.$L("ChemWidgetTexts.HINT_MOL_BOND_KEKULIZE")).setShowGlyph(!0).setShowText(!1),i._command=d.ChemWidget.StructureConnectorSelectPanelAdv.Commands.KEKULIZE,r.appendWidget(i);var o=e.createElement("span");d.DomUtils.setElementText(o," \u25c0 \u25b6 "),r.getElement().appendChild(o);var a=new d.Widget.Button(r);return a.addClassName([n.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON,n.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_HUCKLIZE]).setText(d.$L("ChemWidgetTexts.CAPTION_MOL_BOND_HUCKLIZE")).setHint(d.$L("ChemWidgetTexts.HINT_MOL_BOND_HUCKLIZE")).setShowGlyph(!0).setShowText(!1),a._command=d.ChemWidget.StructureConnectorSelectPanelAdv.Commands.HUCKLIZE,r.appendWidget(a),r}}),d.ChemWidget.StructureConnectorSelectPanelAdv.Components={KEKULIZE:"kekulize"},d.ChemWidget.StructureConnectorSelectPanelAdv.Commands={KEKULIZE:"kekulize",HUCKLIZE:"hucklize"},d.ChemWidget.ChargeSelectPanel=Class.create(d.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.ChargeSelectPanel",CHARGE_FIELD:"__$charge__",initialize:function(e){this._chargeBtnGroups={},this._selectedButton=null,this._chargeButtonMap=[],this.setPropStoreFieldValue("maxCharge",4),this.setPropStoreFieldValue("minCharge",-4),this.tryApplySuper("initialize",[e]),this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getValue();if(e!==t){var r=this._chargeButtonMap[t];r&&(r.setChecked(!1),r.blur()),this.setPropStoreFieldValue("value",e);var n=this._chargeButtonMap[e];n&&n.setChecked(!0),this._selectedButton=n}}}),this.defineProp("minCharge",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC,setter:function(e){e!==this.getMinCharge()&&(this.setPropStoreFieldValue("minCharge",e),this.updateChargeButtons())}}),this.defineProp("maxCharge",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC,setter:function(e){e!==this.getMaxCharge()&&(this.setPropStoreFieldValue("maxCharge",e),this.updateChargeButtons())}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.CHARGE_SELECT_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]);return this.updateChargeButtons(e,t),r},updateChargeButtons:function(e,t){for(var r=this._chargeBtnGroups,i=["zero","positive","negative"],o=0,a=i.length;o<a;++o)(s=r[i[o]])?s.clearWidgets():((s=new d.Widget.ButtonGroup(this)).addClassName(n.CHARGE_SELECT_PANEL_BTNGROUP),s.appendToElem(t),r[i[o]]=s);var s,l=Math.floor(this.getMaxCharge()),u=Math.floor(this.getMinCharge()),c=d.$L("ChemWidgetTexts.TEXT_CHARGE_POSITIVE"),h=d.$L("ChemWidgetTexts.TEXT_CHARGE_NEGATIVE");if(l>=1&&(s=this._chargeBtnGroups.positive))for(o=Math.max(u,1);o<=l;++o)this._createChargeButton(s,o,o+c);if(l>=0&&u<=0&&(s=this._chargeBtnGroups.zero)&&this._createChargeButton(s,0,d.$L("ChemWidgetTexts.TEXT_CHARGE_NONE"),d.$L("ChemWidgetTexts.HINT_CHARGE_NONE")),u<=-1&&(s=this._chargeBtnGroups.negative))for(o=Math.min(l,-1);o>=u;--o)this._createChargeButton(s,o,Math.abs(o)+h)},_createChargeButton:function(e,t,r,i){var o=new d.Widget.RadioButton(e,r);return o[this.CHARGE_FIELD]=t,this._chargeButtonMap[t]=o,i&&o.setHint(i),o.addClassName(n.CHARGE_SELECT_PANEL_CHARGE_BUTTON),o.appendToWidget(e),this.getValue()===t&&(o.setChecked(!0),this._selectedButton=o),o},reactSelButtonExec:function(e){var t=e.target[this.CHARGE_FIELD];d.ObjUtils.notUnset(t)&&(this.setValue(t),this.notifyValueChange(t))},notifyValueChange:function(e){this.invokeEvent("valueChange",{value:e})}}),d.ChemWidget.GlyphPathArrowSettingPanel=Class.create(d.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphPathArrowSettingPanel",DATA_FIELD:"__$data$__",initialize:function(e){this._isSettingValue=!1,this._arrowWidthInputter=null,this._arrowLengthInputter=null,this._arrowStyleButtons=null,this.setPropStoreFieldValue("arrowWidthMin",0),this.setPropStoreFieldValue("arrowWidthMax",.5),this.setPropStoreFieldValue("arrowWidthStep",.1),this.setPropStoreFieldValue("arrowLengthMin",0),this.setPropStoreFieldValue("arrowLengthMax",.5),this.setPropStoreFieldValue("arrowLengthStep",.1),this.setPropStoreFieldValue("showContinousArrowSidesSetter",!1),this.setPropStoreFieldValue("defaultValue",{arrowType:d.Glyph.ArrowType.NONE,arrowSide:d.Glyph.ArrowSide.BOTH}),this.tryApplySuper("initialize",[e]),this.addEventListener("check",this.reactArrowStyleButtonCheck.bind(this)),this.addEventListener("valueChange",this.reactArrowSizeInputterChange.bind(this)),this.addEventListener("valueInput",this.reactArrowSizeInputterInput.bind(this))},initProperties:function(){this.defineProp("defaultValue",{dataType:DataType.HASH,scope:Class.PropertyScope.PRIVATE}),this.defineProp("value",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("value");return e||(e={},this.setPropStoreFieldValue("value",e)),e},setter:function(e){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",e);for(var t=Object.extend(Object.extend({},this.getDefaultValue()),e,!1,!0),r=0,n=this._arrowStyleButtons.length;r<n;++r){var i=this._arrowStyleButtons[r],o=i[this.DATA_FIELD];o.arrowType!==t.arrowType||o.arrowSide!==t.arrowSide&&o.arrowType!==d.Glyph.ArrowType.NONE?i.setChecked(!1):i.setChecked(!0)}this._arrowWidthInputter.setValue(t.arrowWidth||0),this._arrowLengthInputter.setValue(t.arrowLength||0)}finally{this._isSettingValue=!1}}}),this.defineProp("allowedArrowTypes",{dataType:DataType.ARRAY}),this.defineProp("allowedArrowSides",{dataType:DataType.ARRAY}),this.defineProp("arrowWidthMin",{dataType:DataType.NUMBER}),this.defineProp("arrowWidthMax",{dataType:DataType.NUMBER}),this.defineProp("arrowWidthStep",{dataType:DataType.NUMBER}),this.defineProp("arrowLengthMin",{dataType:DataType.NUMBER}),this.defineProp("arrowLengthMax",{dataType:DataType.NUMBER}),this.defineProp("arrowLengthStep",{dataType:DataType.NUMBER})},doObjectChange:function(e){(e.indexOf("allowedArrowTypes")>=0||e.indexOf("allowedArrowSides")>=0)&&this._updateStyleButtons(),t.intersect(e,["arrowWidthMin","arrowWidthMax","arrowWidthStep"]).length&&this._updateWidthInputter(),t.intersect(e,["arrowLengthMin","arrowLengthMax","arrowLengthStep"]).length&&this._updateLengthInputter()},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_PATH_ARROW_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),n=this.doCreateSectionElem(e,t),i=this.doCreateArrowStyleButtons(e,n),o=this.doCreateSectionElem(e,t),a=this.doCreateArrowSizeControls(e,o);return r.concat(i).concat(a)},doCreateSectionElem:function(e,t){var r=e.createElement("div");return t.appendChild(r),r},doCreateArrowStyleButtons:function(e,t){var r=d.Glyph.ArrowType,i=d.Glyph.ArrowSide,o={};o[r.NONE]="None",o[r.OPEN]="Open",o[r.TRIANGLE]="Triangle";var a={};a[i.BOTH]="Both",a[i.SINGLE]="Single",a[i.REVERSED]="Reversed";var s=[r.NONE,r.OPEN,r.TRIANGLE],l=[i.BOTH,i.SINGLE,i.REVERSED],u=new d.Widget.ButtonGroup(this);u.addClassName(n.GLYPH_PATH_ARROW_STYLE_BTNGROUP),this._arrowStyleButtons=[];var c=s.indexOf(r.NONE);if(c>=0){s.splice(c,1);var h=y=E=o[r.NONE],p=n.GLYPH_PATH_ARROW_STYLE_BUTTON+"-"+E;(_=new d.Widget.RadioButton(u,y)).setHint(h).addClassName(p),_[this.DATA_FIELD]={arrowType:r.NONE,arrowSide:(this.getDefaultValue()||{}).arrowSide},this._arrowStyleButtons.push(_)}for(var g=0,f=s.length;g<f;++g)for(var m=0,C=l.length;m<C;++m){var y,_,E=o[s[g]],T=a[l[m]];h=y=E+" / "+T,p=n.GLYPH_PATH_ARROW_STYLE_BUTTON+"-"+E+"-"+T,(_=new d.Widget.RadioButton(u,y)).setHint(h).addClassName(p),_[this.DATA_FIELD]={arrowType:s[g],arrowSide:l[m]},this._arrowStyleButtons.push(_)}return u.setShowGlyph(!0).setShowText(!1),this._updateStyleButtons(this._arrowStyleButtons),u.appendToElem(t),[u]},doCreateArrowSizeControls:function(e,t){var r=this._createArrowSizeSlider(e,t,d.$L("ChemWidgetTexts.CAPTION_WIDTH")+":"),n=this._createArrowSizeSlider(e,t,d.$L("ChemWidgetTexts.CAPTION_LENGTH")+":");return this._arrowWidthInputter=r,this._arrowLengthInputter=n,this._updateWidthInputter(r),this._updateLengthInputter(n),[r,n]},_createArrowSizeSlider:function(e,t,r){var i=e.createElement("div");i.className=n.GLYPH_Path_ARROW_SIZE_SETTER;var o=e.createElement("label");d.DomUtils.setElementText(o,r);var a=new d.Widget.NumInput(this);return a.appendToElem(o),i.appendChild(o),t.appendChild(i),a},_updateStyleButtons:function(e){var t=this.getAllowedArrowTypes(),r=this.getAllowedArrowSides();if(e||(e=this._arrowStyleButtons),e)for(var n=0,i=e.length;n<i;++n){var o=e[n][this.DATA_FIELD],a=t&&t.indexOf(o.arrowType)<0||r&&r.indexOf(o.arrowSide)<0;e[n].setDisplayed(!a)}},_updateSizeInputter:function(t,r,n,i,o){var a=e.notUnset;a(n)&&t.setMinValue(n),a(i)&&t.setMaxValue(i),a(o)&&t.setStep(o),a(r)&&t.setValue(r)},_updateWidthInputter:function(e){e||(e=this._arrowWidthInputter),this._updateSizeInputter(e,this.getValue().arrowWidth,this.getArrowWidthMin(),this.getArrowWidthMax(),this.getArrowWidthStep())},_updateLengthInputter:function(e){e||(e=this._arrowLengthInputter),this._updateSizeInputter(e,this.getValue().arrowLength,this.getArrowLengthMin(),this.getArrowLengthMax(),this.getArrowLengthStep())},getDefaultAllowedArrowTypes:function(){var e=d.Glyph.ArrowType;return[e.NONE,e.OPEN,e.TRIANGLE]},notifyValueChange:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueChange",{value:e})},notifyValueInput:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueInput",{value:e})},reactArrowStyleButtonCheck:function(e){if(!this._isSettingValue){var t=e.widget;if(t&&t[this.DATA_FIELD]){var r=this.getValue();r.arrowType=t[this.DATA_FIELD].arrowType,r.arrowSide=t[this.DATA_FIELD].arrowSide,this.notifyValueChange(r),e.stopPropagation()}}},reactArrowSizeInputterChange:function(t){if(!this._isSettingValue){var r=t.widget;if(r===this._arrowWidthInputter||r===this._arrowLengthInputter){var n=r.getValue()&&r.getValue();if(e.notUnset(n)){var i=this.getValue();r===this._arrowWidthInputter?i.arrowWidth=n:r===this._arrowLengthInputter&&(i.arrowLength=n),this.notifyValueChange(i),t.stopPropagation()}}}},reactArrowSizeInputterInput:function(t){if(!this._isSettingValue){var r=t.widget;if(r===this._arrowWidthInputter||r===this._arrowLengthInputter){var n=r.getValue()&&r.getValue();if(e.notUnset(n)){var i=this.getValue();r===this._arrowWidthInputter?i.arrowWidth=n:r===this._arrowLengthInputter&&(i.arrowLength=n),this.notifyValueInput(i),t.stopPropagation()}}}}}),d.ChemWidget.GlyphReactionArrowPresetSelector=Class.create(d.Widget.Container,{CLASS_NAME:"Kekule.ChemWidget.GlyphReactionArrowPresetSelector",DATA_FIELD:"__$data$__",initialize:function(e){this._isSettingValue=!1,this._buttonSet=null,this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("value",{dataType:DataType.STRING,getter:function(){return this.getPropStoreFieldValue("value")||""},setter:function(e){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",e);for(var t=this._buttonSet.getButtonSet().getChildWidgets(),r=0,n=t.length;r<n;++r){var i=t[r];i[this.DATA_FIELD].reactionArrowType===e?i.setChecked(!0):i.setChecked(!1)}}finally{this._isSettingValue=!1}}}),this.defineProp("allowedReactionArrowTypes",{dataType:DataType.ARRAY})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_REACTION_ARROW_PRESET_SELECTOR},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),n=this.doCreateButtonSet(e,t);return r.concat([n.getElement()])},doCreateButtonSet:function(e,t){var r=new d.Widget.CompactButtonSet(this);r.addClassName(n.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET),r.getButtonSet().addClassName(n.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET_DROPDOWN);for(var i=this.getAllowedReactionArrowTypes()||this.getDefaultAllowedReactionTypes(),o=0,a=i.length;o<a;++o){var s=new d.Widget.RadioButton(r),l=this._getPresetButtonDetails(i[o]);s.addClassName(l.className,!0).setText(l.caption).setHint(l.hint).setShowText(!0).setShowGlyph(!0),s[this.DATA_FIELD]={reactionArrowType:i[o]},r.append(s)}var u=this;return r.addEventListener("select",(function(e){if(!u._isSettingValue&&e.target===r){var t=e.selected;if(t&&t[u.DATA_FIELD]){var n=t[u.DATA_FIELD].reactionArrowType;u.setPropStoreFieldValue("value",n),u.notifyValueChange(n)}}})),r.appendToElem(t),this._buttonSet=r,r},_getPresetButtonDetails:function(e){d.Glyph.ReactionArrowType;var t=e?e.toUpperCase():"UNSET",r=e?e.upperFirst():"Unset",i="REACTION_ARROW_"+t;return{caption:d.$L("ChemWidgetTexts.CAPTION_"+i),hint:d.$L("ChemWidgetTexts.HINT_"+i),className:n.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BUTTON+" "+n.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BUTTON+"-"+r}},notifyValueChange:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueChange",{value:e})},getDefaultAllowedReactionTypes:function(){var e=d.Glyph.ReactionArrowType;return[null,e.NORMAL,e.REVERSIBLE,e.RESONANCE,e.RETROSYNTHESIS,e.CUSTOM]}}),d.ChemWidget.GlyphElectronPushingArrowPresetSelector=Class.create(d.Widget.Container,{CLASS_NAME:"Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector",DATA_FIELD:"__$data$__",initialize:function(e){this._isSettingValue=!1,this._buttonGroup=null,this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("value",{dataType:DataType.INT,getter:function(){return this.getPropStoreFieldValue("value")||""},setter:function(e){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",e);for(var t=this._buttonGroup.getChildWidgets(),r=0,n=t.length;r<n;++r){var i=t[r];i[this.DATA_FIELD].electronCount===e?i.setChecked(!0):i.setChecked(!1)}}finally{this._isSettingValue=!1}}}),this.defineProp("allowedReactionArrowTypes",{dataType:DataType.ARRAY})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),n=this.doCreateButtonGroup(e,t);return r.concat([n.getElement()])},doCreateButtonGroup:function(e,t){var r=new d.Widget.ButtonGroup(this);r.addClassName(n.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BTNGROUP);for(var i=[2,1],o=0,a=i.length;o<a;++o){var s=i[o],l=new d.Widget.RadioButton(r),u=this._getPresetButtonDetails(s);l.addClassName(u.className,!0).setText(u.caption).setHint(u.hint).setShowText(!0).setShowGlyph(!0),l[this.DATA_FIELD]={electronCount:s},r.appendWidget(l)}var c=this;return r.addEventListener("check",(function(e){if(!c._isSettingValue){var t=e.widget;if(t&&t[c.DATA_FIELD]){var r=t[c.DATA_FIELD].electronCount;c.setPropStoreFieldValue("value",r),c.notifyValueChange(r)}}})),r.appendToElem(t),this._buttonGroup=r,r},_getPresetButtonDetails:function(e){var t=e.toString(),r="ELECTRON_PUSHING_ARROW_"+e;return{caption:d.$L("ChemWidgetTexts.CAPTION_"+r+"_ABBR"),hint:d.$L("ChemWidgetTexts.HINT_"+r),className:n.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BUTTON+" "+n.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BUTTON+"-"+t}},notifyValueChange:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueChange",{value:e})}}),d.ChemWidget.GlyphPathLineSettingPanel=Class.create(d.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphPathLineSettingPanel",initialize:function(e){this._isSettingValue=!1,this.setPropStoreFieldValue("lineCountMin",1),this.setPropStoreFieldValue("lineCountMax",5),this.setPropStoreFieldValue("lineCountStep",1),this.setPropStoreFieldValue("lineGapMin",0),this.setPropStoreFieldValue("lineGapMax",.8),this.setPropStoreFieldValue("lineGapStep",.1),this.tryApplySuper("initialize",[e]),this.addEventListener("valueChange",this.reactInputWidgetChange.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("value");return e||(e={},this.setPropStoreFieldValue("value",e)),e},setter:function(e){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",e),this._lineCountInput.setValue(e.lineCount),this._lineGapInput.setValue(e.lineGap)}finally{this._isSettingValue=!1}}}),this.defineProp("lineCountMin",{dataType:DataType.NUMBER}),this.defineProp("lineCountMax",{dataType:DataType.NUMBER}),this.defineProp("lineCountStep",{dataType:DataType.NUMBER}),this.defineProp("lineGapMin",{dataType:DataType.NUMBER}),this.defineProp("lineGapMax",{dataType:DataType.NUMBER}),this.defineProp("lineGapStep",{dataType:DataType.NUMBER})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_PATH_LINE_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),n=this.doCreateNumInputSection(e,t,d.$L("ChemWidgetTexts.CAPTION_LINE_COUNT")+":");this._lineCountInput=n.widget,this._updateLineCountInput();var i=this.doCreateNumInputSection(e,t,d.$L("ChemWidgetTexts.CAPTION_LINE_GAP")+":");return this._lineGapInput=i.widget,this._updateLineGapInput(),r.concat([n,i])},doCreateNumInputSection:function(e,t,r){var n=e.createElement("span"),i=e.createElement("label");d.DomUtils.setElementText(i,r);var o=new d.Widget.NumInput(this,null,null,null,"number");return o.appendToElem(i),n.appendChild(i),t.appendChild(n),{elem:n,widget:o}},_updateInputWidget:function(t,r,n,i,o){var a=e.notUnset;t&&(t.setValue(r),a(n)&&t.setMinValue(n),a(i)&&t.setMaxValue(i),a(o)&&t.setStep(o))},_updateLineCountInput:function(){this._updateInputWidget(this._lineCountInput,this.getValue().lineCount,this.getLineCountMin(),this.getLineCountMax(),this.getLineCountStep())},_updateLineGapInput:function(){this._updateInputWidget(this._lineGapInput,this.getValue().lineGap,this.getLineGapMin(),this.getLineGapMax(),this.getLineGapStep())},notifyValueChange:function(e){this.notifyPropSet("value",e),this.invokeEvent("valueChange",{value:e})},reactInputWidgetChange:function(t){if(!this._isSettingValue){var r=t.widget;if(r===this._lineCountInput||r===this._lineGapInput){var n=r.getValue()&&r.getValue();if(e.notUnset(n)){var i=this.getValue();r===this._lineCountInput?i.lineCount=n:r===this._lineGapInput&&(i.lineGap=n),this.notifyValueChange(i),t.stopPropagation()}}}}}),d.ChemWidget.GlyphPathSettingPanel=Class.create(d.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphPathSettingPanel",DEF_COMPONENTS:["startingArrow","endingArrow","line"],initialize:function(e){this.tryApplySuper("initialize",[e]),this.addEventListener("valueChange",this.reactChildSetterValueChange.bind(this)),this.addEventListener("valueInput",this.reactChildSetterValueInput.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,getter:function(){var e={};return this._startingArrowSetter&&(e=Object.extend(e,this._addPropPrefix(this._startingArrowSetter.getValue(),"start"))),this._endingArrowSetter&&(e=Object.extend(e,this._addPropPrefix(this._endingArrowSetter.getValue(),"end"))),this._lineSetter&&(e=Object.extend(e,this._lineSetter.getValue())),e},setter:function(e){if(e){var t=this._splitChildSetterValues(e);this._startingArrowSetter&&this._startingArrowSetter.setValue(t.startingArrow),this._endingArrowSetter&&this._endingArrowSetter.setValue(t.endingArrow),this._lineSetter&&this._lineSetter.setValue(t.line)}}}),this.defineProp("components",{dataType:DataType.ARRAY})},doObjectChange:function(e){return e.indexOf("components")>=0&&this.updateComponents(),this.tryApplySuper("doObjectChange",[e])},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_PATH_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),n=this.doCreateArrowSettingSection(e,t,d.$L("ChemWidgetTexts.CAPTION_STARTING_ARROW"));this._startingArrowSetter=n.widget,this._startingArrowElem=n.elem;var i=this.doCreateArrowSettingSection(e,t,d.$L("ChemWidgetTexts.CAPTION_ENDING_ARROW"));this._endingArrowSetter=i.widget,this._endingArrowElem=i.elem;var o=this.doCreateLineSettingSection(e,t,d.$L("ChemWidgetTexts.CAPTION_LINE"));return this._lineSetter=o.widget,this._lineElem=o.elem,r=r.concat([n.elem,i.elem,o.elem]),this.updateComponents(),r},doCreateSectionElem:function(e,t,r,i){var o=e.createElement("div"),a=e.createElement("label");d.DomUtils.setElementText(a,r),a.className=n.GLYPH_PATH_SETTING_PANEL_SECTION_TITLE,o.appendChild(a);var s=n.GLYPH_PATH_SETTING_PANEL_SECTION;return i&&(s+=" "+i),o.className=s,t.appendChild(o),o},doCreateArrowSettingSection:function(e,t,r){var i=this.doCreateSectionElem(e,t,r),o=new d.ChemWidget.GlyphPathArrowSettingPanel(this);return o.addClassName(n.GLYPH_PATH_SETTING_PANEL_SECTION_PANEL),o.appendToElem(i),{elem:i,widget:o}},doCreateLineSettingSection:function(e,t,r){var i=this.doCreateSectionElem(e,t,r),o=new d.ChemWidget.GlyphPathLineSettingPanel(this);return o.addClassName(n.GLYPH_PATH_SETTING_PANEL_SECTION_PANEL),o.appendToElem(i),{elem:i,widget:o}},updateComponents:function(){var e=this.getComponents()||this.DEF_COMPONENTS,t=d.StyleUtils;t.setDisplay(this._startingArrowElem,e.indexOf("startingArrow")>=0),t.setDisplay(this._endingArrowElem,e.indexOf("endingArrow")>=0),t.setDisplay(this._lineElem,e.indexOf("line")>=0)},reactChildSetterValueChange:function(e){var t=e.widget;if(t&&this.getChildValueSetterWidgets().indexOf(t)>=0){var r=this.getValue();e.stopPropagation(),this.notifyPropSet("value",r),this.invokeEvent("valueChange",{value:r})}},reactChildSetterValueInput:function(e){var t=e.widget;if(t&&this.getChildValueSetterWidgets().indexOf(t)>=0){var r=this.getValue();e.stopPropagation(),this.notifyPropSet("value",r),this.invokeEvent("valueInput",{value:r})}},getChildValueSetterWidgets:function(e){return[this._startingArrowSetter,this._endingArrowSetter,this._lineSetter]},getStartingArrowSetter:function(){return this._startingArrowSetter},getEndingArrowSetter:function(){return this._endingArrowSetter},_addPropPrefix:function(t,r){for(var n={},i=e.getOwnedFieldNames(t,!1),o=0,a=i.length;o<a;++o){var s=t[i[o]];n[r+i[o].capitalizeFirst()]=s}return n},_splitChildSetterValues:function(t){for(var r={startingArrow:{},endingArrow:{},line:{}},n=e.getOwnedFieldNames(t),i=0,o=n.length;i<o;++i){var a,s=n[i],l=t[s];s.startsWith("startArrow")?(a="arrow"+s.substr(10),r.startingArrow[a]=l):s.startsWith("endArrow")?(a="arrow"+s.substr(8),r.endingArrow[a]=l):r.line[s]=l}return r}}),d.ChemWidget.GlyphMultiPathSettingPanel=Class.create(d.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiPathSettingPanel",DEF_PATH_COUNT:2,DEF_COMPONENTS:["endingArrow"],initialize:function(e){this.setPropStoreFieldValue("value",[]),this.tryApplySuper("initialize",[e]),this.getPathCount()||this.setPathCount(this.DEF_PATH_COUNT),this.setActivePathIndex(0);var t=this.reactChildSetterValueChange.bind(this),r=this.reactChildSetterValueInput.bind(this);this.addEventListener("valueChange",t),this.addEventListener("valueInput",r),this.addEventListener("switch",this.reactPathTabSwitch.bind(this))},initProperties:function(){this.defineProp("pathCount",{dataType:DataType.INT,getter:function(){return this.getPathTabGroup().getTabButtons().length},setter:function(e){this._updatePathTabGroup(e)}}),this.defineProp("pathSettingPanel",{dataType:"Kekule.ChemWidget.GlyphPathSettingPanel",serializable:!1,setter:null}),this.defineProp("pathTabGroup",{dataType:"Kekule.Widget.TabButtonGroup",serializable:!1,setter:null}),this.defineProp("activePathIndex",{dataType:DataType.INT,getter:function(){return this.getPathTabGroup().getActiveTabIndex()},setter:function(e){this.getPathTabGroup().setActiveTabIndex(e),this._switchToNewPathTab(e)}}),this.defineProp("value",{dataType:DataType.HASH,setter:function(e){if(e){var r=t.toArray(e);this.setPropStoreFieldValue("value",r),r.length>this.getActivePathIndex()&&this.getPathSettingPanel().setValue(r[this.getActivePathIndex()])}else this.setPropStoreFieldValue("value",[])}}),this.defineProp("components",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPathSettingPanel();return e&&e.getComponents()},setter:function(e){this.getPathSettingPanel().setComponents(e)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_MULTIPATH_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.tryApplySuper("doCreateSubElements",[e,t]),i=new d.Widget.TabButtonGroup(this);i.setTabButtonPosition(d.Widget.Position.TOP).addClassName(n.GLYPH_MULTIPATH_SETTING_PANEL_PATH_TABGROUP),this.setPropStoreFieldValue("pathTabGroup",i);var o=new d.ChemWidget.GlyphPathSettingPanel(this);return o.addClassName(n.GLYPH_MULTIPATH_SETTING_PANEL_PATH_SETTING_PANEL),o.setComponents(this.DEF_COMPONENTS),this.setPropStoreFieldValue("pathSettingPanel",o),r},getStartingArrowSetter:function(){return this.getPathSettingPanel().getStartingArrowSetter()},getEndingArrowSetter:function(){return this.getPathSettingPanel().getEndingArrowSetter()},_updatePathTabGroup:function(e){this.getActivePathIndex();var t=this.getPathCount();if(t!==e){var r=this.getPathTabGroup(),n=r.getTabButtons();if(t>e)for(var i=t-1;i>=e;--i){var o=n[i];r.removeWidget(o)}else for(i=t;i<e;++i){o=new d.Widget.RadioButton(r);var a=d.$L("ChemWidgetTexts.CAPTION_PATH_INDEX").format(""+(i+1)),s=d.$L("ChemWidgetTexts.HINT_PATH_INDEX").format(""+(i+1));o.setText(a).setHint(s)}}},_switchToNewPathTab:function(e){if(e>=0){var t=(this.getValue()||[])[e];this.getPathSettingPanel().setValue(t||{})}},reactChildSetterValueChange:function(e){var t=this.getActivePathIndex();if(t>=0){var r=e.widget;if(r===this.getPathSettingPanel()){var n=r.getValue();e.stopPropagation();var i=this.getValue()||[];i[t]=n,this.setPropStoreFieldValue("value",i),this.notifyPropSet("value",i),this.invokeEvent("valueChange",{value:i})}}},reactChildSetterValueInput:function(e){var t=this.getActivePathIndex();if(t>=0){var r=e.widget;if(r===this.getPathSettingPanel()){var n=r.getValue();e.stopPropagation();var i=this.getValue()||[];i[t]=n,this.setPropStoreFieldValue("value",i),this.notifyPropSet("value",i),this.invokeEvent("valueInput",{value:i})}}},reactPathTabSwitch:function(e){if(e.widget===this.getPathTabGroup()){var t=e.button,r=this.getPathTabGroup().getTabButtons().indexOf(t);this._switchToNewPathTab(r)}}}),d.ChemWidget.GlyphReactionArrowPathSettingPanel=Class.create(d.ChemWidget.GlyphPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphReactionArrowPathSettingPanel",doGetValue:function(){var e=this.tryApplySuper("doGetValue")||{};return this._reactionArrowPresetSelector&&(e.reactionArrowType=this._reactionArrowPresetSelector.getValue()),e},doSetValue:function(e){this.tryApplySuper("doSetValue",[e]),this._reactionArrowPresetSelector&&(this._reactionArrowPresetSelector.setValue(e.reactionArrowType),this._updateArrowSettingPanelEnableState())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_REACTION_ARROW_PATH_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.doCreateReactionArrowPresetSection(e,t,d.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_TYPE"));this._reactionArrowPresetSelector=r.widget,this._reactionArrowPresetElem=r.elem;var n=this.tryApplySuper("doCreateSubElements",[e,t]);return this.updateComponents(),n},doCreateReactionArrowPresetSection:function(e,t,r){var i=this.doCreateSectionElem(e,t,r,n.GLYPH_REACTION_ARROW_PATH_SETTING_PANEL_ARROW_PRESET_SECTION),o=new d.ChemWidget.GlyphReactionArrowPresetSelector(this);return o.appendToElem(i),{elem:i,widget:o}},updateComponents:function(){this.tryApplySuper("updateComponents"),this._updateArrowSettingPanelEnableState()},_updateArrowSettingPanelEnableState:function(){var e=d.Glyph.ReactionArrowType,r=this._reactionArrowPresetSelector.getValue(),n=null,i=null,o=e.getDefPathParamOfArrowType(r);if(o){o.startArrowType,o.endArrowType;var a=o.hasOwnProperty("startArrowType")&&o.startArrowType,s=o.hasOwnProperty("endArrowType")&&o.endArrowType;a&&(n=this._startingArrowSetter.getDefaultAllowedArrowTypes(),n=t.exclude(n,[d.Glyph.ArrowType.NONE])),s&&(i=this._endingArrowSetter.getDefaultAllowedArrowTypes(),i=t.exclude(i,[d.Glyph.ArrowType.NONE])),this._startingArrowSetter.setEnabled(a),this._endingArrowSetter.setEnabled(s)}else this._startingArrowSetter.setEnabled(!0),this._endingArrowSetter.setEnabled(!0);this._startingArrowSetter.setAllowedArrowTypes(n),this._endingArrowSetter.setAllowedArrowTypes(i)},_updatePathParamsByReactionArrowPreset:function(t){var r=d.Glyph.ArrowType,n=d.Glyph.ReactionArrowType.getDefPathParamOfArrowType(t);if(n||t||(n={startArrowType:r.NONE,endArrowType:r.NONE}),n){var i={},o={},a={};void 0!==n.startArrowType&&(i.arrowType=n.startArrowType),void 0!==n.startArrowSide&&(i.arrowSide=n.startArrowSide),void 0!==n.endArrowType&&(o.arrowType=n.endArrowType),void 0!==n.endArrowSide&&(o.arrowSide=n.endArrowSide),n.lineCount&&(a.lineCount=n.lineCount),n.lineGap&&(a.lineGap=n.lineGap),e.getOwnedFieldNames(i).length&&this._startingArrowSetter.setValue(Object.extend(this._startingArrowSetter.getValue(),i)),e.getOwnedFieldNames(o).length&&this._endingArrowSetter.setValue(Object.extend(this._endingArrowSetter.getValue(),o)),e.getOwnedFieldNames(a).length&&this._lineSetter.setValue(Object.extend(this._lineSetter.getValue(),a))}},getChildValueSetterWidgets:function(){var e=this.tryApplySuper("getChildValueSetterWidgets");return e.push(this._reactionArrowPresetSelector),e},reactChildSetterValueChange:function(e){e.widget===this._reactionArrowPresetSelector&&(this._updateArrowSettingPanelEnableState(),this._updatePathParamsByReactionArrowPreset(e.value)),this.tryApplySuper("reactChildSetterValueChange",[e])}}),d.ChemWidget.GlyphArcPathSettingPanel=Class.create(d.ChemWidget.GlyphPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphArcPathSettingPanel",DEF_COMPONENTS:["startingArrow","endingArrow"],doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_ARC_PATH_SETTING_PANEL}}),d.ChemWidget.GlyphMultiArcPathSettingPanel=Class.create(d.ChemWidget.GlyphMultiPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiArcPathSettingPanel",DEF_COMPONENTS:["startingArrow","endingArrow"],doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_MULTIARC_PATH_SETTING_PANEL}}),d.ChemWidget.BaseGlyphElectronArrowSettingPanel=Class.create(d.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.BaseGlyphElectronArrowSettingPanel",DEF_COMPONENTS:["endingArrow"],initialize:function(e){this._glyphPathSettingPanel=null,this._endingArrowSetter=null,this._arrowPresetSelector=null,this.tryApplySuper("initialize",[e]),this.addEventListener("valueChange",this.reactChildSetterValueChange.bind(this)),this.addEventListener("valueInput",this.reactChildSetterValueInput.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,getter:function(){var e=this._glyphPathSettingPanel.getValue()||{};return e.electronCount=this._arrowPresetSelector.getValue(),e},setter:function(e){this._glyphPathSettingPanel.setValue(e),this._arrowPresetSelector.setValue(e&&e.electronCount),this._updateArrowSettingPanel()}})},doCreateSubElements:function(e,t){var i=this.tryApplySuper("doCreateSubElements",[e,t]),o=this.doCreateArrowPresetSection(e,t,d.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_TYPE"));this._arrowPresetSelector=o.widget,this._arrowPresetElem=o.elem,d.HtmlElementUtils.addClass(this._arrowPresetElem,n.GLYPH_REACTION_ARROW_PATH_SETTING_PANEL_ARROW_PRESET_SECTION);var a=this.doCreateGlyphPathSettingSection(e,t);if(this._glyphPathSettingPanel=a.widget,this._glyphPathSettingPanel&&(this._glyphPathSettingPanel.removeClassName(r.PANEL),this._glyphPathSettingPanel.setComponents&&this._glyphPathSettingPanel.setComponents(this.DEF_COMPONENTS),this._glyphPathSettingPanel.getEndingArrowSetter)){this._endingArrowSetter=this._glyphPathSettingPanel.getEndingArrowSetter();var s=d.Glyph.ArrowType;this._endingArrowSetter.setAllowedArrowTypes([s.OPEN,s.TRIANGLE])}return i.concat([o.elem,a.elem])},doCreateSectionElem:function(e,t,r,i){var o=e.createElement("div");if(r){var a=e.createElement("label");d.DomUtils.setElementText(a,r),a.className=n.GLYPH_PATH_SETTING_PANEL_SECTION_TITLE,o.appendChild(a)}var s=n.GLYPH_PATH_SETTING_PANEL_SECTION;return i&&(s+=" "+i),o.className=s,t.appendChild(o),o},doCreateArrowPresetSection:function(e,t,r){var n=this.doCreateSectionElem(e,t,r),i=new d.ChemWidget.GlyphElectronPushingArrowPresetSelector(this);return i.appendToElem(n),{elem:n,widget:i}},doCreateGlyphPathSettingSection:function(e,t,r){var n=this.doCreateGlyphPathSettingWidget();if(n){var i=this.doCreateSectionElem(e,t,r);return n.appendToElem(i),{elem:i,widget:n}}return null},doCreateGlyphPathSettingWidget:function(){return null},reactChildSetterValueChange:function(e){var t=e.widget;t===this._arrowPresetSelector&&this._updateArrowSettingPanel(),[this._arrowPresetSelector,this._glyphPathSettingPanel].indexOf(t)>=0&&(e.stopPropagation(),this.invokeEvent("valueChange",{value:this.getValue()})),this.tryApplySuper("reactChildSetterValueChange",[e])},reactChildSetterValueInput:function(e){var t=e.widget;t===this._arrowPresetSelector&&this._updateArrowSettingPanel(),[this._arrowPresetSelector,this._glyphPathSettingPanel].indexOf(t)>=0&&(e.stopPropagation(),this.invokeEvent("valueInput",{value:this.getValue()})),this.tryApplySuper("reactChildSetterValueInput",[e])},_updateArrowSettingPanel:function(){var e,t=d.Glyph.ArrowSide,r=this._endingArrowSetter,n=this._arrowPresetSelector.getValue();e=n>=2?[t.BOTH]:1===n?[t.SINGLE,t.REVERSED]:[t.BOTH,t.SINGLE,t.REVERSED],r.setAllowedArrowSides(e)}}),d.ChemWidget.GlyphElectronPushingArrowSettingPanel=Class.create(d.ChemWidget.BaseGlyphElectronArrowSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel",doCreateGlyphPathSettingWidget:function(){return new d.ChemWidget.GlyphArcPathSettingPanel(this)}}),d.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel=Class.create(d.ChemWidget.BaseGlyphElectronArrowSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel",doCreateGlyphPathSettingWidget:function(){return new d.ChemWidget.GlyphMultiArcPathSettingPanel(this)}}),d.ChemWidget.GlyphElectronPushingArrowSettingPanel_OLD=Class.create(d.ChemWidget.GlyphPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel",DEF_COMPONENTS:["endingArrow"],initialize:function(e){this.tryApplySuper("initialize",[e]);var t=d.Glyph.ArrowType;this._endingArrowSetter.setAllowedArrowTypes([t.OPEN,t.TRIANGLE])},doGetValue:function(){var e=this.tryApplySuper("doGetValue")||{};return this._arrowPresetSelector&&(e.electronCount=this._arrowPresetSelector.getValue()),e},doSetValue:function(e){this.tryApplySuper("doSetValue",[e]),this._arrowPresetSelector&&(this._arrowPresetSelector.setValue(e.electronCount),this._updateArrowSettingPanel())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_ELECTRON_PUSHING_ARROW_SETTING_PANEL},doCreateSubElements:function(e,t){var r=this.doCreateArrowPresetSection(e,t,d.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_TYPE"));return this._arrowPresetSelector=r.widget,this._arrowPresetElem=r.elem,this.tryApplySuper("doCreateSubElements",[e,t])},doCreateArrowPresetSection:function(e,t,r){var n=this.doCreateSectionElem(e,t,r),i=new d.ChemWidget.GlyphElectronPushingArrowPresetSelector(this);return i.appendToElem(n),{elem:n,widget:i}},getChildValueSetterWidgets:function(){var e=this.tryApplySuper("getChildValueSetterWidgets");return e.push(this._arrowPresetSelector),e.push(this._reversedArrowSideCheckBox),e},reactChildSetterValueChange:function(e){e.widget===this._arrowPresetSelector&&this._updateArrowSettingPanel(),this.tryApplySuper("reactChildSetterValueChange",[e])},_updateArrowSettingPanel:function(){var e,t=d.Glyph.ArrowSide,r=this.getEndingArrowSetter(),n=this._arrowPresetSelector.getValue();e=n>=2?[t.BOTH]:1===n?[t.SINGLE,t.REVERSED]:[t.BOTH,t.SINGLE,t.REVERSED],r.setAllowedArrowSides(e)}}),d.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel_OLD=Class.create(d.ChemWidget.GlyphMultiPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel",DEF_COMPONENTS:["endingArrow"],doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_MULTI_ELECTRON_PUSHING_ARROW_SETTING_PANEL},initialize:function(e){this.tryApplySuper("initialize",[e]);var t=d.Glyph.ArrowType;this._endingArrowSetter=this.getPathSettingPanel().getEndingArrowSetter(),this._endingArrowSetter.setAllowedArrowTypes([t.OPEN,t.TRIANGLE])},doGetValue:function(){var e=this.tryApplySuper("doGetValue")||{};return this._arrowPresetSelector&&(e.electronCount=this._arrowPresetSelector.getValue()),e},doSetValue:function(e){this.tryApplySuper("doSetValue",[e]),this._arrowPresetSelector&&(this._arrowPresetSelector.setValue(e.electronCount),this._updateArrowSettingPanel())},doCreateSubElements:function(e,t){var r=this.doCreateArrowPresetSection(e,t,d.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_TYPE"));return this._arrowPresetSelector=r.widget,this._arrowPresetElem=r.elem,this.tryApplySuper("doCreateSubElements",[e,t])},doCreateSectionElem:function(e,t,r,i){var o=e.createElement("div"),a=e.createElement("label");d.DomUtils.setElementText(a,r),o.appendChild(a);var s=n.GLYPH_PATH_SETTING_PANEL_SECTION;return i&&(s+=" "+i),o.className=s,t.appendChild(o),o},doCreateArrowPresetSection:function(e,t,r){var n=this.doCreateSectionElem(e,t,r),i=new d.ChemWidget.GlyphElectronPushingArrowPresetSelector(this);return i.appendToElem(n),{elem:n,widget:i}},_updateArrowSettingPanel:function(){var e,t=d.Glyph.ArrowSide,r=this.getEndingArrowSetter(),n=this._arrowPresetSelector.getValue();e=n>=2?[t.BOTH]:1===n?[t.SINGLE,t.REVERSED]:[t.BOTH,t.SINGLE,t.REVERSED],r.setAllowedArrowSides(e)}})}(),function(){"use strict";var e=d.ArrayUtils,t=d.CoordUtils,r=d.ChemWidget.HtmlClassNames;d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{CHEMSPACE_EDITOR:"K-Chem-Space-Editor",CHEMSPACE_EDITOR2D:"K-Chem-Space-Editor2D",CHEMSPACE_EDITOR3D:"K-Chem-Space-Editor3D",CHEMEDITOR_ATOM_SETTER:"K-ChemEditor-Atom-Setter",CHEMEDITOR_TEXT_SETTER:"K-ChemEditor-Text-Setter",CHEMEDITOR_FORMULA_SETTER:"K-ChemEditor-Formula-Setter"}),d.globalOptions.add("chemWidget.editor",{enableSelect:!0,enableFileDrop:!0,allowCreateNewChild:!0,autoCreateNewStructFragment:!0,allowAppendDataToCurr:!0,enableGesture:!0,initOnNewDoc:!0}),d.globalOptions.add("chemWidget.editor.molManipulation",{enableNodeStick:!0,enableStructFragmentStick:!0,enableConstrainedMove:!0,enableConstrainedRotate:!0,enableConstrainedResize:!0,enableDirectedMove:!0}),d.globalOptions.add("chemWidget.editor.bondManipulation",{enableBondModification:!0,allowBondingToBond:!1,autoSwitchBondOrder:!1}),d.Editor.ChemSpaceEditor=Class.create(d.Editor.BaseEditor,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor",initialize:function(e,t,r,n){var i=d.globalOptions.get;this.setPropStoreFieldValue("allowCreateNewChild",i("chemWidget.editor.allowCreateNewChild",!0)),this.setPropStoreFieldValue("autoCreateNewStructFragment",i("chemWidget.editor.autoCreateNewStructFragment",!0)),this.setPropStoreFieldValue("allowAppendDataToCurr",i("chemWidget.editor.autoCreateNewStructFragment",!0)),this.tryApplySuper("initialize",[e,t,r,n]),this._containerChemSpace=null},initProperties:function(){this.defineProp("chemSpace",{dataType:"Kekule.ChemSpace",serializable:!1,getter:function(){return this.getChemObj()},setter:function(e){this.setChemObj(e)}}),this.defineProp("autoCreateNewStructFragment",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("autoCreateNewStructFragment")&&this.canCreateNewChild()}}),this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL}),this.defineProp("allowAppendDataToCurr",{dataType:DataType.BOOL})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setFileDroppable(d.globalOptions.get("chemWidget.editor.enableFileDrop",!0))},canCreateNewChild:function(){return this.getChemSpace()&&(this.getAllowCreateNewChild()||this.getChemSpace().getChildCount()<=0)},getActualDrawOptions:function(){var e=this.tryApplySuper("getActualDrawOptions");return e.useExplicitSpaceSize=!0,e},doSetChemObj:function(e){var t=this.getChemObj();if(t!==e)if(t&&this._containerChemSpace&&(t.finalize(),this._containerChemSpace=null),e){if(e instanceof d.ChemSpace)this._initChemSpaceDefProps(e),this.tryApplySuper("doSetChemObj",[e]);else{var r=this.createContainerChemSpace(null,e);this._containerChemSpace=r,this.tryApplySuper("doSetChemObj",[r])}if(this.getEditorConfigs().getInteractionConfigs().getAutoExpandClientSizeAfterLoading()&&this.autoExpandChemSpaceSize(),e instanceof d.ChemSpace&&this.getEditorConfigs().getInteractionConfigs().getScrollToObjAfterLoading()){var n=e.getChildren();n&&n.length&&this.scrollClientToObject(n)}}else this.tryApplySuper("doSetChemObj",[e]);else this.tryApplySuper("doSetChemObj",[e])},getExportableClasses:function(){var e=this.tryApplySuper("getExportableClasses"),t=this.getChemSpace();return t&&t.iterateChildren((function(t){if(t.isStandalone&&t.isStandalone()&&t.getClass){var r=t.getClass();d.ArrayUtils.pushUnique(e,r)}}),!0),e},exportObjs:function(e){var t=this.tryApplySuper("exportObjs",[e]);return t&&t.length||!e||(t=[],t=this.getChemSpace().filterChildren((function(t){return t&&t instanceof e}),!0)),t},getSavingTargetObj:function(){var e=this.getChemSpace();return 1===e.getChildCount()?e.getChildAt(0):this.tryApplySuper("getSavingTargetObj")},createDefaultConfigs:function(){return d.Editor.ChemSpaceEditorConfigs.getInstance()},doCreateNewDocObj:function(){return this.createContainerChemSpace()},doLoad:function(e){this._supplyChemMarkersOnObj(e),this.tryApplySuper("doLoad",[e])},doLoadEnd:function(e){var t=this.tryApplySuper("doLoadEnd",[e]),r=null;if(e){var n=e.getAllContainingConnectors();if(n&&n.length){var i=this.getRenderType()===d.Render.RendererType.R3D?d.CoordMode.COORD3D:d.CoordMode.COORD2D;r=d.ChemStructureUtils.getConnectorLengthMedian(n,i,this.getAllowCoordBorrow())}}return this.setDefBondLength(r),t},resetDisplay:function(){this.tryApplySuper("resetDisplay"),this.resetClientDisplay()},resetClientDisplay:function(e){if(!this.isUpdatingObject())return this._resetClientDisplayCore(e);var t=this;this._registerAfterUpdateObjectProc((function(){t._resetClientDisplayCore(e)}))},_resetClientDisplayCore:function(e){var t=this.getChemObj();if(t){var r;e&&(r=this.getClientScrollPosition());var n=t.getScreenSize();this.changeClientSize(n.x,n.y,this.getCurrZoom());var i=this.getEditClientElem().parentNode,o=d.HtmlElementUtils.getElemClientDimension(i);e?this.scrollClientTo(r.y,r.x):this.scrollClientTo(0,(n.x*this.getCurrZoom()-o.width)/2)}},zoomChanged:function(e){this.tryApplySuper("zoomChanged");var t=this.getChemObj();if(t){var r=t.getScreenSize();this.changeClientSize(r.x,r.y,e)}},createNewBoundInfoRecorder:function(e){this.tryApplySuper("createNewBoundInfoRecorder",[e]);var t=this.getBoundInfoRecorder();t&&t.addEventListener("updateBasicDrawObject",this.reactUpdateBasicDrawObject,this)},reactUpdateBasicDrawObject:function(e){var t=e.obj;if(t&&t instanceof d.TextBlock){var r=e.boundInfo;this.updateTextBlockSize(t,r)}},objectChanged:function(e,t){return this.tryApplySuper("objectChanged",[e,t])},doManipulationEnd:function(){if(this.getEditorConfigs().getInteractionConfigs().getAutoExpandClientSizeAfterManipulation()){var e=this._calcChemSpaceAutoExpandInfo();if(e){var t=this._createChemSpaceAutoExpandOperations(e);if(t){this.getEnableOperHistory()&&this._appendOpersToLastManipulationOperation(t);for(var r=0,n=t.length;r<n;++r)t[r].execute()}}}return this.tryApplySuper("doManipulationEnd")},_appendOpersToLastManipulationOperation:function(e){var t=this.getOperationsInCurrManipulation();if(t&&t.length){var r=t[t.length-1],n=this.getOperHistory();if(n){var i=n.getOperations(),o=i.indexOf(r);if(o>=0){var a;r instanceof d.MacroOperation?a=r:(a=new d.MacroOperation([r]),i.splice(o,1,a),t.splice(t.length-1,1,a));for(var s=0,l=e.length;s<l;++s)a.add(e[s])}}}},updateTextBlockSize:function(e,t){this.getCoordMode()===d.CoordMode.COORD2D&&e.getNeedRecalcSize()&&(t.shapeType,d.Render.BoundShapeType.RECT)},createContainerChemSpace:function(e,t){var r=new d.ChemDocument(e);if(this._initChemSpaceDefProps(r,t),t){r.appendChild(t);var n,i=r.getSizeOfMode(this.getCoordMode(),this.getAllowCoordBorrow()),o=d.Render.ObjUtils.getContainerBox(t,this.getCoordMode(),this.getAllowCoordBorrow());if(this.getCoordMode()===d.CoordMode.COORD2D)var a=this.getEditorConfigs().getChemSpaceConfigs().getDefPadding(),s=r.getObjScreenLengthRatio();var l=t.getAbsBaseCoord&&t.getAbsBaseCoord(this.getCoordMode(),this.getAllowCoordBorrow())||{};if(s&&o){n=d.CoordUtils.divide(i,2);var u={x:(o.x1+o.x2)/2,y:(o.y1+o.y2)/2},c={x:n.x,y:i.y-a*s-(o.y2-o.y1)/2},h=d.CoordUtils.substract(c,u);n=d.CoordUtils.add(l,h)}else n=d.CoordUtils.divide(i,2);t.setAbsBaseCoord&&t.setAbsBaseCoord(n,this.getCoordMode())}return r},_initChemSpaceDefProps:function(e,t,r){var n=this.getEditorConfigs(),i=n.getChemSpaceConfigs();if(this.getCoordMode()===d.CoordMode.COORD2D){var o,a,s=e.getScreenSize();if(s.x||s.y||(s=i.getDefScreenSize2D(),e.setScreenSize(s)),!e.getDefAutoScaleRefLength())(o=t&&t.getAllAutoScaleRefLengths?(a=t.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow()))&&a.length?d.ArrayUtils.getMedian(a):null:(a=e.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow())).length?d.ArrayUtils.getMedian(a):null)||(o=n.getStructureConfigs().getDefBondLength()),e.setDefAutoScaleRefLength(o);if(!e.getSize2D()||r){var l=this.getRenderConfigs().getLengthConfigs().getDefBondLength(),u=e.getDefAutoScaleRefLength()/l;e.setObjScreenLengthRatio(u),e.setSize2D({x:s.x*u,y:s.y*u})}}e.setIsEditing&&e.setIsEditing(!0)},_getChemSpaceObjScreenLengthRatio:function(){var e=this.getChemSpace(),t=e.getObjScreenLengthRatio();if(!t){var r=this.getRenderConfigs().getLengthConfigs().getDefBondLength();t=e.getDefAutoScaleRefLength()/r}return t},changeChemSpaceSize:function(e,t){var r=this.getChemSpace();r.beginUpdate();try{if(r.setSizeOfMode(e,t),t===d.CoordMode.COORD2D){var n=this._getChemSpaceObjScreenLengthRatio();n&&r.setScreenSize({x:e.x/n,y:e.y/n})}}finally{r.endUpdate()}this.resetClientDisplay(!0)},changeChemSpaceScreenSize:function(e){var t=this.getChemSpace();t.beginUpdate();try{var r=this._getChemSpaceObjScreenLengthRatio();r&&t.setSize2D({x:e.x*r,y:e.y*r}),t.setScreenSize(e)}finally{t.endUpdate()}this.resetClientDisplay(!0)},_shiftChemSpaceChildCoord:function(e,r,n){var i=this.getChemSpace(),o=i.getChildren();if(o){var a;n&&(a=this.getClientScrollCoord(d.Editor.CoordSys.CHEM)),this.beginUpdateObject();try{i.beginUpdate();try{for(var s=this.getAllowCoordBorrow(),l=0,u=o.length;l<u;++l){var c=o[l];if(c&&c.setCoordOfMode){var h=c.getCoordOfMode(r,s)||{};c.setCoordOfMode(t.add(h,e))}}n&&this.scrollClientToCoord(a,d.Editor.CoordSys.CHEM)}finally{i.endUpdate()}}finally{this.endUpdateObject()}}},_calcExpandChemSpaceSizeToTargetObjsInfo:function(e,t){if(e&&e.length){var r=this._getTargetObjsExposedContainerBoxInfo(e).totalBox;if(r)return this._calcExpandChemSpaceSizeToContainerBoxInfo(r,t)}return null},_calcExpandChemSpaceSizeToContainerBoxInfo:function(e,r){var n=d.CoordMode,i=this.getChemSpace(),o=r===n.COORD3D,a=["x","y"];o&&a.push("z");for(var s=this.getEditorConfigs().getChemSpaceConfigs(),l=this._getChemSpaceObjScreenLengthRatio(),u=s.getDefPadding()*l,c=o?i.getSize3D():i.getSize2D(),h=d.BoxUtils.getMinMaxCoords(e),p=h.min,g={},f=!1,m=0,C=a.length;m<C;++m)(T=p[a[m]])<u?(g[a[m]]=u-T,f=!0):g[a[m]]=0;var y=h.max,_={},E=!1;for(m=0,C=a.length;m<C;++m){var T;(T=y[a[m]])>c[a[m]]-u?(_[a[m]]=T-(c[a[m]]-u),E=!0):_[a[m]]=0}var O={},v={};if(f||E){var S=o?s.getAutoExpandScreenSize2D():s.getAutoExpandScreenSize3D(),b=t.multiply(S,l);for(m=0,C=a.length;m<C;++m){var A=a[m];O[A]=g[A]+_[A];var I=Math.ceil(O[A]/b[A]);v[A]=I*b[A]}var R={newSize:t.add(c,v)};return f&&(R.coordShift=g),R}return null},_expandChemSpaceSizeAndShiftChildrenCoords:function(e,t,r){this.beginUpdateObject();try{t&&this._shiftChemSpaceChildCoord(t,r,!0),this.changeChemSpaceSize(e,r)}finally{this.endUpdateObject()}},_expandChemSpaceSizeToContainerBox:function(e,t){var r=this._calcExpandChemSpaceSizeToContainerBoxInfo(e,t);return r&&this._expandChemSpaceSizeAndShiftChildrenCoords(r.newSize,r.coordShift,t),r},expandChemSpaceSizeToTargetObjs:function(e,t){if(d.ObjUtils.isUnset(t)&&(t=this.getCoordMode()),e&&e.length){var r=this._getTargetObjsExposedContainerBoxInfo(e).totalBox;r&&this._expandChemSpaceSizeToContainerBox(r,t)}return this},autoExpandChemSpaceSize:function(){if(this._isAutoExpandingChemSpace)return this;this._isAutoExpandingChemSpace=!0;try{var e=this.getChemSpace().getChildren();e&&this.expandChemSpaceSizeToTargetObjs(e,this.getCoordMode())}finally{this._isAutoExpandingChemSpace=!1}return this},_calcChemSpaceAutoExpandInfo:function(){var e=this.getChemSpace().getChildren();return e?this._calcExpandChemSpaceSizeToTargetObjsInfo(e,this.getCoordMode()):null},_createChemSpaceAutoExpandOperations:function(e){if(e){var t=[],r=this.getChemSpace(),n=this.getCoordMode();return t.push(new d.ChemSpaceEditorOperation.ChangeSpaceSizeAndShiftChildrenCoords(r,e.newSize,e.coordShift,n,this)),t}return null},createNewStructFragmentAnchor:function(e){if(this.getAutoCreateNewStructFragment()){var t=new d.Molecule(e);return this.getChemSpace().appendChild(t),t}return null},createStructStartingAtom:function(e,t,r,n){this.beginUpdateObject();try{if(e){n||(n=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId());var i=new d.Atom(null,n);return e.appendNode(i),i.setAbsCoordOfMode(r,this.getCoordMode()),i}return null}finally{this.endUpdateObject()}},createNewStructFragmentAndStartingAtom:function(e,t,r){this.beginUpdateObject();try{var n;return(n=this.createNewStructFragmentAnchor(e))?this.createStructStartingAtom(n,e,t,r):null}finally{this.endUpdateObject()}},hasOnlyOneBlankStructFragment:function(){var e=!1;if(1===this.getChemSpace().getChildCount()){var t=this.getChemSpace().getChildAt(0);t instanceof d.StructureFragment&&t.getNodeCount()<=0&&t.getConnectorCount()<=0&&!t.hasFormula()&&(e=!0)}return e},getOnlyOneBlankStructFragment:function(){if(this.hasOnlyOneBlankStructFragment())return this.getChemSpace().getChildAt(0)},canAddNewStandaloneObject:function(){return this.getAllowCreateNewChild()||this.getChemSpace().getChildCount()<=0},canAddUnconnectedStructFragment:function(){return this.canAddNewStandaloneObject()||this.hasOnlyOneBlankStructFragment()},canCloneObjects:function(){return this.getAllowCreateNewChild()},cloneObjects:function(t,r,n,i){var o=this;if(!this.getChemSpace())return null;for(var a=this.getAllowCreateNewChild(),s=function(e,t){for(var r=0,n=t.length;r<n;++r)if(t[r].isChildOf(e))return!0;return!1},l=function t(r,n,i){if(i.indexOf(n)>=0)e.remove(i,n);else if(r.getChildAt&&n.getChildAt)for(var o=n.getChildCount()-1;o>=0;--o){var a=r.getChildAt(o);if(i.length){var l=n.getChildAt(o);i.indexOf(l)>=0?e.remove(i,l):s(l,i)?l.getChildObjs&&t(a,l,i):r.removeChild(a)}else r.removeChild(a)}},u=function(e,t){for(var r=0,n=t.length;r<n;++r){var i=t[r];if(e===i||e.isChildOf&&e.isChildOf(i))return i}return null},c=function(t,r,n){var i,o,a=t.relation,s=t.srcParent,l=t.destParents,d=[],u=n[r.indexOf(s)];if(a.srcObj===s?o=u:(i=s.indexStackOfChild&&s.indexStackOfChild(a.srcObj))&&(o=u.getChildAtIndexStack&&u.getChildAtIndexStack(i)),!o)return null;for(var c=e.isArray(a.dest),h=c?a.dest:[a.dest],p=0,g=l.length;p<g;++p){var f,m=l[p],C=n[r.indexOf(m)];m&&(m===h[p]?d.push(C):h[p]&&(i=m.indexStackOfChild&&m.indexStackOfChild(h[p]))&&(f=C.getChildAtIndexStack&&C.getChildAtIndexStack(i))&&d.push(f))}if(!d.length)return null;var y=c?d:d[0];return{srcObj:o,srcProp:a.srcProp,dest:y}},h=d.ArrayUtils.toArray(t),p=[],g=new d.MapEx,f=0,m=h.length;f<m;++f){var C=(S=h[f]).getStandaloneAncestor?S.getStandaloneAncestor():S;if(C.clone){d.ArrayUtils.pushUnique(p,C);var y=g.get(C);y||(y=[],g.set(C,y)),y.push(S)}}var _=function(t,r){var n=[];r||(r=o.getChemObj());var i=r.getObjRefRelations&&r.getObjRefRelations();if(i)for(var a=0,s=i.length;a<s;++a){var l=i[a],d=l.srcObj,c=e.toArray(l.dest),h=u(d,t),p=[],g=!1;if(h){for(var f=0,m=c.length;f<m;++f){var C=c[f],y=u(C,t);y&&(g=!0),p.push(y)}g&&n.push({relation:l,srcParent:h,destParents:p})}}return n}(p,this.getChemSpace()),E=this.getChemSpace(),T=[],O=(this.getCoordMode(),this.getAllowCoordBorrow(),p.length);for(f=0;f<O;++f)(b=(S=p[f]).clone()).clearIds&&b.clearIds(),T.push(b);var v=[];for(f=0,m=_.length;f<m;++f)(D=c(_[f],p,T))&&v.push(D);for(f=0;f<O;++f){var S=p[f],b=T[f];if(l(b,S,g.get(S)),n&&a&&(E.appendChild(b),r)){var A=this.getObjectScreenCoord(b),I=d.CoordUtils.add(A,r);this.setObjectScreenCoord(b,I)}}for(f=0,m=v.length;f<m;++f){var R,D=v[f];if(u(D.srcObj,T)){if(e.isArray(D.dest)){R=[];for(var N=0,P=D.dest.length;N<P;++N){var x=D.dest[N];u(x,T)&&R.push(x)}R.length||(R=null)}else u(D.dest,T)&&(R=D.dest);R&&D.srcObj.setPropValue(D.srcProp.name,R)}}return g.finalize(),T},cloneSelection:function(t,r,n){void 0===t&&(t=this.getDefaultCloneScreenCoordOffset());var i=this.getSelection();i=function(t,r){for(var n=[],i=0,o=t.length;i<o;++i){var a=t[i];if(a instanceof d.ChemSpace&&!r){var s=a.getChildren();e.pushUnique(n,s)}else e.pushUnique(n,a)}return n}(i,n);var o=this.cloneObjects(i,t,r);return r&&this.setSelection(o),o},getDefaultCloneScreenCoordOffset:function(){var e=this.getEditorConfigs().getInteractionConfigs().getClonedObjectScreenOffset()||0,t={x:e,y:e};return this.getCoordMode()===d.CoordMode.COORD3D&&(t.z=e),t},_supplyChemMarkersOnObj:function(e){if(e){var t=d.ChemStructureUtils.getAllStructFragments(e,!0);if(t||t.length)for(var r=0,n=t.length;r<n;++r)this._createLosingChemMarkerOnStructFragment(t[r])}},_createLosingChemMarkerOnStructFragment:function(e){e.beginUpdate();try{e.getCharge&&e.getCharge()&&e.fetchChargeMarker(!0),e.getNodes();for(var t=0,r=e.getNodeCount();t<r;++t){var n=e.getNodeAt(t);n.beginUpdate();try{n.getCharge()&&n.fetchChargeMarker(!0),n.getRadical()&&n.fetchRadicalMarker(!0),n.getNodeAt&&this._createLosingChemMarkerOnStructFragment(n)}finally{n.endUpdate()}}}finally{e.endUpdate()}},getEnabledNonAtomInputData:function(){var e=[],t=this.getRenderConfigs().getDisplayLabelConfigs(),r=this.getEditorConfigs().getStructureConfigs().getEnabledNonAtomNodeTypes();return r.RGroup&&e.push({text:t.getRgroup(),nodeClass:d.RGroup,description:d.$L("ChemWidgetTexts.CAPTION_RGROUP")}),r.pseudoatomDummy&&e.push({text:t.getDummyAtom(),nodeClass:d.Pseudoatom,props:{atomType:d.PseudoatomType.DUMMY},description:d.$L("ChemWidgetTexts.CAPTION_DUMMY_ATOM")}),r.pseudoatomHetero&&e.push({text:t.getHeteroAtom(),nodeClass:d.Pseudoatom,props:{atomType:d.PseudoatomType.HETERO},description:d.$L("ChemWidgetTexts.CAPTION_HETERO_ATOM")}),r.pseudoatomAny&&e.push({text:t.getAnyAtom(),nodeClass:d.Pseudoatom,props:{atomType:d.PseudoatomType.ANY},description:d.$L("ChemWidgetTexts.CAPTION_ANY_ATOM")}),r.variableAtomList&&e.push({text:this._getVarAtomListLabel(),nodeClass:d.VariableAtom,isVarList:!0,description:d.$L("ChemWidgetTexts.CAPTION_VARIABLE_ATOM")}),r.variableAtomNotList&&e.push({text:this._getVarAtomNotListLabel(),nodeClass:d.VariableAtom,isVarNotList:!0,description:d.$L("ChemWidgetTexts.CAPTION_VARIABLE_NOT_ATOM")}),e},_getVarAtomListLabel:function(){var e=this.getRenderConfigs().getDisplayLabelConfigs();return e?e.getVariableAtom():d.ChemStructureNodeLabels.VARIABLE_ATOM},_getVarAtomNotListLabel:function(){var e=this.getRenderConfigs().getDisplayLabelConfigs();return"~"+(e?e.getVariableAtom():d.ChemStructureNodeLabels.VARIABLE_ATOM)},getEnabledBondFormData:function(){for(var e=d.BondType,t=d.BondOrder,r=d.BondStereo,n=d.$L,i="K-Chem-MolBondIaController-",o={single:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_SINGLE"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_SINGLE"),htmlClass:i+"Single",isDefault:!0,bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.NONE}},double:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),htmlClass:i+"Double",bondProps:{bondType:e.COVALENT,bondOrder:t.DOUBLE,stereo:r.NONE}},triple:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_TRIPLE"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_TRIPLE"),htmlClass:i+"Triple",bondProps:{bondType:e.COVALENT,bondOrder:t.TRIPLE,stereo:r.NONE}},quad:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_QUAD"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_QUAD"),htmlClass:i+"Quad",bondProps:{bondType:e.COVALENT,bondOrder:t.QUAD,stereo:r.NONE}},explicitAromatic:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_EXPLICIT_AROMATIC"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_EXPLICIT_AROMATIC"),htmlClass:i+"Aromatic",bondProps:{bondType:e.COVALENT,bondOrder:t.EXPLICIT_AROMATIC,stereo:r.NONE}},up:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP"),htmlClass:i+"WedgeUp",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP}},upInverted:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP_INVERTED"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP_INVERTED"),htmlClass:i+"WedgeUpInverted",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP_INVERTED}},down:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN"),htmlClass:i+"WedgeDown",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.DOWN}},downInverted:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN_INVERTED"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN_INVERTED"),htmlClass:i+"WedgeDownInverted",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.DOWN_INVERTED}},upOrDown:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_WAVY"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_WAVY"),htmlClass:i+"WedgeUpOrDown",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP_OR_DOWN}},closer:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_CLOSER"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_CLOSER"),htmlClass:i+"Closer",bondProps:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.CLOSER}},eOrZ:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE_EITHER"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE_EITHER"),htmlClass:i+"Double-Either",bondProps:{bondType:e.COVALENT,bondOrder:t.DOUBLE,stereo:r.E_OR_Z}},ionic:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_IONIC"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_IONIC"),htmlClass:i+"Ionic",bondProps:{bondType:e.IONIC,bondOrder:t.SINGLE,stereo:r.NONE}},coordinate:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_COORDINATE"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_COORDINATE"),htmlClass:i+"Coordinate",bondProps:{bondType:e.COORDINATE,bondOrder:t.SINGLE,stereo:r.NONE}},metallic:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_METALLIC"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_METALLIC"),htmlClass:i+"Metallic",bondProps:{bondType:e.METALLIC,bondOrder:t.SINGLE,stereo:r.NONE}},hydrogen:{text:n("ChemWidgetTexts.CAPTION_MOL_BOND_HYDROGEN"),hint:n("ChemWidgetTexts.HINT_MOL_BOND_HYDROGEN"),htmlClass:i+"Hydrogen",bondProps:{bondType:e.HYDROGEN,bondOrder:t.SINGLE,stereo:r.NONE}}},a=(n("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),n("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),this.getEditorConfigs().getStructureConfigs().getEnabledBondForms()),s=d.ObjUtils.getOwnedFieldNames(a,!1),l=[],u=0,c=s.length;u<c;++u){var h=s[u];a[h]&&(DataType.isObjectValue(a[h])?l.push(a[h]):o[h]&&l.push(o[h]))}return l}}),d.Editor.ChemSpaceEditor.Settings=Class.create(d.Editor.BaseEditor.Settings,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor.Settings",initProperties:function(){this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getAllowCreateNewChild()},setter:function(e){this.getEditor().setAllowCreateNewChild(e)}}),this.defineProp("autoCreateNewStructFragment",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getAutoCreateNewStructFragment()},setter:function(e){this.getEditor().setAutoCreateNewStructFragment(e)}}),this.defineProp("allowAppendDataToCurr",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getAllowAppendDataToCurr()},setter:function(e){this.getEditor().setAllowAppendDataToCurr(e)}})}}),d.Editor.BasicMolEraserIaController=Class.create(d.Editor.BasicEraserIaController,{CLASS_NAME:"Kekule.Editor.BasicMolEraserIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},doGetActualRemovedObjs:function(e){for(var t=[],r=this.getEditor().getChemObj(),n=0,i=e.length;n<i;++n){var o,a=e[n];a instanceof d.ChemSpace&&a===r?o=a.getChildren():(d.ArrayUtils.pushUnique(t,a),o=a.getCascadeDeleteObjs?a.getCascadeDeleteObjs():[]),o&&d.ArrayUtils.pushUnique(t,o)}return t},doRemoveObjs:function(e){if(e.length){for(var t=new d.MacroOperation,r=[],n=0,i=e.length;n<i;++n){var o,a=e[n],s=(a.getParent(),this.getEditor());a instanceof d.BaseStructureNode?(o=new d.ChemStructOperation.RemoveNode(a,null,null,s),d.ArrayUtils.pushUnique(r,a.getParent())):a instanceof d.BaseStructureConnector?(o=new d.ChemStructOperation.RemoveConnector(a,null,null,s),d.ArrayUtils.pushUnique(r,a.getParent())):o=new d.ChemObjOperation.Remove(a,null,null,s),o&&t.add(o)}for(n=0,i=r.length;n<i;++n){var l=r[n];if(l&&l instanceof d.StructureFragment){var u=new d.ChemStructOperation.StandardizeStructFragment(l,s);u.setEnableSplit(this.getEditor().canCreateNewChild()),t.add(u)}}s.execOperation(t)}}}),d.Editor.IaControllerManager.register(d.Editor.BasicMolEraserIaController,d.Editor.ChemSpaceEditor),d.Editor.BasicMolManipulationIaController=Class.create(d.Editor.BasicManipulationIaController,{CLASS_NAME:"Kekule.Editor.BasicMolManipulationIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._suppressConstrainedMoving=!1,this._suppressConstrainedRotating=!1,this._isInDirectedMoving=!1,this._directedMovingDirection=null},initProperties:function(){this._defineEditorConfigBasedProperty("enableMagneticMerge","interactionConfigs.enableMagneticMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableNodeMerge","interactionConfigs.enableNodeMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableNeighborNodeMerge","interactionConfigs.enableNeighborNodeMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableConnectorMerge","interactionConfigs.enableConnectorMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableStructFragmentMerge","interactionConfigs.enableStructFragmentMerge",{overwrite:!0}),this.defineProp("allManipulateObjsMerged",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("isMergeDone",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableNodeStick",{dataType:DataType.BOOL}),this.defineProp("enableSiblingStick",{dataType:DataType.BOOL}),this.defineProp("enableStructFragmentStick",{dataType:DataType.BOOL}),this.defineProp("enableConstrainedMove",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableConstrainedRotate",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableConstrainedResize",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableDirectedMove",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("stickOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergeOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergePreviewOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergingDests",{dataType:DataType.ARRAY,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues");var e=d.globalOptions.get("chemWidget.editor.molManipulation",{});e=Object.extend({enableMagneticMerge:!0,enableNodeMerge:!0,enableNeighborNodeMerge:!0,enableConnectorMerge:!0,enableStructFragmentMerge:!0,enableNodeStick:!0,enableStructFragmentStick:!0,enableConstrainedMove:!0,enableConstrainedRotate:!0,enableConstrainedResize:!0,enableDirectedMove:!0},e),this.setEnableMagneticMerge(e.enableMagneticMerge),this.setEnableNodeMerge(e.enableNodeMerge),this.setEnableNeighborNodeMerge(e.enableNeighborNodeMerge),this.setEnableConnectorMerge(e.enableConnectorMerge),this.setEnableStructFragmentMerge(e.enableStructFragmentMerge),this.setEnableNodeStick(e.enableNodeStick),this.setEnableStructFragmentStick(e.enableStructFragmentStick),this.setEnableConstrainedMove(e.enableConstrainedMove),this.setEnableConstrainedRotate(e.enableConstrainedRotate),this.setEnableConstrainedResize(e.enableConstrainedResize),this.setEnableDirectedMove(e.enableDirectedMove)},canInteractWithObj:function(e){return this.tryApplySuper("canInteractWithObj",[e])||this._isMerging&&e},doSetManipulateObjs:function(t){var r=t?e.clone(t):[];this.getMergingDests()&&!this.useMergePreview()&&e.pushUnique(r,this.getMergingDests()),this.setPropStoreFieldValue("manipulateObjs",t),t?this.getEditor().prepareOperatingObjs(r):this.getEditor().endOperatingObjs()},isConstrainedRotate:function(){return this.getEnableConstrainedMove()},isConstrainedResize:function(){return this.getEnableConstrainedResize()},isConstrainedMove:function(){if(!this.getEnableConstrainedMove())return!1;var e=this.getManipulateObjs();if(1===e.length){var t=e[0],r=this.getEditor().getSelection();if(r&&r.indexOf(t)<0)return t.getConstraintManipulationBaseObj&&t.getConstraintManipulationBaseObj()}return!1},isInActualConstrainedRotation:function(){return this.isConstrainedRotate()&&!this._suppressConstrainedRotating},isDirectedMove:function(){return this.getEnableDirectedMove()&&!this.isConstrainedMove()&&this._isInDirectedMoving},useMergePreview:function(){return this._useMergePreview},setUseMergePreview:function(e){this._useMergePreview=e},getMergeOperationsInManipulating:function(){return this._useMergePreview?this.getMergePreviewOperations():this.getMergeOperations()},createManipulateObjInfo:function(e,t,r){var n=this.getEditor(),i=this.tryApplySuper("createManipulateObjInfo",[e,t,r]);if(this.isConstrainedMove()){var o=e.getConstraintManipulationBaseObj();if(o&&(i.isConstrained=!0,!i.hasNoCoord)){i.originScreenCoord=n.getObjectScreenCoord(e),i.refScreenCoord=n.getObjectScreenCoord(o),i.connectorScreenLength=d.CoordUtils.getDistance(i.screenCoord,i.refScreenCoord),i.connectorObjLength=d.CoordUtils.getDistance(n.getObjCoord(e),n.getObjCoord(o));var a=d.CoordUtils.substract(i.originScreenCoord,i.refScreenCoord);i.originBondDirectionAngle=Math.atan2(a.y,a.x),i.constrainedBondDirectionDelta=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionDelta(),i.constrainedBondDirectionAngles=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionAngles(),i.constrainedBondDirectionAngleThreshold=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionAngleThreshold()}}return i},getAllowLengthChangeInConstrainedMoving:function(e){return e instanceof d.Glyph.PathGlyphNode},_getTransformCompareThresholds:function(e){return e===d.CoordMode.COORD3D?this.tryApplySuper("_getTransformCompareThresholds",[e]):{translate:this.getEditorConfigs().getStructureConfigs().getDefBondLength()||this.getEditor().getChemSpace().getAutoScaleRefLength()||.05,rotate:this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep()/5,scale:this.getEditorConfigs().getInteractionConfigs().getConstrainedResizeStep()/5}},_calcActualMovedScreenCoord:function(e,t,r){var n,i=d.CoordUtils,o=r;if(t.isConstrained&&!this._suppressConstrainedMoving){var a,s,l=t.constrainedBondDirectionDelta||null,u=t.constrainedBondDirectionAngles||null,c=t.constrainedBondDirectionAngleThreshold||null,h=!1,p=i.substract(r,t.refScreenCoord),g=Math.atan2(p.y,p.x),f=i.getDistance(p);if(u&&c)for(var m=0,C=u.length;m<C;++m){var y=u[m];Math.abs(y-g)<=c&&(h=!0,a=y)}if(!h&&l){var _=Math.round((g-t.originBondDirectionAngle)/l);a=t.originBondDirectionAngle+_*l,h=!0}if(h||(a=g),this.getAllowLengthChangeInConstrainedMoving(e)){var E=this.getEditor().getDefBondScreenLength(),T=f/E,O=this.getEditorConfigs().getInteractionConfigs().getConstrainedResizeStep();s=E*(T=(Math.round(T/O)||1)*O)}else s=t.connectorScreenLength;n=i.add(t.refScreenCoord,{x:s*Math.cos(a),y:s*Math.sin(a)})}else n=o;return n},_calcActualRotateAngle:function(e,t,r,n){var i=this.isConstrainedRotate()&&!this._suppressConstrainedRotating?this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep():null;return i?Math.round(t/i)*i:this.tryApplySuper("_calcActualRotateAngle",[e,t])},_calcActualResizeScales:function(e,t){if(this.isConstrainedResize()&&!this._suppressConstrainedResize){var r=this.getEditorConfigs().getInteractionConfigs().getConstrainedResizeStep();return r?{scaleX:(Math.round(t.scaleX/r)||1)*r,scaleY:(Math.round(t.scaleY/r)||1)*r}:t}return t},prepareManipulating:function(e,t,r,n,i,o){this.setUseMergePreview(this.getEditorConfigs().getInteractionConfigs().getEnableMergePreview()),this.setMergeOperations([]),this.setMergePreviewOperations([]),this.setStickOperations([]),this.tryApplySuper("prepareManipulating",[e,t,r,n,i,o]),this._directedMovingDirection=null,this.setManuallyHotTrack(!0)},manipulateBeforeStopping:function(){if(this.tryApplySuper("manipulateBeforeStopping"),this.useMergePreview()){var e=this.getMergePreviewOperations();if(e&&e.length){for(var t=this.getMergeOperations(),r=0,n=e.length;r<n;++r){var i=e[r];if(i){var o=i instanceof d.ChemStructOperation.MergeConnectorsBase?this.createConnectorMergeOperation(i.getTarget(),i.getDest()):this.createNodeMergeOperation(i.getTarget(),i.getDest());t.push(o)}}this.executeMergeOpers(t)}}},manipulateEnd:function(){this.tryApplySuper("manipulateEnd"),this.getEditor().hideHotTrack(),this.setManuallyHotTrack(!1)},createManipulateOperation:function(){this.tryApplySuper("createManipulateOperation"),this.setMergeOperations([]),this.setMergePreviewOperations([]),this.setStickOperations([])},getAllObjOperations:function(e){var t=this.getMergeOperations(),r=this.tryApplySuper("getAllObjOperations")||[];t&&t.length&&d.ArrayUtils.pushUnique(r,t);var n=this.getStickOperations();if(n&&n.length)for(var i=0,o=n.length;i<o;++i){var a=n[i];a&&(a.getStickTarget&&!a.getStickTarget()?r.unshift(a):r.push(a))}return r},_objCanBeMagneticMerged:function(e){return!(e instanceof d.StructureFragment)&&(e instanceof d.ChemStructureNode||e instanceof d.ChemStructureConnector)},_objCanBeMagneticSticked:function(e){return!(e instanceof d.StructureFragment)&&e instanceof d.BaseStructureNode&&e.getAllowCoordStickTo()},_canStickNode:function(e,t){if(this.getEnableNodeStick()){var r=this.getEnableStructFragmentStick(),n=this.getEnableSiblingStick();return d.ChemObjOperation.StickTo.canStick(e,t,r,n)}return!1},_canMergeNodes:function(e,t){if(this.getEnableNodeMerge()){var r=this.getEnableStructFragmentMerge(),n=this.getEnableNeighborNodeMerge();return d.ChemStructOperation.MergeNodes.canMerge(e,t,r,n)}return!1},_canMergeConnectors:function(e,t){if(this.getEnableConnectorMerge()){var r=this.getEnableStructFragmentMerge();return d.ChemStructOperation.MergeConnectors.canMerge(e,t,r)}return!1},_findSuitableMergeTargetBoundInfo:function(e,t,r,n){for(var i=e.length-1;i>=0;--i){var o=e[i],a=o.obj;if(!(t.indexOf(a)>=0)&&a instanceof r&&(!n||n(a)))return o}return null},_getCoordStickActualTarget:function(e){for(var t=e,r=t.getCoordStickTarget&&t.getCoordStickTarget();r;)r=(t=r).getCoordStickTarget&&t.getCoordStickTarget();return t},_getMagneticNodeMergeOrStickDestInfo:function(e,t,r){var n=this.getEditor(),i=this;if(t){var o=n.getBoundInfosAtCoord(t,(function(t){var n=t.obj,o=i._getCoordStickActualTarget(n);return e!==n&&r.indexOf(n)<0&&(n instanceof d.BaseStructureNode&&i._canMergeNodes(e,n)||i._canStickNode(e,o))}),this.getCurrBoundInflation()),a=o.length?o[o.length-1]:null;if(a){var s=a.obj,l=this._getCoordStickActualTarget(s);return this._canMergeNodes(e,s)?{obj:s,isMerge:!0}:this._canStickNode(e,l)?{obj:l,isStick:!0}:null}return null}return null},moveManipulatedObjs:function(e){var t;if(this.isDirectedMove()){var r=d.CoordUtils,n=this.getStartCoord(),i=r.getDistance(n,e),o=r.substract(e,n),a=this._directedMovingDirection;this._directedMovingDirection||(a=Math.abs(o.x)>=Math.abs(o.y)?"x":"y",i<this.getEditor().getEditorConfigs().getInteractionConfigs().getDirectedMoveDistanceThreshold()||(this._directedMovingDirection=a)),(t=Object.extend({},n))[a]=e[a]}else t=e;return this.tryApplySuper("moveManipulatedObjs",[t])},applyManipulatingObjsInfo:function(e){var t={MERGE:0,MERGE_BOND:1,STICK:10,UNSTICK:20};this.setAllManipulateObjsMerged(!1);var r=this.useMergePreview(),n=this.getEditor();n.hotTrackOnObj(null);var i=d.Editor.BasicManipulationIaController.ManipulationType,o=this.getManipulationType(),a=this.getManipulateOriginObjs(),s=this.getManipulateObjs(),l=[].concat(a);d.ArrayUtils.pushUnique(l,s);var u=this.getMergeOperationsInManipulating(),c=this.getStickOperations(),h=this,p=1===a.length&&a[0]instanceof d.ChemStructureConnector,g=1===s.length&&s[0]instanceof d.BaseStructureNode&&(this._objCanBeMagneticMerged(s[0])||this._objCanBeMagneticSticked(s[0])),f=o===i.MOVE&&!this.getIsOffsetManipulating()&&(p&&this.getEnableConnectorMerge()||g&&this.getEnableNodeMerge()),m=!p&&this.getEnableMagneticMerge();if(m||f){var C=this.getManipulateObjCurrInfoMap(),y=this.getManipulateObjInfoMap(),_=[],E=[],T=[],O=[];if(f){var v=p?a[0]:s[0],S=this._calcMagneticMergeOrStickInfoOnScreenCoord(e,v,this._isManipulatingSingleStickedObj(s),C,y,l,t);if(S)_=[0],E=[S.magneticObj],T=[S.magneticDest],O=[S.magneticType];else if(p&&this.getEnableConnectorMerge()){var b=n.getBoundInfosAtCoord(e,null,this.getCurrBoundInflation()),A=d.ChemStructureConnector,I=(v=a[0],this._findSuitableMergeTargetBoundInfo(b,l,A,(function(e){return h._canMergeConnectors(v,e)})));I&&(_=[0],E=[v],T=[I.obj],O=[t.MERGE_BOND])}}if(!E.length&&m){var R=this._calcMagneticMergeOrStickInfos(s,C,y,l,t);_=R.magneticObjIndexes,E=R.magneticObjs,T=R.magneticDests,O=R.magneticTypes}if(E.length||c.length){var D=E.length;this.setAllManipulateObjsMerged(D===s.length);for(var N=1===D,P=!1,x=!1,M=[],L=[],w=0,k=E.length;w<k;++w){var B=E[w],j=T[w],U=_[w];if(O[w]===t.STICK){if(!x){if(!(W=c[U])||!this.isSameNodeStick(W,B,j)){x=!0;break}L.push(W)}}else P||((F=u[U])&&this.isSameNodeMerge(F,B,j)?M.push(F):P=!0);if(P&&x)break}for(w=0,k=u.length;w<k;++w){var F;if(F=u[w]){if((U=M.indexOf(F))<0){P=!0;break}M.splice(U,1)}}for(w=0,k=c.length;w<k;++w){var W;if(W=c[w]){if((U=L.indexOf(W))<0){x=!0;break}L.splice(U,1)}}if(P||x||N){P&&this.reverseMergeOpers(this.getMergeOperationsInManipulating()),x&&this.reverseStickOpers(this.getStickOperations());var V=d.CoordUtils;if(1===D||n.getCoordMode()===d.CoordMode.COORD3D){if(O[0]!==t.MERGE_BOND){var H=(ie=C.get(E[0]))&&ie.screenCoord,G=n.getObjectScreenCoord(T[0]);if(H&&G){var z=V.substract(G,H),K=!1,Y=d.NumUtils.isFloatEqual;if(!Y(z.x,0,1e-10)||!Y(z.y,0,1e-10))for(w=0,k=s.length;w<k;++w){B=s[w];var X=C.get(B);if(B!==E[0]){if(X&&X.screenCoord){var $=V.add(X.screenCoord,z);X.screenCoord=$,this._getMagneticNodeMergeOrStickDestInfo(B,$,l)&&(K=!0)}}else X&&X.screenCoord&&(X.screenCoord=G)}if(K)return this.applyManipulatingObjsInfo(e);for(w=0,k=s.length;w<k;++w)B=s[w],X=C.get(B),this.applySingleManipulatingObjInfo(w,B,X,e)}}}else if(D>1&&n.getCoordMode()!==d.CoordMode.COORD3D){var q=E[0],J=E[1];if(q&&J){var Z=y.get(q).screenCoord,Q=y.get(J).screenCoord,ee=n.getObjectScreenCoord(T[0]),te=n.getObjectScreenCoord(T[1]),re=V.calcCoordGroup2DTransformParams(Z,Q,ee,te),ne=V.calcTransform2DMatrix(re);for(K=!1,w=0,k=s.length;w<k;++w)if(B=s[w],E.indexOf(B)<0){X=y.get(B);var ie=C.get(B);X.screenCoord&&($=V.transform2DByMatrix(X.screenCoord,ne),ie.screenCoord=$,this._getMagneticNodeMergeOrStickDestInfo(B,$,l)&&(K=!0)),X.size&&(ie.size=V.multiply(X.size,re.scale))}if(K)return this.applyManipulatingObjsInfo(e);for(w=0,k=s.length;w<k;++w)B=s[w],E.indexOf(B)<0&&(ie=C.get(B),this.applySingleManipulatingObjInfo(w,B,ie,e))}}if(P||x){var oe=[];for(this._mergeOperationsChanged(D,E,T),w=0,k=D;w<k;++w){B=E[w],j=T[w],U=_[w];var ae=O[w];if(ae===t.STICK){if(j!==y.get(B).stickTarget)var se=this.createNodeStickOperation(B,j);this.getStickOperations()[U]=se,j||oe.push({index:U,obj:B,newInfo:C.get(B)})}else if(r){var le=ae===t.MERGE_BOND?this.createConnectorMergeOperation(B,j,!0):this.createNodeMergeOperation(B,j,!0);this.getMergePreviewOperations()[U]=le}else{var de=ae===t.MERGE_BOND?this.createConnectorMergeOperation(B,j):this.createNodeMergeOperation(B,j);this.getMergeOperations()[U]=de}}if(P&&this.executeMergeOpers(this.getMergeOperationsInManipulating()),x&&this.executeStickOpers(this.getStickOperations()),oe.length)for(w=0,k=oe.length;w<k;++w){var ue=oe[w];this.applySingleManipulatingObjInfo(ue.index,ue.obj,ue.newInfo,e)}}}return void n.hotTrackOnObj(T)}}(u=this.getMergeOperationsInManipulating())&&u.length&&(this._mergeOperationsChanged(0,[],[]),this.reverseMergeOpers(u)),this.tryApplySuper("applyManipulatingObjsInfo",[e])},_calcMagneticMergeOrStickInfoOnScreenCoord:function(e,t,r,n,i,o,a){var s=this.getEditor(),l=(this._objCanBeMagneticMerged,this._objCanBeMagneticSticked,t),d=e;if(d){s.getBoundInfosAtCoord(d,null,this.getCurrBoundInflation());var u=this._getMagneticNodeMergeOrStickDestInfo(l,d,o),c=null,h=null;if(u&&(u.isStick?h=u.obj:u.isMerge&&(c=u.obj)),c||h)return{magneticObj:l,magneticDest:c||h,magneticType:h?a.STICK:a.MERGE};if(!h&&r&&i.get(l).stickTarget)return{magneticObj:l,magneticDest:null,magneticType:a.STICK}}},_calcMagneticMergeOrStickInfos:function(e,t,r,n,i){for(var o=this._isManipulatingSingleStickedObj(e),a=this._objCanBeMagneticMerged,s=this._objCanBeMagneticSticked,l=(this.getEditor(),[]),d=[],u=[],c=[],h=0,p=e.length;h<p;++h){var g=e[h];if(a(g)||s(g)){var f=t.get(g),m=f&&f.screenCoord;if(m){var C=this._calcMagneticMergeOrStickInfoOnScreenCoord(m,g,o,t,r,n,i);C&&(l.push(h),d.push(C.magneticObj),u.push(C.magneticDest),c.push(C.magneticType))}}}return{magneticObjIndexes:l,magneticObjs:d,magneticDests:u,magneticTypes:c}},_mergeOperationsChanged:function(e,t,r){},doMoveManipulatedObj_old:function(e,t,r,n){var i=this.getEditor(),o=(this.getManipulateObjInfoMap().get(t),r),a=this.getManipulateOriginObjs(),s=this.getManipulationType(),l=s===d.Editor.BasicManipulationIaController.ManipulationType.MOVE&&1===a.length&&a[0]instanceof d.ChemStructureConnector,u=o,c=null,h=this.getMergeOperations(),p=h[e],g=this.getManipulateObjs();if(!l&&this.getEnableMagneticMerge()&&t instanceof d.ChemStructureNode){var f=i.getBoundInfosAtCoord(u);if(f&&f.length){for(var m=f.length-1;m>=0;--m){var C=f[m].obj;if(C!==t&&!(g.indexOf(C)>=0)&&C instanceof d.ChemStructureNode&&this._canMergeNodes(t,C)){if(i.addHotTrackedObj(C),this.isSameNodeMerge(p,t,C))return;c=this.createNodeMergeOperation(t,C);break}}c?(p&&this.reverseMergeOpers(e),this.getMergeOperations()[e]=c,this.executeMergeOpers()):i.hotTrackOnObj(null)}}if(u=n,s===d.Editor.BasicManipulationIaController.ManipulationType.MOVE){var y=a[0];if(a&&1===a.length){var _=i.getTopmostBoundInfoAtCoord(u,[y]);if(_){var E=_.obj;if(E&&g.indexOf(E)<0){if(l&&y instanceof d.ChemStructureConnector&&E instanceof d.ChemStructureConnector)this.getEnableConnectorMerge()&&(i.hotTrackOnObj(E),(this.getEnableStructFragmentMerge()||y.getParent()===E.getParent())&&(c=this.createConnectorMergeOperation(y,E)));else if(y instanceof d.ChemStructureNode&&E instanceof d.ChemStructureNode&&this._canMergeNodes(y,E)){if(i.hotTrackOnObj(E),this.isSameNodeMerge(p,y,E))return;c=this.createNodeMergeOperation(y,E)}if(c)return(p=h[e])&&this.reverseMergeOpers(e),this.getMergeOperations()[e]=c,void this.executeMergeOpers()}}}}c||(i.hideHotTrack(),!!this.getMergeOperations().length&&this.reverseMergeOpers(e),this.tryApplySuper("doMoveManipulatedObj_old",[e,t,r,n]))},createNodeMergeOperation:function(e,t,r){var n=this.getEnableStructFragmentMerge();return d.ChemStructOperation.MergeNodes.canMerge(e,t,n,this.getEnableNeighborNodeMerge())?r?new d.ChemStructOperation.MergeNodesPreview(e,t,n,this.getEditor()):new d.ChemStructOperation.MergeNodes(e,t,n,this.getEditor()):null},createConnectorMergeOperation:function(e,t,r){var n=this.getEnableStructFragmentMerge();return d.ChemStructOperation.MergeConnectors.canMerge(e,t,n)?new(r?d.ChemStructOperation.MergeConnectorsPreview:d.ChemStructOperation.MergeConnectors)(e,t,this.getEditor().getCoordMode(),n,this.getEditor()):null},createNodeStickOperation:function(e,t){return this.getEnableStructFragmentStick(),this._canStickNode(e,t)?new d.ChemObjOperation.StickTo(e,t,this.getEditor()):null},isSameConnectorMerge:function(e,t,r){return e&&e instanceof d.ChemStructOperation.MergeConnectorsBase&&t===e.getTarget()&&r===e.getDest()},isSameNodeMerge:function(e,t,r){return e&&e instanceof d.ChemStructOperation.MergeNodesBase&&t===e.getTarget()&&r===e.getDest()},isSameNodeStick:function(e,t,r){return e&&e instanceof d.ChemObjOperation.StickTo&&t===e.getTarget()&&r===e.getStickTarget()},isSameNodeMergeOrStick:function(e,t,r){return this.isSameNodeMerge(e,t,r)||this.isSameNodeStick(e,t,r)},executeStickOpers:function(e){var t=this.getEditor(),r=d.ArrayUtils.toUnique(e||this.getStickOperations());t.beginUpdateObject();try{for(var n=0,i=r.length;n<i;++n)r[n]&&r[n].execute()}finally{t.endUpdateObject()}},reverseStickOpers:function(e){var t=this.getEditor(),r=e||this.getStickOperations(),n=d.ArrayUtils.toUnique(r);if(n&&n.length){t.beginUpdateObject();try{for(var i=n.length-1;i>=0;--i)n[i]&&n[i].reverse();r.length=0}finally{t.endUpdateObject()}}},executeMergeOpers:function(t){var r=this.getEditor(),n=d.ArrayUtils.toUnique(t||this.getMergeOperationsInManipulating()),i=[];r.beginUpdateObject();try{for(var o=0,a=n.length;o<a;++o)if(n[o]){n[o].execute();var s=n[o].getDest?n[o].getDest():null;s&&e.pushUnique(i,s)}this.setMergingDests(i.length?i:null),this.refreshManipulateObjs(),this._mergeJustReversed=!1}finally{r.endUpdateObject()}},reverseMergeOpers:function(e){var t=this.getEditor();this.setMergingDests(null);var r=e||this.getMergeOperationsInManipulating(),n=d.ArrayUtils.toUnique(r);if(n&&n.length){t.beginUpdateObject();try{for(var i=n.length-1;i>=0;--i)n[i]&&n[i].reverse();r.length=0,this._mergeJustReversed=!0,this.refreshManipulateObjs()}finally{t.endUpdateObject()}}},react_pointermove:function(e){return this._suppressConstrainedMoving=e.getAltKey(),this._suppressConstrainedRotating=e.getAltKey(),this._suppressConstrainedResize=e.getAltKey(),this._isInDirectedMoving=e.getShiftKey(),this.tryApplySuper("react_pointermove",[e])}}),d.Editor.IaControllerManager.register(d.Editor.BasicMolManipulationIaController,d.Editor.ChemSpaceEditor),d.Editor.SelectIaController=Class.create(d.Editor.BasicMolManipulationIaController,{CLASS_NAME:"Kekule.Editor.SelectIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues");var e=d.globalOptions.get;this.setEnableSelect(e("chemWidget.editor.enableSelect",!0)),this.setEnableGestureManipulation(e("chemWidget.editor.enableGesture",!0))}}),d.Editor.IaControllerManager.register(d.Editor.SelectIaController,d.Editor.ChemSpaceEditor),d.Editor.StructureInsertIaController=Class.create(d.Editor.BasicMolManipulationIaController,{CLASS_NAME:"Kekule.Editor.StructureInsertIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._manipulatedBasicObjs=null},getInsertedObjs:function(){return this._manipulatedBasicObjs},doSetManipulateOriginObjs:function(e){return this._manipulatedBasicObjs=this._getManipulatedBasicObjects(e),this.tryApplySuper("doSetManipulateOriginObjs",[e])},_getManipulatedBasicObjects:function(t){for(var r=[],n=0,i=t.length;n<i;++n){var o=t[n];if(o instanceof d.ChemStructureObject)if(o instanceof d.StructureFragment&&o.isExpanded()){var a=[].concat(o.getNodes()).concat(o.getConnectors());e.pushUnique(r,a)}else e.pushUnique(r,o);else e.pushUniqueEx(r,o)}return r},stopManipulate:function(){if(this.needAutoSelectNewlyInsertedObjects()){var e=this.getInsertedObjs();this.doneInsertOrModifyBasicObjects(e)}return this.tryApplySuper("stopManipulate")}}),d.Editor.MolBondIaController=Class.create(d.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.MolBondIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setState(n.State.INITIAL),this.setBondOrder(d.BondOrder.SINGLE)},initProperties:function(){this.defineProp("allowBondingToBond",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("state",{dataType:DataType.INT,serializable:!1}),this.defineProp("enableBondModification",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("autoSwitchBondOrder",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("startingObj",{dataType:"Kekule.ChemStructureObject",serializable:!1}),this.defineProp("endingObj",{dataType:"Kekule.ChemStructureObject",serializable:!1}),this.defineProp("structFragment",{dataType:"Kekule.ChemStructureFragment",serializable:!1}),this.defineProp("autoCreatedStructFragment",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("autoCreatedStartingObj",{dataType:"Kekule.ChemStructureObject",serializable:!1}),this.defineProp("bond",{dataType:"Kekule.Bond",serializable:!1}),this.defineProp("bondType",{dataType:DataType.STRING,serializable:!1}),this.defineProp("bondOrder",{dataType:DataType.INT,serializable:!1}),this.defineProp("bondStereo",{dataType:DataType.INT,serializable:!1}),this.defineProp("initialBondDirection",{dataType:DataType.FLOAT})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableSelect(!1),this.setEnableMove(!0),this.setEnableNeighborNodeMerge(!1);var e=d.globalOptions.get;this.setEnableBondModification(e("chemWidget.editor.bondManipulation.enableBondModification",!0)),this.setAllowBondingToBond(e("chemWidget.editor.bondManipulation.allowBondingToBond",!1)),this.setAutoSwitchBondOrder(e("chemWidget.editor.bondManipulation.autoSwitchBondOrder",!1))},_isBondDifferent:function(e){var t=this.getBondStereo(),r=d.BondStereo;return t===r.UP||t===r.UP_INVERTED||t===r.DOWN||t===r.DOWN_INVERTED||e.getBondType()!==this.getBondType()||e.getBondOrder()!==this.getBondOrder()||e.getStereo()!==this.getBondStereo()},_isBondOrderSwitchApplicable:function(e){return this.getAutoSwitchBondOrder()&&this.getBondOrder()===d.BondOrder.SINGLE&&this.getBondType()===d.BondType.COVALENT&&this.getBondStereo()===d.BondStereo.NONE&&(!e.getBondType()||e.getBondType()===d.BondType.COVALENT)&&(!e.getStereo()||e.getStereo()===d.BondStereo.NONE)},canInteractWithObj:function(e){if(this.getState()!==n.State.INITIAL)return this.tryApplySuper("canInteractWithObj",[e]);if(e instanceof d.ChemStructureNode)return!0;if(e instanceof d.ChemStructureConnector){if(this.getAllowBondingToBond())return!0;if(!this.getEnableBondModification())return!1;if(e instanceof d.Bond)return this._isBondDifferent(e)||this._isBondOrderSwitchApplicable(e)}},doTestMouseCursor:function(e,t){return""},getInsertedObjs:function(){var e=this.getBond();return e?[e]:this.tryApplySuper("getInsertedObjs")},isObjValidBondTerminator:function(e){return!!e&&(this.getAllowBondingToBond()?e instanceof d.ChemStructureNode||e instanceof d.ChemStructureConnector:e instanceof d.ChemStructureNode)},isBond:function(e){return e instanceof d.Bond},getNewBondDefAngle:function(e,t){return this.getEditorConfigs().getStructureConfigs().getNewBondDefAngle(e,t)},addDefBond:function(e,t,r){var n;(a=this.getEditor()).beginUpdateObject();try{if(t)this.setAutoCreatedStartingObj(null),this.setAutoCreatedStructFragment(null);else{if(!this.getEditor().canAddUnconnectedStructFragment())return null;var i=this.getEditor().screenCoordToObj(e),o=this.getEditor().getOnlyOneBlankStructFragment();o?(t=this.getEditor().createStructStartingAtom(o,null,i),this.setAutoCreatedStructFragment(null),this.setAutoCreatedStartingObj(t)):(t=this.getEditor().createNewStructFragmentAndStartingAtom(null,i),this.setAutoCreatedStartingObj(null),this.setAutoCreatedStructFragment(t?t.getParent():null))}if(this.isObjValidBondTerminator(t)){var a=this.getEditor();this.setStartingObj(t);var s=t.getParent();this.setStructFragment(s);var l=this.getEditorConfigs().getStructureConfigs(),u=d.oneOf(this.getBondType(),l.getDefBondType()),c=d.oneOf(this.getBondOrder(),l.getDefBondOrder()),h=d.oneOf(this.getBondStereo(),d.BondStereo.NONE),p=a.getDefBondLength?a.getDefBondLength():l.getDefBondLength(),g=this.getNewBondDefAngle(t,c),f=d.Editor.StructureUtils.calcPreferred2DBondGrowingLocation(t,p,g,this.getEditor().getAllowCoordBorrow()),m=this.getEditor().createDefaultNode(f,d.Editor.CoordSys.OBJ,s);this.setEndingObj(m);var C=new d.Bond;C.setBondType(u),C.setBondOrder(c),C.setStereo(h),s.appendConnector(C),C.appendConnectedObj(t),C.appendConnectedObj(m),this.setBond(C),r&&this.getEditor().objectsChanged([{obj:C},{obj:m}]),n=f}else n=null}finally{a.endUpdateObject()}return n},addOperationToEditor:function(){return this.tryApplySuper("addOperationToEditor")},getAllObjOperations:function(e){var t=this.tryApplySuper("getAllObjOperations",[e])||[],r=this.getAddBondOperation();return r&&t.unshift(r),t},getAddBondOperation:function(){var e=new d.MacroOperation,t=this.getEditor(),r=this.getAutoCreatedStructFragment();if(r){var n=new d.ChemObjOperation.Add(r,this.getEditor().getChemObj(),null,this.getEditor());e.add(n)}var i=this.getStartingObj(),o=this.getEndingObj(),a=this.getBond(),s=this.getStructFragment(),l=(t=this.getEditor(),this.getAutoCreatedStartingObj());if(l){var u=new d.ChemStructOperation.AddNode(l,s,null,t);e.add(u)}u=new d.ChemStructOperation.AddNode(o,s,null,t),e.add(u);var c=new d.ChemStructOperation.AddConnector(a,s,null,[i,o],t);return e.add(c),e},modifyBond:function(e){var t,r=this.getBondType(),n=d.BondOrder,i=[n.SINGLE,n.DOUBLE,n.TRIPLE];if(this._isBondOrderSwitchApplicable(e)){var o=e.getBondOrder(),a=i.indexOf(o);t=i[a=a>=0?++a%i.length:0]}else t=this.getBondOrder();var s=e.getStereo(),l=this.getBondStereo();s===l&&(l=d.BondStereo.getInvertedDirection(l));var u={bondType:r,bondOrder:t,stereo:l},c=!1;for(var h in u)if(e.getPropValue(h)!==u[h]){c=!0;break}if(c){var p=this.getEditor();p.beginUpdateObject();try{var g=new d.ChemObjOperation.Modify(e,u,this.getEditor());g.execute(),p.pushOperation(g);for(var f=[e].concat(e.getConnectedObjs()),m=[],C=0,y=f.length;C<y;++C)m.push({obj:f[C]});this.getEditor().objectsChanged(m)}finally{p.endUpdateObject()}}},react_pointerdown:function(e){if(this.setActivePointerType(e.pointerType),e.getButton()===d.X.Event.MOUSE_BTN_LEFT){var t=n.State,r=this._getEventMouseCoord(e);if(this.getState()===t.INITIAL){var i=this.getEditor().getTopmostBoundInfoAtCoord(r,null,this.getCurrBoundInflation());if(i){var o=i.obj;if(this.isObjValidBondTerminator(o))return this.addDefBond(r,o,!0)&&(this.startDirectManipulate(null,this.getEndingObj(),r),this.moveManipulatedObjs(r)),!0;if(this.isBond(o)&&this.getEnableBondModification())return this.modifyBond(o),!0;e.preventDefault()}else if(this.getEditor().canAddUnconnectedStructFragment())return this.addDefBond(r,null,!0)&&(this.startDirectManipulate(null,this.getEndingObj(),r),this.moveManipulatedObjs(r)),e.preventDefault(),!0}}},react_pointerup:function(e){var t=this.getState(),r=this.getStartCoord(),n=this._getEventMouseCoord(e),i=d.Editor.BasicManipulationIaController.State;return t===i.MANIPULATING&&e.getButton()===d.X.Event.MOUSE_BTN_LEFT&&(e.preventDefault(),d.CoordUtils.isEqual(r,n))?(this.manipulateBeforeStopping(),this.addOperationToEditor(),this.stopManipulate(),this.setState(i.NORMAL),!0):this.tryApplySuper("react_pointerup",[e])}}),d.Editor.MolBondIaController.State={INITIAL:0,START_NODE_SET:21,ADJUSTING:22};var n=d.Editor.MolBondIaController;d.Editor.IaControllerManager.register(d.Editor.MolBondIaController,d.Editor.ChemSpaceEditor),d.Editor.MolAtomIaController_OLD=Class.create(d.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolAtomIaController_OLD",initialize:function(e){this.tryApplySuper("initialize",[e]),this._createNonAtomLabelInfos(),this._setterShown=!1},finalize:function(){this.getAtomSetter()&&this.getAtomSetter().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("currAtom",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("atomSetter",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("periodicTable",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("periodicTableDialog",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("nonAtomLabelInfos",{dataType:DataType.ARRAY,serializable:!1})},canInteractWithObj:function(e){return!!this.isValidNode(e)},isValidNode:function(e){return e instanceof d.ChemStructureNode},getNodeLabel:function(e){var t=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();if(e.getIsotopeId)return e.getIsotopeId();if(e instanceof d.SubGroup)return e.getAbbr()||e.getFormulaText()||t.getRgroup();if(e instanceof d.VariableAtom){var r=e.getAllowedIsotopeIds(),n=e.getDisallowedIsotopeIds();return r&&r.length?this._getVarAtomListLabel():n&&n.length?this._getVarAtomNotListLabel():this._getVarAtomListLabel()}var i=e.getCoreDisplayRichTextItem(null,null,t);return d.Render.RichTextUtils.toText(i)},_getVarAtomListLabel:function(){return this.getEditor().getRenderConfigs().getDisplayLabelConfigs().getVariableAtom()},_getVarAtomNotListLabel:function(){return"~"+this.getEditor().getRenderConfigs().getDisplayLabelConfigs().getVariableAtom()},_createNonAtomLabelInfos:function(){var e=[],t=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();return e.push({nodeLabel:t.getRgroup(),nodeClass:d.RGroup,description:d.$L("ChemWidgetTexts.CAPTION_RGROUP")}),e.push({nodeLabel:t.getDummyAtom(),nodeClass:d.Pseudoatom,props:{atomType:d.PseudoatomType.DUMMY},description:d.$L("ChemWidgetTexts.CAPTION_DUMMY_ATOM")}),e.push({nodeLabel:t.getHeteroAtom(),nodeClass:d.Pseudoatom,props:{atomType:d.PseudoatomType.HETERO},description:d.$L("ChemWidgetTexts.CAPTION_HETERO_ATOM")}),e.push({nodeLabel:t.getAnyAtom(),nodeClass:d.Pseudoatom,props:{atomType:d.PseudoatomType.ANY},description:d.$L("ChemWidgetTexts.CAPTION_ANY_ATOM")}),e.push({nodeLabel:this._getVarAtomListLabel(),nodeClass:d.VariableAtom,description:d.$L("ChemWidgetTexts.CAPTION_VARIABLE_ATOM")}),e.push({nodeLabel:this._getVarAtomNotListLabel(),nodeClass:d.VariableAtom,description:d.$L("ChemWidgetTexts.CAPTION_VARIABLE_NOT_ATOM")}),this.setNonAtomLabelInfos(e),e},_indexOfNonAtomLabel:function(e){for(var t=this.getNonAtomLabelInfos(),r=0,n=t.length;r<n;++r)if(t[r].nodeLabel===e)return r;return-1},_getNonAtomInfo:function(e){var t=this._indexOfNonAtomLabel(e);return t<0?null:this.getNonAtomLabelInfos()[t]},getAtomSetterWidget:function(e){var t=this.getAtomSetter();if(!t&&e){var r=this.getEditor().getCoreElement(),n=r.ownerDocument;t=this._createAtomSetterWidget(n,r),this.setAtomSetter(t)}return t},_createAtomSetterWidget:function(e,t){for(var r=new d.Widget.ComboBox(e),n=this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms(),i=[],o=0,a=n.length;o<a;++o)i.push({value:n[o],data:{props:{isotopeId:n[o]}}});i.push({value:d.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")});var s=this.getNonAtomLabelInfos();for(o=0,a=s.length;o<a;++o){var l=s[o],u={value:l.nodeLabel,data:{props:l.props}};l.description&&(u.text=l.nodeLabel+" - "+l.description),i.push(u)}r.setItems(i),r.appendToElem(t);var c=this;return r.addEventListener("keyup",(function(e){e.htmlEvent.getKeyCode()===d.X.Event.KeyCode.ENTER&&(c.applySetter(r),r.dismiss())})),r.addEventListener("valueSelect",(function(e){c.applySetter(r),r.dismiss()})),r.addEventListener("showStateChange",(function(e){e.isShown||e.isDismissed||c.getAtomSetter()&&c.getAtomSetter().isShown()&&c.applySetter(r)})),r},getPeriodicTableDialogWidget:function(e){var t=this.getPeriodicTableDialog();if(!t&&e){var r=this.getEditor().getCoreElement(),n=r.ownerDocument;t=this._createPeriodicTableDialogWidget(n,r),this.setPeriodicTableDialog(t)}return t},_createPeriodicTableDialogWidget:function(e,t){var r=new d.Widget.Dialog(e,d.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[d.Widget.DialogButtons.OK,d.Widget.DialogButtons.CANCEL]),n=new d.ChemWidget.PeriodicTable(e);return n.setUseMiniMode(!0),n.setEnableSelect(!0),n.appendToElem(r.getClientElem()),this.setPeriodicTable(n),r},openSetterUi:function(e,t){if(this.getAtomSetter(),this.isValidNode(t)){this.setCurrAtom(t);var r=this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize()||0,n=r/1.5,i=this.getNodeLabel(t),o=this.getAtomSetterWidget(!0);o.setValue(i),o.setIsDirty(!1);var a=o.getElement().style;a.position="absolute",a.fontSize=r,a.left=e.x-n+"px",a.top=e.y-n+"px",o._applied=!1,o.setStandaloneOnShowHide(!0),o.show(this.getEditor(),null,d.Widget.ShowHideType.POPUP),function(){o.focus(),o.selectAll()}.defer()}},applySetter:function(e,t){if(!e._applied&&e.getIsDirty()){var r;t||(t=this.getCurrAtom());var n=null,i=e.getValue();if(i===d.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")){(a=this.getPeriodicTableDialogWidget(!0)).setCaption(d.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM"));var o=t.getSymbol?t.getSymbol():null;this.getPeriodicTable().setEnableSelect(!0).setEnableMultiSelect(!1).setSelectedSymbol(o)}else if(i===this._getVarAtomListLabel()||i===this._getVarAtomNotListLabel()){var a,s=i===this._getVarAtomNotListLabel();(a=this.getPeriodicTableDialogWidget(!0)).setCaption(d.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM"));var l=t.getAllowedIsotopeIds?t.getAllowedIsotopeIds():null,u=t.getDisallowedIsotopeIds?t.getDisallowedIsotopeIds():null;this.getPeriodicTable().setEnableSelect(!0).setEnableMultiSelect(!0).setSelectedSymbols(s?u:l)}if(a){var c=this;a.openModal((function(e){if(e===d.Widget.DialogButtons.OK){var r,n;if(i===d.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")){var o=c.getPeriodicTable().getSelectedSymbol();r=d.Atom,n={isotopeId:o}}if(i===c._getVarAtomListLabel()){var a=c.getPeriodicTable().getSelectedSymbols();r=d.VariableAtom,n={allowedIsotopeIds:a,disallowedIsotopeIds:null}}i===c._getVarAtomNotListLabel()&&(a=c.getPeriodicTable().getSelectedSymbols(),r=d.VariableAtom,n={allowedIsotopeIds:null,disallowedIsotopeIds:a}),c.applyModification(t,null,r,n)}}),this)}else{var h=null,p=this._getNonAtomInfo(i);if(p)r=p.nodeClass,n=p.props;else{var g=d.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText(i);if(g){var f=g.createObjects(t)||{},m=f.objects,C=d.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),g,f,t,null);this.getEditor().transformCoordAndSizeOfObjects(m,C),r=(h=m[0]).getClass()}else(r=d.ChemStructureNodeFactory.getClassByLabel(i,null))||this.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()&&(r=d.Pseudoatom),n=r===d.Atom?{isotopeId:i}:r===d.Pseudoatom?{symbol:i}:{}}r?(this.applyModification(t,h,r,n),e._applied=!0):d.error(d.$L("ErrorMsg.INVALID_ATOM_SYMBOL"))}}},applyModification:function(e,t,r,n){var i,o,a=e.getClass();if(t&&!r&&(r=t.getClass()),t||r!==a){i=new d.MacroOperation,t||(t=new r);var s=new d.ChemStructureNode;s.assign(e),t.assign(s);var l=new d.ChemStructOperation.ReplaceNode(e,t,null,this.getEditor());i.add(l)}else t=e;n&&(o=new d.ChemObjOperation.Modify(t,n,this.getEditor()),i&&i.add(o));var u=i||o;if(u){var c=this.getEditor();c.beginManipulateAndUpdateObject();try{u.execute()}catch(e){throw e}finally{c.endManipulateAndUpdateObject()}c&&c.getEnableOperHistory()&&u&&c.pushOperation(u)}},react_pointerup:function(e){if(e.getButton()===d.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var t=this._getEventMouseCoord(e),r=this.getEditor().getTopmostBoundInfoAtCoord(t,null,this.getCurrBoundInflation());if(r){var n=r.obj;if(this.isValidNode(n)){var i=this.getEditor().getObjectScreenCoord(n);e.preventDefault(),e.stopPropagation(),this.openSetterUi(i,n),this.getEditor().setSelection([n])}return!0}}}}),d.Editor.MolAtomIaController=Class.create(d.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolAtomIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._createNonAtomLabelInfos(),this._setterShown=!1},finalize:function(){this.getAtomSetter()&&this.getAtomSetter().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("currAtom",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("nonAtomLabelInfos",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("atomSetter",{dataType:DataType.OBJECT,serializable:!1,setter:function(e){var t=this.getAtomSetter();t&&this.unbindAtomSetter(t),this.setPropStoreFieldValue("atomSetter",e),e&&this.bindAtomSetter(e)}})},canInteractWithObj:function(e){return!!this.isValidNode(e)},isValidNode:function(e){return e instanceof d.ChemStructureNode&&!(e instanceof d.StructureFragment&&e.isStandalone())},_createNonAtomLabelInfos:function(){var e=this.getEditor(),t=e&&e.getEnabledNonAtomInputData&&e.getEnabledNonAtomInputData();return this.setNonAtomLabelInfos(t),t},_indexOfNonAtomLabel:function(e){for(var t=this.getNonAtomLabelInfos(),r=0,n=t.length;r<n;++r)if(t[r].nodeLabel===e)return r;return-1},_getNonAtomInfo:function(e){var t=this._indexOfNonAtomLabel(e);return t<0?null:this.getNonAtomLabelInfos()[t]},getAtomSetterWidget:function(e){var t=this.getAtomSetter();if(!t&&e){var r=this.getEditor().getCoreElement(),n=r.ownerDocument;t=this._createAtomSetterWidget(n,r),this.setAtomSetter(t)}return t},bindAtomSetter:function(e){this._initAtomSetterWidgetSettings(e),this._setAtomSetterEventListener(e,!0)},unbindAtomSetter:function(e){this._setAtomSetterEventListener(e,!1)},_createAtomSetterWidget:function(e,t){var r=new d.ChemWidget.StructureNodeSetter(this.getEditor());return r.setUseDropDownSelectPanel(!0),r.appendToElem(t),r},_initAtomSetterWidgetSettings:function(t){if(t.addClassName(r.CHEMEDITOR_ATOM_SETTER),t.setSelectableInfos){var n=e.clone(this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms());n.push("...");var i=this.getNonAtomLabelInfos();t.setSelectableInfos({elementSymbols:n,nonElementInfos:i,subGroupRepItems:d.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems()})}},_setAtomSetterEventListener:function(e,t){t?e.addEventListener("valueChange",this._reactAtomSetterValueChange,this):e.removeEventListener("valueChange",this._reactAtomSetterValueChange,this)},_reactAtomSetterValueChange:function(e){var t=this.getAtomSetter();t&&t.isShown()&&(e.value&&this.applySetter(t),t.dismiss())},_reactAtomSetterShowStateChange:function(e){var t=this.getAtomSetter();e.target!==t||e.byDomChange||e.isShown||e.isDismissed||t&&t.isShown()&&this.applySetter(t)},getPeriodicTableDialogWidget:function(e){var t=this.getPeriodicTableDialog();if(!t&&e){var r=this.getEditor().getCoreElement(),n=r.ownerDocument;t=this._createPeriodicTableDialogWidget(n,r),this.setPeriodicTableDialog(t)}return t},_createPeriodicTableDialogWidget:function(e,t){var r=new d.Widget.Dialog(e,d.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[d.Widget.DialogButtons.OK,d.Widget.DialogButtons.CANCEL]),n=new d.ChemWidget.PeriodicTable(e);return n.setUseMiniMode(!0),n.setEnableSelect(!0),n.appendToElem(r.getClientElem()),this.setPeriodicTable(n),r},openSetterUi:function(e,t){var r=this.getAtomSetter();if(r&&r.isShown()&&(r.hide(),r._haltPrevShowHideProcess()),this.isValidNode(t)){this.setCurrAtom(t);var n=this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize()||0,i=(n*=this.getEditor().getZoom()||1)/1.5,o=this.getAtomSetterWidget(!0);o.setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs()),o.setNodes([t]);var a=this.getEditor().getCoreElement();o.appendToElem(a);var s=o.getNodeInputBox(),l=o.getElement().style;l.position="absolute",l.left=e.x-i+"px",l.top=e.y-i+"px",l.opacity=1,o.setNodeInputBoxFontSize&&o.setNodeInputBoxFontSize(n+"px"),o._applied=!1,o.setStandaloneOnShowHide(!0),o.show(this.getEditor(),null,d.Widget.ShowHideType.POPUP),function(){s.focus(),s.selectAll()}.defer()}},applySetter:function(e,t){if(!e._applied){t||(t=this.getCurrAtom());var r=e.getValue();if(r){var n=d.Editor.OperationUtils.createNodeModificationOperationFromData(t,r,this.getEditor());if(n){var i=this.getEditor();i.beginManipulateAndUpdateObject();try{n.execute()}catch(e){throw e}finally{i.endManipulateAndUpdateObject()}i&&i.getEnableOperHistory()&&n&&i.pushOperation(n)}}}},applyModification:function(e,t,r,n){var i=d.Editor.OperationUtils.createNodeModificationOperation(e,t,r,n,this.getEditor());if(i){var o=this.getEditor();o.beginManipulateAndUpdateObject();try{i.execute()}catch(e){throw e}finally{o.endManipulateAndUpdateObject()}o&&o.getEnableOperHistory()&&i&&o.pushOperation(i)}},react_pointerup:function(e){if(e.getButton()===d.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var t=this._getEventMouseCoord(e),r=this.getTopmostInteractableObjAtScreenCoord(t),n=this.getEditor().getObjectScreenCoord(r);return e.preventDefault(),e.stopPropagation(),this.openSetterUi(n,r),this.doneInsertOrModifyBasicObjects([r]),!0}}}),d.Editor.IaControllerManager.register(d.Editor.MolAtomIaController,d.Editor.ChemSpaceEditor),d.Editor.RepositoryIaController=Class.create(d.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.RepositoryIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1),this._repObjStartingScreenCoord=null},initProperties:function(){this.defineProp("repositoryItem",{dataType:"Kekule.AbstractRepositoryItem",serializable:!1}),this.defineProp("addRepObjsOper",{dataType:"Kekule.MacroOperation",serializable:!1}),this.defineProp("initialTransformParams",{dataType:DataType.HASH,serializable:!1}),this.defineProp("currRepositoryObjects",{dataType:"Kekule.ChemObject",serializable:!1})},doTestMouseCursor:function(e,t){return""},canInteractWithObj:function(e){return this.tryApplySuper("canInteractWithObj",[e])},isValidStartingObj:function(e){return!0},calcInitialTransformParams:function(e,t,r,n){return d.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),e,t,r,n)},getRepObjCreationOptions:function(){return null},createObjFromRepositoryItem:function(e,t){return t.createObjects(e,this.getRepObjCreationOptions())||{}},addRepositoryObj:function(e,t,r){var n=this.getEditor();this.setAddRepObjsOper(null);var i=null;n.beginUpdateObject();try{var o=n.getChemSpace(),a=this.getRepositoryItem(),s=(i=this.createObjFromRepositoryItem(e,a)).objects;this.setCurrRepositoryObjects(s);var l=a.isOneStructureFragmentObj(),u=!1,c=this.getEditor().getOnlyOneBlankStructFragment();if(!n.canCreateNewChild()&&!i.mergeObj&&!r){if(!l||!n.canAddUnconnectedStructFragment())return null;u=!0}for(var h=new d.MacroOperation,p=0,g=s.length;p<g;++p){var f,m=s[p];f=u?new d.ChemStructOperation.MergeStructFragment(m,c,n):new d.ChemObjOperation.Add(m,o,null,n),h.add(f)}h.execute(),this.setAddRepObjsOper(h);var C=u?[c]:s,y=this.calcInitialTransformParams(a,i,e,t);this._transformObjectsCoordAndSize(C,y),this.setInitialTransformParams(y),i.objects=C;var _=a.getMolManipulationCenterCoord&&a.getMolManipulationCenterCoord();_&&(i.manipulationCenterCoord=d.CoordUtils.transform2D(_,y));var E=a.getMolManipulationDefDirectionCoord&&a.getMolManipulationDefDirectionCoord();E&&(i.manipulationDefDirectionCoord=d.CoordUtils.transform2D(E,y))}finally{n.endUpdateObject()}return i},doRefreshRepositoryObj:function(e,t,r,n,i){this.doPrepareManipulatingObjects(e,t),this.doPrepareManipulatingStartingCoords(t,r,n,i),this.doCreateManipulateMoveAndResizeOperation()},_transformObjectsCoordAndSize:function(e,t){return this.getEditor().transformCoordAndSizeOfObjects(e,t)},getAllObjOperations:function(e){var t=this.tryApplySuper("getAllObjOperations",[e])||[],r=this.getAddRepObjsOper();return r&&t.unshift(r),t},addOperationToEditor:function(){return this.tryApplySuper("addOperationToEditor")},getInitManipulationType:function(){return d.Editor.BasicManipulationIaController.ManipulationType.ROTATE},doInsertRepositoryObjToEditor:function(e,t,r,n){n||(this._initialStartingObj=r,this._repObjStartingScreenCoord=t);var i=e;if(i){var o=i.objects,a=null,s=null,l=this.getInitManipulationType();return i.mergeObj?(a=this.getEditor().getObjectScreenCoord(i.mergeObj),l=d.Editor.BasicManipulationIaController.ManipulationType.ROTATE):i.manipulationCenterCoord&&(a=this.getEditor().objCoordToScreen(i.manipulationCenterCoord)),i.manipulationDefDirectionCoord&&(s=this.getEditor().objCoordToScreen(i.manipulationDefDirectionCoord)),{objects:o,manipulateType:l,coord:t,box:this.getEditor().getObjectsContainerBox(o),rotateCenter:a,rotateRefCoord:s,startingObj:r}}return null},insertRepositoryObjToEditor:function(e,t,r){var n=this.addRepositoryObj(t,e);return this.doInsertRepositoryObjToEditor(n,e,t,r)},updateRepositoryObjInEditor:function(){var t=this.getEditor();t.beginUpdateObject();try{this.useMergePreview()||this.reverseActiveOperation();for(var r=this.getCurrRepositoryObjects(),n=this.addRepositoryObj(this._initialStartingObj,this._repObjStartingScreenCoord,!0),i=e.exclude(r,(n||{}).objects),o=0,a=i.length;o<a;++o){var s=i[o],l=s.getParent();l&&l.removeChild(s)}this.useMergePreview()&&!i.length||(this.setMergeOperations([]),this.setMergePreviewOperations([]));var d=this.doInsertRepositoryObjToEditor(n,this._repObjStartingScreenCoord,this._initialStartingObj,!0);d&&(this.doRefreshRepositoryObj(d.objects,d.coord,d.box,d.rotateCenter,d.rotateRefCoord),this.moveManipulatedObjs(this._repObjStartingScreenCoord))}finally{t.endUpdateObject()}return d},getDirectManipulateObjs:function(e,t){return e},react_pointerdown:function(t){if(this.setActivePointerType(t.pointerType),t.getButton()===d.X.Event.MOUSE_BTN_LEFT){var r=n.State,i=this._getEventMouseCoord(t);if(this.getState()===r.INITIAL){var o=this.getEditor().getTopmostBoundInfoAtCoord(i,null,this.getCurrBoundInflation()),a=o?o.obj:null,s=this.insertRepositoryObjToEditor(i,a);if(s){var l=s.objects||[],u=this.getDirectManipulateObjs(s.objects,s)||[];e.exclude(l,u).length||e.exclude(u,l).length?(this.startDirectManipulate(s.manipulateType,l,s.coord,s.box,s.rotateCenter),this.moveManipulatedObjs(i),this.startDirectManipulate(s.manipulateType,u,s.coord,s.box,s.rotateCenter),this.moveManipulatedObjs(i)):(this.startDirectManipulate(s.manipulateType,l,s.coord,s.box,s.rotateCenter),this.moveManipulatedObjs(i))}return t.preventDefault(),!0}}},react_pointerup:function(e){var t=this.getState(),r=this.getStartCoord(),n=this._getEventMouseCoord(e),i=d.Editor.BasicManipulationIaController.State;return t===i.MANIPULATING&&e.getButton()===d.X.Event.MOUSE_BTN_LEFT&&d.CoordUtils.isEqual(r,n)?(this.manipulateBeforeStopping(),this.addOperationToEditor(),this.stopManipulate(),this.setState(i.NORMAL),e.preventDefault(),!0):this.tryApplySuper("react_pointerup",[e])}}),d.Editor.RepositoryStructureFragmentIaController=Class.create(d.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.RepositoryStructureFragmentIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("repItemName",{dataType:DataType.STRING,setter:function(e){if(e!==this.getRepItemName()){var t=d.Editor.RepositoryItemManager.getItem(e);t&&(this.setRepositoryItem(t),this.setPropStoreFieldValue("repItemName",e))}}})}}),d.Editor.IaControllerManager.register(d.Editor.RepositoryStructureFragmentIaController,d.Editor.ChemSpaceEditor),d.Editor.MolFlexStructureIaController=Class.create(d.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.MolFlexStructureIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1)},initProperties:function(){this.defineProp("assocMarker",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("assocMarker");return e||(e=new d.ChemWidget.TextUiMarker,this.setPropStoreFieldValue("assocMarker",e)),e}})},manipulateEnd:function(){this.tryApplySuper("manipulateEnd"),this.hideAssocMarker()},initAssocMarker:function(){var e=this.getAssocMarker(),t=this.getEditorConfigs().getUiMarkerConfigs(),r={color:t.getFlexStructureAssocMarkerColor(),opacity:t.getFlexStructureAssocMarkerOpacity(),fontSize:t.getFlexStructureAssocMarkerFontSize(),fontFamily:t.getFlexStructureAssocMarkerFontFamily(),textBoxXAlignment:d.Render.BoxXAlignment.CENTER,textBoxYAlignment:d.Render.BoxYAlignment.CENTER};return e.setDrawStyles(r),e.setVisible(!0),this.getEditor().getUiMarkers().addMarker(e),e},hideAssocMarker:function(){var e=this.getPropStoreFieldValue("assocMarker");e&&(e.setVisible(!1),this.getEditor().getUiMarkers().removeMarker(e),this.repaintMarker())},updateAssocMarker:function(e,t,r){var n=this.getAssocMarker();e&&n.setCoord(e),t&&n.setPropValues(t),r||this.repaintMarker()},repaintMarker:function(){this.getEditor().repaintUiMarker()}}),d.Editor.MolFlexChainIaController=Class.create(d.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolFlexChainIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1),this._deltaDistance=null,this._deltaCount=0,this._lastDeltaCount=1,this._repObjStartingScreenCoord=null,this._repObjNeedUpdate=!1,this._isForceReversedChainDirection=!1,this._assocMarkerInitCoord=null,this._manipulateObjInfoCache=[],this._chain=null;var t=new d.Editor.MolChainRepositoryItem2D(2);t.setEnableCoordCache(!0),this.setRepositoryItem(t)},updateAssocMarker:function(e,r,n){var i=this.getEditor(),o=this.getAssocMarker().getDrawStyles(),a=this._chain,s=e;if(!s&&a){var l,u=a.getNodeAt(0),c=a.getNodeAt(a.getNodeCount()-1),h=i.getObjectContextCoord(u);if((s=i.getObjectContextCoord(c))&&h&&(l=t.substract(s,h)),l){var p=(o.fontSize||10)/2,g={x:0,y:0};if(s){var f=t.getDistance(l);g={x:p*(l.x/f),y:p*(l.y/f)},s=d.CoordUtils.add(s,g)}}}this.tryApplySuper("updateAssocMarker",[s,r,n])},getChainMaxAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMaxFlexChainAtomCount(),0)},manipulateEnd:function(){this._clearManipulateObjInfoCache(),this.tryApplySuper("manipulateEnd")},createManipulateObjInfo:function(e,t,r){var n=this.getRepositoryItem().getNegativeDirection(),i=this._getCachedManipulateObjInfo(t,n);if(i)return i;var o=this.tryApplySuper("createManipulateObjInfo",[e,t,r]);return this._setCachedManipulateObjInfo(o,t,n),o},canInteractWithObj:function(e){return this.tryApplySuper("canInteractWithObj",[e])&&e instanceof d.ChemStructureNode},getActualManipulatingObjects:function(t){var r=this.getCurrRepositoryObjects()[0];return r?e.clone(r.getNodes()):[]},_setCachedManipulateObjInfo:function(e,t,r){var n=r?1:0,i=this._manipulateObjInfoCache[n];i||(i=[],this._manipulateObjInfoCache[n]=i),i[t]=e},_getCachedManipulateObjInfo:function(e,t){var r=t?1:0,n=this._manipulateObjInfoCache[r];return n&&n[e]},_clearManipulateObjInfoCache:function(){this._manipulateObjInfoCache=[]},_calcStepDeltaDistance:function(){var e=this.getRepositoryItem().getBondLength(),t=this.getInitialTransformParams(),r=this.getEditor(),n=r.objCoordToScreen(d.CoordUtils.transform2D({x:0,y:0},t)),i=r.objCoordToScreen(d.CoordUtils.transform2D({x:e*Math.cos(Math.PI/6),y:0},t));return d.CoordUtils.getDistance(n,i)},getRepObjCreationOptions:function(){return this._isUpdateRepObj?{originalStructFragment:this.getCurrRepositoryObjects()[0]}:null},addRepositoryObj:function(e,t,r){var n=this.tryApplySuper("addRepositoryObj",[e,t,r]);return this._deltaDistance=this._calcStepDeltaDistance(),this._repObjNeedUpdate=!1,n},insertRepositoryObjToEditor:function(e,t,r){if(!r){this._deltaDistance=null,this._deltaCount=0,this._lastDeltaCount=1;var n=2;this.getRepositoryItem().setAtomCount(n)}this._isUpdateRepObj=r;var i=this.tryApplySuper("insertRepositoryObjToEditor",[e,t,r]);return this._chain=i&&i.objects[0],i&&!r&&(this.initAssocMarker(),this.updateAssocMarker(null,{text:""+n})),i},_updateChain:function(){this._isUpdateRepObj=!0;var e=this.updateRepositoryObjInEditor();return this._chain=e.objects[0],this._repObjNeedUpdate=!1,e},doTransformManipulatedObjs:function(e,t,r){var n=t;if(this.getState()===d.Editor.BasicManipulationIaController.State.MANIPULATING){var i=this.getBaseCoord();if(i){var o=d.CoordUtils.getDistance(n,i),a=Math.max(Math.round(o/this._deltaDistance),1);if(!this._lastDeltaCount||a!==this._lastDeltaCount){this._deltaCount=a;var s=this.getChainMaxAtomCount(),l=s?Math.min(s,a+1):a+1;this.getRepositoryItem().getAtomCount()!==l&&(this.getRepositoryItem().setAtomCount(l),this._repObjNeedUpdate=!0,this.updateAssocMarker(null,{text:""+l},!0)),this._lastDeltaCount=a}var u,c=this._calcRotateAngle(n),h=c&&c.angle,p=this.isInActualConstrainedRotation();if(p){var g=p?2*this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep():null;u=Math.round(h/g)*g-h<0}else u=!1;this._isForceReversedChainDirection&&(u=!u),!!this.getRepositoryItem().getNegativeDirection()!==u&&(this.getRepositoryItem().setNegativeDirection(u),this._repObjNeedUpdate=!0)}}this._repObjNeedUpdate&&this._updateChain();var f=this.getCurrRepositoryObjects()[0];f.beginUpdate();try{var m=this.tryApplySuper("doTransformManipulatedObjs",[e,t,r]);this.updateAssocMarker(null,null,!1)}finally{f.endUpdate()}return m},react_pointermove:function(e){return this._isForceReversedChainDirection=!!e.getShiftKey(),this.tryApplySuper("react_pointermove",[e])}}),d.Editor.IaControllerManager.register(d.Editor.MolFlexChainIaController,d.Editor.ChemSpaceEditor),d.Editor.MolFlexRingIaController=Class.create(d.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolFlexRingIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1),this._deltaDistance=null,this._lastDeltaCount=1,this._repObjStartingScreenCoord=null,this._repObjNeedUpdate=!1,this._manipulateObjInfoCache=[];var t=new d.Editor.MolRingRepositoryItem2D(3);t.setEnableCoordCache(!0),this.setRepositoryItem(t)},getRingMaxAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMaxFlexRingAtomCount(),0)},getRingMinAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMinFlexRingAtomCount(),3)},getActualManipulatingObjects:function(t){var r=this.getCurrRepositoryObjects()[0];return r?e.clone(r.getNodes()):[]},manipulateEnd:function(){this._clearManipulateObjInfoCache(),this.tryApplySuper("manipulateEnd")},createManipulateObjInfo:function(e,t,r){var n=this.getRepositoryItem().getRingAtomCount(),i=this._getCachedManipulateObjInfo(t,n);if(i)return i;var o=this.tryApplySuper("createManipulateObjInfo",[e,t,r]);return this._setCachedManipulateObjInfo(o,t,n),o},_setCachedManipulateObjInfo:function(e,t,r){var n=this._manipulateObjInfoCache[r];n||(n=[],this._manipulateObjInfoCache[r]=n),n[t]=e},_getCachedManipulateObjInfo:function(e,t){var r=this._manipulateObjInfoCache[t];return r&&r[e]},_clearManipulateObjInfoCache:function(){this._manipulateObjInfoCache=[]},_calcStepDeltaDistance:function(){var e=this.getRepositoryItem().getBondLength(),t=this.getInitialTransformParams(),r=this.getEditor(),n=r.objCoordToScreen(d.CoordUtils.transform2D({x:0,y:0},t)),i=r.objCoordToScreen(d.CoordUtils.transform2D({x:e,y:0},t));return d.CoordUtils.getDistance(n,i)/3},getRepObjCreationOptions:function(){return this._isUpdateRepObj?{originalStructFragment:this.getCurrRepositoryObjects()[0]}:null},addRepositoryObj:function(e,t,r){var n=this.tryApplySuper("addRepositoryObj",[e,t,r]);return this._deltaDistance=this._calcStepDeltaDistance(),this._repObjNeedUpdate=!1,n},insertRepositoryObjToEditor:function(e,t,r){if(!r){this._deltaDistance=null,this._lastDeltaCount=1;var n=this.getEditorConfigs().getStructureConfigs().getMinFlexRingAtomCount();this.getRepositoryItem().setRingAtomCount(n)}this._isUpdateRepObj=r;var i=this.tryApplySuper("insertRepositoryObjToEditor",[e,t]);if(i&&!r){var o=i.objects[0];this.initAssocMarker(),this.updateAssocMarker(this._getRingCenterAbsContextCoord(o),{text:""+n})}return i},updateAssocMarker:function(e,t,r){if(!e){var n=this._getManipulateObjsCenterCoord();e=this.getEditor().objCoordToContext(n)}return this.tryApplySuper("updateAssocMarker",[e,t,r])},_getRingCenterAbsContextCoord:function(e){var t=this.getEditor(),r=d.Editor.StructureUtils.getStructureCenterAbsBaseCoord(e,t.getCoordMode(),t.getAllowCoordBorrow());return t.objCoordToContext(r)},_updateRing:function(){this._isUpdateRepObj=!0;var e=this.updateRepositoryObjInEditor();return this._repObjNeedUpdate=!1,e},doTransformManipulatedObjs:function(e,t,r){var n=t;if(this.getState()===d.Editor.BasicManipulationIaController.State.MANIPULATING){var i=this.getBaseCoord();if(i){var o=this.getRingMinAtomCount(),a=d.CoordUtils.getDistance(n,i),s=Math.round(a/this._deltaDistance)+o;if(!this._lastDeltaCount||s!==this._lastDeltaCount){var l=this.getRingMaxAtomCount(),u=l?Math.min(l,s):s;u=o?Math.max(u,o):u,this.getRepositoryItem().getRingAtomCount()!==u&&(this.getRepositoryItem().setRingAtomCount(u),this._repObjNeedUpdate=!0,this.updateAssocMarker(null,{text:""+u},!0)),this._lastDeltaCount=s}}}this._repObjNeedUpdate&&this._updateRing();var c=this.getCurrRepositoryObjects()[0];c.beginUpdate();try{var h=this.tryApplySuper("doTransformManipulatedObjs",[e,t,r]);this.updateAssocMarker(null,null,!1)}finally{c.endUpdate()}return h}}),d.Editor.IaControllerManager.register(d.Editor.MolFlexRingIaController,d.Editor.ChemSpaceEditor),d.Editor.MolRingIaController=Class.create(d.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolRingIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setRepositoryItem(new d.Editor.MolRingRepositoryItem2D),this.setEnableSelect(!1),this._currBondOrders=null},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT,getter:function(){return this.getRepositoryItem().getRingAtomCount()},setter:function(e){this.getRepositoryItem().setRingAtomCount(e)}}),this.defineProp("isAromatic",{dataType:DataType.INT})},getActualManipulatingObjects:function(t){var r=this.getCurrRepositoryObjects()[0];return r?e.clone(r.getNodes()):[]},createNodeMergeOperation:function(e,t,r){var n=this.tryApplySuper("createNodeMergeOperation",[e,t,r]);return this.getIsAromatic()&&n&&n.setMergeConnectorPropsFromTarget&&n.setMergeConnectorPropsFromTarget(!0),n},manipulateBeforeStopping:function(){return this._currBondOrders&&this.useMergePreview()&&this._applyBondOrdersToSrcStruct(null,this._currBondOrders),this.tryApplySuper("manipulateBeforeStopping")},_mergeOperationsChanged:function(e,t,r){this.tryApplySuper("_mergeOperationsChanged",[e,t,r]);var n=this.getCurrRepositoryObjects(),i=n&&n[0];if(i){var o=this._getMergedDestObjs(i,e,t,r);this.updateRepStructureBondOrders(i,o,this.useMergePreview())}},createObjFromRepositoryItem:function(e,t){var r=this.tryApplySuper("createObjFromRepositoryItem",[e,t]);return this.updateRepStructureBondOrders(r.objects[0],null),this._currBondOrders=null,r},updateRepStructureBondOrders:function(e,t,r){if(this.getIsAromatic()){if(!e){var n=this.getCurrRepositoryObjects();e=n&&n[0]}t||(t={nodes:[],connectors:[],nodeCount:0,connectorCount:0});var i=this._calcSrcBondOrders(e,t),o=i.bondOrders,a=i.previewBondOrders;this._currBondOrders=o,this._applyBondOrdersToSrcStruct(e,r?a:o)}},_applyBondOrdersToSrcStruct:function(e,t){if(!e){var r=this.getCurrRepositoryObjects();e=r&&r[0]}var n=this.getEditor();try{n.beginUpdateObject(),e.beginUpdate();try{for(var i=0,o=e.getConnectorCount();i<o;++i){var a=e.getConnectorAt(i);if(a&&a.setBondOrder){var s=t[i];a.setBondOrder(s)}}}finally{e.endUpdate()}}finally{n.endUpdateObject()}},_getMergedDestObjs:function(e,t,r,n){var i=e;if(i){for(var o=function(e,t,r){for(var n=e.getConnectedChemNodes(),i=[],o=0,a=n.length;o<a;++o){var s=n[o],l=r[t.indexOf(s)];if(!l)return null;i.push(l)}if(2===i.length){var d=i[0].getLinkedConnectors();for(o=0,a=d.length;o<a;++o){var u=d[o],c=u.getConnectedChemNodes();if(2===c.length&&c.indexOf(i[1])>=0)return u}}return null},a={nodes:[],connectors:[],nodeCount:0,connectorCount:0},s=0,l=i.getNodeCount();s<l;++s){var d=i.getNodeAt(s),u=r.indexOf(d),c=u>=0?n[u]:null;a.nodes.push(c),c&&++a.nodeCount}for(s=0,l=i.getConnectorCount();s<l;++s){var h=o(i.getConnectorAt(s),i.getNodes(),a.nodes)||null;a.connectors.push(h),h&&++a.connectorCount}}return a},_calcSrcBondOrders:function(t,r){if(t&&t.getNodeCount()){r&&r.nodeCount;for(var n=t.getConnectors(),i=r.connectors,o=t.getNodes(),a=r.nodes,s=function(e){return e>d.BondOrder.SINGLE&&e<=d.BondOrder.QUAD},l=function(e){var t=e.getLinkedBonds(d.BondType.COVALENT),r=!1;if(t.length)for(var n=0,i=t.length;n<i;++n)if(t[n].getBondOrder()===d.BondOrder.EXPLICIT_AROMATIC){r=!0;break}return r},u=function(t,r){var i=t.getLinkedBonds(d.BondType.COVALENT),o=e.exclude(i,r),a=!1;if((o=e.exclude(o,n)).length)for(var l=0,u=o.length;l<u;++l){var c=o[l].getBondOrder();if(s(c)){a=!0;break}}return a},c=function(t,r){var n=t.getLinkedBonds(d.BondType.COVALENT),i=e.intersect(n,r),o=!1;if(i.length)for(var a=0,l=i.length;a<l;++a){var u=i[a].getBondOrder();if(s(u)){o=!0;break}}return o},h=[],p=[],g=!1,f=0,m=a.length;f<m;++f){var C=a[f];if(C&&l(C)){g=!0;break}}if(g){for(h=[],f=0,m=n.length;f<m;++f)h[f]=d.BondOrder.EXPLICIT_AROMATIC;return h}for(f=0,m=i.length;f<m;++f){var y=i[f];if(y){var _=y.getBondOrder();s(_)&&(h[f]=_)}}return function e(t,r,n,i,o,a,l){var h,p,g=d.BondOrder,f=t-1;f<0&&(f=r.length-1);var m,C=!!a[f],y=C?a[f]:null,_=r[t],E=i[t],T=E&&E.getBondOrder(),O=0;if(T&&s(T))h=[T],p=[g.SINGLE],y&&s(y)&&++O;else if(C&&s(y))h=[g.SINGLE];else{for(var v=_.getConnectedChemNodes(),S=!1,b=!1,A=0,I=v.length;A<I;++A){var R=o[n.indexOf(v[A])];if(R&&(S=u(R,i),b=c(R,i),S||b))break}h=S||b?[g.SINGLE]:[g.DOUBLE,g.SINGLE]}for(A=0,I=h.length;A<I;++A){var D=h[A];if(a[t]=D,l[t]=p&&p[A]||D,t<r.length-1&&(O+=e(++t,r,n,i,o,a,l),(d.ObjUtils.isUnset(m)||m>O)&&(m=O),O<=0))break}return O}(0,n,o,i,a,h,p),{bondOrders:h,previewBondOrders:p}}}}),d.Editor.IaControllerManager.register(d.Editor.MolRingIaController,d.Editor.ChemSpaceEditor),d.Editor.PathGlyphIaController=Class.create(d.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.PathGlyphIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},getDirectManipulateObjs:function(e,t){if(1===e.length){var r=e[0];if(r.getNodeAt&&r.getNodeCount&&(r.getNodeCount(),r.getDirectManipulationTarget))return r.getDirectManipulationTarget()}return this.tryApplySuper("getDirectManipulateObjs",[e,t])},getInsertedObjs:function(){return this.getCurrRepositoryObjects()}}),d.Editor.ArrowLineIaController=Class.create(d.Editor.PathGlyphIaController,{CLASS_NAME:"Kekule.Editor.ArrowLineIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setRepositoryItem(new d.Editor.PathGlyphRepositoryItem2D)},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT,getter:function(){return this.getRepositoryItem().getGlyphRefLength()},setter:function(e){this.getRepositoryItem().setGlyphRefLength(e)}}),this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:!1,getter:function(){return this.getRepositoryItem().getGlyphClass()},setter:function(e){this.getRepositoryItem().setGlyphClass(e)}}),this.defineProp("glyphInitialParams",{dataType:DataType.HASH,getter:function(){return this.getRepositoryItem().getGlyphInitialParams()},setter:function(e){this.getRepositoryItem().setGlyphInitialParams(e)}})},getInitManipulationType:function(){return d.Editor.BasicManipulationIaController.ManipulationType.MOVE},addRepositoryObj:function(e,t,r){return this.getRepositoryItem().setGlyphRefLength(this.getEditor().getChemSpace().getDefAutoScaleRefLength()),this.tryApplySuper("addRepositoryObj",[e,t,r])}}),d.Editor.IaControllerManager.register(d.Editor.ArrowLineIaController,d.Editor.ChemSpaceEditor),d.Editor.FormulaIaController=Class.create(d.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.FormulaIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._operAddMol=null},initProperties:function(){this.defineProp("currMol",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:!1})},canInteractWithObj:function(e){return!(!e||!this.isValidMol(e))},isValidMol:function(e){return e instanceof d.StructureFragment&&e.hasFormula()&&!e.hasCtab()},getFormulaText:function(e){return e.hasFormula()?e.getFormula().getText():""},createNewMol:function(e,t){var r=this.getEditor();if(!r.canCreateNewChild()&&!(n=r.getOnlyOneBlankStructFragment()))return null;r.beginUpdateObject();try{if(!n)var n=new d.Molecule;n.getFormula(!0),e.appendChild(n),r.setObjectScreenCoord(n,t);var i=new d.ChemObjOperation.Add(n,e,null,r);this._operAddBlock=i}finally{r.endUpdateObject()}return n},getTextSetterWidget:function(e){var t=this.getTextSetter();if(!t&&e){var r=this.getEditor().getCoreElement(),n=r.ownerDocument;t=this._createTextSetterWidget(n,r),this.setTextSetter(t)}return t},_createTextSetterWidget:function(e,t){var n=new d.Widget.TextBox(this.getEditor());n.addClassName(r.CHEMEDITOR_FORMULA_SETTER),n.appendToElem(t);var i=this;return n.addEventListener("keyup",(function(e){var t=e.htmlEvent.getKeyCode();t===d.X.Event.KeyCode.ENTER?(i.applySetter(n),n.dismiss()):t===d.X.Event.KeyCode.ESC&&(n.dismiss(),i.cancelSetter())})),n.addEventListener("showStateChange",(function(e){e.byDomChange||(e.isShown||e.isDismissed||i.applySetter(n),e.isShown&&(n._applied=!1))})),n},cancelSetter:function(){this._operAddBlock&&(this._operAddBlock.reverse(),this._operAddBlock=null)},applySetter:function(e,t){if(!e._applied){t||(t=this.getCurrMol());var r=e.getText();if(r)var n=new d.ChemObjOperation.Modify(t.getFormula(),{text:r},this.getEditor());else this._operAddBlock?this.cancelSetter():n=new d.ChemObjOperation.Remove(t,t.getParent(),null,this.getEditor());var i=this.getEditor();if(i&&n){i.beginManipulateAndUpdateObject();try{if(n.execute(),i.getEnableOperHistory()){if(this._operAddBlock){var o=new d.MacroOperation;o.add(this._operAddBlock),o.add(n),i.pushOperation(o),this._operAddBlock=null}else i.pushOperation(n);this.doneInsertOrModifyBasicObjects([t])}}finally{i.endManipulateAndUpdateObject()}}e._applied=!0}},openSetterUi:function(e,t){var r=this.getTextSetter();if(r&&r.isShown()&&(this.applySetter(r,this.getCurrMol()),r.hide(),r._haltPrevShowHideProcess()),t||(t=this.createNewMol(this.getEditor().getChemObj(),e)),this.isValidMol(t)){this.setCurrMol(t),this.getEditor().setSelection([t]);var n=t.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();n*=this.getEditor().getZoom()||1;var i=t.getCascadedRenderOption("fontFamily")||"",o=this.getFormulaText(t),a=this.getTextSetterWidget(!0),s=this.getEditor().getCoreElement();a.appendToElem(s);var l=o||"";a.setValue(l);var u=a.getElement().style;u.position="absolute",u.fontSize=n+"px",u.left=e.x+"px",u.top=e.y+"px",u.fontFamily=i,a._applied=!1,a.setStandaloneOnShowHide(!0),a.show(this.getEditor(),null,d.Widget.ShowHideType.POPUP),a.selectAll(),a.focus()}},react_pointerup:function(e){if(e.getButton()===d.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var t,r=this._getEventMouseCoord(e),n=this.getTopmostInteractableObjAtScreenCoord(r);t=n;var i,o=n&&this.getEditor().getChemObjBounds(n),a=o&&o[0];return i=a&&a.boundInfo?a.boundInfo.coords[0]:r,e.preventDefault(),e.stopPropagation(),this.openSetterUi(i,t),!0}}}),d.Editor.IaControllerManager.register(d.Editor.FormulaIaController,d.Editor.ChemSpaceEditor),d.Editor.ContentBlockIaController=Class.create(d.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.ContentBlockIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("currBlock",{dataType:DataType.OBJECT,serializable:!1})},canInteractWithObj:function(e){return e&&this.isValidBlock(e)},isValidBlock:function(e){return e instanceof d.ContentBlock},execute:function(e,t,r){},react_pointerup:function(e){if(e.getButton()===d.X.Event.MouseButton.LEFT){this.getEditor().setSelection(null);var t=this._getEventMouseCoord(e),r=this.getTopmostInteractableObjAtScreenCoord(t),n=r?this.getEditor().getObjectScreenCoord(r):t;return e.preventDefault(),e.stopPropagation(),this.execute(this.getEditor().getChemObj(),n,r),!0}}}),d.Editor.TextBlockIaController=Class.create(d.Editor.ContentBlockIaController,{CLASS_NAME:"Kekule.Editor.TextBlockIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._operAddBlock=null},initProperties:function(){this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:!1})},isValidBlock:function(e){return e instanceof d.TextBlock},createNewBlock:function(e,t){var r=this.getEditor();if(!r.canCreateNewChild())return null;r.beginUpdateObject();try{var n=new d.TextBlock;if(n){e.appendChild(n),r.setObjectScreenCoord(n,t,d.Render.CoordPos.CORNER_TL);var i=new d.ChemObjOperation.Add(n,e,null,r);this._operAddBlock=i}}finally{r.endUpdateObject()}return n},getBlockText:function(e){return e.getText()},execute:function(e,t,r){this.openSetterUi(t,r)},getTextSetterWidget:function(e){var t=this.getTextSetter();if(!t&&e){var r=this.getEditor().getCoreElement(),n=r.ownerDocument;t=this._createTextSetterWidget(n,r),this.setTextSetter(t)}return t},_createTextSetterWidget:function(e,t){var n=new d.Widget.TextArea(this.getEditor());n.setAutoSizeX(!0),n.setAutoSizeY(!0),n.setDisplayed(!1),n.addClassName(r.CHEMEDITOR_TEXT_SETTER),n.appendToElem(t);var i=this;return n.addEventListener("keyup",(function(e){var t=e.htmlEvent,r=t.getKeyCode();r===d.X.Event.KeyCode.ENTER&&t.getCtrlKey()?(i.applySetter(n),n.dismiss()):r===d.X.Event.KeyCode.ESC&&(n.dismiss(),i.cancelSetter())})),n.addEventListener("showStateChange",(function(e){e.byDomChange||(e.isShown||e.isDismissed||i.applySetter(n),e.isShown&&(n._applied=!1))})),n},cancelSetter:function(){this._operAddBlock&&(this._operAddBlock.reverse(),this._operAddBlock=null)},applySetter:function(e,t){if(!e._applied){t||(t=this.getCurrBlock());var r,n=e.getText();n?r=new d.ChemObjOperation.Modify(t,{text:n},this.getEditor()):this._operAddBlock?this.cancelSetter():r=new d.ChemObjOperation.Remove(t,t.getParent(),null,this.getEditor());var i=this.getEditor();if(r&&i){i.beginManipulateAndUpdateObject();try{if(r.execute(),i.getEnableOperHistory())if(this._operAddBlock){var o=new d.MacroOperation;o.add(this._operAddBlock),o.add(r),i.pushOperation(o),this._operAddBlock=null}else i.pushOperation(r)}finally{i.endManipulateAndUpdateObject()}this.doneInsertOrModifyBasicObjects([t])}e._applied=!0}},openSetterUi:function(e,t){var r=this.getTextSetter();if(r&&r.isShown()&&(this.applySetter(r,this.getCurrBlock()),r._haltPrevShowHideProcess()),t||(t=this.createNewBlock(this.getEditor().getChemObj(),e)),this.isValidBlock(t)){this.setCurrBlock(t);var n=this.getEditor().getObjectScreenCoord(t,d.Render.CoordPos.CORNER_TL),i=t.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();i*=this.getEditor().getZoom()||1;var o=t.getCascadedRenderOption("fontFamily")||"",a=this.getBlockText(t),s=this.getTextSetterWidget(!0);s._applied=!1,s.setValue(a);var l=a||d.$L("ChemWidgetTexts.CAPTION_TEXTBLOCK_INIT");s.setPlaceholder(l);var u=this.getEditor().getCoreElement();s.appendToElem(u);var c=s.getElement().style;c.position="absolute",c.fontSize=i+"px",c.left=n.x+"px",c.top=n.y+"px",c.fontFamily=o,c.opacity=1,s.setStandaloneOnShowHide(!0),s.show(this.getEditor(),null,d.Widget.ShowHideType.POPUP),function(){s.selectAll(),s.focus()}.defer()}}}),d.Editor.IaControllerManager.register(d.Editor.TextBlockIaController,d.Editor.ChemSpaceEditor),d.Editor.ImageBlockIaController=Class.create(d.Editor.ContentBlockIaController,{CLASS_NAME:"Kekule.Editor.ImageBlockIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this._operAddBlock=null,this._imgProbeElem=null,this._actionOpenFile=this.createOpenAction()},doFinalize:function(){this._actionOpenFile&&this.actionOpenFile.finalize()},initProperties:function(){},isValidBlock:function(e){return e instanceof d.ImageBlock},createNewBlock:function(e,t,r,n){var i=this.getEditor();if(!i.canCreateNewChild())return null;i.beginUpdateObject();try{var o=new d.ImageBlock;n&&o.setSrc(n),r&&o.setSize2D(r),i.setObjectScreenCoord(o,t,d.Render.CoordPos.CORNER_TL);var a=new d.ChemObjOperation.Add(o,e,null,i);this._operAddBlock=a}finally{i.endUpdateObject()}return o},_getImgFilters:function(){return[{title:d.$L("WidgetTexts.TITLE_IMG_FORMAT_PNG"),filter:".png"},{title:d.$L("WidgetTexts.TITLE_IMG_FORMAT_JPG"),filter:".jpg,.jpeg"},{title:d.$L("WidgetTexts.TITLE_IMG_FORMAT_GIF"),filter:".gif"},{title:d.$L("WidgetTexts.TITLE_IMG_FORMAT_SVG"),filter:".svg"},d.NativeServices.FILTER_ALL_SUPPORT,d.NativeServices.FILTER_ANY]},createOpenAction:function(){var e=new d.ActionFileOpen;return e.setFilters(this._getImgFilters()),e.on("open",this.reactImageFileOpen,this),e},reactImageFileOpen:function(e){var t=e.file;if(t){var r=this,n=new FileReader;n.addEventListener("load",(function(){var e=r._getImageProbeElem();e.ownerDocument;try{delete e.width,delete e.height}catch(e){}e.src=n.result;var t=r.getEditor();(function(){if((l={x:e.width,y:e.height}).x<=0||l.y<=0)d.error(d.$L("ErrorMsg.INVALID_OR_EMPTY_IMAGE"));else{var i=r._currCoord,o=t.objCoordToContext(i),a=d.CoordUtils.add(o,l),s=t.contextCoordToObj(a),l=d.CoordUtils.substract(s,i);l=d.CoordUtils.absValue(l);var u,c=r.getCurrBlock(),h=t.getChemObj();if(c)u=new d.ChemObjOperation.Modify(c,{src:n.result,size2D:l});else{var p=r.createNewBlock(r.getEditor().getChemObj(),r._currCoord,l,n.result);r.setCurrBlock(p),u=new d.ChemObjOperation.Add(p,h,null,t)}if(u){t.beginManipulateAndUpdateObject();try{u.execute(),t&&t.getEnableOperHistory()&&t.pushOperation(u),r.doneInsertOrModifyBasicObjects([r.getCurrBlock()])}finally{t.endManipulateAndUpdateObject()}}}}).defer()})),n.readAsDataURL(t)}},_getImageProbeElem:function(){if(!this._imgProbeElem){var e=this.getEditor().getElement().ownerDocument;this._imgProbeElem=e.createElement("img")}return this._imgProbeElem},execute:function(e,t,r){this.setCurrBlock(r),this._currCoord=t,this._actionOpenFile.execute(this.getEditor())}}),d.Editor.IaControllerManager.register(d.Editor.ImageBlockIaController,d.Editor.ChemSpaceEditor),d.Editor.AttachedMarkerIaController=Class.create(d.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.AttachedMarkerIaController",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("markerClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("targetClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("markerClassName",{dataType:DataType.STRING,getter:function(){return ClassEx.getClassName(this.getMarkerClass())},setter:function(e){this.setMarkerClass(ClassEx.findClass(e))}}),this.defineProp("targetClassName",{dataType:DataType.STRING,getter:function(){return ClassEx.getClassName(this.getTargetClass())},setter:function(e){this.setTargetClass(ClassEx.findClass(e))}}),this.defineProp("initialPropValues",{dataType:DataType.HASH})},canInteractWithObj:function(e){return this.isValidTarget(e)},isValidTarget:function(e){var t=this.getTargetClass();return e instanceof t||!t},createMarker:function(){var e,t=this.getMarkerClass();if(t){e=new t;var r=this.getInitialPropValues();r&&e&&e.setPropValues&&e.setPropValues(r)}return e},createOperations:function(e){var t,r=this.createMarker();return r&&(t=new d.ChemObjOperation.Add(r,e,null,this.getEditor())),[t]},apply:function(e){var t=this.createOperations(e),r=t.length<=0?null:1===t.length?t[0]:new d.MacroOperation(t);if(r){r.execute();var n=this.getEditor();n&&n.getEnableOperHistory()&&n.pushOperation(r)}},react_pointerup:function(e){if(e.getButton()===d.X.Event.MouseButton.LEFT){var t=this._getEventMouseCoord(e),r=this.getEditor().getTopmostBoundInfoAtCoord(t,null,this.getCurrBoundInflation());if(r){var n=r.obj;return this.isValidTarget(n)&&(this.apply(n),e.preventDefault(),e.stopPropagation()),!0}}}}),d.Editor.IaControllerManager.register(d.Editor.AttachedMarkerIaController,d.Editor.ChemSpaceEditor),d.Editor.MolNodeChargeIaController=Class.create(d.Editor.AttachedMarkerIaController,{CLASS_NAME:"Kekule.Editor.MolNodeChargeIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setChargeInc(1)},initProperties:function(){this.defineProp("chargeInc",{dataType:DataType.NUMBER,serializable:!1}),this.defineProp("charge",{dataType:DataType.NUMBER,serializable:!1}),this.defineProp("radical",{dataType:DataType.INT,serializable:!1}),this.defineProp("currNode",{dataType:DataType.OBJECT,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setTargetClass(d.ChemStructureNode)},createOperations:function(e){var t=!1,r=!1,n={},i=e.getCharge();d.ObjUtils.notUnset(this.getCharge())?i!==this.getCharge()&&(n.charge=this.getCharge(),t=!0):this.getChargeInc()&&(i+=this.getChargeInc(),n.charge=i,t=!0);var o=e.getRadical();this.getRadical()!==o&&(n.radical=this.getRadical(),r=!0);var a,s,l=[],u=[],c=this.getEditor();if(t){var h=e.fetchChargeMarker(!1);0===n.charge||h||((a=new d.ChemMarker.Charge).setValue(n.charge),u.push(new d.ChemObjOperation.Add(a,e,null,c))),0===n.charge&&h&&u.push(new d.ChemObjOperation.Remove(h,null,null,c))}if(r){var p=e.fetchRadicalMarker(!1);0===n.radical||p||((a=new d.ChemMarker.Radical).setValue(n.radical),u.push(new d.ChemObjOperation.Add(a,e,null,c))),0===n.radical&&p&&u.push(new d.ChemObjOperation.Remove(p,null,null,c))}return l=l.concat(u),(t||r)&&(s=new d.ChemObjOperation.Modify(e,n,this.getEditor()),l.push(s)),l}}),d.Editor.IaControllerManager.register(d.Editor.MolNodeChargeIaController,d.Editor.ChemSpaceEditor)}(),function(){"use strict";d.Editor.EditorNexus=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.EditorNexus",initialize:function(e){this.tryApplySuper("initialize"),this._currInvoker=null,e&&(e.editor&&this.setEditor(e.editor),e.structureTreeView&&this.setStructureTreeView(e.structureTreeView),e.objectInspector&&this.setObjectInspector(e.objectInspector),e.issueInspector&&this.setIssueInspector(e.issueInspector))},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("editor");this.setPropStoreFieldValue("editor",e),this.editorChanged(e,t)}}),this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("structureTreeView");this.setPropStoreFieldValue("structureTreeView",e),this.structureTreeViewChanged(e,t)}}),this.defineProp("objectInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("objectInspector");this.setPropStoreFieldValue("objectInspector",e),this.objectInspectorChanged(e,t)}}),this.defineProp("issueInspector",{dataType:"Kekule.Editor.IssueInspector",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("issueInspector");this.setPropStoreFieldValue("issueInspector",e),this.issueInspectorChanged(e,t)}})},editorChanged:function(e,t){t&&this._uninstallEditorEventHandler(t),e&&this._installEditorEventHandler(e)},structureTreeViewChanged:function(e,t){t&&this._uninstallStructureTreeViewEventHandler(t),e&&(this._installStructureTreeViewEventHandler(e),this._updateByEditor())},objectInspectorChanged:function(e,t){var r=this.getEditor();r&&(t&&t.getOperHistory()===r.getOperHistory()&&t.setOperHistory(null),e&&(e.setOperHistory(r.getOperHistory()),e.setEnableOperHistory(r.getEnableOperHistory()),this._updateByEditor()))},issueInspectorChanged:function(e,t){t&&this._uninstallIssueInspectorEventHandler(t),e&&this._installIssueInspectorEventHandler(e),this.getEditor()&&e&&this._updateByEditor()},_installEditorEventHandler:function(e){e.addEventListener("change",this._reactEditorChanged,this),e.addEventListener("beginUpdateObject",this._reactEditorBeginUpdateObject,this),e.addEventListener("endUpdateObject",this._reactEditorEndUpdateObject,this)},_uninstallEditorEventHandler:function(e){e.removeEventListener("change",this._reactEditorChanged,this),e.removeEventListener("beginUpdateObject",this._reactEditorBeginUpdateObject,this),e.removeEventListener("endUpdateObject",this._reactEditorEndUpdateObject,this)},_installStructureTreeViewEventHandler:function(e){e.addEventListener("change",this._reactStructureTreeViewChanged,this)},_uninstallStructureTreeViewEventHandler:function(e){e.removeEventListener("change",this._reactStructureTreeViewChanged,this)},_installIssueInspectorEventHandler:function(e){e.addEventListener("selectResult",this._reactIssueInspectorSelectResult,this)},_uninstallIssueInspectorEventHandler:function(e){e.removeEventListener("selectResult",this._reactIssueInspectorSelectResult,this)},_reactEditorChanged:function(e){if(!this._currInvoker){var t=e.target;if(t===this.getEditor()){var r=e.changedPropNames;if(r.indexOf("chemObj")>=0&&this.changeRootObj(t.getChemObj(),t),r.indexOf("selection")>=0&&this.changeSelection(t.getSelection(),t),r.indexOf("operHistory")>=0||r.indexOf("enableOperHistory")>=0){var n=this.getObjectInspector();n&&(n.setOperHistory(t.getOperHistory()),n.setEnableOperHistory(t.getEnableOperHistory()))}var i=this.getIssueInspector();i&&(r.indexOf("issueCheckExecutor")>=0&&i.setIssueCheckExecutor(t.getIssueCheckExecutor()),r.indexOf("issueCheckResults")>=0&&i.setCheckResults(t.getIssueCheckResults()))}}},_reactEditorBeginUpdateObject:function(e){this.pauseLiveUpdate()},_reactEditorEndUpdateObject:function(e){this.resumeLiveUpdate()},_updateByEditor:function(){this._reactEditorChanged({target:this.getEditor(),changedPropNames:["chemObj","selection","operHistory","issueCheckExecutor","issueCheckResults"]})},_reactStructureTreeViewChanged:function(e){if(!this._currInvoker){var t=e.target;if(t===this.getStructureTreeView()&&e.changedPropNames.indexOf("selection")>=0){var r=t.getSelectedChemObjs();this.changeSelection(r,t)}}},_reactIssueInspectorSelectResult:function(e){var t=e.selectedResult,r=this.getEditor();r&&r.setActiveIssueCheckResult&&r.setActiveIssueCheckResult(t)},pauseLiveUpdate:function(){var e=this.getStructureTreeView();e&&e.pauseLiveUpdate()},resumeLiveUpdate:function(){var e=this.getStructureTreeView();e&&e.resumeLiveUpdate()},changeSelection:function(e,t){this._currInvoker=t;try{var r=this.getEditor();r&&this._currInvoker!==r&&r.setSelection(e);var n=this.getStructureTreeView();n&&this._currInvoker!==n&&n.selectChemObjs(e);var i=this.getObjectInspector();i&&this._currInvoker!==i&&i.setObjects(e)}finally{this._currInvoker=null}},changeRootObj:function(e,t){this._currInvoker=t;try{var r=this.getEditor();r&&this._currInvoker!==r&&r.setChemObj(e);var n=this.getStructureTreeView();n&&this._currInvoker!==n&&n.setRootObj(e);var i=this.getIssueInspector();i&&this._currInvoker!==i&&i.setRootObj(e)}finally{this._currInvoker=null}}})}(),function(){"use strict";var e=d.ArrayUtils,t=d.ChemWidget.ComponentWidgetNames,r=d.ChemWidget.HtmlClassNames,n=(d.ActionManager,[]);d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{ACTION_UNDO:"K-Chem-Undo",ACTION_REDO:"K-Chem-Redo",ACTION_NEWDOC:"K-Chem-NewDoc",ACTION_SELECT_ALL:"K-Chem-SelectAll",ACTION_CLONE_SELECTION:"K-Chem-Clone-Selection",ACTION_COPY:"K-Chem-Copy",ACTION_CUT:"K-Chem-Cut",ACTION_PASTE:"K-Chem-Paste",ACTION_TOGGLE_SELECT:"K-Chem-Toggle-Select-State",ACTION_ERASE_SELECTION:"K-Chem-Erase-Selection",ACTION_RECHECK_ISSUES:"K-Chem-Recheck-Issues",ACTION_TOGGLE_OBJ_INSPECTOR:"K-Chem-Toggle-ObjInspector",ACTION_TOGGLE_ISSUE_INSPECTOR:"K-Chem-Toggle-IssueInspector",ACTION_TOGGLE_SHOW_ISSUES:"K-Chem-Toggle-ShowIssues"}),Object.extend(d.ChemWidget.ComponentWidgetNames,{manipulateMarquee:"manipulateMarquee",manipulateLasso:"manipulateLasso",manipulateBrush:"manipulateBrush",manipulateAncestor:"manipulateAncestor",molBondSingle:"bondSingle",molBondDouble:"bondDouble",molBondTriple:"bondTriple",molBondCloser:"bondCloser",molBondWedgeUp:"bondWedgeUp",molBondWedgeDown:"bondWedgeDown",molBondWedgeUpOrDown:"bondWedgeUpOrDown",molBondDoubleEither:"bondDoubleEither",molChargeClear:"chargeClear",molChargePositive:"chargePositive",molChargeNegative:"chargeNegative",molRadicalSinglet:"radicalSinglet",molRadicalTriplet:"radicalTriplet",molRadicalDoublet:"radicalDoublet",molElectronLonePair:"electronLonePair",molChain:"chain",molRing3:"ring3",molRing4:"ring4",molRing5:"ring5",molRing6:"ring6",molRing7:"ring7",molRing8:"ring8",molRingAr6:"ringAr6",molRingAr5:"ringAr5",molFlexRing:"flexRing",molRepCyclopentaneHaworth1:"repCyclopentaneHaworth1",molRepCyclopentaneHaworth2:"repCyclopentaneHaworth2",molRepCyclohexaneHaworth1:"repCyclohexaneHaworth1",molRepCyclohexaneHaworth2:"repCyclohexaneHaworth2",molRepCyclohexaneChair1:"repCyclohexaneChair1",molRepCyclohexaneChair2:"repCyclohexaneChair2",molRepSubBondMark:"subBondMark",molRepMethane:"methane",molRepFischer1:"repFischer1",molRepFischer2:"repFischer2",molRepFischer3:"repFischer3",molRepSawhorseStaggered:"repSawhorseStaggered",molRepSawhorseEclipsed:"repSawhorseEclipsed",glyphRepLine:"repLine",glyphRepOpenArrowLine:"repOpenArrowLine",glyphRepTriangleArrowLine:"repTriangleArrowLine",glyphRepDiOpenArrowLine:"repDiOpenArrowLine",glyphRepDiTriangleArrowLine:"repDiTriangleArrowLine",glyphRepReversibleArrowLine:"repReversibleArrowLine",glyphRepOpenArrowDiLine:"repOpenArrowDiLine",glyphRepOpenArrowArc:"repOpenArrowArc",glyphRepSingleSideOpenArrowArc:"repSingleSideOpenArrowArc",glyphRepHeatSymbol:"repHeatSymbol",glyphRepAddSymbol:"repAddSymbol",glyphElectronPushingArrow:"repElectronPushingArrow",glyphElectronPushingArrowDouble:"repElectronPushingArrowDouble",glyphElectronPushingArrowSingle:"repElectronPushingArrowSingle",glyphElectronPushingArrowBondForming:"repElectronPushingArrowBondForming",glyphRepSegment:"repGlyphSegment",glyphReactionArrowNormal:"repGlyphReactionArrowNormal",glyphReactionArrowReversible:"glyphReactionArrowReversible",glyphReactionArrowResonance:"glyphReactionArrowResonance",glyphReactionArrowRetrosynthesis:"glyphReactionArrowRetrosynthesis"}),d.Editor.ActionOperUtils={getObjsCenterScreenCoord:function(e,t){for(var r=d.BoxUtils,n=d.CoordUtils,i=null,o=0,a=t.length;o<a;++o){var s=d.Render.ObjUtils.getContainerBox(t[o],e.getCoordMode(),e.getAllowCoordBorrow());i=i?r.getContainerBox(s,i):s}var l=r.getMinMaxCoords(i),u={min:e.objCoordToScreen(l.min),max:e.objCoordToScreen(l.max)},c=n.add(u.min,u.max);return n.divide(c,2)},addObjectsToChemSpaceEditor:function(t,r,n){var i,o,a,s=Object.extend({autoAdjustPosition:!0},n),l=t.getChemSpace&&t.getChemSpace();if(t&&l&&t.canAddNewStandaloneObject&&t.canAddNewStandaloneObject()){for(var u=[],c=0,h=r.length;c<h;++c){var p=(i=r[c],o=void 0,a=void 0,o=[],(a=l)&&i&&(o=i.getClass()===a.getClass()||i instanceof d.ChemSpace?e.clone(i.getChildren()):[i]),o);p&&p.length&&e.pushUnique(u,p)}t.beginManipulateAndUpdateObject();try{var g=new d.MacroOperation;for(c=0,h=u.length;c<h;++c){var f=u[c],m=new d.ChemObjOperation.Add(f,l,null,t);g.add(m)}g.execute();var C=s.screenCoordOffset;if(!C&&s.autoAdjustPosition){var y=t.getClientVisibleRect(),_={x:y.left+y.width/2,y:y.top+y.height/2},E=this.getObjsCenterScreenCoord(t,u);C=d.CoordUtils.substract(_,E)}if(C)for(c=0,h=u.length;c<h;++c){f=u[c];var T=t.getObjectScreenCoord(f),O=d.CoordUtils.add(T,C);t.setObjectScreenCoord(f,O)}t.pushOperation(g),s.autoSelect&&t.select(u)}finally{t.endManipulateAndUpdateObject()}}}},d.Editor.ActionOnEditor=Class.create(d.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.Editor.ActionOnEditor",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},initProperties:function(){this.defineProp("explicitGroup",{dataType:DataType.STRING})},getPreferredWidgetClass:function(){return null},doUpdate:function(){var e=this.getDisplayer();this.setEnabled(e&&e.getChemObj()&&e.getChemObjLoaded()&&e.getEnabled())},getEditor:function(){var e=this.getDisplayer();return e instanceof d.Editor.BaseEditor?e:null}}),d.Editor.ActionEditorUndo=Class.create(d.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorUndo",HTML_CLASSNAME:r.ACTION_UNDO,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_UNDO"),d.$L("ChemWidgetTexts.HINT_UNDO")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().getEnableOperHistory()&&this.getEditor().canUndo())},doExecute:function(){var e=this.getEditor();e&&e.undo()}}),d.Editor.ActionEditorRedo=Class.create(d.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorRedo",HTML_CLASSNAME:r.ACTION_REDO,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_REDO"),d.$L("ChemWidgetTexts.HINT_REDO")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().getEnableOperHistory()&&this.getEditor().canRedo())},doExecute:function(){var e=this.getEditor();e&&e.redo()}}),d.Editor.ActionEditorNewDoc=Class.create(d.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorNewDoc",HTML_CLASSNAME:r.ACTION_NEWDOC,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_NEWDOC"),d.$L("ChemWidgetTexts.HINT_NEWDOC")])},doUpdate:function(){var e=this.getDisplayer();this.setEnabled(e&&e.getEnabled()&&e.getEnableCreateNewDoc())},doExecute:function(){var e=this.getEditor();e&&e.newDoc()}}),d.Editor.ActionEditorLoadData=Class.create(d.ChemWidget.ActionDisplayerLoadData,{CLASS_NAME:"Kekule.Editor.ActionEditorLoadData",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("enableAppend",{dataType:DataType.BOOL})},doExecute:function(e){var t=this.getDataDialog();return t&&t.setDisplayAppendCheckBox&&t.setDisplayAppendCheckBox(this._isEditorRootObjAppendable()&&!this._isEditorEmpty()),this.tryApplySuper("doExecute",[e])},_getEditorRootObj:function(){return this.getDisplayer().getChemObj()},_isEditorRootObjAppendable:function(){var e=this.getDisplayer(),t=this._getEditorRootObj();return t&&t instanceof d.ChemSpace&&e.canAddNewStandaloneObject&&e.canAddNewStandaloneObject()&&e.getAllowAppendDataToCurr&&e.getAllowAppendDataToCurr()},_isEditorEmpty:function(){var e=this._getEditorRootObj();return!e||e.getChildCount&&0===e.getChildCount()},createDataDialog:function(){var e=this.getDisplayer().getDocument();return new d.ChemWidget.LoadOrAppendDataDialog(e)},doLoadToDisplayer:function(e,t){var r=this.getDisplayer();if(!t.getIsAppending()||this._isEditorEmpty()||!this._isEditorRootObjAppendable())return this.tryApplySuper("doLoadToDisplayer",[e,t]);r.beginUpdateObject();try{var n=this._getEditorRootObj();n.beginUpdate();try{d.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(r,[e],{autoSelect:!0})}finally{n.endUpdate()}}finally{r.endUpdateObject()}}}),d.Editor.ActionSelectAll=Class.create(d.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionSelectAll",HTML_CLASSNAME:r.ACTION_SELECT_ALL,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_SELECT_ALL"),d.$L("ChemWidgetTexts.HINT_SELECT_ALL")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().getChemObj())},doExecute:function(){this.getEditor().selectAll()}}),d.Editor.ActionCloneSelection=Class.create(d.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCloneSelection",HTML_CLASSNAME:r.ACTION_CLONE_SELECTION,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_CLONE_SELECTION"),d.$L("ChemWidgetTexts.HINT_CLONE_SELECTION")])},_hasCloneMethod:function(){var e=this.getEditor();return e&&e.cloneSelection},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this._hasCloneMethod()&&this.getEditor().hasSelection()),this.setDisplayed(this._hasCloneMethod()&&this.getEditor().canCloneObjects())},doExecute:function(){var e=this.getEditor();if(e&&e.getChemSpace){var t=e.getDefaultCloneScreenCoordOffset&&e.getDefaultCloneScreenCoordOffset(),r=e.cloneSelection();d.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(e,r,{screenCoordOffset:t,autoSelect:!0})}}}),d.Editor.ActionCopySelection=Class.create(d.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCopySelection",HTML_CLASSNAME:r.ACTION_COPY,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_COPY"),d.$L("ChemWidgetTexts.HINT_COPY")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().hasSelection())},doExecute:function(){var e=this.getEditor(),t=e.getChemSpace&&e.getChemSpace();if(e&&t){var r=e.cloneSelection(),n=new d.IntermediateChemSpace;try{n.appendChildren(r),d.Widget.clipboard.setObjects(d.IO.MimeType.JSON,[n])}finally{n.finalize()}}}}),d.Editor.ActionCutSelection=Class.create(d.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCutSelection",HTML_CLASSNAME:r.ACTION_CUT,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_CUT"),d.$L("ChemWidgetTexts.HINT_CUT")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().hasSelection())},doExecute:function(){var e=this.getEditor(),t=e.getChemSpace&&e.getChemSpace();if(e&&t){var r=e.cloneSelection(),n=new d.IntermediateChemSpace;try{n.appendChildren(r),d.Widget.clipboard.setObjects(d.IO.MimeType.JSON,[n])}finally{n.finalize()}var i=e.getIaController("BasicMolEraserIaController");i&&i.removeSelection()}}}),d.Editor.ActionPaste=Class.create(d.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionPaste",HTML_CLASSNAME:r.ACTION_PASTE,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_PASTE"),d.$L("ChemWidgetTexts.HINT_PASTE")]),d.Widget.clipboard.addEventListener("setData",this._reactClipboardChange,this)},finalize:function(){d.Widget.clipboard.removeEventListener("setData",this._reactClipboardChange,this),this.tryApplySuper("finalize")},_reactClipboardChange:function(){this.update()},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(d.Widget.clipboard.hasData(d.IO.MimeType.JSON)&&this.getEditor().canAddNewStandaloneObject())},getObjsCenterScreenCoord:function(e,t){return d.Editor.ActionOperUtils.getObjsCenterScreenCoord(e,t)},doExecute:function(){var t=this.getEditor();if(t&&t.getChemSpace){var r,n,i=d.Widget.clipboard.getObjects(d.IO.MimeType.JSON);1===i.length&&i[0]instanceof d.IntermediateChemSpace?(r=i[0],n=e.clone(r.getChildren()),r.removeChildren(n)):n=i,r&&r.finalize();var o=null,a=t.getSelection();if(a&&a.length){o=t.getDefaultCloneScreenCoordOffset?t.getDefaultCloneScreenCoordOffset():null;var s=e.clone(a);if(s&&s.length&&o){var l=this.getObjsCenterScreenCoord(t,s),u=this.getObjsCenterScreenCoord(t,n),c=d.CoordUtils.substract(l,u);o=d.CoordUtils.add(o,c)}}d.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(t,n,{screenCoordOffset:o,autoSelect:!0})}}}),d.Editor.ActionToggleSelectState=Class.create(d.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionToggleSelectState",HTML_CLASSNAME:r.ACTION_TOGGLE_SELECT,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_TOGGLE_SELECT"),d.$L("ChemWidgetTexts.HINT_TOGGLE_SELECT")]),this.setExplicitGroup("")},getPreferredWidgetClass:function(){return d.Widget.CheckButton},doUpdate:function(){this.tryApplySuper("doUpdate"),this.setChecked(this.getEditor().getIsToggleSelectOn())},checkedChanged:function(){this.tryApplySuper("checkedChanged")},doExecute:function(e,t){this.tryApplySuper("doExecute",[e,t]);var r=this.getChecked();this.getEditor().setIsToggleSelectOn(!r),this.setChecked(!r)}}),d.Editor.ActionEraseSelection=Class.create(d.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEraseSelection",HTML_CLASSNAME:r.ACTION_ERASE_SELECTION,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_ERASE_SELECTION"),d.$L("ChemWidgetTexts.HINT_ERASE_SELECTION")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().hasSelection())},doExecute:function(){var e=this.getEditor();if(e){var t=e.getIaController("BasicMolEraserIaController");t&&t.removeSelection()}}}),d.Editor.ActionRecheckIssues=Class.create(d.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionRecheckIssues",HTML_CLASSNAME:r.ACTION_RECHECK_ISSUES,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_RECHECK_ISSUES"),d.$L("ChemWidgetTexts.HINT_RECHECK_ISSUES")])},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getEditor();this.setEnabled(e.getEnableIssueCheck()).setDisplayed(e.getEnableIssueCheck())},doExecute:function(e,t){this.tryApplySuper("doExecute",[e,t]);var r=this.getEditor();r&&r.checkIssues()}}),d.Editor.ActionToggleShowIssueMarkers=Class.create(d.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionToggleShowIssueMarkers",HTML_CLASSNAME:r.ACTION_TOGGLE_SHOW_ISSUES,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_TOGGLE_SHOW_ISSUE_MARKERS"),d.$L("ChemWidgetTexts.HINT_TOGGLE_SHOW_ISSUE_MARKERS")]),this.setExplicitGroup("")},getPreferredWidgetClass:function(){return d.Widget.CheckButton},doUpdate:function(){this.tryApplySuper("doUpdate");var e=this.getEditor();this.setChecked(e.getShowAllIssueMarkers()),this.setEnabled(e.getEnableIssueCheck()).setDisplayed(e.getEnableIssueCheck())},doExecute:function(e,t){this.tryApplySuper("doExecute",[e,t]);var r=this.getChecked();this.getEditor().setShowAllIssueMarkers(!r),this.setChecked(!r)}}),d.Editor.ActionOperationCreate={},d.Editor.ActionOperationCreate.Base=Class.create(d.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.Base",initialize:function(e){this.tryApplySuper("initialize",[e])},applicable:function(e){var t=this.getOperationTargets();if(t&&t.length){for(var r=this.getData(),n=0,i=t.length;n<i;++n)if(this.applicableOnTarget(t[n],r,e))return!0;return!1}return!1},applicableOnTarget:function(e,t,r){return!1},getOperationTargets:function(e){return[]},getData:function(){return this.ACTION_DATA||{}},createOperations:function(e){for(var t=this.getOperationTargets(e),r=this.getData(),n=[],i=0,o=t.length;i<o;++i){var a=t[i];if(this.applicableOnTarget(a,r,e)){var s=this.doCreateOperationOnTarget(a,r,e);s&&n.push(s)}}return n},doCreateOperationOnTarget:function(e,t,r){return null},doExecute:function(){var e=this.getEditor(),t=this.getModificationTargets(e),r=this.createOperations(t,data,e);return!(!r||!r.length)&&(e.execOperations(r),!0)}}),d.Editor.ActionOperationCreate.ChemObjModify=Class.create(d.Editor.ActionOperationCreate.Base,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.ChemObjModify",getOperationTargets:function(e){var t=e.getHotTrackedObjs();return t&&t.length||(t=e.getSelection()),t}}),d.Editor.ActionOperationCreate.ChemNodeModify=Class.create(d.Editor.ActionOperationCreate.ChemObjModify,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.ChemNodeModify",applicableOnTarget:function(e,t,r){return e instanceof d.ChemStructureNode&&!(e instanceof d.Molecule)&&e.getLinkedBonds().length},doCreateOperationOnTarget:function(e,t,r){return d.Editor.OperationUtils.createNodeModificationOperationFromData(e,t,r)}}),d.Editor.ActionOperationCreate.ChemConnectorModify=Class.create(d.Editor.ActionOperationCreate.ChemObjModify,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.ChemConnectorModify",applicableOnTarget:function(e,t,r){return e instanceof d.ChemStructureConnector},doCreateOperationOnTarget:function(e,t,r){return d.ObjUtils.match(e,t)?null:new d.ChemObjOperation.Modify(e,t,r)}}),d.Editor.createEditorOperationCreateActionClass=function(e,t,r,i){var o={};e&&(o.CLASS_NAME="Kekule.Editor.ActionOperationCreate."+e),i&&(o.ACTION_DATA=i);var a=Class.create(r,o);return t&&n.push({name:t,actionClass:a}),a},d.Editor.ActionOnComposer=Class.create(d.Action,{CLASS_NAME:"Kekule.Editor.ActionOnComposer",initialize:function(e,t,r){this.tryApplySuper("initialize"),this.setText(t),this.setHint(r),this.setComposer(e)},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1})},doUpdate:function(){var e=this.getComposer(),t=this.getEditor();this.setEnabled(e&&e.getEnabled()&&t&&t.getChemObj()&&t.getChemObjLoaded()&&t.getEnabled())},getEditor:function(){var e=this.getComposer();return e?e.getEditor():null}}),d.Editor.ActionOnComposerAdv=Class.create(d.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionOnComposerAdv",initialize:function(e,t,r){var n=new d.ActionList;n.setOwnActions(!0),this.setPropStoreFieldValue("attachedActions",n),this.tryApplySuper("initialize",[e,t,r])},finalize:function(){this.getAttachedActions().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("attachedActionClasses",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("attachedActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null}),this.defineProp("defaultAttachedAction",{dataType:"Kekule.Action",serializable:!1})},checkedChanged:function(){this.tryApplySuper("checkedChanged");var e=this.getChecked();if(this.hasAttachedActions()){var t=this.getComposer();if(t)if(e){var r=this.getAttachedActions();t.bindAssocActions(r),t.showAssocToolbar();var n=r.getCheckedAction(this.getClassName());n||(n=this.getDefaultAttachedAction()),n&&(n.setChecked(!1),n.execute())}else t.hideAssocToolbar()}},hasAttachedActions:function(){return!!this.getAttachedActions().getActionCount()},setAttachedActionIndex:function(e,t){var r=this.getAttachedActions();return r&&r.setActionIndex(e,t),this},addAttachedAction:function(e,t){return this.getAttachedActions().add(e),t&&this.setDefaultAttachedAction(e),this},removeAttachedAction:function(e){return this.getDefaultAttachedAction()===e&&this.setDefaultAttachedAction(null),this.getAttachedActions().remove(e),this},clearAttachedActions:function(){this.setDefaultAttachedAction(null),this.getAttachedActions().clear()},doExecute:function(){},update:function(){this.tryApplySuper("update"),this.getAttachedActions().updateAll()}}),d.Editor.ActionComposerToggleObjInspector=Class.create(d.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionComposerToggleObjInspector",HTML_CLASSNAME:r.ACTION_TOGGLE_OBJ_INSPECTOR,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_TOGGLE_OBJ_INSPECTOR"),d.$L("ChemWidgetTexts.HINT_TOGGLE_OBJ_INSPECTOR")])},doUpdate:function(){var e=this.getComposer();e&&this.setChecked(e.getShowObjInspector())},doExecute:function(){var e=this.getComposer();e&&(this.setChecked(!this.getChecked()),e.setShowObjInspector(this.getChecked()))}}),d.Editor.ActionComposerToggleInspector=d.Editor.ActionComposerToggleObjInspector,d.Editor.ActionComposerToggleIssueInspector=Class.create(d.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionComposerToggleIssueInspector",HTML_CLASSNAME:r.ACTION_TOGGLE_ISSUE_INSPECTOR,initialize:function(e){this.tryApplySuper("initialize",[e,d.$L("ChemWidgetTexts.CAPTION_TOGGLE_ISSUE_INSPECTOR"),d.$L("ChemWidgetTexts.HINT_TOGGLE_ISSUE_INSPECTOR")])},doUpdate:function(){var e=this.getComposer();e&&(this.setChecked(e.getShowIssueInspector()),this.setEnabled(e.getEnableIssueCheck()).setDisplayed(e.getEnableIssueCheck()))},doExecute:function(){var e=this.getComposer();e&&(this.setChecked(!this.getChecked()),e.setShowIssueInspector(this.getChecked()))}}),d.Editor.ActionComposerSetIaController=Class.create(d.Editor.ActionOnComposerAdv,{CLASS_NAME:"Kekule.Editor.ActionComposerSetIaController",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e,t,r]),this.setPropStoreFieldValue("iaControllerId",n)},initProperties:function(){this.defineProp("iaControllerId",{dataType:DataType.STRING,serializable:!1,setter:null})},doExecute:function(){this.getEditor().setActiveIaControllerId(this.getIaControllerId())}}),d.Editor.createComposerIaControllerActionClass=function(e,t,r,i,o,a,s,l,u,c){o||(o=i),o.startsWith(d.ChemWidget.HtmlClassNames.PREFIX)||(o=d.ChemWidget.HtmlClassNames.PREFIX+o);var h,p={CLASS_NAME:e,HTML_CLASSNAME:o,initialize:function(e){this.tryApplySuper("initialize",[e,t,r,i]),this.initAttachedActions&&this.initAttachedActions()}};l&&(p=Object.extend(p,l)),a&&(p.doExecute&&(h=p.doExecute),p.doExecute=function(){var e=this.getEditor().getIaController(i);e&&e.setPropValues(a),h?h.apply(this):this.tryApplySuper("doExecute")}),s&&(p.initAttachedActions=function(){this.setPropStoreFieldValue("attachedActionClasses",s)});var g=Class.create(d.Editor.ActionComposerSetIaController,p);return u&&n.push({name:u,actionClass:g,widgetClass:c}),g},d.Editor.ActionComposerClientDragScrollController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerClientDragScrollController",d.$L("ChemWidgetTexts.CAPTION_CLIENT_DRAGSCROLL"),d.$L("ChemWidgetTexts.HINT_CLIENT_DRAGSCROLL"),"ClientDragScrollIaController",null,null,null,null,t.dragScroll),d.Editor.ActionComposerSetManipulateControllerMarquee=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerMarquee",d.$L("ChemWidgetTexts.CAPTION_MANIPULATE_MARQUEE"),d.$L("ChemWidgetTexts.HINT_MANIPULATE_MARQUEE"),"SelectIaController","SelectIaController-Marquee",{enableGestureManipulation:!0,selectMode:d.Editor.SelectMode.RECT},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(d.Editor.SelectMode.RECT)}},t.manipulateMarquee),d.Editor.ActionComposerSetManipulateControllerLasso=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerLasso",d.$L("ChemWidgetTexts.CAPTION_MANIPULATE_LASSO"),d.$L("ChemWidgetTexts.HINT_MANIPULATE_LASSO"),"SelectIaController","SelectIaController-Lasso",{enableGestureManipulation:!0,selectMode:d.Editor.SelectMode.POLYGON},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(d.Editor.SelectMode.POLYGON)}},t.manipulateLasso),d.Editor.ActionComposerSetManipulateControllerBrush=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerBrush",d.$L("ChemWidgetTexts.CAPTION_MANIPULATE_BRUSH"),d.$L("ChemWidgetTexts.HINT_MANIPULATE_BRUSH"),"SelectIaController","SelectIaController-Brush",{enableGestureManipulation:!0,selectMode:d.Editor.SelectMode.POLYLINE},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(d.Editor.SelectMode.POLYLINE)}},t.manipulateBrush),d.Editor.ActionComposerSetManipulateControllerAncestor=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerAncestor",d.$L("ChemWidgetTexts.CAPTION_MANIPULATE_ANCESTOR"),d.$L("ChemWidgetTexts.HINT_MANIPULATE_ANCESTOR"),"SelectIaController","SelectIaController-Ancestor",{enableGestureManipulation:!0,selectMode:d.Editor.SelectMode.ANCESTOR},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(d.Editor.SelectMode.ANCESTOR)}},t.manipulateAncestor),d.Editor.ActionComposerSetManipulateController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateController",d.$L("ChemWidgetTexts.CAPTION_MANIPULATE"),d.$L("ChemWidgetTexts.HINT_MANIPULATE"),"SelectIaController",null,null,[d.Editor.ActionComposerSetManipulateControllerMarquee,d.Editor.ActionComposerSetManipulateControllerLasso,d.Editor.ActionComposerSetManipulateControllerBrush,d.Editor.ActionComposerSetManipulateControllerAncestor,d.Editor.ActionComposerClientDragScrollController,d.Editor.ActionToggleSelectState],null,t.manipulate),d.Editor.ActionComposerSetEraserController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetEraserController",d.$L("ChemWidgetTexts.CAPTION_ERASE"),d.$L("ChemWidgetTexts.HINT_ERASE"),"BasicMolEraserIaController",null,null,null,{doExecute:function(){this.tryApplySuper("doExecute");var e=this.getEditor();e.hasSelection()&&e.getActiveIaController().removeSelection()}},t.erase),d.Editor.ActionComposerSetTrackController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTrackController",d.$L("ChemWidgetTexts.CAPTION_TRACK_INPUT"),d.$L("ChemWidgetTexts.HINT_TRACK_INPUT"),"TrackInputIaController",null,null,null,null,t.trackInput),d.Editor.ActionComposerSetBondControllerSingle=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerSingle",d.$L("ChemWidgetTexts.CAPTION_MOL_BOND_SINGLE"),d.$L("ChemWidgetTexts.HINT_MOL_BOND_SINGLE"),"MolBondIaController","MolBondIaController-Single",{bondType:d.BondType.COVALENT,bondOrder:d.BondOrder.SINGLE,bondStereo:d.BondStereo.NONE},null,null,t.molBondSingle),d.Editor.ActionComposerSetBondControllerDouble=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDouble",d.$L("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),d.$L("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),"MolBondIaController","MolBondIaController-Double",{bondType:d.BondType.COVALENT,bondOrder:d.BondOrder.DOUBLE,bondStereo:d.BondStereo.NONE},null,null,t.molBondDouble),d.Editor.ActionComposerSetBondControllerTriple=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerTriple",d.$L("ChemWidgetTexts.CAPTION_MOL_BOND_TRIPLE"),d.$L("ChemWidgetTexts.HINT_MOL_BOND_TRIPLE"),"MolBondIaController","MolBondIaController-Triple",{bondType:d.BondType.COVALENT,bondOrder:d.BondOrder.TRIPLE,bondStereo:d.BondStereo.NONE},null,null,t.molBondTriple),d.Editor.ActionComposerSetBondControllerCloser=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerCloser",d.$L("ChemWidgetTexts.CAPTION_MOL_BOND_CLOSER"),d.$L("ChemWidgetTexts.HINT_MOL_BOND_CLOSER"),"MolBondIaController","MolBondIaController-Closer",{bondType:d.BondType.COVALENT,bondOrder:d.BondOrder.SINGLE,bondStereo:d.BondStereo.CLOSER},null,null,t.molBondCloser),d.Editor.ActionComposerSetBondControllerWedgeUp=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUp",d.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP"),d.$L("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP"),"MolBondIaController","MolBondIaController-WedgeUp",{bondType:d.BondType.COVALENT,bondOrder:d.BondOrder.SINGLE,bondStereo:d.BondStereo.UP},null,null,t.molBondWedgeUp),d.Editor.ActionComposerSetBondControllerWedgeDown=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeDown",d.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN"),d.$L("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN"),"MolBondIaController","MolBondIaController-WedgeDown",{bondType:d.BondType.COVALENT,bondOrder:d.BondOrder.SINGLE,bondStereo:d.BondStereo.DOWN},null,null,t.molBondWedgeDown),d.Editor.ActionComposerSetBondControllerWedgeUpOrDown=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown",d.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WAVY"),d.$L("ChemWidgetTexts.HINT_MOL_BOND_WAVY"),"MolBondIaController","MolBondIaController-WedgeUpOrDown",{bondType:d.BondType.COVALENT,bondOrder:d.BondOrder.SINGLE,bondStereo:d.BondStereo.UP_OR_DOWN},null,null,t.molBondWedgeUpOrDown),d.Editor.ActionComposerSetBondControllerDoubleEither=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDoubleEither",d.$L("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE_EITHER"),d.$L("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE_EITHER"),"MolBondIaController","MolBondIaController-Double-Either",{bondType:d.BondType.COVALENT,bondOrder:d.BondOrder.DOUBLE,bondStereo:d.BondStereo.E_OR_Z},null,null,t.molBondDoubleEither),d.Editor.ActionComposerSetRepositoryFischer1Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer1Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER1"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer1",{repItemName:"fischer1"},null,null,t.molRepFischer1),d.Editor.ActionComposerSetRepositoryFischer2Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer2Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER2"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer2",{repItemName:"fischer2"},null,null,t.molRepFischer2),d.Editor.ActionComposerSetRepositoryFischer3Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer3Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER3"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER3"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer3",{repItemName:"fischer3"},null,null,t.molRepFischer3),d.Editor.ActionComposerSetRepositorySawhorseStaggeredController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SAWHORSE_STAGGERED"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_SAWHORSE_STAGGERED"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SawhorseStaggered",{repItemName:"sawhorseStaggered"},null,null,t.molRepSawhorseStaggered),d.Editor.ActionComposerSetRepositorySawhorseEclipsedController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SAWHORSE_ECLIPSED"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_SAWHORSE_ECLIPSED"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SawhorseEclipsed",{repItemName:"sawhorseEclipsed"},null,null,t.molRepSawhorseEclipsed),d.Editor.ActionComposerSetRepositoryMethaneController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMethaneController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_METHANE"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_METHANE"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Methane",{repItemName:"methane"},null,null,t.molRepMethane),d.Editor.ActionComposerSetRepositorySubBondMarkController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySubBondMarkController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SUBBOND_MARK"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_SUBBOND_MARK"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SubBondMark",{repItemName:"substituentMark"},null,null,t.molRepSubBondMark),d.Editor.ActionComposerSetRepositoryMolFlexChainController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController",d.$L("ChemWidgetTexts.CAPTION_MOL_FLEXCHAIN"),d.$L("ChemWidgetTexts.HINT_MOL_FLEXCHAIN"),"MolFlexChainIaController","MolFlexChainIaController",null,null,null,t.molChain),d.Editor.ActionComposerSetBondController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondController",d.$L("ChemWidgetTexts.CAPTION_MOL_BOND"),d.$L("ChemWidgetTexts.HINT_MOL_BOND"),"MolBondIaController",null,null,[d.Editor.ActionComposerSetBondControllerSingle,d.Editor.ActionComposerSetBondControllerDouble,d.Editor.ActionComposerSetBondControllerTriple,d.Editor.ActionComposerSetBondControllerWedgeUp,d.Editor.ActionComposerSetBondControllerWedgeDown,d.Editor.ActionComposerSetRepositoryMolFlexChainController,d.Editor.ActionComposerSetTrackController,d.Editor.ActionComposerSetRepositoryFischer1Controller,d.Editor.ActionComposerSetRepositorySawhorseStaggeredController,d.Editor.ActionComposerSetRepositorySawhorseEclipsedController],null,t.molBond),d.Editor.ActionComposerSetAtomController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAtomController",d.$L("ChemWidgetTexts.CAPTION_MOL_ATOM"),d.$L("ChemWidgetTexts.HINT_MOL_ATOM"),"MolAtomIaController",null,null,null,null,t.molAtom),d.Editor.ActionComposerSetFormulaController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetFormulaController",d.$L("ChemWidgetTexts.CAPTION_MOL_FORMULA"),d.$L("ChemWidgetTexts.HINT_MOL_FORMULA"),"FormulaIaController",null,null,null,null,t.molFormula),d.Editor.ActionComposerSetAtomAndFormulaController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAtomAndFormulaController",d.$L("ChemWidgetTexts.CAPTION_MOL_ATOM_AND_FORMULA"),d.$L("ChemWidgetTexts.HINT_MOL_ATOM_AND_FORMULA"),"MolAtomIaController",null,null,[d.Editor.ActionComposerSetAtomController,d.Editor.ActionComposerSetRepositoryMethaneController,d.Editor.ActionComposerSetFormulaController],null,t.molAtomAndFormula),d.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair",d.$L("ChemWidgetTexts.CAPTION_MOL_ELECTRON_LONEPAIR"),d.$L("ChemWidgetTexts.HINT_MOL_ELECTRON_LONEPAIR"),"AttachedMarkerIaController","AttachedMarkerIaController-LonePair",{markerClassName:"Kekule.ChemMarker.UnbondedElectronSet",targetClassName:"Kekule.AbstractAtom",initialPropValues:{electronCount:2}},null,null,t.molElectronLonePair),d.Editor.ActionComposerSetNodeChargeControllerClear=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerClear",d.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_CLEAR"),d.$L("ChemWidgetTexts.HINT_MOL_CHARGE_CLEAR"),"MolNodeChargeIaController","MolNodeChargeIaController-Clear",{charge:0,chargeInc:0,radical:d.RadicalOrder.NONE},null,null,t.molChargeClear),d.Editor.ActionComposerSetNodeChargeControllerPositive=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerPositive",d.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_POSITIVE"),d.$L("ChemWidgetTexts.HINT_MOL_CHARGE_POSITIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-Positive",{charge:null,chargeInc:1,radical:d.RadicalOrder.NONE},null,null,t.molChargePositive),d.Editor.ActionComposerSetNodeChargeControllerNegative=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerNegative",d.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_NEGATIVE"),d.$L("ChemWidgetTexts.HINT_MOL_CHARGE_NEGATIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-Negative",{charge:null,chargeInc:-1,radical:d.RadicalOrder.NONE},null,null,t.molChargeNegative),d.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet",d.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_SINGLET"),d.$L("ChemWidgetTexts.HINT_MOL_CHARGE_SINGLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Singlet",{charge:null,chargeInc:0,radical:d.RadicalOrder.SINGLET},null,null,t.molRadicalSinglet),d.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet",d.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_TRIPLET"),d.$L("ChemWidgetTexts.HINT_MOL_CHARGE_TRIPLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Triplet",{charge:null,chargeInc:0,radical:d.RadicalOrder.TRIPLET},null,null,t.molRadicalTriplet),d.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet",d.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_DOUBLET"),d.$L("ChemWidgetTexts.HINT_MOL_CHARGE_DOUBLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Doublet",{charge:null,chargeInc:0,radical:d.RadicalOrder.DOUBLET},null,null,t.molRadicalDoublet),d.Editor.ActionComposerSetNodeChargeController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeController",d.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE"),d.$L("ChemWidgetTexts.HINT_MOL_CHARGE"),"MolNodeChargeIaController",null,null,[d.Editor.ActionComposerSetNodeChargeControllerClear,d.Editor.ActionComposerSetNodeChargeControllerPositive,d.Editor.ActionComposerSetNodeChargeControllerNegative,d.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet,d.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet,d.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet,d.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair],null,t.molCharge),d.Editor.ActionComposerSetTextBlockController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextBlockController",d.$L("ChemWidgetTexts.CAPTION_TEXT_BLOCK"),d.$L("ChemWidgetTexts.HINT_TEXT_BLOCK"),"TextBlockIaController",null,null,null,null,t.textBlock),d.Editor.ActionComposerSetImageBlockController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetImageBlockController",d.$L("ChemWidgetTexts.CAPTION_IMAGE_BLOCK"),d.$L("ChemWidgetTexts.HINT_IMAGE_BLOCK"),"ImageBlockIaController",null,null,null,null,t.imageBlock),d.Editor.ActionComposerSetTextImageController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextImageController",d.$L("ChemWidgetTexts.CAPTION_TEXT_IMAGE"),d.$L("ChemWidgetTexts.HINT_TEXT_IMAGE"),"TextImageIaController","TextImageIaController",null,[d.Editor.ActionComposerSetTextBlockController,d.Editor.ActionComposerSetImageBlockController],null,t.textImage),d.Editor.ActionComposerSetRepositoryRing3Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing3Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_3"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_3"),"MolRingIaController","MolRingIaController-3",{ringAtomCount:3,isAromatic:!1},null,null,t.molRing3),d.Editor.ActionComposerSetRepositoryRing4Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing4Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_4"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_4"),"MolRingIaController","MolRingIaController-4",{ringAtomCount:4,isAromatic:!1},null,null,t.molRing4),d.Editor.ActionComposerSetRepositoryRing5Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing5Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_5"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_5"),"MolRingIaController","MolRingIaController-5",{ringAtomCount:5,isAromatic:!1},null,null,t.molRing5),d.Editor.ActionComposerSetRepositoryRing6Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing6Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_6"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_6"),"MolRingIaController","MolRingIaController-6",{ringAtomCount:6,isAromatic:!1},null,null,t.molRing6),d.Editor.ActionComposerSetRepositoryRing7Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing7Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_7"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_7"),"MolRingIaController","MolRingIaController-7",{ringAtomCount:7,isAromatic:!1},null,null,t.molRing7),d.Editor.ActionComposerSetRepositoryRing8Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing8Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_8"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_8"),"MolRingIaController","MolRingIaController-8",{ringAtomCount:8,isAromatic:!1},null,null,t.molRing8),d.Editor.ActionComposerSetRepositoryRingAr6Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_6"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_AR_6"),"MolRingIaController","MolRingIaController-Ar-6",{ringAtomCount:6,isAromatic:!0},null,null,t.molRingAr6),d.Editor.ActionComposerSetRepositoryRingAr5Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_5"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_AR_5"),"MolRingIaController","MolRingIaController-Ar-5",{ringAtomCount:5,isAromatic:!0},null,null,t.molRingAr5),d.Editor.ActionComposerSetRepositoryMolFlexRingController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController",d.$L("ChemWidgetTexts.CAPTION_MOL_FLEXRING"),d.$L("ChemWidgetTexts.HINT_MOL_FLEXRING"),"MolFlexRingIaController","MolFlexRingIaController",null,null,null,t.molFlexRing),d.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclopentaneHaworth1",{repItemName:"cyclopentaneHaworth1"},null,null,t.molRepCyclopentaneHaworth1),d.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclopentaneHaworth2",{repItemName:"cyclopentaneHaworth2"},null,null,t.molRepCyclopentaneHaworth2),d.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneHaworth1",{repItemName:"cyclohexaneHaworth1"},null,null,t.molRepCyclohexaneHaworth1),d.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneHaworth2",{repItemName:"cyclohexaneHaworth2"},null,null,t.molRepCyclohexaneHaworth2),d.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_CHAIR1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneChair1",{repItemName:"cyclohexaneChair1"},null,null,t.molRepCyclohexaneChair1),d.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_CHAIR2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneChair2",{repItemName:"cyclohexaneChair2"},null,null,t.molRepCyclohexaneChair2),d.Editor.ActionComposerSetRepositoryRingController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_RING"),"MolRingIaController",null,null,[d.Editor.ActionComposerSetRepositoryRing3Controller,d.Editor.ActionComposerSetRepositoryRing4Controller,d.Editor.ActionComposerSetRepositoryRing5Controller,d.Editor.ActionComposerSetRepositoryRing6Controller,d.Editor.ActionComposerSetRepositoryMolFlexRingController,d.Editor.ActionComposerSetRepositoryRingAr6Controller,d.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller,d.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller,d.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller,d.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller],null,t.molRing),d.Editor.ActionComposerSetRepositoryPathLineController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathGlyphLineController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_LINE"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_LINE"),"ArrowLineIaController","ArrowLineIaController-Line",{glyphClass:d.Glyph.StraightLine,glyphInitialParams:null,lineLength:1.5},null,null,t.glyphRepLine),d.Editor.ActionComposerSetRepositoryPathOpenArrowLineController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-OpenArrowLine",{glyphClass:d.Glyph.StraightLine,glyphInitialParams:{endArrowType:d.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,t.glyphRepOpenArrowLine),d.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-TriangleArrowLine",{glyphClass:d.Glyph.StraightLine,glyphInitialParams:{endArrowType:d.Glyph.ArrowType.TRIANGLE,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,t.glyphRepTriangleArrowLine),d.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-DiOpenArrowLine",{glyphClass:d.Glyph.StraightLine,glyphInitialParams:{startArrowType:d.Glyph.ArrowType.OPEN,startArrowWidth:.25,startArrowLength:.25,endArrowType:d.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,t.glyphRepDiOpenArrowLine),d.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-DiTriangleArrowLine",{glyphClass:d.Glyph.StraightLine,glyphInitialParams:{startArrowType:d.Glyph.ArrowType.TRIANGLE,startArrowWidth:.25,startArrowLength:.25,endArrowType:d.Glyph.ArrowType.TRIANGLE,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,t.glyphRepDiTriangleArrowLine),d.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_REV_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-ReversibleArrowLine",{glyphClass:d.Glyph.StraightLine,glyphInitialParams:{startArrowType:d.Glyph.ArrowType.OPEN,startArrowSide:d.Glyph.ArrowSide.REVERSED,startArrowWidth:.25,startArrowLength:.25,endArrowType:d.Glyph.ArrowType.OPEN,endArrowSide:d.Glyph.ArrowSide.SINGLE,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1,lineCount:2}},null,null,t.glyphRepReversibleArrowLine),d.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE"),"ArrowLineIaController","ArrowLineIaController-OpenArrowDiLine",{glyphClass:d.Glyph.StraightLine,glyphInitialParams:{endArrowType:d.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1,lineCount:2}},null,null,t.glyphRepOpenArrowDiLine),d.Editor.ActionComposerSetRepositoryPathOpenArrowArcController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowArcController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_ARC"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_ARC"),"ArrowLineIaController","ArrowLineIaController-OpenArrowArc",{glyphClass:d.Glyph.BaseArc,glyphInitialParams:{endArrowType:d.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,t.glyphRepOpenArrowArc),d.Editor.ActionComposerSetRepositoryPathSingleSideOpenArrowArcController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathSingleSideOpenArrowArcController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC"),"ArrowLineIaController","ArrowLineIaController-SingleSideOpenArrowArc",{glyphClass:d.Glyph.BaseArc,glyphInitialParams:{endArrowType:d.Glyph.ArrowType.OPEN,endArrowSide:d.Glyph.ArrowSide.REVERSED,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,t.glyphRepSingleSideOpenArrowArc),d.Editor.ActionComposerSetRepositoryHeatSymbolController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_HEAT_SYMBOL"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_HEAT_SYMBOL"),"ArrowLineIaController","ArrowLineIaController-HeatSymbol",{glyphClass:d.Glyph.HeatSymbol,glyphInitialParams:{lineLength:1}},null,null,t.glyphRepHeatSymbol),d.Editor.ActionComposerSetRepositoryAddSymbolController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryAddSymbolController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_ADD_SYMBOL"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_ADD_SYMBOL"),"ArrowLineIaController","ArrowLineIaController-AddSymbol",{glyphClass:d.Glyph.AddSymbol,glyphInitialParams:{lineLength:1}},null,null,t.glyphRepAddSymbol),d.Editor.ActionComposerSetRepositoryLineSegmentController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryLineSegmentController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_LINE"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_LINE"),"ArrowLineIaController","ArrowLineIaController-Line",{glyphClass:d.Glyph.Segment,glyphInitialParams:{startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphRepSegment),d.Editor.ActionComposerSetRepositoryNormalReactionArrowController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryNormalReactionArrowController",d.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_NORMAL"),d.$L("ChemWidgetTexts.HINT_REACTION_ARROW_NORMAL"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowNormal",{glyphClass:d.Glyph.ReactionArrow,glyphInitialParams:{reactionArrowType:d.Glyph.ReactionArrowType.NORMAL,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphReactionArrowNormal),d.Editor.ActionComposerSetRepositoryReversibleReactionArrowController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryReversibleReactionArrowController",d.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_REVERSIBLE"),d.$L("ChemWidgetTexts.HINT_REACTION_ARROW_REVERSIBLE"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowReversible",{glyphClass:d.Glyph.ReactionArrow,glyphInitialParams:{reactionType:d.Glyph.ReactionArrowType.REVERSIBLE,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphReactionArrowReversible),d.Editor.ActionComposerSetRepositoryResonanceReactionArrowController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryResonanceReactionArrowController",d.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_RESONANCE"),d.$L("ChemWidgetTexts.HINT_REACTION_ARROW_RESONANCE"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowResonance",{glyphClass:d.Glyph.ReactionArrow,glyphInitialParams:{reactionType:d.Glyph.ReactionArrowType.RESONANCE,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphReactionArrowResonance),d.Editor.ActionComposerSetRepositoryRetrosynthesisReactionArrowController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRetrosynthesisReactionArrowController",d.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_RETROSYNTHESIS"),d.$L("ChemWidgetTexts.HINT_REACTION_ARROW_RETROSYNTHESIS"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowRetrosynthesis",{glyphClass:d.Glyph.ReactionArrow,glyphInitialParams:{reactionType:d.Glyph.ReactionArrowType.RETROSYNTHESIS,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,t.glyphReactionArrowRetrosynthesis),d.Editor.ActionComposerSetRepositoryDoubleElectronPushingArrowController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryDoubleElectronPushingArrowController",d.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_2"),d.$L("ChemWidgetTexts.HINT_ELECTRON_PUSHING_ARROW_2"),"ArrowLineIaController","ArrowLineIaController-ElectronPushingArrowDouble",{glyphClass:d.Glyph.ElectronPushingArrow,glyphInitialParams:{electronCount:2,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,t.glyphElectronPushingArrowDouble),d.Editor.ActionComposerSetRepositorySingleElectronPushingArrowController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySingleElectronPushingArrowController",d.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_1"),d.$L("ChemWidgetTexts.HINT_ELECTRON_PUSHING_ARROW_1"),"ArrowLineIaController","ArrowLineIaController-ElectronPushingArrowSingle",{glyphClass:d.Glyph.ElectronPushingArrow,glyphInitialParams:{electronCount:1,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,t.glyphElectronPushingArrowSingle),d.Editor.ActionComposerSetRepositoryBondFormingElectronPushingArrowController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryBondFormingElectronPushingArrowController",d.$L("ChemWidgetTexts.CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_1"),d.$L("ChemWidgetTexts.HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_1"),"ArrowLineIaController","ArrowLineIaController-BondFormingElectronPushingArrowSingle",{glyphClass:d.Glyph.BondFormingElectronPushingArrow,glyphInitialParams:{endArrowWidth:.25,endArrowLength:.25,lineLength:1,pathEndGap:.1,lineCount:1}},null,null,t.glyphElectronPushingArrowBondForming),d.Editor.ActionComposerSetRepositoryGlyphController=d.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryGlyphController",d.$L("ChemWidgetTexts.CAPTION_REPOSITORY_ARROWLINE"),d.$L("ChemWidgetTexts.HINT_REPOSITORY_ARROWLINE"),"ArrowLineIaController",null,null,[d.Editor.ActionComposerSetRepositoryNormalReactionArrowController,d.Editor.ActionComposerSetRepositoryReversibleReactionArrowController,d.Editor.ActionComposerSetRepositoryResonanceReactionArrowController,d.Editor.ActionComposerSetRepositoryRetrosynthesisReactionArrowController,d.Editor.ActionComposerSetRepositoryLineSegmentController,d.Editor.ActionComposerSetRepositoryDoubleElectronPushingArrowController,d.Editor.ActionComposerSetRepositorySingleElectronPushingArrowController,d.Editor.ActionComposerSetRepositoryBondFormingElectronPushingArrowController,d.Editor.ActionComposerSetRepositoryHeatSymbolController,d.Editor.ActionComposerSetRepositoryAddSymbolController],null,t.glyph),d._registerAfterLoadSysProc((function(){var e=d.ActionManager,r=d.ChemWidget,i=d.Editor,o=d.Editor.ChemSpaceEditor,a=e.registerNamedActionClass;a(t.newDoc,i.ActionEditorNewDoc,o),a(t.loadFile,r.ActionDisplayerLoadFile,o),a(t.loadData,i.ActionEditorLoadData,o),a(t.saveData,r.ActionDisplayerSaveFile,o),a(t.zoomIn,r.ActionDisplayerZoomIn,o),a(t.zoomOut,r.ActionDisplayerZoomOut,o),a(t.resetZoom,r.ActionDisplayerResetZoom,o),a(t.reset,r.ActionDisplayerReset,o),a(t.config,d.Widget.ActionOpenConfigWidget,o),a(t.undo,i.ActionEditorUndo,o),a(t.redo,i.ActionEditorRedo,o),a(t.selectAll,i.ActionSelectAll,o),a(t.cloneSelection,i.ActionCloneSelection,o),a(t.copy,i.ActionCopySelection,o),a(t.cut,i.ActionCutSelection,o),a(t.paste,i.ActionPaste,o),a(t.toggleSelect,i.ActionToggleSelectState,o),a(t.eraseSelection,i.ActionEraseSelection,o),a(t.recheckIssues,i.ActionRecheckIssues,o),a(t.toggleShowAllIssues,i.ActionToggleShowIssueMarkers,o),a(t.objInspector,i.ActionComposerToggleObjInspector,o),a(t.issueInspector,i.ActionComposerToggleIssueInspector,o),function(){for(var e=["C","H","O","N","P","S","Si","F","Cl","Br","I","B","K","Na","D"],t=["methyl","ethyl","phenyl","Ac","TMS","COOCH3","OTs"],r=d.Editor.ActionOperationCreate.ChemNodeModify,n=d.Editor.createEditorOperationCreateActionClass,i=0,o=e.length;i<o;++i)n(null,s="atom_"+e[i],r,{nodeClass:d.Atom,props:{isotopeId:e[i]}});for(i=0,o=t.length;i<o;++i){var a=t[i],s="subgroup_"+a,l=d.Editor.RepositoryItemManager.getItem(a),u=l.getStructureFragment&&l.getStructureFragment();u&&n(null,s,r,{nodeClass:u.getClass(),repositoryItem:l})}n(null,"subgroup_R",r,{nodeClass:d.SubGroup}),n(null,"atom_variable",r,{nodeClass:d.VariableAtom}),n(null,"atom_dummy",r,{nodeClass:d.Pseudoatom,props:{atomType:d.PseudoatomType.DUMMY}}),n(null,"atom_hetero",r,{nodeClass:d.Pseudoatom,props:{atomType:d.PseudoatomType.HETERO}}),n(null,"atom_any",r,{nodeClass:d.Pseudoatom,props:{atomType:d.PseudoatomType.ANY}})}(),function(){for(var e=d.BondType,t=d.BondOrder,r=d.BondStereo,n={single:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.NONE},double:{bondType:e.COVALENT,bondOrder:t.DOUBLE,stereo:r.NONE},triple:{bondType:e.COVALENT,bondOrder:t.TRIPLE,stereo:r.NONE},quad:{bondType:e.COVALENT,bondOrder:t.QUAD,stereo:r.NONE},up:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP},down:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.DOWN},closer:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.CLOSER},upOrDown:{bondType:e.COVALENT,bondOrder:t.SINGLE,stereo:r.UP_OR_DOWN}},i=d.Editor.ActionOperationCreate.ChemConnectorModify,o=d.Editor.createEditorOperationCreateActionClass,a=d.ObjUtils.getOwnedFieldNames(n),s=0,l=a.length;s<l;++s)o(null,"bond_"+a[s],i,n[a[s]])}();for(var s=0,l=n.length;s<l;++s){var u=n[s];a(u.name,u.actionClass,u.widgetClass||o)}}))}(),function(){"use strict";var e=d.ArrayUtils,t=d.CoordUtils;d.Editor.PointerTrackConstraint={NONE:0,LEADING:1,BOTH:2,CIRCLE:5},d.Editor.TrackParser=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.TrackParser",simplifyCurveToLineSegments:function(e,t){return d.GeometryUtils.simplifyCurveToLineSegments(e,t)},addLineCrossPoints:function(e){for(var t=[],r=e.length,n=0;n<r-1;++n)for(var i={coord1:e[n],coord2:e[n+1]},o=n+2;o<r-1;++o){var a={coord1:e[o],coord2:e[o+1]},s=d.GeometryUtils.getCrossPointOfLines(i.coord1,i.coord2,a.coord1,a.coord2);s&&(this._addInsertedPoint(n,s,t),this._addInsertedPoint(o,s,t))}for(n=0;n<r-1;++n)t[n]&&this._sortInsertedPointsInLine(t[n],e[n],e[n+1]);var l=[];for(n=0;n<r-1;++n)if(l.push(e[n]),t[n]){o=0;for(var u=t[n].length;o<u;++o)l.push(t[n][o])}return l.push(e[r-1]),l},addVertexToLineMergePoint:function(e,t){if(t<=0)return e;for(var r=e.length,n=[],i=0;i<r-1;++i)for(var o=e[i],a=0;a<r-1;++a)if(a<i-1||a>i+1){var s=d.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(o,e[a],e[a+1],!1);s&&d.CoordUtils.getDistance(o,s)<=t&&(o.x=s.x,o.y=s.y,this._addInsertedPoint(a,o,n))}var l=[];for(i=0;i<r-1;++i)if(l.push(e[i]),n[i]){this._sortInsertedPointsInLine(n[i],e[i],e[i+1]),a=0;for(var u=n[i].length;a<u;++a)l.push(n[i][a])}return l.push(e[r-1]),l},_addInsertedPoint:function(e,t,r){r[e]||(r[e]=[]),r[e].push(t)},_sortInsertedPointsInLine:function(e,t,r){if(e){var n=r.x-t.x,i=r.y-t.y;e.sort((function(e,t){return Math.abs(i)>Math.abs(n)?-(t.y-e.y)*i:-(t.x-e.x)*n}))}},mergeNearbyTrackPoints:function(e,r){if(r<=0)return e;for(var n=e.length,i=e.concat([]),o=0;o<n;++o){var a=i[o];if(!a.__$merge_handled__)for(var s=o+1;s<n;++s){var l=i[s];if(!l.__$merge_handled__){var u=a.__$merge_weight__||1,c=l.__$merge_weight__||1;if(d.CoordUtils.getDistance(a,l)<=r){var h,p=u+c;a.__$merge_weight__=p,a.boundObj?h=a:l.boundObj?(h=l,a.boundObj=l.boundObj):(h=1===u?a:t.multiply(a,u),h=t.add(h,1===c?l:t.multiply(l,c)),h=t.divide(h,p)),a.x=h.x,a.y=h.y,i.splice(s,1,a)}}}a.__$merge_handled__=!0}return i},mergeCloseVertexes:function(e,t){return(t=t||this.getVertexMergeRadius())<=0?e:this._doMergeCloseVertexes(e,t)},_doMergeCloseVertexes:function(e,t){for(var r=e.getVertexes(),n=r.length,i=!1,o=0;o<n;++o){for(var a=r[o],s=r[o].getData("coord"),l=o+1;l<n;++l){var u=r[l],c=u.getData("coord");if(d.CoordUtils.getDistance(s,c)<=t){this._doMergeVertex(e,a,u),i=!0;break}}if(i)break}return i?this._doMergeCloseVertexes(e,t):e},_doMergeVertex:function(r,n,i){for(var o=n.getData("coord"),a=n.getData("weight")||1,s=i.getData("coord"),l=i.getData("weight")||1,d=e.clone(i.getEdges()),u=0,c=d.length;u<c;++u)d[u].replaceVertex(i,n);r.removeVertex(i);var h=1===a?o:t.multiply(o,a);h+=1===l?s:t.multiply(s,l),h=t.divide(h,a+l),n.setData("coord",h)},removeRepetitivePoints:function(e){for(var t=[],r=null,n=0,i=e.length;n<i;++n)e[n]!==r&&(t.push(e[n]),r=e[n]);return t},refineTrack:function(e,t,r){var n=this.simplifyCurveToLineSegments(e,t);return n=this.addLineCrossPoints(n),n=this.addVertexToLineMergePoint(n,r),n=this.mergeNearbyTrackPoints(n,r),this.removeRepetitivePoints(n)},convertTrackToStructure:function(e,t,r,n){if(!t||!t.length)return null;var i=t.length;if(i<2)return null;for(var o,a=n||new d.StructureFragment,s=0;s<i;++s){var l=t[s],u=l.__$structure_node__;if(u||((u=new d.Atom).setIsotopeId(r),e.setObjectScreenCoord(u,l),l.__$structure_node__=u,a.appendNode(u)),o&&o!==u&&!u.getConnectorTo(o)){var c=new d.Bond(null,[o,u]);c.setBondOrder(1),a.appendConnector(c)}o=u}return a},convertLinesToGraph:function(e){if(e&&e.length){for(var t,r=new d.Graph,n=e.length,i=0;i<n;++i){var o,a=e[i];if((o=a.__$graph_vertex__)||((o=new d.GraphVertex).setData("coord",a),a.__$graph_vertex__=o,r.addVertex(o)),t&&!o.getEdgeTo(t)){var s=new d.GraphEdge;r.addEdge(s,t,o)}t=o}return r}return null}}),d.Editor.TrackLayoutOptimizer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.TrackLayoutOptimizer",OPTIMIZED_COORD_FIELD:"__$optimizedCoord__",COORD_INDEX_FIELD:"__$coordIndex__",RING_END_INDEX_FIELD:"__$ringEndIndex__",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){},initPropValues:function(){this.tryApplySuper("initPropValues")},splitTrackByRings:function(e){for(var t=[],r=function(e,r){for(var n=0,i=t.length;n<i;++n){var o=t[n];if(!(o.startIndex>r||o.endIndex<e))return!1}return!0},n=0,i=e.length;n<i;++n){var o=e[n];if(void 0===o[this.COORD_INDEX_FIELD])o[this.COORD_INDEX_FIELD]=n;else{var a=o[this.COORD_INDEX_FIELD],s=n;o[this.RING_END_INDEX_FIELD]=s,r(a,s)&&t.push({startIndex:a,endIndex:s})}}var l=[],d=t.length;if(d>0){var u=0;for(n=0;n<d;++n){var c=t[n];c.startIndex>u&&l.push({track:e.slice(u,c.startIndex+1),isRing:!1}),l.push({track:e.slice(c.startIndex,c.endIndex+1),isRing:!0}),u=c.endIndex}return u<e.length-1&&l.push({track:e.slice(u,e.length),isRing:!1}),l}return[{track:e,isRing:!1}]},optimize:function(t,r){var n,i=t,o=d.Editor.PointerTrackConstraint,a=t[0],s=a.boundObj,l=t[t.length-1],u=l.boundObj;s&&u?n=s===u?o.CIRCLE:o.BOTH:s||u?(n=o.LEADING,u&&(i=e.reverse(t))):n=a===l?o.CIRCLE:o.LEADING;var c=Object.extend({},r);return c.preferredStartingAngles=r.preferredStartingAngles||[0],c.segmentsInfo=this._calcTrackSegmentsInfo(i),c.distanceMedian=e.getMedian(c.segmentsInfo.distances),n===o.CIRCLE?this.doOptimizeOnCircleConstraint(i,c):n===o.BOTH?this.doOptimizeOnBothConstraint(i,c):this.doOptimizeOnLeadingConstraint(i,c)},_calcTrackSegmentsInfo:function(e){for(var r=[],n=[],i=0,o=e.length;i<o-1;++i){var a=e[i],s=e[i+1],l=t.getDistance(a,s),d=t.substract(s,a),u=Math.atan2(d.y,d.x);r.push(l),n.push(u)}return{distances:r,angles:n}},doOptimizeOnLeadingConstraint:function(e,r,n){var i=d.GeometryUtils,o=[];if(n){d.Editor.PointerTrackConstraint;var a,s=this.splitTrackByRings(e);if(1===s.length)return s[l].isRing?this.doOptimizeOnCircleConstraint(c,r,!0):this.doOptimizeOnLeadingConstraint(c,r,!0);for(var l=0,u=s.length;l<u;++l){var c=s[l].track,h=s[l].isRing?this.doOptimizeOnCircleConstraint(c,r,!0):this.doOptimizeOnLeadingConstraint(c,r,!0);if(a){for(var p=h[0],g=t.substract(a,p),f=0,m=h.length;f<m;++f)h[f]=t.add(h[f],g);a=h[h.length-1],h.shift(),o=o.concat(h)}else a=h[h.length-1],o=o.concat(h)}return o}var C,y=r.preferredStartingAngles;for(o.push(e[0]),r.preferredIncludeAngle,r.preferredIncludeAngle,l=1,u=e.length;l<u;++l)if(e[l][this.OPTIMIZED_COORD_FIELD])o.push(e[l][this.OPTIMIZED_COORD_FIELD]);else{var _,E=e[l-1],T=o[l-1],O=e[l],v=(g=t.substract(O,E),t.getDistance(E,O)),S=this._optimizeLineSegmentDistance(v,r),b=Math.atan2(g.y,g.x);C=_=this._optimizeDirectionAngle(b,y,r,C);var A=Math.PI-r.preferredIncludeAngle,I=(y=[i.standardizeAngle(_-A),i.standardizeAngle(_+A)],{x:S*Math.cos(_),y:S*Math.sin(_)}),R=t.add(T,I);o.push(R),e[l][this.OPTIMIZED_COORD_FIELD]=R}return o},doOptimizeOnBothConstraint:function(e,r,n){var i=e.length,o=this.doOptimizeOnLeadingConstraint(e,r,n),a=o[i-1],s=e[i-1],l=e[0],u=t.substract(s,l),c=Math.atan2(u.y,u.x),h=t.substract(a,l),p=Math.atan2(h.y,h.x),g=t.getDistance(u)/t.getDistance(h);if(g<=2){var f=t.calcTransform2DMatrix({rotateAngle:-p,center:l}),m=t.calcTransform2DMatrix({scale:g,center:l}),C=t.calcTransform2DMatrix({rotateAngle:c,center:l}),y=d.MatrixUtils.multiply(f,m);y=d.MatrixUtils.multiply(y,C);for(var _=[o[0]],E=1;E<i-1;++E)_.push(t.transform2DByMatrix(o[E],y));_.push(e[i-1])}else{var T=t.divide(t.substract(s,a),i-1),O=(_=[o[0]],{x:0,y:0});for(E=0;E<i-1;++E)O=t.add(O,T),_.push(t.add(o[E],O));_.push(e[i-1])}return _},doOptimizeOnCircleConstraint:function(e,r,n){var i=e.length-1,o=Object.create(r);if(i<=8){var a=(1-2/i)*Math.PI;(o=Object.create(r)).preferredIncludeAngle=a}for(var s=e.length,l=this.doOptimizeOnLeadingConstraint(e,o,n),d=l[s-1],u=e[s-1],c=t.divide(t.substract(u,d),s-1),h=[l[0]],p={x:0,y:0},g=1;g<s-1;++g)p=t.add(p,c),h.push(t.add(l[g],p));return h.push(e[s-1]),h},_optimizeIncludeAngle:function(e,t,r){return this._optimizeDirectionAngle(e,t,r)},_optimizeDirectionAngle:function(e,t,r,n){var i=d.GeometryUtils,o=null,a=null;if(t&&t.length){for(var s=null,l=0,u=t.length;l<u;++l){var c=Math.abs(i.standardizeAngle(e)-t[l]);(null===s||c<s)&&(a=t[l],s=c)}s<=Math.PI/6&&(o=a)}if(null===o){var h=r.angleConstraint;if(!h)return e;if(null===a&&(a=0),c=e-a,o=a+Math.round(c/h)*h,n){var p=5*Math.PI/180,g=Math.abs(i.standardizeAngle(o-n,-Math.PI));if(d.NumUtils.isFloatEqual(g,0,p)||d.NumUtils.isFloatEqual(g,Math.PI,p)){var f=o+h,m=o-h;o=Math.abs(e-f)<Math.abs(e-m)?f:m}}}return o},_optimizeLineSegmentDistance:function(e,t){var r=t.defBondScreenLength,n=t.distanceConstraints||[];if(!n)return e;if(e>n[n.length-1]*r)return Math.round(e/r)*r;var i,o=t.primaryDistanceConstraint,a=n.length,s=n.indexOf(o);s<0&&(s=0);for(var l=a-1;l>=s;--l){var d=n[l];if(e>(i=d*r))return i}for(l=0;l<=s;++l)if(e<(i=d*r))return i;return i}}),d.Editor.TrackInputIaController=Class.create(d.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.TrackInputIaController",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setEnableSelect(!1),this._isTracking=!1,this._trackCoordToObjBindings=null,this._trackParser=new d.Editor.TrackParser,this._trackLayoutOptimizer=new d.Editor.TrackLayoutOptimizer,this._addStructureOperation=null,this._editorScaled=!1,this._editorOriginalZoomLevel=1,this._lastRenderedMarkerCoord=null,this._debugMarkers={}},doFinalize:function(){this._trackLayoutOptimizer.finalize(),this._trackParser.finalize();var e=this.getPropStoreFieldValue("trackMarker");e&&e.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("trackMarker",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("trackMarker");return e||(e=new d.ChemWidget.MetaShapeUIMarker({shapeType:d.Render.MetaShapeType.POLYLINE,coords:[]}),this.setPropStoreFieldValue("trackMarker",e)),e}})},initPropValues:function(){this.tryApplySuper("initPropValues")},getEditorUiMarkers:function(){return this.getEditor().getUiMarkers()},refineTrackCoords:function(e){var r=this.getEditor(),n=this.getEditorConfigs(),i={angleConstraint:n.getInteractionConfigs().getTrackOptimizationAngleConstraint(),distanceConstraints:n.getInteractionConfigs().getTrackOptimizationDistanceConstraints(),primaryDistanceConstraint:n.getInteractionConfigs().getTrackOptimizationPrimaryDistanceConstraint(),preferredIncludeAngle:2*Math.PI/3},o=r.getDefBondLength?r.getDefBondLength():n.getStructureConfigs().getDefBondLength(),a=r.objCoordToScreen({x:0,y:0}),s=r.objCoordToScreen({x:o,y:0}),l=t.getDistance(a,s);i.defBondScreenLength=l;for(var d=this.getEditorConfigs().getInteractionConfigs().getTrackSimplifierDistanceThreshold(),u=this.getEditorConfigs().getInteractionConfigs().getTrackMergeDistanceThreshold(),c=this._mergeCoordsToBoundNodesAndSplitTrack(e),h=[],p=0,g=c.length;p<g;++p){var f=c[p],m=(f=this._trackParser.refineTrack(f,d,u))[0].obj||f[f.length-1].obj,C=m?n.getStructureConfigs.getNewBondDefAngle(m,1):-Math.PI/6;i.preferredStartingAngles=[C],f=this._trackLayoutOptimizer.optimize(f,i),h.push(f)}return h},_mergeCoordsToBoundNodesAndSplitTrack:function(e){var t=this._trackCoordToObjBindings,r=t.length;if(r){for(var n=this.getEditor(),i=[],o=t[0].obj,a=t[0].coordIndex,s=0,l=1;l<=r;++l){var d=t[l];if(l<r&&d&&(o!==d.obj||d.coordIndex-a>10)||l===r){a>s&&i.push(e.slice(s,a));var u=n.getObjectScreenCoord(o);u.boundObj=o,s=t[l-1].coordIndex+1,i.push([u]),l!==r&&(o=d.obj,a=d.coordIndex)}}e.length-1>t[r-1].coordIndex&&i.push(e.slice(t[r-1].coordIndex));for(var c=[],h=[],p=(l=0,i.length);l<p;++l){var g=i[l];c=c.concat(g),l===p-1?h.push(c):g[0].boundObj&&l>0&&(h.push(c),c=g)}return h}return[e]},convertTracksToStructure:function(e,t){var r=new d.Molecule;r.setCoord2D({x:0,y:0});for(var n=this.getEditor(),i=0,o=e.length;i<o;++i)this._trackParser.convertTrackToStructure(n,e[i],t,r);return r.getNodeCount()<2?null:r},getStructureSelectableChildren:function(e){return[].concat(e.getNodes()).concat(e.getConnectors())},addStructureToEditor:function(e){var t=this.getEditor();this._addStructureOperation=null,t.beginUpdateObject();try{var r,n=t.getChemSpace();this._targetMol?(r=new d.ChemStructOperation.MergeStructFragment(e,this._targetMol,t),this._targetMol=null):r=new d.ChemObjOperation.Add(e,n,null,t),r.execute(),this._addStructureOperation=r}finally{t.endUpdateObject()}},getTrackCoords:function(){return this.getTrackMarker().getShapeInfo().coords},clearTrackCoords:function(){this.getTrackMarker().getShapeInfo().coords=[]},startTracking:function(e,t){this._targetMol=null;var r=this.getEditor(),n=this._getMergeDestObjAtCoord(t);if(!r.canCreateNewChild()&&!n){if(!r.canAddUnconnectedStructFragment())return null;var i=r.getOnlyOneBlankStructFragment();this._targetMol=i}this._isTracking=!0,this._trackCoordToObjBindings=[],this.setManuallyHotTrack(!0),this.clearTrackCoords();var o=this.getTrackMarker();this.getEditorUiMarkers().addMarker(o);var a=this.getEditorConfigs().getUiMarkerConfigs(),s={strokeColor:a.getTrackMarkerStrokeColor(),strokeWidth:a.getTrackMarkerStrokeWidth(),strokeDash:a.getTrackMarkerStrokeDash(),opacity:a.getTrackMarkerOpacity()};if(o.setDrawStyles(s),o.setVisible(!0),this.addTrackCoord(t,!1),this.getEditorConfigs().getInteractionConfigs().getAutoAdjustZoomLevelOnTrackTouching()){r=this.getEditor();var l=this.getEditorConfigs().getInteractionConfigs().getTrackTouchRefLength();if(l){var u=r.getDocument(),c=r.getDefBondScreenLength(),h=d.DocumentUtils.getDevicePPI(u)*l/d.DocumentUtils.getClientScaleLevel(u)/c;if(h>.9){var p=r.getCurrZoom();r.setZoomCenter(t),r.zoomTo(p*h);var g=this._getEventMouseCoord(e),f=this.getTrackCoords(),m=f[f.length-1];t=g,Object.extend(m,g),this._editorScaled=!0,this._editorOriginalZoomLevel=p,this._autoScaleStartCoord=g}else this._editorScaled=!1,this._editorOriginalZoomLevel=null}}this.repaintMarker(),this._lastRenderedMarkerCoord=t},endTracking:function(e){var t=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId()||"C";this._isTracking=!1,this.addTrackCoord(e);var r=this.refineTrackCoords(this.getTrackCoords());if(r.length){var n=this.convertTracksToStructure(r,t);if(n){this.addStructureToEditor(n),this.startDirectManipulate(null,n,e),this.moveManipulatedObjs(e),this.manipulateBeforeStopping(),this.stopManipulate();var i=this.getStructureSelectableChildren(n);this.doneInsertOrModifyBasicObjects(i)}}this.doneTracking()},cancelTracking:function(){this._isTracking=!1,this.getEditorUiMarkers().removeMarker(this.getTrackMarker()),this.doneTracking()},doneTracking:function(){if(this._editorScaled){var e=this.getTrackCoords();e[e.length-1],this._editorScaled=!1,this.getEditor().zoomTo(this._editorOriginalZoomLevel,null,this._autoScaleStartCoord),this._editorOriginalZoomLevel=null,this._autoScaleStartCoord=null}this.setManuallyHotTrack(!1),this.getEditor().hideHotTrack(),this.clearTrackCoords(),this.repaintMarker()},_getMergeDestObjAtCoord:function(e){for(var t=this.getEditor().getBasicObjectsAtCoord(e,this.getCurrBoundInflation()),r=0,n=t.length;r<n;++r){var i=t[r];if(this.isValidMergeDestObj(i))return i}return null},addTrackCoord:function(e,t){var r=this.getTrackCoords(),n=r&&r[r.length-1];if(!n||!d.CoordUtils.isEqual(e,n)){var i=this._getMergeDestObjAtCoord(e);i&&(this._trackCoordToObjBindings.push({coord:e,obj:i,coordIndex:this.getTrackCoords().length}),this.getEditor().addHotTrackedObj(i)),r.push(e),t||(this._lastRenderedMarkerCoord?d.CoordUtils.getDistance(this._lastRenderedMarkerCoord,e)>5&&(this.repaintMarker(),this._lastRenderedMarkerCoord=e):(this.repaintMarker(),this._lastRenderedMarkerCoord=e))}},repaintMarker:function(){this.getEditor().repaintUiMarker()},isValidMergeDestObj:function(e){return e instanceof d.ChemStructureNode},canInteractWithObj:function(e){return e instanceof d.ChemStructureNode},getAllObjOperations:function(e){var t=this.tryApplySuper("getAllObjOperations",[e])||[],r=this._addStructureOperation;return r&&t.unshift(r),t},react_pointerdown:function(e){if(this.setActivePointerType(e.pointerType),e.getButton()===d.X.Event.MouseButton.LEFT){var t=this._getEventMouseCoord(e);return this.startTracking(e,t),e.preventDefault(),!0}if(e.getButton()===d.X.Event.MouseButton.RIGHT)return this.cancelTracking(),e.preventDefault(),!0},react_pointerup:function(e){if(e.getButton()===d.X.Event.MouseButton.LEFT){if(this._isTracking){var t=this._getEventMouseCoord(e);this.endTracking(t),this.addOperationToEditor()}return this.setState(d.Editor.BasicManipulationIaController.State.NORMAL),e.preventDefault(),!0}},react_pointermove:function(e){if(this.tryApplySuper("react_pointermove",[e]),this._isTracking){var t=this._getEventMouseCoord(e);return this.addTrackCoord(t),e.preventDefault(),!0}}}),d.Editor.IaControllerManager.register(d.Editor.TrackInputIaController,d.Editor.ChemSpaceEditor)}(),function(){"use strict";var e=d.ArrayUtils;d.Editor,d.Widget.HtmlClassNames,d.ChemWidget.HtmlClassNames,d.ChemWidget.ComponentWidgetNames,d.Editor.ObjModifier={},d.Editor.ObjModifier.Category={GENERAL:"general",CHEM_STRUCTURE:"chemStruct",GLYPH:"glyph",STYLE:"style",MISC:"misc"},d.Editor.ObjModifier.Base=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.ObjModifier.Base",initialize:function(e){this.tryApplySuper("initialize"),this.setEditor(e),this.modifierWidgetValueChangedBind=this.modifierWidgetValueChanged.bind(this)},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1}),this.defineProp("targetObjs",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getEditor().getSelection()}}),this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("widget");return e||(e=this.createWidget(),this.setPropStoreFieldValue("widget",e)),e}})},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},getModifierName:function(){return this.getClassLocalName().toLowerCase()},createWidget:function(){var e=this.doCreateWidget();return e&&this.installValueChangeEventHandler(e),e},doCreateWidget:function(){return null},installValueChangeEventHandler:function(e){e.on("valueChange",this.modifierWidgetValueChangedBind)},modifierWidgetValueChanged:function(){this.applyToTargets()},loadFromTargets:function(){var e=this.getEditor();if(e){var t=this.getTargetObjs();t&&this.doLoadFromTargets(e,t)}return this},doLoadFromTargets:function(e,t){},applyToTargets:function(){var e=this.getEditor();if(e){var t=this.getTargetObjs();t&&this.doApplyToTargets(e,t)}return this},doApplyToTargets:function(e,t){var r=this.createModificationOper();r&&e.execOperation(r)},createModificationOper:function(e){var t=[];if(e&&e.length)for(var r=0,n=e.length;r<n;++r){var i=this.createModificationOperOnTarget(e[r]);i&&t.push(i)}var o=t.length;return o<=0?null:1===o?t[0]:new d.MacroOperation(t)},createModificationOperOnTarget:function(e){var t=this.getModifiedPropValues();return t?this.createModificationOperation(e,t):null},getModifiedPropValues:function(){return null},createModificationOperation:function(e,t){return new d.ChemObjOperation.Modify(e,t,this.getEditor())}}),d.Editor.ObjModifierManager={_modifierMap:new d.MapEx(!0),register:function(r,n){if(n&&r)for(var i=e.toArray(n),o=e.toArray(r),a=0,s=o.length;a<s;++a){var l=o[a],d=t._modifierMap.get(l);d?e.pushUnique(d,i):(d=i,t._modifierMap.set(l,d))}},unregister:function(r){if(r)for(var n=e.toArray(r),i=t._modifierMap.getKeys(),o=0,a=i.length;o<a;++o){var s=t._modifierMap.get(i[o]);s&&s.length&&t._modifierMap.set(i[o],e.exclude(s,n))}},getModifierCategories:function(r){var n=r.getCategories&&r.getCategories()||[],i=ClassEx.getSuperClass(r);return i&&e.pushUnique(n,t.getModifierCategories(i)),n},getModifierClasses:function(r,n){var i=t._modifierMap.get(r)||[],o=ClassEx.getSuperClass(r);if(o&&e.pushUnique(i,t.getModifierClasses(o,n)),n&&n.length){var a=i;i=[];for(var s=0,l=a.length;s<l;++s){var d=t.getModifierCategories(a[s]);e.intersect(d,n).length&&i.push(a[s])}}return i}};var t=d.Editor.ObjModifierManager}(),function(){"use strict";d.ArrayUtils,d.Editor;var e=d.Widget.HtmlClassNames,t=d.ChemWidget.HtmlClassNames;d.ChemWidget.ComponentWidgetNames,d.Editor.ObjModifier.BaseRenderOptionModifier=Class.create(d.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.BaseRenderOptionModifier",getRenderOptionValue:function(e,t,r){return d.Render.RenderOptionUtils.getCascadeRenderOptionValueOfObjs(e,t,r)}}),d.Editor.ObjModifier.BaseRenderOptionModifier.getCategories=function(){return[d.Editor.ObjModifier.Category.STYLE]},d.Editor.ObjModifier.Color=Class.create(d.Editor.ObjModifier.BaseRenderOptionModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Color",ATOM_COLOR_SPECIAL_VALUE_INFO:{text:d.$L("ChemWidgetTexts.HINT_USE_ATOM_CUSTOM_COLOR"),value:"Atom",className:e.COLORPICKER_SPEC_COLOR_MIXED},initProperties:function(){this.defineProp("colorBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new d.Widget.ColorDropButton(this.getEditor());return e.setHint(d.$L("ChemWidgetTexts.HINT_PICK_COLOR")),e.setShowText(!1),e.setSpecialColors([d.Widget.ColorPicker.SpecialColors.UNSET,this.ATOM_COLOR_SPECIAL_VALUE_INFO]),e.addClassName(t.COMPOSER_COLOR_BOX),this.setPropStoreFieldValue("colorBox",e),e},doLoadFromTargets:function(e,t){if(t&&t.length){var r=this.getColorBox();if(r){var n=this.getRenderOptionValue(t,"useAtomSpecifiedColor"),i=this.getRenderOptionValue(t,"color");n?(i=this.ATOM_COLOR_SPECIAL_VALUE_INFO.value,r.setColorClassName(this.ATOM_COLOR_SPECIAL_VALUE_INFO.className),r.setValue(i)):(r.setColorClassName(null),r.setValue(i))}}},doApplyToTargets:function(e,t){var r=this.getWidget().getValue();r===this.ATOM_COLOR_SPECIAL_VALUE_INFO.value?e.modifyObjectsRenderOptions(t,{useAtomSpecifiedColor:!0,color:void 0},!1,!0):(r==d.Widget.ColorPicker.SpecialColors.UNSET&&(r=void 0),e.modifyObjectsRenderOptions(t,{useAtomSpecifiedColor:!1,color:r},!1,!0))}}),d.Editor.ObjModifierManager.register(d.ChemObject,[d.Editor.ObjModifier.Color])}(),function(){"use strict";var e=d.DomUtils,t=(d.HtmlElementUtils,d.Widget.HtmlClassNames,d.ChemWidget.HtmlClassNames),r=d.ChemWidget.ComponentWidgetNames;d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{COMPOSER_TEXTFORMAT_BUTTON:"K-Chem-Composer-TextFormat-Button",COMPOSER_MODIFIER_RICHTEXT_PANEL:"K-Chem-Composer-Modifier-RichText-Panel",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP:"K-Chem-Composer-Modifier-RichText-Panel-Group",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABELCELL:"K-Chem-Composer-Modifier-RichText-Panel-Group-LabelCell",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_CTRLCELL:"K-Chem-Composer-Modifier-RichText-Panel-Group-CtrlCell",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABEL:"K-Chem-Composer-Modifier-RichText-Panel-Group-Label",COMPOSER_TEXTDIRECTION_BOX:"K-Chem-Composer-TextDirection-Box",COMPOSER_TEXTALIGN_BOX:"K-Chem-Composer-TextAlign-Box"}),d.globalOptions.add("chemWidget.composer.objModifier.richText",{componentNames:[r.fontName,r.fontSize,r.textDirection,r.textAlign,r.nodeDisplayMode]}),d.Editor.ObjModifier.RichText=Class.create(d.Editor.ObjModifier.BaseRenderOptionModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.RichText",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueStorage={},this._nodeLabelDisplayModeGroup=null},initProperties:function(){this.defineProp("fontPanel",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("fontNameBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("fontSizeBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("textDirectionBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("textHorizontalAlignBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("textVerticalAlignBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("nodeLabelDisplayModeBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},_createCtrlGroup:function(r,n,i,o){var a=r.createElement("tr");a.className=t.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP,(s=r.createElement("td")).className=t.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABELCELL;var s,l=r.createElement("label");return l.className=t.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUPLABEL,e.setElementText(l,i),s.appendChild(l),a.appendChild(s),(s=r.createElement("td")).className=t.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_CTRLCELL,o.appendToElem(s),a.appendChild(s),n.appendChild(a),a},_doCreateDropDownPanel:function(){var e=new d.Widget.Panel(this.getEditor());e.addClassName(t.COMPOSER_MODIFIER_RICHTEXT_PANEL).setCaption(d.$L("ChemWidgetTexts.CAPTION_TEXT_FORMAT"));var n,i,o=d.globalOptions.chemWidget.composer.objModifier.richText.componentNames,a=this.getEditor().getDocument(),s=a.createElement("table");if(e.getContainerElement().appendChild(s),o.indexOf(r.fontName)>=0){var l=new d.Widget.ComboBox(e);this.fillFontNameBox(l),l.addClassName(t.COMPOSER_FONTNAME_BOX),l.setHint(d.$L("ChemWidgetTexts.HINT_FONTNAME")),l.addEventListener("valueChange",(function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{fontFamily:this.getFontNameBox().getValue()},!1,!0)}),this),this.setPropStoreFieldValue("fontNameBox",l),this._createCtrlGroup(a,s,d.$L("ChemWidgetTexts.CAPTION_FONTNAME"),l)}if(o.indexOf(r.fontSize)>=0&&(l=new d.Widget.ComboBox(e),this.fillFontSizeBox(l),l.addClassName(t.COMPOSER_FONTSIZE_BOX),l.setHint(d.$L("ChemWidgetTexts.HINT_FONTSIZE")),l.addEventListener("valueChange",(function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{fontSize:this.getFontSizeBox().getValue()},!1,!0)}),this),this.setPropStoreFieldValue("fontSizeBox",l),this._createCtrlGroup(a,s,d.$L("ChemWidgetTexts.CAPTION_FONTSIZE"),l)),o.indexOf(r.textDirection)>=0){n=new d.Widget.SelectBox(e);var u=d.Render.TextDirection,c=[{value:u.DEFAULT,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_DEFAULT")},{value:u.LTR,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_LTR")},{value:u.RTL,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_RTL")},{value:u.TTB,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_TTB")},{value:u.BTT,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_BTT")}];n.setItems(c),l.addClassName(t.COMPOSER_TEXTDIRECTION_BOX),n.setHint(d.$L("ChemWidgetTexts.HINT_TEXT_DIRECTION")),n.addEventListener("valueChange",(function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{charDirection:this.getTextDirectionBox().getValue()},!1,!0)}),this),this.setPropStoreFieldValue("textDirectionBox",n),this._createCtrlGroup(a,s,d.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION"),n)}o.indexOf(r.textAlign)>=0&&(n=new d.Widget.SelectBox(e),c=[{value:(i=d.Render.TextAlign).DEFAULT,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT")},{value:i.LEADING,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING")},{value:i.TRAILING,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING")},{value:i.CENTER,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER")},{value:i.LEFT,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEFT")},{value:i.RIGHT,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_RIGHT")}],n.setItems(c),l.addClassName(t.COMPOSER_TEXTALIGN_BOX),n.setHint(d.$L("ChemWidgetTexts.HINT_TEXT_HORIZONTAL_ALIGN")),n.addEventListener("valueChange",(function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{horizontalAlign:this.getTextHorizontalAlignBox().getValue()},!1,!0)}),this),this.setPropStoreFieldValue("textHorizontalAlignBox",n),this._createCtrlGroup(a,s,d.$L("ChemWidgetTexts.CAPTION_TEXT_HORIZONTAL_ALIGN"),n),n=new d.Widget.SelectBox(e),c=[{value:(i=d.Render.TextAlign).DEFAULT,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT")},{value:i.LEADING,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING")},{value:i.TRAILING,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING")},{value:i.CENTER,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER")},{value:i.TOP,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TOP")},{value:i.BOTTOM,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_BOTTOM")}],n.setItems(c),l.addClassName(t.COMPOSER_TEXTALIGN_BOX),n.setHint(d.$L("ChemWidgetTexts.HINT_TEXT_VERTICAL_ALIGN")),n.addEventListener("valueChange",(function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{verticalAlign:this.getTextVerticalAlignBox().getValue()},!1,!0)}),this),this.setPropStoreFieldValue("textVerticalAlignBox",n),this._createCtrlGroup(a,s,d.$L("ChemWidgetTexts.CAPTION_TEXT_VERTICAL_ALIGN"),n));o.indexOf(r.nodeDisplayMode)>=0&&(l=new d.Widget.SelectBox(e),this.fillNodeDisplayModeBox(l),l.addClassName(t.COMPOSER_NODEDISPLAYMODE_BOX),l.setHint(d.$L("ChemWidgetTexts.HINT_NODE_LABEL_DISPLAY_MODE")),l.addEventListener("valueChange",(function(e){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{nodeDisplayMode:this.getNodeLabelDisplayModeBox().getValue()},!1,!0)}),this),this.setPropStoreFieldValue("nodeLabelDisplayModeBox",l),this._nodeLabelDisplayModeGroup=this._createCtrlGroup(a,s,d.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE"),l)),this.setPropStoreFieldValue("fontPanel",e);var h=this._valueStorage;return h&&this._updateUiValuesFromStorage(h),e},doCreateWidget:function(){var e=new d.Widget.DropDownButton(this.getEditor());return e.setHint(d.$L("ChemWidgetTexts.HINT_TEXT_FORMAT")),e.setText(d.$L("ChemWidgetTexts.CAPTION_TEXT_FORMAT")),e.setShowText(!1),e.setButtonKind(d.Widget.Button.Kinds.DROPDOWN),e.addClassName(t.COMPOSER_TEXTFORMAT_BUTTON),e.setDropDownWidgetGetter(this._doCreateDropDownPanel.bind(this)),e},_filterNodeLabelDisplayModeTargets:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r];i instanceof d.ChemStructureNode&&(i instanceof d.StructureFragment&&i.hasCtab(),t.push(i))}return t},_hasNodeLabelDisplayModeTarget:function(e){return!!this._filterNodeLabelDisplayModeTargets(e).length},_updateUiValuesFromStorage:function(e){this.getFontPanel()&&(this.getFontNameBox()&&this.getFontNameBox().setValue(e.fontName),this.getFontSizeBox()&&this.getFontSizeBox().setValue(e.fontSize),this.getTextDirectionBox()&&this.getTextDirectionBox().setValue(e.textDirection),this.getTextHorizontalAlignBox()&&this.getTextHorizontalAlignBox().setValue(e.textHAlign),this.getTextVerticalAlignBox()&&this.getTextVerticalAlignBox().setValue(e.textVAlign),this.getNodeLabelDisplayModeBox()&&this.getNodeLabelDisplayModeBox().setValue(e.nodeDisplayMode),this._nodeLabelDisplayModeGroup&&d.StyleUtils.setDisplay(this._nodeLabelDisplayModeGroup,e.hasNodeLabelDisplayModeTarget))},doLoadFromTargets:function(e,t){if(t&&t.length){var r=this._valueStorage;r.fontName=this.getRenderOptionValue(t,"fontFamily")||"",r.fontSize=this.getRenderOptionValue(t,"fontSize")||void 0,r.textDirection=this.getRenderOptionValue(t,"charDirection")||d.Render.TextDirection.DEFAULT,r.textHAlign=this.getRenderOptionValue(t,"horizontalAlign")||d.Render.TextAlign.DEFAULT,r.textVAlign=this.getRenderOptionValue(t,"verticalAlign")||d.Render.TextAlign.DEFAULT,r.nodeDisplayMode=this.getRenderOptionValue(this._filterNodeLabelDisplayModeTargets(t),"nodeDisplayMode")||d.Render.NodeLabelDisplayMode.DEFAULT,r.hasNodeLabelDisplayModeTarget=this._hasNodeLabelDisplayModeTarget(t),this.getFontPanel()&&this._updateUiValuesFromStorage(r)}},doApplyToTargets:function(e,t){},fillFontSizeBox:function(e){for(var t=this.getEditorConfigs().getStyleSetterConfigs().getListedFontSizes(),r=[{text:d.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:void 0}],n=0,i=t.length;n<i;++n)r.push({text:t[n]+" px",value:t[n]});e.setItems(r)},fillFontNameBox:function(e){for(var t=this.getEditorConfigs().getStyleSetterConfigs().getListedFontNames(),r=[{text:d.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:""}],n=0,i=t.length;n<i;++n)r.push({text:t[n],value:t[n]});e.setItems(r)},fillNodeDisplayModeBox:function(e){var t=d.Render.NodeLabelDisplayMode,r=[{text:d.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_DEFAULT"),value:t.DEFAULT},{text:d.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_SHOWN"),value:t.SHOWN},{text:d.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_HIDDEN"),value:t.HIDDEN},{text:d.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_SMART"),value:t.SMART}];e.setItems(r)}}),d.Editor.ObjModifierManager.register(d.ChemObject,[d.Editor.ObjModifier.RichText])}(),function(){"use strict";var e=d.ArrayUtils,t=d.DomUtils,r=(d.HtmlElementUtils,d.Widget.HtmlClassNames),n=d.ChemWidget.HtmlClassNames;d.ChemWidget.ComponentWidgetNames,d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{COMPOSER_ATOM_MODIFIER_BUTTON:"K-Chem-Composer-AtomModifier-Button",COMPOSER_ATOM_MODIFIER_DROPDOWN:"K-Chem-Composer-AtomModifier-DropDown",COMPOSER_BOND_MODIFIER_BUTTON:"K-Chem-Composer-BondModifier-Button",COMPOSER_BOND_MODIFIER_DROPDOWN:"K-Chem-Composer-BondModifier-DropDown",COMPOSER_CHARGE_MODIFIER_BUTTON:"K-Chem-Composer-ChargeModifier-Button",COMPOSER_CHARGE_MODIFIER_DROPDOWN:"K-Chem-Composer-ChargeModifier-DropDown"}),d.Editor.ObjModifier.ChemStructureModifier=Class.create(d.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.ChemStructureModifier",installValueChangeEventHandler:function(e){}}),d.Editor.ObjModifier.ChemStructureModifier.getCategories=function(){return[d.Editor.ObjModifier.Category.CHEM_STRUCTURE]},d.Editor.ObjModifier.Atom=Class.create(d.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Atom",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueStorage={}},initProperties:function(){this.defineProp("atomSetter",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new d.Widget.DropDownButton(this.getEditor());return e.setHint(d.$L("ChemWidgetTexts.HINT_ATOM_MODIFIER")),e.setText(d.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER")),e.setShowText(!0),e.setButtonKind(d.Widget.Button.Kinds.DROPDOWN),e.addClassName(n.COMPOSER_ATOM_MODIFIER_BUTTON),e.setDropDownWidgetGetter(this._createAtomSetter.bind(this)),e},_createAtomSetter:function(i){i||(i=this.getEditor());var o=this.getEditor(),a=new d.ChemWidget.StructureNodeSetter(i);a.addClassName([r.PANEL,n.COMPOSER_ATOM_MODIFIER_DROPDOWN,r.CORNER_ALL]),a.setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs());var s=i.getDocument().createElement("div");s.className=r.PANEL_CAPTION,t.setElementText(s,d.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER"));var l=a.getElement();l.insertBefore(s,d.DomUtils.getFirstChildElem(l));var u=e.clone(this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms());u.push("...");var c=o&&o.getEnabledNonAtomInputData&&o.getEnabledNonAtomInputData();a.setSelectableInfos({elementSymbols:u,nonElementInfos:c,subGroupRepItems:d.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems()});var h=this;return a.addEventListener("valueChange",(function(e){e.value&&h.applyToTargets(),a.dismiss()})),this.setPropStoreFieldValue("atomSetter",a),this._valueStorage.nodes&&a.setNodes(this._valueStorage.nodes),a},_filterStructureNodes:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r];i instanceof d.ChemStructureNode&&t.push(i)}return t},_getActualModificationNodes:function(t,r){for(var n=[],i=0,o=t.length;i<o;++i){var a=t[i];if(a instanceof d.StructureFragment&&a.isExpanded()){var s=this._getActualModificationNodes(a.getNodes(),!0);e.pushUnique(n,s)}else n.push(a)}return r||(n=this._filterStructureNodes(n)),n},doLoadFromTargets:function(e,t){var r,n=this._getActualModificationNodes(t);this._valueStorage.nodes=n,this.getAtomSetter()&&(this.getAtomSetter().setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs()),this.getAtomSetter().setNodes(n)),r=d.Editor.StructureUtils.getAllChemStructureNodesHtmlCode(n,null,null,this.getEditor().getRenderConfigs().getDisplayLabelConfigs()),this.getWidget().setText(r||d.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER_MIXED")).setShowText(!0).setDisplayed(!!n.length)},doApplyToTargets:function(e,t){for(var r,n=this.getAtomSetter().getValue(),i=[],o=this._getActualModificationNodes(t),a=0,s=o.length;a<s;++a){var l=o[a];if(l instanceof d.ChemStructureNode){var u=this._createNewDataToAtomOperation(n,l);u&&i.push(u)}}(r=i.length>1?new d.MacroOperation(i):i[0])&&this.getEditor().execOperation(r)},_createNewDataToAtomOperation:function(e,t){return d.Editor.OperationUtils.createNodeModificationOperationFromData(t,e,this.getEditor())},_createModificationOperation:function(e,t,r,n){return d.Editor.OperationUtils.createNodeModificationOperation(e,t,r,n,this.getEditor())}}),d.Editor.ObjModifier.Bond=Class.create(d.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Bond",initialize:function(e){this.tryApplySuper("initialize",[e]),this._activeSelBtnHtmlClass=null,this._defaultBondTypeData=null,this._valueStorage={};var t=this.getEditor().getEnabledBondFormData();this._defaultBondTypeData=t[0]},initProperties:function(){this.defineProp("bondSelector",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new d.Widget.DropDownButton(this.getEditor());return e.setHint(d.$L("ChemWidgetTexts.HINT_BOND_MODIFIER")),e.setText(d.$L("ChemWidgetTexts.CAPTION_BOND_MODIFIER")),e.setShowText(!1),e.setButtonKind(d.Widget.Button.Kinds.DROPDOWN),e.addClassName(n.COMPOSER_BOND_MODIFIER_BUTTON),e.setDropDownWidgetGetter(this._createBondSelector.bind(this)),this._defaultBondTypeData.htmlClass&&e.addClassName(this._defaultBondTypeData.htmlClass),e},_filterBond:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r];i instanceof d.Bond&&t.push(i)}return t},_getActualModificationBonds:function(t,r){for(var n=[],i=0,o=t.length;i<o;++i){var a=t[i];if(a instanceof d.StructureFragment&&a.isExpanded()){var s=this._getActualModificationBonds(a.getNodes(),!0);e.pushUnique(n,s),e.pushUnique(n,a.getConnectors())}else a instanceof d.Bond&&n.push(a)}return r||(n=this._filterBond(n)),n},_createBondSelector:function(e){e||(e=this.getEditor());var t=new d.ChemWidget.StructureConnectorSelectPanelAdv(e);if(t.setCaption(d.$L("ChemWidgetTexts.CAPTION_BOND_MODIFIER")),t.addClassName(n.COMPOSER_BOND_MODIFIER_DROPDOWN),this.getEditor().getEnabledBondFormData){var r=this.getEditor().getEnabledBondFormData();t.setBondPropNames(this._getBondComparePropNames(r)),t.setBondData(r);var i=this.getEditor().getEditorConfigs().getInteractionConfigs().getEnableBondKekulizeHucklize();t.setExtraComponents(i?[d.ChemWidget.StructureConnectorSelectPanelAdv.Components.KEKULIZE]:[])}this._valueStorage.bondsPropValues&&t.setActiveBondPropValues(this._valueStorage.bondsPropValues),this.setPropStoreFieldValue("bondSelector",t);var o=this;return t.addEventListener("valueChange",(function(e){o.applyToTargets(),t.dismiss()})),t.addEventListener("command",(function(e){o.execExtraCommand(e.command)})),t},_setActiveBondHtmlClass:function(e){var t=this._activeSelBtnHtmlClass;t&&this.getWidget().removeClassName(t),this._activeSelBtnHtmlClass=e,e||(e=this._defaultBondTypeData.htmlClass),e&&this.getWidget().addClassName(e)},_extractBondPropValues:function(e,t){return e.getPropValues(t)},_extractBondsPropValues:function(e,t){for(var r,n,i=0,o=e.length;i<o;++i)if(n=this._extractBondPropValues(e[i],t),r){if(!d.Editor.StructureUtils.isBondPropsMatch(r,n,t)){r=null;break}}else r=n;return r},_getBondComparePropNames:function(t){for(var r=[],n=0,i=t.length;n<i;++n){var o=t[n].bondProps;o&&e.pushUnique(r,d.ObjUtils.getOwnedFieldNames(o))}return r},_getMatchedBondData:function(e,t,r){if(!e)return null;for(var n=0,i=t.length;n<i;++n){var o=t[n];if(o&&d.Editor.StructureUtils.isBondPropsMatch(e,o.bondProps,r))return o}return null},_createBondModificationOperation:function(e,t){return new d.ChemObjOperation.Modify(t,e,this.getEditor())},_execModificationOperations:function(e){var t;(t=e.length>1?new d.MacroOperation(e):e[0])&&this.getEditor().execOperation(t)},doLoadFromTargets:function(e,t){var r=this.getEditor().getEnabledBondFormData();this._defaultBondTypeData=r[0];var n=this._getActualModificationBonds(t);if(this._valueStorage.connectors=n,this.getBondSelector()){var i=this.getBondSelector().getBondPropNames(),o=this._extractBondsPropValues(n,i);this.getBondSelector().setActiveBondPropValues(o),this._setActiveBondHtmlClass(this.getBondSelector().getActiveBondHtmlClass())}else{this._valueStorage.bondPropNames=this._getBondComparePropNames(r),this._valueStorage.bondsPropValues=this._extractBondsPropValues(n,this._valueStorage.bondPropNames);var a=this._getMatchedBondData(this._valueStorage.bondsPropValues,r,this._valueStorage.bondPropNames);this._setActiveBondHtmlClass(a&&a.htmlClass)}this.getWidget().setDisplayed(!!n.length)},doApplyToTargets:function(e,t){for(var r=this.getBondSelector().getActiveBondPropValues(),n=[],i=this._getActualModificationBonds(t),o=0,a=i.length;o<a;++o){var s=i[o],l=this._createBondModificationOperation(r,s);l&&n.push(l)}this._execModificationOperations(n),this._setActiveBondHtmlClass(this.getBondSelector().getActiveBondHtmlClass())},execExtraCommand:function(e){var t=this._getActualModificationBonds(this.getTargetObjs());if(t&&t.length){var r=this.getEditor().getChemObj();if(r&&r.getKekulizationChanges){var n,i=d.ChemWidget.StructureConnectorSelectPanelAdv.Commands;if(e===i.KEKULIZE?n=r.getKekulizationChanges(t):e===i.HUCKLIZE&&(n=r.getHucklizationChanges(t)),n&&n.length){for(var o=[],a=0,s=n.length;a<s;++a){var l=n[a].bond,u=n[a].bondOrder,c=this._createBondModificationOperation({bondOrder:u},l);o.push(c)}this._execModificationOperations(o)}}}},_getKekulizeOrHucklizeBondModifications:function(e){this.getEditor()}}),d.Editor.ObjModifier.Charge=Class.create(d.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Charge",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueStorage={}},initProperties:function(){this.defineProp("chargeSelector",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new d.Widget.DropDownButton(this.getEditor());return e.setHint(d.$L("ChemWidgetTexts.HINT_CHARGE_MODIFIER")).setText(d.$L("ChemWidgetTexts.TEXT_CHARGE_UNKNOWN")).setShowText(!0).setButtonKind(d.Widget.Button.Kinds.DROPDOWN),e.addClassName(n.COMPOSER_CHARGE_MODIFIER_BUTTON),e.setDropDownWidgetGetter(this._createChargeSelector.bind(this)),e},_createChargeSelector:function(e){e||(e=this.getEditor());var t=new d.ChemWidget.ChargeSelectPanel(e);t.setCaption(d.$L("ChemWidgetTexts.CAPTION_CHARGE_MODIFIER")),t.addClassName(n.COMPOSER_CHARGE_MODIFIER_DROPDOWN),d.ObjUtils.notUnset(this._valueStorage.charge)&&t.setValue(this._valueStorage.charge),this.setPropStoreFieldValue("chargeSelector",t);var r=this;return t.addEventListener("valueChange",(function(e){r.applyToTargets(),t.dismiss()})),t},_filterStructureNodes:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r];i instanceof d.ChemStructureNode&&i.getCharge&&t.push(i)}return t},_getActualModificationNodes:function(t,r){for(var n=[],i=0,o=t.length;i<o;++i){var a=t[i];if(a instanceof d.StructureFragment&&a.isExpanded()){var s=this._getActualModificationNodes(a.getNodes(),!0);e.pushUnique(n,s)}else n.push(a)}return r||(n=this._filterStructureNodes(n)),n},_getChargeOfNodes:function(e){for(var t=null,r=0,n=e.length;r<n;++r){var i=e[r];if(i.getCharge){var o=i.getCharge()||0;if(null===t)t=o;else if(t!==o)return null}}return t},doLoadFromTargets:function(e,t){var r=this._getActualModificationNodes(t),n=r.length>=0&&r.length<=1;if(n){var i,o=this._getChargeOfNodes(r);if(this._valueStorage.charge=o,this.getChargeSelector()&&this.getChargeSelector().setValue(o),o){var a=o>0?d.$L("ChemWidgetTexts.TEXT_CHARGE_POSITIVE"):d.$L("ChemWidgetTexts.TEXT_CHARGE_NEGATIVE"),s=d.NumUtils.toDecimals(o,1);i=Math.abs(s)+a}else i=d.$L("ChemWidgetTexts.TEXT_CHARGE_UNKNOWN");this.getWidget().setText(i).setShowText(!0)}this.getWidget().setDisplayed(n)},doApplyToTargets:function(e,t){for(var r,n=this.getChargeSelector().getValue(),i=[],o=this._getActualModificationNodes(t),a=(e=this.getEditor(),0),s=o.length;a<s;++a){var l=o[a];if(l instanceof d.ChemStructureNode){var u=new d.ChemObjOperation.Modify(l,{charge:n},e);u&&i.push(u)}}(r=i.length>1?new d.MacroOperation(i):i[0])&&(e=this.getEditor()).execOperation(r)}});var i=d.Editor.ObjModifierManager;i.register(d.ChemStructureNode,[d.Editor.ObjModifier.Atom]),i.register(d.ChemStructureNode,[d.Editor.ObjModifier.Charge]),i.register([d.Bond,d.StructureFragment],[d.Editor.ObjModifier.Bond])}(),function(){"use strict";var e=d.ObjUtils,t=d.ArrayUtils,r=(d.DomUtils,d.HtmlElementUtils,d.Widget.HtmlClassNames,d.ChemWidget.HtmlClassNames);d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{COMPOSER_GLYPH_PATH_MODIFIER_BUTTON:"K-Chem-Composer-GlyphPathModifier-Button",COMPOSER_Glyph_PATH_MODIFIER_DROPDOWN:"K-Chem-Composer-GlyphPathModifier-DropDown",COMPOSER_GLYPH_REACTION_ARROW_MODIFIER_BUTTON:"K-Chem-Composer-ReactionArrowModifier-Button",COMPOSER_GLYPH_ARC_PATH_MODIFIER_BUTTON:"K-Chem-Composer-ArcPathModifier-Button",COMPOSER_GLYPH_MULTI_ARC_PATH_MODIFIER_BUTTON:"K-Chem-Composer-MultiArcPathModifier-Button",COMPOSER_GLYPH_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON:"K-Chem-Composer-ElectronPushingArrowModifier-Button",COMPOSER_GLYPH_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON:"K-Chem-Composer-BondFormingElectronPushingArrowModifier-Button"}),d.Editor.ObjModifier.GlyphModifier=Class.create(d.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.GlyphModifier"}),d.Editor.ObjModifier.GlyphModifier.getCategories=function(){return[d.Editor.ObjModifier.Category.GLYPH]},d.Editor.ObjModifier.GlyphPath=Class.create(d.Editor.ObjModifier.GlyphModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.GlyphPath",MIX_VALUE:"[mixed]",initialize:function(e){this.tryApplySuper("initialize",[e]),this._valueStorage={}},initProperties:function(){this.defineProp("pathParamSetter",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var e=new d.Widget.DropDownButton(this.getEditor());return e.setHint(this.getModifierHint()),e.setText(this.getModifierCaption()),e.setShowText(!0),e.setButtonKind(d.Widget.Button.Kinds.DROPDOWN),e.addClassName(r.COMPOSER_GLYPH_PATH_MODIFIER_BUTTON+" "+this.getModifierClassName()),e.setDropDownWidgetGetter(this._createPathParamSetter.bind(this)),e},_createPathParamSetter:function(e){e||(e=this.getEditor());var t=new(this.getPathParamSetterClass())(e);t.setCaption(this.getModifierCaption()),t.addClassName(r.COMPOSER_GLYPH_PATH_MODIFIER_DROPDOWN),this.setPropStoreFieldValue("pathParamSetter",t),this._valueStorage.pathParams&&(t.setValue(this._valueStorage.pathParams),this._valueStorage.pathParams=null);var n=this;return t.addEventListener("showStateChange",(function(e){e.widget===t&&(e.isShown?n._lastOperation=null:e.isDismissed&&(n._lastOperation&&n._lastOperation.reverse(),n._lastOperation=null))})),t.addEventListener("valueChange",(function(e){e.widget===t&&(n.doModification(n.getEditor(),n.getTargetObjs(),!1),n._lastOperation=null,e.stopPropagation())})),t.addEventListener("valueInput",(function(e){e.widget===t&&(n.doModification(n.getEditor(),n.getTargetObjs(),!1),e.stopPropagation())})),t},getPathParamSetterClass:function(){return d.ChemWidget.GlyphPathSettingPanel},getModifierCaption:function(){return d.$L("ChemWidgetTexts.CAPTION_GLYPH_PATH_MODIFIER")},getModifierHint:function(){return d.$L("ChemWidgetTexts.HINT_GLYPH_PATH_MODIFIER")},getModifierClassName:function(){return""},_mergeHashValues:function(r,n){if(!r)return n;if(n){var i=e.getOwnedFieldNames(r,!1),o=e.getOwnedFieldNames(n,!1),a=t.clone(i);if(t.pushUnique(a,o),a.length){for(var s={},l=0,d=a.length;l<d;++l){var u=a[l],c=r[u],h=n[u];s[u]=c===h?c:this.MIX_VALUE}return s}return null}return r},_extractPathParamsOfObjs:function(e){for(var t=null,r=0,n=e.length;r<n;++r){var i=e[r],o=i instanceof d.Glyph.PathGlyphConnector?[i]:i instanceof d.Glyph.PathGlyph?i.getConnectors():null;if(o){var a=this._extractPathParamOfConnectors(o);t=this._mergeHashValues(t,a)}}return t},_extractPathParamOfConnectors:function(e){for(var t=null,r=0,n=e.length;r<n;++r){var i=this._extractPathParamOfConnector(e[r]);i&&(t=this._mergeHashValues(t,i))}return t},_extractPathParamOfConnector:function(e){return e.getPathParams&&e.getPathParams()},getApplicableGlyphClasses:function(){return[d.Glyph.PathGlyph]},isApplicableGlyph:function(e){if(this.getTargetPathGlyph(e)){var t=this.getApplicableGlyphClasses();if(t){for(var r=0,n=t.length;r<n;++r)if(e instanceof t[r])return!0;return!1}return!0}return!1},getTargetPathGlyph:function(e){return e instanceof d.Glyph.PathGlyph?e:e instanceof d.Glyph.PathGlyphConnector?e.getParent():null},_getActualModificationObjs:function(e){for(var r=[],n=0,i=e.length;n<i;++n){var o=e[n];this.isApplicableGlyph(o)&&t.pushUnique(r,o)}return r},_getActualModificationConnectors:function(e){for(var r=[],n=this._getActualModificationObjs(e),i=0,o=n.length;i<o;++i){var a=n[i];a instanceof d.Glyph.PathGlyphConnector?r.push(a):a instanceof d.Glyph.PathGlyph&&t.pushUnique(r,a.getConnectors())}return r},_getActualModificationGlyphs:function(e){for(var r=[],n=this._getActualModificationObjs(e),i=0,o=n.length;i<o;++i){var a=n[i],s=this.getTargetPathGlyph(a);s&&t.pushUnique(r,s)}return r},_filterAppliableParams:function(t){for(var r={},n=e.getOwnedFieldNames(t),i=0,o=n.length;i<o;++i){var a=t[n[i]];void 0!==a&&a!==this.MIX_VALUE&&(r[n[i]]=a)}return r},_splitPathParamValues:function(t){for(var r={},n=e.getOwnedFieldNames(t),i=0,o=n.length;i<o;++i){var a=n[i];if(!a.startsWith("_")){var s=this._getPathParamFieldCategory(a);r[s]||(r[s]={}),r[s][a]=t[a]}}return r},_getPathParamFieldCategory:function(e){return"connectorParams"},createModificationOperations:function(e,t,r){var n=this._splitPathParamValues(r);return this.doCreateModificationOperations(e,t,n)},doCreateModificationOperations:function(e,t,r){if(r.connectorParams){var n=this._getActualModificationConnectors(t);return this._createModificationOperationsOnConnectors(e,n,r.connectorParams)}return null},updateModificationOperations:function(e,t,r,n){var i,o=this._splitPathParamValues(r);return i=n.length?n:n instanceof d.MacroOperation?n.getChildren():[n],this.doUpdateModificationOperations(e,i,t,o)},doUpdateModificationOperations:function(e,t,r,n){return this._updateModificationOperationsOnConnectors(e,r,n.connectorParams,t),t},_updateModificationOperationsOnConnectors:function(e,t,r,n){for(var i=0,o=n.length;i<o;++i){var a=n[i],s=a.getTarget();s instanceof d.Glyph.PathGlyphConnector&&a instanceof d.ChemObjOperation.ModifyHashProp&&this._updateModificationOperationOnConnector(e,s,a,r)}},_updateModificationOperationOnConnector:function(e,t,r,n){t instanceof d.Glyph.PathGlyphConnector&&r instanceof d.ChemObjOperation.ModifyHashProp&&r.setNewPropValue(n)},_createModificationOperationsOnConnectors:function(e,t,r){for(var n=[],i=0,o=t.length;i<o;++i){var a=t[i];if(a instanceof d.Glyph.PathGlyphConnector){var s=this._createModificationOperationOnConnector(e,a,r);s&&n.push(s)}}return n},_createModificationOperationOnConnector:function(e,t,r){return t instanceof d.Glyph.PathGlyphConnector?new d.ChemObjOperation.ModifyHashProp(t,"pathParams",r,e):null},_createWrapperOperation:function(e){return e&&e.length>1?new d.MacroOperation(e):e[0]},_execModificationOperationInEditor:function(e){var t=!this._lastOperation,r=this.getEditor();r.beginManipulateAndUpdateObject();try{e&&(t?r.execOperation(e):e.execute())}finally{r.endManipulateAndUpdateObject(),this._lastOperation=e}},doModification:function(e,t,r){var n,i=this.getPathParamSetter().getValue();i=this._filterAppliableParams(i),n=this._lastOperation?this.updateModificationOperations(e,t,i,this._lastOperation):this.createModificationOperations(e,t,i);var o=this._createWrapperOperation(n);this._execModificationOperationInEditor(o)},doLoadFromTargets:function(e,t){var r=this._getActualModificationObjs(t),n=r.length>0;if(this._lastOperation=null,n){var i=this._extractPathParamsOfObjs(r);this._valueStorage.pathParams=i;var o=this.getPathParamSetter();o&&o.setValue(i)}this.getWidget().setDisplayed(n)},doApplyToTargets:function(e,t){this.doModification(e,t,!1)}}),d.Editor.ObjModifier.ReactionArrowAndSegmentPath=Class.create(d.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.ReactionArrowAndSegmentPath",MIX_VALUE:"[mixed]",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return d.ChemWidget.GlyphReactionArrowPathSettingPanel},getModifierCaption:function(){return d.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER")},getModifierHint:function(){return d.$L("ChemWidgetTexts.HINT_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_REACTION_ARROW_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[d.Glyph.StraightLine,d.Glyph.Segment,d.Glyph.ReactionArrow]},_extractPathParamsOfObjs:function(e){for(var t,r=this.tryApplySuper("_extractPathParamsOfObjs",[e]),n=0,i=e.length;n<i;++n){var o=e[n],a=this.getTargetPathGlyph(o);if(a&&a.getReactionType){var s=a.getReactionType();if(t){if(t!==s){t=d.Glyph.ReactionArrowType.CUSTOM;break}}else t=s}}return r.reactionArrowType=t,r},createModificationOperations_OLD:function(e,t,r){var n=[];if(r.reactionArrowType!==this.MIX_VALUE){for(var i=this._getActualModificationGlyphs(t),o=0,a=i.length;o<a;++o){var s=i[o];s.setReactionType?r.reactionArrowType||s instanceof d.Glyph.ReactionArrow&&n.push(new d.ChemObjOperation.ChangeClass(s,d.Glyph.Segment,e)):r.reactionArrowType&&s instanceof d.Glyph.StraightLine&&n.push(new d.ChemObjOperation.ChangeClass(s,d.Glyph.ReactionArrow,e))}n.push(new d.ChemObjOperation.Modify(s,{reactionType:r.reactionArrowType},e))}var l=this.tryApplySuper("createModificationOperations_OLD",[e,t,r])||[];return n.concat(l)},doCreateModificationOperations:function(e,t,r){var n=[],i=r.connectorParams;if(i.reactionArrowType!==this.MIX_VALUE){for(var o=this._getActualModificationGlyphs(t),a=0,s=o.length;a<s;++a){var l=o[a];l.setReactionType?i.reactionArrowType||l instanceof d.Glyph.ReactionArrow&&n.push(new d.ChemObjOperation.ChangeClass(l,d.Glyph.Segment,e)):i.reactionArrowType&&l instanceof d.Glyph.StraightLine&&n.push(new d.ChemObjOperation.ChangeClass(l,d.Glyph.ReactionArrow,e))}n.push(new d.ChemObjOperation.Modify(l,{reactionType:i.reactionArrowType},e))}var u=this.tryApplySuper("doCreateModificationOperations",[e,t,r])||[];return n.concat(u)}}),d.Editor.ObjModifier.ArcPath=Class.create(d.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.ArcPath",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return d.ChemWidget.GlyphArcPathSettingPanel},getModifierCaption:function(){return d.$L("ChemWidgetTexts.CAPTION_ARC_PATH_MODIFIER")},getModifierHint:function(){return d.$L("ChemWidgetTexts.HINT_ARC_PATH_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_ARC_PATH_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[d.Glyph.Arc]}}),d.Editor.ObjModifier.MultiArcPath=Class.create(d.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.MultiArcPath",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return d.ChemWidget.GlyphMultiArcPathSettingPanel},getModifierCaption:function(){return d.$L("ChemWidgetTexts.CAPTION_MULTI_ARC_PATH_MODIFIER")},getModifierHint:function(){return d.$L("ChemWidgetTexts.HINT_MULTI_ARC_PATH_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_MULTI_ARC_PATH_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[d.Glyph.TwinArc]},_filterAppliableParams:function(e){if(DataType.isArrayValue(e)){for(var t=[],r=0,n=e.length;r<n;++r)t.push(this.tryApplySuper("_filterAppliableParams",[e[r]]));return t}return this.tryApplySuper("_filterAppliableParams",[e])},_buildConnectorGroup:function(e,t){var r,n,i,o=[];t&&(r=new d.MapEx,o.map=r);for(var a=0,s=e.length;a<s;++a)for(var l=e[a],u=l instanceof d.Glyph.PathGlyphConnector?[l]:l instanceof d.Glyph.PathGlyph?l.getConnectors():[],c=0,h=u.length;c<h;++c){var p=u[c];(n=c,i=void 0,i=o[n],i||(i=[],o[n]=i),i).push(p),t&&r.set(p,c)}return o},_extractPathParamsOfObjs:function(e){for(var t=[],r=this._buildConnectorGroup(e),n=0,i=r.length;n<i;++n){var o=r[n]||[],a=this._extractPathParamOfConnectors(o)||null;t.push(a)}return t},_splitPathParamValues:function(t){if(DataType.isArrayValue(t)){for(var r=[],n=0,i=t.length;n<i;++n){var o=this.tryApplySuper("_splitPathParamValues",[t[n]]);if(o)for(var a=e.getOwnedFieldNames(o),s=0,l=a.length;s<l;++s){var d=a[s];r[d]||(r[d]=[]),r[d][n]=o[d]}}return r}return this.tryApplySuper("_splitPathParamValues",[t])},_updateModificationOperationsOnConnectors:function(e,t,r,n){for(var i=this._buildConnectorGroup(t,!0).map,o=0,a=n.length;o<a;++o){var s=n[o],l=s.getTarget();if(l instanceof d.Glyph.PathGlyphConnector&&s instanceof d.ChemObjOperation.ModifyHashProp){var u=i.get(l);u>=0&&this._updateModificationOperationOnConnector(e,l,s,r[u])}}},doCreateModificationOperations:function(e,r,n){var i=[];if(n.connectorParams)for(var o=t.toArray(n.connectorParams),a=this._buildConnectorGroup(r),s=0,l=a.length;s<l;++s){var d=o[s];if(d){var u=a[s]||[],c=this._createModificationOperationsOnConnectors(e,u,d);c&&(i=i.concat(c))}}return i}}),d.Editor.ObjModifier.BaseElectronPushingArrow=Class.create(d.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.BaseElectronPushingArrow",getPathParamSetterClass:function(){return null},getModifierCaption:function(){return null},getModifierHint:function(){return null},getModifierClassName:function(){return""},getApplicableGlyphClasses:function(){return[]},_extractPathParamsOfObjs:function(t){for(var r,n=this.tryApplySuper("_extractPathParamsOfObjs",[t]),i=0,o=t.length;i<o;++i){var a=t[i],s=this.getTargetPathGlyph(a);if(s&&s.getElectronCount){var l=s.getElectronCount();if(e.isUnset(r))r=l;else if(r!==l){r=0;break}}}return n.electronCount=r,n},_getPathParamFieldCategory:function(e){return"electronCount"===e?"glyphParams":this.tryApplySuper("_getPathParamFieldCategory",[e])},doCreateModificationOperations:function(e,t,r){var n=this.tryApplySuper("doCreateModificationOperations",[e,t,r])||[];if(r.glyphParams&&r.glyphParams.electronCount)for(var i=this._getActualModificationGlyphs(t),o=0,a=i.length;o<a;++o){var s=i[o];s.hasProperty("electronCount")&&n.push(new d.ChemObjOperation.Modify(s,{electronCount:r.glyphParams.electronCount},e))}return n},doUpdateModificationOperations:function(e,t,r,n){return this.tryApplySuper("doUpdateModificationOperations",[e,t,r,n]),this._updateGlyphModificationOperations(e,t,n),t},_updateGlyphModificationOperations:function(e,t,r){}}),d.Editor.ObjModifier.ElectronPushingArrow=Class.create(d.Editor.ObjModifier.BaseElectronPushingArrow,{CLASS_NAME:"Kekule.Editor.ObjModifier.ElectronPushingArrow",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return d.ChemWidget.GlyphElectronPushingArrowSettingPanel},getModifierCaption:function(){return d.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierHint:function(){return d.$L("ChemWidgetTexts.HINT_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[d.Glyph.ElectronPushingArrow]}}),d.Editor.ObjModifier.BondFormingElectronPushingArrow=Class.create(d.Editor.ObjModifier.MultiArcPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.BondFormingElectronPushingArrow",initialize:function(e){this.tryApplySuper("initialize",[e])},getPathParamSetterClass:function(){return d.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel},getModifierCaption:function(){return d.$L("ChemWidgetTexts.CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierHint:function(){return d.$L("ChemWidgetTexts.HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierClassName:function(){return r.COMPOSER_GLYPH_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[d.Glyph.BondFormingElectronPushingArrow]},_extractPathParamsOfObjs:function(t){for(var r,n=this.tryApplySuper("_extractPathParamsOfObjs",[t]),i=0,o=t.length;i<o;++i){var a=t[i],s=this.getTargetPathGlyph(a);if(s&&s.getElectronCount){var l=s.getConnectorCount()||1,d=Math.round((s.getElectronCount()||0)/l);if(e.isUnset(r))(r=d)<=0&&(r=1);else if(r!==d){r=0;break}}}return n.electronCount=r,n},_getPathParamFieldCategory:function(e){return"electronCount"===e?"glyphParams":this.tryApplySuper("_getPathParamFieldCategory",[e])},_filterAppliableParams:function(e){var t=this.tryApplySuper("_filterAppliableParams",[e])||[];return e.electronCount&&(t.electronCount=e.electronCount),t},_splitPathParamValues:function(e){var t=this.tryApplySuper("_splitPathParamValues",[e])||[];return e.electronCount&&(t.glyphParams||(t.glyphParams={}),t.glyphParams.electronCount=e.electronCount),t},doCreateModificationOperations:function(e,t,r){var n=this.tryApplySuper("doCreateModificationOperations",[e,t,r])||[];if(r.glyphParams&&r.glyphParams.electronCount)for(var i=this._getActualModificationGlyphs(t),o=0,a=i.length;o<a;++o){var s=i[o];if(s.hasProperty("electronCount")){var l=s.getConnectorCount()||1,u=Math.round(r.glyphParams.electronCount*l);u<=0&&(u=1),n.push(new d.ChemObjOperation.Modify(s,{electronCount:u},e))}}return n}});var n=d.Editor.ObjModifierManager;n.register([d.Glyph.StraightLine,d.Glyph.PathGlyphConnector],[d.Editor.ObjModifier.ReactionArrowAndSegmentPath]),n.register([d.Glyph.Arc],[d.Editor.ObjModifier.ArcPath]),n.register([d.Glyph.TwinArc],[d.Editor.ObjModifier.MultiArcPath]),n.register([d.Glyph.ElectronPushingArrow],[d.Editor.ObjModifier.ElectronPushingArrow]),n.register([d.Glyph.BondFormingElectronPushingArrow],[d.Editor.ObjModifier.BondFormingElectronPushingArrow])}(),function(){"use strict";var e=d.ErrorLevel;d.IssueCheck={},d.IssueCheck.IssueCode={ERROR_UNKNOWN:0,ERROR_ATOM_VALENCE_ABNORMAL:1101,ERROR_BOND_ORDER_EXCEED:1201};var t=d.IssueCheck.IssueCode;d.IssueCheck.CheckerIds={ATOM_VALENCE:"atomValence",BOND_ORDER:"bondOrder"};var r=d.IssueCheck.CheckerIds;d.IssueCheck.CheckerManager={_checkerMap:{},register:function(e,t){e||(e=ClassEx.getClassName(t));var r=n._checkerMap[e];r&&r.checkerClass===t||(n._checkerMap[e]={checkerClass:t})},unregister:function(e){n._checkerMap[e]=null},getCheckerClass:function(e){var t=n._checkerMap[e];return t&&t.checkerClass},getCheckerInstance:function(e){var t=null,r=n._checkerMap[e];if(r){if(!r.instance){var i=r.checkerClass;r.instance=new i}t=r.instance}return t}};var n=d.IssueCheck.CheckerManager;d.IssueCheck.Executor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.Executor",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("ignoreUnexposedObjs",{dataType:DataType.ARRAY}),this.defineProp("enabled",{dataType:DataType.BOOL}),this.defineProp("durationLimit",{dataType:DataType.NUMBER}),this.defineProp("allFinished",{dataType:DataType.BOOL,setter:null,serializable:!1}),this.defineProp("checkerIds",{dataType:DataType.ARRAY,setter:function(e){for(var t=[],r=d.ArrayUtils.toArray(e),i=0,o=r.length;i<o;++i){var a=n.getCheckerInstance(r[i]);a&&t.push(a)}this.setPropStoreFieldValue("checkers",t)}}),this.defineProp("checkers",{dataType:DataType.ARRAY,serializable:!1,setter:null})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setIgnoreUnexposedObjs(!0),this.setEnabled(!0)},doFinalize:function(){this.setPropStoreFieldValue("checkers",null),this.tryApplySuper("doFinalize")},execute:function(e,t){if(!this.getEnabled())return null;for(var r=this.getDurationLimit(),n=r&&Date.now()+r,i=this.doPrepareOptions(t),o=new d.MapEx,a=this.getCheckers(),s=[],l=0,u=a.length;l<u;++l)a[l].getEnabled()&&s.push(a[l]);this._getAllObjsNeedCheck(e,e,s,o,i);var c=!0,h=[];for(l=0,u=s.length;l<u;++l){var p=s[l];p.setDeadline(n);var g=o.get(p);if(g&&g.length){var f=p.check(g,e,i);f&&f.length&&(h=h.concat(f)),c=c&&p.getAllFinished()}}return this.setPropStoreFieldValue("allFinished",c),this.invokeEvent("execute",{checkResults:h,allFinished:c}),h},recheck:function(e,t,r,n){var i;if(r){i=[];for(var o=0,a=t.length;o<a;++o)t[o].isChildOf(r)&&i.push(t[o])}else i=t;return i.length?e.check(t,n||{}):null},doPrepareOptions:function(e){return options||{}},_getAllObjsNeedCheck:function(e,t,r,n,i){var o=!this.getIgnoreUnexposedObjs();if(this._isObjExposed(e)||o)for(var a=0,s=t.getChildCount();a<s;++a){var l=t.getChildAt(a);if(this._isObjExposed(l)||o){for(var d=0,u=r.length;d<u;++d){var c=r[d];if(c.applicable(l,e,i)){var h=n.get(c);h?h.push(l):(h=[l],n.set(c,h))}}this._getAllObjsNeedCheck(e,l,r,n,i)}}},_isObjExposed:function(e){return!e.isExposed||e.isExposed()}}),d.IssueCheck.CheckResult=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.CheckResult",DEF_ERROR_CODE:t.UNKNOWN,initialize:function(t,r,n,i,o){this.setPropStoreFieldValue("level",t||e.ERROR),this.setPropStoreFieldValue("code",r||this.DEF_ERROR_CODE),this.setPropStoreFieldValue("data",n),this.setPropStoreFieldValue("targets",i),this.setPropStoreFieldValue("reporter",o),this.tryApplySuper("initialize")},doFinalize:function(){this.setData(null),this.setTargets(null),this.setReporter(null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("level",{dataType:DataType.INT}),this.defineProp("code",{dataType:DataType.INT}),this.defineProp("data",{dataType:DataType.HASH}),this.defineProp("targets",{dataType:DataType.Array,serializable:!1}),this.defineProp("reporter",{dataType:DataType.OBJECTEX,serializable:!1}),this.defineProp("msg",{dataType:DataType.STRING,serializable:!1,setter:null,getter:function(){return this.getMessage()}})},getDataValue:function(e){return(this.getData()||{})[e]},getMessage:function(){return d.$L("ErrorCheckMsg.GENERAL_ERROR_WITH_CODE").format(this.getErrorCode())}}),d.IssueCheck.BaseChecker=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.BaseChecker",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL}),this.defineProp("deadline",{dataType:DataType.NUMBER,serializable:!1}),this.defineProp("allFinished",{dataType:DataType.BOOL,setter:null,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnabled(!0)},_createReport:function(e,t,r,n,i){return new e(t,r,n,i,this)},applicable:function(e,t,r){return this.doApplicable(e,t,r||{})},doApplicable:function(e,t,r){return!1},check:function(e,t,r){return this.doCheck(e,t,r||{})},doCheck:function(e,t,r){this.setPropStoreFieldValue("allFinished",!1);for(var n=[],i=this.getDeadline()||null,o=!1,a=0,s=e.length;a<s;++a){if(i&&Date.now()>=i){o=!0;break}var l=this.doCheckOnTarget(e[a],a,e,t,r)||[];n=n.concat(l)}return this.setPropStoreFieldValue("allFinished",!!o),n},doCheckOnTarget:function(e,t,r,n,i){}}),d.IssueCheck.AtomValenceChecker=Class.create(d.IssueCheck.BaseChecker,{CLASS_NAME:"Kekule.IssueCheck.AtomValenceChecker",initialize:function(){this.tryApplySuper("initialize")},doApplicable:function(e,t,r){return e instanceof d.Atom&&e.isNormalAtom()},doCheckOnTarget:function(e,t,r,n,i){var o=this.checkValence(e);return o?[o]:null},checkValence:function(r){var n=r.getValence(),i=r.getCharge()||0,o=this._getPossibleValences(r.getAtomicNumber(),i);return o.length&&o.indexOf(n)<0?this._createReport(d.IssueCheck.AtomValenceChecker.Result,e.ERROR,t.ERROR_ATOM_VALENCE_ABNORMAL,{currValence:n,possibleValences:o},[r]):null},_getPossibleValences:function(e,t){var r=[],n=d.ValenceUtils.getPossibleMdlValenceInfo(e,t);return n&&n.valences&&!n.unexpectedCharge&&(r=[].concat(n.valences)),r}}),n.register(r.ATOM_VALENCE,d.IssueCheck.AtomValenceChecker),d.IssueCheck.AtomValenceChecker.Result=Class.create(d.IssueCheck.CheckResult,{CLASS_NAME:"Kekule.IssueCheck.AtomValenceChecker.Result",DEF_ERROR_CODE:t.ERROR_ATOM_VALENCE_ABNORMAL,getMessage:function(){var e=this.getDataValue("currValence"),t=this.getDataValue("possibleValences"),r=t.length<=1?d.$L("ErrorCheckMsg.ATOM_VALENCE_ERROR_WITH_SUGGEST"):d.$L("ErrorCheckMsg.ATOM_VALENCE_ERROR_WITH_SUGGESTS"),n=this.getTargets()[0],i=(n.getId(),n.getLabel?n.getLabel():n.getSymbol()),o=t.join("/");return r.format(i,e,o)}}),d.IssueCheck.BondOrderChecker=Class.create(d.IssueCheck.BaseChecker,{CLASS_NAME:"Kekule.IssueCheck.BondOrderChecker",doApplicable:function(e,t,r){return e instanceof d.Bond&&e.isCovalentBond()},doCheckOnTarget:function(e,t,r,n,i){var o=this.checkBondOrder(e);return o?[o]:null},checkBondOrder:function(r){var n=r.getBondValence&&r.getBondValence();if(n){for(var i=r.getConnectedChemNodes(),o=0,a=0,s=i.length;a<s;++a){var l=this._getAllowedMaxBondOrder(i[a]);l>0&&(!o||l<o)&&(o=l)}if(o&&n>o)return this._createReport(d.IssueCheck.BondOrderChecker.Result,e.ERROR,t.ERROR_BOND_ORDER_EXCEED,{currOrder:n,maxOrder:o},[r])}return null},_getAllowedMaxBondOrder:function(e){var t=0;if(e instanceof d.Atom&&e.isNormalAtom()){var r=e.getValence(),n=d.AtomTypeDataUtil.getAllAtomTypes(e.getAtomicNumber());if(n)for(var i=0,o=n.length;i<o;++i)if(r<=n[i].bondOrderSum){t=n[i].maxBondOrder;break}}return t}}),n.register(r.BOND_ORDER,d.IssueCheck.BondOrderChecker),d.IssueCheck.BondOrderChecker.Result=Class.create(d.IssueCheck.CheckResult,{CLASS_NAME:"Kekule.IssueCheck.BondOrderChecker.Result",DEF_ERROR_CODE:t.ERROR_BOND_ORDER_EXCEED,getMessage:function(){for(var e=this.getDataValue("currOrder"),t=this.getDataValue("maxOrder"),r=this.getTargets()[0].getConnectedChemNodes(),n=[],i=0,o=r.length;i<o;++i){var a=r[i],s=a.getLabel&&a.getLabel();s&&n.push(s)}var l=n.length>1?n.join("-"):null;return l?d.$L("ErrorCheckMsg.BOND_WITH_ID_ORDER_EXCEED_ALLOWED_WITH_SUGGEST").format(l,e,t):d.$L("ErrorCheckMsg.BOND_ORDER_EXCEED_ALLOWED_WITH_SUGGEST").format(e,t)}})}(),function(){"use strict";d.IssueCheck.IssueCode=Object.extend(d.IssueCheck.IssueCode,{WARNING_NODE_TOO_CLOSE:2101});var e=d.IssueCheck.IssueCode;d.IssueCheck.CheckerIds=Object.extend(d.IssueCheck.CheckerIds,{NODE_DISTANCE_2D:"nodeDistance2D"});var t=d.IssueCheck.CheckerIds,r=d.IssueCheck.CheckerManager,n=d.CoordUtils;d.IssueCheck.ExecutorForEditor=Class.create(d.IssueCheck.Executor,{CLASS_NAME:"Kekule.IssueCheck.ExecutorForEditor",initialize:function(e){this.setPropStoreFieldValue("editor",e),this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1})},doPrepareOptions:function(e){var t=e?Object.create(e):{},r=this.getEditor();return r&&(t.editor=r),t}}),d.IssueCheck.IssueResolver=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.IssueResolver",initialize:function(){this.tryApplySuper("initialize")},createSolutions:function(e,t){return this.doCreateSolutions(e,t)},doCreateSolutions:function(e,t){return[]},_createSolutionInstance:function(e,t,r,n,i){return i||(i=d.IssueCheck.IssueSolution),new i(e,t,r,n)},_getEditorWidget:function(e){return e&&e instanceof d.Editor.BaseEditor?e:null}}),d.IssueCheck.IssueSolution=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.IssueSolution",initialize:function(e,t,r,n){this.setPropStoreFieldValue("issueResult",n),this.setPropStoreFieldValue("title",e),this.setPropStoreFieldValue("description",t),this.setPropStoreFieldValue("operation",r),this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("issueResult",{dataType:"Kekule.IssueCheck.CheckResult",serializable:!1}),this.defineProp("title",{dataType:DataType.STRING}),this.defineProp("description",{dataType:DataType.STRING}),this.defineProp("operation",{dataType:"Kekule.Operation",serializable:!1})},doFinalize:function(){var e=this.getOperation();e&&e.finalize(),this.tryApplySuper("doFinalize")}}),d.IssueCheck.ResolverManager={_resolverMap:new d.MapEx,_resolverInstanceMap:new d.MapEx,register:function(e,t){var r=i._resolverMap.get(e);r||(r=[],i._resolverMap.set(e,r)),r.indexOf(t)<0&&r.push(t)},unregister:function(e,t){var r=i._resolverMap.get(e),n=r.indexOf(t);n>=0&&r.splice(n,1)},getResolverClasses:function(e){return i._resolverMap.get(e)||[]},getResolverInstances:function(e){for(var t=[],r=i.getResolverClasses(e),n=0,o=r.length;n<o;++n){var a=r[n],s=i._resolverInstanceMap.get(a);s||(s=new a,i._resolverInstanceMap.set(a,s)),t.push(s)}return t}};var i=d.IssueCheck.ResolverManager;ClassEx.extend(d.IssueCheck.CheckResult,{getResolvers:function(){return i.getResolverInstances(this.getClass())},fetchSolutions:function(e){for(var t=this.getResolvers(),r=[],n=0,i=t.length;n<i;++n){var o=t[n].createSolutions(this,e);o&&o.length&&(r=r.concat(o))}return r}}),d.IssueCheck.BondOrderChecker.Resolver=Class.create(d.IssueCheck.IssueResolver,{CLASS_NAME:"Kekule.IssueCheck.BondOrderChecker.Resolver",doCreateSolutions:function(e,t){var r=e.getTargets()[0],n=r.getBondOrder(),i=e.getData().maxOrder,o=this._getEditorWidget(t);if(r&&i&&o){var a=new d.ChemObjOperation.Modify(r,{bondOrder:i},o),s=d.$L("ErrorCheckMsg.TITLE_CHANGE_BOND_ORDER_TO").format(i),l=d.$L("ErrorCheckMsg.DESCRIPTION_CHANGE_BOND_ORDER_TO").format(n,i);return[this._createSolutionInstance(s,l,a,e)]}return[]}}),i.register(d.IssueCheck.BondOrderChecker.Result,d.IssueCheck.BondOrderChecker.Resolver),d.IssueCheck.Node2DDistanceChecker=Class.create(d.IssueCheck.BaseChecker,{CLASS_NAME:"Kekule.IssueCheck.Node2DDistanceChecker",doApplicable:function(e,t,r){return t instanceof d.ChemSpace&&e instanceof d.ChemStructureNode&&(!(e instanceof d.Molecule)||!(e.isExpanded&&e.isExpanded))&&(!e.isExposed||e.isExposed())},doCheckOnTarget:function(e,t,r,n,i){for(var o=[],a=e,s=t+1,l=r.length;s<l;++s){var d=r[s];if(d){var u=this.doCheckDistance(a,d,n,i);u&&o.push(u)}}return o},doCheckDistance:function(t,r,n,i){var o=this._getDistanceRefLength(n)/5,a=i.editor,s=!!a&&a.getAllowCoordBorrow();return this._isNodesDistanceTooClose(t,r,o,s,a)?new d.IssueCheck.Node2DDistanceChecker.Result(d.ErrorLevel.WARNING,e.WARNING_NODE_TOO_CLOSE,null,[t,r],this):null},_getDistanceRefLength:function(e){return e.getDefAutoScaleRefLength()},_getEditor:function(e){return e.editor},_isNodesDistanceTooClose:function(e,t,r,n,i){if(i){var o=i.translateDistance(r,d.Render.CoordSystem.CHEM,d.Render.CoordSystem.SCREEN);return this._isNodesDistanceTooCloseByBound(e,t,r,o,i)}return this._getNodesDistanceByCoord(e,t,n)<distanceThreshold},_getNodesDistanceByCoord:function(e,t,r){var i=e.getAbsCoord2D(r),o=t.getAbsCoord2D(r);return n.getDistance(i,o)},_isNodesDistanceTooCloseByBound:function(e,t,r,i,o){d.Render.BoundShapeType;var a=d.Render.MetaShapeUtils,s=o.getChemObjBounds(e)[0],l=o.getChemObjBounds(t)[0];if(!s||!l)return!1;if(this._isPointOrCircleShape(s)&&this._isPointOrCircleShape(l))return n.getDistance(s.coords[0],l.coords[0])-(s.radius||0)-(s.radius||0)<i;if(this._isPointOrCircleShape(s)||this._isPointOrCircleShape(l)){var u=this._isPointOrCircleShape(s),c=u?s.coords[0]:l.coords[0],h=u?s.radius||0:l.radius||0,p=u?l:s,g=a.inflateShape(p,i);return a.getDistance(c,g)-h<0}for(var f=0,m=s.coords.length;f<m;++f){var C=s.coords[f];if(a.isCoordInside(C,l))return!0}for(f=0,m=l.coords.length;f<m;++f)if(C=l.coords[f],a.isCoordInside(C,s))return!0;return!1},_isPointOrCircleShape:function(e){var t=d.Render.BoundShapeType;return e.shapeType===t.POINT||e.shapeType===t.CIRCLE}}),r.register(t.NODE_DISTANCE_2D,d.IssueCheck.Node2DDistanceChecker),d.IssueCheck.Node2DDistanceChecker.Result=Class.create(d.IssueCheck.CheckResult,{CLASS_NAME:"Kekule.IssueCheck.NodeDistanceChecker.Result",DEF_ERROR_CODE:e.WARNING_NODE_TOO_CLOSE,getMessage:function(){var e=this.getTargets()[0],t=this.getTargets()[1],r=e.getLabel&&e.getLabel()||e.getId&&e.getId(),n=t.getLabel&&t.getLabel()||t.getId&&t.getId();return r&&r?d.$L("ErrorCheckMsg.NODE_DISTANCE_TOO_CLOSE_WITH_LABEL").format(r+"/"+n):d.$L("ErrorCheckMsg.NODE_DISTANCE_TOO_CLOSE")}}),d.IssueCheck.Node2DDistanceChecker.Resolver=Class.create(d.IssueCheck.IssueResolver,{CLASS_NAME:"Kekule.IssueCheck.Node2DDistanceChecker.Resolver",doCreateSolutions:function(e,t){var r=e.getTargets()[0],n=e.getTargets()[1],i=r.getLabel&&r.getLabel(),o=n.getLabel&&n.getLabel(),a=i===o;if(!i||a){var s=r.getId&&r.getId();s&&(i=i?i+"("+s+")":s)}if(!i||a){var l=n.getId&&n.getId();l&&(o=o?o+"("+l+")":l)}var u=this._getEditorWidget(t),c=[];if(r&&n&&u){var h=u.getEditorConfigs().getInteractionConfigs().getEnableStructFragmentMerge(),p=u.getEditorConfigs().getInteractionConfigs().getEnableNeighborNodeMerge();if(d.ChemStructOperation.MergeNodes.canMerge(r,n,h,p)){var g=new d.ChemStructOperation.MergeNodes(r,n,h,u);c.push(this._createSolutionInstance(d.$L("ErrorCheckMsg.TITLE_MERGE_TO").format(i,o),d.$L("ErrorCheckMsg.DESCRIPTION_MERGE_TO").format(i,o),g,e))}d.ChemStructOperation.MergeNodes.canMerge(n,r,h,p)&&(g=new d.ChemStructOperation.MergeNodes(n,r,h,u),c.push(this._createSolutionInstance(d.$L("ErrorCheckMsg.TITLE_MERGE_TO").format(o,i),d.$L("ErrorCheckMsg.DESCRIPTION_MERGE_TO").format(o,i),g,e)))}return c}}),i.register(d.IssueCheck.Node2DDistanceChecker.Result,d.IssueCheck.Node2DDistanceChecker.Resolver)}(),function(){"use strict";var e=d.DomUtils,t=d.HtmlElementUtils,r=d.Widget.HtmlClassNames,n=d.ChemWidget.HtmlClassNames;d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{CHECK_RESULT_LIST_VIEW:"K-Chem-CheckResultListView",CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED:"K-Chem-CheckResultListView-SolutionEnabled",CHECK_RESULT_LIST_VIEW_ITEM:"K-Chem-CheckResultListView-Item",CHECK_RESULT_LIST_VIEW_ITEM_BODY:"K-Chem-CheckResultListView-ItemBody",CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_SECTION:"K-Chem-CheckResultListView-Item-SolutionSection",CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_WIDGET:"K-Chem-CheckResultListView-Item-SolutionWidget",ISSUE_INSPECTOR:"K-Chem-IssueInspector",ISSUE_INSPECTOR_FLEX_LAYOUT:"K-Chem-IssueInspector-Flex-Layout",ISSUE_INSPECTOR_SUBPART:"K-Chem-IssueInspector-SubPart",ISSUE_INSPECTOR_LIST_PANEL:"K-Chem-IssueInspector-ListPanel"}),d.ChemWidget.CheckResultListView=Class.create(d.Widget.ListView,{CLASS_NAME:"Kekule.ChemWidget.CheckResultListView",initProperties:function(){this.defineProp("checkResults",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){this.setPropStoreFieldValue("checkResults",e),this._updateListView()}}),this.defineProp("selectedCheckResult",{dataType:"Kekule.IssueCheck.CheckResult",serializable:!1,setter:null,getter:function(){var e,t=this.getSelectedItem();return t&&(e=this.getItemData(t).checkResult),e}}),this.defineProp("enableIssueSolutions",{dataType:DataType.BOOL,setter:function(e){var t=!!e;this.getEnableIssueSolutions()!==t&&(this.setPropStoreFieldValue("enableIssueSolutions",t),t?this.addClassName(n.CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED):this.removeClassName(n.CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED))}}),this.defineProp("resolverCaller",{dataType:DataType.OBJECT,serialiazable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableSelect(!0).setEnableMultiSelect(!1).setLayout(d.Widget.Layout.VERTICAL)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.CHECK_RESULT_LIST_VIEW+" "+this._getSolutionEnableRelatedClassName()},getItemClassName:function(){return this.tryApplySuper("getItemClassName")+" "+n.CHECK_RESULT_LIST_VIEW_ITEM},_getSolutionEnableRelatedClassName:function(){return this.getEnableIssueSolutions()?n.CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED:""},selectionChanged:function(e,t){var r=this.tryApplySuper("selectionChanged",[e,t]);if(e&&this.getEnableIssueSolutions())for(var n=0,i=e.length;n<i;++n){var o=e[n],a=this.getItemData(o);a.solutions||(a.solutions=a.checkResult.fetchSolutions(this.getResolverCaller()),a.solutions&&this.doFillSolutionSection(o,a.solutions))}return r},createChildItem:function(e){var t;return t=e instanceof d.IssueCheck.CheckResult?this._wrapCheckResultToItemData(e):e,this.tryApplySuper("createChildItem",[t])},doCreateChildItem:function(e){var t=this.getDocument(),r=t.createElement("li"),i=t.createElement("span");i.className=n.CHECK_RESULT_LIST_VIEW_ITEM_BODY,r.appendChild(i);var o=t.createElement("span");return o.className=n.CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_SECTION,r._solutionSecElem=o,r.appendChild(o),r},doFillSolutionSection:function(t,r){if(r&&this.getEnableIssueSolutions())for(var n=this.getDocument(),i=0,o=r.length;i<o;++i)this.doCreateSolutionWidget(n,r[i],t).appendToElem(t._solutionSecElem);else e.clearChildContent(t._solutionSecElem)},doCreateSolutionWidget:function(e,t,r){var i=this,o=new d.Widget.Button(this);return o.addClassName(n.CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_WIDGET),o.setText(t.getTitle()).setHint(t.getDescription()),o.addEventListener("execute",(function(e){i.getEnableIssueSolutions()&&i.invokeEvent("resolveIssue",{solution:t,issueResult:t.getIssueResult()})})),o},setItemData:function(e,t){var r;r=t instanceof d.IssueCheck.CheckResult?this._wrapCheckResultToItemData(t):t,this.tryApplySuper("setItemData",[e,r])},doSetItemData:function(r,i){var o=this.getItemData(r);if(o&&o.className&&t.removeClass(r,o.className),i){var a=i;a.text&&e.setElementText(r.getElementsByClassName(n.CHECK_RESULT_LIST_VIEW_ITEM_BODY)[0],a.text),a.hint&&r.setAttribute("title",a.hint),a.className&&t.addClass(r,a.className),this.doFillSolutionSection(r,a.solutions)}},_wrapCheckResultToItemData:function(e){var t=e.getMessage();return{text:t,hint:t,className:this._getErrorLevelHtmlClass(e.getLevel()),checkResult:e,solutions:null}},_updateListView:function(){for(var e=this.getItems(),t=e.length,r=this.getCheckResults()||[],n=r.length,i=0;i<n;++i)i<t?this.setItemData(e[i],r[i]):this.appendItem(r[i]);if(t>n)for(i=t-1;i>=n;--i){var o=e[i];this.removeItem(o)}},_getErrorLevelHtmlClass:function(e){var t=d.ErrorLevel;return e===t.LOG||e===t.NOTE?r.MSG_INFO:e===t.WARNING?r.MSG_WARNING:r.MSG_ERROR}}),d.Editor.IssueInspector=Class.create(d.Widget.BaseWidget,{CLASS_NAME:"Kekule.Editor.IssueInspector",initialize:function(e){this._reactExecutorExecuteBind=this._reactExecutorExecute.bind(this),this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("issueCheckExecutor",{dataType:"Kekule.IssueCheck.Executor",serializable:!1,setter:function(e){var t=this.getIssueCheckExecutor();e!==t&&(this.setPropStoreFieldValue("issueCheckExecutor",e),this._issueCheckExecutorChanged(t,e))}}),this.defineProp("rootObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("checkResults",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getResultListView().getCheckResults()},setter:function(e){this.getResultListView().setCheckResults(e)}}),this.defineProp("selectedResult",{dataType:"Kekule.IssueCheck.CheckResult",serializable:!1,setter:null,getter:function(){return this.getResultListView().getSelectedResult()}}),this.defineProp("enableIssueSolutions",{dataType:DataType.BOOL,getter:function(){return this.getResultListView().getEnableIssueSolutions()},setter:function(e){this.getResultListView().setEnableIssueSolutions(e)}}),this.defineProp("resultListView",{dataType:"Kekule.ChemWidget.CheckResultListView",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("resolverCaller",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getResultListView().getResolverCaller()},setter:function(e){this.getResultListView().setResolverCaller(e)}})},doFinalize:function(){this._finalizeChildWidgets(),this.tryApplySuper("doFinalize")},_finalizeChildWidgets:function(){var e=this.getResultListView();e&&e.finalize(),this.setPropStoreFieldValue("resultListView",null)},_isUsingFlexLayout:function(){return!!d.BrowserFeature.cssFlex},doGetWidgetClassName:function(){var e=n.ISSUE_INSPECTOR;return this._isUsingFlexLayout()&&(e+=" "+n.ISSUE_INSPECTOR_FLEX_LAYOUT),e},getChildrenHolderElement:function(){return this._listPanelElem||this.tryApplySuper("getChildrenHolderElement")},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,r){var i=this.tryApplySuper("doCreateSubElements",[e,r])||[],o=this._createSubPartElem(e);return t.addClass(o,n.ISSUE_INSPECTOR_LIST_PANEL),this._listPanelElem=o,r.appendChild(o),i.push(o),this._createChildWidgets(),i},_createSubPartElem:function(e){var t=e.createElement("div");return t.className=n.ISSUE_INSPECTOR_SUBPART,t},_createChildWidgets:function(){this._finalizeChildWidgets();var e=new d.ChemWidget.CheckResultListView(this);e.setUseCornerDecoration(!0),e.appendToElem(this._listPanelElem);var t=this;e.addEventListener("selectionChange",(function(r){if(r.target===e){var n,i=r.selectedItem;i&&(n=e.getItemData(i).checkResult),t.invokeEvent("selectResult",{selectedResult:n})}})),this.setPropStoreFieldValue("resultListView",e)},_issueCheckExecutorChanged:function(e,t){e&&e.removeEventListener("execute",this._reactExecutorExecuteBind),t&&t.addEventListener("execute",this._reactExecutorExecuteBind)},_reactExecutorExecute:function(e){this.setCheckResults(e.checkResults)},deselect:function(){this.getResultListView().clearSelection()}})}(),function(){"use strict";var e=d.PropertyEditor.EditorAttributes;d.PropertyEditor.ChemIdEditor=Class.create(d.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemIdEditor",getAttributes:function(){var t=this.tryApplySuper("getAttributes");return t&e.MULTIOBJS&&(t^=e.MULTIOBJS),t}}),d.PropertyEditor.register(d.PropertyEditor.ChemIdEditor,null,d.ChemObject,"id"),d.PropertyEditor.ChemCoordSizeFieldEditor=Class.create(d.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordSizeFieldEditor",initProperties:function(){this.defineProp("parentObjects",{dataType:DataType.Object,serializable:!1}),this.defineProp("parentPropName",{dataType:DataType.STRING,serializable:!1})},getCoordFieldValue:function(e,t,r){if(e.length){var n=e[0].getPropValue(t);if(n){for(var i=n[r],o=1,a=e.length;o<a;++o)if(e[o].getPropValue(t)[r]!==i)return;return i}}},getValue:function(){var e=this.getParentObjects(),t=this.getParentPropName();return e&&t?this.getCoordFieldValue(e,t,this.getPropertyName()):this.tryApplySuper("getValue")}}),d.PropertyEditor.ChemCoordEditor=Class.create(d.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordEditor",is3DCoord:function(){return this.getPropertyName().indexOf("3")>=0},getFieldEditorClass:function(e,t){return d.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function(e,t){var r=this.tryApplySuper("createFieldEditor",[e,t]);return r.setParentObjects&&r.setParentObjects(this.getObjects()),r.setParentPropName&&r.setParentPropName(this.getPropertyName()),r},getFieldValueType:function(e,t){return DataType.FLOAT},getObjFields:function(e){return this.is3DCoord()?["x","y","z"]:["x","y"]},getValueText:function(){var e=d.Widget.ValueListEditor.ValueDisplayMode;if(this.getValueTextMode()===e.JSON)return this.tryApplySuper("getValueText");var t=this.getValue();if(t){for(var r=this.getObjFields(),n="",i=0,o=r.length;i<o;++i){var a=t[r[i]];d.ObjUtils.notUnset(a)&&(n&&(n+=", "),n+=r[i]+": "+a)}return"{"+n+"}"}return""}}),d.PropertyEditor.register(d.PropertyEditor.ChemCoordEditor,null,d.ChemObject,"coord2D"),d.PropertyEditor.register(d.PropertyEditor.ChemCoordEditor,null,d.ChemObject,"coord3D"),d.PropertyEditor.register(d.PropertyEditor.ChemCoordEditor,null,d.ChemObject,"absCoord2D"),d.PropertyEditor.register(d.PropertyEditor.ChemCoordEditor,null,d.ChemObject,"absCoord3D"),d.PropertyEditor.ChemSizeEditor=Class.create(d.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemSizeEditor",is3DSize:function(){return this.getPropertyName().indexOf("3")>=0},getFieldEditorClass:function(e,t){return d.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function(e,t){var r=this.tryApplySuper("createFieldEditor",[e,t]);return r.setParentObjects&&r.setParentObjects(this.getObjects()),r.setParentPropName&&r.setParentPropName(this.getPropertyName()),r},getFieldValueType:function(e,t){return DataType.FLOAT},getObjFields:function(e){return this.is3DSize()?["x","y","z"]:["x","y"]},getValueText:function(){var e=d.Widget.ValueListEditor.ValueDisplayMode;if(this.getValueTextMode()===e.JSON)return this.tryApplySuper("getValueText");var t=this.getValue();if(t){for(var r=this.getObjFields(),n="",i=0,o=r.length;i<o;++i){var a=t[r[i]];d.ObjUtils.notUnset(a)&&(n&&(n+=", "),n+=r[i]+": "+a)}return"{"+n+"}"}return""}}),d.PropertyEditor.register(d.PropertyEditor.ChemSizeEditor,null,d.ChemObject,"size2D"),d.PropertyEditor.register(d.PropertyEditor.ChemSizeEditor,null,d.ChemObject,"size3D"),d.PropertyEditor.register(d.PropertyEditor.ChemSizeEditor,null,d.ChemObject,"screenSize"),d.PropertyEditor.ChemOptionObjectEditor=Class.create(d.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemOptionObjectEditor",CHILD_FIELD_INFOS:null,initialize:function(){this.tryApplySuper("initialize"),this.setAllowEmpty(!0)},getObjFieldInfos:function(e){for(var t=ClassEx.getCommonSuperClass(this.getObjects()),r=[],n=this.CHILD_FIELD_INFOS,i=0,o=n.length;i<o;++i){var a=n[i];a.targetClass&&t&&!ClassEx.isOrIsDescendantOf(t,a.targetClass)||r.push(a)}return r.sort((function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})),r},notifyChildEditorValueChange:function(e,t){var r=this.getValue()||this._initialObjValue;r=Object.extend({},r),d.ObjUtils.notUnset(t)?r[e]=t:delete r[e],this.setValue(r)}}),d.PropertyEditor.ChemRender2DOptionsEditor=Class.create(d.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender2DOptionsEditor",CHILD_FIELD_INFOS:d.Render.RenderOptionUtils.getOptionDefinitions()}),d.PropertyEditor.register(d.PropertyEditor.ChemRender2DOptionsEditor,null,d.ChemObject,"renderOptions"),d.PropertyEditor.ChemRender3DOptionsEditor=Class.create(d.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender3DOptionsEditor",CHILD_FIELD_INFOS:d.Render.Render3DOptionUtils.getOptionDefinitions()}),d.PropertyEditor.register(d.PropertyEditor.ChemRender3DOptionsEditor,null,d.ChemObject,"render3DOptions"),d.PropertyEditor.GlyphPathParamsEditor=Class.create(d.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.GlyphPathParamsEditor",CHILD_FIELD_INFOS:[{name:"lineCount",dataType:DataType.INT,targetClass:d.Glyph.PathGlyphConnector},{name:"lineGap",dataType:DataType.FLOAT,targetClass:d.Glyph.PathGlyphConnector},{name:"startArrowType",dataType:DataType.STRING,enumSource:d.Glyph.ArrowType,targetClass:d.Glyph.PathGlyphConnector},{name:"startArrowSide",dataType:DataType.INT,enumSource:d.Glyph.ArrowSide,targetClass:d.Glyph.PathGlyphConnector},{name:"startArrowLength",dataType:DataType.FLOAT,targetClass:d.Glyph.PathGlyphConnector},{name:"startArrowWidth",dataType:DataType.FLOAT,targetClass:d.Glyph.PathGlyphConnector},{name:"endArrowType",dataType:DataType.INT,enumSource:d.Glyph.ArrowType,targetClass:d.Glyph.PathGlyphConnector},{name:"endArrowSide",dataType:DataType.INT,enumSource:d.Glyph.ArrowSide,targetClass:d.Glyph.PathGlyphConnector},{name:"endArrowLength",dataType:DataType.FLOAT,targetClass:d.Glyph.PathGlyphConnector},{name:"endArrowWidth",dataType:DataType.FLOAT,targetClass:d.Glyph.PathGlyphConnector}]}),d.PropertyEditor.register(d.PropertyEditor.GlyphPathParamsEditor,null,d.Glyph.PathGlyphConnector,"pathParams"),d.PropertyEditor.GlyphPathNodeParamsEditor=Class.create(d.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.GlyphPathNodeParamsEditor",CHILD_FIELD_INFOS:[{name:"useStickingOffset",dataType:DataType.BOOL,targetClass:d.Glyph.PathGlyphNode},{name:"stickingOffsetRelLength",dataType:DataType.FLOAT,targetClass:d.Glyph.PathGlyphNode}]}),d.PropertyEditor.register(d.PropertyEditor.GlyphPathNodeParamsEditor,null,d.Glyph.PathGlyphNode,"pathNodeParams")}(),function(){Class.PropertyScope;var e=d.ArrayUtils,t=(d.ChemWidget,d.Editor,d.Widget.HtmlClassNames),r=d.ChemWidget.HtmlClassNames,n=d.ChemWidget.ComponentWidgetNames;d.ChemWidget.HtmlClassNames=Object.extend(d.ChemWidget.HtmlClassNames,{COMPOSER:"K-Chem-Composer",COMPOSER_GRID_LAYOUT:"K-Chem-Composer-Grid-Layout",COMPOSER_LANDSCAPE:"K-Chem-Composer-Landscape",COMPOSER_PORTRAIT:"K-Chem-Composer-Portrait",COMPOSER_EDITOR_STAGE:"K-Chem-Composer-Editor-Stage",COMPOSER_ADV_PANEL:"K-Chem-Composer-Adv-Panel",COMPOSER_ISSUE_PANEL:"K-Chem-Composer-Issue-Panel",COMPOSER_ISSUE_PANEL_WRAPPER:"K-Chem-Composer-Issue-Panel-Wrapper",COMPOSER_ISSUE_PANEL_TOOL_PANEL:"K-Chem-Composer-Issue-Panel-ToolPanel",COMPOSER_ISSUE_PANEL_INSPECTOR_REGION:"K-Chem-Composer-Issue-Panel-InspectorRegion",COMPOSER_TOP_REGION:"K-Chem-Composer-Top-Region",COMPOSER_LEFT_REGION:"K-Chem-Composer-Left-Region",COMPOSER_BOTTOM_REGION:"K-Chem-Composer-Bottom-Region",COMPOSER_TOOLBAR:"K-Chem-Composer-Toolbar",COMPOSER_COMMON_TOOLBAR:"K-Chem-Composer-Common-Toolbar",COMPOSER_ZOOM_TOOLBAR:"K-Chem-Composer-Zoom-Toolbar",COMPOSER_CHEM_TOOLBAR:"K-Chem-Composer-Chem-Toolbar",COMPOSER_ASSOC_TOOLBAR:"K-Chem-Composer-Assoc-Toolbar",COMPOSER_STYLE_TOOLBAR:"K-Chem-Composer-Style-Toolbar",COMPOSER_OBJMODIFIER_TOOLBAR:"K-Chem-Composer-ObjModifier-Toolbar",COMPOSER_FONTNAME_BOX:"K-Chem-Composer-FontName-Box",COMPOSER_FONTSIZE_BOX:"K-Chem-Composer-FontSize-Box",COMPOSER_NODEDISPLAYMODE_BOX:"K-Chem-Composer-NodeDisplayMode-Box",COMPOSER_COLOR_BOX:"K-Chem-Composer-Color-Box",COMPOSER_TEXTDIRECTION_BUTTON:"K-Chem-Composer-TextDirection-Button",COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT:"K-Chem-Composer-TextDirection-Button-Default",COMPOSER_TEXTDIRECTION_BUTTON_LTR:"K-Chem-Composer-TextDirection-Button-LTR",COMPOSER_TEXTDIRECTION_BUTTON_RTL:"K-Chem-Composer-TextDirection-Button-RTL",COMPOSER_TEXTDIRECTION_BUTTON_TTB:"K-Chem-Composer-TextDirection-Button-TTB",COMPOSER_TEXTDIRECTION_BUTTON_BTT:"K-Chem-Composer-TextDirection-Button-BTT",COMPOSER_TEXTALIGN_BUTTON:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL:"K-Chem-Composer-TextAlign-Button-Horizontal",COMPOSER_TEXTALIGN_BUTTON_VERTICAL:"K-Chem-Composer-TextAlign-Button-Vertical",COMPOSER_TEXTALIGN_BUTTON_DEFAULT:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_LEADING:"K-Chem-Composer-TextAlign-Button-Leading",COMPOSER_TEXTALIGN_BUTTON_TRAILING:"K-Chem-Composer-TextAlign-Button-Trailing",COMPOSER_TEXTALIGN_BUTTON_CENTER:"K-Chem-Composer-TextAlign-Button-Center",COMPOSER_TEXTALIGN_BUTTON_LEFT:"K-Chem-Composer-TextAlign-Button-Left",COMPOSER_TEXTALIGN_BUTTON_RIGHT:"K-Chem-Composer-TextAlign-Right",COMPOSER_TEXTALIGN_BUTTON_TOP:"K-Chem-Composer-TextAlign-Top",COMPOSER_TEXTALIGN_BUTTON_BOTTOM:"K-Chem-Composer-TextAlign-Bottom",COMPOSER_DIALOG:"K-Chem-ComposerDialog",COMPOSER_FRAME:"K-Chem-ComposerFrame",COMPOSER_FRAME_CONTENT_DOC:"K-Chem-ComposerFrame-ContentDoc",COMPOSER_FRAME_CONTENT_BODY:"K-Chem-ComposerFrame-ContentBody"}),d.globalOptions.add("chemWidget.composer",{commonToolButtons:[n.newDoc,n.loadData,n.saveData,n.undo,n.redo,n.copy,n.cut,n.paste,n.zoomIn,n.zoomOut,n.config,n.objInspector],chemToolButtons:[n.manipulate,n.erase,n.molBond,n.molAtomAndFormula,n.molRing,n.molCharge,n.glyph,n.textImage],styleToolComponentNames:[n.fontName,n.fontSize,n.color,n.textDirection,n.textAlign]}),d.Editor.ComposerStyleToolbar=Class.create(d.Widget.Toolbar,{CLASS_NAME:"Kekule.Editor.ComposerStyleToolbar",ATOM_COLOR_SPECIAL_VALUE_INFO:{text:d.$L("ChemWidgetTexts.HINT_USE_ATOM_CUSTOM_COLOR"),value:"Atom",className:t.COLORPICKER_SPEC_COLOR_MIXED},LINKED_VALUE_FIELD:"__$value__",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("composer",e),this.createChildWidgets(),this.appendToWidget(e),this._relatedPropNames=e.getCoordMode()===d.CoordMode.COORD3D?["renderOptions","render3DOptions"]:["renderOptions"],this.getEditor().addEventListener("selectionChange",(function(e){this._isApplying||this.updateStyleValues()}),this),this.getEditor().addEventListener("editObjChanged",(function(e){var t=e.propNames;t&&t.length&&d.ArrayUtils.intersect(this._relatedPropNames,t).length&&(this._isApplying||this.updateStyleValues())}),this),this._isApplying=!1},doFinalize:function(){this.clearWidgets(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1,setter:null}),this.defineProp("fontNameBox",{dataType:"Kekule.Widget.ComboBox",serializable:!1,setter:null}),this.defineProp("fontSizeBox",{dataType:"Kekule.Widget.ComboBox",serializable:!1,setter:null}),this.defineProp("colorBox",{dataType:"Kekule.Widget.ColorDropButton",serializable:!1,setter:null}),this.defineProp("textDirectionButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:!1,setter:null}),this.defineProp("textHorizontalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:!1,setter:null}),this.defineProp("textVerticalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:!1,setter:null}),this.defineProp("fontName",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getFontNameBox()?this.getFontNameBox().getValue():null},setter:function(e){this.getFontNameBox()&&this.getFontNameBox().setValue(e)}}),this.defineProp("fontSize",{dataType:DataType.NUMBER,serializable:!1,getter:function(){return this.getFontSizeBox()?parseFloat(this.getFontSizeBox().getValue()):null},setter:function(e){this.getFontSizeBox()&&this.getFontSizeBox().setValue(e)}}),this.defineProp("color",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getColorBox()?this.getColorBox().getValue():void 0},setter:function(e){this.getColorBox()&&this.getColorBox().setValue(e)}}),this.defineProp("textDirection",{dataType:DataType.INT,serializable:!1,getter:function(){return this._getButtonSetLinkedValue(this.getTextDirectionButtonSet())},setter:function(e){this._setButtonSetLinkedValue(this.getTextDirectionButtonSet(),e)}}),this.defineProp("textHorizontalAlign",{dataType:DataType.INT,serializable:!1,getter:function(){return this._getButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet())},setter:function(e){this._setButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet(),e)}}),this.defineProp("textVerticalAlign",{dataType:DataType.INT,serializable:!1,getter:function(){return this._getButtonSetLinkedValue(this.getTextVerticalAlignButtonSet())},setter:function(e){this._setButtonSetLinkedValue(this.getTextVerticalAlignButtonSet(),e)}}),this.defineProp("componentNames",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("componentNames");return e||(e=this.getDefaultComponentNames(),this.setPropStoreFieldValue("componentNames",e)),e},setter:function(e){this.setPropStoreFieldValue("componentNames",e),this.recreateComponents()}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setShowGlyph(!0)},removeWidget:function(e,t){e===this.getFontNameBox()&&this.setPropStoreFieldValue("fontNameBox",null),e===this.getFontSizeBox()&&this.setPropStoreFieldValue("fontSizeBox",null),e===this.getColorBox()&&this.setPropStoreFieldValue("colorBox",null),e===this.getTextDirectionButtonSet()&&this.setPropStoreFieldValue("textDirectionButtonSet",null),e===this.getTextHorizontalAlignButtonSet()&&this.setPropStoreFieldValue("textHorizontalAlignButtonSet",null),e===this.getTextVerticalAlignButtonSet()&&this.setPropStoreFieldValue("textVerticalAlignButtonSet",null),this.tryApplySuper("removeWidget",[e,t])},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER_TOOLBAR+" "+r.COMPOSER_STYLE_TOOLBAR},getEditor:function(){return this.getComposer().getEditor()},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},createChildWidgets:function(e){e||(e=this.getComponentNames());for(var t=0,i=e.length;t<i;++t){var o=e[t];if(o===n.fontName){var a=new d.Widget.ComboBox(this);this.fillFontNameBox(a),a.addClassName(r.COMPOSER_FONTNAME_BOX),a.setHint(d.$L("ChemWidgetTexts.HINT_FONTNAME")),a.addEventListener("valueChange",(function(e){this.applyFontName()}),this),this.setPropStoreFieldValue("fontNameBox",a)}else if(o===n.fontSize)a=new d.Widget.ComboBox(this),this.fillFontSizeBox(a),a.addClassName(r.COMPOSER_FONTSIZE_BOX),a.setHint(d.$L("ChemWidgetTexts.HINT_FONTSIZE")),a.addEventListener("valueChange",(function(e){this.applyFontSize()}),this),this.setPropStoreFieldValue("fontSizeBox",a);else if(o===n.color){var s=new d.Widget.ColorDropButton(this);s.setHint(d.$L("ChemWidgetTexts.HINT_PICK_COLOR")),s.setShowText(!1),s.setSpecialColors([d.Widget.ColorPicker.SpecialColors.UNSET,this.ATOM_COLOR_SPECIAL_VALUE_INFO]),s.addClassName(r.COMPOSER_COLOR_BOX),s.addEventListener("valueChange",(function(e){this.applyColor()}),this),this.setPropStoreFieldValue("colorBox",s)}else if(o===n.textDirection){var l=d.Render.TextDirection,u=[{value:l.DEFAULT,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_DEFAULT"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT},{value:l.LTR,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_LTR"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_LTR},{value:l.RTL,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_RTL"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_RTL},{value:l.TTB,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_TTB"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_TTB},{value:l.BTT,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_BTT"),className:r.COMPOSER_TEXTDIRECTION_BUTTON_BTT}];(h=this._createStyleButtonSet(d.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION"),d.$L("ChemWidgetTexts.HINT_TEXT_DIRECTION"),r.COMPOSER_TEXTDIRECTION_BUTTON,u)).addEventListener("select",(function(e){this.applyTextDirection()}),this),this.setPropStoreFieldValue("textDirectionButtonSet",h)}else if(o===n.textAlign){var c,h;u=[{value:(c=d.Render.TextAlign).DEFAULT,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT"),className:r.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:c.LEADING,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING"),className:r.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:c.TRAILING,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING"),className:r.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:c.CENTER,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER"),className:r.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:c.LEFT,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEFT"),className:r.COMPOSER_TEXTALIGN_BUTTON_LEFT},{value:c.RIGHT,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_RIGHT"),className:r.COMPOSER_TEXTALIGN_BUTTON_RIGHT}],(h=this._createStyleButtonSet(d.$L("ChemWidgetTexts.CAPTION_TEXT_HORIZONTAL_ALIGN"),d.$L("ChemWidgetTexts.HINT_TEXT_HORIZONTAL_ALIGN"),r.COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL,u)).addEventListener("select",(function(e){this.applyTextHorizontalAlign()}),this),this.setPropStoreFieldValue("textHorizontalAlignButtonSet",h),u=[{value:(c=d.Render.TextAlign).DEFAULT,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT"),className:r.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:c.LEADING,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING"),className:r.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:c.TRAILING,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING"),className:r.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:c.CENTER,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER"),className:r.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:c.TOP,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TOP"),className:r.COMPOSER_TEXTALIGN_BUTTON_TOP},{value:c.BOTTOM,text:d.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_BOTTOM"),className:r.COMPOSER_TEXTALIGN_BUTTON_BOTTOM}],(h=this._createStyleButtonSet(d.$L("ChemWidgetTexts.CAPTION_TEXT_VERTICAL_ALIGN"),d.$L("ChemWidgetTexts.HINT_TEXT_VERTICAL_ALIGN"),r.COMPOSER_TEXTALIGN_BUTTON_VERTICAL,u)).addEventListener("select",(function(e){this.applyTextVerticalAlign()}),this),this.setPropStoreFieldValue("textVerticalAlignButtonSet",h)}}this.updateStyleValues()},_createStyleButtonSet:function(e,t,n,i){var o=new d.Widget.CompactButtonSet(this);if(o.setText(e),o.setHint(t),o.addClassName(n),o.setShowText(!1),o.setShowCompactMark(!1),o.setButtonKind(d.Widget.Button.Kinds.DROPDOWN),o.getButtonSet().addClassName(r.COMPOSER_STYLE_TOOLBAR),o.getButtonSet().setShowText(!0),i)for(var a=0,s=i.length;a<s;++a){var l=i[a],u=new d.Widget.RadioButton(o,l.text||"");u.setHint(l.hint||""),u.addClassName(l.className),u[this.LINKED_VALUE_FIELD]=l.value,o.append(u,l.selected)}return o},_getButtonSetLinkedValue:function(e){var t=e?e.getSelected():null;return t?t[this.LINKED_VALUE_FIELD]:void 0},_setButtonSetLinkedValue:function(e,t){if(e){var r=e.getButtonSet().getChildWidgets();e.setSelected(null);for(var n=0,i=r.length;n<i;++n){var o=r[n];if(o.hasOwnProperty(this.LINKED_VALUE_FIELD)&&o[this.LINKED_VALUE_FIELD]==t){e.setSelected(o);break}}}},getDefaultComponentNames:function(){return d.globalOptions.chemWidget.composer.styleToolComponentNames},recreateComponents:function(){var e=this.getComponentNames();this.clearWidgets(),this.createChildWidgets(e)},fillFontSizeBox:function(e){for(var t=this.getEditorConfigs().getStyleSetterConfigs().getListedFontSizes(),r=[{text:d.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:void 0}],n=0,i=t.length;n<i;++n)r.push({text:t[n]+" px",value:t[n]});e.setItems(r)},fillFontNameBox:function(e){for(var t=this.getEditorConfigs().getStyleSetterConfigs().getListedFontNames(),r=[{text:d.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:""}],n=0,i=t.length;n<i;++n)r.push({text:t[n],value:t[n]});e.setItems(r)},applyStyle:function(e,t,r){this._isApplying=!0;try{this.getEditor().modifyObjectsRenderOptions(e,t,r,!0)}finally{this._isApplying=!1}},getStyleValue:function(e,t,r){return d.Render.RenderOptionUtils.getCascadeRenderOptionValueOfObjs(e,t,r)},applyStyleToEditorSelection:function(e,t){var r=this.getEditor().getSelection();if(r&&r.length)return this.applyStyle(r,e,t)},applyFontName:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getFontName();this.applyStyle(e,{fontFamily:t})}},applyFontSize:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getFontSize();this.applyStyle(e,{fontSize:t})}},applyColor:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getColor();t===this.ATOM_COLOR_SPECIAL_VALUE_INFO.value?this.applyStyle(e,{useAtomSpecifiedColor:!0,color:void 0}):(t==d.Widget.ColorPicker.SpecialColors.UNSET&&(t=void 0),this.applyStyle(e,{useAtomSpecifiedColor:!1,color:t}))}},applyTextDirection:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getTextDirection();this.applyStyle(e,{charDirection:t})}},applyTextHorizontalAlign:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getTextHorizontalAlign();this.applyStyle(e,{horizontalAlign:t})}},applyTextVerticalAlign:function(e){if(e||(e=this.getEditor().getSelection()),e&&e.length){var t=this.getTextVerticalAlign();this.applyStyle(e,{verticalAlign:t})}},updateStyleValues:function(e){e||(e=this.getEditor().getSelection()),e&&e.length&&(this.updateFontName(e),this.updateFontSize(e),this.updateColor(e),this.updateTextDirection(e),this.updateTextHorizontalAlign(e),this.updateTextVerticalAlign(e))},updateFontName:function(e){if(e&&e.length&&this.getFontNameBox()){var t=this.getStyleValue(e,"fontFamily");this.setFontName(t||"")}},updateFontSize:function(e){if(e&&e.length&&this.getFontSizeBox()){var t=this.getStyleValue(e,"fontSize");this.setFontSize(t||void 0)}},updateColor:function(e){if(e&&e.length&&this.getColorBox()){var t=this.getStyleValue(e,"useAtomSpecifiedColor"),r=this.getStyleValue(e,"color");this.getColorBox().setColorClassName(null),r?this.getColorBox().setColorClassName(null):t&&(r=this.ATOM_COLOR_SPECIAL_VALUE_INFO.value,this.getColorBox().setColorClassName(this.ATOM_COLOR_SPECIAL_VALUE_INFO.className)),this.setColor(r||void 0)}},updateTextDirection:function(e){if(e&&e.length&&this.getTextDirectionButtonSet()){var t=this.getStyleValue(e,"charDirection");this.setTextDirection(t)}},updateTextHorizontalAlign:function(e){if(e&&e.length&&this.getTextHorizontalAlignButtonSet()){var t=this.getStyleValue(e,"horizontalAlign");this.setTextHorizontalAlign(t)}},updateTextVerticalAlign:function(e){if(e&&e.length&&this.getTextVerticalAlignButtonSet()){var t=this.getStyleValue(e,"verticalAlign");this.setTextVerticalAlign(t)}},updateState:function(){var e=this.getEditor(),t=e&&e.hasSelection();this.getFontNameBox()&&this.getFontNameBox().setEnabled(t),this.getFontSizeBox()&&this.getFontSizeBox().setEnabled(t),this.getColorBox()&&this.getColorBox().setEnabled(t),this.getTextDirectionButtonSet()&&this.getTextDirectionButtonSet().setEnabled(t),this.getTextHorizontalAlignButtonSet()&&this.getTextHorizontalAlignButtonSet().setEnabled(t),this.getTextVerticalAlignButtonSet()&&this.getTextVerticalAlignButtonSet().setEnabled(t)}}),d.Editor.ComposerObjModifierToolbar=Class.create(d.Widget.Toolbar,{CLASS_NAME:"Kekule.Editor.ComposerObjModifierToolbar",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("modifiers",[]),this.setPropStoreFieldValue("modifierMap",new d.MapEx),this.setPropStoreFieldValue("composer",e),this.appendToWidget(e),e.addEventListener("selectionChange",(function(e){this._isApplying||this.updateModifierValues()}),this),e.addEventListener("selectedObjsUpdated",(function(t){this._isApplying||(e.getEditor().isManipulatingObject()?this._suppressUpdateModifierValuesInManipulation=!0:this.updateModifierValues())}),this),e.addEventListener("endManipulateObject",(function(e){this._suppressUpdateModifierValuesInManipulation&&(this.updateModifierValues(),this._suppressUpdateModifierValuesInManipulation=!1)}),this),this._isApplying=!1},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1,setter:null}),this.defineProp("modifierMap",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("modifiers",{dataType:DataType.ARRAY,serializable:!1,setter:null})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setShowGlyph(!0)},doFinalize:function(){this.clearWidgets(),this.getModifierMap().finalize();for(var e=this.getModifiers(),t=0,r=e.length;t<r;++t)e[t].finalize();this.tryApplySuper("doFinalize")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER_TOOLBAR+" "+r.COMPOSER_OBJMODIFIER_TOOLBAR},getEditor:function(){return this.getComposer().getEditor()},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},getAllowedModifierCategories:function(){var e=this.getComposer();return e&&e.getAllowedObjModifierCategories()},getTargetObjs:function(){return this.getEditor().getSelection()},getAvailableModifierClasses:function(){for(var t=[],r=this.getTargetObjs(),n=0,i=r.length;n<i;++n)r[n].getClass&&e.pushUnique(t,r[n].getClass());var o=[],a=this.getAllowedModifierCategories();for(n=0,i=t.length;n<i;++n){var s=d.Editor.ObjModifierManager.getModifierClasses(t[n],a);s&&e.pushUnique(o,s)}return o.length&&o.sort((function(e,t){var r=e&&ClassEx.getPrototype(e),n=t&&ClassEx.getPrototype(t),i=r&&r.getModifierName&&r.getModifierName(),o=n&&n.getModifierName&&n.getModifierName();return i===o?0:i<o?-1:1})),o},getModifierInstanceOfClass:function(e,t){var r=this.getModifierMap(),n=r.get(e);return!n&&t&&(n=new e(this.getEditor()),r.set(e,n)),n},updateModifierWidgets:function(){var e=[];this.clearWidgets(!0);for(var r=this.getAvailableModifierClasses(),n=0,i=r.length;n<i;++n){var o=r[n],a=this.getModifierInstanceOfClass(o,!0),s=a.getWidget();s&&(this.appendWidget(s),e.push(a))}this.setPropStoreFieldValue("modifiers",e),this.updateModifierValues(),this._isAllModifierWidgetButtons(e)?this.removeClassName(t.TOOLBAR).addClassName(t.BUTTON_GROUP):this.removeClassName(t.BUTTON_GROUP).addClassName(t.TOOLBAR)},updateState:function(){this.updateModifierWidgets()},updateModifierValues:function(){for(var e=this.getModifiers(),t=0,r=e.length;t<r;++t)e[t].loadFromTargets()},_isAllModifierWidgetButtons:function(e){for(var t=0,r=e.length;t<r;++t){var n=e[t],i=n&&n.getWidget();if(i&&i.getDisplayed()&&!(i instanceof d.Widget.Button))return!1}return!0}}),d.Editor.Composer=Class.create(d.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.Editor.Composer",BINDABLE_TAG_NAMES:["div"],CHEM_TOOL_CHILD_FIELDS:"__$children__",initialize:function(e,t){this.updateSelectionAssocToolbarStateBind=this.updateSelectionAssocToolbarState.bind(this),this.setPropStoreFieldValue("enableIssueInspectorSolutions",!0),this.setPropStoreFieldValue("enableStyleToolbar",!0),this.setPropStoreFieldValue("enableObjModifierToolbar",!0),this.setPropStoreFieldValue("editor",t),this.setPropStoreFieldValue("editorNexus",new d.Editor.EditorNexus),this.tryApplySuper("initialize",[e]),this.bindEditor(t);var r=this.getEditor();r&&r.setChemObj(r.getChemObj()),this.getCommonBtnGroup()||this.createCommonToolbar(),this.getChemBtnGroup()||this.createChemToolbar(),this.getZoomBtnGroup()||this.createZoomToolbar(),this.uiLayoutChanged()},doFinalize:function(){var e=this.getIssueInspector();e&&e.finalize();var t=this.getStructureTreeView();t&&t.finalize();var r,n=this.getObjInspector();n&&n.finalize(),(r=this.getCommonBtnGroup())&&r.finalize(),(r=this.getChemBtnGroup())&&r.finalize();var i=this.getPropStoreFieldValue("editor");i&&i.finalize(),this.getEditorNexus().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("editor");return e||(e=this.createDefaultEditor(),this.setPropStoreFieldValue("editor",e)),e}}),this.defineProp("autoSetMinDimension",{dataType:DataType.BOOL}),this.defineProp("showObjInspector",{dataType:DataType.BOOL,getter:function(){return(this.getAdvPanelDisplayedComponents()||[]).indexOf("objInspector")>=0},setter:function(t){if(this.getShowObjInspector()!==t){var r=this.getAdvPanelDisplayedComponents()||[];r=t?["objInspector"]:e.exclude(r,"objInspector"),this.setAdvPanelDisplayedComponents(r)}}}),this.defineProp("showIssueInspector",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getAdvPanelDisplayedComponents()||[]).indexOf("issueInspector")>=0},setter:function(t){if(this.getShowIssueInspector()!==t){var r=this.getAdvPanelDisplayedComponents()||[];if(r=t?["issueInspector"]:e.exclude(r,"issueInspector"),this.setAdvPanelDisplayedComponents(r),t){var n=this.getEditor();n&&(n.getEnableAutoIssueCheck()||n.checkIssues(),n.getIssueCheckResults()&&n.getIssueCheckResults().length&&n.deselectAll())}else this.getIssueInspector().deselect()}}}),this.defineProp("enableIssueInspectorSolutions",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableIssueInspectorSolutions",!!e),this.getIssueInspector()&&this.getIssueInspector().setEnableIssueSolutions(this.getActualEnableIssueInspectorSolutions())}}),this.defineProp("showInspector",{dataType:DataType.BOOL,getter:function(){return this.getShowObjInspector()},setter:function(e){this.setShowObjInspector(e)}}),this.defineProp("advPanelDisplayedComponents",{dataType:DataType.ARRAY,serializable:!1,setter:function(e){this.setPropStoreFieldValue("advPanelDisplayedComponents",e),this.updateAdvPanelDisplayedComponents(e)}}),this.defineProp("editorStageElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("advPanelElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("objInspectorHolderElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("issueInspectorHolderElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("topRegionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("leftRegionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("bottomRegionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("editorNexus",{dataType:"Kekule.Editor.EditorNexus",serializable:!1,setter:null}),this.defineProp("objInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:!1,setter:null}),this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:!1,setter:null}),this.defineProp("issueInspector",{dataType:"Kekule.Editor.IssueInspector",serializable:!1,setter:null}),this.defineProp("commonBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("zoomBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("chemBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("assocBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("styleToolbar",{dataType:"Kekule.Widget.Toolbar",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("styleToolbar");return e||this.getEnableStyleToolbar()&&(e=this.createStyleToolbar(),this.setPropStoreFieldValue("styleToolbar",e)),e}}),this.defineProp("styleToolComponentNames",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getStyleToolbar();return e?e.getComponentNames():null},setter:function(e){var t=this.getStyleToolbar();return t&&t.setComponentNames(e),this}}),this.defineProp("enableStyleToolbar",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableStyleToolbar")&&!this.getEnableObjModifierToolbar()},setter:function(e){this.setPropStoreFieldValue("enableStyleToolbar",e),e&&this.setPropStoreFieldValue("enableObjModifierToolbar",!1),this.updateSelectionAssocToolbarState()}}),this.defineProp("objModifierToolbar",{dataType:"Kekule.Widget.Toolbar",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("objModifierToolbar");return e||this.getEnableObjModifierToolbar()&&(e=this.createObjModifierToolbar(),this.setPropStoreFieldValue("objModifierToolbar",e)),e}}),this.defineProp("enableObjModifierToolbar",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("enableObjModifierToolbar",e),e&&this.setPropStoreFieldValue("enableStyleToolbar",!1),this.updateSelectionAssocToolbarState()}}),this.defineProp("allowedObjModifierCategories",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("allowedObjModifierCategories",e),this.updateObjModifierToolbarState()}}),this.defineProp("commonToolButtons",{dataType:DataType.HASH,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("commonToolButtons");return e||(e=this.getDefaultCommonToolBarButtons(),this.setPropStoreFieldValue("commonToolButtons",e)),e},setter:function(e){this.setPropStoreFieldValue("commonToolButtons",e),this.updateCommonToolbar(),this.updateZoomToolbar()}}),this.defineProp("chemToolButtons",{dataType:DataType.HASH,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("chemToolButtons");return e||(e=this.getDefaultChemToolBarButtons(),this.setPropStoreFieldValue("chemToolButtons",e)),e},setter:function(e){this.setPropStoreFieldValue("chemToolButtons",e),this.updateChemToolbar()}}),this.defineProp("styleBarComponents",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("styleBarComponents");return e||(e=null,this.setPropStoreFieldValue("styleBarComponents",e)),e},setter:function(e){this.setPropStoreFieldValue("styleBarComponents",e),this.getStyleToolbar()&&this.getStyleToolbar().setComponentNames(e)}}),this.defineProp("commonActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("commonActions");return e||(e=new d.ActionList,this.setPropStoreFieldValue("commonActions",e)),e}}),this.defineProp("zoomActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("zoomActions");return e||(e=new d.ActionList,this.setPropStoreFieldValue("zoomActions",e)),e}}),this.defineProp("chemActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("chemActions");return e||(e=new d.ActionList,this.setPropStoreFieldValue("chemActions",e)),e}}),this.defineProp("actionMap",{dataType:"Kekule.MapEx",serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("actionMap");return e||(e=new d.MapEx,this.setPropStoreFieldValue("actionMap",e)),e}}),this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,getter:function(){var e=this.getEditor();return e&&e.getAllowCreateNewChild?e.getAllowCreateNewChild():null},setter:function(e){var t=this.getEditor();return t.setAllowCreateNewChild&&t.setAllowCreateNewChild(e),this}}),this.defineProp("allowAppendDataToCurr",{dataType:DataType.BOOL,getter:function(){var e=this.getEditor();return e&&e.getAllowAppendDataToCurr?e.getAllowAppendDataToCurr():null},setter:function(e){var t=this.getEditor();return t.setAllowAppendDataToCurr&&t.setAllowAppendDataToCurr(e),this}}),this._defineEditorDelegatedProp("chemObj"),this._defineEditorDelegatedProp("chemObjData"),this._defineEditorDelegatedProp("chemObjLoaded"),this._defineEditorDelegatedProp("renderType"),this._defineEditorDelegatedProp("renderConfigs"),this._defineEditorDelegatedProp("drawOptions"),this._defineEditorDelegatedProp("allowCoordBorrow"),this._defineEditorDelegatedProp("editorConfigs"),this._defineEditorDelegatedProp("operHistory"),this._defineEditorDelegatedProp("enableOperHistory"),this._defineEditorDelegatedProp("selection"),this._defineEditorDelegatedProp("hotTrackedObjs"),this._defineEditorDelegatedProp("enableOperContext"),this._defineEditorDelegatedProp("enableCreateNewDoc"),this._defineEditorDelegatedProp("enableLoadNewFile"),this._defineEditorDelegatedProp("enableIssueCheck"),this._defineEditorDelegatedProp("enableAutoIssueCheck"),this._defineEditorDelegatedProp("initOnNewDoc")},_defineEditorDelegatedProp:function(e,t){t||(t=e);var r=ClassEx.getPropInfo(d.Editor.BaseEditor,t),n=Object.create(r);return n.getter=null,n.setter=null,r.getter&&(n.getter=function(){return this.getEditor().getPropValue(t)}),r.setter&&(n.setter=function(e){this.getEditor().setPropValue(t,e)}),this.defineProp(e,n)},loadPredefinedResDataToProp:function(e,t,r){if("chemObj"===e)if(r)try{var n=d.IO.loadTypedData(t.data,t.resType,t.resUri);this.setChemObj(n)}catch(e){d.raise(e,d.ExceptionLevel.ERROR)}else d.throwException(d.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+t.resUri||"")},doCreateRootElement:function(e){return e.createElement("div")},doCreateSubElements:function(e,t){var n=[],i=this._doCreateSubElement(e,t,"div",r.COMPOSER_EDITOR_STAGE,"editorStageElem");return n.push(i),i=this._doCreateSubElement(e,t,"div",r.COMPOSER_ADV_PANEL,"advPanelElem"),this._doCreateSubElement(e,i,"div",null,"objInspectorHolderElem"),this._doCreateSubElement(e,i,"div",r.COMPOSER_ISSUE_PANEL,"issueInspectorHolderElem"),n.push(i),n.push(this._doCreateSubElement(e,t,"div",r.COMPOSER_TOP_REGION,"topRegionElem")),n.push(this._doCreateSubElement(e,t,"div",r.COMPOSER_LEFT_REGION,"leftRegionElem")),n.push(this._doCreateSubElement(e,t,"div",r.COMPOSER_BOTTOM_REGION,"bottomRegionElem")),n},_doCreateSubElement:function(e,t,r,n,i){var o=e.createElement(r);return n&&(o.className=n),t&&t.appendChild(o),i&&this.setPropStoreFieldValue(i,o),o},doGetWidgetClassName:function(){var e=this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER;return this._isUsingGridLayout()&&(e+=" "+r.COMPOSER_GRID_LAYOUT),e},_isUsingGridLayout:function(){return d.BrowserFeature.cssGrid},elementBound:function(e){this.setObserveElemResize(!0)},doWidgetShowStateChanged:function(e){this.tryApplySuper("doWidgetShowStateChanged",[e]),e&&this.adjustComponentPositions()},getResizerElement:function(){return this.getEditorStageElem()},getChildActionClass:function(e,t){var r=this.tryApplySuper("getChildActionClass",[e,t]);return r||(r=this.getEditor().getChildActionClass(e,t)),r},getCoordMode:function(){return this.getEditor().getCoordMode()},isDirty:function(){return this.getEditor().isDirty()},newDoc:function(){return this.getEditor().newDoc()},load:function(e){return this.getEditor().load(e)},loadFromData:function(e,t,r,n){return this.getEditor().loadFromData(e,t,r,n)},loadFromFile:function(e){return this.getEditor().loadFromFile(e)},getSavingTargetObj:function(){var e=this.getEditor();return e?e.getSavingTargetObj():null},getExportableClasses:function(){return this.getEditor().getExportableClasses()},exportObj:function(e){return this.getEditor().exportObj(e)},exportObjs:function(e){return this.getEditor().exportObjs(e)},undo:function(){return this.getEditor().undo()},redo:function(){return this.getEditor().redo()},undoAll:function(){return this.getEditor().undoAll()},canUndo:function(){return this.getEditor().canUndo()},canRedo:function(){return this.getEditor().canRedo()},repaint:function(e){return this.getEditor().repaint(e),this},getBoundEditorAction:function(e){var t;return"string"==typeof e?t=this.getCompActionClass(e):ClassEx.isClass(e)&&(t=e),t?this.getActionMap().get(t):null},execBoundEditorAction:function(e){var t=this.getBoundEditorAction(e);return t&&t.execute(),t},uiLayoutChanged:function(){this.adjustComponentPositions()},doResize:function(){this.adjustComponentPositions()},adjustComponentPositions:function(){var e=this.getCommonBtnGroup()?this.getCommonBtnGroup().getElement():null,t=this.getZoomBtnGroup()?this.getZoomBtnGroup().getElement():null,n=this.getChemBtnGroup()?this.getChemBtnGroup().getElement():null;if(e&&n){if(e)var i=d.HtmlElementUtils.getElemPageRect(e);if(t)var o=d.HtmlElementUtils.getElemPageRect(t);if(n)var a=d.HtmlElementUtils.getElemPageRect(n);if(i.width&&a.width){var s=i.height,l=a.width,u=o&&o.height||s,c=!this._isUsingGridLayout(),h=this.getTopRegionElem(),p=this.getBottomRegionElem(),g=this.getLeftRegionElem(),f=d.HtmlElementUtils.getElemPageRect(this.getElement()),m=(d.HtmlElementUtils.getElemPageRect(h),d.HtmlElementUtils.getElemPageRect(p).width-(o?o.width:0)),C=d.HtmlElementUtils.getElemPageRect(g).height-a.height,y=f.width;if(.85*f.height>y?(this.removeClassName(r.COMPOSER_LANDSCAPE),this.addClassName(r.COMPOSER_PORTRAIT)):(this.addClassName(r.COMPOSER_LANDSCAPE),this.removeClassName(r.COMPOSER_PORTRAIT)),c){(E=h.style).top="0px",E.left=l+"px",E.right="0px",E.height=s+"px",(E=p.style).bottom="0px",E.height=u+"px",E.left=l+"px",E.right="0px",(E=g.style).left="0px",E.top=s+"px",E.bottom="0px",E.width=l+"px";var _,E,T=s,O=l,v=u;if((this.getAdvPanelDisplayedComponents()||[]).length){var S=this.getAdvPanelElem();_=d.HtmlElementUtils.getElemPageRect(S).width}else _=0;(E=this.getEditorStageElem().style).position="absolute",E.top=T+"px",E.left=O+"px",E.bottom=v+"px",E.right=_+"px",(E=(S=this.getAdvPanelElem()).style).position="absolute",E.top=T+"px",E.bottom=v+"px"}if(C/m>.9?this.changeAssocToolbarRegion(!0):this.changeAssocToolbarRegion(!1),this.getAutoSetMinDimension()){var b={width:l+i.width,height:s+a.height};b.width&&b.height&&this.setMinDimension(b)}}}},adjustAssocToolbarPositions:function(){this.adjustStyleAndObjModifierToolbarPosition()},adjustStyleAndObjModifierToolbarPosition:function(){},bindEditor:function(e){e?e.setParent(this):e=this.getEditor(),e.setTouchAction("none");var t=this.getCommonActions();this.getChemActions(),this.createIaControllers(e),e.addEventListener("load",(function(e){this.updateAllActions(),this.updateUiWidgets();var t=this.getChemActions().getActionAt(0);t&&t.execute()}),this),e.addEventListener("operChange",(function(e){t.updateAll(),this.updateUiWidgets()}),this),e.addEventListener("selectionChange",(function(e){t.updateAll(),this.updateUiWidgets()}),this),e.addEventListener("change",(function(e){e.changedPropNames.indexOf("enableAutoIssueCheck")>=0&&this.getIssueInspector().setEnableIssueSolutions(this.getActualEnableIssueInspectorSolutions())}),this);var r=this;e.overwriteMethod("getChildAction",(function(e,t,n){var i=r._getCreatedNamedAction(t);return i||(i=e(t,n)),i})),e.appendToElem(this.getEditorStageElem()),this.getEditorNexus().setEditor(e)},createDefaultEditor:function(){var e=new d.Editor.ChemSpaceEditor(this,null,d.Render.RendererType.R2D);return e.addClassName(t.DYN_CREATED),e},createIaControllers:function(e){for(var t=d.Editor.IaControllerManager.getAvailableControllerClasses(e.getClass()),r=0,n=t.length;r<n;++r){var i=new(0,t[r])(e);e.addIaController(i.getDefId(),i)}},updateAdvPanelDisplayedComponents:function(e){if(e&&e.length){var t=e.indexOf("objInspector")>=0,r=e.indexOf("issueInspector")>=0;t||r?(t&&!this.getObjInspector()&&this._createObjInspectorControls(),r&&!this.getIssueInspector()&&this._createIssueInspectorControls(),this.getObjInspectorHolderElem().style.display=t?"block":"none",this.getIssueInspectorHolderElem().style.display=r?"block":"none",this.showAdvPanel()):this.hideAdvPanel()}else this.hideAdvPanel();this.uiLayoutChanged()},_createObjInspectorControls:function(e){e||(e=this.getObjInspectorHolderElem());var t=this.getDocument(),r=new d.ChemWidget.StructureTreeView(t);r.setItemInitialExpanded(!0),r.appendToElem(e),r.setParent(this),this.setPropStoreFieldValue("structureTreeView",r);var n=new d.Widget.ObjectInspector(t);n.setShowPropInfoPanel(!1),n.appendToElem(e),n.setParent(this),this.setPropStoreFieldValue("objInspector",n);var i=this.getEditorNexus();i.setObjectInspector(n),i.setStructureTreeView(r)},_createIssueInspectorControls:function(e){e||(e=this.getIssueInspectorHolderElem());var t=this.getDocument(),i=this._doCreateSubElement(t,e,"div",r.COMPOSER_ISSUE_PANEL_WRAPPER),o=this._doCreateSubElement(t,i,"div",r.COMPOSER_ISSUE_PANEL_TOOL_PANEL),a=this.getCommonActions();this.createToolButton(n.recheckIssues,this,a).setShowText(!1).setShowGlyph(!0).appendToElem(o),this.createToolButton(n.toggleShowAllIssues,this,a).setShowText(!1).setShowGlyph(!0).appendToElem(o);var s=this._doCreateSubElement(t,i,"div",r.COMPOSER_ISSUE_PANEL_INSPECTOR_REGION),l=new d.Editor.IssueInspector(t);l.appendToElem(s),l.setParent(this).setResolverCaller(this.getEditor()).setEnableIssueSolutions(this.getActualEnableIssueInspectorSolutions());var u=this;l.addEventListener("resolveIssue",(function(e){var t=e.solution;if(t){var r=t.getOperation();r&&u.getEditor().execOperation(r)}})),this.setPropStoreFieldValue("issueInspector",l),this.getEditorNexus().setIssueInspector(l)},getActualEnableIssueInspectorSolutions:function(){return this.getEnableIssueInspectorSolutions()&&this.getEnableAutoIssueCheck()},showAdvPanel:function(){this.getAdvPanelElem().style.display="block"},hideAdvPanel:function(){this.getAdvPanelElem().style.display="none"},getDefaultCommonToolBarButtons:function(){return d.globalOptions.chemWidget.composer.commonToolButtons},getZoomButtonNames:function(){return[n.zoomIn,n.zoomOut,n.reset,n.resetZoom]},getDefaultChemToolBarButtons:function(){return d.globalOptions.chemWidget.composer.chemToolButtons},getCompActionClass:function(e){return this.getChildActionClass(e,!0)},_getActionTargetWidget:function(e){return ClassEx.isOrIsDescendantOf(e,d.Editor.ActionOnComposer)||ClassEx.isOrIsDescendantOf(e,d.Widget.ActionOpenConfigWidget)?this:this.getEditor()},createToolButton:function(e,t,r,i){var o=null,a=DataType.isObjectValue(e)?e.name:e,s=this.getCompActionClass(a),l=this._createToolButtonAction(e,r,i);if(DataType.isObjectValue(e)&&!s){var u,c=i?d.Widget.RadioButton:d.Widget.Button;u=Object.extend({widget:c},e),o=d.Widget.Utils.createFromHash(t,u)}else{o=new(l.getPreferredWidgetClass&&l.getPreferredWidgetClass()||(e===n.objInspector||e===n.issueInspector?d.Widget.CheckButton:i?d.Widget.RadioButton:d.Widget.Button))(t)}return l&&(l.update(),o.setAction(l)),o},_createActionButton:function(e,t){var r=e.getCheckGroup(),n=new(e.getPreferredWidgetClass&&e.getPreferredWidgetClass()||(r?d.Widget.RadioButton:d.Widget.Button))(t);return e.update(),n.setAction(e),n},_createToolButtonAction:function(e,t,r){var n=DataType.isObjectValue(e),i=null,o=n?e.name:e,a=n?e.attached:null,s=this.getCompActionClass(o);if(n&&!s){var l=e;(s=l.actionClass)&&"string"==typeof s&&(s=ClassEx.findClass(l.actionClass))}if(s){var u=this.getActionMap();(i=u.get(s))||(i=new s(this._getActionTargetWidget(s)),n&&(e.text&&i.setText(e.text),e.hint&&i.setHint(e.hint),(e.htmlClass||e.htmlClassName)&&i.setHtmlClassName((i.getHtmlClassName()||"")+(e.htmlClass||e.htmlClassName))),u.set(s,i));var c=r||"",h=i.getExplicitGroup&&i.getExplicitGroup();if(d.ObjUtils.notUnset(h)&&(c=h),c&&i.setCheckGroup(c),i&&t&&t.add(i),i&&i.addAttachedAction){var p=i.getClassName(),g=d.ArrayUtils.clone(i.getAttachedActions().getActions()||[]),f=function(e,t,r,n,i){if(!t)return null;var o=r.indexOf(t);o>=0?r[o]=null:e.addAttachedAction(t,n),d.ObjUtils.notUnset(i)&&e.setAttachedActionIndex(t,i)};if(a)for(var m=0,C=a.length;m<C;++m){var y=a[m];f(i,E=this._createToolButtonAction(y,null,p),g,0===m,m)}else{var _=i.getAttachedActionClasses();if(_)for(m=0,C=_.length;m<C;++m){var E,T=_[m];if(!(E=u.get(T))){var O=(E=new T(this._getActionTargetWidget(T))).getExplicitGroup&&E.getExplicitGroup();d.ObjUtils.notUnset(O)?E.setCheckGroup(O):E.setCheckGroup(p),u.set(T,E)}f(i,E,g,0===m,m)}}if(g.length)for(m=0,C=g.length;m<C;++m){var v=g[m];v&&(i.removeAttachedAction(v),u.remove(v.getClass()))}}}return i},_getCreatedNamedAction:function(e){var t=this.getCompActionClass(e),r=this.getActionMap();return t&&r.get(t)},createInnerToolbar:function(e,n){var i=new d.Widget.ButtonGroup(this);i.addClassName(r.COMPOSER_TOOLBAR),i.addClassName(r.INNER_TOOLBAR),i.addClassName(t.DYN_CREATED),i.setShowText(!1),i.doSetShowGlyph(!0);var o=e||this.getElement();if(n){var a=d.DomUtils.getFirstChildElem(o);a?i.insertToElem(o,a):i.appendToElem(o)}else i.appendToElem(o);return i.setBubbleUiEvents(!0),i},createCommonToolbar:function(){var e=this.getTopRegionElem(),n=this.createInnerToolbar(e);n.addClassName(r.COMPOSER_COMMON_TOOLBAR);var i=this.getCommonToolButtons();i=d.ArrayUtils.exclude(i,this.getZoomButtonNames());var o=this.getCommonActions();this.getEditor(),o.clear();for(var a=0,s=i.length;a<s;++a){var l=i[a];this.createToolButton(l,n,o)}return this.setCommonBtnGroup(n),n.addClassName(t.DYN_CREATED),this.updateZoomToolbar(),this.adjustComponentPositions(),n},createZoomToolbar:function(){var e=d.ArrayUtils.intersect(this.getCommonToolButtons(),this.getZoomButtonNames());if(e.length){var n=this.getBottomRegionElem(),i=this.createInnerToolbar(n);i.addClassName(r.COMPOSER_ZOOM_TOOLBAR);var o=this.getZoomActions();this.getEditor(),o.clear();for(var a=0,s=e.length;a<s;++a){var l=e[a];this.createToolButton(l,i,o)}return this.setZoomBtnGroup(i),i.addClassName(t.DYN_CREATED),this.adjustComponentPositions(),i}return this.setZoomBtnGroup(null),null},updateCommonToolbar:function(){var e=this.getCommonBtnGroup();e&&e.finalize(),this.createCommonToolbar()},updateZoomToolbar:function(){var e=this.getZoomBtnGroup();e&&e.finalize(),this.createZoomToolbar()},createChemToolbar:function(){var e=this.getLeftRegionElem(),n=this.createInnerToolbar(e,!0);n.addClassName(r.COMPOSER_CHEM_TOOLBAR),n.setLayout(d.Widget.Layout.VERTICAL);var i=this.getChemToolButtons(),o=this.getChemActions();o.clear();for(var a,s=0,l=i.length;s<l;++s){var u=i[s],c=this.createToolButton(u,n,o,"chemTools");0===s&&(a=c)}if(this.setChemBtnGroup(n),n.addClassName(t.DYN_CREATED),this.adjustComponentPositions(),a){var h=a.getAction();if(h){h.setChecked(!0);var p=h.getAttachedActions&&h.getAttachedActions();this.bindAssocActions(p||null)}}return n},updateChemToolbar:function(){var e=this.getChemBtnGroup();e&&e.finalize(),this.createChemToolbar()},createAssocToolbar:function(){var e=this.getBottomRegionElem(),n=this.createInnerToolbar(e);return n.addClassName(r.COMPOSER_ASSOC_TOOLBAR),this.setAssocBtnGroup(n),this.adjustAssocToolbarPositions(),n.addClassName(t.DYN_CREATED),n},changeAssocToolbarRegion:function(e){var t,r=this.getAssocBtnGroup();if(r||(r=this.createAssocToolbar()),e)t=this.getLeftRegionElem(),r.getElement().parentNode!==t&&(r.setLayout(d.Widget.Layout.VERTICAL),r.appendToElem(t));else if(t=this.getBottomRegionElem(),r.getElement().parentNode!==t){r.setLayout(d.Widget.Layout.HORIZONTAL);var n=d.DomUtils.getFirstChildElem(t);t.insertBefore(r.getElement(),n)}},showAssocToolbar:function(){var e=this.getAssocBtnGroup();e||(e=this.createAssocToolbar());var t=this;return e.show(null,(function(){t.uiLayoutChanged(),setTimeout(t.updateSelectionAssocToolbarStateBind,0)})),this},hideAssocToolbar:function(){var e=this.getAssocBtnGroup();if(e){var t=this;e.hide(null,(function(){t.uiLayoutChanged(),setTimeout(t.updateSelectionAssocToolbarStateBind,0)}))}return this},isAssocToolbarShown:function(){var e=this.getAssocBtnGroup();return e&&e.isShown()},bindAssocActions:function(e){var t=this.getAssocBtnGroup();if(t||(t=this.createAssocToolbar()),t.clearWidgets(),e)for(var r=0,n=e.getActionCount();r<n;++r){var i=e.getActionAt(r);this._createActionButton(i,t)}},createObjModifierToolbar:function(){if(this.getEnableObjModifierToolbar()){var e=new d.Editor.ComposerObjModifierToolbar(this);return e.appendToElem(this.getBottomRegionElem()),e.setBubbleUiEvents(!0),this.setObjModifierToolbar(e),this.adjustAssocToolbarPositions(),this.updateObjModifierToolbarState(),e}return null},showObjModifierToolbar:function(){if(this.getEnableObjModifierToolbar()){var e=this.getObjModifierToolbar();if(!e.isShown()){var t=this;e.show(null,(function(){t.uiLayoutChanged()}))}}return this},hideObjModifierToolbar:function(){var e=this.getPropStoreFieldValue("objModifierToolbar");if(e&&e.isShown()){var t=this;e.hide(null,(function(){t.uiLayoutChanged()}),null,{instantly:!0})}return this},isObjModifierToolbarShown:function(){var e=this.getPropStoreFieldValue("objModifierToolbar");return e&&e.isShown()},updateObjModifierToolbarState:function(){var e=!1;this.getEnableObjModifierToolbar()&&this.needShowSelectionAssocToolbar()&&(e=!0),e?(this.showObjModifierToolbar(),this.getObjModifierToolbar().updateState()):this.hideObjModifierToolbar()},createStyleToolbar:function(){if(this.getEnableStyleToolbar()){var e=new d.Editor.ComposerStyleToolbar(this);return e.setComponentNames(this.getStyleBarComponents()),e.appendToElem(this.getBottomRegionElem()),e.setBubbleUiEvents(!0),this.setStyleToolbar(e),this.adjustAssocToolbarPositions(),this.updateStyleToolbarState(),e}return null},showStyleToolbar:function(){if(this.getEnableStyleToolbar()){var e=this.getStyleToolbar();if(!e.isShown()){var t=this;e.show(null,(function(){t.uiLayoutChanged()}))}}return this},hideStyleToolbar:function(){var e=this.getPropStoreFieldValue("styleToolbar");if(e&&e.isShown()){var t=this;e.hide(null,(function(){t.uiLayoutChanged()}))}return this},isStyleToolbarShown:function(){var e=this.getPropStoreFieldValue("styleToolbar");return e&&e.isShown()},updateStyleToolbarState:function(){this.getEnableStyleToolbar()&&this.needShowSelectionAssocToolbar()?(this.showStyleToolbar(),this.getStyleToolbar().updateState()):this.hideStyleToolbar()},needShowSelectionAssocToolbar:function(){var e=this.getEditor();return e&&e.hasSelection()},updateSelectionAssocToolbarState:function(){this.adjustStyleAndObjModifierToolbarPosition(),this.updateStyleToolbarState(),this.updateObjModifierToolbarState()},updateAllActions:function(){this.getCommonActions().updateAll(),this.getZoomActions().updateAll(),this.getChemActions().updateAll()},updateUiWidgets:function(){this.updateStyleToolbarState(),this.updateObjModifierToolbarState()},createConfigurator:function(){var e=this.tryApplySuper("createConfigurator");return e.addEventListener("configChange",(function(e){this.getEditor().repaint()}),this),e},react_keydown:function(e){if(!this.tryApplySuper("react_keydown",[e])&&this._isAcceptableHotKeyEvent(e))return!!this.getEditor().reactHotKeys(e)},_isAcceptableHotKeyEvent:function(e){var t=!1,r=e.getTarget();if(r&&r.tagName&&["input","select"].indexOf(r.tagName.toLowerCase())<0){var n=e.getKey()||"";t=d.Widget.KeyboardUtils.isPrintableKey(n)&&" "!==n||"Backspace"===n||"Delete"===n||"Del"===n}return t}}),d.Editor.Composer.getMinPreferredDimension=function(){return{width:630,height:350}},d.Editor.Composer.Settings=Class.create(d.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.Editor.Composer.Settings",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineDelegatedProps(["enableCreateNewDoc","enableLoadNewFile","initOnNewDoc","enableOperHistory","allowCreateNewChild","allowAppendDataToCurr","enableIssueCheck","enableStyleToolbar","enableObjModifierToolbar"])}}),d.Editor.Composer.Configurator=Class.create(d.Widget.Configurator,{CLASS_NAME:"Kekule.Editor.Composer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function(e){this.tryApplySuper("initialize",[e])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(d.Widget.Layout.HORIZONTAL)},getCategoryInfos:function(){for(var e=this.tryApplySuper("getCategoryInfos"),t=this.getComposer().getEditor(),r=[t.getDisplayerConfigs(),t.getRenderConfigs()],n=0,i=r.length;n<i;++n)for(var o=r[n],a=o.getPropListOfScopes([Class.PropertyScope.PUBLISHED]),s=0,l=a.getLength();s<l;++s){var d=a.getPropInfoAt(s),u=o.getPropValue(d.name);u&&e.push({obj:u,name:d.name,title:d.title,description:d.description})}return e},getComposer:function(){return this.getWidget()},getEditor:function(){return this.getComposer().getEditor()}}),d._registerAfterLoadSysProc((function(){var e=d.Editor.ObjModifier.Category,t=d.ObjPropSettingManager;t.register("Kekule.Editor.Composer.fullFunc",{enableObjModifierToolbar:!0,enableOperHistory:!0,enableLoadNewFile:!0,enableCreateNewDoc:!0,allowCreateNewChild:!0,commonToolButtons:null,chemToolButtons:null,styleToolComponentNames:null,allowedObjModifierCategories:null}),t.register("Kekule.Editor.Composer.molOnly",{enableObjModifierToolbar:!0,enableOperHistor:!0,enableLoadNewFile:!0,enableCreateNewDoc:!0,allowCreateNewChild:!0,commonToolButtons:null,chemToolButtons:[n.manipulate,n.erase,n.molBond,n.molAtom,n.molRing,n.molCharge],styleToolComponentNames:null,allowedObjModifierCategories:[e.GENERAL,e.CHEM_STRUCTURE]}),t.register("Kekule.Editor.Composer.compact",{enableObjModifierToolbar:!0,commonToolButtons:[n.newDoc,n.loadData,n.saveData,n.undo,n.redo,n.zoomIn,n.zoomOut],chemToolButtons:null,styleToolComponentNames:null,allowedObjModifierCategories:null}),t.register("Kekule.Editor.Composer.singleObj",{allowCreateNewChild:!1})})),d.Editor.ComposerDialog=Class.create(d.Widget.Dialog,{CLASS_NAME:"Kekule.Editor.ComposerDialog",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r||[d.Widget.DialogButtons.OK,d.Widget.DialogButtons.CANCEL]])},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1,setter:null}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,getter:function(){var e=this.getComposer();return e&&e.getChemObj()},setter:function(e){var t=this.getComposer();t&&t.setChemObj(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER_DIALOG},doCreateClientContents:function(e){this.tryApplySuper("doCreateClientContents");var t=this.doCreateComposerWidget();this.setPropStoreFieldValue("composer",t),t.appendToElem(e)},getSavingTargetObj:function(){var e=this.getComposer();return e?e.getSavingTargetObj():null},doCreateComposerWidget:function(){var e=new d.Editor.Composer(this);return e.addClassName(t.DYN_CREATED),e.setResizable&&e.setResizable(!0),e.getEditor().addClassName(t.DYN_CREATED),e}}),d.Editor.ComposerFrame=Class.create(d.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.Editor.ComposerFrame",BINDABLE_TAG_NAMES:["iframe"],initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null}),this.defineProp("frameDocument",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return this.getElement().contentDocument}}),this.defineProp("frameWindow",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return d.DocumentUtils.getDefaultView(this.getFrameDocument())}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMinDimension({width:550,height:350}),this.setEnableDimensionTransform(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.COMPOSER_FRAME},doCreateRootElement:function(e){return e.createElement("iframe")},doBindElement:function(e){this.tryApplySuper("doBindElement",[e]),e.parentNode||(this.setDisplayed(!1),e.ownerDocument.body.appendChild(e)),this._createComposerWidgetInFrame()},_initFrame:function(){var e=this.getFrameDocument();e.open("text/htmlreplace"),e.write("<!DOCTYPE html><html><head></head><body></body></html>"),e.close()},_createComposerWidgetInFrame:function(e){this._initFrame();var t=this,n=this.getFrameDocument();n.documentElement.className=r.COMPOSER_FRAME_CONTENT_DOC,n.body.className=r.COMPOSER_FRAME_CONTENT_BODY,d.X.Event.addListener(n.body,"kekuleload",(function(r){var i=new d.Editor.Composer(n);i.appendToElem(n.body),t.setPropStoreFieldValue("composer",i),e&&e(i)})),this._insertKekuleScriptAndStyleSheetFiles(n)},_insertKekuleScriptAndStyleSheetFiles:function(e,t){var r=e.head,n=e.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",d.getStyleSheetUrl()),r.appendChild(n),d.ScriptFileUtils.appendScriptFile(e,d.getScriptSrc(),t)}})}(),function(){"use strict";d.WebComponent={},d.globalOptions.add("webComponent.init",{shadowInitOptions:{mode:"open"}}),d.globalOptions.add("webComponent.widgetWrapper",{exposeWidgetProperties:!0,exposeWidgetMethods:!1,ignoredProperties:["id","draggable","droppable","innerHTML","style","offsetParent","offsetLeft","offsetTop","offsetWidth","offsetHeight"],ignoredMethods:["constructor","initialize","finalize","doFinalize","afterInitialization","initProperties","initPropValues","saved","loaded","invokeEvent"]}),d.WebComponent;var e=d.DomUtils;d.WebComponent.WebComponentContextEventRelayer=Class.create(d.Widget.BaseEventsReceiver,{CLASS_NAME:"Kekule.WebComponent.WebComponentContextEventRelayer",initialize:function(t,r,n){this._globalManager=n,this.tryApplySuper("initialize",[t,r]),this._isInShadow=r&&e.isInShadowRoot(r),this._globalManager.setHasWebComponentContext(!0)},isInShadow:function(){return this._isInShadow},reactUiEvent:function(e){var t=this.tryApplySuper("reactUiEvent",[e]);return this.isInShadow()&&(t=this._globalManager.reactUiEvent(e),e.stopPropagation()),t},reactDomNodeInsertEvent:function(e){return this.isInShadow()?(e.stopPropagation(),this._globalManager.reactDomNodeInsertEvent(e)):this.tryApplySuper("reactDomNodeInsertEvent",[e])},reactDomNodeRemoveEvent:function(e){return this.isInShadow()?(e.stopPropagation(),this._globalManager.reactDomNodeRemoveEvent(e)):this.tryApplySuper("reactDomNodeRemoveEvent",[e])},reactDomMutation:function(e){return this.isInShadow()?this._globalManager.reactDomMutation(e):this.tryApplySuper("reactDomMutation")}});var t=function(e){a(r,e);var t=s(r);function r(){var e;i(this,r);var n=(e=t.call(this)).attachShadow(d.globalOptions.webComponent.init.shadowInitOptions);return e._initStyles(n),e._importStyleSheet(n),e._createSubElements(n),new d.WebComponent.WebComponentContextEventRelayer(e.ownerDocument,e.hostElem,d.Widget.globalManager),e}return o(r,[{key:"_createSubElements",value:function(e){var t=this.ownerDocument.createElement("div");e.appendChild(t),this._hostElem=t}},{key:"_importStyleSheet",value:function(e){d.Widget.globalManager.loadTheme(e)}},{key:"_initStyles",value:function(e){var t=e.ownerDocument.createElement("style");t.innerHTML=":host { position: static; width: 0px; height: 0px; left: 0px; top: 0px; }",e.appendChild(t)}},{key:"ensureToBeLast",value:function(){var e=this.ownerDocument.body;e.lastChild!==this&&e.appendChild(this)}},{key:"hostElem",get:function(){return this._hostElem}}]),r}(l(HTMLElement));d.WebComponent.WebComponentContextPopupHost=t,"undefined"!=typeof customElements&&customElements.define("kekule-webcomponent-popup-host",t),d.WebComponent.widgetWrapperPopupHost=null,ClassEx.extend(d.Widget.GlobalManager,{getWebComponentContextRootElem:function(){return d.WebComponent.widgetWrapperPopupHost||(d.WebComponent.widgetWrapperPopupHost=new t,document.body.appendChild(d.WebComponent.widgetWrapperPopupHost)),d.WebComponent.widgetWrapperPopupHost.ensureToBeLast(),d.WebComponent.widgetWrapperPopupHost.hostElem},isWidgetEnvironmentSetupIn:function(e){return"webComponent"===e?!!this.getHasWebComponentContext():(this._docContextEnvironmentSetup||this._detectIfThemeLoaded(this.getDocContextRootElem())&&(this._docContextEnvironmentSetup=!0),this._docContextEnvironmentSetup)}}),ClassEx.extendMethod(d.Widget.GlobalManager,"getWidgetContextRootElement",(function(e,t){return t&&t.isWrappedInWebComponent()?this.getWebComponentContextRootElem():e(t)})),ClassEx.extendMethod(d.Widget.GlobalManager,"getDefaultContextRootElem",(function(e){return this.isWidgetEnvironmentSetupIn("document")?this.getDocContextRootElem():this.isWidgetEnvironmentSetupIn("webComponent")?this.getWebComponentContextRootElem():e()})),ClassEx.defineProp(d.Widget.GlobalManager,"hasWebComponentContext",{dataType:DataType.BOOL,serializable:!1}),ClassEx.extend(d.Widget.BaseWidget,{isWrappedInWebComponent:function(){if("undefined"==typeof ShadowRoot)return!1;var e=this.getElement(),t=e.getRootNode&&e.getRootNode();return!!(t&&t instanceof ShadowRoot)}}),d.WebComponent.BaseWidgetWrapper=function(e){a(r,e);var t=s(r);function r(){var e;i(this,r);var n=(e=t.call(this)).attachShadow(d.globalOptions.webComponent.init.shadowInitOptions);e._shadow=n;var o=e._createWidget(e.constructor.widgetClass,n);return e._prepareStyles(n),new d.WebComponent.WebComponentContextEventRelayer(e.ownerDocument,o.getElement(),d.Widget.globalManager),e._reflectingChangedAttributes=[],e}return o(r,[{key:"connectedCallback",value:function(){for(var e=this.getAttributeNames(),t=this.constructor.observedAttributes,r=0,n=(e=d.ArrayUtils.intersect(e,t)).length;r<n;++r){var i=this.getAttribute(e[r]);this._setWidgetPropValueFromAttribute(e[r],i)}}},{key:"attributeChangedCallback",value:function(e,t,r){if(!this._isChangingPropFromAttribute(e))try{this._reflectingChangedAttributes.push(e),this._setWidgetPropValueFromAttribute(e,r)}finally{d.ArrayUtils.remove(this._reflectingChangedAttributes,e)}}},{key:"_setWidgetPropValueFromAttribute",value:function(e,t){d.Widget.Utils.setWidgetPropFromElemAttrib(this.widget,e,t)}},{key:"_isChangingPropFromAttribute",value:function(e){return this._reflectingChangedAttributes.indexOf(e)>=0}},{key:"_createWidget",value:function(e,t){this._widget=new e(this.ownerDocument),this._widget.beginUpdate();try{var r=this._widget.getElement().style;r.width="100%",r.height="100%",this._widget.appendToElem(t)}finally{this._widget.endUpdate()}return this._widget}},{key:"_prepareStyles",value:function(e){d.Widget.globalManager.loadTheme(e);var t=e.ownerDocument.createElement("style");t.innerHTML=":host { display: inline-block; position: relative; vertical-align: bottom; }\n:host([hidden]) { display: none }",e.appendChild(t)}},{key:"_exposedPropValueChanged",value:function(e,t){if(this.widget.getPropInfo(e)&&DataType.isSimpleValue(t)){var r=e.dasherize();this.setAttribute(r,t)}}},{key:"widgetHost",get:function(){return this._shadow}},{key:"widget",get:function(){return this._widget}}],[{key:"observedAttributes",get:function(){var e=[];if(this._exposedWidgetProperties)for(var t=0,r=this._exposedWidgetProperties.length;t<r;++t){var n=this._exposedWidgetProperties[t].name;e.push(n.dasherize()),e.push("data-"+n.dasherize())}return e}},{key:"widgetClass",get:function(){return this._widgetClass},set:function(e){this._widgetClass=e}},{key:"_exposeWidgetProperties",value:function(e,t,r){for(var n=r||{},i=this.widgetClass,o=ClassEx.getAllPropList(i),a=[],s=[],l=0,u=o.getLength();l<u;++l){var c=o.getPropInfoAt(l);if(!(e&&e.indexOf(c.name)<0)&&!(t&&t.indexOf(c.name)>=0)&&(!d.ObjUtils.getPropertyDescriptor(this.prototype,c.name,!0)||n.overwriteExisitedProperties)){a.push(c);var h={enumerable:c.enumerable,configurable:!1};if(void 0===h.enumerable&&(h.enumerable=!0),c.getter){c.getter;var p="get"+c.name.upperFirst();!function(e,t){t.get=function(){return this.widget.getPropValue(e)}}(c.name,h),s.push(p)}if(c.setter){c.setter;var g="set"+c.name.upperFirst();!function(e,t){t.set=function(t){var r=this.widget.setPropValue(e,t),n=this.widget.getPropValue(e);return this._exposedPropValueChanged(e,n),r}}(c.name,h),s.push(g)}try{Object.defineProperty(this.prototype,c.name,h)}catch(e){throw e}}}return this._exposedWidgetProperties=a,{exposedPropInfos:a,getterSetterMethodNames:s}}},{key:"_exposeWidgetMethods",value:function(e,t,r){for(var n=this.widgetClass,i=(ClassEx.getPrototype(n),function e(t,r){var n=function(e){for(var t=ClassEx.getPrototype(e),r=ClassEx.getSuperClass(e),n=(r&&ClassEx.getPrototype(r),Object.getOwnPropertyNames(t)),i=[],o=0,a=n.length;o<a;++o){var s=n[o],l=Object.getOwnPropertyDescriptor(t,s);l&&l.value&&"function"==typeof l.value&&i.push(s)}return i}(t);if(t!==r){var i=ClassEx.getSuperClass(t);i&&(n=e(i,r).concat(n))}return n}(n,d.Widget.BaseWidget)),o=ClassEx.getPrototype(ClassEx.getSuperClass(d.Widget.BaseWidget)),a=[],s=0,l=i.length;s<l;++s){var u=i[s],c=e&&e.indexOf(u)>=0;if(!(t&&t.indexOf(u)>=0)&&!(e&&e.indexOf(u)<0)&&(c||!(u in o))&&(c||!u.startsWith("_"))&&!Object.getOwnPropertyDescriptor(u)){try{if(u in this)continue}catch(e){}!function(e,t,r){e.prototype[t]=function(){return this.widget[t].apply(this.widget,arguments)},r.push(t)}(this,u,a)}}return a}}]),r}(l(HTMLElement)),d.WebComponent.Utils={wrapWidget:function(e,t,r){var n,l=d.globalOptions.webComponent.widgetWrapper,u=Object.extend({exposeWidgetProperties:l.exposeWidgetProperties,ignoredProperties:l.ignoredProperties,exposeWidgetMethods:l.exposeWidgetMethods,ignoredMethods:l.ignoredMethods},r||{}),c=function(e){a(r,e);var t=s(r);function r(){return i(this,r),t.call(this)}return o(r)}(d.WebComponent.BaseWidgetWrapper);if(c.widgetClass=e,u.exposeWidgetProperties&&(n=c._exposeWidgetProperties(u.exposedProperties,u.ignoredProperties,{overwriteExisitedProperties:u.overwriteExisitedProperties})),u.exposeWidgetMethods){var h=u.ignoredMethods||[];n&&(h=h.concat(n.getterSetterMethodNames)),c._exposeWidgetMethods(u.exposedMethods,h,{})}return t&&"undefined"!=typeof customElements&&customElements.define(t,c),c}}}(),function(){"use strict";var e=[{widgetClassName:"Kekule.ChemWidget.PeriodicTable",htmlTagName:"kekule-periodic-table"},{widgetClassName:"Kekule.ChemWidget.Viewer",htmlTagName:"kekule-viewer"},{widgetClassName:"Kekule.ChemWidget.Viewer2D",htmlTagName:"kekule-viewer2d"},{widgetClassName:"Kekule.ChemWidget.Viewer3D",htmlTagName:"kekule-viewer3d"},{widgetClassName:"Kekule.ChemWidget.ChemObjInserter",htmlTagName:"kekule-chem-obj-inserter"},{widgetClassName:"Kekule.Editor.Composer",htmlTagName:"kekule-composer"}];d._registerAfterLoadSysProc((function(){for(var t=d.WebComponent,r=0,n=e.length;r<n;++r){var i=e[r],o=Object.getCascadeFieldValue(i.widgetClassName,d.$jsRoot),a=i.htmlTagName;if(o&&a){var s=d.ClassUtils.getLastClassName(i.widgetClassName),l=d.WebComponent.Utils.wrapWidget(o,a);t[s]=l}}}))}(),function(){"use strict";var e=d.ArrayUtils;d.GraphElement=Class.create(ObjectEx,{CLASS_NAME:"Kekule.GraphElement",initialize:function(){this.tryApplySuper("initialize"),this._data={}},initProperties:function(){this.defineProp("storedData",{dataType:DataType.HASH,getter:function(){return this._data},setter:function(e){this._data=e||{}}})},getData:function(e){return e?this._data[e]:this._data},setData:function(e,t){return e&&(this._data[e]=t),this},removeData:function(e){return this._data[e]&&delete this._data[e],this}}),d.GraphVertex=Class.create(d.GraphElement,{CLASS_NAME:"Kekule.GraphVertex",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("edges",[])},initProperties:function(){this.defineProp("edges",{dataType:DataType.ARRAY,serializable:!1,setter:null})},getEdgeCount:function(){return this.getEdges().length},getNeighbors:function(){for(var t=[],r=this.getEdges(),n=0,i=r.length;n<i;++n){var o=r[n].getVertexes();e.pushUnique(t,e.exclude(o,this))}return t},getNeighborOnEdge:function(e){for(var t=e.getVertexes(),r=0,n=t.length;r<n;++r)if(t[r]!==this)return t[r]},getEdgeTo:function(e){for(var t=this.getEdges(),r=0,n=t.length;r<n;++r)if(t[r].getVertexes().indexOf(e)>=0)return t[r];return null},doAppendEdge:function(e){return d.ArrayUtils.pushUnique(this.getEdges(),e),this},doRemoveEdge:function(e){return d.ArrayUtils.remove(this.getEdges(),e),this},doClearEdges:function(){for(var e=this.getEdges(),t=e.length-1;t>=0;--t)this.removeEdge(e[t]);return this}}),d.GraphEdge=Class.create(d.GraphElement,{CLASS_NAME:"Kekule.GraphEdge",initialize:function(){this.setPropStoreFieldValue("weight",1),this.tryApplySuper("initialize"),this.setPropStoreFieldValue("vertexes",[])},initProperties:function(){this.defineProp("vertexes",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("weight",{dataType:DataType.NUMBER})},replaceVertex:function(e,t){var r=this.getVertexes(),n=r.indexOf(e),i=r.indexOf(t);n<0||i>=0||(r.splice(n,1,t),e.doRemoveEdge(this),t.doAppendEdge(this))}}),d.GraphTraverseMode={DEPTH_FIRST:0,BREADTH_FIRST:1},d.Graph=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Graph",VISITED_KEY:"__$visited__",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("vertexes",[]),this.setPropStoreFieldValue("edges",[])},initProperties:function(){this.defineProp("vertexes",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("edges",{dataType:DataType.ARRAY,serializable:!1,setter:null})},addVertex:function(e){return d.ArrayUtils.pushUnique(this.getVertexes(),e),this},newVertex:function(){var e=new d.GraphVertex;return this.addVertex(e),e},removeVertex:function(e){if(d.ArrayUtils.remove(this.getVertexes(),e))for(var t=d.ArrayUtils.clone(e.getEdges()),r=0,n=t.length;r<n;++r)this.removeEdge(t[r])},addEdge:function(e,t,r){return d.ArrayUtils.pushUnique(this.getEdges(),e)&&(e.setPropStoreFieldValue("vertexes",[t,r]),t.doAppendEdge(e),r.doAppendEdge(e)),this},newEdge:function(e,t){var r=new d.GraphEdge;return this.addEdge(r,e,t),r},removeEdge:function(e){for(var t=e.getVertexes(),r=0,n=t.length;r<n;++r)t[r].doRemoveEdge(e);return d.ArrayUtils.remove(this.getEdges(),e),this},traverse:function(t,r,n){for(var i=[],o=e.clone(this.getVertexes()),a=0,s=o.length;a<s;++a)o[a].setData(this.VISITED_KEY,!1);for(;o.length;){var l,d={vertexes:[],edges:[]};l=n&&o.indexOf(n)>=0?n:o[0];var u=this._doTravers(t,r,l);d.vertexes=d.vertexes.concat(u.vertexes),d.edges=d.edges.concat(u.edges),o=e.exclude(o,u.vertexes),i.push(d)}return i},_doTravers:function(e,t,r){var n={vertexes:[],edges:[]},i=r;i.getData(this.VISITED_KEY)||(n.vertexes.push(i),i.setData(this.VISITED_KEY,!0),e&&e(i,!1));for(var o=i.getEdges(),a=[],s=t===d.GraphTraverseMode.BREADTH_FIRST,l=0,u=o.length;l<u;++l){var c=o[l],h=i.getNeighborOnEdge(c);if(!h.getData(this.VISITED_KEY))if(n.vertexes.push(h),n.edges.push(c),h.setData(this.VISITED_KEY,!0),e&&(e(c,!0),e(h,!1)),s)a.push(h);else{var p=this._doTravers(e,t,h);n.vertexes=n.vertexes.concat(p.vertexes),n.edges=n.edges.concat(p.edges)}}if(s)for(l=0,u=a.length;l<u;++l){var g=a[l];p=this._doTravers(e,t,g),n.vertexes=n.vertexes.concat(p.vertexes),n.edges=n.edges.concat(p.edges)}return n}}),d.globalOptions.add("algorithm.molToGraph",{expandSubStructures:!0,ignoreBondedHydrogen:!0}),d.GraphAdaptUtils={ctabToGraph:function(e,t,r){var n=Object.extend(Object.extend({},d.globalOptions.algorithm.molToGraph),r||{}),i=e,o=d.ArrayUtils,a=null,s=n.expandSubStructures;if(i){for(var l=n.nodeFilter||function(e,t){if(n.nodeClasses){var r=e.getClass();if(!ClassEx.isOrIsDescendantOfClasses(r,n.nodeClasses))return!1}if(n.ignoreBondedHydrogen&&e.isHydrogenAtom&&e.isHydrogenAtom()){var i=e.getLinkedConnectors();if(t&&(i=o.intersect(i,t)),i.length<=1){var a=i[0];if(!a)return!1;if(a.isSingleBond&&a.isSingleBond())return!1}}return!0},u=n.connectorFilter||function(e,t){if(n.connectorClasses){var r=e.getClass();if(!ClassEx.isOrIsDescendantOfClasses(r,n.connectorClasses))return!1}return!(e.getBondType&&n.bondTypes&&n.bondTypes.indexOf(e.getBondType())<0)},c=(a=t||new d.Graph,s?i.getAllContainingConnectors():i.getConnectors()),h=s?i.getLeafNodes():i.getNodes(),p=[],g=new d.MapEx,f=0,m=c.length;f<m;++f){var C=c[f];if(u(C))for(var y=[],_=s?C.getConnectedObjs():C.getConnectedSiblings(),E=0,T=_.length;E<T;++E){var O=_[E];if(h.indexOf(O)>=0&&(l(O,c)?y.push(O):o.pushUnique(p,O),y.length>=2)){for(var v=o.exclude(y,p),S=0,b=v.length;S<b;++S)(I=a.newVertex()).setData("object",v[S]),g.set(v[S],I);a.newEdge(g.get(y[0]),g.get(y[1])).setData("object",C),o.pushUnique(p,y);break}}}var A=o.exclude(h,p);for(f=0,m=A.length;f<m;++f){var I,R=A[f];l(R,c)&&(I=a.newVertex()).setData("object",R)}g.finalize()}return a},molToGraph:function(e,t,r){if(d.ArrayUtils,!e||!e.hasCtab())return null;var n=e.getCtab();return n?d.GraphAdaptUtils.ctabToGraph(n,t,r):null},chemObjToGraph:function(e,t,r){for(var n=d.ChemStructureUtils.getAllStructFragments(e,!0),i=t||new d.Graph,o=0,a=n.length;o<a;++o)d.GraphAdaptUtils.molToGraph(n[o],i,r);return i}},d.GraphAlgorithmUtils={SEQ_KEY:"__$seq__",RESD_DEGREE_KEY:"__$resdDegree__",VISIT_EDGE_DEGREE_KEY:"__$visitedEdgeDegree__",TYPE_KEY:"__$type__",TYPE_CYCLE:"cycle",TYPE_BRIDGE:"bridge",VISITED_KEY:"__$visited",createSpanningTrees:function(e,t){return e.traverse(null,t)},calcMinDistances:function(e,t){var r,n,i=e.getVertexes();DataType.isSimpleValue(t)?r=i[n=t]:(r=t,n=i.indexOf(r));for(var o=[],a=[],s=0,l=i.length;s<l;++s){var d=i[s];s===n?(o[s]=0,a[s]=r):(m=r.getEdgeTo(d))?(o[s]=m.getWeight(),a[s]=r):(o[s]=1/0,a[s]=null)}var u=[n];for(s=0,l=i.length;s<l;++s)if(s!==n){for(var c,h=1/0,p=-1,g=0,f=i.length;g<f;++g)g!==n&&u.indexOf(g)<0&&o[g]<h&&(h=o[g],p=g,c=i[g]);for(u.push(p),g=0,f=i.length;g<f;++g)if(u.indexOf(g)<0){var m,C=h+((m=c.getEdgeTo(i[g]))?m.getWeight():1/0);C<o[g]&&(o[g]=C)}}return o},findCycleBlocks:function(t){for(var r=[],n=d.GraphAlgorithmUtils,i=n.SEQ_KEY,o=n.RESD_DEGREE_KEY,a=n.VISIT_EDGE_DEGREE_KEY,s=n.TYPE_KEY,l=n.TYPE_CYCLE,u=n.TYPE_BRIDGE,c=t.getEdges(),h=0,p=c.length;h<p;++h)c[h].removeData(i);var g=t.getVertexes();for(h=0,p=g.length;h<p;++h)g[h].removeData(s);var f=1,m=1,C=[],y=[],_=[];for(t.traverse((function(e,t){t?(e.setData(i,f),y.push(e),++f):(e.setData(i,m),++m,C.push(e))})),h=0,p=C.length;h<p;++h){var E=C[h],T=E.getEdges();E.setData(o,T.length);for(var O=0,v=0,S=T.length;v<S;++v)T[v].getData(i)&&++O;E.setData(a,O),O<T.length&&_.push(E)}for(var b=function(e,t){if(t&&e.getData(i)<=1)return null;for(var r=e.getEdges(),n=null,o=null,a=0,s=r.length;a<s;++a){var l=r[a].getData(i);l&&(o?l<o&&(n=r[a],o=l):(n=r[a],o=l))}return n||null},A=function(e){for(var t=e.getEdges(),r=0,n=t.length;r<n;++r)if(!t[r].getData(i)&&!t[r].getData(s))return t[r];return null},I=function t(r){var n=[],i=[],d=r.getData(a),u=(g=r.getData(o))-d;if(u>0){r.setData(s,l),e.pushUnique(n,r);for(var c=0;c<u;++c){r.setData(o,g+1);var h=A(r);if(h){h.setData(s,l),e.pushUnique(i,h);var p=r.getNeighborOnEdge(h);for(p.setData(o,p.getData(o)+1),p.setData(s,l),e.pushUnique(n,p);;){var g;if((d=p.getData(a))<(g=p.getData(o))){var f=t(p);e.pushUnique(n,f.vertexes),e.pushUnique(i,f.edges)}var m=b(p,!1);if(!m)break;m.setData(s,l),e.pushUnique(i,m);var C=p.getNeighborOnEdge(m);if(C.getData(s))break;C.setData(s,l),e.pushUnique(n,C),p=C}}}}return{vertexes:n,edges:i}},R=C.shift();R;){if(R.getData(s));else{var D=R.getData(a);if(R.getData(o)-D>0){var N=I(R);r.push(N)}else{R.setData(s,u);var P=b(R,!0);P&&P.setData(s,u)}}R=C.shift()}return r},findEndChains:function(e){for(var t=d.ArrayUtils,r={vertexes:[],edges:[]},n=t.clone(e.getVertexes()),i=[],o=0,a=n.length;o<a;++o){var s=n[o],l=s.getEdgeCount();s.setData("__$currConnectivity__",l),l<=1&&i.push(s)}if(i.length){var u=i.pop();for(t.remove(n,u),r.vertexes.push(u);n.length;){var c=!1,h=t.exclude(u.getEdges(),r.edges);if(h.length){r.edges=r.edges.concat(h);var p=u.getNeighborOnEdge(h[0]);l=p.getData("__$currConnectivity__")-1,p.setData("__$currConnectivity__",l),l<=1&&(u=p,t.remove(n,u),r.vertexes.push(u),c=!0)}if(!c){if(!i.length)break;u=i.pop(),t.remove(n,u),r.vertexes.push(u)}}}return r},removeEndChains:function(e){for(var t=d.GraphAlgorithmUtils.findEndChains(e),r=0,n=t.vertexes.length;r<n;++r)e.removeVertex(t.vertexes[r]);return t},findBridgeChains:function(t){for(var r=t.getVertexes(),n=t.getEdges(),i=d.GraphAlgorithmUtils.findCycleBlocks(t),o=0,a=i.length;o<a;++o)r=e.exclude(r,i[o].vertexes),n=e.exclude(n,i[o].edges);return{vertexes:r,edges:n}},removeBridgeChains:function(e){for(var t=d.GraphAlgorithmUtils.findBridgeChains(e),r=0,n=t.vertexes.length;r<n;++r)e.removeVertex(t.vertexes[r]);return t},findAllRings:function(t){var r,n=d.GraphAlgorithmUtils,i=[];r=t instanceof d.Graph?n.findCycleBlocks(t):[t];for(var o,a=function(e,t){var r=e.vertexes,n=r.length;return n&&(r[0]===t||r[n-1]===t)},s=function(t,r,n){var i=e.clone(t.vertexes),o=e.clone(r.vertexes),a=e.clone(t.edges),s=e.clone(r.edges);i[0]===n&&(i.reverse(),a.reverse()),o[o.length-1]===n&&(o.reverse(),s.reverse()),i.pop();var l=i.concat(o),d=a.concat(s);return{vertexCount:t.vertexCount+r.vertexCount-1,vertexes:l,edges:d}},l=function(t){for(var r=[],n=e.clone(t.vertexes),i=t.edges,o=0,l=n.length;o<l;++o){var d=n[o],u=e.intersect(d.getEdges(),i);d.setData("__$vertextPartDegree__",u.length)}n.sort((function(e,t){return e.getData("__$vertextPartDegree__")-t.getData("__$vertextPartDegree__")}));var c,h,p,g,f=[];for(o=0,l=t.edges.length;o<l;++o){var m=t.edges[o],C=m.getVertexes();f.push({vertexCount:C.length,vertexes:[C[0],C[1]],edges:[m]})}for(;n.length;){var y=n.shift(),_=null;for(o=f.length-1;o>=0;--o){var E=f[o];if(a(E,y)){_=E;for(var T=o-1;T>=0;--T)if(E=f[T],a(E,y)&&(c=_,h=E,p=void 0,g=void 0,p=e.clone(c.vertexes),g=e.clone(h.vertexes),p.shift(),p.pop(),g.shift(),g.pop(),!(e.intersect(p,g).length>=1))){var O=s(_,E,y),v=O.vertexes;v[0]===v[v.length-1]?(v.pop(),r.push(O)):f.push(O)}f.splice(o,1)}}}return r},u=0,c=r.length;u<c;++u){var h=r[u];if((o=h).vertexes.length===o.edges.length)i.push({vertexes:e.clone(h.vertexes),edges:e.clone(h.edges)});else for(var p=l(h),g=0,f=p.length;g<f;++g){var m=p[g];i.push({vertexes:e.clone(m.vertexes),edges:e.clone(m.edges)})}}return i},findSSSR:function(t,r){var n,i=d.GraphAlgorithmUtils,o=[];t instanceof d.Graph?(n=i.findCycleBlocks(t),r=null):n=[t];for(var a=function(t,r){var n=[],o=t.edges.length-t.vertexes.length+1;if(o<=0)return[];var a=r?e.clone(r):i.findAllRings(t);a.sort((function(e,t){return e.vertexes.length-t.vertexes.length}));var s,l=function(e){n.push(e)},u=[],c=d.RingVectorUtils;c.prepareConvertRingToVector(t);var h=a.shift();for(l(h),s=c.convertRingToVector(h,t),u.push(s);n.length<o&&a.length;)h=a.shift(),s=c.convertRingToVector(h,t),c.isLinearDependant(s,u)||(u.push(s),l(h));return n},s=0,l=n.length;s<l;++s){var u=a(n[s],r);o=o.concat(u)}return o},analysisRings:function(e){for(var t,r=d.GraphAlgorithmUtils,n=[],i=0,o=(t=e instanceof d.Graph?r.findCycleBlocks(e):[e]).length;i<o;++i){var a=t[i],s=r.findAllRings(a),l=r.findSSSR(a,s);n.push({vertexes:a.vertexes,edges:a.edges,allRings:s,sssrRings:l})}return n}},d.RingVectorUtils={MAX_INT_BITNUM:23,EDGE_INDEX_FIELD:"__$index__",prepareConvertRingToVector:function(e){for(var t=e.edges,r=0,n=t.length;r<n;++r)t[r][d.RingVectorUtils.EDGE_INDEX_FIELD]=r},convertRingToVector:function(e,t){var r,n=t.edges.length,i=e.edges;if(n<d.RingVectorUtils.MAX_INT_BITNUM){r=0;for(var o=0,a=i.length;o<a;++o)r+=1<<i[o][d.RingVectorUtils.EDGE_INDEX_FIELD]}else for(r=[],o=0,a=i.length;o<a;++o)r[i[o][d.RingVectorUtils.EDGE_INDEX_FIELD]]=!0;return r},vectorNotNull:function(e){if(DataType.isSimpleValue(e))return!!e;for(var t=0;t<e.length;++t)if(e[t])return!0;return!1},getVectorLength:function(e){return DataType.isSimpleValue(e)?e.toString(2).length:e.length},ringVectorAnd:function(e,t){if(DataType.isSimpleValue(e))return e&t;for(var r=[],n=Math.min(e.length,t.length),i=0;i<n;++i)r[i]=e[i]&&t[i];return r},ringVectorAndAll:function(e){if(e.length<2)return e[0];for(var t=d.RingVectorUtils,r=t.ringVectorAnd(e[0],e[1]),n=2,i=e.length;n<i;++n)r=t.ringVectorAnd(r,e[n]);return r},ringVectorOr:function(e,t){if(DataType.isSimpleValue(e))return e|t;for(var r=[],n=Math.max(e.length,t.length),i=0;i<n;++i)r[i]=e[i]||t[i];return r},ringVectorOrAll:function(e){if(e.length<2)return e[0];for(var t=d.RingVectorUtils,r=t.ringVectorOr(e[0],e[1]),n=2,i=e.length;n<i;++n)r=t.ringVectorOr(r,e[n]);return r},ringVectorXor:function(e,t){if(DataType.isSimpleValue(e))return e^t;for(var r=[],n=Math.max(e.length,t.length),i=0;i<n;++i)r[i]=!!(e[i]^t[i]);return r},ringVectorXorAll:function(e){if(e.length<2)return e[0];for(var t=d.RingVectorUtils,r=t.ringVectorXor(e[0],e[1]),n=2,i=e.length;n<i;++n)r=t.ringVectorXor(r,e[n]);return r},ringVectorNot:function(e){if(DataType.isSimpleValue(e))return~e;for(var t=[],r=0,n=e.length;r<n;++r)t[r]=!e[r];return t},isLinearDependant:function(e,t){var r=d.RingVectorUtils,n=r.ringVectorOrAll(t),i=r.ringVectorAnd(e,r.ringVectorNot(n));if(r.vectorNotNull(i))return!1;for(var o=t.length,a=function(e){for(var t=[],r=0;r<e;++r)t[r]=e-r-1;return t},s=function e(t,r,n){var i=t[r],o=++i;if(o>=n-r)return!(r>=t.length-1)&&e(t,r+1,n);t[r]=o;for(var a=o,s=r-1;s>=0;--s)++a,t[s]=a;return!0},l=!1,u=2;u<=o;++u){for(var c=a(u);;){for(var h=[],p=0,g=c.length;p<g;++p)h.push(t[c[p]]);var f=r.ringVectorXorAll(h);if(!r.vectorNotNull(r.ringVectorXor(f,e))){l=!0;break}if(!s(c,0,o)){l=!1;break}}if(l)break}return l},isLinearDependant_wrong:null}}(),function(){"use strict";d.ChemStructObjContainer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemStructObjContainer",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("nodes",[]),this.setPropStoreFieldValue("connectors",[])},initProperties:function(){this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:!1,setter:null})},clear:function(){return this.getNodes().length=0,this.getConnectors().length=0,this},add:function(e){var t=null;return e instanceof d.ChemStructureConnector?t=this.getConnectors():e instanceof d.ChemStructureNode&&(t=this.getNodes()),t?d.ArrayUtils.pushUnique(t,e):d.error(d.$L("ErrorMsg.CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER")),this},remove:function(e){var t;return t=e instanceof d.ChemStructureConnector?this.getConnectors():this.getNodes(),d.ArrayUtils.remove(t,e),this}})}(),function(){var e=d.ArrayUtils;d.BondType,d.CanonicalizationIndexer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationIndexer",initialize:function(){this.tryApplySuper("initialize")},execute:function(e){var t=e instanceof d.StructureFragment?e.getCtab():e;return t?this.doExecute(t):null},doExecute:function(e){}}),d.CanonicalizationNodeSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationNodeSorter",execute:function(e){var t=e instanceof d.StructureFragment?e.getCtab():e;return t?this.doExecute(t,t.getNodes()):null},doExecute:function(e){}}),d.CanonicalizationConnectorSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationConnectorSorter",execute:function(e){var t=e instanceof d.StructureFragment?e.getCtab():e;return t?this.doExecute(t,t.getConnectors()):null},doExecute:function(e){}}),d.CanonicalizationConnectorConnectedObjsSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationConnectorConnectedObjsSorter",execute:function(e){var t=e instanceof d.StructureFragment?e.getCtab():e;return t?this.doExecute(t,t.getConnectors()):null},doExecute:function(e){}}),d.CanonicalizationCustomExecutor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationCustomExecutor",execute:function(e){var t=this.doExecute(e);return t&&this.doCanonicalizeConnectedObjs(t),t},doExecute:function(e){return e},doCanonicalizeConnectedObjs:function(e){e&&(new d.CanonicalizationGeneralConnectorConnectedObjsSorter).execute(e)}}),d.CanonicalizationGeneralConnectorSorter=Class.create(d.CanonicalizationConnectorSorter,{CLASS_NAME:"Kekule.CanonicalizationGeneralConnectorSorter",doExecute:function(t){var r=new d.MapEx;try{for(var n=0,i=t.getConnectorCount();n<i;++n){for(var o=t.getConnectorAt(n),a=o.getConnectedObjs(),s=[],l=0,u=a.length;l<u;++l){var c,h=a[l];h instanceof d.ChemStructureNode&&(c=t.indexOfNode(h),s.push(c))}s.sort((function(e,t){return e-t})),r.set(o,s)}t.sortConnectors((function(t,n){var i=r.get(t),o=r.get(n),a=e.compare(i,o);return 0===a&&(a=-(t.getConnectedObjCount()-n.getConnectedObjCount())),a}))}finally{r.finalize()}}}),d.CanonicalizationGeneralConnectorConnectedObjsSorter=Class.create(d.CanonicalizationConnectorConnectedObjsSorter,{CLASS_NAME:"Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter",doExecute:function(e){var t=new d.MapEx;try{for(var r=0,n=e.getConnectorCount();r<n;++r){var i=e.getConnectorAt(r);if(2===i.getConnectedObjCount()){var o=i.getConnectedObjAt(0),a=i.getConnectedObjAt(1),s=e.indexOfChild(o),l=e.indexOfChild(a);(s<0||l<0)&&(s=(o.getCanonicalizationIndex?-o.getCanonicalizationIndex():0)||0,l=(a.getCanonicalizationIndex?-a.getCanonicalizationIndex():0)||0),s>l&&i.reverseConnectedObjOrder()}else i.sortConnectedObjs((function(t,r){var n=e.indexOfChild(t),i=e.indexOfChild(r);(n<0||i<0)&&(o=((n=(t.getCanonicalizationIndex?-t.getCanonicalizationIndex():0)||0)||0)-((i=(r.getCanonicalizationIndex?-r.getCanonicalizationIndex():0)||0)||0));var o=e.indexOfChild(t)-e.indexOfChild(r);return o}))}}finally{t.finalize()}}}),d.CanonicalizationMorganIndexer=Class.create(d.CanonicalizationIndexer,{CLASS_NAME:"Kekule.CanonicalizationMorganIndexer",doExecute:function(e){var t=this.doCalcGraphAndEcResult(e);this.doExecuteOnGraphEcResult(t.graph,t.ecMapping,t.vertexGroup)},doCalcGraphAndEcResult:function(e){var t=d.GraphAdaptUtils.ctabToGraph(e,null,{expandSubStructures:!0,ignoreBondedHydrogen:!0});if(!t)return null;var r=this._calcGraphFinalECs(t);return{graph:t,ecMapping:r.ecMapping,vertexGroup:r.vertexGroup}},doExecuteOnGraphEcResult:function(e,t,r){var n=this._sortNodeByEcMapping(e,t,r);this._setCanonicalizationIndexToNodeGroups(n),this._fillSpanningTreeInfo(e)},_fillSpanningTreeInfo:function(e){if((n=e.getVertexes())&&n.length){n.sort((function(e,t){var r=e.getData("object"),n=t.getData("object");if(r||n){if(r){if(n){var i=(n.getCanonicalizationIndex()||-1)-(r.getCanonicalizationIndex()||-1);if(0===i&&r.hasCoord3D(!0)&&n.hasCoord3D(!0)){var o=d.CoordUtils.substract(n.getAbsCoord3D(!0),r.getAbsCoord3D(!0));i=o.z||o.y||o.x}return i}return-1}return 1}return 0}));var t=e.getEdges();if(t&&t.length){var r=function(e,t){for(var r=t.length,n=[],i=e.getVertexes(),o=0,a=i.length;o<a;++o){var s=t.indexOf(i[o]);s<0&&(s=r),n.push(s)}return n.sort(),n},n=e.getVertexes();t.sort((function(e,t){var i=r(e,n),o=r(t,n);return d.ArrayUtils.compare(i,o)}))}for(var i=0,o=(n=e.getVertexes()).length;i<o;++i)n[i].getEdges().sort((function(e,r){return t.indexOf(e)-t.indexOf(r)}))}this._setSpanningTreeIndexToNodeOfGraph(e)},_sortNodeByEcMapping:function(e,t,r){return this._doSortNodeByEcMapping(e,t,r)},_doSortNodeByEcMapping:function(t,r,n){for(var i=this._doSortNodeByEcMappingDirectly(n),o=this._doSortNodeBySortedNodeList(i),a=[],s=0,l=o.length;s<l;++s){var d=o[s];e.isArray(d)&&1===d.length?a.push(d[0]):a.push(d)}return a},_doSortNodeByEcMappingDirectly:function(t){for(var r=[],n=t,i=0,o=n.length;i<o;++i){var a=n[i],s=this._vertexesToNodes(a.vertexes);if(1===s.length)e.pushUnique(r,s[0]);else{var l=this._groupNodesWithSameEcValue(s,r);r=r.concat(l)}}return r},_doSortNodeBySortedNodeList:function(e){var t=(r=this._doSortNodeBySortedNodeListCore(e)).length;do{var r,n=r,i=t;t=(r=this._doSortNodeBySortedNodeListCore(n)).length}while(t>i);return n},_doSortNodeBySortedNodeListCore:function(t){for(var r=[],n=[],i=0,o=t.length;i<o;++i){var a=t[i];if(e.isArray(a)){var s=function(t,r){for(var n=0,i=r.length;n<i;++n)if(e.isArray(r[n])){if(r[n].indexOf(t)>=0)return n}else if(r[n]===t)return n;return-1},l=function(e,t,r){for(var n=[],i=0,o=t.length;i<o;++i)n.push(s(t[i],r));return n.sort((function(e,t){return t-e})),n},d=e.group(a,(function(i,o){var a,s=e.intersect(i.getLinkedObjs(),n),d=e.intersect(o.getLinkedObjs(),n);if(0==(a=s.length-d.length)&&s.length>0){var u=l(0,s,r),c=l(0,d,r);a=e.compare(u,c)}0===a&&(s=e.intersect(i.getLinkedObjs(),t),d=e.intersect(o.getLinkedObjs(),t),0==(a=s.length-d.length)&&(u=l(0,s,t),c=l(0,d,t),a=e.compare(u,c)));return a}));r=r.concat(d),n=n.concat(a)}else r.push([a]),n.push(a)}return r},_setCanonicalizationIndexToNodeGroups:function(t){for(var r=0,n=t.length;r<n;++r){var i=r+1,o=t[r];if(e.isArray(o))for(var a=0,s=o.length;a<s;++a)o[a].setCanonicalizationIndex(i);else o.setCanonicalizationIndex(i)}},_setSpanningTreeIndexToNodeOfGraph:function(e){for(var t=d.GraphAlgorithmUtils.createSpanningTrees(e,d.GraphTraverseMode.DEPTH_FIRST),r=0,n=t.length;r<n;++r){var i=t[r];if(i.vertexes)for(var o=i.vertexes.length,a=0;a<o;++a){var s=i.vertexes[a].getData("object");s&&s.setCanonicalizationAssocIndex&&s.setCanonicalizationAssocIndex(o-a)}}},_vertexesToNodes:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r].getData("object");t.push(i)}return t},_processECs:function(t,r,n,i){if(i)return this._initECs(t,r);for(var o=[],a=[],s=t.getVertexes(),l=0,d=s.length;l<d;++l){var u=s[l],c=this._usePrimeECs?1:0;if(this._usePrimeECs)var h=this._getPrimeArray();for(var p=u.getNeighbors(),g=0,f=p.length;g<f;++g)this._usePrimeECs?c*=h[n.get(p[g])-1||0]:c+=n.get(p[g])||0;e.pushUnique(o,c),a[c]?a[c].push(u):a[c]=[u]}o.sort((function(e,t){return e-t}));var m=[];for(l=0,d=o.length;l<d;++l){var C=o[l];a[C]&&m.push(a[C])}return this._setECValueByVertexGroup(m,r),m.length},_initECs:function(t,r){for(var n=[],i=0,o=(d=t.getVertexes()).length;i<o;++i){var a=d[i],s=a.getEdgeCount();n[s]?n[s].push(a):n[s]=[a]}var l=[];for(i=0,o=n.length;i<o;++i){var d;if(d=n[i])if(1===d.length)l.push(d);else for(var u=e.group(d,(function(e,t){var r=e.getData("object"),n=t.getData("object"),i=(r.getLinkedNonHydrogenConnectors()||[]).length-(n.getLinkedNonHydrogenConnectors()||[]).length;return i||(i=r.compareStructure(n))||(i=(r.getHydrogenCount?r.getHydrogenCount(!0):0)-(n.getHydrogenCount?n.getHydrogenCount(!0):0)),i})),c=0,h=u.length;c<h;++c)l.push(e.toArray(u[c]))}return this._setECValueByVertexGroup(l,r),l.length},_setECValueByVertexGroup:function(e,t){for(var r=0,n=e.length;r<n;++r)for(var i=e[r],o=0,a=i.length;o<a;++o)t.set(i[o],r+1)},_getPrimeArray:function(){return d.CanonicalizationMorganIndexer.primes||(d.CanonicalizationMorganIndexer.primes=d.NumUtils.getPrimes(1e4)),d.CanonicalizationMorganIndexer.primes},_calcGraphFinalECs:function(e){var t=[new d.MapEx,new d.MapEx];try{e.getVertexes().length<this._getPrimeArray().length?this._usePrimeECs=!0:this._usePrimeECs=!1;for(var r,n,i=0,o=t[0],a=t[0],s=0,l=[],u=this._processECs(e,o,a,!0),c=!0;c;)s=u,r=n,a=o,o=t[++i%2],u=this._processECs(e,o,a),n=null,c=u>s,u===s?(n=this._groupVertexesByEcValue(e,o),!r&&a&&(r=this._groupVertexesByEcValue(e,a)),l.push(r),c=!this._hasVertexGroup(n,l)):l=[]}finally{o.finalize()}return{ecMapping:a,ecCount:s,vertexGroup:r||this._groupVertexesByEcValue(e,a)}},_groupVertexesByEcValue:function(t,r){for(var n=[],i=[],o=t.getVertexes(),a=0,s=o.length;a<s;++a){var l=o[a],d=r.get(l);e.pushUnique(i,d),n[d]||(n[d]=[]),n[d].push(l)}i.sort((function(e,t){return e-t}));var u=[];for(a=0,s=i.length;a<s;++a){var c=n[i[a]];u.push({ecValue:i[a],vertexes:c,vertexesCount:c.length})}return u},_hasVertexGroup:function(e,t){for(var r=0,n=t.length;r<n;++r)if(0===this._compareEcVertexGroup(e,t[r]))return!0;return!1},_compareEcVertexGroup:function(t,r){var n=t.length,i=n-r.length;if(0===i)for(var o=0;o<n&&(0===(i=t[o].vertexes.length-r[o].vertexes.length)&&(i=e.exclude(t[o].vertexes,r[o].vertexes).length),0===i);++o);return i},_groupNodesWithSameEcValue:function(t,r){var n=function(t,r){for(var n=e.flatten(r),i=t.getLinkedObjs(),o=e.intersect(i,n),a=[],s=[],l=0,d=o.length;l<d;++l){var u=o[l],c=e.indexStackOfElem(u,r);a.push(c)}for(a.sort((function(t,r){return e.compare(t,r)})),l=0,d=a.length;l<d;++l){(u=e.getElemByIndexStack(r,a[l]))||console.error("not found",u,a[l]);var h=t.getConnectorTo(u);s.push(h)}return{nodeIndexValues:a,connectors:s}};return e.group(t,(function(t,i){var o=t.compareStructure(i);if(0===o){var a=n(t,r),s=n(i,r);o=e.compare(a.nodeIndexValues,s.nodeIndexValues);for(var l=a.connectors,d=s.connectors,u=0,c=l.length;u<c&&0===(o=l[u].compareStructure(d[u]));++u);if(0===o){var h=t.getBelongedSssrRings&&t.getBelongedSssrRings()||[],p=i.getBelongedSssrRings&&i.getBelongedSssrRings()||[];if(0===(o=h.length-p.length)){var g=[],f=[];for(u=0,c=h.length;u<c;++u)g.push(h[u].nodes.length),f.push(p[u].nodes.length);g.sort(),f.sort(),o=e.compare(g,f)}}}return o}))}}),d.CanonicalizationMorganNodeSorter=Class.create(d.CanonicalizationNodeSorter,{CLASS_NAME:"Kekule.CanonicalizationMorganNodeSorter",doExecute:function(e){var t=this._getNodeSortedArray(e),r=t.length,n=this;e.sortNodes((function(e,i){var o=t.indexOf(e),a=t.indexOf(i);o<0&&(o=r),a<0&&(a=r);var s=o-a;return 0===s&&o===r&&(s=n._getNeighborNodesMinIndex(e,t)-n._getNeighborNodesMinIndex(i,t)),s}))},_getNeighborNodesMinIndex:function(e,t){for(var r=e.getLinkedChemNodes(),n=t.length,i=0,o=r.length;i<o;++i){var a=t.indexOf(r[i]);a>0&&a<n&&(n=a)}return n},_getNodeSortedArray:function(t){var r=function(e,t,r,n){var i;if(0===(i=(t.getCanonicalizationIndex()||-1)-(r.getCanonicalizationIndex()||-1))){if(e){var o=e.getConnectorTo(t),a=e.getConnectorTo(r);i=o.compareStructure(a)}if(0===i&&n&&(i=(n.get(t)||1/0)-(n.get(r)||1/0)),0===i&&(i=(t.getCanonicalizationAssocIndex()||-1)-(r.getCanonicalizationAssocIndex()||-1)),0===i&&t.hasCoord3D(!0)&&r.hasCoord3D(!0)){var s=d.CoordUtils.substract(t.getAbsCoord3D(!0),r.getAbsCoord3D(!0));i=s.z||s.y||s.x}}return i};try{for(var n,i=e.clone(t.getNodes()),o=0,a=i.length;o<a;++o){var s=i[o];c?r(null,s,c)>0&&(c=s,n=o):(c=s,n=o)}i.splice(n,1);var l=[],u=[];for(c&&l.push(c),o=0;o<l.length;++o){var c=l[o];if(0!==o){var h=i.indexOf(c);h>=0&&(l.push(c),i.splice(h,1))}var p=c.getLinkedObjs();if((p=e.intersect(p,i)).length){p.sort((function(e,t){return r(c,e,t)}));for(var g=p.length-1;g>=0;--g){var f=p[g];if((h=i.indexOf(f))>=0){var m=f.getCanonicalizationIndex();d.ObjUtils.isUnset(m)?u.push(f):l.push(f),i.splice(h,1)}}}}return l=l.concat(u)}finally{}}}),d.Canonicalizer=Class.create({CLASS_NAME:"Kekule.Canonicalizer",initialize:function(){this._executorClasses={},this._executorInstances={},this._defExecutorId=null},registerExecutor:function(t,r,n){e.isArray(r)?this._executorClasses[t]={indexer:r[0],nodeSorter:r[1],connectorSorter:r[2]||d.CanonicalizationGeneralConnectorSorter,connectorConnectedObjsSorter:r[3]||d.CanonicalizationGeneralConnectorConnectedObjsSorter}:this._executorClasses[t]={customExecutor:r},n&&(this._defExecutorId=t)},getExecutor:function(e){if(!e)return null;var t=this._executorInstances[e];if(!t){var r=this._executorClasses[e];r&&(t=r.customExecutor?{customExecutor:new r.customExecutor}:{indexer:new r.indexer,nodeSorter:new r.nodeSorter,connectorSorter:new r.connectorSorter,connectorConnectedObjsSorter:new r.connectorConnectedObjsSorter},this._executorInstances[e]=t)}return t},canonicalize:function(e,t){e.beginUpdate();try{var r=t||this._defExecutorId,n=this.getExecutor(r);if(n){var i=e instanceof d.StructureFragment?e:null,o=i.getCanonicalizationInfo();if(o&&o.id===r)return e;var a=e.getCtab?e.getCtab():e;if(!a||a.isEmpty())return e;var s=a.getParent();n.customExecutor?n.customExecutor.execute(a):this._doDefaultCanonicalize(n,a,s),i.setCanonicalizationInfo({id:r})}else d.error(d.$L("ErrorMsg.REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND"))}finally{e.endUpdate()}return e},_doDefaultCanonicalize:function(e,t,r){var n=r.getFlattenedShadowFragment();(t=n.getCtab()).beginUpdate();try{e.indexer.execute(t),e.nodeSorter.execute(t),e.connectorSorter.execute(t),e.connectorConnectedObjsSorter.execute(t)}finally{t.endUpdate()}if(!r.getFlattenedShadowOnSelf()){r.beginUpdate();try{this._sortSrcStructBaseOnShadow(r,n),e.connectorConnectedObjsSorter.execute(r.getCtab())}finally{r.endUpdate()}}},_sortSrcStructBaseOnShadow:function(e,t){var r=function(e){return e.__$flattern_index$__},n=function(e,t){e.__$flattern_index$__=t},i=function t(i,o,a,s){n(o,a);var l=o.getParent();if(l.isChildOf(e)){var u=r(l),c=a+s;(d.ObjUtils.isUnset(u)||u>c)&&t(i,l,c,s)}};e.cascadeOnChildren((function(e){e&&n(e,null)}));var o=t.getChildCount();e.beginUpdate();try{for(var a=0;a<o;++a){var s=t.getChildAt(a);if(s instanceof d.ChemStructureNode){var l=s,u=e.getFlatternedShadowSourceObj(l);u&&(i(e,u,a,o),u.setCanonicalizationIndex(l.getCanonicalizationIndex()))}else if(s instanceof d.ChemStructureConnector){var c=s,h=e.getFlatternedShadowSourceObj(c);n(h,a)}}!function e(t){t.beginUpdate();try{t.sortNodes((function(e,t){return r(e)-r(t)})),t.sortConnectors((function(e,t){return r(e)-r(t)}));for(var n=0,i=t.getNodeCount();n<i;++n){var o=t.getNodeAt(n);o instanceof d.StructureFragment&&e(o)}}finally{t.endUpdate()}}(e)}finally{e.endUpdate()}}}),d.ClassUtils.makeSingleton(d.Canonicalizer),d.canonicalizer=d.Canonicalizer.getInstance(),ClassEx.extend(d.ChemObject,{canonicalize:function(e){for(var t=d.ChemStructureUtils.getAllStructFragments(this,!0),r=0,n=t.length;r<n;++r)t[r].canonicalize(e);return this}}),ClassEx.extend(d.StructureConnectionTable,{canonicalize:function(e){return d.canonicalizer.canonicalize(this),this}}),ClassEx.extend(d.StructureFragment,{canonicalize:function(e){return d.canonicalizer.canonicalize(this),this}}),ClassEx.defineProp(d.ChemStructureObject,"canonicalizationIndex",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLISHED}),ClassEx.defineProp(d.ChemStructureObject,"canonicalizationAssocIndex",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLISHED}),d.canonicalizer.registerExecutor("morgan",[d.CanonicalizationMorganIndexer,d.CanonicalizationMorganNodeSorter],!0)}(),function(){"use strict";var e=d.ArrayUtils,t=d.GraphAlgorithmUtils,r=d.ChemStructureUtils,n=d.BondType;d.globalOptions.add("algorithm.ringSearch",{bondTypes:[n.COVALENT]}),ClassEx.extend(d.StructureConnectionTable,{getGraph:function(e){var t=Class.create(e);return t.connectorClasses=[d.Bond],d.GraphAdaptUtils.ctabToGraph(this,null,t)},extractStructObjs:function(e){for(var t=e.edges,r=e.vertexes,n=[],i=[],o=0,a=r.length;o<a;++o)(s=r[o].getData("object"))instanceof d.BaseStructureNode&&n.push(s);for(o=0,a=t.length;o<a;++o){var s;(s=t[o].getData("object"))instanceof d.BaseStructureConnector&&i.push(s)}return{nodes:n,connectors:i}},findCycleBlocks:function(){var e=this.getRingInfo();return e?e.cycleBlocks:[]},findAllRings:function(){var e=this.getRingInfo(),t=[];if(e)for(var r=0,n=e.cycleBlocks.length;r<n;++r){var i=e.cycleBlocks[r].allRings;t=t.concat(i)}return t},findSSSR:function(){var e=this.getRingInfo(),t=[];if(e)for(var r=0,n=e.cycleBlocks.length;r<n;++r){var i=e.cycleBlocks[r].sssrRings;t=t.concat(i)}return t},analysisRings:function(e){var r=Object.extend(Object.extend({},d.globalOptions.algorithm.ringSearch),e),n=this.getGraph(r);if(n){for(var i=[],o=t.analysisRings(n),a=0,s=o.length;a<s;++a){var l=o[a],u=this.extractStructObjs(l);i.push(u),u.allRings=[];for(var c=l.allRings,h=0,p=c.length;h<p;++h){var g=c[h],f=this.extractStructObjs(g);u.allRings.push(f)}u.sssrRings=[];var m=l.sssrRings;for(h=0,p=m.length;h<p;++h){g=m[h];var C=c.indexOf(g);C>=0?u.sssrRings.push(u.allRings[C]):(f=this.extractStructObjs(g),u.sssrRings.push(f))}}return{cycleBlocks:i}}return null}}),ClassEx.defineProps(d.StructureConnectionTable,[{name:"ringInfo",dataType:DataType.HASH,serializable:!1,getter:function(e){var t=this.getStructureCacheData("ringInfo");return t||e||(t=this.analysisRings(),this.setStructureCacheData("ringInfo",t)),t},setter:null}]),ClassEx.extend(d.StructureFragment,{findCycleBlocks:function(){return this.hasCtab()?this.getCtab().findCycleBlocks():null},findAllRings:function(){return this.hasCtab()?this.getCtab().findAllRings():null},findSSSR:function(){return this.hasCtab()?this.getCtab().findSSSR():null},analysisRings:function(e){return this.hasCtab()?this.getCtab().analysisRings(e):null}}),ClassEx.defineProps(d.StructureFragment,[{name:"ringInfo",dataType:DataType.HASH,serializable:!1,getter:function(e){return this.hasCtab()?this.getCtab().getRingInfo(e):null},setter:null}]),ClassEx.extendMethod(d.StructureFragment,"_copyAdditionalFragmentInfo",(function(e,t,r,n){var i=function(e){for(var t={nodes:[],connectors:[]},n=0,i=e.nodes.length;n<i;++n)(o=r.get(e.nodes[n]))&&t.nodes.push(o);for(n=0,i=e.connectors.length;n<i;++n){var o;(o=r.get(e.connectors[n]))&&t.connectors.push(o)}return t};e(t,r,n);var o=this.getRingInfo(!0);if(o){for(var a={cycleBlocks:[]},s=0,l=o.cycleBlocks.length;s<l;++s){for(var d=o.cycleBlocks[s],u={allRings:[],sssrRings:[]},c=d.allRings,h=0,p=c.length;h<p;++h){var g=c[h];u.allRings.push(i(g))}var f=d.sssrRings;for(h=0,p=f.length;h<p;++h)g=f[h],u.sssrRings.push(i(g));a.cycleBlocks.push(u)}t.setPropStoreFieldValue("ringInfo",a)}})),ClassEx.extend(d.ChemStructureObject,{getBelongedSssrRings:function(){var e=[],t=this.getParent();if(t&&t.findSSSR)for(var r=t.findSSSR(),n=0,i=r.length;n<i;++n){var o=r[n];this instanceof d.BaseStructureConnector?o.connectors.indexOf(this)>=0&&e.push(o):o.nodes.indexOf(this)>=0&&e.push(o)}return e},getBelongedRingMinSize:function(){var e=null,t=this.getBelongedSssrRings();if(t&&t.length)for(var r=0,n=t.length;r<n;++r){var i=t[r].nodes.length;e=e?Math.min(e,i):i}return e},isInRing:function(t){var r=t&&e.toArray(t);if(!r){var n=this.getParent();n&&n.findSSSR&&(r=n.findSSSR())}if(r&&r.length){for(var i=0,o=r.length;i<o;++i){var a=r[i];if(this instanceof d.BaseStructureConnector){if(a.connectors.indexOf(this)>=0)return!0}else if(a.nodes.indexOf(this)>=0)return!0}return!1}return!1}}),ClassEx.extend(d.ChemObject,{findCycleBlocks:function(){for(var e=r.getAllStructFragments(this),t=[],n=0,i=e.length;n<i;++n){var o=e[n].findCycleBlocks();o&&(t=t.concat(o))}return t.length?t:null},findAllRings:function(){for(var e=r.getAllStructFragments(this),t=[],n=0,i=e.length;n<i;++n){var o=e[n].findAllRings();o&&(t=t.concat(o))}return t.length?t:null},findSSSR:function(){for(var e=r.getAllStructFragments(this),t=[],n=0,i=e.length;n<i;++n){var o=e[n].findSSSR();o&&(t=t.concat(o))}return t.length?t:null},analysisRings:function(e){for(var t=r.getAllStructFragments(this),n=[],i=0,o=t.length;i<o;++i){var a=t[i].analysisRings(e);a&&(n=n.concat(a))}return n.length?n:null}})}(),function(){"use strict";var e=d.ObjUtils,t=d.ArrayUtils,r=d.BondType,n=d.BondOrder,i=d.ChemStructureUtils;d.AromaticTypes={NONAROMATIC:0,EXPLICIT_AROMATIC:1,ANTIAROMATIC:-1,UNCERTAIN:64},ClassEx.extend(d.Atom,{isSulfoneOrSulfoxideSulphur:function(){if("S"===this.getSymbol()){var e=this.getLinkedMultipleBonds();if(e.length>=1)for(var t=0,r=e;t<r;++t)for(var n=this.getLinkedObjsOnConnector(e[t]),i=0,o=n.length;i<o;++i){var a=n[i];if(a instanceof d.Atom&&"O"===a.getSymbol())return!0}}return!1},isEsterCarbon:function(){if("C"===this.getSymbol())for(var e,t,i=this.getLinkedBonds(r.COVALENT),o=0,a=i.length;o<a;++o){var s=i[o];if(s.isBondBetween("C","O")&&(t||s.getBondOrder()!==n.SINGLE?e||s.getBondOrder()!==n.DOUBLE||(e=!0):t=!0,t&&e))return!0}return!1}}),d.globalOptions.add("algorithm.aromaticRingsPerception",{allowUncertainRings:!1}),ClassEx.extend(d.StructureConnectionTable,{_getPossibleRingNodePiElectronCounts:function(e,r,n){var i=function(e,r,n,i){var o=e,a=d.IsotopeFactory.getIsotope(o),s=r.getCharge();if(!r.isSaturated||!r.isSaturated()){var l,u,c,h=r.getLinkedMultipleBonds();if(r.isSulfoneOrSulfoxideSulphur&&r.isSulfoneOrSulfoxideSulphur())return-32;if(r.isEsterCarbon&&r.isEsterCarbon())return-16;if(i?c=(u=t.intersect(h,i)).length:(u=null,c=1),c)if(2===c&&u[0].getBondOrder()===d.BondOrder.EXPLICIT_AROMATIC)l=a.isHetero&&a.isHetero()?[1,2]:1;else if(1===c&&u&&u[0].getBondOrder()===d.BondOrder.DOUBLE)l=1;else{if(1!==c||u)return-1;l=1}else if("C"===o){for(var p=!1,g=0,f=h.length;g<f;++g){var m=h[g],C=r.getLinkedObjsOnConnector(m);if(1===C.length&&C[0].getPrimaryIsotope().isHetero()){p=!0;break}}l=p?0:1}else l=1;if(t.isArray(l)){for(g=0,f=l.length;g<f;++g)l[g]=Math.min(Math.max(l[g]-s,0),2);return l}return Math.min(Math.max(l-s,0),2)}return r.getRadical&&r.getRadical()===d.RadicalOrder.DOUBLET?1:a.isHetero()?Math.min(Math.max(2-s,0),2):"C"===o?s>0?0:s<0?2:-1:0};if(e instanceof d.VariableAtom){var o=e.getAllowedIsotopeIds();if(o&&o.length){for(var a=[],s=0,l=o.length;s<l;++s){var u=o[s],c=d.IsotopeFactory.getIsotopeById(u).getSymbol();t.pushUnique(a,i(c,e,0,n))}return a}return[0,1,2]}var h=e.getPrimaryIsotope();return h?i(c=h.getSymbol(),e,0,n):[0,1,2]},_checkRingAromaticType:function(e,r,n){if(r){for(var i=n&&d.ChemStructureUtils.isInRings(e,n),o=e.nodes,a=o.length,s=a>6&&a<16,l=[],u=[],c=o.length,h=0;h<c;++h){var p=o[h],g=r.get(p);t.isArray(g)?l.push(g):l.push([g]),u[h]=0}var f,m=function e(t,r){var n=r[t],i=++n;return i>=l[t].length?!(t>=r.length-1)&&(r[t]=0,e(t+1,r)):(r[t]=i,!0)},C=null,y=null;do{var _=0,E=null;for(h=0;h<c;++h){var T=l[h][u[h]];if(!(T>=0)){E=d.AromaticTypes.NONAROMATIC;break}_+=T}if(null===E){var O=parseInt(_/4),v=_%4;O<=5&&(2!==O||!s||!i)&&(2===v?(E=d.AromaticTypes.EXPLICIT_AROMATIC,y=t.clone(u)):v||(E=d.AromaticTypes.ANTIAROMATIC))}if(null!==C){if(E&&C!==E&&(C===d.AromaticTypes.EXPLICIT_AROMATIC||E===d.AromaticTypes.EXPLICIT_AROMATIC)){f=d.AromaticTypes.UNCERTAIN;break}}else C=E}while(m(0,u));if(f||(f=C),y)for(var S=new d.MapEx,b=(h=0,y.length);h<b;++h)S.set(o[h],l[h][y[h]]);return{result:f,eMap:S}}},_calcPossibleRingNodesPElectronCounts:function(e,r,n){var i=[],o=[],a=[];if(n){for(s=0,l=n.length;s<l;++s)t.pushUnique(i,n[s].nodes),t.pushUnique(o,n[s].connectors);for(s=0,l=r.length;s<l;++s)t.pushUnique(a,r[s].nodes)}else{for(var s=0,l=r.length;s<l;++s)t.pushUnique(i,r[s].nodes),t.pushUnique(o,r[s].connectors);a=i}for(s=0,l=a.length;s<l;++s){var u=a[s],c=u.getStructureCacheData("piElectronCount");if(d.ObjUtils.notUnset(c))e.set(u,[c]);else{var h=this._getPossibleRingNodePiElectronCounts(u,i,o);e.set(u,h)}}},_storeAromaticCacheToRingInfo:function(e,t,r){if(e.aromaticType=t,t===d.AromaticTypes.EXPLICIT_AROMATIC)for(var n=e.nodes,i=0,o=n.length;i<o;++i){var a=n[i];if(d.ObjUtils.isUnset(a.getStructureCacheData("piElectronCount"))&&r){var s=r.get(a);d.ObjUtils.notUnset(s)&&a.setStructureCacheData("piElectronCount",s)}}},perceiveAromaticRings:function(e,t){d.ObjUtils.isUnset(e)&&(e=d.globalOptions.algorithm.aromaticRingsPerception.allowUncertainRings);var r=this.findSSSR(),n=t||r,i=[],o=new d.MapEx;try{this._calcPossibleRingNodesPElectronCounts(o,n,null);for(var a=0,s=n.length;a<s;++a){var l,u=n[a];if(d.ObjUtils.notUnset(u.aromaticType))l=u.aromaticType;else{var c=this._checkRingAromaticType(u,o,r);l=c.result,this._storeAromaticCacheToRingInfo(u,l,c.eMap)}(l===d.AromaticTypes.EXPLICIT_AROMATIC||e&&l===d.AromaticTypes.UNCERTAIN)&&i.push(u)}return i}finally{o.finalize()}},findAromaticRings:function(e,t){return this.perceiveAromaticRings(e,t)},getRingAromaticType:function(e,t){if(d.ObjUtils.notUnset(e.aromaticType))return e.aromaticType;var r,n=this.findSSSR();t||(t=n);var i=new d.MapEx;try{this._calcPossibleRingNodesPElectronCounts(i,[e],t);var o=this._checkRingAromaticType(e,i,n);r=o.result,this._storeAromaticCacheToRingInfo(e,r,o.eMap)}finally{i.finalize()}return r},getHucklizationChanges:function(e,t){for(var r=t&&t.allowUncertainRings,n=d.BondOrder,i=[],o=(this.getParent(),this.findAromaticRings(r)),a=0,s=o.length;a<s;++a)for(var l=o[a].connectors,u=0,c=l.length;u<c;++u){var h=l[u];if(!e||e.indexOf(h)>=0){var p=h.getBondOrder&&h.getBondOrder();p!==n.SINGLE&&p!==n.DOUBLE||h.setBondOrder&&i.push({bond:h,bondOrder:d.BondOrder.EXPLICIT_AROMATIC})}}return i},hucklize:function(e,t){t&&t.allowUncertainRings,d.BondOrder;var r=[],n=this.getParent();n.setAutoClearStructureCache(!1),n.beginUpdate();try{var i=this.getHucklizationChanges(e,t);if(i)for(var o=0,a=i.length;o<a;++o){var s=i[o].bond,l=i[o].bondOrder;s.setBondOrder&&(s.setBondOrder(l),r.push(s))}}finally{n.endUpdate(),n.setAutoClearStructureCache(!0)}return r},getKekulizationChanges:function(e,t){var r,i=Object.extend({doAromaticTests:!1,includingSubFragments:!0,expandSubFragments:!1,useShadow:!0},t||{}),o=[],a=this.getParent();if(i.doAromaticTests&&this.perceiveAromaticRings(),i.useShadow){var s=a.createShadow();r=s.getShadowFragment()}else r=a;try{var l;if(i.expandSubFragments&&i.useShadow&&r.unmarshalAllSubFragments(!0),e)if(l=[],i.useShadow)for(var u=0,c=e.length;u<c;++u){var h=s.getShadowObj(e[u]);h&&l.push(h)}else l=e;else l=i.includingSubFragments&&!i.expandSubFragments?r.getAllContainingConnectors():r.getConnectors();var p=[];for(u=0,c=l.length;u<c;++u){var g=l[u];g.getBondType()===d.BondType.COVALENT&&g.getBondOrder()===d.BondOrder.EXPLICIT_AROMATIC&&2===g.getConnectedChemNodeCount()&&p.push(g)}r.setAutoClearStructureCache(!1),r.beginUpdate();try{var f=this._splitConnectorsToContinuousParts(p)||[];for(u=0,c=f.length;u<c;++u){var m=f[u];if(this._kekulizeContinousBonds(m,s,r,a))for(var C=0,y=m.length;C<y;++C){var _=m[C].getBondOrder();if(_!==n.EXPLICIT_AROMATIC){var E=i.useShadow?s.getSourceObj(m[C]):m[C];o.push({bond:E,bondOrder:_})}}}}finally{r.endUpdate(),r.setAutoClearStructureCache(!0)}}finally{i.useShadow&&s.finalize()}return o._useShadow=i.useShadow,o},kekulize:function(e,t){var r=[],n=this.getKekulizationChanges(e,t);if(n&&n._useShadow){var i=this.getParent();try{i.setAutoClearStructureCache(!1),i.beginUpdate();for(var o=0,a=n.length;o<a;++o){var s=n[o];s.bond.setBondOrder(s.bondOrder),r.push(s.bond)}}finally{i.endUpdate(),i.setAutoClearStructureCache(!0)}}return r},_kekulizeContinousBonds:function(r,n,i,o){for(var a=[],s=0,l=r.length;s<l;++s){var u=r[s].getConnectedChemNodes()||[];t.pushUnique(a,u)}var c=new d.MapEx(!1);for(s=0,l=a.length;s<l;++s){var h=a[s],p=n?n.getSourceObj(h):h,g=p&&p.getStructureCacheData("piElectronCount");e.notUnset(g)&&c.set(h,{cachedPiElectronCount:g})}return this._doKekulizeContinousBondSys(0,r,a,c)},_doKekulizeContinousBondSys:function(r,i,o,a){var s=this,l=function(t){var r,n=a.get(t);return n?r=n.bondOrder:i.indexOf(t)<0&&(r=t.getBondOrder()),e.notUnset(r)?r:null},u=function(e){var t=l(e);return t>n.SINGLE&&t<=n.QUAD},c=function(r){var o=a.get(r),u=o&&o.cachedPiElectronCount;if(e.isUnset(u)){var c=r.getLinkedBonds(d.BondType.COVALENT);if(function(e){var r=t.intersect(e,i),n=!r||!r.length;if(!n){n=!0;for(var o=0,s=r.length;o<s;++o){var l=r[o];if(!a.get(l)){n=!1;break}}}return n}(c)){var h=t.toArray(s._getPossibleRingNodePiElectronCounts(r,null,null));return!h||!h.length||h[0]<0?-1:h[0]}for(var p=0,g=0,f=c.length;g<f;++g){var m=c[g],C=l(m);e.notUnset(C)&&(C===n.DOUBLE||C===n.TRIPLE||C===n.QUAD)&&++p}p&&(u=1===p?1:-1)}return u},h=i[r],p=h.getConnectedChemNodes(),g=[];if(!a.get(h)){if(function(e){for(var t=e.getNeighboringBonds(),r=0,n=t.length;r<n;++r)if(e=t[r],u(e))return!0;return!1}(h))g=[n.SINGLE];else{var f=function(t,r){for(var n=0,i=0,o=0,a=r.length;o<a;++o){var s=c(r[o]);e.notUnset(s)&&(s>=2?++n:++i)}return n>0||!(i>=2)&&null}(0,p);g=f?[n.SINGLE]:null!==f?[n.DOUBLE]:[n.DOUBLE,n.SINGLE]}for(var m,C=0,y=g.length;C<y;++C){m=!0;var _=g[C];a.set(h,{bondOrder:_}),h.setBondOrder(_);for(var E=0,T=p.length;E<T;++E){var O=p[E];if(c(O)<0){m=!1;break}}if(m){if(!(r<i.length-1)){m=!0;break}if(m=this._doKekulizeContinousBondSys(r+1,i,o,a))break}}return!!m||(h.setBondOrder(n.EXPLICIT_AROMATIC),a.remove(h),!1)}},_splitConnectorsToContinuousParts:function(e){if(!e||!e.length)return null;for(var r=function e(t,r){var n=r.indexOf(t);if(n<0)return[];r.splice(n,1);for(var i=[t],o=t.getNeighboringConnectors(),a=0,s=o.length;a<s;++a){var l=o[a];r.indexOf(l)>=0&&(i=i.concat(e(l,r)))}return i},n=[],i=t.clone(e);i.length;){var o=r(i[0],i);o&&o.length&&n.push(o)}return n}}),ClassEx.extend(d.StructureFragment,{perceiveAromaticRings:function(e,t){var r=this.hasCtab()?this.getCtab().perceiveAromaticRings(e,t):[];return this.setAromaticRings(r||[]),r},findAromaticRings:function(e,t){return this.perceiveAromaticRings(e,t)},getRingAromaticType:function(e,t){return this.hasCtab()?this.getCtab().getRingAromaticType(e,t):null},getHucklizationChanges:function(e,t){return this.hasCtab()?this.getCtab().getHucklizationChanges(e,t):[]},hucklize:function(e,t){return this.hasCtab()?this.getCtab().hucklize(e,t):[]},getKekulizationChanges:function(e,t){return this.hasCtab()?this.getCtab().getKekulizationChanges(e,t):[]},kekulize:function(e,t){return this.hasCtab()?this.getCtab().kekulize(e,t):[]}}),ClassEx.extend(d.ChemObject,{perceiveAromaticRings:function(e,t){for(var r=i.getAllStructFragments(this),n=[],o=0,a=r.length;o<a;++o){var s=r[o].perceiveAromaticRings(e,t);s&&(n=n.concat(s))}return n.length?n:null},findAromaticRings:function(e,t){return this.perceiveAromaticRings(e,t)},_groupActualTargetBondsOfKekulizationOrHucklization:function(e,t,r){var n=[];if(t)for(l=0,d=t.length;l<d;++l)for(var i=t[l],o=0,a=e.length;o<a;++o){var s=e[o];i.isChildOf(s)&&(n[o]?n[o].bonds.push(i):n[o]={structFragment:s,bonds:[i]})}else for(var l=0,d=e.length;l<d;++l)n.push({structFragment:e[l],bonds:null});return n},getHucklizationChanges:function(e,t){for(var r=[],n=i.getAllStructFragments(this),o=this._groupActualTargetBondsOfKekulizationOrHucklization(n,e,t),a=0,s=o.length;a<s;++a){var l=o[a];l&&(r=r.concat(l.structFragment.getHucklizationChanges(l.bonds,t)||[]))}return r},hucklize:function(e,t){for(var r=[],n=i.getAllStructFragments(this),o=this._groupActualTargetBondsOfKekulizationOrHucklization(n,e,t),a=0,s=o.length;a<s;++a){var l=o[a];l&&(r=r.concat(l.structFragment.hucklize(l.bonds,t)||[]))}return r},getKekulizationChanges:function(e,t){for(var r=[],n=i.getAllStructFragments(this),o=this._groupActualTargetBondsOfKekulizationOrHucklization(n,e,t),a=0,s=o.length;a<s;++a){var l=o[a];l&&(r=r.concat(l.structFragment.getKekulizationChanges(l.bonds,t)||[]))}return r},kekulize:function(e,t){for(var r=[],n=i.getAllStructFragments(this),o=this._groupActualTargetBondsOfKekulizationOrHucklization(n,e,t),a=0,s=o.length;a<s;++a){var l=o[a];l&&(r=r.concat(l.structFragment.kekulize(l.bonds,t)||[]))}return r}})}(),function(){"use strict";d.globalOptions.add("algorithm.molStandardization",{cleanStructure:!0,clearHydrogens:!0,unmarshalSubFragments:!0,doCanonicalization:!0,doAromaticPerception:!0,doStereoPerception:!0}),d.MolStandardizer={standardize:function(e,t){var r=Object.extend({},d.globalOptions.algorithm.molStandardization),n=e,i=Object.extend(r,t);return i.unmarshalSubFragments&&n.unmarshalAllSubFragments(!0),i.cleanStructure&&n.clean(),i.doCanonicalization&&d.canonicalizer.canonicalize(n,i.canonicalizerExecutorId||null),i.doAromaticPerception&&n.perceiveAromaticRings(),i.doStereoPerception&&n.perceiveStereos(null,!0,i),i.clearHydrogens&&n.clearExplicitBondHydrogens(!0),n}},Object.extend(d.ChemStructureUtils,{compareStructFragment:function(e,t,r){var n=e.clone(!1),i=t.clone(!1);n.setCanonicalizationIndex(null),i.setCanonicalizationIndex(null);var o=Object.create(r||{});return n=d.MolStandardizer.standardize(n,o),i=d.MolStandardizer.standardize(i,o),o.doStandardize=!1,o.extraComparisonProperties=["canonicalizationIndex"],n.compareStructure(i,o)},isSameStructure:function(e,t,r){return 0===d.ChemStructureUtils.compareStructFragment(e,t,r)}}),ClassEx.extend(d.ChemObject,{standardize:function(e){for(var t=d.ChemStructureUtils.getAllStructFragments(this,!0),r=0,n=t.length;r<n;++r)t[r].standardize(e);return this}}),ClassEx.extend(d.StructureFragment,{standardize:function(e){return d.MolStandardizer.standardize(this,e)},isSameStructureWith:function(e,t){return d.ChemStructureUtils.isSameStructure(this,e,t)}}),ClassEx.extendMethod(d.StructureFragment,"compare",(function(e,t,r){return r.method===d.ComparisonMethod.CHEM_STRUCTURE&&!1!==r.doStandardize&&t instanceof d.StructureFragment?d.ChemStructureUtils.compareStructFragment(this,t,r):e(t,r)}))}(),function(){"use strict";var e=d.ArrayUtils;d.globalOptions.add("algorithm.structureSearch",{doStandardize:!0}),d.ChemStructureSearcher={findSubStructure:function(r,n,i){var o=Object.extend(Object.extend({},d.globalOptions.algorithm.structureSearch),i);if(o.exactMatch)return!!n.isSameStructureWith(r,o)&&[].concat(n.getNodes()).concat(n.getConnectors());o=Object.extend({level:d.StructureComparationLevel.CONSTITUTION,compareLinkedConnectorCount:!1,compareHydrogenCount:!1,compareConnectedObjCount:!1},o);var a=o=d.ObjComparer.getStructureComparisonDetailOptions(o);if(o.doStandardize){var s={unmarshalSubFragments:!1,doCanonicalization:!0,doAromaticPerception:!0};o.compareStereo||(s.doCanonicalization=!1),r.standardize(s),n.standardize(s)}for(var l=n.getFlattenedShadowFragment(!0),u=r.getFlattenedShadowFragment(!0).getNonHydrogenNodes()[0],c=l.getNonHydrogenNodes(),h=c.length,p=0,g=[],f=[],m=!1;!m&&p<h;)m=t._compareNode(u,c[p],g,f,a),++p;if(m){var C=e.toUnique(m);return n.getFlatternedShadowSourceObjs(C)}return!1},_addToComparedObjs:function(e,t,r){t.push(e)},_removeFromComparedObjs:function(e,t,r){var n=t.indexOf(e);t.length=n},_isSameMappedObj:function(e,t,r,n){var i=n.indexOf(t),o=r.indexOf(e);return i>=0&&i===o},_compareComparedNeighbors:function(e,t,r,n){if(e.length>t.length)return!1;for(var i=[],o=0,a=e.length;o<a;++o)i.push(r.indexOf(e[o]));var s=[];for(o=0,a=t.length;o<a;++o)s.push(n.indexOf(t[o]));for(o=0,a=i.length;o<a;++o)if(s.indexOf(i[o])<0)return!1;return!0},_compareNode:function(r,n,i,o,a){if(0!==r.compareStructure(n,a))return!1;var s=r.getLinkedNonHydrogenConnectors(),l=n.getLinkedNonHydrogenConnectors();if(s.length>l.length)return!1;var d=e.clone(i),u=e.clone(o);t._addToComparedObjs(r,d,"target"),t._addToComparedObjs(n,u,"src");var c=e.intersect(s,d),h=e.intersect(l,u),p=!0;t._compareComparedNeighbors(c,h,d,u)?(s=e.exclude(s,c),l=e.exclude(l,h),s.length>l.length&&(p=!1)):p=!1;for(var g=[];p&&s.length;){for(var f,m=!1,C=s.shift(),y=0;l.length&&!m&&y<l.length;)f=l[y],(m=t._compareConnector(C,f,d,u,a))&&(g=g.concat(m)),++y;if(!m){p=!1;break}e.remove(l,f)}return p&&(p=[n].concat(g)),p},_compareConnector:function(r,n,i,o,a){if(0!==r.compareStructure(n,a))return!1;if(r.getConnectedObjCount()>n.getConnectedObjCount())return!1;var s=e.clone(i),l=e.clone(o);t._addToComparedObjs(r,s,"target"),t._addToComparedObjs(n,l,"src");var u=e.clone(r.getConnectedObjs()),c=e.clone(n.getConnectedObjs()),h=e.intersect(u,s),p=e.intersect(c,l),g=!0;t._compareComparedNeighbors(h,p,s,l)?(u=e.exclude(u,h),c=e.exclude(c,p),u.length>c.length&&(g=!1)):g=!1;for(var f=[];g&&u.length;){for(var m,C=!1,y=u.shift(),_=0;c.length&&!C&&_<c.length;)(C=(m=c[_]).getClass()===y.getClass()&&(m instanceof d.ChemStructureNode?t._compareNode(y,m,s,l,a):m instanceof d.ChemStructureConnector&&t._compareConnector(y,m,s,l,a)))&&(f=f.concat(C)),++_;if(!C){g=!1;break}e.remove(c,m)}return g&&(g=[n].concat(f)),g}};var t=d.ChemStructureSearcher;ClassEx.extend(d.StructureFragment,{search:function(e,r){return t.findSubStructure(e,this,r)}})}(),function(){"use strict";var e=d.ArrayUtils,t=d.CoordUtils;d.RotationDir={CLOCKWISE:1,ANTICLOCKWISE:-1,UNKNOWN:0};var r=d.RotationDir;d.globalOptions.add("algorithm.stereoPerception",{useFlattenedShadow:!0,perceiveStereoConnectors:!0,perceiveChiralNodes:!0,calcParity:!0,strictStereoBondGeometry:!1,strictStereoAtomGemoetry:!1,wedgeBondPrior:!0}),d.MolStereoUtils={FISCHER_PROJECTION_BOND_ALLOWED_ERROR:.08,getDihedralAngleOfNodes:function(e,t,r,n,i,o){d.ObjUtils.isUnset(o)&&(o=!0),d.ObjUtils.isUnset(i)&&(i=t.hasCoord3D()?d.CoordMode.COORD3D:d.CoordMode.COORD2D);var a=d.MolStereoUtils._getNodeCoordForBondParity,s=t.getConnectorTo(r),l=s&&s.isDoubleBond&&s.isDoubleBond(),u=a(t,null,null,i,o),c=a(r,null,null,i,o),h=a(e,t,u,i,o,l),p=a(n,r,c,i,o,l);return h&&u&&c&&p?d.GeometryUtils.getDihedralAngleOfPoints(h,u,c,p):-1},getParityOfNodeSeq:function(e,t,r,n,i,o){var a=d.StereoParity,s=d.MolStereoUtils.getDihedralAngleOfNodes(e,t,r,n,i,o);return s<0?a.UNKNOWN:s<2*Math.PI/5||s>8*Math.PI/5?a.ODD:s>3*Math.PI/5&&s<7*Math.PI/5?a.EVEN:a.UNKNOWN},_getNodeCoordForBondParity:function(e,r,n,i,o,a){if(i!==d.CoordMode.COORD2D)return e.getAbsCoordOfMode(i,!0);var s=e.getAbsCoordOfMode(i,!0);if(r&&n){var l=e.getConnectorTo(r);if(l.getStereo){var u=l.getStereo(),c=d.BondStereo,h=[c.UP,c.UP_INVERTED,c.DOWN,c.DOWN_INVERTED];if(h.indexOf(u)>=0){l.indexOfConnectedObj(e)-l.indexOfConnectedObj(r)<0&&(u=c.getInvertedDirection(u));var p=t.getDistance(s,n);s.z=p*[1,-1,-1,1][h.indexOf(u)]}else if([c.UP_OR_DOWN,c.UP_OR_DOWN_INVERTED].indexOf(u)>=0)return null}}return s.z=s.z||0,s},_calcParityOfCoordPairs:function(e,r,n,i,o,a,s){var l=d.StereoParity,u=t.substract(r,e);if(!u.x&&!u.y)return l.UNKNOWN;for(var c=Math.atan2(u.y,u.x),h=t.calcTransform2DMatrix({rotateAngle:-c,center:e,translateX:-e.x,translateY:-e.y}),p=[e,r,n,i,o,a],g=[],f=0,m=p.length;f<m;++f){var C=p[f];g[f]=C?t.transform2DByMatrix(C,h):null}g[0];var y=g[1],_=g[2],E=g[3],T=t.substract(g[4],y),O=g[5]?t.substract(g[5],y):null,v=function(e,t,r,n){var i=0,o=Math.sqrt(Math.sqr(e.x)+Math.sqr(e.y));if(t){var a=Math.sqrt(Math.sqr(t.x)+Math.sqr(t.y));if(l=e.y/o-t.y/a,Math.abs(l)<r)i=0;else if(Math.sign(e.y)!==Math.sign(t.y))i=Math.sign(l)*n;else{if(s)return 0;l=-(e.x/e.y-t.x/t.y),i=Math.sign(l)}}else{var l=e.y/o;i=Math.abs(l)<r?0:Math.sign(e.y)*n}return i},S=v(_,E,.05,-1),b=v(T,O,.05,1);return S&&b?S!==b?l.ODD:l.EVEN:l.UNKNOWN},isStereoBond:function(t){var r=d.ObjUtils.isUnset;if(t.getBelongedRingMinSize){var n=t.getBelongedRingMinSize()||0;if(n>0&&n<=10)return!1}var i=!1;if(t.isDoubleBond&&t.isDoubleBond()&&2===t.getConnectedObjCount()){var o=t.getConnectedChemNodes();if(2===o.length){i=!0;for(var a=0;a<2;++a){for(var s=o[a],l=s.getHydrogenCount(!0),u=[],c=s.getLinkedBonds(d.BondType.COVALENT),h=0,p=c.length;h<p;++h){var g=c[h];if(g!==t){var f=g.getBondOrder();if(f&&f!==d.BondOrder.SINGLE)return!1;var m=e.exclude(g.getConnectedChemNodes(),o);if(1!==m.length)return!1;u.push(m[0])}}if(l>=2||!u.length){i=!1;break}if(1===u.length);else if(2===u.length&&(r(u[0].getCanonicalizationIndex())&&r(u[1].getCanonicalizationIndex())||u[0].getCanonicalizationIndex()===u[1].getCanonicalizationIndex())){i=!1;break}for(h=0,p=u.length;h<p;++h){var C=s.getConnectorTo(u[h]);if(!C.isSingleBond||!C.isSingleBond()){i=!1;break}}if(!i)break}}}else i=!1;return i},doFindStereoBonds:function(e,t){var r=[];t||d.canonicalizer.canonicalize(e,"morganEx");for(var n=0,i=e.getConnectorCount();n<i;++n){var o=e.getConnectorAt(n);d.MolStereoUtils.isStereoBond(o)&&r.push(o)}return r},getStereoBondKeyNodes:function(t){var r=null;if(2===t.getConnectedObjCount()){var n=t.getConnectedChemNodes();if(2===n.length){for(var i=[],o=0;o<2;++o){var a=n[o],s=e.exclude(a.getLinkedChemNodes(),n);if(1===s.length)i.push(s[0]);else{if(2!==s.length)return null;var l=s[0].getCanonicalizationIndex()||-1,d=s[1].getCanonicalizationIndex()||-1;i.push(d>l?s[1]:s[0])}}r=[i[0],n[0],n[1],i[1]]}}return r},getStereoBondKeyNeighborConnectors:function(e){var t=d.MolStereoUtils.getStereoBondKeyNodes(e);return[t[1].getConnectorTo(t[0]),t[2].getConnectorTo(t[3])]},getStereoBondRelNodes:function(t){var r=null;if(2===t.getConnectedObjCount()){var n=t.getConnectedChemNodes();if(2===n.length){for(var i=[],o=0;o<2;++o){var a=n[o],s=e.exclude(a.getLinkedChemNodes(),n);if(1===s.length)i.push(s[0]),i.push(null);else{if(2!==s.length)return null;var l=s[0].getCanonicalizationIndex()||-1,d=s[1].getCanonicalizationIndex()||-1;i.push(d>l?s[1]:s[0]),i.push(d>l?s[0]:s[1])}}r=[n[0],n[1],i[0],i[1],i[2],i[3]]}}return r},calcStereoBondParity:function(e,t,r,n){var i=d.StereoParity;if(!r&&!d.MolStereoUtils.isStereoBond(e))return i.NONE;if(e.getStereo&&[d.BondStereo.E_OR_Z,d.BondStereo.CIS_OR_TRANS].indexOf(e.getStereo())>=0)return i.NONE;var o,a,s=i.UNKNOWN,l=d.MolStereoUtils.getStereoBondKeyNodes(e);if(l&&l.length){if(d.ObjUtils.isUnset(t)&&(t=l[1].hasCoord3D()?d.CoordMode.COORD3D:d.CoordMode.COORD2D),t===d.CoordMode.COORD3D){var u=d.MolStereoUtils.getDihedralAngleOfNodes(l[0],l[1],l[2],l[3],t);if(u<0||u>2*Math.PI/5&&u<3*Math.PI/5||u>7*Math.PI/5&&u<8*Math.PI/5)return i.UNKNOWN}var c=d.MolStereoUtils._getNodeCoordForBondParity,h=d.MolStereoUtils.getStereoBondRelNodes(e),p=[c(h[0],null,null,t,!0),c(h[1],null,null,t,!0)];p=p.concat([c(h[2],h[0],p[0],t,!0,!0),h[3]?c(h[3],h[0],p[0],t,!0,!0):null,c(h[4],h[1],p[1],t,!0,!0),h[5]?c(h[5],h[1],p[1],t,!0,!0):null]);for(var g=t===d.CoordMode.COORD2D?[["x","y"]]:[["x","y"],["x","z"],["y","z"]],f=null,m=0,C=g.length;m<C;++m){for(var y=[],_=0,E=p.length;_<E;++_)p[_]?y.push((o=p[_],a=g[m],o?{x:o[a[0]],y:o[a[1]]}:null)):y.push(null);var T=d.MolStereoUtils._calcParityOfCoordPairs(y[0],y[1],y[2],y[3],y[4],y[5],n);if(T!==i.UNKNOWN)if(null===f)f=T;else if(f!==T)return i.UNKNOWN}s=f}return s},doPerceiveStereoConnectors:function(e,t,r,n){var i=d.MolStereoUtils.doFindStereoBonds(e,r);e.beginUpdate();try{if(i&&i.length)for(var o=0,a=i.length;o<a;++o){var s=i[o],l=d.MolStereoUtils.calcStereoBondParity(s,t,!0,n);s.setParity&&s.setParity(l)}}finally{e.endUpdate()}return i},isChiralNode:function(e){var t=!1;if(e.mayContainElement){var r,n,i=null,o=!1;if(e.mayContainElement("C")||e.mayContainElement("Si")?(r=4,n=0,i=[0],o=!0):e.mayContainElement("N")?(r=4,n=0,o=!0):e.mayContainElement("S")||e.mayContainElement("P")?(r=3,n=0,o=!0):e.mayContainElement("B")&&(r=3,n=0,i=[-1],o=!0),o){if(e.getLinkedMultiCenterBonds().length)return!1;var a=e.getLinkedChemNodes(),s=e.getLinkedMultipleBonds(),l=e.getHydrogenCount?e.getHydrogenCount():0,d=e.getHydrogenCount?e.getHydrogenCount(!0):0,u=e.getCharge()||0;if(s.length>n||d>=2||a.length+l<r||i&&i.indexOf(u)<0)t=!1;else{t=!0;for(var c=[],h=0,p=a.length;h<p;++h){var g=a[h].getCanonicalizationIndex()||0;if(c[g]){t=!1;break}c[g]=1}}}}return t},doFindChiralNodes:function(e,t){var r=[];t||d.canonicalizer.canonicalize(e,"morganEx");for(var n=0,i=e.getNodeCount();n<i;++n){var o=e.getNodeAt(n);d.MolStereoUtils.isChiralNode(o)&&r.push(o)}return r},calcRotationDirection:function(e,n,i,o,a,s){var l,u=s?t.substract(e,n):t.substract(n,e),c=null;0!==u.x||0!==u.y?(l=d.GeometryUtils.getVectorCrossProduct(u,{x:0,y:0,z:1}),f=d.GeometryUtils.getVectorIncludedAngle(u,{x:0,y:0,z:1}),u.z<0&&(f=Math.PI-f)):u.z<0&&(l={x:1,y:0,z:0},f=Math.PI),l&&f&&(c=t.calcRotate3DMatrix({rotateAngle:f,rotateAxisVector:l,center:{x:0,y:0,z:0}}));var h=t.substract(i,e),p=t.substract(o,e),g=t.substract(a,e);c&&(h=t.transform3DByMatrix(h,c),p=t.transform3DByMatrix(p,c),g=t.transform3DByMatrix(g,c));var f=-Math.atan2(h.y,h.x),m=(c=t.calcTransform2DMatrix({rotateAngle:f,center:{x:0,y:0,z:0}}),t.transform2DByMatrix(p,c)),C=t.transform2DByMatrix(g,c);if(0===m.x||0===C.x)return r.UNKNOWN;var y=Math.atan2(m.y,m.x),_=Math.atan2(C.y,C.x);return _<0&&(_=2*Math.PI+_),y<0&&(y=2*Math.PI+y),y<_?r.ANTICLOCKWISE:y>_?r.CLOCKWISE:r.UNKNOWN},_extractFischerProjectionDetectOptions:function(e){var t=e||{};return{allowedError:t.fischerAllowedError,reversedDirection:t.reversedFischer,allowExplicitHydrogen:t.allowExplicitHydrogenInFischer,allowExplicitVerticalHydrogen:t.allowExplicitVerticalHydrogen}},_getFischerProjectionInfo:function(e,r,n){var i=Object.create(n||null);if(i.allowExplicitVerticalHydrogen=!0,i.allowExplicitHydrogen=!0,r.length<3||r.length>4)return null;if(3===r.length&&!i.allowExplicitHydrogen)return null;var o=d.CoordMode.COORD2D,a=i.allowedError||d.MolStereoUtils.FISCHER_PROJECTION_BOND_ALLOWED_ERROR;if(!i.ignoreStructure){var s=e instanceof d.Atom&&6===e.getAtomicNumber();if(s&&e.getRenderOption&&(s=e.getRenderOption("nodeDisplayMode")!==d.Render.NodeLabelDisplayMode.SHOWN),!s)return null}for(var l=e.getAbsCoordOfMode(o,!0),u=[],c=[],h=0,p=function(e,t,r){return!e[t]&&(e[t]=r,!0)},g=0,f=r.length;g<f;++g){var m=r[g],C=m.getConnectorTo(e);if(!i.ignoreStructure){var y=C.getStereo()||d.BondStereo.NONE;if(!(C instanceof d.Bond&&y===d.BondStereo.NONE))return null}var _,E,T=m.getAbsCoordOfMode(o,!0),O=t.substract(T,l),v=Math.abs(O.x),S=Math.abs(O.y);if(d.NumUtils.isFloatEqual(v,0)&&d.NumUtils.isFloatEqual(S,0))return null;if(v>S?(E=S/v,_=O.x>0?1:3):(E=v/S,_=O.y>0?0:2,++h),E>a)return null;if(!p(u,_,m))return null;p(c,_,C)}if(2!==h&&!i.allowExplicitVerticalHydrogen)return null;var b={horizontalSiblings:[u[3],u[1]],verticalSiblings:[u[0],u[2]],horizontalBonds:[c[3],c[1]],verticalBonds:[c[0],c[2]]};return i.reversedDirection?(b.towardSiblings=b.verticalSiblings,b.awaySiblings=b.horizontalSiblings,b.towardBonds=b.verticalBonds,b.awayBonds=b.horizontalBonds,b.implicitTowardSibling=!u[0]||!u[2],b.implicitAwaySibling=!u[1]||!u[3]):(b.towardSiblings=b.horizontalSiblings,b.awaySiblings=b.verticalSiblings,b.towardBonds=b.horizontalBonds,b.awayBonds=b.verticalBonds,b.implicitTowardSibling=!u[1]||!u[3],b.implicitAwaySibling=!u[0]||!u[2]),b},calcTetrahedronChiralCenterRotationDirectionEx:function(n,i,o,a){var s=Object.extend({implicitFischerProjection:!0,allowExplicitHydrogenInFischer:!0},a),l=s.coordMode,u=!!s.withImplicitSibling,c=!!s.refSiblingBehind;if(s.implicitFischerProjection,!l){var h=n||i||o[0];if(!h)return{direction:r.UNKNOWN};l=h.hasCoord3D()?d.CoordMode.COORD3D:d.CoordMode.COORD2D}var p=l===d.CoordMode.COORD2D,g=o.length,f=g;if(i&&++f,u&&++f,f<4)return{direction:r.UNKNOWN};var m=function(e,r,n,i,o){if(i!==d.CoordMode.COORD2D)return e.getAbsCoordOfMode(i,!0);var a,l=e.getAbsCoordOfMode(i,!0);if(r&&n){a=n.z;var u=e.getConnectorTo(r);if(u.getStereo){var c=u.indexOfConnectedObj(e)-u.indexOfConnectedObj(r),h=d.BondStereo,p=u.getStereo()||h.NONE;p===h.NONE&&o&&(o.towardSiblings.indexOf(e)>=0?p=c<0?h.UP_INVERTED:h.UP:o.awaySiblings.indexOf(e)>=0&&(p=c<0?h.DOWN_INVERTED:h.DOWN));var g=[h.UP,h.UP_INVERTED,h.DOWN,h.DOWN_INVERTED];if(g.indexOf(p)>=0){c<0&&(p=h.getInvertedDirection(p));var f=s.wedgeBondPrior?[2,-2,-1,1]:[1,-1,-1,1],m=t.getDistance(l,n);l.z=m*f[g.indexOf(p)]}else if([h.UP_OR_DOWN,h.UP_OR_DOWN_INVERTED].indexOf(p)>=0)return null}}return d.ObjUtils.isUnset(l.z)&&e.getZIndex2D&&(l.z=e.getZIndex2D(),d.ObjUtils.isUnset(l.z)&&(l.z=a)),l.z=l.z||0,l},C=n?m(n,null,null,l):null,y=d.MolStereoUtils._extractFischerProjectionDetectOptions(s),_=[].concat(o);i&&d.ArrayUtils.pushUnique(_,i);for(var E=n&&s.implicitFischerProjection?d.MolStereoUtils._getFischerProjectionInfo(n,_,y):null,T=[],O=0;O<g;++O){var v=m(o[O],n,C,l,E);T.push(v)}var S=e.clone(T),b=i?m(i,n,C,l,E):null;if(b&&S.push(b),S.indexOf(null)>=0)return{direction:r.UNKNOWN,fisherInfo:E};if(!C){for(var A={},I=(O=0,S.length);O<I;++O)A=t.add(S[O],A);C=t.divide(A,S.length)}var R=0;for(O=0,I=S.length;O<I;++O){var D=S[O],N=t.substract(D,C);D.x=N.x,D.y=N.y,D.z=N.z,p&&N.z&&++R}if(p&&R<=0)return{direction:r.UNKNOWN,fisherInfo:E};if(C={x:0,y:0,z:0},u){var P=0;for(A={},O=0,I=S.length;O<I;++O)A=t.add(S[O],A),P=Math.max(P,S[O].z||0);var x=t.substract({x:0,y:0,z:0},A);E&&(E.implicitTowardSibling||E.implicitTowardSibling)&&(x.z=E.implicitTowardSibling?P:-P),i?T.push(x):b=x}return 3===T.length&&T.indexOf(null)<0?{direction:d.MolStereoUtils.calcRotationDirection(C,b,T[0],T[1],T[2],c),fisherInfo:E}:{direction:r.UNKNOWN,fisherInfo:E}},calcTetrahedronChiralCenterRotationDirection:function(e,t,r,n,i,o,a){var s=Object.create(a);return d.MolStereoUtils.calcTetrahedronChiralCenterRotationDirectionEx(t,r,n,Object.extend(s,{coordMode:e,withImplicitSibling:i,refSiblingBehind:o})).direction},calcTetrahedronChiralNodeParity:function(e,t,n){var i=Object.create(n||null);t||(t=e.hasCoord3D()?d.CoordMode.COORD3D:d.CoordMode.COORD2D),i.coordMode=t,i.refSiblingBehind=!0;var o=d.StereoParity;if(!i.ignoreChiralCheck&&!d.MolStereoUtils.isChiralNode(e))return o.NONE;var a=e.getLinkedChemNodes();if(t===d.CoordMode.COORD2D&&n.strictStereoAtomGeometry&&!d.MolStereoUtils._isSiblingBond2DGeometryLegal(e,a))return o.UNKNOWN;var s=e.getHydrogenCount();i.withImplicitSibling=!!s||a.length<4,a.sort((function(e,t){return-((e.getCanonicalizationIndex()||0)-(t.getCanonicalizationIndex()||0))}));var l=i.withImplicitSibling?null:a[3];a=a.slice(0,3);var u=d.MolStereoUtils.calcTetrahedronChiralCenterRotationDirectionEx(e,l,a,i).direction;return u===r.CLOCKWISE?o.ODD:u===r.ANTICLOCKWISE?o.EVEN:o.UNKNOWN},_isSiblingBond2DGeometryLegal:function(e,t){for(var r=d.BondStereo,n=[r.NONE,r.CLOSER],i=[2,2],o=[],a=0,s=t.length;a<s;++a){var l=t[a];if(!l.getZIndex2D()){var u=e.getConnectorTo(l);if(u.getStereo){var c=u.getStereo();if(n.indexOf(c)>=0)if(o[c]){if(++o[c],o[c]>i[c])return!1}else o[c]=1}}}return!0},doPerceiveChiralNodes:function(e,t,r,n){var i=Object.create(n||null),o=Object.create(i);o.ignoreChiralCheck=!0;var a=d.MolStereoUtils.doFindChiralNodes(e,r);e.beginUpdate();try{if(a&&a.length)for(var s=0,l=a.length;s<l;++s){var u=a[s],c=d.MolStereoUtils.calcTetrahedronChiralNodeParity(u,t,o);u.setParity&&u.setParity(c)}}finally{e.endUpdate()}return a},perceiveStereos:function(e,t,r,n){var i,o,a=Object.extend(Object.extend({},d.globalOptions.algorithm.stereoPerception),n),s=e instanceof d.StructureConnectionTable?e.getParent():e;o=a.useFlattenedShadow?s.getFlattenedShadowFragment(!0):s,r||d.canonicalizer.canonicalize(o,"morganEx"),o.beginUpdate();try{var l,u;a.perceiveStereoConnectors&&(l=a.calcParity?d.MolStereoUtils.doPerceiveStereoConnectors(o,t,!0,a.strictStereoBondGeometry):d.MolStereoUtils.doFindStereoBonds(o,!0)),a.perceiveChiralNodes&&(u=a.calcParity?d.MolStereoUtils.doPerceiveChiralNodes(o,t,!0,a):d.MolStereoUtils.doFindChiralNodes(o,!0));var c=(u||[]).concat(l||[]);if(a.useFlattenedShadow&&!s.getFlattenedShadowOnSelf()){i=[],s.beginUpdate();try{for(var h=0,p=c.length;h<p;++h){var g=s.getFlatternedShadowSourceObj(c[h]);g&&(a.calcParity&&g.setParity(c[h].getParity()),i.push(g))}}finally{s.endUpdate()}}else i=c}finally{o.endUpdate()}return i},_setWedgeAroundFischerCenter:function(e,t,r,n){for(var i=d.BondStereo,o=function(e,t,r){e.setStereo(c),r&&(e.getRenderOption("renderType")||e.setRenderOption("renderType",d.Render.BondRenderType.SINGLE))},a=!(!n||!n.maintainRenderStyle),s=0,l=t.towardBonds.length;s<l;++s){var u=t.towardBonds[s];if(r.indexOf(u)>=0){var c=u.indexOfConnectedObj(e)>0?i.UP_INVERTED:i.UP;o(u,0,a)}}for(s=0,l=t.awayBonds.length;s<l;++s)u=t.awayBonds[s],r.indexOf(u)>=0&&(c=u.indexOfConnectedObj(e)>0?i.DOWN_INVERTED:i.DOWN,o(u,0,a))},convertFischerCenterBondsToWedge:function(e,t,r,n){r||(r=t.getLinkedBonds());var i=t.getLinkedChemNodes(),o=(d.MolStereoUtils._extractFischerProjectionDetectOptions(n),d.MolStereoUtils._getFischerProjectionInfo(t,i,fischerOptions));if(o){e.beginUpdate();try{d.MolStereoUtils._setWedgeAroundFischerCenter(t,o,r,n)}finally{e.endUpdate()}}},convertFischerBondsToWedge:function(e,t){for(var r=d.MolStereoUtils.perceiveStereos(e,null,null,{perceiveStereoConnectors:!1,perceiveChiralNodes:!0,calcParity:!1}),n=d.MolStereoUtils._extractFischerProjectionDetectOptions(t),i=new d.MapEx,o=[],a=0,s=r.length;a<s;++a){var l=r[a].getLinkedChemNodes();(h=d.MolStereoUtils._getFischerProjectionInfo(r[a],l,n))&&(i.set(r[a],h),o.push(r[a]))}var u=function(e,t,r){for(var n=[],i=0,o=e.length;i<o;++i){var a=e[i],s=t.getLinkedObjsOnConnector(a);d.ArrayUtils.intersect(s,r).length||n.push(a)}return n};e.beginUpdate();try{for(a=0,s=o.length;a<s;++a){var c=o[a],h=i.get(c),p=[].concat(h.towardBonds).concat(h.awayBonds);p=u(p,c,o),d.MolStereoUtils._setWedgeAroundFischerCenter(c,h,p,t)}}finally{e.endUpdate()}},findStereoConnectors:function(e,t){return d.MolStereoUtils.perceiveStereos(e,null,t,{perceiveStereoConnectors:!0,perceiveChiralNodes:!1,calcParity:!1})},perceiveStereoConnectors:function(e,t,r,n){return d.MolStereoUtils.perceiveStereos(e,t,r,{perceiveStereoConnectors:!0,perceiveChiralNodes:!1,calcParity:!0,strictStereoBondGeometry:n})},findChiralNodes:function(e,t){return d.MolStereoUtils.perceiveStereos(e,null,t,{perceiveStereoConnectors:!1,perceiveChiralNodes:!0,calcParity:!1})},perceiveChiralNodes:function(e,t,r,n){var i=Object.create(n||null);return i=Object.extend(i,{perceiveStereoConnectors:!1,perceiveChiralNodes:!0,calcParity:!0}),d.MolStereoUtils.perceiveStereos(e,t,r,i)}},d.CanonicalizationMorganExIndexer=Class.create(d.CanonicalizationMorganIndexer,{CLASS_NAME:"Kekule.CanonicalizationMorganExIndexer",doExecute:function(e){var t=this.doCalcGraphAndEcResult(e);this.doExecuteOnGraphEcResult(t.graph,t.ecMapping,t.vertexGroup);var r=e.getNonHydrogenNodes(),n=this._groupNodesByCanoIndex(r),i=null,o=0;for(i=d.MolStereoUtils.perceiveStereos(e,null,!0)||[];o<i.length;)n=this._regroupSortedNodes(n),this._setCanonicalizationIndexToNodeGroups(n),o=i.length,i=d.MolStereoUtils.perceiveStereos(e,null,!0)||[];o>0&&this.doExecuteOnGraphEcResult(t.graph,t.ecMapping,t.vertexGroup)},_groupNodesByCanoIndex:function(t){return e.group(t,(function(e,t){return(e.getCanonicalizationIndex()||-1)-(t.getCanonicalizationIndex()||-1)}))},_regroupSortedNodes:function(e){var t,r,n=e;do{t=n.length,r=(n=this._doRegroupSortedNodes(n)).length}while(r>t);return n},_doRegroupSortedNodes:function(t){for(var r=[],n=0,i=t.length;n<i;++n){var o=t[n];if(e.isArray(o)){var a=e.group(o,(function(e,t){var r=e.compareStructure(t);if(0===r){var n=e.getLinkedConnectors(),i=t.getLinkedConnectors();r=d.ObjComparer.compareStructure(n,i)}return r}));r=r.concat(a)}else r.push(o)}return r}}),d.canonicalizer.registerExecutor("morganEx",[d.CanonicalizationMorganExIndexer,d.CanonicalizationMorganNodeSorter],!0),ClassEx.extend(d.StructureFragment,{perceiveChiralNodes:function(e,t,r){return d.MolStereoUtils.perceiveChiralNodes(this,e,t,r)},perceiveStereoConnectors:function(e,t){return d.MolStereoUtils.perceiveStereoConnectors(this,e,t)},perceiveStereos:function(e,t,r){return d.MolStereoUtils.perceiveStereos(this,e,t,r)}})}(),function(){"use strict";d.Calculator={},d.Calculator.Utils={_instanceMaxIndex:0,generateUid:function(){return++d.Calculator.Utils._instanceMaxIndex,"Kekule.Calculator."+d.Calculator.Utils._instanceMaxIndex}},d.Calculator.getWorkerBasePath=function(){var e=d.isUsingMinJs()?"workers/":"calculation/workers/";return d.getScriptPath()+e},d.Calculator.Base=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Calculator.Base",WORKER_SHARED_COUNT_FIELD:"__$workerSharedCount$__",initialize:function(){this.setPropStoreFieldValue("uid",this._generateUid()),this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("async",{dataType:DataType.BOOL}),this.defineProp("worker",{dataType:DataType.OBJECT,setter:null}),this.defineProp("uid",{dataType:DataType.STRING,setter:null})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAsync(!0),this.reactWorkerMessageBind=this.reactWorkerMessage.bind(this),this.reactWorkerErrorBind=this.reactWorkerError.bind(this)},doFinalize:function(){this.finalizeWorker(),this.tryApplySuper("doFinalize")},_generateUid:function(){return d.Calculator.Utils.generateUid()},isWorkerShared:function(){return!1},_incWorkerSharedCount:function(e){if(this.isWorkerShared()){var t=e[this.WORKER_SHARED_COUNT_FIELD]||0;++t,e[this.WORKER_SHARED_COUNT_FIELD]=t}},_decWorkerSharedCount:function(e){if(this.isWorkerShared()){var t=e[this.WORKER_SHARED_COUNT_FIELD]||0;t&&--t,e[this.WORKER_SHARED_COUNT_FIELD]=t}},_isWorkerInSharingState:function(e){return this.isWorkerShared()&&(e[this.WORKER_SHARED_COUNT_FIELD]||0)>0},getWorkerBasePath:function(){return d.Calculator.getWorkerBasePath()},execute:function(e,t,r){if(this._doneCallback=e,this._errCallback=t,this._msgCallback=r,this.getAsync()&&this.isWorkerSupported()&&this.fetchWorker()){var n=this.getWorker();this._incWorkerSharedCount(n),this._installWorkerEventReceiver(n),this.workerStartCalc(n)}else{var i,o;try{o=this.executeSync(e)}catch(e){i=e}i?(d.error(i),this.error(i)):o&&(i?this.error(i):this.done())}},executeSync:function(e){this._doneCallback=e;var t=this.doExecuteSync(e);return t&&this.done(),t},doExecuteSync:function(e){},error:function(e){d.error(e),this._errCallback&&this._errCallback(e)},done:function(){this._doneCallback&&this._doneCallback.apply(this,arguments),this.getWorker()&&this.workerJobDone()},halt:function(){var e=this.getWorker();e&&(e.terminate(),this.error(d.$L("ErrorMsg.CALC_TERMINATED_BY_USER")))},isWorkerSupported:function(){return d.BrowserFeature.workers},fetchWorker:function(){var e=this.getWorker();return e||(e=this.createWorker()),e},createWorker:function(){if(this.isWorkerSupported()){var e=this.getWorkerScriptFile();if(e){var t=new Worker(e);return this.setPropStoreFieldValue("worker",t),t}}},_installWorkerEventReceiver:function(e){e.addEventListener("message",this.reactWorkerMessageBind),e.addEventListener("error",this.reactWorkerErrorBind)},_uninstallWorkerEventReceiver:function(e){e.removeEventListener("message",this.reactWorkerMessageBind),e.removeEventListener("error",this.reactWorkerErrorBind)},getWorkerScriptFile:function(){return null},importWorkerScriptFile:function(e){this.postWorkerMessage({type:"importScript",url:e})},postWorkerMessage:function(e){var t=Object.extend({uid:this.getUid()},e),r=this.getWorker();r&&r.postMessage(t)},reactWorkerMessage:function(e){return e.data.uid===this.getUid()?(this._msgCallback&&this._msgCallback(e.data),this.doReactWorkerMessage(e.data,e)):null},doReactWorkerMessage:function(e,t){},reactWorkerError:function(e){d.error(e.message),this.error(e.message)},workerStartCalc:function(e){},workerJobDone:function(){var e=this.getWorker();e&&(this._uninstallWorkerEventReceiver(e),this._decWorkerSharedCount(e))},finalizeWorker:function(){var e=this.getWorker();e&&(this._isWorkerInSharingState(e)||e.terminate(),this.setPropStoreFieldValue("worker",null))}}),d.Calculator.AbstractStructureGenerator=Class.create(d.Calculator.Base,{CLASS_NAME:"Kekule.Calculator.AbstractStructureGenerator",initProperties:function(){this.defineProp("sourceMol",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("generatedMol",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("childObjMap",{dataType:"Kekule.MapEx",serializable:!1}),this.defineProp("options",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("options");return e||(e={},this.setPropStoreFieldValue("options",e)),e}})},getGeneratorCoordMode:function(){return d.CoordMode.COORD3D},done:function(){this._modifySourceAccordingToGeneratedMol(this.getSourceMol(),this.getGeneratedMol(),this.getChildObjMap()),this.tryApplySuper("done")},_modifySourceAccordingToGeneratedMol:function(e,t,r){var n=r;if(n){var i=this.getGeneratorCoordMode(),o=n.getKeys();e.beginUpdate();try{for(var a=0,s=o.length;a<s;++a)if(o[a]instanceof d.ChemStructureNode){var l=o[a],u=n.get(l).getCoordOfMode(i);l.setCoordOfMode(u,i)}}finally{e.endUpdate()}}}}),d.Calculator.ServiceManager={_serviceInfos:{},_getServiceClassInfos:function(t,r){var n=e._serviceInfos[t];return!n&&r&&(n=[],e._serviceInfos[t]=n),n},_findServiceClassInfoItemIndex:function(t,r,n){var i=e._getServiceClassInfos(t,!1);if(i)for(var o=i.length-1;o>=0;--o){var a=i[o];if(a&&!(r&&a.serviceClass!==r||n&&a.id!==n))return o}return-1},register:function(t,r,n,i){var o=e._getServiceClassInfos(t,!0),a=e._findServiceClassInfoItemIndex(t,r);a>=0&&o.splice(a,1),o.push({serviceClass:r,id:n,priorityLevel:i||0})},unregister:function(t,r){var n=e._findServiceClassInfoItemIndex(t,r);n>=0&&e._getServiceClassInfos(t,!1).splice(n,1)},_getRegisteredServiceInfo:function(t,r){var n=-1,i=null,o=e._getServiceClassInfos(t);if(o)for(var a=0,s=o.length;a<s;++a){var l=o[a];if(l){if(r&&l.id===r){i=l;break}(!i||l.priorityLevel>=n)&&(i=l,n=l.priorityLevel)}}return i},getServiceClass:function(t,r){var n=e._getRegisteredServiceInfo(t,r);return n&&n.serviceClass}};var e=d.Calculator.ServiceManager;d.Calculator.Services={GEN2D:"2D structure generator",GEN3D:"3D structure generator"},d.Calculator.generateStructure=function(t,r,n,i,o,a){var s=r||d.Calculator.Services.GEN3D,l=e.getServiceClass(s);if(l){var u,c=new l;c.setChildObjMap&&(u=new d.MapEx(!0),c.setChildObjMap(u));var h=function(e){o&&o(e)};try{c.setSourceMol(t),c.setOptions(n),n&&n.sync&&c.setAsync(!1),c.execute((function(){i&&i(c.getGeneratedMol(),u)}),h,(function(e){a&&a(e)}))}catch(e){h(e)}return c}var p=d.$L("ErrorMsg.CALC_SERVICE_UNAVAILABLE").format(s);return o&&o(p),null},d.Calculator.generate3D=function(e,t,r,n,i){return d.Calculator.generateStructure(e,d.Calculator.Services.GEN3D,t,r,n,i)},d.Calculator.generate2D=function(e,t,r,n,i){return d.Calculator.generateStructure(e,d.Calculator.Services.GEN2D,t,r,n,i)}}(),d.chemicalElementsData=[{symbol:"H",casId:"1333-74-0",group:1,period:1,name:"Hydrogen",atomicNumber:1,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:.37,radiiVdw:1.2,paulingE:2.2,naturalMass:1.00794075382579},{symbol:"He",casId:"7440-59-7",group:18,period:1,name:"Helium",atomicNumber:2,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:.32,radiiVdw:1.4,naturalMass:4.002601902393709},{symbol:"Li",casId:"7439-93-2",group:1,period:2,name:"Lithium",atomicNumber:3,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:.32,radiiVdw:2.2,paulingE:.98,naturalMass:6.9400376247955},{symbol:"Be",casId:"7440-41-7",group:2,period:2,name:"Beryllium",atomicNumber:4,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:.9,radiiVdw:1.9,paulingE:1.57,naturalMass:9.0121822},{symbol:"B",casId:"7440-42-8",group:13,period:2,name:"Boron",atomicNumber:5,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:.82,radiiVdw:1.8,paulingE:2.04,naturalMass:10.811028088400002},{symbol:"C",casId:"7440-44-0",group:14,period:2,name:"Carbon",atomicNumber:6,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:.77,radiiVdw:1.7,paulingE:2.55,naturalMass:12.010735896788},{symbol:"N",casId:"7727-37-9",group:15,period:2,name:"Nitrogen",atomicNumber:7,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:.77,radiiVdw:1.6,paulingE:3.04,naturalMass:14.006743088432001},{symbol:"O",casId:"7782-44-7",group:16,period:2,name:"Oxygen",atomicNumber:8,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:.73,radiiVdw:1.55,paulingE:3.44,naturalMass:15.999404927569397},{symbol:"F",casId:"7782-41-4",group:17,period:2,name:"Fluorine",atomicNumber:9,chemicalSerie:"Halogens",phase:"Gas",radiiCova:.73,radiiVdw:1.5,paulingE:3.98,naturalMass:18.99840322},{symbol:"Ne",casId:"7440-01-9",group:18,period:2,name:"Neon",atomicNumber:10,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:.69,radiiVdw:1.54,naturalMass:20.180046383574997},{symbol:"Na",casId:"7440-23-5",group:1,period:3,name:"Sodium",atomicNumber:11,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:1.54,radiiVdw:2.4,paulingE:.93,naturalMass:22.98976928},{symbol:"Mg",casId:"7439-95-4",group:2,period:3,name:"Magnesium",atomicNumber:12,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.3,radiiVdw:2.2,paulingE:1.31,naturalMass:24.305051612423004},{symbol:"Al",casId:"7429-90-5",group:13,period:3,name:"Aluminum",atomicNumber:13,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.18,radiiVdw:2.1,paulingE:1.61,naturalMass:26.98153863},{symbol:"Si",casId:"7440-21-3",group:14,period:3,name:"Silicon",atomicNumber:14,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.11,radiiVdw:2.1,paulingE:1.9,naturalMass:28.085384754933294},{symbol:"P",casId:"7723-14-0",group:15,period:3,name:"Phosphorus",atomicNumber:15,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.06,radiiVdw:1.95,paulingE:2.19,naturalMass:30.97376163},{symbol:"S",casId:"7704-34-9",group:16,period:3,name:"Sulfur",atomicNumber:16,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.02,radiiVdw:1.8,paulingE:2.58,naturalMass:32.066084993038},{symbol:"Cl",casId:"7782-50-5",group:17,period:3,name:"Chlorine",atomicNumber:17,chemicalSerie:"Halogens",phase:"Gas",radiiCova:.99,radiiVdw:1.8,paulingE:3.16,naturalMass:35.452538168202},{symbol:"Ar",casId:"7440-37-1",group:18,period:3,name:"Argon",atomicNumber:18,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:.97,radiiVdw:1.8,naturalMass:39.947676710841314},{symbol:"K",casId:"7440-09-7",group:1,period:4,name:"Potassium",atomicNumber:19,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:1.96,radiiVdw:2.8,paulingE:.82,naturalMass:39.09830112446276},{symbol:"Ca",casId:"7440-70-2",group:2,period:4,name:"Calcium",atomicNumber:20,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.74,radiiVdw:2.4,paulingE:1,naturalMass:40.078022651988505},{symbol:"Sc",casId:"7440-20-2",group:3,period:4,name:"Scandium",atomicNumber:21,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.3,paulingE:1.36,naturalMass:44.9559119},{symbol:"Ti",casId:"7440-32-6",group:4,period:4,name:"Titanium",atomicNumber:22,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.15,paulingE:1.54,naturalMass:47.866749245159994},{symbol:"V",casId:"7440-62-2",group:5,period:4,name:"Vanadium",atomicNumber:23,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.25,radiiVdw:2.05,paulingE:1.63,naturalMass:50.94146749750001},{symbol:"Cr",casId:"7440-47-3",group:6,period:4,name:"Chromium",atomicNumber:24,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.27,radiiVdw:2.05,paulingE:1.66,naturalMass:51.996133070619},{symbol:"Mn",casId:"7439-96-5",group:7,period:4,name:"Manganese",atomicNumber:25,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.39,radiiVdw:2.05,paulingE:1.55,naturalMass:54.9380451},{symbol:"Fe",casId:"7439-89-6",group:8,period:4,name:"Iron",atomicNumber:26,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.25,radiiVdw:2.05,paulingE:1.83,naturalMass:55.845145623527},{symbol:"Co",casId:"7440-48-4",group:9,period:4,name:"Cobalt",atomicNumber:27,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.26,radiiVdw:2,paulingE:1.88,naturalMass:58.933195},{symbol:"Ni",casId:"7440-02-0",group:10,period:4,name:"Nickel",atomicNumber:28,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.21,radiiVdw:2,paulingE:1.91,naturalMass:58.693351562447994},{symbol:"Cu",casId:"7440-50-8",group:11,period:4,name:"Copper",atomicNumber:29,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.38,radiiVdw:2,paulingE:1.9,naturalMass:63.5456400936},{symbol:"Zn",casId:"7440-66-6",group:12,period:4,name:"Zinc",atomicNumber:30,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.31,radiiVdw:2.1,paulingE:1.65,naturalMass:65.39556265691999},{symbol:"Ga",casId:"7440-55-3",group:13,period:4,name:"Gallium",atomicNumber:31,chemicalSerie:"Metals",phase:"Solid",radiiVdw:2.1,paulingE:1.81,naturalMass:69.723065622084},{symbol:"Ge",casId:"7440-56-4",group:14,period:4,name:"Germanium",atomicNumber:32,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.22,radiiVdw:2.1,paulingE:2.01,naturalMass:72.61275825015},{symbol:"As",casId:"7440-38-2",group:15,period:4,name:"Arsenic",atomicNumber:33,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.19,radiiVdw:2.05,paulingE:2.18,naturalMass:74.9215965},{symbol:"Se",casId:"7782-49-2",group:16,period:4,name:"Selenium",atomicNumber:34,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.16,radiiVdw:1.9,paulingE:2.55,naturalMass:78.9593882401},{symbol:"Br",casId:"7726-95-6",group:17,period:4,name:"Bromine",atomicNumber:35,chemicalSerie:"Halogens",phase:"Liquid",radiiCova:1.14,radiiVdw:1.9,paulingE:2.96,naturalMass:79.90352797085},{symbol:"Kr",casId:"7439-90-9",group:18,period:4,name:"Krypton",atomicNumber:36,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.1,radiiVdw:2.02,paulingE:3,naturalMass:83.79932499157},{symbol:"Rb",casId:"7440-17-7",group:1,period:5,name:"Rubidium",atomicNumber:37,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:2.11,radiiVdw:2.9,paulingE:.82,naturalMass:85.46766359685701},{symbol:"Sr",casId:"7440-24-6",group:2,period:5,name:"Strontium",atomicNumber:38,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.92,radiiVdw:2.55,paulingE:.95,naturalMass:87.61664410489999},{symbol:"Y",casId:"7440-65-5",group:3,period:5,name:"Yttrium",atomicNumber:39,chemicalSerie:"Transition metals",phase:"Solid",naturalMass:88.9058483},{symbol:"Zr",casId:"7440-67-7",group:4,period:5,name:"Zirconium",atomicNumber:40,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.3,naturalMass:91.22364760672002},{symbol:"Nb",casId:"7440-03-1",group:5,period:5,name:"Niobium",atomicNumber:41,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.37,radiiVdw:2.15,naturalMass:92.9063781},{symbol:"Mo",casId:"7439-98-7",group:6,period:5,name:"Molybdenum",atomicNumber:42,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.45,radiiVdw:2.1,naturalMass:95.93129211008},{symbol:"Tc",casId:"7440-26-8",group:7,period:5,name:"Technetium",atomicNumber:43,chemicalSerie:"Transition metals",phase:"Synthetic",radiiCova:1.56,radiiVdw:2.05},{symbol:"Ru",casId:"7440-18-8",group:8,period:5,name:"Ruthenium",atomicNumber:44,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.26,radiiVdw:2.05,naturalMass:101.06494544279},{symbol:"Rh",casId:"7440-16-6",group:9,period:5,name:"Rhodium",atomicNumber:45,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.35,radiiVdw:2,naturalMass:102.905504},{symbol:"Pd",casId:"7440-05-3",group:10,period:5,name:"Palladium",atomicNumber:46,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.31,radiiVdw:2.05,naturalMass:106.41532878129999},{symbol:"Ag",casId:"7440-22-4",group:11,period:5,name:"Silver",atomicNumber:47,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.53,radiiVdw:2.1,naturalMass:107.86815084455},{symbol:"Cd",casId:"7440-43-9",group:12,period:5,name:"Cadmium",atomicNumber:48,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.2,naturalMass:112.41155220052002},{symbol:"In",casId:"7440-74-6",group:13,period:5,name:"Indium",atomicNumber:49,chemicalSerie:"Metals",phase:"Solid",radiiVdw:2.25,naturalMass:114.818085722},{symbol:"Sn",casId:"7440-31-5",group:14,period:5,name:"Tin",atomicNumber:50,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.41,radiiVdw:2.25,naturalMass:118.71010831537001},{symbol:"Sb",casId:"7440-36-0",group:15,period:5,name:"Antimony",atomicNumber:51,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.38,radiiVdw:2.2,naturalMass:121.75978613257},{symbol:"Te",casId:"13494-80-9",group:16,period:5,name:"Tellurium",atomicNumber:52,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.35,radiiVdw:2.1,naturalMass:127.60312784714},{symbol:"I",casId:"7553-56-2",group:17,period:5,name:"Iodine",atomicNumber:53,chemicalSerie:"Halogens",phase:"Solid",radiiCova:1.33,radiiVdw:2.1,naturalMass:126.904473},{symbol:"Xe",casId:"7440-63-3",group:18,period:5,name:"Xenon",atomicNumber:54,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.3,radiiVdw:2.16,naturalMass:131.29248059059},{symbol:"Cs",casId:"7440-46-2",group:1,period:6,name:"Cesium",atomicNumber:55,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:2.25,radiiVdw:3,naturalMass:132.9054519},{symbol:"Ba",casId:"7440-39-3",group:2,period:6,name:"Barium",atomicNumber:56,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.98,radiiVdw:2.7,naturalMass:137.32689183471098},{symbol:"La",casId:"7439-91-0",group:3,period:6,name:"Lanthanum",atomicNumber:57,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:1.69,radiiVdw:2.5,naturalMass:138.90545398283},{symbol:"Ce",casId:"7440-45-1",period:6,name:"Cerium",atomicNumber:58,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.48,naturalMass:140.11572621392},{symbol:"Pr",casId:"7440-10-0",period:6,name:"Praseodymium",atomicNumber:59,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.47,naturalMass:140.9076528},{symbol:"Nd",casId:"7440-00-8",period:6,name:"Neodymium",atomicNumber:60,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.47,naturalMass:144.23613137220002},{symbol:"Pm",casId:"7440-12-2",period:6,name:"Promethium",atomicNumber:61,chemicalSerie:"Lanthanides",phase:"Synthetic",radiiVdw:2.43},{symbol:"Sm",casId:"7440-19-9",period:6,name:"Samarium",atomicNumber:62,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.43,naturalMass:150.36634852618},{symbol:"Eu",casId:"7440-53-1",period:6,name:"Europium",atomicNumber:63,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:2.4,naturalMass:151.96437047419},{symbol:"Gd",casId:"7440-54-2",period:6,name:"Gadolinium",atomicNumber:64,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.38,naturalMass:157.25212221544},{symbol:"Tb",casId:"7440-27-9",period:6,name:"Terbium",atomicNumber:65,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.37,naturalMass:158.9253468},{symbol:"Dy",casId:"7429-91-6",period:6,name:"Dysprosium",atomicNumber:66,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.35,naturalMass:162.49703350552},{symbol:"Ho",casId:"7440-60-0",period:6,name:"Holmium",atomicNumber:67,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.33,naturalMass:164.9303221},{symbol:"Er",casId:"7440-52-0",period:6,name:"Erbium",atomicNumber:68,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.32,naturalMass:167.25630413192},{symbol:"Tm",casId:"7440-30-4",period:6,name:"Thulium",atomicNumber:69,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.3,naturalMass:168.9342133},{symbol:"Yb",casId:"7440-64-4",period:6,name:"Ytterbium",atomicNumber:70,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.28,naturalMass:173.03769558789998},{symbol:"Lu",casId:"7439-94-3",period:6,name:"Lutetium",atomicNumber:71,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:1.6,radiiVdw:2.27,naturalMass:174.96672138555},{symbol:"Hf",casId:"7440-58-6",group:4,period:6,name:"Hafnium",atomicNumber:72,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.5,radiiVdw:2.25,naturalMass:178.48497214162},{symbol:"Ta",casId:"7440-25-7",group:5,period:6,name:"Tantalum",atomicNumber:73,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.38,radiiVdw:2.2,naturalMass:180.94787573628},{symbol:"W",casId:"7440-33-7",group:6,period:6,name:"Tungsten",atomicNumber:74,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.46,radiiVdw:2.1,naturalMass:183.84177810241},{symbol:"Re",casId:"7440-15-5",group:7,period:6,name:"Rhenium",atomicNumber:75,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.59,radiiVdw:2.05,naturalMass:186.2067066106},{symbol:"Os",casId:"7440-04-2",group:8,period:6,name:"Osmium",atomicNumber:76,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.28,radiiVdw:2,naturalMass:190.22486304558998},{symbol:"Ir",casId:"7439-88-5",group:9,period:6,name:"Iridium",atomicNumber:77,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.37,radiiVdw:2,naturalMass:192.2160564148},{symbol:"Pt",casId:"7440-06-4",group:10,period:6,name:"Platinum",atomicNumber:78,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.28,radiiVdw:2.05,naturalMass:195.07780788031297},{symbol:"Au",casId:"7440-57-5",group:11,period:6,name:"Gold",atomicNumber:79,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.1,naturalMass:196.9665687},{symbol:"Hg",casId:"7439-97-6",group:12,period:6,name:"Mercury",atomicNumber:80,chemicalSerie:"Transition metals",phase:"Liquid",radiiCova:1.49,radiiVdw:2.05,naturalMass:200.59916661780002},{symbol:"Tl",casId:"7440-28-0",group:13,period:6,name:"Thallium",atomicNumber:81,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.49,radiiVdw:2.2,naturalMass:204.38333242650796},{symbol:"Pb",casId:"7439-92-1",group:14,period:6,name:"Lead",atomicNumber:82,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.3,naturalMass:207.21690766300003},{symbol:"Bi",casId:"7440-69-9",group:15,period:6,name:"Bismuth",atomicNumber:83,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.47,radiiVdw:2.3,naturalMass:208.9803987},{symbol:"Po",casId:"7440-08-6",group:16,period:6,name:"Polonium",atomicNumber:84,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.46,radiiVdw:2},{symbol:"At",casId:"7440-08-6",group:17,period:6,name:"Astatine",atomicNumber:85,chemicalSerie:"Halogens",phase:"Solid",radiiVdw:2},{symbol:"Rn",casId:"10043-92-2",group:18,period:6,name:"Radon",atomicNumber:86,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.45,radiiVdw:2},{symbol:"Fr",casId:"7440-73-5",group:1,period:7,name:"Francium",atomicNumber:87,chemicalSerie:"Alkali Metals",phase:"Solid",radiiVdw:2},{symbol:"Ra",casId:"7440-14-4",group:2,period:7,name:"Radium",atomicNumber:88,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiVdw:2},{symbol:"Ac",casId:"7440-34-8",group:3,period:7,name:"Actinium",atomicNumber:89,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Th",casId:"7440-29-1",period:7,name:"Thorium",atomicNumber:90,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2.3,naturalMass:232.0380553},{symbol:"Pa",casId:"7440-13-3",period:7,name:"Protactinium",atomicNumber:91,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2,naturalMass:231.035884},{symbol:"U",casId:"7440-61-1",period:7,name:"Uranium",atomicNumber:92,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2.3,naturalMass:238.0289182792545},{symbol:"Np",casId:"7439-99-8",period:7,name:"Neptunium",atomicNumber:93,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Pu",casId:"7440-07-5",period:7,name:"Plutonium",atomicNumber:94,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Am",casId:"7440-35-9",period:7,name:"Americium",atomicNumber:95,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Cm",casId:"7440-51-9",period:7,name:"Curium",atomicNumber:96,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Bk",casId:"7440-40-6",period:7,name:"Berkelium",atomicNumber:97,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Cf",casId:"7440-71-3",period:7,name:"Californium",atomicNumber:98,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Es",casId:"7429-92-7",period:7,name:"Einsteinium",atomicNumber:99,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Fm",casId:"7440-72-4",period:7,name:"Fermium",atomicNumber:100,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Md",casId:"7440-11-1",period:7,name:"Mendelevium",atomicNumber:101,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"No",casId:"10028-14-5",period:7,name:"Nobelium",atomicNumber:102,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Lr",casId:"22537-19-5",period:7,name:"Lawrencium",atomicNumber:103,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Rf",casId:"53850-36-5",group:4,period:7,name:"Rutherfordium",atomicNumber:104,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Db",casId:"53850-35-4",group:5,period:7,name:"Dubnium",atomicNumber:105,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Sg",casId:"54038-81-2",group:6,period:7,name:"Seaborgium",atomicNumber:106,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Bh",casId:"54037-14-8",group:7,period:7,name:"Bohrium",atomicNumber:107,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Hs",casId:"54037-57-9",group:8,period:7,name:"Hassium",atomicNumber:108,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Mt",casId:"54038-01-6",group:9,period:7,name:"Meitnerium",atomicNumber:109,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Ds",casId:"54083-77-1",group:10,period:7,name:"Darmstadtium",atomicNumber:110,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Rg",casId:"54386-24-2",group:11,period:7,name:"Roentgenium",atomicNumber:111,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Uub",group:12,period:7,name:"Ununbium",atomicNumber:112,chemicalSerie:"Transition metals",phase:"Synthetic"}],d.isotopesData=[{elementSymbol:"H",atomicNumber:1,isotopes:[{id:"H1",massNumber:1,relativeAbundance:.999885,atomicNumber:1,exactMass:1.007825032,spin:"1/2+",magneticMoment:"+2.792846",halfLife:-1},{id:"H2",massNumber:2,relativeAbundance:115e-6,atomicNumber:1,exactMass:2.014101778,spin:"1+",magneticMoment:"+0.857438",halfLife:-1},{id:"H3",massNumber:3,exactMass:3.016049278,atomicNumber:1,spin:"1/2+",magneticMoment:"+2.978960",halfLife:388839e3,betaminusDecay:"0.01861",betaminusDecayLikeliness:"100.0"},{id:"H4",massNumber:4,exactMass:4.02781,atomicNumber:1},{id:"H5",massNumber:5,exactMass:5.03531,atomicNumber:1},{id:"H6",massNumber:6,exactMass:6.04494,atomicNumber:1},{id:"H7",massNumber:7,exactMass:7.05275,atomicNumber:1}]},{elementSymbol:"He",atomicNumber:2,isotopes:[{id:"He3",massNumber:3,relativeAbundance:137e-8,atomicNumber:2,exactMass:3.016029319,spin:"1/2+",magneticMoment:"-2.127624",halfLife:-1},{id:"He4",massNumber:4,relativeAbundance:.99999863,atomicNumber:2,exactMass:4.002603254,spin:"0+",halfLife:-1},{id:"He5",massNumber:5,exactMass:5.01222,atomicNumber:2},{id:"He6",massNumber:6,exactMass:6.0188891,atomicNumber:2,halfLife:.8067},{id:"He7",massNumber:7,exactMass:7.028021,atomicNumber:2},{id:"He8",massNumber:8,exactMass:8.033922,atomicNumber:2,halfLife:.119},{id:"He9",massNumber:9,exactMass:9.04395,atomicNumber:2},{id:"He10",massNumber:10,exactMass:10.0524,atomicNumber:2}]},null,null,{elementSymbol:"B",atomicNumber:5,isotopes:[{id:"B6",massNumber:6,exactMass:6.04681,atomicNumber:5},{id:"B7",massNumber:7,exactMass:7.02992,atomicNumber:5},{id:"B8",massNumber:8,exactMass:8.0246072,atomicNumber:5,halfLife:.77},{id:"B9",massNumber:9,exactMass:9.0133288,atomicNumber:5},{id:"B10",massNumber:10,relativeAbundance:.19899999999999998,atomicNumber:5,exactMass:10.012937,spin:"3+",magneticMoment:"+1.80065",halfLife:-1},{id:"B11",massNumber:11,relativeAbundance:.8009999999999999,atomicNumber:5,exactMass:11.0093054,spin:"3/2-",magneticMoment:"+2.688637",halfLife:-1},{id:"B12",massNumber:12,exactMass:12.0143521,atomicNumber:5,halfLife:.0202},{id:"B13",massNumber:13,exactMass:13.0177802,atomicNumber:5,halfLife:.01736},{id:"B14",massNumber:14,exactMass:14.025404,atomicNumber:5,halfLife:.0138},{id:"B15",massNumber:15,exactMass:15.031103,atomicNumber:5,halfLife:.0105},{id:"B16",massNumber:16,exactMass:16.03981,atomicNumber:5},{id:"B17",massNumber:17,exactMass:17.04699,atomicNumber:5,halfLife:.00508},{id:"B18",massNumber:18,exactMass:18.05617,atomicNumber:5},{id:"B19",massNumber:19,exactMass:19.06373,atomicNumber:5}]},{elementSymbol:"C",atomicNumber:6,isotopes:[{id:"C8",massNumber:8,exactMass:8.037675,atomicNumber:6},{id:"C9",massNumber:9,exactMass:9.0310367,atomicNumber:6,halfLife:.126},{id:"C10",massNumber:10,exactMass:10.0168532,atomicNumber:6,halfLife:19.255},{id:"C11",massNumber:11,exactMass:11.0114336,atomicNumber:6,spin:"3/2-",halfLife:1223.4,betaplusDecay:"0.96",betaplusDecayLikeliness:"100.0"},{id:"C12",massNumber:12,relativeAbundance:.9893000000000001,atomicNumber:6,exactMass:12,spin:"0+",halfLife:-1},{id:"C13",massNumber:13,relativeAbundance:.010700000000000001,atomicNumber:6,exactMass:13.00335484,spin:"1/2-",magneticMoment:"+0.702411",halfLife:-1},{id:"C14",massNumber:14,exactMass:14.00324199,atomicNumber:6,halfLife:180701e6,betaminusDecay:"0.15648",betaminusDecayLikeliness:"100.0"},{id:"C15",massNumber:15,exactMass:15.0105993,atomicNumber:6,halfLife:2.449},{id:"C16",massNumber:16,exactMass:16.014701,atomicNumber:6,halfLife:.747},{id:"C17",massNumber:17,exactMass:17.022586,atomicNumber:6,halfLife:.193},{id:"C18",massNumber:18,exactMass:18.02676,atomicNumber:6,halfLife:.095},{id:"C19",massNumber:19,exactMass:19.03481,atomicNumber:6,halfLife:.046},{id:"C20",massNumber:20,exactMass:20.04032,atomicNumber:6,halfLife:.014},{id:"C21",massNumber:21,exactMass:21.04934,atomicNumber:6},{id:"C22",massNumber:22,exactMass:22.0572,atomicNumber:6}]},{elementSymbol:"N",atomicNumber:7,isotopes:[{id:"N10",massNumber:10,exactMass:10.04165,atomicNumber:7},{id:"N11",massNumber:11,exactMass:11.02609,atomicNumber:7},{id:"N12",massNumber:12,exactMass:12.0186132,atomicNumber:7,halfLife:.011},{id:"N13",massNumber:13,exactMass:13.00573861,atomicNumber:7,halfLife:597.9},{id:"N14",massNumber:14,relativeAbundance:.9963200000000001,atomicNumber:7,exactMass:14.003074,spin:"1+",magneticMoment:"+0.403761",halfLife:-1},{id:"N15",massNumber:15,relativeAbundance:.00368,atomicNumber:7,exactMass:15.0001089,spin:"1/2-",magneticMoment:"-0.283189",halfLife:-1},{id:"N16",massNumber:16,exactMass:16.0061017,atomicNumber:7,halfLife:7.13},{id:"N17",massNumber:17,exactMass:17.00845,atomicNumber:7,halfLife:4.173},{id:"N18",massNumber:18,exactMass:18.014079,atomicNumber:7,halfLife:.624},{id:"N19",massNumber:19,exactMass:19.017029,atomicNumber:7,halfLife:.304},{id:"N20",massNumber:20,exactMass:20.02337,atomicNumber:7,halfLife:.1},{id:"N21",massNumber:21,exactMass:21.02711,atomicNumber:7,halfLife:.085},{id:"N22",massNumber:22,exactMass:22.03439,atomicNumber:7,halfLife:.024},{id:"N23",massNumber:23,exactMass:23.04122,atomicNumber:7},{id:"N24",massNumber:24,exactMass:24.05104,atomicNumber:7},{id:"N25",massNumber:25,exactMass:25.06066,atomicNumber:7}]},{elementSymbol:"O",atomicNumber:8,isotopes:[{id:"O12",massNumber:12,exactMass:12.034405,atomicNumber:8},{id:"O13",massNumber:13,exactMass:13.024812,atomicNumber:8,halfLife:.00858},{id:"O14",massNumber:14,exactMass:14.00859625,atomicNumber:8,halfLife:70.606},{id:"O15",massNumber:15,exactMass:15.0030656,atomicNumber:8,halfLife:122.24},{id:"O16",massNumber:16,relativeAbundance:.9975700000000001,atomicNumber:8,exactMass:15.99491462,spin:"0+",halfLife:-1},{id:"O17",massNumber:17,relativeAbundance:.00037999999999999997,atomicNumber:8,exactMass:16.9991317,spin:"5/2+",magneticMoment:"-1.89379",halfLife:-1},{id:"O18",massNumber:18,relativeAbundance:.0020499999999999997,atomicNumber:8,exactMass:17.999161,spin:"0+",halfLife:-1},{id:"O19",massNumber:19,exactMass:19.00358,atomicNumber:8,halfLife:26.91},{id:"O20",massNumber:20,exactMass:20.0040767,atomicNumber:8,halfLife:13.51},{id:"O21",massNumber:21,exactMass:21.008656,atomicNumber:8,halfLife:3.42},{id:"O22",massNumber:22,exactMass:22.00997,atomicNumber:8,halfLife:2.25},{id:"O23",massNumber:23,exactMass:23.01569,atomicNumber:8,halfLife:.082},{id:"O24",massNumber:24,exactMass:24.02047,atomicNumber:8,halfLife:.061},{id:"O25",massNumber:25,exactMass:25.02946,atomicNumber:8},{id:"O26",massNumber:26,exactMass:26.03834,atomicNumber:8},{id:"O27",massNumber:27,exactMass:27.04826,atomicNumber:8},{id:"O28",massNumber:28,exactMass:28.05781,atomicNumber:8}]},{elementSymbol:"F",atomicNumber:9,isotopes:[{id:"F14",massNumber:14,exactMass:14.03506,atomicNumber:9},{id:"F15",massNumber:15,exactMass:15.01801,atomicNumber:9,halfLife:-1},{id:"F16",massNumber:16,exactMass:16.011466,atomicNumber:9},{id:"F17",massNumber:17,exactMass:17.00209524,atomicNumber:9,halfLife:64.49},{id:"F18",massNumber:18,exactMass:18.000938,atomicNumber:9,spin:"1+",halfLife:6586.2,betaplusDecay:"0.64",betaplusDecayLikeliness:"97.0",ecDecay:"",ecDecayLikeliness:"3.0"},{id:"F19",massNumber:19,relativeAbundance:1,atomicNumber:9,exactMass:18.99840322,spin:"1/2+",magneticMoment:"+2.628866",halfLife:-1},{id:"F20",massNumber:20,exactMass:19.99998132,atomicNumber:9,halfLife:11},{id:"F21",massNumber:21,exactMass:20.999949,atomicNumber:9,halfLife:4.158},{id:"F22",massNumber:22,exactMass:22.002999,atomicNumber:9,halfLife:4.23},{id:"F23",massNumber:23,exactMass:23.00357,atomicNumber:9,halfLife:2.23},{id:"F24",massNumber:24,exactMass:24.00812,atomicNumber:9,halfLife:.34},{id:"F25",massNumber:25,exactMass:25.0121,atomicNumber:9,halfLife:.059},{id:"F26",massNumber:26,exactMass:26.01962,atomicNumber:9},{id:"F27",massNumber:27,exactMass:27.02676,atomicNumber:9},{id:"F28",massNumber:28,exactMass:28.03567,atomicNumber:9},{id:"F29",massNumber:29,exactMass:29.04326,atomicNumber:9},{id:"F30",massNumber:30,exactMass:30.0525,atomicNumber:9},{id:"F31",massNumber:31,exactMass:31.06043,atomicNumber:9}]},null,null,null,null,{elementSymbol:"Si",atomicNumber:14,isotopes:[{id:"Si22",massNumber:22,exactMass:22.03453,atomicNumber:14,halfLife:.006},{id:"Si23",massNumber:23,exactMass:23.02552,atomicNumber:14},{id:"Si24",massNumber:24,exactMass:24.011546,atomicNumber:14,halfLife:.102},{id:"Si25",massNumber:25,exactMass:25.004106,atomicNumber:14,halfLife:.22},{id:"Si26",massNumber:26,exactMass:25.99233,atomicNumber:14,halfLife:2.234},{id:"Si27",massNumber:27,exactMass:26.98670491,atomicNumber:14,halfLife:4.16},{id:"Si28",massNumber:28,relativeAbundance:.9222969999999999,atomicNumber:14,exactMass:27.97692653,spin:"0+",halfLife:-1},{id:"Si29",massNumber:29,relativeAbundance:.046832000000000006,atomicNumber:14,exactMass:28.9764947,spin:"1/2+",magneticMoment:"-0.55529",halfLife:-1},{id:"Si30",massNumber:30,relativeAbundance:.030872,atomicNumber:14,exactMass:29.97377017,spin:"0+",halfLife:-1},{id:"Si31",massNumber:31,exactMass:30.97536323,atomicNumber:14,halfLife:9438},{id:"Si32",massNumber:32,exactMass:31.97414808,atomicNumber:14,halfLife:47304e5},{id:"Si33",massNumber:33,exactMass:32.978,atomicNumber:14,halfLife:6.18},{id:"Si34",massNumber:34,exactMass:33.978576,atomicNumber:14,halfLife:2.77},{id:"Si35",massNumber:35,exactMass:34.98458,atomicNumber:14,halfLife:.78},{id:"Si36",massNumber:36,exactMass:35.9866,atomicNumber:14,halfLife:.45},{id:"Si37",massNumber:37,exactMass:36.99294,atomicNumber:14},{id:"Si38",massNumber:38,exactMass:37.99563,atomicNumber:14},{id:"Si39",massNumber:39,exactMass:39.00207,atomicNumber:14},{id:"Si40",massNumber:40,exactMass:40.00587,atomicNumber:14},{id:"Si41",massNumber:41,exactMass:41.01456,atomicNumber:14},{id:"Si42",massNumber:42,exactMass:42.01979,atomicNumber:14},{id:"Si43",massNumber:43,exactMass:43.02866,atomicNumber:14},{id:"Si44",massNumber:44,exactMass:44.03526,atomicNumber:14}]},{elementSymbol:"P",atomicNumber:15,isotopes:[{id:"P24",massNumber:24,exactMass:24.03435,atomicNumber:15},{id:"P25",massNumber:25,exactMass:25.02026,atomicNumber:15},{id:"P26",massNumber:26,exactMass:26.01178,atomicNumber:15,halfLife:.02},{id:"P27",massNumber:27,exactMass:26.99923,atomicNumber:15,halfLife:.26},{id:"P28",massNumber:28,exactMass:27.992315,atomicNumber:15,halfLife:.2703},{id:"P29",massNumber:29,exactMass:28.9818006,atomicNumber:15,halfLife:4.14},{id:"P30",massNumber:30,exactMass:29.9783138,atomicNumber:15,halfLife:149.88},{id:"P31",massNumber:31,relativeAbundance:1,atomicNumber:15,exactMass:30.97376163,spin:"1/2+",magneticMoment:"+1.13160",halfLife:-1},{id:"P32",massNumber:32,exactMass:31.97390727,atomicNumber:15,spin:"1+",magneticMoment:"-0.2524",halfLife:1232240,betaminusDecay:"1.710",betaminusDecayLikeliness:"100.0"},{id:"P33",massNumber:33,exactMass:32.9717255,atomicNumber:15,halfLife:2189380},{id:"P34",massNumber:34,exactMass:33.973636,atomicNumber:15,halfLife:12.43},{id:"P35",massNumber:35,exactMass:34.9733141,atomicNumber:15,halfLife:47.3},{id:"P36",massNumber:36,exactMass:35.97826,atomicNumber:15,halfLife:5.6},{id:"P37",massNumber:37,exactMass:36.97961,atomicNumber:15,halfLife:2.31},{id:"P38",massNumber:38,exactMass:37.98416,atomicNumber:15,halfLife:.64},{id:"P39",massNumber:39,exactMass:38.98618,atomicNumber:15,halfLife:.16},{id:"P40",massNumber:40,exactMass:39.9913,atomicNumber:15,halfLife:.26},{id:"P41",massNumber:41,exactMass:40.99434,atomicNumber:15,halfLife:.12},{id:"P42",massNumber:42,exactMass:42.00101,atomicNumber:15,halfLife:.11},{id:"P43",massNumber:43,exactMass:43.00619,atomicNumber:15,halfLife:.033},{id:"P44",massNumber:44,exactMass:44.01299,atomicNumber:15},{id:"P45",massNumber:45,exactMass:45.01922,atomicNumber:15},{id:"P46",massNumber:46,exactMass:46.02738,atomicNumber:15}]},{elementSymbol:"S",atomicNumber:16,isotopes:[{id:"S26",massNumber:26,exactMass:26.02788,atomicNumber:16},{id:"S27",massNumber:27,exactMass:27.01883,atomicNumber:16,halfLife:.021},{id:"S28",massNumber:28,exactMass:28.00437,atomicNumber:16,halfLife:.125},{id:"S29",massNumber:29,exactMass:28.99661,atomicNumber:16,halfLife:.187},{id:"S30",massNumber:30,exactMass:29.984903,atomicNumber:16,halfLife:1.178},{id:"S31",massNumber:31,exactMass:30.9795547,atomicNumber:16,halfLife:2.572},{id:"S32",massNumber:32,relativeAbundance:.9493,atomicNumber:16,exactMass:31.972071,spin:"0+",halfLife:-1},{id:"S33",massNumber:33,relativeAbundance:.0076,atomicNumber:16,exactMass:32.97145876,spin:"3/2+",magneticMoment:"+0.643821",halfLife:-1},{id:"S34",massNumber:34,relativeAbundance:.0429,atomicNumber:16,exactMass:33.9678669,spin:"0+",halfLife:-1},{id:"S35",massNumber:35,exactMass:34.96903216,atomicNumber:16,spin:"3/2+",magneticMoment:"+1",halfLife:7544450,betaminusDecay:"0.1674",betaminusDecayLikeliness:"100.0"},{id:"S36",massNumber:36,relativeAbundance:2e-4,atomicNumber:16,exactMass:35.96708076,spin:"0+",halfLife:-1},{id:"S37",massNumber:37,exactMass:36.97112557,atomicNumber:16,halfLife:303},{id:"S38",massNumber:38,exactMass:37.971163,atomicNumber:16,halfLife:10218},{id:"S39",massNumber:39,exactMass:38.97513,atomicNumber:16,halfLife:11.5},{id:"S40",massNumber:40,exactMass:39.97545,atomicNumber:16,halfLife:8.8},{id:"S41",massNumber:41,exactMass:40.97958,atomicNumber:16},{id:"S42",massNumber:42,exactMass:41.98102,atomicNumber:16,halfLife:.56},{id:"S43",massNumber:43,exactMass:42.98715,atomicNumber:16,halfLife:.22},{id:"S44",massNumber:44,exactMass:43.99021,atomicNumber:16,halfLife:.123},{id:"S45",massNumber:45,exactMass:44.99651,atomicNumber:16,halfLife:.082},{id:"S46",massNumber:46,exactMass:46.00075,atomicNumber:16},{id:"S47",massNumber:47,exactMass:47.00859,atomicNumber:16},{id:"S48",massNumber:48,exactMass:48.01417,atomicNumber:16},{id:"S49",massNumber:49,exactMass:49.02362,atomicNumber:16}]},{elementSymbol:"Cl",atomicNumber:17,isotopes:[{id:"Cl28",massNumber:28,exactMass:28.02851,atomicNumber:17},{id:"Cl29",massNumber:29,exactMass:29.01411,atomicNumber:17},{id:"Cl30",massNumber:30,exactMass:30.00477,atomicNumber:17},{id:"Cl31",massNumber:31,exactMass:30.99241,atomicNumber:17,halfLife:.15},{id:"Cl32",massNumber:32,exactMass:31.98569,atomicNumber:17,halfLife:.298},{id:"Cl33",massNumber:33,exactMass:32.9774519,atomicNumber:17,halfLife:2.511},{id:"Cl34",massNumber:34,exactMass:33.97376282,atomicNumber:17,halfLife:1.5264},{id:"Cl35",massNumber:35,relativeAbundance:.7578,atomicNumber:17,exactMass:34.96885268,spin:"3/2+",magneticMoment:"+0.82187",halfLife:-1},{id:"Cl36",massNumber:36,exactMass:35.96830698,atomicNumber:17},{id:"Cl37",massNumber:37,relativeAbundance:.2422,atomicNumber:17,exactMass:36.96590259,spin:"3/2+",magneticMoment:"+0.68412",halfLife:-1},{id:"Cl38",massNumber:38,exactMass:37.96801043,atomicNumber:17,halfLife:2234.4},{id:"Cl39",massNumber:39,exactMass:38.9680082,atomicNumber:17,halfLife:3336},{id:"Cl40",massNumber:40,exactMass:39.97042,atomicNumber:17,halfLife:81},{id:"Cl41",massNumber:41,exactMass:40.97068,atomicNumber:17,halfLife:38.4},{id:"Cl42",massNumber:42,exactMass:41.97325,atomicNumber:17,halfLife:6.8},{id:"Cl43",massNumber:43,exactMass:42.97405,atomicNumber:17,halfLife:3.3},{id:"Cl44",massNumber:44,exactMass:43.97828,atomicNumber:17,halfLife:.434},{id:"Cl45",massNumber:45,exactMass:44.98029,atomicNumber:17,halfLife:.4},{id:"Cl46",massNumber:46,exactMass:45.98421,atomicNumber:17,halfLife:.223},{id:"Cl47",massNumber:47,exactMass:46.98871,atomicNumber:17},{id:"Cl48",massNumber:48,exactMass:47.99495,atomicNumber:17},{id:"Cl49",massNumber:49,exactMass:49.00032,atomicNumber:17},{id:"Cl50",massNumber:50,exactMass:50.00784,atomicNumber:17},{id:"Cl51",massNumber:51,exactMass:51.01449,atomicNumber:17}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"Br",atomicNumber:35,isotopes:[{id:"Br67",massNumber:67,exactMass:66.96479,atomicNumber:35},{id:"Br68",massNumber:68,exactMass:67.95852,atomicNumber:35},{id:"Br69",massNumber:69,exactMass:68.95011,atomicNumber:35},{id:"Br70",massNumber:70,exactMass:69.94479,atomicNumber:35,halfLife:.0791},{id:"Br71",massNumber:71,exactMass:70.93874,atomicNumber:35,halfLife:21.4},{id:"Br72",massNumber:72,exactMass:71.93664,atomicNumber:35,halfLife:78.6},{id:"Br73",massNumber:73,exactMass:72.93169,atomicNumber:35,halfLife:204},{id:"Br74",massNumber:74,exactMass:73.929891,atomicNumber:35,halfLife:1524},{id:"Br75",massNumber:75,exactMass:74.925776,atomicNumber:35,halfLife:5802},{id:"Br76",massNumber:76,exactMass:75.924541,atomicNumber:35,halfLife:58320},{id:"Br77",massNumber:77,exactMass:76.921379,atomicNumber:35,halfLife:205330},{id:"Br78",massNumber:78,exactMass:77.921146,atomicNumber:35,halfLife:387.6},{id:"Br79",massNumber:79,relativeAbundance:.5069,atomicNumber:35,exactMass:78.9183371,spin:"3/2-",magneticMoment:"+2.1064",halfLife:-1},{id:"Br80",massNumber:80,exactMass:79.9185293,atomicNumber:35,halfLife:1060.8},{id:"Br81",massNumber:81,relativeAbundance:.49310000000000004,atomicNumber:35,exactMass:80.9162906,spin:"3/2-",magneticMoment:"+2.2706",halfLife:-1},{id:"Br82",massNumber:82,exactMass:81.9168041,atomicNumber:35,halfLife:127080},{id:"Br83",massNumber:83,exactMass:82.91518,atomicNumber:35,halfLife:8640},{id:"Br84",massNumber:84,exactMass:83.916479,atomicNumber:35,halfLife:1908},{id:"Br85",massNumber:85,exactMass:84.915608,atomicNumber:35,halfLife:174},{id:"Br86",massNumber:86,exactMass:85.918798,atomicNumber:35,halfLife:55.1},{id:"Br87",massNumber:87,exactMass:86.920711,atomicNumber:35,halfLife:55.6},{id:"Br88",massNumber:88,exactMass:87.92407,atomicNumber:35,halfLife:16.34},{id:"Br89",massNumber:89,exactMass:88.92639,atomicNumber:35,halfLife:4.348},{id:"Br90",massNumber:90,exactMass:89.93063,atomicNumber:35,halfLife:1.91},{id:"Br91",massNumber:91,exactMass:90.93397,atomicNumber:35,halfLife:.541},{id:"Br92",massNumber:92,exactMass:91.93926,atomicNumber:35,halfLife:.343},{id:"Br93",massNumber:93,exactMass:92.94305,atomicNumber:35,halfLife:.102},{id:"Br94",massNumber:94,exactMass:93.94868,atomicNumber:35,halfLife:.07},{id:"Br95",massNumber:95,exactMass:94.95287,atomicNumber:35},{id:"Br96",massNumber:96,exactMass:95.95853,atomicNumber:35},{id:"Br97",massNumber:97,exactMass:96.9628,atomicNumber:35}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"I",atomicNumber:53,isotopes:[{id:"I108",massNumber:108,exactMass:107.94348,atomicNumber:53,halfLife:.036},{id:"I109",massNumber:109,exactMass:108.93815,atomicNumber:53,halfLife:1e-4},{id:"I110",massNumber:110,exactMass:109.93524,atomicNumber:53,halfLife:.65},{id:"I111",massNumber:111,exactMass:110.93028,atomicNumber:53,halfLife:2.5},{id:"I112",massNumber:112,exactMass:111.92797,atomicNumber:53,halfLife:3.42},{id:"I113",massNumber:113,exactMass:112.92364,atomicNumber:53,halfLife:6.6},{id:"I114",massNumber:114,exactMass:113.92185,atomicNumber:53,halfLife:2.1},{id:"I115",massNumber:115,exactMass:114.91805,atomicNumber:53,halfLife:78},{id:"I116",massNumber:116,exactMass:115.91681,atomicNumber:53,halfLife:2.91},{id:"I117",massNumber:117,exactMass:116.91365,atomicNumber:53,halfLife:133.2},{id:"I118",massNumber:118,exactMass:117.913074,atomicNumber:53,halfLife:822},{id:"I119",massNumber:119,exactMass:118.91007,atomicNumber:53,halfLife:1146},{id:"I120",massNumber:120,exactMass:119.910048,atomicNumber:53,halfLife:4860},{id:"I121",massNumber:121,exactMass:120.907367,atomicNumber:53,halfLife:7632},{id:"I122",massNumber:122,exactMass:121.907589,atomicNumber:53,halfLife:217.8},{id:"I123",massNumber:123,exactMass:122.905589,atomicNumber:53,halfLife:47772},{id:"I124",massNumber:124,exactMass:123.9062099,atomicNumber:53,halfLife:360806},{id:"I125",massNumber:125,exactMass:124.9046302,atomicNumber:53,spin:"5/2+",halfLife:5132850},{id:"I126",massNumber:126,exactMass:125.905624,atomicNumber:53,spin:"2-",halfLife:1132700},{id:"I127",massNumber:127,relativeAbundance:1,atomicNumber:53,exactMass:126.904473,spin:"5/2+",magneticMoment:"+2.808",halfLife:-1},{id:"I128",massNumber:128,exactMass:127.905809,atomicNumber:53,spin:"1+",halfLife:1499.4},{id:"I129",massNumber:129,exactMass:128.904988,atomicNumber:53,magneticMoment:"+2.617",halfLife:157e5,betaminusDecay:"0.193",betaminusDecayLikeliness:"100.0"},{id:"I130",massNumber:130,exactMass:129.906674,atomicNumber:53,halfLife:44496},{id:"I131",massNumber:131,exactMass:130.9061246,atomicNumber:53,halfLife:692988},{id:"I132",massNumber:132,exactMass:131.907997,atomicNumber:53,halfLife:8262},{id:"I133",massNumber:133,exactMass:132.907797,atomicNumber:53,halfLife:74880},{id:"I134",massNumber:134,exactMass:133.909744,atomicNumber:53,halfLife:3150},{id:"I135",massNumber:135,exactMass:134.910048,atomicNumber:53,halfLife:23652},{id:"I136",massNumber:136,exactMass:135.91465,atomicNumber:53,halfLife:83.4},{id:"I137",massNumber:137,exactMass:136.917871,atomicNumber:53,halfLife:24.5},{id:"I138",massNumber:138,exactMass:137.92235,atomicNumber:53,halfLife:6.49},{id:"I139",massNumber:139,exactMass:138.9261,atomicNumber:53,halfLife:2.29},{id:"I140",massNumber:140,exactMass:139.931,atomicNumber:53,halfLife:.86},{id:"I141",massNumber:141,exactMass:140.93503,atomicNumber:53,halfLife:.43},{id:"I142",massNumber:142,exactMass:141.94018,atomicNumber:53},{id:"I143",massNumber:143,exactMass:142.94456,atomicNumber:53},{id:"I144",massNumber:144,exactMass:143.94999,atomicNumber:53}]}],d.structGenAtomTypesData=[{elementSymbol:"H",atomicNumber:1,atomTypes:[{id:"H1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"Li",atomicNumber:3,atomTypes:[{id:"Li1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"B",atomicNumber:5,atomTypes:[{id:"B3",maxBondOrder:2,bondOrderSum:3}]},{elementSymbol:"C",atomicNumber:6,atomTypes:[{id:"C4",maxBondOrder:3,bondOrderSum:4}]},{elementSymbol:"N",atomicNumber:7,atomTypes:[{id:"N3",maxBondOrder:3,bondOrderSum:3},{id:"N5",maxBondOrder:2,bondOrderSum:5}]},{elementSymbol:"O",atomicNumber:8,atomTypes:[{id:"O2",maxBondOrder:2,bondOrderSum:2}]},{elementSymbol:"F",atomicNumber:9,atomTypes:[{id:"F1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"Na",atomicNumber:11,atomTypes:[{id:"Na1",maxBondOrder:1,bondOrderSum:1}]},null,null,{elementSymbol:"Si",atomicNumber:14,atomTypes:[{id:"Si4",maxBondOrder:3,bondOrderSum:4}]},{elementSymbol:"P",atomicNumber:15,atomTypes:[{id:"P3",maxBondOrder:3,bondOrderSum:3},{id:"P4",maxBondOrder:3,bondOrderSum:5}]},{elementSymbol:"S",atomicNumber:16,atomTypes:[{id:"S2",maxBondOrder:2,bondOrderSum:2},{id:"S3",maxBondOrder:2,bondOrderSum:4},{id:"S4",maxBondOrder:2,bondOrderSum:6}]},{elementSymbol:"Cl",atomicNumber:17,atomTypes:[{id:"Cl1",maxBondOrder:1,bondOrderSum:1}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"As",atomicNumber:33,atomTypes:[{id:"As3",maxBondOrder:1,bondOrderSum:3}]},{elementSymbol:"Se",atomicNumber:34,atomTypes:[{id:"Se2",maxBondOrder:2,bondOrderSum:2}]},{elementSymbol:"Br",atomicNumber:35,atomTypes:[{id:"Br1",maxBondOrder:1,bondOrderSum:1}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"I",atomicNumber:53,atomTypes:[{id:"I1",maxBondOrder:1,bondOrderSum:1}]}],d.ChemicalElementsDataUtil={_getElementInfoBySymbol:function(e){for(var t,r=0,n=d.chemicalElementsData.length;r<n;++r)if((t=d.chemicalElementsData[r])&&t.symbol==e)return t;return null},_getElementInfoByAtomicNumber:function(e){var t=d.chemicalElementsData[e-1];if(t&&t.atomicNumber==e)return t;if(!t||t.atomicNumber<e){for(var r=e,n=d.chemicalElementsData.length;r<n;++r)if((t=d.chemicalElementsData[r])&&t.atomicNumber==e)return t;for(r=e-2;r>=0;--r)if((t=d.chemicalElementsData[r])&&t.atomicNumber==e)return t}else{for(r=e-2;r>=0;--r)if((t=d.chemicalElementsData[r])&&t.atomicNumber==e)return t;for(r=e,n=d.chemicalElementsData.length;r<n;++r)if((t=d.chemicalElementsData[r])&&t.atomicNumber==e)return t}return null},getElementInfo:function(e){return"number"==typeof e?d.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(e):d.ChemicalElementsDataUtil._getElementInfoBySymbol(e)},getElementProp:function(e,t){var r=d.ChemicalElementsDataUtil.getElementInfo(e);return r?r[t]:null},getAtomicNumber:function(e){var t=d.ChemicalElementsDataUtil._getElementInfoBySymbol(e);return t?t.atomicNumber:0},getElementSymbol:function(e){var t=d.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(e);return t?t.symbol:null},isAtomicNumberAvailable:function(e){return!!d.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(e)},isElementSymbolAvailable:function(e){return d.ChemicalElementsDataUtil.getAtomicNumber(e)>0},getAllElementSymbols:function(){for(var e=[],t=d.chemicalElementsData,r=0,n=t.length;r<n;++r)e.push(t[r].symbol);return e}},d.IsotopeAliasUtil={enableAlias:!0,ALIAS:[{alias:"D",atomicNumber:1,massNumber:2}],getAllAlias:function(){return d.IsotopeAliasUtil.enableAlias?d.IsotopeAliasUtil.ALIAS:[]},getAliasInfo:function(e){for(var t=d.IsotopeAliasUtil.getAllAlias(),r=0,n=t.length;r<n;++r){var i=t[r];if(i.alias===e)return Object.extend(d.IsotopesDataUtil.getIsotopeInfo(i.atomicNumber,i.massNumber),{isotopeAlias:e})}return null},getAlias:function(e,t){for(var r=d.IsotopeAliasUtil.getAllAlias(),n=0,i=r.length;n<i;++n){var o=r[n];if(o.atomicNumber===e&&o.massNumber===t)return o.alias}return null}},d.IsotopesDataUtil={_getElementItem:function(e){var t;if(t="number"==typeof e?e:d.ChemicalElementsDataUtil.getAtomicNumber(e),!(i=d.isotopesData[t-1])||i.atomicNumber!=t)for(var r=0,n=d.isotopesData.length;r<n;++r){var i;if((i=d.isotopesData[r])&&i.atomicNumber==t)break}return i},getAllIsotopeInfos:function(e){var t=d.IsotopesDataUtil._getElementItem(e);return t?t.isotopes:null},getIsotopeInfo:function(e,t){var r=null;if(!t&&"string"==typeof e&&(r=d.IsotopeAliasUtil.getAliasInfo(e)))return r;var n=d.IsotopesDataUtil._getElementItem(e),i=n.isotopes;if(i){if(t)for(var o=0,a=i.length;o<a&&(!(r=i[o])||r.massNumber!=t);++o);else 1===i.length&&(r=i[0]);if(r)return r.elementSymbol=n.elementSymbol,r}return null},getIsotopeInfoById:function(e){var t=d.IsotopesDataUtil.getIsotopeIdDetail(e);return d.IsotopesDataUtil.getIsotopeInfo(t.symbol,t.massNumber)},isMassNumberAvailable:function(e,t){return!!d.IsotopesDataUtil.getIsotopeInfo(e,t)},getIsotopeId:function(e,t){if("string"!=typeof e||t){var r=d.IsotopeAliasUtil.getAlias(e,t);if(r)return r}else if(d.IsotopeAliasUtil.getAliasInfo(e))return e;var n=d.ChemicalElementsDataUtil.getElementInfo(e);if(!n)return null;var i=n.symbol;return t?i+t.toString():i},getIsotopeIdDetail:function(e){if(!e)return null;for(var t="",r="",n=0,i=e.length;n<i;++n){var o=e.charAt(n);o>="0"&&o<="9"?r+=o:t+=o}var a=r?parseInt(r,10):null,s={symbol:t};return a&&(s.massNumber=a),s},isIsotopeIdAvailable:function(e){var t=d.IsotopesDataUtil.getIsotopeIdDetail(e);if(d.IsotopeAliasUtil.getAliasInfo(e))return!0;var r=d.ChemicalElementsDataUtil.isElementSymbolAvailable(t.symbol);return r&&t.massNum&&(r=!!d.IsotopesDataUtil.getIsotopeInfo(t.symbol,t.massNum)),r}},d.AtomTypeDataUtil={getAtomTypeInfoObj:function(e){var t;t="number"==typeof e?e:d.ChemicalElementsDataUtil.getAtomicNumber(e);var r=d.structGenAtomTypesData[t-1];if(r&&r.atomicNumber==t)return r;for(var n=0,i=d.structGenAtomTypesData.length;n<i;++n)if((r=d.structGenAtomTypesData[n])&&r.atomicNumber==t)return r;return null},getAllAtomTypes:function(e){var t=d.AtomTypeDataUtil.getAtomTypeInfoObj(e);return t?t.atomTypes:null},getAtomTypeFromId:function(e,t){if(!e){for(var r="",n=0,i=t.length;n<i;++n){var o=t.chatAt(n);(o<"0"||o>"9")&&(r+=o)}e=r}if(e){var a=d.AtomTypeDataUtil.getAllAtomTypes(e);for(n=0,i=a.length;n<i;++n)if(a[n].id==t)return a[n]}return null}},function(e){e||(e=d.$jsRoot),d.EmscriptenUtils={DEF_MODULE_NAME:"Module",_createdModules:{},_getActualModule:function(r){return e[r||t.DEF_MODULE_NAME]},isSupported:function(e){return void 0!==t._getActualModule(e)},getRootModule:function(e,r){var n=t._createdModules[e];if(n)return n;var i=t._getActualModule(e);return n=i,"function"==typeof i&&(n=i(r)),n&&(t._createdModules[e]=n),n},setRootModule:function(e,r){t._createdModules[e]=r},getModuleObj:function(e){return"object"==typeof e?e:t.getRootModule(e)},getMember:function(e,r){return(t.getModuleObj(r)||{})[e]},getClassCtor:function(e,r){return(t.getModuleObj(r)||{})[e]},cwrap:function(e,r,n,i){var o=t.getModuleObj(i);return o&&o.cwrap&&o.cwrap(e,r,n)},initModule:function(e,r,n){e||(e=d.$jsRoot.document);var i=r.moduleName,o=r.moduleInitEventName,a=r.moduleInitCallbackName,s=r.creationOptions,l=function(e){n&&n(e)};if(t.isModuleReady(i))l();else try{if(o&&e&&d.X){d.X.Event.addListener(e,o,(function t(){l(),d.X.Event.removeListener(e,o,t)}))}else a&&(d.$jsRoot[a]=function(){l()});i&&t.getRootModule(i,s)}catch(e){throw l(e),e}},isModuleReady:function(e){return!!t._createdModules[e]},ensureModuleReady:function(e,r,n){return t.initModule(e,r,n)},loadScript:function(e,r,n,i){n||(n=d.$jsRoot.document);var o=function(e){e?r(e):t.initModule(n,i,r)};if(d.environment.isNode)try{var a=d.environment.nodeRequire(e);i.moduleName&&(d.$jsRoot[i.moduleName]=a),o()}catch(e){throw o(e),e}else d.ScriptFileUtils.appendScriptFile(n,e,o)}};var t=d.EmscriptenUtils}(this),d.LOCAL_RES=!0,d.Localization.setCurrModule("extra.openbabel"),d.Localization.addResource("en","ErrorMsg",{OpenBabel:{CHEM_NODE_TYPE_NOT_SUITABLE:"Unsuitable node type",CHEM_CONNECTOR_TYPE_NOT_SUITABLE:"Unsuitable connector type",ONLY_STR_INPUT_DATA_ALLOWED:"Input data must be text",ONLY_STR_OUTPUT_DATA_ALLOWED:"Output data must be text",FAIL_TO_GENERATE_3D_STRUCTURE:"Fail to generate 3D structure coordinates"}}),function(){var e=d.EmscriptenUtils,t={usingModulaize:!0,moduleName:"OpenBabelModule",moduleInitEventName:"OpenBabel.Initialized",moduleInitCallbackName:"__$openBabelInitialized$__"};d.OpenBabel={_autoEnabled:!0,_module:null,SCRIPT_FILE:"openbabel.js",_enableFuncs:[],BondOrder:{SINGLE:1,DOUBLE:2,TRIPLE:3,EXPLICIT_AROMATIC:5},getObInitOptions:function(){return t},getModule:function(){return r._module||(r._module=e.getRootModule(t.moduleName,t)),r._module},setModule:function(n){r._module=n,e.setRootModule(t.moduleName,n)},getMember:function(t){return e.getMember(t,r.getModule())},getClassCtor:function(t){return e.getClassCtor(t,r.getModule())},isScriptLoaded:function(){return e.isSupported(t.moduleName)},isModuleReady:function(){return e.isModuleReady(t.moduleName)},enable:function(e){r.isScriptLoaded()?(r._enableAllFunctions(),e&&e()):r.loadObScript(d.$jsRoot.document,(function(t){t||r._enableAllFunctions(),e&&e(t)}))},_enableAllFunctions:function(){if(r.isModuleReady())for(var e=r._enableFuncs,t=0,n=e.length;t<n;++t){var i=e[t];i&&i()}}};var r=d.OpenBabel;d._registerAfterLoadSysProc((function(){r._autoEnabled&&r.isScriptLoaded()&&e.ensureModuleReady(d.$jsRoot.document,t,r._enableAllFunctions)})),d.OpenBabel.getObPath=function(){var e=d.environment.getEnvVar("openbabel.path");return e||(e=d.isUsingMinJs()?"extra/":"_extras/OpenBabel/",e=d.getScriptPath()+e),e},d.OpenBabel.getObScriptUrl=function(){var e=d.environment.getEnvVar("openbabel.scriptSrc");return e||(e=d.OpenBabel.getObPath()+d.OpenBabel.SCRIPT_FILE,d.isUsingMinJs()||(e+=".dev")),e},d.OpenBabel.loadObScript=function(n,i){n||(n=d.$jsRoot.document);var o=function(e){r._obScriptLoadedBySelf=!e,i&&i(e)};if(r._obScriptLoadedBySelf||r.isScriptLoaded())o();else{var a=d.OpenBabel.getObScriptUrl();e.loadScript(a,o,n,t)}},d.OpenBabel.AdaptUtils={DEF_ATOM_ID_PREFIX:"A",DEF_BOND_ID_PREFIX:"B",DEF_MOL_ID_PREFIX:"M",wrapCFuncs:function(){d.OpenBabel._funcInited||(Object.extend(d.OpenBabel,{}),d.OpenBabel._funcInited=!0)},isAvailable:function(){return void 0!==r.getClassCtor("ObBaseHelper")},obObjToKekule:function(e,t,r){var n=d.OpenBabel.AdaptUtils,i=d.ObjUtils.getPrototypeOf(e).constructor.name;return("OBReaction"===i?n.obReactionToKekule:"OBMol"===i?n.obMolToKekule:n.obBaseToKekule)(e,t,r)},kObjToOB:function(e,t,r){var n=d.OpenBabel.AdaptUtils,i=e instanceof d.Reaction?n.kReactionToOB:e instanceof d.StructureFragment?n.kMolToOB:null;return i?i(e,t,r):null},kIdToOB:function(e){return parseInt(e,10)||null},obBondOrderToKekule:function(e){return e<=3?e:e===d.OpenBabel.BondOrder.EXPLICIT_AROMATIC?d.BondOrder.EXPLICIT_AROMATIC:d.BondOrder.OTHER},kBondOrderToOB:function(e){return e<=3?e:e===d.BondOrder.EXPLICIT_AROMATIC?d.OpenBabel.BondOrder.EXPLICIT_AROMATIC:0},obBaseToKekule:function(e,t){var n=t||new d.ChemObject,i=new(r.getClassCtor("ObBaseHelper"))(e),o=i.getTitle();o&&n.setName&&n.setName(o);var a=i.getDataSize();if(a)for(var s=n.getInfo(!0),l=0;l<a;++l){var u=i.getDataAt(l);if(u){var c=u.GetAttribute(),h=u.GetValue();c&&h&&(s[c]=h)}}return n},kChemObjToOB:function(e,t){var n=t||new(r.getClassCtor("OBBase"));e.getName&&n.SetTitle&&n.SetTitle(e.getName());var i=e.getInfo();if(i)for(var o=d.ObjUtils.getOwnedFieldNames(i),a=0,s=o.length;a<s;++a){var l=o[a],u=i[l];if(l&&u){var c=new(r.getClassCtor("OBPairData"));c.SetAttribute(""+l),c.SetValue(""+u),n.SetData(c)}}},obAtomToKekule:function(e,t,r){var n=e.GetAtomicNum(),i=n?d.Atom:d.SubGroup;!t||t instanceof i||d.Error(d.$L("ErrorMsg.OpenBabel.CHEM_NODE_TYPE_NOT_SUITABLE"));var o,a=t||new i;return d.OpenBabel.AdaptUtils.obBaseToKekule(e,a),o=e.GetId(),d.ObjUtils.notUnset(o)&&a.setId(d.OpenBabel.AdaptUtils.DEF_ATOM_ID_PREFIX+o),(o=e.GetFormalCharge())&&a.setCharge(o),(o=e.GetSpinMultiplicity())&&a.setRadical(o),o={x:e.GetX(),y:e.GetY()},r===d.CoordMode.COORD3D&&(o.z=e.GetZ()),a.setAbsCoordOfMode?a.setAbsCoordOfMode(o,r):a.setCoordOfMode(o,r),a instanceof d.Atom&&(n&&a.setAtomicNumber(n),(o=e.GetIsotope())&&a.setMassNumber(o),(o=e.GetHyb())&&a.setHybridizationType(o)),a},kChemNodeToOB:function(e,t,n){var i,o=t||new(r.getClassCtor("OBAtom"));if(i=e.getId(),i=d.OpenBabel.AdaptUtils.kIdToOB(i),d.ObjUtils.notUnset(i)&&o.SetId(i),i=e.getCharge())if(parseInt(i,10)===parseFloat(i))o.SetFormalCharge(i);else{var a=parseInt(i,10),s=i-a;o.SetFormalCharge(a),o.SetPartialCharge(s)}if((i=e.getRadical())&&o.SetSpinMultiplicity(i),i=e.getAbsCoordOfMode?e.getAbsCoordOfMode(n):e.getCoordOfMode(n),o.SetVector(i.x||0,i.y||0,i.z||0),e instanceof d.Atom){o.SetAtomicNum(e.getAtomicNumber()),(i=e.getMassNumber())&&o.SetIsotope(i),(i=e.getHybridizationType())&&o.SetHyb(i);var l=e.getImplicitHydrogenCount();l&&o.SetImplicitHCount(l)}else o.SetAtomicNum(0);return o},obBondToKekule:function(e,t,r){var n,i=t||new d.Bond;d.OpenBabel.AdaptUtils.obBaseToKekule(e,i),n=e.GetId(),d.ObjUtils.notUnset(n)&&i.setId(d.OpenBabel.AdaptUtils.DEF_BOND_ID_PREFIX+n),n=e.GetBondOrder(),i.setBondOrder(d.OpenBabel.AdaptUtils.obBondOrderToKekule(n));var o=d.BondStereo;if(n=e.IsWedge()?o.UP:e.IsHash()?o.DOWN:e.IsWedgeOrHash()?o.UP_OR_DOWN:e.IsCisOrTrans()?o.CIS_OR_TRANS:e.IsDoubleBondGeometry()?o.E_Z_BY_COORDINATES:o.NONE,i.setStereo(n),console.log(e.GetFlags().toString(2)),r){n=null;for(var a=[e.GetBeginAtom(),e.GetEndAtom()],s=0,l=a.length;s<l;++s){var u=a[s];u&&(n=r.get(u.GetIdx()))&&i.appendConnectedObj(n)}}return i},kBondToOB:function(e,t,n,i){var o=t||new(r.getClassCtor("OBBond"));d.OpenBabel.AdaptUtils.kChemObjToOB(e,o),c=d.OpenBabel.AdaptUtils.kIdToOB(e.getId()),d.ObjUtils.notUnset(c)&&o.SetId(c),(c=e.getBondOrder())&&(o.SetBondOrder(d.OpenBabel.AdaptUtils.kBondOrderToOB(c)),c===d.BondOrder.EXPLICIT_AROMATIC&&o.SetAromatic()),o.UnsetHash(),o.UnsetWedge(),o.UnsetUp(),o.UnsetDown(),o.UnsetAromatic();var a=d.BondStereo;if((c=e.getStereo())===a.UP?o.SetWedge(!0):c===a.DOWN?o.SetHash(!0):c===a.UP_OR_DOWN&&o.SetWedgeOrHash(!0),n)for(var s=0,l=0,u=e.getConnectedObjCount();l<u;++l){var c,h=e.getConnectedObjAt(l);if(h&&h instanceof d.ChemStructureNode&&((c=n.get(h))&&(0===s?o.SetBegin(c):1===s&&o.SetEnd(c),++s),c.AddBond&&c.AddBond(o),s>1))break}return o},obMolToKekule:function(e,t,n){var i=t,o=new(r.getClassCtor("ObConversionWrapper"));try{o.setOutFormat("","mol");var a=o.writeString(e,!1),s=d.IO.loadFormatData(a,d.IO.DataFormat.MOL);i?i.assign(s):i=s,s.finalize()}finally{o.delete()}if(d.OpenBabel.AdaptUtils.obBaseToKekule(e,i),n){var l;if((l=e.NumAtoms())===i.getNodeCount())for(var u=0;u<l;++u){var c=e.GetAtom(u+1);if(c){var h=i.getNodeAt(u);h&&n.set(c,h)}}if((l=e.NumBonds())===i.getConnectorCount())for(u=0;u<l;++u){var p=e.GetBond(u);if(p){var g=i.getConnectorAt(u);g&&n.set(p,g)}}}return i},kMolToOB:function(e,t,n){var i=e.nodesHasCoord3D()?d.CoordMode.COORD3D:d.CoordMode.COORD2D,o=t||new(r.getClassCtor("OBMol"));t&&o.Clear();for(var a=new d.MapEx(!1),s=e.getFlattenedShadowFragment(!0),l=0,u=s.getNodeCount();l<u;++l){var c=s.getNodeAt(l);if(c){var h=d.OpenBabel.AdaptUtils.kChemNodeToOB(c,o.NewAtom(),i);if(h&&(a.set(c,h),n)){var p=e.getFlatternedShadowSourceObj(c);n.set(p,h)}}}for(l=0,u=s.getConnectorCount();l<u;++l){var g=s.getConnectorAt(l);if(g&&g instanceof d.Bond){var f=d.OpenBabel.AdaptUtils.kBondToOB(g,o.NewBond(),a,o);if(n&&f){var m=e.getFlatternedShadowSourceObj(g);n.set(m,f)}}}return a.finalize(),a=null,o},obReactionToKekule:function(e,t,r){var n=t||new d.Reaction;n.clearAll(),d.OpenBabel.AdaptUtils.obBaseToKekule(e,n),n.setDirection(e.IsReversible()?d.ReactionDirection.BIDIRECTION:d.ReactionDirection.FORWARD);for(var i=0,o=e.NumReactants();i<o;++i){var a=e.GetReactant(i),s=d.OpenBabel.AdaptUtils.obMolToKekule(a,null,r);n.appendReactant(s),r&&r.set(a,s)}for(i=0,o=e.NumProducts();i<o;++i)a=e.GetProduct(i),s=d.OpenBabel.AdaptUtils.obMolToKekule(a,null,r),n.appendProduct(s),r&&r.set(a,s);return n},kReactionToOB:function(e,t,n){var i=t||new(r.getClassCtor("OBReaction"));i.Clear(),d.OpenBabel.AdaptUtils.kChemObjToOB(e,i);var o=!1,a=e.getDirection();a===d.ReactionDirection.BIDIRECTION?i.SetReversible(!0):a===d.ReactionDirection.BACKWARD&&(o=!0);for(var s=0,l=e.getReactantCount();s<l;++s)if(c=e.getReactantAt(s)){var u=d.OpenBabel.AdaptUtils.kMolToOB(c,null,n);o?i.AddProduct(u):i.AddReactant(u),n&&n.set(c,u)}for(s=0,l=e.getProductCount();s<l;++s){var c;(c=e.getProductAt(s))&&(u=d.OpenBabel.AdaptUtils.kMolToOB(c,null,n),o?i.AddReactant(u):i.AddProduct(u),n&&n.set(c,u))}}}}(),function(){d.EmscriptenUtils;var e=d.OpenBabel,t=d.OpenBabel.AdaptUtils;d.IO.OpenBabelReader=Class.create(d.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.OpenBabelReader",initialize:function(e){this.tryApplySuper("initialize")},finalize:function(){this.tryApplySuper("finalize")},getFormatTargetObClassName:function(e){return e.getTypeName().toLowerCase().indexOf("reaction")>=0?"OBReaction":"OBMol"},doReadData:function(r,n,i){this._obConv=new(e.getClassCtor("ObConversionWrapper"));try{var o=d.IO.DataFormatsManager.getFormatInfo(i),a=(o.mimeType,o.fileExts[0],this._obConv.setInFormatId(o.id)),s=this.getFormatTargetObClassName(a);try{var l=[];this._obConv.setInStr(r);for(var u=new(e.getClassCtor(s)),c=this._obConv.readFromInput(u);c;){if(u.NumAtoms&&u.NumAtoms()>0){var h=t.obObjToKekule(u);l.push(h)}c=this._obConv.readFromInput(u)}var p=l.length;if(p<=0)return null;if(1===p)return l[0];for(var g=new d.ChemObjList,f=0;f<p;++f)g.append(l[f]);return g}finally{u&&(u.delete(),u=null)}}finally{this._obConv&&(this._obConv.delete(),this._obConv=null)}}}),d.IO.OpenBabelWriter=Class.create(d.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.OpenBabelWriter",initialize:function(e){this.tryApplySuper("initialize",[e])},finalize:function(){this.tryApplySuper("finalize")},doWriteData:function(r,n,i){this._obConv=new(e.getClassCtor("ObConversionWrapper"));try{var o=d.IO.DataFormatsManager.getFormatInfo(i);o.mimeType,o.fileExts[0],this._obConv.setOutFormatId(o.id);for(var a=d.ChemStructureUtils.getChildStructureObjs(r,!0),s=0,l=a.length;s<l;++s){var u=a[s];if(u){var c=t.kObjToOB(u);if(c)try{if(!this._obConv.writeToOutput(c))break}finally{c.delete(),c=null}}}return this._obConv.getOutStr()}finally{this._obConv&&this._obConv.delete()}},isAllowedObj:function(e){var t=d.IO.OpenBabelWriter.ALLOWED_CLASSES;return d.ObjUtils.isInstanceOf(e,t)}}),d.IO.OpenBabelWriter.ALLOWED_CLASSES=[d.StructureFragment,d.Reaction,d.ChemObjList,d.ChemStructureObjectGroup,d.ChemSpaceElement,d.ChemSpace],d.OpenBabel.IORegHelper=Class.create({listFormatInfo:function(e,t){for(var r=[],n=("in"===e?t.getSupportedInputFormatsStr("\n"):t.getSupportedOutputFormatsStr("\n")).split("\n"),i=0,o=n.length;i<o;++i){var a=n[i],s=a.indexOf("--");if(s>0){var l=a.substring(0,s).trim(),d=t.getFormatInfoById(l);r.push(d)}}return r},registerByInfos:function(e,t){for(var r=d.IO.DataFormatsManager,n=[],i=0,o=e.length;i<o;++i){var a=e[i],s=a.id,l=a.mimeType;if((u=r.findFormatId(l))&&(u=r.findFormatId(null,s)),!u)var u=r.register(s,l,s,d.IO.ChemDataType.UNKNOWN,a.description,a.description,{specificationUrl:a.specificationURL}).id;("in"===t?d.IO.ChemDataReaderManager.getReaderInfoByFormat(u):d.IO.ChemDataWriterManager.getWriterInfoByFormat(u))||d.ArrayUtils.pushUnique(n,u)}n.length&&("in"===t?d.IO.ChemDataReaderManager.register("openbabel",d.IO.OpenBabelReader,n):d.IO.ChemDataWriterManager.register("openbabel",d.IO.OpenBabelWriter,d.IO.OpenBabelWriter.ALLOWED_CLASSES,n))},registerAll:function(){var t=new(e.getClassCtor("ObConversionWrapper"));try{var r=this.listFormatInfo("in",t);this.registerByInfos(r,"in"),r=this.listFormatInfo("out",t),this.registerByInfos(r,"out")}finally{t.delete()}}}),d.IO.registerAllOpenBabelFormats=function(){if(d.OpenBabel.AdaptUtils.isAvailable())try{var e=new d.OpenBabel.IORegHelper;e.registerAll()}finally{e=null}},d.OpenBabel._enableFuncs.push(d.IO.registerAllOpenBabelFormats),d.IO.enableOpenBabelFormats=function(){d.OpenBabel.AdaptUtils.isAvailable()?d.IO.registerAllOpenBabelFormats():d.OpenBabel.loadObScript(document,(function(){d.IO.registerAllOpenBabelFormats()}))}}(),function(){"use strict";d.EmscriptenUtils;var e=d.OpenBabel,t=d.OpenBabel.AdaptUtils;d.OpenBabel.StructUtils={generate2DStructure:function(e,r,n){var i=r||{};try{var o=new d.MapEx,a=new d.MapEx,s=t.kObjToOB(e,null,o);if(d.OpenBabel.StructUtils._gen2DByObOperation(s,i)||(s.delete(),s=null),s){if(e=t.obObjToKekule(s,null,a),n)for(var l=o.getKeys(),u=0,c=l.length;u<c;++u){var h=l[u],p=o.get(h);if(p){var g=a.get(p);g&&n.set(h,g)}}}else d.raise(d.$L("ErrorMsg.OpenBabel.FAIL_TO_GENERATE_3D_STRUCTURE"))}finally{s&&s.delete()}return e},generate3DStructure:function(r,n,i){var o,a=n||{},s=a.forceField;try{var l=new d.MapEx,u=new d.MapEx,c=t.kObjToOB(r,null,l);if(a.applyFFCalc){var h=new(e.getClassCtor("OB3DGenWrapper"));try{h.generate3DStructure(c,s||"")}finally{h.delete()}}else d.OpenBabel.StructUtils._gen3DByObOperation(c,a)||(c.delete(),c=null);if(c){if(o=t.obObjToKekule(c,null,u),i)for(var p=l.getKeys(),g=0,f=p.length;g<f;++g){var m=p[g],C=l.get(m);if(C){var y=u.get(C);y&&i.set(m,y)}}}else d.raise(d.$L("ErrorMsg.OpenBabel.FAIL_TO_GENERATE_3D_STRUCTURE"))}finally{c&&c.delete()}return o},_gen2DByObOperation:function(t,r){var n=!1,i=e.getModule().OBOp.FindType("Gen2D");if(i){var o=""+r.speed||"";i.Do(t,o),n=!0}return n},_gen3DByObOperation:function(t,r){var n=""+r.speed||"",i=!1,o=e.getModule().OBOp.FindType("Gen3D");return o&&(o.Do(t,n),i=!0),i}},d.Calculator&&(d.Calculator.ObStructureBaseGenerator=Class.create(d.Calculator.AbstractStructureGenerator,{CLASS_NAME:"Kekule.Calculator.ObStructureBaseGenerator",isWorkerShared:function(){return!0},getGeneratorCoordMode:function(){return 2===this.getOutputDimension()?d.CoordMode.COORD2D:d.CoordMode.COORD3D},getOutputDimension:function(){return 3},_getInputMsgName:function(){return"gen"+this.getOutputDimension()+"D"},_getOutputMsgName:function(){return"output"+this.getOutputDimension()+"D"},getObInitOptions:function(){return d.OpenBabel.getObInitOptions()},getForceField:function(){return this.getOptions().forceField},doGetWorker:function(){var e=this.tryApplySuper("doGetWorker");return e||(e=d.Calculator.ObStructureBaseGenerator._worker),e},createWorker:function(){var e=this.tryApplySuper("createWorker");if(e){var t=d.OpenBabel.getObScriptUrl();this.importWorkerScriptFile(t);var r=this.getObInitOptions();this.postWorkerMessage({type:"obInit",usingModulaize:r.usingModulaize,moduleName:r.moduleName,initCallbackName:r.moduleInitCallbackName}),d.Calculator.ObStructureBaseGenerator._worker=e}return e},getWorkerScriptFile:function(){return d.OpenBabel.getObPath()+"kekule.worker.obStructureGenerator.js"},doReactWorkerMessage:function(e,t){if(this.tryApplySuper("doReactWorkerMessage",[e,t]),e.type===this._getOutputMsgName()){var r=e.molData;if(r){var n=d.IO.loadMimeData(r,"chemical/x-mdl-molfile"),i=this.getChildObjMap();if(i){for(var o=this.getSourceMol().getFlattenedShadowFragment(!0),a=0,s=o.getNodeCount();a<s;++a)i.set(o.getNodeAt(a),n.getNodeAt(a));for(a=0,s=o.getConnectorCount();a<s;++a)i.set(o.getConnectorAt(a),n.getConnectorAt(a))}this.setGeneratedMol(n),this.done()}}},workerStartCalc:function(e){var t=this.getSourceMol().getFlattenedShadowFragment(!0),r=d.IO.saveMimeData(t,"chemical/x-mdl-molfile"),n=Object.extend(this.getOptions(),{type:this._getInputMsgName(),molData:r});this.postWorkerMessage(n)},doExecuteSync:function(e){if(d.OpenBabel){var t=this;d.OpenBabel.loadObScript(null,(function(){var r;try{var n=(2===t.getOutputDimension()?d.OpenBabel.StructUtils.generate2DStructure:d.OpenBabel.StructUtils.generate3DStructure)(t.getSourceMol(),t.getOptions());t.setGeneratedMol(n)}catch(e){throw r=e,e}return r||t.done(),e&&e(r),!0}))}else d.error(d.$L("ErrorMsg.MODULE_NOT_LOADED").format("OpenBabel"));return!1}}),d.Calculator.ObStructure3DGenerator=Class.create(d.Calculator.ObStructureBaseGenerator,{CLASS_NAME:"Kekule.Calculator.ObStructure3DGenerator",getOutputDimension:function(){return 3}}),d.Calculator.ObStructure2DGenerator=Class.create(d.Calculator.ObStructureBaseGenerator,{CLASS_NAME:"Kekule.Calculator.ObStructure2DGenerator",getOutputDimension:function(){return 2}}),d.Calculator.ServiceManager.register(d.Calculator.Services.GEN3D,d.Calculator.ObStructure3DGenerator,"openbabel",10),d.Calculator.ServiceManager.register(d.Calculator.Services.GEN2D,d.Calculator.ObStructure2DGenerator,"openbabel",10))}(),function(e){"use strict";var t=d.EmscriptenUtils,r={usingModulaize:!0,moduleName:"IndigoModule",moduleInitEventName:"Indigo.Initialized",moduleInitCallbackName:"__$indigoInitialized$__",indigoAdaptFuncName:"CreateIndigo"};d.Indigo={_autoEnabled:!0,_module:null,_indigo:null,SCRIPT_FILE:"indigo.js",HELPER_SCRIPT_FILE:"indigoAdapter.js",_enableFuncs:[],isScriptLoaded:function(){return t.isSupported(r.moduleName)&&void 0!==e[r.indigoAdaptFuncName]},getIndigoInitOptions:function(){return r},getModule:function(){return n._module||(n._module=t.getRootModule(r.moduleName,r)),n._module},setModule:function(e){n._module=e,t.setRootModule(r.moduleName,e)},getIndigo:function(){if(!n._indigo){var t=n.getModule();t&&(n._indigo=e[r.indigoAdaptFuncName](t))}return n._indigo},getClassCtor:function(e){return t.getClassCtor(e,n.getModule())},isAvailable:function(){return n.getModule()&&n.getIndigo()},enable:function(e){n.isScriptLoaded()?(n._enableAllFunctions(),e&&e()):n.loadIndigoScript(d.$jsRoot.document,(function(t){t||n._enableAllFunctions(),e&&e(t)}))},_enableAllFunctions:function(){if(t.isModuleReady(r.moduleName))for(var e=n._enableFuncs,i=0,o=e.length;i<o;++i){var a=e[i];a&&a()}}},d.Indigo.getIndigoPath=function(){var e=d.environment.getEnvVar("indigo.path");return e||(e=d.isUsingMinJs()?"extra/":"_extras/Indigo/",e=d.getScriptPath()+e),e},d.Indigo.getIndigoScriptUrl=function(){var e=d.environment.getEnvVar("indigo.scriptSrc");return e||(e=n.getIndigoPath()+n.SCRIPT_FILE,d.isUsingMinJs()||(e+=".dev")),e},d.Indigo.getIndigoHelperScriptUrl=function(){return n.getIndigoPath()+n.HELPER_SCRIPT_FILE},d.Indigo.loadIndigoScript=function(e,i){e||(e=d.$jsRoot.document);var o=function(e){n._scriptLoadedBySelf=!e,e||d.Indigo.getIndigo(),i&&i(e)};if(n._scriptLoadedBySelf||n.isScriptLoaded())o();else{var a=n.getIndigoScriptUrl();t.loadScript(a,(function(t){t?o(t):d.ScriptFileUtils.appendScriptFiles(e,[n.getIndigoHelperScriptUrl()],o)}),e,r)}};var n=d.Indigo;d.Indigo.AdaptUtils={iMolToKekule:function(e){var t=n.getIndigo(),r=t.molfile(e);return t.free(e),d.IO.loadFormatData(r,d.IO.DataFormat.MOL)},kMolToIndigo:function(e){var t=n.getIndigo(),r=d.IO.saveFormatData(e,d.IO.DataFormat.MOL);return t.loadMoleculeFromString(r)}},d._registerAfterLoadSysProc((function(){n._autoEnabled&&n.isScriptLoaded()&&t.ensureModuleReady(d.$jsRoot.document,r,n._enableAllFunctions)}))}(this),function(){"use strict";d.EmscriptenUtils;var e=d.Indigo;d.IO.IndigoReader=Class.create(d.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.IndigoReader",doReadData:function(t,r,n,i){var o=e.getIndigo(),a=o.loadMoleculeFromString(t);if(a>=0){n===d.IO.DataFormat.SMILES&&(!i||i.autoLayout||d.ObjUtils.isUnset(i.autoLayout));var s=o.molfile(a);return o.free(a),d.IO.loadFormatData(s,d.IO.DataFormat.MOL)}return null}}),d.IO.registerAllIndigoFormats=function(){e.isAvailable()&&d.IO.ChemDataReaderManager.register("Indigo-smiles",d.IO.IndigoReader,d.IO.DataFormat.SMILES)},d.IO.enableIndigoFormats=function(){e.isAvailable()?d.IO.registerAllIndigoFormats():e.loadIndigoScript(document,(function(){d.IO.registerAllIndigoFormats()}))},e._enableFuncs.push(d.IO.registerAllIndigoFormats)}(),function(){"use strict";var e=d.Indigo;d.Indigo.StructUtils={generate2DStructure:function(t,r,n){var i=e.getIndigo(),o=e.AdaptUtils.kMolToIndigo(t);return i.setOption("smart-layout","true"),i.layout(o),e.AdaptUtils.iMolToKekule(o)}},d.Calculator&&(d.Calculator.IndigoStructure2DGenerator=Class.create(d.Calculator.AbstractStructureGenerator,{CLASS_NAME:"Kekule.Calculator.IndigoStructure2DGenerator",execute:function(e){var t,r;try{r=this.executeSync(e)}catch(e){t=e}t?(d.error(t),this.error(t)):r&&(t?this.error(t):this.done())},doExecuteSync:function(e){if(d.Indigo){var t=this;d.Indigo.loadIndigoScript(null,(function(){var r;try{var n=d.Indigo.StructUtils.generate2DStructure(t.getSourceMol(),t.getOptions());t.setGeneratedMol(n)}catch(e){r=e}r||t.done(),e&&e(r)}))}else d.error(d.$L("ErrorMsg.MODULE_NOT_LOADED").format("Indigo"));return!1}}),d.Calculator.ServiceManager.register(d.Calculator.Services.GEN2D,d.Calculator.IndigoStructure2DGenerator,"indigo",0))}(),function(){"use strict";var e=d.EmscriptenUtils,t={usingModulaize:!0,moduleName:"InChIModule",moduleInitEventName:"InChI.Initialized",moduleInitCallbackName:"__$inChIInitialized$__"};d.InChI={_autoEnabled:!0,_scriptLoadedBySelf:!1,_module:null,_enableFuncs:[],SCRIPT_FILE:"inchi.js",isScriptLoaded:function(){return e.isSupported(t.moduleName)},getInchiInitOptions:function(){return t},getModule:function(){return r._module||(r._module=e.getRootModule(t.moduleName,t)),r._module},setModule:function(n){r._module=n,e.setRootModule(t.moduleName,n)},getInChIPath:function(){var e=d.environment.getEnvVar("inchi.path");return e||(e=d.isUsingMinJs()?"extra/":"_extras/InChI/",e=d.getScriptPath()+e),e},getInChIScriptUrl:function(){var e=d.environment.getEnvVar("inchi.scriptSrc");return e||(e=r.getInChIPath()+r.SCRIPT_FILE,d.isUsingMinJs()||(e+=".dev")),e},loadInChIScript:function(n,i){n||(n=d.$jsRoot.document);var o=function(e){r._scriptLoadedBySelf=!e,i&&i(e)};if(r._scriptLoadedBySelf||r.isScriptLoaded())o();else{var a=r.getInChIScriptUrl();e.loadScript(a,o,n,t)}},molDataToInChI:function(e,t){var n=r._molToInChI;n||(n=r.getModule().cwrap("molToInchiJson","string",["string","string"]));var i=n(e,t);return JSON.parse(i)},getInChIKeyFromInChI:function(e,t,n){var i=r._getInChIKeyFromInChI;i||(i=r.getModule().cwrap("getInChIKeyJson","string",["string","number","number"]));var o=i(e,t,n);return JSON.parse(o)},getInChIInfo:function(e){var t=d.IO.saveFormatData(e,d.IO.DataFormat.MOL);return r.molDataToInChI(t)},enable:function(e){r.isScriptLoaded()?(r._enableAllFunctions(),e&&e()):r.loadInChIScript(d.$jsRoot.document,(function(t){t||r._enableAllFunctions(),e&&e(t)}))},_enableAllFunctions:function(){if(e.isModuleReady(t.moduleName))for(var n=r._enableFuncs,i=0,o=n.length;i<o;++i){var a=n[i];a&&a()}}};var r=d.InChI;d.IO.InChIWriter=Class.create(d.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.InChIWriter",doWriteData:function(e,t,n){var i=r.getInChIInfo(e);if(i&&i.inchi){var o=i.inchi;i.auxInfo&&(o+="\n"+i.auxInfo);var a=r.getInChIKeyFromInChI(i.inchi,1,1);return o+"\n"+JSON.stringify(a)}return null},isAllowedObj:function(e){var t=d.IO.InChIWriter.ALLOWED_CLASSES;return d.ObjUtils.isInstanceOf(e,t)}}),d.IO.InChIWriter.ALLOWED_CLASSES=[d.StructureFragment,d.Reaction,d.ChemObjList,d.ChemStructureObjectGroup,d.ChemSpaceElement,d.ChemSpace],d.IO.registerAllInChIFormats=function(){r.isScriptLoaded()&&(d.IO.DataFormat.INCHI="inchi",d.IO.MimeType.INCHI="chemical/x-inchi",d.IO.DataFormatsManager.register("inchi",d.IO.MimeType.INCHI,"inchi",d.IO.ChemDataType.TEXT,"InChI format"),d.IO.ChemDataWriterManager.register("inchi",d.IO.InChIWriter,d.IO.InChIWriter.ALLOWED_CLASSES,"inchi"))},d.IO.enableInChIFormats=function(){r.enable()},r._enableFuncs.push(d.IO.registerAllInChIFormats),d._registerAfterLoadSysProc((function(){r._autoEnabled&&r.isScriptLoaded()&&e.ensureModuleReady(d.$jsRoot.document,t,r._enableAllFunctions)}))}(),void 0!==d&&d._loaded();try{e.exports={Class:Class,ClassEx:ClassEx,ObjectEx:ObjectEx,DataType:DataType,Kekule:d}}catch(u){}},6987:function(e,t,r){r(8512),e.exports=r(2962)},1725:function(e){"use strict";var t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;function i(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(i){return!1}}()?Object.assign:function(e,o){for(var a,s,l=i(e),d=1;d<arguments.length;d++){for(var u in a=Object(arguments[d]))r.call(a,u)&&(l[u]=a[u]);if(t){s=t(a);for(var c=0;c<s.length;c++)n.call(a,s[c])&&(l[s[c]]=a[s[c]])}}return l}},1025:function(e,t){var r,n,i;n=[],r=function e(){"use strict";var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{},r=!t.document&&!!t.postMessage,n=r&&/blob:/i.test((t.location||{}).protocol),i={},o=0,a={parse:function(r,n){var s=(n=n||{}).dynamicTyping||!1;if(T(s)&&(n.dynamicTypingFunction=s,s={}),n.dynamicTyping=s,n.transform=!!T(n.transform)&&n.transform,n.worker&&a.WORKERS_SUPPORTED){var l=function(){if(!a.WORKERS_SUPPORTED)return!1;var r,n,s=(r=t.URL||t.webkitURL||null,n=e.toString(),a.BLOB_URL||(a.BLOB_URL=r.createObjectURL(new Blob(["(",n,")();"],{type:"text/javascript"})))),l=new t.Worker(s);return l.onmessage=m,l.id=o++,i[l.id]=l}();return l.userStep=n.step,l.userChunk=n.chunk,l.userComplete=n.complete,l.userError=n.error,n.step=T(n.step),n.chunk=T(n.chunk),n.complete=T(n.complete),n.error=T(n.error),delete n.worker,void l.postMessage({input:r,config:n,workerId:l.id})}var p=null;return a.NODE_STREAM_INPUT,"string"==typeof r?p=n.download?new d(n):new c(n):!0===r.readable&&T(r.read)&&T(r.on)?p=new h(n):(t.File&&r instanceof File||r instanceof Object)&&(p=new u(n)),p.stream(r)},unparse:function(e,t){var r=!1,n=!0,i=",",o="\r\n",s='"',l=s+s,d=!1,u=null,c=!1;!function(){if("object"==typeof t){if("string"!=typeof t.delimiter||a.BAD_DELIMITERS.filter((function(e){return-1!==t.delimiter.indexOf(e)})).length||(i=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(r=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(d=t.skipEmptyLines),"string"==typeof t.newline&&(o=t.newline),"string"==typeof t.quoteChar&&(s=t.quoteChar),"boolean"==typeof t.header&&(n=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");u=t.columns}void 0!==t.escapeChar&&(l=t.escapeChar+s),("boolean"==typeof t.escapeFormulae||t.escapeFormulae instanceof RegExp)&&(c=t.escapeFormulae instanceof RegExp?t.escapeFormulae:/^[=+\-@\t\r].*$/)}}();var h=new RegExp(g(s),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return p(null,e,d);if("object"==typeof e[0])return p(u||Object.keys(e[0]),e,d)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||u),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),p(e.fields||[],e.data||[],d);throw new Error("Unable to serialize unrecognized input");function p(e,t,r){var a="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var s=Array.isArray(e)&&0<e.length,l=!Array.isArray(t[0]);if(s&&n){for(var d=0;d<e.length;d++)0<d&&(a+=i),a+=f(e[d],d);0<t.length&&(a+=o)}for(var u=0;u<t.length;u++){var c=s?e.length:t[u].length,h=!1,p=s?0===Object.keys(t[u]).length:0===t[u].length;if(r&&!s&&(h="greedy"===r?""===t[u].join("").trim():1===t[u].length&&0===t[u][0].length),"greedy"===r&&s){for(var g=[],m=0;m<c;m++){var C=l?e[m]:m;g.push(t[u][C])}h=""===g.join("").trim()}if(!h){for(var y=0;y<c;y++){0<y&&!p&&(a+=i);var _=s&&l?e[y]:y;a+=f(t[u][_],y)}u<t.length-1&&(!r||0<c&&!p)&&(a+=o)}}return a}function f(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);var n=!1;c&&"string"==typeof e&&c.test(e)&&(e="'"+e,n=!0);var o=e.toString().replace(h,l);return(n=n||!0===r||"function"==typeof r&&r(e,t)||Array.isArray(r)&&r[t]||function(e,t){for(var r=0;r<t.length;r++)if(-1<e.indexOf(t[r]))return!0;return!1}(o,a.BAD_DELIMITERS)||-1<o.indexOf(i)||" "===o.charAt(0)||" "===o.charAt(o.length-1))?s+o+s:o}}};if(a.RECORD_SEP=String.fromCharCode(30),a.UNIT_SEP=String.fromCharCode(31),a.BYTE_ORDER_MARK="\ufeff",a.BAD_DELIMITERS=["\r","\n",'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!r&&!!t.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=f,a.ParserHandle=p,a.NetworkStreamer=d,a.FileStreamer=u,a.StringStreamer=c,a.ReadableStreamStreamer=h,t.jQuery){var s=t.jQuery;s.fn.parse=function(e){var r=e.config||{},n=[];return this.each((function(e){if("INPUT"!==s(this).prop("tagName").toUpperCase()||"file"!==s(this).attr("type").toLowerCase()||!t.FileReader||!this.files||0===this.files.length)return!0;for(var i=0;i<this.files.length;i++)n.push({file:this.files[i],inputElem:this,instanceConfig:s.extend({},r)})})),i(),this;function i(){if(0!==n.length){var t,r,i,l,d=n[0];if(T(e.before)){var u=e.before(d.file,d.inputElem);if("object"==typeof u){if("abort"===u.action)return t="AbortError",r=d.file,i=d.inputElem,l=u.reason,void(T(e.error)&&e.error({name:t},r,i,l));if("skip"===u.action)return void o();"object"==typeof u.config&&(d.instanceConfig=s.extend(d.instanceConfig,u.config))}else if("skip"===u)return void o()}var c=d.instanceConfig.complete;d.instanceConfig.complete=function(e){T(c)&&c(e,d.file,d.inputElem),o()},a.parse(d.file,d.instanceConfig)}else T(e.complete)&&e.complete()}function o(){n.splice(0,1),i()}}}function l(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=_(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new p(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,r){if(this.isFirstChunk&&T(this._config.beforeFirstChunk)){var i=this._config.beforeFirstChunk(e);void 0!==i&&(e=i)}this.isFirstChunk=!1,this._halted=!1;var o=this._partialLine+e;this._partialLine="";var s=this._handle.parse(o,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var l=s.meta.cursor;this._finished||(this._partialLine=o.substring(l-this._baseIndex),this._baseIndex=l),s&&s.data&&(this._rowCount+=s.data.length);var d=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(n)t.postMessage({results:s,workerId:a.WORKER_ID,finished:d});else if(T(this._config.chunk)&&!r){if(this._config.chunk(s,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);s=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(s.data),this._completeResults.errors=this._completeResults.errors.concat(s.errors),this._completeResults.meta=s.meta),this._completed||!d||!T(this._config.complete)||s&&s.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),d||s&&s.meta.paused||this._nextChunk(),s}this._halted=!0},this._sendError=function(e){T(this._config.error)?this._config.error(e):n&&this._config.error&&t.postMessage({workerId:a.WORKER_ID,error:e,finished:!1})}}function d(e){var t;(e=e||{}).chunkSize||(e.chunkSize=a.RemoteChunkSize),l.call(this,e),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),r||(t.onload=E(this._chunkLoaded,this),t.onerror=E(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var n in e)t.setRequestHeader(n,e[n])}if(this._config.chunkSize){var i=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+i)}try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}r&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(e){var t=e.getResponseHeader("Content-Range");return null===t?-1:parseInt(t.substring(t.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){var r=t.statusText||e;this._sendError(new Error(r))}}function u(e){var t,r;(e=e||{}).chunkSize||(e.chunkSize=a.LocalChunkSize),l.call(this,e);var n="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,r=e.slice||e.webkitSlice||e.mozSlice,n?((t=new FileReader).onload=E(this._chunkLoaded,this),t.onerror=E(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var i=Math.min(this._start+this._config.chunkSize,this._input.size);e=r.call(e,this._start,i)}var o=t.readAsText(e,this._config.encoding);n||this._chunkLoaded({target:{result:o}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function c(e){var t;l.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e,r=this._config.chunkSize;return r?(e=t.substring(0,r),t=t.substring(r)):(e=t,t=""),this._finished=!t,this.parseChunk(e)}}}function h(e){l.call(this,e=e||{});var t=[],r=!0,n=!1;this.pause=function(){l.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){l.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){n&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):r=!0},this._streamData=E((function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}}),this),this._streamError=E((function(e){this._streamCleanUp(),this._sendError(e)}),this),this._streamEnd=E((function(){this._streamCleanUp(),n=!0,this._streamData("")}),this),this._streamCleanUp=E((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function p(e){var t,r,n,i=Math.pow(2,53),o=-i,s=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,l=/^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))$/,d=this,u=0,c=0,h=!1,p=!1,m=[],C={data:[],errors:[],meta:{}};if(T(e.step)){var y=e.step;e.step=function(t){if(C=t,v())O();else{if(O(),0===C.data.length)return;u+=t.data.length,e.preview&&u>e.preview?r.abort():(C.data=C.data[0],y(C,d))}}}function E(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function O(){return C&&n&&(b("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),n=!1),e.skipEmptyLines&&(C.data=C.data.filter((function(e){return!E(e)}))),v()&&function(){if(C)if(Array.isArray(C.data[0])){for(var t=0;v()&&t<C.data.length;t++)C.data[t].forEach(r);C.data.splice(0,1)}else C.data.forEach(r);function r(t,r){T(e.transformHeader)&&(t=e.transformHeader(t,r)),m.push(t)}}(),function(){if(!C||!e.header&&!e.dynamicTyping&&!e.transform)return C;function t(t,r){var n,i=e.header?{}:[];for(n=0;n<t.length;n++){var o=n,a=t[n];e.header&&(o=n>=m.length?"__parsed_extra":m[n]),e.transform&&(a=e.transform(a,o)),a=S(o,a),"__parsed_extra"===o?(i[o]=i[o]||[],i[o].push(a)):i[o]=a}return e.header&&(n>m.length?b("FieldMismatch","TooManyFields","Too many fields: expected "+m.length+" fields but parsed "+n,c+r):n<m.length&&b("FieldMismatch","TooFewFields","Too few fields: expected "+m.length+" fields but parsed "+n,c+r)),i}var r=1;return!C.data.length||Array.isArray(C.data[0])?(C.data=C.data.map(t),r=C.data.length):C.data=t(C.data,0),e.header&&C.meta&&(C.meta.fields=m),c+=r,C}()}function v(){return e.header&&0===m.length}function S(t,r){return n=t,e.dynamicTypingFunction&&void 0===e.dynamicTyping[n]&&(e.dynamicTyping[n]=e.dynamicTypingFunction(n)),!0===(e.dynamicTyping[n]||e.dynamicTyping)?"true"===r||"TRUE"===r||"false"!==r&&"FALSE"!==r&&(function(e){if(s.test(e)){var t=parseFloat(e);if(o<t&&t<i)return!0}return!1}(r)?parseFloat(r):l.test(r)?new Date(r):""===r?null:r):r;var n}function b(e,t,r,n){var i={type:e,code:t,message:r};void 0!==n&&(i.row=n),C.errors.push(i)}this.parse=function(i,o,s){var l=e.quoteChar||'"';if(e.newline||(e.newline=function(e,t){e=e.substring(0,1048576);var r=new RegExp(g(t)+"([^]*?)"+g(t),"gm"),n=(e=e.replace(r,"")).split("\r"),i=e.split("\n"),o=1<i.length&&i[0].length<n[0].length;if(1===n.length||o)return"\n";for(var a=0,s=0;s<n.length;s++)"\n"===n[s][0]&&a++;return a>=n.length/2?"\r\n":"\r"}(i,l)),n=!1,e.delimiter)T(e.delimiter)&&(e.delimiter=e.delimiter(i),C.meta.delimiter=e.delimiter);else{var d=function(t,r,n,i,o){var s,l,d,u;o=o||[",","\t","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var c=0;c<o.length;c++){var h=o[c],p=0,g=0,m=0;d=void 0;for(var C=new f({comments:i,delimiter:h,newline:r,preview:10}).parse(t),y=0;y<C.data.length;y++)if(n&&E(C.data[y]))m++;else{var _=C.data[y].length;g+=_,void 0!==d?0<_&&(p+=Math.abs(_-d),d=_):d=_}0<C.data.length&&(g/=C.data.length-m),(void 0===l||p<=l)&&(void 0===u||u<g)&&1.99<g&&(l=p,s=h,u=g)}return{successful:!!(e.delimiter=s),bestDelimiter:s}}(i,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);d.successful?e.delimiter=d.bestDelimiter:(n=!0,e.delimiter=a.DefaultDelimiter),C.meta.delimiter=e.delimiter}var u=_(e);return e.preview&&e.header&&u.preview++,t=i,r=new f(u),C=r.parse(t,o,s),O(),h?{meta:{paused:!0}}:C||{meta:{paused:!1}}},this.paused=function(){return h},this.pause=function(){h=!0,r.abort(),t=T(e.chunk)?"":t.substring(r.getCharIndex())},this.resume=function(){d.streamer._halted?(h=!1,d.streamer.parseChunk(t,!0)):setTimeout(d.resume,3)},this.aborted=function(){return p},this.abort=function(){p=!0,r.abort(),C.meta.aborted=!0,T(e.complete)&&e.complete(C),t=""}}function g(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function f(e){var t,r=(e=e||{}).delimiter,n=e.newline,i=e.comments,o=e.step,s=e.preview,l=e.fastMode,d=t=void 0===e.quoteChar||null===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(d=e.escapeChar),("string"!=typeof r||-1<a.BAD_DELIMITERS.indexOf(r))&&(r=","),i===r)throw new Error("Comment character same as delimiter");!0===i?i="#":("string"!=typeof i||-1<a.BAD_DELIMITERS.indexOf(i))&&(i=!1),"\n"!==n&&"\r"!==n&&"\r\n"!==n&&(n="\n");var u=0,c=!1;this.parse=function(e,a,h){if("string"!=typeof e)throw new Error("Input must be a string");var p=e.length,f=r.length,m=n.length,C=i.length,y=T(o),_=[],E=[],O=[],v=u=0;if(!e)return k();if(l||!1!==l&&-1===e.indexOf(t)){for(var S=e.split(n),b=0;b<S.length;b++){if(O=S[b],u+=O.length,b!==S.length-1)u+=n.length;else if(h)return k();if(!i||O.substring(0,C)!==i){if(y){if(_=[],x(O.split(r)),B(),c)return k()}else x(O.split(r));if(s&&s<=b)return _=_.slice(0,s),k(!0)}}return k()}for(var A=e.indexOf(r,u),I=e.indexOf(n,u),R=new RegExp(g(d)+g(t),"g"),D=e.indexOf(t,u);;)if(e[u]!==t)if(i&&0===O.length&&e.substring(u,u+C)===i){if(-1===I)return k();u=I+m,I=e.indexOf(n,u),A=e.indexOf(r,u)}else if(-1!==A&&(A<I||-1===I))O.push(e.substring(u,A)),u=A+f,A=e.indexOf(r,u);else{if(-1===I)break;if(O.push(e.substring(u,I)),w(I+m),y&&(B(),c))return k();if(s&&_.length>=s)return k(!0)}else for(D=u,u++;;){if(-1===(D=e.indexOf(t,D+1)))return h||E.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:_.length,index:u}),L();if(D===p-1)return L(e.substring(u,D).replace(R,t));if(t!==d||e[D+1]!==d){if(t===d||0===D||e[D-1]!==d){-1!==A&&A<D+1&&(A=e.indexOf(r,D+1)),-1!==I&&I<D+1&&(I=e.indexOf(n,D+1));var N=M(-1===I?A:Math.min(A,I));if(e.substr(D+1+N,f)===r){O.push(e.substring(u,D).replace(R,t)),e[u=D+1+N+f]!==t&&(D=e.indexOf(t,u)),A=e.indexOf(r,u),I=e.indexOf(n,u);break}var P=M(I);if(e.substring(D+1+P,D+1+P+m)===n){if(O.push(e.substring(u,D).replace(R,t)),w(D+1+P+m),A=e.indexOf(r,u),D=e.indexOf(t,u),y&&(B(),c))return k();if(s&&_.length>=s)return k(!0);break}E.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:_.length,index:u}),D++}}else D++}return L();function x(e){_.push(e),v=u}function M(t){var r=0;if(-1!==t){var n=e.substring(D+1,t);n&&""===n.trim()&&(r=n.length)}return r}function L(t){return h||(void 0===t&&(t=e.substring(u)),O.push(t),u=p,x(O),y&&B()),k()}function w(t){u=t,x(O),O=[],I=e.indexOf(n,u)}function k(e){return{data:_,errors:E,meta:{delimiter:r,linebreak:n,aborted:c,truncated:!!e,cursor:v+(a||0)}}}function B(){o(k()),_=[],E=[]}},this.abort=function(){c=!0},this.getCharIndex=function(){return u}}function m(e){var t=e.data,r=i[t.workerId],n=!1;if(t.error)r.userError(t.error,t.file);else if(t.results&&t.results.data){var o={abort:function(){n=!0,C(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:y,resume:y};if(T(r.userStep)){for(var a=0;a<t.results.data.length&&(r.userStep({data:t.results.data[a],errors:t.results.errors,meta:t.results.meta},o),!n);a++);delete t.results}else T(r.userChunk)&&(r.userChunk(t.results,o,t.file),delete t.results)}t.finished&&!n&&C(t.workerId,t.results)}function C(e,t){var r=i[e];T(r.userComplete)&&r.userComplete(t),r.terminate(),delete i[e]}function y(){throw new Error("Not implemented.")}function _(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var r in e)t[r]=_(e[r]);return t}function E(e,t){return function(){e.apply(t,arguments)}}function T(e){return"function"==typeof e}return n&&(t.onmessage=function(e){var r=e.data;if(void 0===a.WORKER_ID&&r&&(a.WORKER_ID=r.workerId),"string"==typeof r.input)t.postMessage({workerId:a.WORKER_ID,results:a.parse(r.input,r.config),finished:!0});else if(t.File&&r.input instanceof File||r.input instanceof Object){var n=a.parse(r.input,r.config);n&&t.postMessage({workerId:a.WORKER_ID,results:n,finished:!0})}}),(d.prototype=Object.create(l.prototype)).constructor=d,(u.prototype=Object.create(l.prototype)).constructor=u,(c.prototype=Object.create(c.prototype)).constructor=c,(h.prototype=Object.create(l.prototype)).constructor=h,a},void 0===(i="function"===typeof r?r.apply(t,n):r)||(e.exports=i)},3573:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];function n(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=null;return t.forEach((function(e){if(null==i){var t=e.apply(void 0,r);null!=t&&(i=t)}})),i}return(0,o.default)(n)};var n,i=r(6054),o=(n=i)&&n.__esModule?n:{default:n};e.exports=t.default},6054:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(t,r,n,i,o,a){var s=i||"<<anonymous>>",l=a||n;if(null==r[n])return t?new Error("Required "+o+" `"+l+"` was not specified in `"+s+"`."):null;for(var d=arguments.length,u=Array(d>6?d-6:0),c=6;c<d;c++)u[c-6]=arguments[c];return e.apply(void 0,[r,n,s,o,l].concat(u))}var r=t.bind(null,!1);return r.isRequired=t.bind(null,!0),r},e.exports=t.default},888:function(e,t,r){"use strict";var n=r(9047);function i(){}function o(){}o.resetWarningCache=i,e.exports=function(){function e(e,t,r,i,o,a){if(a!==n){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:i};return r.PropTypes=r,r}},2007:function(e,t,r){e.exports=r(888)()},9047:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},8472:function(e,t,r){e.exports=r(3561)},8015:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(2791),a=(n=o)&&n.__esModule?n:{default:n},s=r(1509),l=r(8333);var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={},r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"buildURI",value:function(){return s.buildURI.apply(void 0,arguments)}},{key:"componentDidMount",value:function(){var e=this.props,t=e.data,r=e.headers,n=e.separator,i=e.enclosingCharacter,o=e.uFEFF,a=e.target,s=e.specs,l=e.replace;this.state.page=window.open(this.buildURI(t,o,r,n,i),a,s,l)}},{key:"getWindow",value:function(){return this.state.page}},{key:"render",value:function(){return null}}]),t}(a.default.Component);d.defaultProps=Object.assign(l.defaultProps,{target:"_blank"}),d.propTypes=l.propTypes,t.default=d},9088:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(2791),s=(n=a)&&n.__esModule?n:{default:n},l=r(1509),d=r(8333);var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.buildURI=r.buildURI.bind(r),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"buildURI",value:function(){return l.buildURI.apply(void 0,arguments)}},{key:"handleLegacy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(window.navigator.msSaveOrOpenBlob){e.preventDefault();var r=this.props,n=r.data,i=r.headers,o=r.separator,a=r.filename,s=r.enclosingCharacter,d=r.uFEFF,u=t&&"function"===typeof n?n():n,c=new Blob([d?"\ufeff":"",(0,l.toCSV)(u,i,o,s)]);return window.navigator.msSaveBlob(c,a),!1}}},{key:"handleAsyncClick",value:function(e){var t=this;this.props.onClick(e,(function(r){!1!==r?t.handleLegacy(e,!0):e.preventDefault()}))}},{key:"handleSyncClick",value:function(e){!1===this.props.onClick(e)?e.preventDefault():this.handleLegacy(e)}},{key:"handleClick",value:function(){var e=this;return function(t){if("function"===typeof e.props.onClick)return e.props.asyncOnClick?e.handleAsyncClick(t):e.handleSyncClick(t);e.handleLegacy(t)}}},{key:"render",value:function(){var e=this,t=this.props,r=t.data,n=t.headers,o=t.separator,a=t.filename,l=t.uFEFF,d=t.children,u=(t.onClick,t.asyncOnClick,t.enclosingCharacter),c=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(t,["data","headers","separator","filename","uFEFF","children","onClick","asyncOnClick","enclosingCharacter"]),h="undefined"===typeof window?"":this.buildURI(r,l,n,o,u);return s.default.createElement("a",i({download:a},c,{ref:function(t){return e.link=t},target:"_self",href:h,onClick:this.handleClick()}),d)}}]),t}(s.default.Component);u.defaultProps=d.defaultProps,u.propTypes=d.propTypes,t.default=u},1509:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var i=t.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},o=t.isJsons=function(e){return Array.isArray(e)&&e.every((function(e){return"object"===("undefined"===typeof e?"undefined":r(e))&&!(e instanceof Array)}))},a=t.isArrays=function(e){return Array.isArray(e)&&e.every((function(e){return Array.isArray(e)}))},s=t.jsonsHeaders=function(e){return Array.from(e.map((function(e){return Object.keys(e)})).reduce((function(e,t){return new Set([].concat(n(e),n(t)))}),[]))},l=t.jsons2arrays=function(e,t){var r=t=t||s(e),i=t;o(t)&&(r=t.map((function(e){return e.label})),i=t.map((function(e){return e.key})));var a=e.map((function(e){return i.map((function(t){return d(t,e)}))}));return[r].concat(n(a))},d=t.getHeaderValue=function(e,t){var r=e.replace(/\[([^\]]+)]/g,".$1").split(".").reduce((function(e,t,r,n){var i=e[t];if(void 0!==i&&null!==i)return i;n.splice(1)}),t);return void 0===r?e in t?t[e]:"":r},u=t.elementOrEmpty=function(e){return"undefined"===typeof e||null===e?"":e},c=t.joiner=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:'"';return e.filter((function(e){return e})).map((function(e){return e.map((function(e){return u(e)})).map((function(e){return""+r+e+r})).join(t)})).join("\n")},h=t.arrays2csv=function(e,t,r,i){return c(t?[t].concat(n(e)):e,r,i)},p=t.jsons2csv=function(e,t,r,n){return c(l(e,t),r,n)},g=t.string2csv=function(e,t,r,n){return t?t.join(r)+"\n"+e:e.replace(/"/g,'""')},f=t.toCSV=function(e,t,r,n){if(o(e))return p(e,t,r,n);if(a(e))return h(e,t,r,n);if("string"===typeof e)return g(e,t,r);throw new TypeError('Data should be a "String", "Array of arrays" OR "Array of objects" ')};t.buildURI=function(e,t,r,n,o){var a=f(e,r,n,o),s=i()?"application/csv":"text/csv",l=new Blob([t?"\ufeff":"",a],{type:s}),d="data:"+s+";charset=utf-8,"+(t?"\ufeff":"")+a,u=window.URL||window.webkitURL;return"undefined"===typeof u.createObjectURL?d:u.createObjectURL(l)}},3561:function(e,t,r){"use strict";t.CSVLink=void 0;var n=o(r(8015)),i=o(r(9088));function o(e){return e&&e.__esModule?e:{default:e}}n.default,t.CSVLink=i.default},8333:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PropsNotForwarded=t.defaultProps=t.propTypes=void 0;var n,i=r(2791),o=((n=i)&&n.__esModule,r(2007));t.propTypes={data:(0,o.oneOfType)([o.string,o.array,o.func]).isRequired,headers:o.array,target:o.string,separator:o.string,filename:o.string,uFEFF:o.bool,onClick:o.func,asyncOnClick:o.bool,enclosingCharacter:o.string},t.defaultProps={separator:",",filename:"generatedBy_react-csv.csv",uFEFF:!0,asyncOnClick:!1,enclosingCharacter:'"'},t.PropsNotForwarded=["data","headers"]},4463:function(e,t,r){"use strict";var n=r(2791),i=r(1725),o=r(5296);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!n)throw Error(a(227));var s=new Set,l={};function d(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(l[e]=t,e=0;e<t.length;e++)s.add(t[e])}var c=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p=Object.prototype.hasOwnProperty,g={},f={};function m(e,t,r,n,i,o,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var C={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){C[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];C[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){C[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){C[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){C[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){C[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){C[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){C[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){C[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function _(e){return e[1].toUpperCase()}function E(e,t,r,n){var i=C.hasOwnProperty(t)?C[t]:null;(null!==i?0===i.type:!n&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,r,n){if(null===t||"undefined"===typeof t||function(e,t,r,n){if(null!==r&&0===r.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==r?!r.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,r,n))return!0;if(n)return!1;if(null!==r)switch(r.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,r,i,n)&&(r=null),n||null===i?function(e){return!!p.call(f,e)||!p.call(g,e)&&(h.test(e)?f[e]=!0:(g[e]=!0,!1))}(t)&&(null===r?e.removeAttribute(t):e.setAttribute(t,""+r)):i.mustUseProperty?e[i.propertyName]=null===r?3!==i.type&&"":r:(t=i.attributeName,n=i.attributeNamespace,null===r?e.removeAttribute(t):(r=3===(i=i.type)||4===i&&!0===r?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,_);C[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,_);C[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,_);C[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){C[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),C.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){C[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var T=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,O=60103,v=60106,S=60107,b=60108,A=60114,I=60109,R=60110,D=60112,N=60113,P=60120,x=60115,M=60116,L=60121,w=60128,k=60129,B=60130,j=60131;if("function"===typeof Symbol&&Symbol.for){var U=Symbol.for;O=U("react.element"),v=U("react.portal"),S=U("react.fragment"),b=U("react.strict_mode"),A=U("react.profiler"),I=U("react.provider"),R=U("react.context"),D=U("react.forward_ref"),N=U("react.suspense"),P=U("react.suspense_list"),x=U("react.memo"),M=U("react.lazy"),L=U("react.block"),U("react.scope"),w=U("react.opaque.id"),k=U("react.debug_trace_mode"),B=U("react.offscreen"),j=U("react.legacy_hidden")}var F,W="function"===typeof Symbol&&Symbol.iterator;function V(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=W&&e[W]||e["@@iterator"])?e:null}function H(e){if(void 0===F)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);F=t&&t[1]||""}return"\n"+F+e}var G=!1;function z(e,t){if(!e||G)return"";G=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var n=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){n=l}e.call(t.prototype)}else{try{throw Error()}catch(l){n=l}e()}}catch(l){if(l&&n&&"string"===typeof l.stack){for(var i=l.stack.split("\n"),o=n.stack.split("\n"),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||i[a]!==o[s])return"\n"+i[a].replace(" at new "," at ")}while(1<=a&&0<=s);break}}}finally{G=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?H(e):""}function K(e){switch(e.tag){case 5:return H(e.type);case 16:return H("Lazy");case 13:return H("Suspense");case 19:return H("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 22:return e=z(e.type._render,!1);case 1:return e=z(e.type,!0);default:return""}}function Y(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case v:return"Portal";case A:return"Profiler";case b:return"StrictMode";case N:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case R:return(e.displayName||"Context")+".Consumer";case I:return(e._context.displayName||"Context")+".Provider";case D:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case x:return Y(e.type);case L:return Y(e._render);case M:t=e._payload,e=e._init;try{return Y(e(t))}catch(r){}}return null}function X(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function $(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=$(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof r&&"function"===typeof r.get&&"function"===typeof r.set){var i=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){n=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function J(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=$(e)?e.checked?"true":"false":e.value),(e=n)!==r&&(t.setValue(e),!0)}function Z(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var r=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=r?r:e._wrapperState.initialChecked})}function ee(e,t){var r=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;r=X(null!=t.value?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&E(e,"checked",t,!1)}function re(e,t){te(e,t);var r=X(t.value),n=t.type;if(null!=r)"number"===n?(0===r&&""===e.value||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?ie(e,t.type,r):t.hasOwnProperty("defaultValue")&&ie(e,t.type,X(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function ne(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}""!==(r=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==r&&(e.name=r)}function ie(e,t,r){"number"===t&&Z(e.ownerDocument)===e||(null==r?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}function oe(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return n.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function ae(e,t,r,n){if(e=e.options,t){t={};for(var i=0;i<r.length;i++)t["$"+r[i]]=!0;for(r=0;r<e.length;r++)i=t.hasOwnProperty("$"+e[r].value),e[r].selected!==i&&(e[r].selected=i),i&&n&&(e[r].defaultSelected=!0)}else{for(r=""+X(r),t=null,i=0;i<e.length;i++){if(e[i].value===r)return e[i].selected=!0,void(n&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function se(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function le(e,t){var r=t.value;if(null==r){if(r=t.children,t=t.defaultValue,null!=r){if(null!=t)throw Error(a(92));if(Array.isArray(r)){if(!(1>=r.length))throw Error(a(93));r=r[0]}t=r}null==t&&(t=""),r=t}e._wrapperState={initialValue:X(r)}}function de(e,t){var r=X(t.value),n=X(t.defaultValue);null!=r&&((r=""+r)!==e.value&&(e.value=r),null==t.defaultValue&&e.defaultValue!==r&&(e.defaultValue=r)),null!=n&&(e.defaultValue=""+n)}function ue(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var ce="http://www.w3.org/1999/xhtml",he="http://www.w3.org/2000/svg";function pe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ge(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?pe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var fe,me,Ce=(me=function(e,t){if(e.namespaceURI!==he||"innerHTML"in e)e.innerHTML=t;else{for((fe=fe||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=fe.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,r,n){MSApp.execUnsafeLocalFunction((function(){return me(e,t)}))}:me);function ye(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&3===r.nodeType)return void(r.nodeValue=t)}e.textContent=t}var _e={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ee=["Webkit","ms","Moz","O"];function Te(e,t,r){return null==t||"boolean"===typeof t||""===t?"":r||"number"!==typeof t||0===t||_e.hasOwnProperty(e)&&_e[e]?(""+t).trim():t+"px"}function Oe(e,t){for(var r in e=e.style,t)if(t.hasOwnProperty(r)){var n=0===r.indexOf("--"),i=Te(r,t[r],n);"float"===r&&(r="cssFloat"),n?e.setProperty(r,i):e[r]=i}}Object.keys(_e).forEach((function(e){Ee.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),_e[t]=_e[e]}))}));var ve=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Se(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Ae(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ie=null,Re=null,De=null;function Ne(e){if(e=ni(e)){if("function"!==typeof Ie)throw Error(a(280));var t=e.stateNode;t&&(t=oi(t),Ie(e.stateNode,e.type,t))}}function Pe(e){Re?De?De.push(e):De=[e]:Re=e}function xe(){if(Re){var e=Re,t=De;if(De=Re=null,Ne(e),t)for(e=0;e<t.length;e++)Ne(t[e])}}function Me(e,t){return e(t)}function Le(e,t,r,n,i){return e(t,r,n,i)}function we(){}var ke=Me,Be=!1,je=!1;function Ue(){null===Re&&null===De||(we(),xe())}function Fe(e,t){var r=e.stateNode;if(null===r)return null;var n=oi(r);if(null===n)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(r&&"function"!==typeof r)throw Error(a(231,t,typeof r));return r}var We=!1;if(c)try{var Ve={};Object.defineProperty(Ve,"passive",{get:function(){We=!0}}),window.addEventListener("test",Ve,Ve),window.removeEventListener("test",Ve,Ve)}catch(me){We=!1}function He(e,t,r,n,i,o,a,s,l){var d=Array.prototype.slice.call(arguments,3);try{t.apply(r,d)}catch(u){this.onError(u)}}var Ge=!1,ze=null,Ke=!1,Ye=null,Xe={onError:function(e){Ge=!0,ze=e}};function $e(e,t,r,n,i,o,a,s,l){Ge=!1,ze=null,He.apply(Xe,arguments)}function qe(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).flags)&&(r=t.return),e=t.return}while(e)}return 3===t.tag?r:null}function Je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ze(e){if(qe(e)!==e)throw Error(a(188))}function Qe(e){if(e=function(e){var t=e.alternate;if(!t){if(null===(t=qe(e)))throw Error(a(188));return t!==e?null:e}for(var r=e,n=t;;){var i=r.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(n=i.return)){r=n;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===r)return Ze(i),e;if(o===n)return Ze(i),t;o=o.sibling}throw Error(a(188))}if(r.return!==n.return)r=i,n=o;else{for(var s=!1,l=i.child;l;){if(l===r){s=!0,r=i,n=o;break}if(l===n){s=!0,n=i,r=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===r){s=!0,r=o,n=i;break}if(l===n){s=!0,n=o,r=i;break}l=l.sibling}if(!s)throw Error(a(189))}}if(r.alternate!==n)throw Error(a(190))}if(3!==r.tag)throw Error(a(188));return r.stateNode.current===r?e:t}(e),!e)return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function et(e,t){for(var r=e.alternate;null!==t;){if(t===e||t===r)return!0;t=t.return}return!1}var tt,rt,nt,it,ot=!1,at=[],st=null,lt=null,dt=null,ut=new Map,ct=new Map,ht=[],pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function gt(e,t,r,n,i){return{blockedOn:e,domEventName:t,eventSystemFlags:16|r,nativeEvent:i,targetContainers:[n]}}function ft(e,t){switch(e){case"focusin":case"focusout":st=null;break;case"dragenter":case"dragleave":lt=null;break;case"mouseover":case"mouseout":dt=null;break;case"pointerover":case"pointerout":ut.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ct.delete(t.pointerId)}}function mt(e,t,r,n,i,o){return null===e||e.nativeEvent!==o?(e=gt(t,r,n,i,o),null!==t&&(null!==(t=ni(t))&&rt(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Ct(e){var t=ri(e.target);if(null!==t){var r=qe(t);if(null!==r)if(13===(t=r.tag)){if(null!==(t=Je(r)))return e.blockedOn=t,void it(e.lanePriority,(function(){o.unstable_runWithPriority(e.priority,(function(){nt(r)}))}))}else if(3===t&&r.stateNode.hydrate)return void(e.blockedOn=3===r.tag?r.stateNode.containerInfo:null)}e.blockedOn=null}function yt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var r=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==r)return null!==(t=ni(r))&&rt(t),e.blockedOn=r,!1;t.shift()}return!0}function _t(e,t,r){yt(e)&&r.delete(t)}function Et(){for(ot=!1;0<at.length;){var e=at[0];if(null!==e.blockedOn){null!==(e=ni(e.blockedOn))&&tt(e);break}for(var t=e.targetContainers;0<t.length;){var r=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==r){e.blockedOn=r;break}t.shift()}null===e.blockedOn&&at.shift()}null!==st&&yt(st)&&(st=null),null!==lt&&yt(lt)&&(lt=null),null!==dt&&yt(dt)&&(dt=null),ut.forEach(_t),ct.forEach(_t)}function Tt(e,t){e.blockedOn===t&&(e.blockedOn=null,ot||(ot=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Et)))}function Ot(e){function t(t){return Tt(t,e)}if(0<at.length){Tt(at[0],e);for(var r=1;r<at.length;r++){var n=at[r];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==st&&Tt(st,e),null!==lt&&Tt(lt,e),null!==dt&&Tt(dt,e),ut.forEach(t),ct.forEach(t),r=0;r<ht.length;r++)(n=ht[r]).blockedOn===e&&(n.blockedOn=null);for(;0<ht.length&&null===(r=ht[0]).blockedOn;)Ct(r),null===r.blockedOn&&ht.shift()}function vt(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var St={animationend:vt("Animation","AnimationEnd"),animationiteration:vt("Animation","AnimationIteration"),animationstart:vt("Animation","AnimationStart"),transitionend:vt("Transition","TransitionEnd")},bt={},At={};function It(e){if(bt[e])return bt[e];if(!St[e])return e;var t,r=St[e];for(t in r)if(r.hasOwnProperty(t)&&t in At)return bt[e]=r[t];return e}c&&(At=document.createElement("div").style,"AnimationEvent"in window||(delete St.animationend.animation,delete St.animationiteration.animation,delete St.animationstart.animation),"TransitionEvent"in window||delete St.transitionend.transition);var Rt=It("animationend"),Dt=It("animationiteration"),Nt=It("animationstart"),Pt=It("transitionend"),xt=new Map,Mt=new Map,Lt=["abort","abort",Rt,"animationEnd",Dt,"animationIteration",Nt,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Pt,"transitionEnd","waiting","waiting"];function wt(e,t){for(var r=0;r<e.length;r+=2){var n=e[r],i=e[r+1];i="on"+(i[0].toUpperCase()+i.slice(1)),Mt.set(n,t),xt.set(n,i),d(i,[n])}}(0,o.unstable_now)();var kt=8;function Bt(e){if(0!==(1&e))return kt=15,1;if(0!==(2&e))return kt=14,2;if(0!==(4&e))return kt=13,4;var t=24&e;return 0!==t?(kt=12,t):0!==(32&e)?(kt=11,32):0!==(t=192&e)?(kt=10,t):0!==(256&e)?(kt=9,256):0!==(t=3584&e)?(kt=8,t):0!==(4096&e)?(kt=7,4096):0!==(t=4186112&e)?(kt=6,t):0!==(t=62914560&e)?(kt=5,t):67108864&e?(kt=4,67108864):0!==(134217728&e)?(kt=3,134217728):0!==(t=805306368&e)?(kt=2,t):0!==(1073741824&e)?(kt=1,1073741824):(kt=8,e)}function jt(e,t){var r=e.pendingLanes;if(0===r)return kt=0;var n=0,i=0,o=e.expiredLanes,a=e.suspendedLanes,s=e.pingedLanes;if(0!==o)n=o,i=kt=15;else if(0!==(o=134217727&r)){var l=o&~a;0!==l?(n=Bt(l),i=kt):0!==(s&=o)&&(n=Bt(s),i=kt)}else 0!==(o=r&~a)?(n=Bt(o),i=kt):0!==s&&(n=Bt(s),i=kt);if(0===n)return 0;if(n=r&((0>(n=31-Gt(n))?0:1<<n)<<1)-1,0!==t&&t!==n&&0===(t&a)){if(Bt(t),i<=kt)return t;kt=i}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)i=1<<(r=31-Gt(t)),n|=e[r],t&=~i;return n}function Ut(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Ft(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=Wt(24&~t))?Ft(10,t):e;case 10:return 0===(e=Wt(192&~t))?Ft(8,t):e;case 8:return 0===(e=Wt(3584&~t))&&(0===(e=Wt(4186112&~t))&&(e=512)),e;case 2:return 0===(t=Wt(805306368&~t))&&(t=268435456),t}throw Error(a(358,e))}function Wt(e){return e&-e}function Vt(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Ht(e,t,r){e.pendingLanes|=t;var n=t-1;e.suspendedLanes&=n,e.pingedLanes&=n,(e=e.eventTimes)[t=31-Gt(t)]=r}var Gt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(zt(e)/Kt|0)|0},zt=Math.log,Kt=Math.LN2;var Yt=o.unstable_UserBlockingPriority,Xt=o.unstable_runWithPriority,$t=!0;function qt(e,t,r,n){Be||we();var i=Zt,o=Be;Be=!0;try{Le(i,e,t,r,n)}finally{(Be=o)||Ue()}}function Jt(e,t,r,n){Xt(Yt,Zt.bind(null,e,t,r,n))}function Zt(e,t,r,n){var i;if($t)if((i=0===(4&t))&&0<at.length&&-1<pt.indexOf(e))e=gt(null,e,t,r,n),at.push(e);else{var o=Qt(e,t,r,n);if(null===o)i&&ft(e,n);else{if(i){if(-1<pt.indexOf(e))return e=gt(o,e,t,r,n),void at.push(e);if(function(e,t,r,n,i){switch(t){case"focusin":return st=mt(st,e,t,r,n,i),!0;case"dragenter":return lt=mt(lt,e,t,r,n,i),!0;case"mouseover":return dt=mt(dt,e,t,r,n,i),!0;case"pointerover":var o=i.pointerId;return ut.set(o,mt(ut.get(o)||null,e,t,r,n,i)),!0;case"gotpointercapture":return o=i.pointerId,ct.set(o,mt(ct.get(o)||null,e,t,r,n,i)),!0}return!1}(o,e,t,r,n))return;ft(e,n)}wn(e,t,n,null,r)}}}function Qt(e,t,r,n){var i=Ae(n);if(null!==(i=ri(i))){var o=qe(i);if(null===o)i=null;else{var a=o.tag;if(13===a){if(null!==(i=Je(o)))return i;i=null}else if(3===a){if(o.stateNode.hydrate)return 3===o.tag?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null)}}return wn(e,t,n,i,r),null}var er=null,tr=null,rr=null;function nr(){if(rr)return rr;var e,t,r=tr,n=r.length,i="value"in er?er.value:er.textContent,o=i.length;for(e=0;e<n&&r[e]===i[e];e++);var a=n-e;for(t=1;t<=a&&r[n-t]===i[o-t];t++);return rr=i.slice(e,1<t?1-t:void 0)}function ir(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function or(){return!0}function ar(){return!1}function sr(e){function t(t,r,n,i,o){for(var a in this._reactName=t,this._targetInst=n,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?or:ar,this.isPropagationStopped=ar,this}return i(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=or)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=or)},persist:function(){},isPersistent:or}),t}var lr,dr,ur,cr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hr=sr(cr),pr=i({},cr,{view:0,detail:0}),gr=sr(pr),fr=i({},pr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ir,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ur&&(ur&&"mousemove"===e.type?(lr=e.screenX-ur.screenX,dr=e.screenY-ur.screenY):dr=lr=0,ur=e),lr)},movementY:function(e){return"movementY"in e?e.movementY:dr}}),mr=sr(fr),Cr=sr(i({},fr,{dataTransfer:0})),yr=sr(i({},pr,{relatedTarget:0})),_r=sr(i({},cr,{animationName:0,elapsedTime:0,pseudoElement:0})),Er=i({},cr,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Tr=sr(Er),Or=sr(i({},cr,{data:0})),vr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},br={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ar(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=br[e])&&!!t[e]}function Ir(){return Ar}var Rr=i({},pr,{key:function(e){if(e.key){var t=vr[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ir(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sr[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ir,charCode:function(e){return"keypress"===e.type?ir(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ir(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Dr=sr(Rr),Nr=sr(i({},fr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pr=sr(i({},pr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ir})),xr=sr(i({},cr,{propertyName:0,elapsedTime:0,pseudoElement:0})),Mr=i({},fr,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Lr=sr(Mr),wr=[9,13,27,32],kr=c&&"CompositionEvent"in window,Br=null;c&&"documentMode"in document&&(Br=document.documentMode);var jr=c&&"TextEvent"in window&&!Br,Ur=c&&(!kr||Br&&8<Br&&11>=Br),Fr=String.fromCharCode(32),Wr=!1;function Vr(e,t){switch(e){case"keyup":return-1!==wr.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hr(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Gr=!1;var zr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Kr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!zr[e.type]:"textarea"===t}function Yr(e,t,r,n){Pe(n),0<(t=Bn(t,"onChange")).length&&(r=new hr("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var Xr=null,$r=null;function qr(e){Dn(e,0)}function Jr(e){if(J(ii(e)))return e}function Zr(e,t){if("change"===e)return t}var Qr=!1;if(c){var en;if(c){var tn="oninput"in document;if(!tn){var rn=document.createElement("div");rn.setAttribute("oninput","return;"),tn="function"===typeof rn.oninput}en=tn}else en=!1;Qr=en&&(!document.documentMode||9<document.documentMode)}function nn(){Xr&&(Xr.detachEvent("onpropertychange",on),$r=Xr=null)}function on(e){if("value"===e.propertyName&&Jr($r)){var t=[];if(Yr(t,$r,e,Ae(e)),e=qr,Be)e(t);else{Be=!0;try{Me(e,t)}finally{Be=!1,Ue()}}}}function an(e,t,r){"focusin"===e?(nn(),$r=r,(Xr=t).attachEvent("onpropertychange",on)):"focusout"===e&&nn()}function sn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Jr($r)}function ln(e,t){if("click"===e)return Jr(t)}function dn(e,t){if("input"===e||"change"===e)return Jr(t)}var un="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},cn=Object.prototype.hasOwnProperty;function hn(e,t){if(un(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++)if(!cn.call(t,r[n])||!un(e[r[n]],t[r[n]]))return!1;return!0}function pn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function gn(e,t){var r,n=pn(e);for(e=0;n;){if(3===n.nodeType){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=pn(n)}}function fn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?fn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function mn(){for(var e=window,t=Z();t instanceof e.HTMLIFrameElement;){try{var r="string"===typeof t.contentWindow.location.href}catch(n){r=!1}if(!r)break;t=Z((e=t.contentWindow).document)}return t}function Cn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var yn=c&&"documentMode"in document&&11>=document.documentMode,_n=null,En=null,Tn=null,On=!1;function vn(e,t,r){var n=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;On||null==_n||_n!==Z(n)||("selectionStart"in(n=_n)&&Cn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Tn&&hn(Tn,n)||(Tn=n,0<(n=Bn(En,"onSelect")).length&&(t=new hr("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=_n)))}wt("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),wt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),wt(Lt,2);for(var Sn="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),bn=0;bn<Sn.length;bn++)Mt.set(Sn[bn],0);u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var An="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),In=new Set("cancel close invalid load scroll toggle".split(" ").concat(An));function Rn(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,function(e,t,r,n,i,o,s,l,d){if($e.apply(this,arguments),Ge){if(!Ge)throw Error(a(198));var u=ze;Ge=!1,ze=null,Ke||(Ke=!0,Ye=u)}}(n,t,void 0,e),e.currentTarget=null}function Dn(e,t){t=0!==(4&t);for(var r=0;r<e.length;r++){var n=e[r],i=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var a=n.length-1;0<=a;a--){var s=n[a],l=s.instance,d=s.currentTarget;if(s=s.listener,l!==o&&i.isPropagationStopped())break e;Rn(i,s,d),o=l}else for(a=0;a<n.length;a++){if(l=(s=n[a]).instance,d=s.currentTarget,s=s.listener,l!==o&&i.isPropagationStopped())break e;Rn(i,s,d),o=l}}}if(Ke)throw e=Ye,Ke=!1,Ye=null,e}function Nn(e,t){var r=ai(t),n=e+"__bubble";r.has(n)||(Ln(t,e,2,!1),r.add(n))}var Pn="_reactListening"+Math.random().toString(36).slice(2);function xn(e){e[Pn]||(e[Pn]=!0,s.forEach((function(t){In.has(t)||Mn(t,!1,e,null),Mn(t,!0,e,null)})))}function Mn(e,t,r,n){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=r;if("selectionchange"===e&&9!==r.nodeType&&(o=r.ownerDocument),null!==n&&!t&&In.has(e)){if("scroll"!==e)return;i|=2,o=n}var a=ai(o),s=e+"__"+(t?"capture":"bubble");a.has(s)||(t&&(i|=4),Ln(o,e,i,t),a.add(s))}function Ln(e,t,r,n){var i=Mt.get(t);switch(void 0===i?2:i){case 0:i=qt;break;case 1:i=Jt;break;default:i=Zt}r=i.bind(null,t,r,e),i=void 0,!We||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),n?void 0!==i?e.addEventListener(t,r,{capture:!0,passive:i}):e.addEventListener(t,r,!0):void 0!==i?e.addEventListener(t,r,{passive:i}):e.addEventListener(t,r,!1)}function wn(e,t,r,n,i){var o=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var a=n.tag;if(3===a||4===a){var s=n.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===a)for(a=n.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;a=a.return}for(;null!==s;){if(null===(a=ri(s)))return;if(5===(l=a.tag)||6===l){n=o=a;continue e}s=s.parentNode}}n=n.return}!function(e,t,r){if(je)return e(t,r);je=!0;try{ke(e,t,r)}finally{je=!1,Ue()}}((function(){var n=o,i=Ae(r),a=[];e:{var s=xt.get(e);if(void 0!==s){var l=hr,d=e;switch(e){case"keypress":if(0===ir(r))break e;case"keydown":case"keyup":l=Dr;break;case"focusin":d="focus",l=yr;break;case"focusout":d="blur",l=yr;break;case"beforeblur":case"afterblur":l=yr;break;case"click":if(2===r.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=mr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=Cr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pr;break;case Rt:case Dt:case Nt:l=_r;break;case Pt:l=xr;break;case"scroll":l=gr;break;case"wheel":l=Lr;break;case"copy":case"cut":case"paste":l=Tr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Nr}var u=0!==(4&t),c=!u&&"scroll"===e,h=u?null!==s?s+"Capture":null:s;u=[];for(var p,g=n;null!==g;){var f=(p=g).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==h&&(null!=(f=Fe(g,h))&&u.push(kn(g,f,p)))),c)break;g=g.return}0<u.length&&(s=new l(s,d,null,r,i),a.push({event:s,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||0!==(16&t)||!(d=r.relatedTarget||r.fromElement)||!ri(d)&&!d[ei])&&(l||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=n,null!==(d=(d=r.relatedTarget||r.toElement)?ri(d):null)&&(d!==(c=qe(d))||5!==d.tag&&6!==d.tag)&&(d=null)):(l=null,d=n),l!==d)){if(u=mr,f="onMouseLeave",h="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(u=Nr,f="onPointerLeave",h="onPointerEnter",g="pointer"),c=null==l?s:ii(l),p=null==d?s:ii(d),(s=new u(f,g+"leave",l,r,i)).target=c,s.relatedTarget=p,f=null,ri(i)===n&&((u=new u(h,g+"enter",d,r,i)).target=p,u.relatedTarget=c,f=u),c=f,l&&d)e:{for(h=d,g=0,p=u=l;p;p=jn(p))g++;for(p=0,f=h;f;f=jn(f))p++;for(;0<g-p;)u=jn(u),g--;for(;0<p-g;)h=jn(h),p--;for(;g--;){if(u===h||null!==h&&u===h.alternate)break e;u=jn(u),h=jn(h)}u=null}else u=null;null!==l&&Un(a,s,l,u,!1),null!==d&&null!==c&&Un(a,c,d,u,!0)}if("select"===(l=(s=n?ii(n):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var m=Zr;else if(Kr(s))if(Qr)m=dn;else{m=sn;var C=an}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=ln);switch(m&&(m=m(e,n))?Yr(a,m,r,i):(C&&C(e,s,n),"focusout"===e&&(C=s._wrapperState)&&C.controlled&&"number"===s.type&&ie(s,"number",s.value)),C=n?ii(n):window,e){case"focusin":(Kr(C)||"true"===C.contentEditable)&&(_n=C,En=n,Tn=null);break;case"focusout":Tn=En=_n=null;break;case"mousedown":On=!0;break;case"contextmenu":case"mouseup":case"dragend":On=!1,vn(a,r,i);break;case"selectionchange":if(yn)break;case"keydown":case"keyup":vn(a,r,i)}var y;if(kr)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Gr?Vr(e,r)&&(_="onCompositionEnd"):"keydown"===e&&229===r.keyCode&&(_="onCompositionStart");_&&(Ur&&"ko"!==r.locale&&(Gr||"onCompositionStart"!==_?"onCompositionEnd"===_&&Gr&&(y=nr()):(tr="value"in(er=i)?er.value:er.textContent,Gr=!0)),0<(C=Bn(n,_)).length&&(_=new Or(_,e,null,r,i),a.push({event:_,listeners:C}),y?_.data=y:null!==(y=Hr(r))&&(_.data=y))),(y=jr?function(e,t){switch(e){case"compositionend":return Hr(t);case"keypress":return 32!==t.which?null:(Wr=!0,Fr);case"textInput":return(e=t.data)===Fr&&Wr?null:e;default:return null}}(e,r):function(e,t){if(Gr)return"compositionend"===e||!kr&&Vr(e,t)?(e=nr(),rr=tr=er=null,Gr=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ur&&"ko"!==t.locale?null:t.data}}(e,r))&&(0<(n=Bn(n,"onBeforeInput")).length&&(i=new Or("onBeforeInput","beforeinput",null,r,i),a.push({event:i,listeners:n}),i.data=y))}Dn(a,t)}))}function kn(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Bn(e,t){for(var r=t+"Capture",n=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=Fe(e,r))&&n.unshift(kn(e,o,i)),null!=(o=Fe(e,t))&&n.push(kn(e,o,i))),e=e.return}return n}function jn(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Un(e,t,r,n,i){for(var o=t._reactName,a=[];null!==r&&r!==n;){var s=r,l=s.alternate,d=s.stateNode;if(null!==l&&l===n)break;5===s.tag&&null!==d&&(s=d,i?null!=(l=Fe(r,o))&&a.unshift(kn(r,l,s)):i||null!=(l=Fe(r,o))&&a.push(kn(r,l,s))),r=r.return}0!==a.length&&e.push({event:t,listeners:a})}function Fn(){}var Wn=null,Vn=null;function Hn(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Gn(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var zn="function"===typeof setTimeout?setTimeout:void 0,Kn="function"===typeof clearTimeout?clearTimeout:void 0;function Yn(e){1===e.nodeType?e.textContent="":9===e.nodeType&&(null!=(e=e.body)&&(e.textContent=""))}function Xn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function $n(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var r=e.data;if("$"===r||"$!"===r||"$?"===r){if(0===t)return e;t--}else"/$"===r&&t++}e=e.previousSibling}return null}var qn=0;var Jn=Math.random().toString(36).slice(2),Zn="__reactFiber$"+Jn,Qn="__reactProps$"+Jn,ei="__reactContainer$"+Jn,ti="__reactEvents$"+Jn;function ri(e){var t=e[Zn];if(t)return t;for(var r=e.parentNode;r;){if(t=r[ei]||r[Zn]){if(r=t.alternate,null!==t.child||null!==r&&null!==r.child)for(e=$n(e);null!==e;){if(r=e[Zn])return r;e=$n(e)}return t}r=(e=r).parentNode}return null}function ni(e){return!(e=e[Zn]||e[ei])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ii(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function oi(e){return e[Qn]||null}function ai(e){var t=e[ti];return void 0===t&&(t=e[ti]=new Set),t}var si=[],li=-1;function di(e){return{current:e}}function ui(e){0>li||(e.current=si[li],si[li]=null,li--)}function ci(e,t){li++,si[li]=e.current,e.current=t}var hi={},pi=di(hi),gi=di(!1),fi=hi;function mi(e,t){var r=e.type.contextTypes;if(!r)return hi;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in r)o[i]=t[i];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Ci(e){return null!==(e=e.childContextTypes)&&void 0!==e}function yi(){ui(gi),ui(pi)}function _i(e,t,r){if(pi.current!==hi)throw Error(a(168));ci(pi,t),ci(gi,r)}function Ei(e,t,r){var n=e.stateNode;if(e=t.childContextTypes,"function"!==typeof n.getChildContext)return r;for(var o in n=n.getChildContext())if(!(o in e))throw Error(a(108,Y(t)||"Unknown",o));return i({},r,n)}function Ti(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||hi,fi=pi.current,ci(pi,e),ci(gi,gi.current),!0}function Oi(e,t,r){var n=e.stateNode;if(!n)throw Error(a(169));r?(e=Ei(e,t,fi),n.__reactInternalMemoizedMergedChildContext=e,ui(gi),ui(pi),ci(pi,e)):ui(gi),ci(gi,r)}var vi=null,Si=null,bi=o.unstable_runWithPriority,Ai=o.unstable_scheduleCallback,Ii=o.unstable_cancelCallback,Ri=o.unstable_shouldYield,Di=o.unstable_requestPaint,Ni=o.unstable_now,Pi=o.unstable_getCurrentPriorityLevel,xi=o.unstable_ImmediatePriority,Mi=o.unstable_UserBlockingPriority,Li=o.unstable_NormalPriority,wi=o.unstable_LowPriority,ki=o.unstable_IdlePriority,Bi={},ji=void 0!==Di?Di:function(){},Ui=null,Fi=null,Wi=!1,Vi=Ni(),Hi=1e4>Vi?Ni:function(){return Ni()-Vi};function Gi(){switch(Pi()){case xi:return 99;case Mi:return 98;case Li:return 97;case wi:return 96;case ki:return 95;default:throw Error(a(332))}}function zi(e){switch(e){case 99:return xi;case 98:return Mi;case 97:return Li;case 96:return wi;case 95:return ki;default:throw Error(a(332))}}function Ki(e,t){return e=zi(e),bi(e,t)}function Yi(e,t,r){return e=zi(e),Ai(e,t,r)}function Xi(){if(null!==Fi){var e=Fi;Fi=null,Ii(e)}$i()}function $i(){if(!Wi&&null!==Ui){Wi=!0;var e=0;try{var t=Ui;Ki(99,(function(){for(;e<t.length;e++){var r=t[e];do{r=r(!0)}while(null!==r)}})),Ui=null}catch(r){throw null!==Ui&&(Ui=Ui.slice(e+1)),Ai(xi,Xi),r}finally{Wi=!1}}}var qi=T.ReactCurrentBatchConfig;function Ji(e,t){if(e&&e.defaultProps){for(var r in t=i({},t),e=e.defaultProps)void 0===t[r]&&(t[r]=e[r]);return t}return t}var Zi=di(null),Qi=null,eo=null,to=null;function ro(){to=eo=Qi=null}function no(e){var t=Zi.current;ui(Zi),e.type._context._currentValue=t}function io(e,t){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)===t){if(null===r||(r.childLanes&t)===t)break;r.childLanes|=t}else e.childLanes|=t,null!==r&&(r.childLanes|=t);e=e.return}}function oo(e,t){Qi=e,to=eo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Ba=!0),e.firstContext=null)}function ao(e,t){if(to!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(to=e,t=1073741823),t={context:e,observedBits:t,next:null},null===eo){if(null===Qi)throw Error(a(308));eo=t,Qi.dependencies={lanes:0,firstContext:t,responders:null}}else eo=eo.next=t;return e._currentValue}var so=!1;function lo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function uo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function co(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ho(e,t){if(null!==(e=e.updateQueue)){var r=(e=e.shared).pending;null===r?t.next=t:(t.next=r.next,r.next=t),e.pending=t}}function po(e,t){var r=e.updateQueue,n=e.alternate;if(null!==n&&r===(n=n.updateQueue)){var i=null,o=null;if(null!==(r=r.firstBaseUpdate)){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};null===o?i=o=a:o=o.next=a,r=r.next}while(null!==r);null===o?i=o=t:o=o.next=t}else i=o=t;return r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:n.shared,effects:n.effects},void(e.updateQueue=r)}null===(e=r.lastBaseUpdate)?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function go(e,t,r,n){var o=e.updateQueue;so=!1;var a=o.firstBaseUpdate,s=o.lastBaseUpdate,l=o.shared.pending;if(null!==l){o.shared.pending=null;var d=l,u=d.next;d.next=null,null===s?a=u:s.next=u,s=d;var c=e.alternate;if(null!==c){var h=(c=c.updateQueue).lastBaseUpdate;h!==s&&(null===h?c.firstBaseUpdate=u:h.next=u,c.lastBaseUpdate=d)}}if(null!==a){for(h=o.baseState,s=0,c=u=d=null;;){l=a.lane;var p=a.eventTime;if((n&l)===l){null!==c&&(c=c.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=e,f=a;switch(l=t,p=r,f.tag){case 1:if("function"===typeof(g=f.payload)){h=g.call(p,h,l);break e}h=g;break e;case 3:g.flags=-4097&g.flags|64;case 0:if(null===(l="function"===typeof(g=f.payload)?g.call(p,h,l):g)||void 0===l)break e;h=i({},h,l);break e;case 2:so=!0}}null!==a.callback&&(e.flags|=32,null===(l=o.effects)?o.effects=[a]:l.push(a))}else p={eventTime:p,lane:l,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===c?(u=c=p,d=h):c=c.next=p,s|=l;if(null===(a=a.next)){if(null===(l=o.shared.pending))break;a=l.next,l.next=null,o.lastBaseUpdate=l,o.shared.pending=null}}null===c&&(d=h),o.baseState=d,o.firstBaseUpdate=u,o.lastBaseUpdate=c,Ws|=s,e.lanes=s,e.memoizedState=h}}function fo(e,t,r){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],i=n.callback;if(null!==i){if(n.callback=null,n=r,"function"!==typeof i)throw Error(a(191,i));i.call(n)}}}var mo=(new n.Component).refs;function Co(e,t,r,n){r=null===(r=r(n,t=e.memoizedState))||void 0===r?t:i({},t,r),e.memoizedState=r,0===e.lanes&&(e.updateQueue.baseState=r)}var yo={isMounted:function(e){return!!(e=e._reactInternals)&&qe(e)===e},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=hl(),i=pl(e),o=co(n,i);o.payload=t,void 0!==r&&null!==r&&(o.callback=r),ho(e,o),gl(e,i,n)},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=hl(),i=pl(e),o=co(n,i);o.tag=1,o.payload=t,void 0!==r&&null!==r&&(o.callback=r),ho(e,o),gl(e,i,n)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=hl(),n=pl(e),i=co(r,n);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),ho(e,i),gl(e,n,r)}};function _o(e,t,r,n,i,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!hn(r,n)||!hn(i,o))}function Eo(e,t,r){var n=!1,i=hi,o=t.contextType;return"object"===typeof o&&null!==o?o=ao(o):(i=Ci(t)?fi:pi.current,o=(n=null!==(n=t.contextTypes)&&void 0!==n)?mi(e,i):hi),t=new t(r,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=yo,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function To(e,t,r,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&yo.enqueueReplaceState(t,t.state,null)}function Oo(e,t,r,n){var i=e.stateNode;i.props=r,i.state=e.memoizedState,i.refs=mo,lo(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=ao(o):(o=Ci(t)?fi:pi.current,i.context=mi(e,o)),go(e,r,i,n),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(Co(e,t,o,r),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&yo.enqueueReplaceState(i,i.state,null),go(e,r,i,n),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4)}var vo=Array.isArray;function So(e,t,r){if(null!==(e=r.ref)&&"function"!==typeof e&&"object"!==typeof e){if(r._owner){if(r=r._owner){if(1!==r.tag)throw Error(a(309));var n=r.stateNode}if(!n)throw Error(a(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=n.refs;t===mo&&(t=n.refs={}),null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!==typeof e)throw Error(a(284));if(!r._owner)throw Error(a(290,e))}return e}function bo(e,t){if("textarea"!==e.type)throw Error(a(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function Ao(e){function t(t,r){if(e){var n=t.lastEffect;null!==n?(n.nextEffect=r,t.lastEffect=r):t.firstEffect=t.lastEffect=r,r.nextEffect=null,r.flags=8}}function r(r,n){if(!e)return null;for(;null!==n;)t(r,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Kl(e,t)).index=0,e.sibling=null,e}function o(t,r,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<r?(t.flags=2,r):n:(t.flags=2,r):r}function s(t){return e&&null===t.alternate&&(t.flags=2),t}function l(e,t,r,n){return null===t||6!==t.tag?((t=ql(r,e.mode,n)).return=e,t):((t=i(t,r)).return=e,t)}function d(e,t,r,n){return null!==t&&t.elementType===r.type?((n=i(t,r.props)).ref=So(e,t,r),n.return=e,n):((n=Yl(r.type,r.key,r.props,null,e.mode,n)).ref=So(e,t,r),n.return=e,n)}function u(e,t,r,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?((t=Jl(r,e.mode,n)).return=e,t):((t=i(t,r.children||[])).return=e,t)}function c(e,t,r,n,o){return null===t||7!==t.tag?((t=Xl(r,e.mode,n,o)).return=e,t):((t=i(t,r)).return=e,t)}function h(e,t,r){if("string"===typeof t||"number"===typeof t)return(t=ql(""+t,e.mode,r)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case O:return(r=Yl(t.type,t.key,t.props,null,e.mode,r)).ref=So(e,null,t),r.return=e,r;case v:return(t=Jl(t,e.mode,r)).return=e,t}if(vo(t)||V(t))return(t=Xl(t,e.mode,r,null)).return=e,t;bo(e,t)}return null}function p(e,t,r,n){var i=null!==t?t.key:null;if("string"===typeof r||"number"===typeof r)return null!==i?null:l(e,t,""+r,n);if("object"===typeof r&&null!==r){switch(r.$$typeof){case O:return r.key===i?r.type===S?c(e,t,r.props.children,n,i):d(e,t,r,n):null;case v:return r.key===i?u(e,t,r,n):null}if(vo(r)||V(r))return null!==i?null:c(e,t,r,n,null);bo(e,r)}return null}function g(e,t,r,n,i){if("string"===typeof n||"number"===typeof n)return l(t,e=e.get(r)||null,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case O:return e=e.get(null===n.key?r:n.key)||null,n.type===S?c(t,e,n.props.children,i,n.key):d(t,e,n,i);case v:return u(t,e=e.get(null===n.key?r:n.key)||null,n,i)}if(vo(n)||V(n))return c(t,e=e.get(r)||null,n,i,null);bo(t,n)}return null}function f(i,a,s,l){for(var d=null,u=null,c=a,f=a=0,m=null;null!==c&&f<s.length;f++){c.index>f?(m=c,c=null):m=c.sibling;var C=p(i,c,s[f],l);if(null===C){null===c&&(c=m);break}e&&c&&null===C.alternate&&t(i,c),a=o(C,a,f),null===u?d=C:u.sibling=C,u=C,c=m}if(f===s.length)return r(i,c),d;if(null===c){for(;f<s.length;f++)null!==(c=h(i,s[f],l))&&(a=o(c,a,f),null===u?d=c:u.sibling=c,u=c);return d}for(c=n(i,c);f<s.length;f++)null!==(m=g(c,i,f,s[f],l))&&(e&&null!==m.alternate&&c.delete(null===m.key?f:m.key),a=o(m,a,f),null===u?d=m:u.sibling=m,u=m);return e&&c.forEach((function(e){return t(i,e)})),d}function m(i,s,l,d){var u=V(l);if("function"!==typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var c=u=null,f=s,m=s=0,C=null,y=l.next();null!==f&&!y.done;m++,y=l.next()){f.index>m?(C=f,f=null):C=f.sibling;var _=p(i,f,y.value,d);if(null===_){null===f&&(f=C);break}e&&f&&null===_.alternate&&t(i,f),s=o(_,s,m),null===c?u=_:c.sibling=_,c=_,f=C}if(y.done)return r(i,f),u;if(null===f){for(;!y.done;m++,y=l.next())null!==(y=h(i,y.value,d))&&(s=o(y,s,m),null===c?u=y:c.sibling=y,c=y);return u}for(f=n(i,f);!y.done;m++,y=l.next())null!==(y=g(f,i,m,y.value,d))&&(e&&null!==y.alternate&&f.delete(null===y.key?m:y.key),s=o(y,s,m),null===c?u=y:c.sibling=y,c=y);return e&&f.forEach((function(e){return t(i,e)})),u}return function(e,n,o,l){var d="object"===typeof o&&null!==o&&o.type===S&&null===o.key;d&&(o=o.props.children);var u="object"===typeof o&&null!==o;if(u)switch(o.$$typeof){case O:e:{for(u=o.key,d=n;null!==d;){if(d.key===u){if(7===d.tag){if(o.type===S){r(e,d.sibling),(n=i(d,o.props.children)).return=e,e=n;break e}}else if(d.elementType===o.type){r(e,d.sibling),(n=i(d,o.props)).ref=So(e,d,o),n.return=e,e=n;break e}r(e,d);break}t(e,d),d=d.sibling}o.type===S?((n=Xl(o.props.children,e.mode,l,o.key)).return=e,e=n):((l=Yl(o.type,o.key,o.props,null,e.mode,l)).ref=So(e,n,o),l.return=e,e=l)}return s(e);case v:e:{for(d=o.key;null!==n;){if(n.key===d){if(4===n.tag&&n.stateNode.containerInfo===o.containerInfo&&n.stateNode.implementation===o.implementation){r(e,n.sibling),(n=i(n,o.children||[])).return=e,e=n;break e}r(e,n);break}t(e,n),n=n.sibling}(n=Jl(o,e.mode,l)).return=e,e=n}return s(e)}if("string"===typeof o||"number"===typeof o)return o=""+o,null!==n&&6===n.tag?(r(e,n.sibling),(n=i(n,o)).return=e,e=n):(r(e,n),(n=ql(o,e.mode,l)).return=e,e=n),s(e);if(vo(o))return f(e,n,o,l);if(V(o))return m(e,n,o,l);if(u&&bo(e,o),"undefined"===typeof o&&!d)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(a(152,Y(e.type)||"Component"))}return r(e,n)}}var Io=Ao(!0),Ro=Ao(!1),Do={},No=di(Do),Po=di(Do),xo=di(Do);function Mo(e){if(e===Do)throw Error(a(174));return e}function Lo(e,t){switch(ci(xo,t),ci(Po,e),ci(No,Do),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ge(null,"");break;default:t=ge(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ui(No),ci(No,t)}function wo(){ui(No),ui(Po),ui(xo)}function ko(e){Mo(xo.current);var t=Mo(No.current),r=ge(t,e.type);t!==r&&(ci(Po,e),ci(No,r))}function Bo(e){Po.current===e&&(ui(No),ui(Po))}var jo=di(0);function Uo(e){for(var t=e;null!==t;){if(13===t.tag){var r=t.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||"$?"===r.data||"$!"===r.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Fo=null,Wo=null,Vo=!1;function Ho(e,t){var r=Gl(5,null,null,0);r.elementType="DELETED",r.type="DELETED",r.stateNode=t,r.return=e,r.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=r,e.lastEffect=r):e.firstEffect=e.lastEffect=r}function Go(e,t){switch(e.tag){case 5:var r=e.type;return null!==(t=1!==t.nodeType||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);default:return!1}}function zo(e){if(Vo){var t=Wo;if(t){var r=t;if(!Go(e,t)){if(!(t=Xn(r.nextSibling))||!Go(e,t))return e.flags=-1025&e.flags|2,Vo=!1,void(Fo=e);Ho(Fo,r)}Fo=e,Wo=Xn(t.firstChild)}else e.flags=-1025&e.flags|2,Vo=!1,Fo=e}}function Ko(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Fo=e}function Yo(e){if(e!==Fo)return!1;if(!Vo)return Ko(e),Vo=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Gn(t,e.memoizedProps))for(t=Wo;t;)Ho(e,t),t=Xn(t.nextSibling);if(Ko(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var r=e.data;if("/$"===r){if(0===t){Wo=Xn(e.nextSibling);break e}t--}else"$"!==r&&"$!"!==r&&"$?"!==r||t++}e=e.nextSibling}Wo=null}}else Wo=Fo?Xn(e.stateNode.nextSibling):null;return!0}function Xo(){Wo=Fo=null,Vo=!1}var $o=[];function qo(){for(var e=0;e<$o.length;e++)$o[e]._workInProgressVersionPrimary=null;$o.length=0}var Jo=T.ReactCurrentDispatcher,Zo=T.ReactCurrentBatchConfig,Qo=0,ea=null,ta=null,ra=null,na=!1,ia=!1;function oa(){throw Error(a(321))}function aa(e,t){if(null===t)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!un(e[r],t[r]))return!1;return!0}function sa(e,t,r,n,i,o){if(Qo=o,ea=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Jo.current=null===e||null===e.memoizedState?Ma:La,e=r(n,i),ia){o=0;do{if(ia=!1,!(25>o))throw Error(a(301));o+=1,ra=ta=null,t.updateQueue=null,Jo.current=wa,e=r(n,i)}while(ia)}if(Jo.current=xa,t=null!==ta&&null!==ta.next,Qo=0,ra=ta=ea=null,na=!1,t)throw Error(a(300));return e}function la(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ra?ea.memoizedState=ra=e:ra=ra.next=e,ra}function da(){if(null===ta){var e=ea.alternate;e=null!==e?e.memoizedState:null}else e=ta.next;var t=null===ra?ea.memoizedState:ra.next;if(null!==t)ra=t,ta=e;else{if(null===e)throw Error(a(310));e={memoizedState:(ta=e).memoizedState,baseState:ta.baseState,baseQueue:ta.baseQueue,queue:ta.queue,next:null},null===ra?ea.memoizedState=ra=e:ra=ra.next=e}return ra}function ua(e,t){return"function"===typeof t?t(e):t}function ca(e){var t=da(),r=t.queue;if(null===r)throw Error(a(311));r.lastRenderedReducer=e;var n=ta,i=n.baseQueue,o=r.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}n.baseQueue=i=o,r.pending=null}if(null!==i){i=i.next,n=n.baseState;var l=s=o=null,d=i;do{var u=d.lane;if((Qo&u)===u)null!==l&&(l=l.next={lane:0,action:d.action,eagerReducer:d.eagerReducer,eagerState:d.eagerState,next:null}),n=d.eagerReducer===e?d.eagerState:e(n,d.action);else{var c={lane:u,action:d.action,eagerReducer:d.eagerReducer,eagerState:d.eagerState,next:null};null===l?(s=l=c,o=n):l=l.next=c,ea.lanes|=u,Ws|=u}d=d.next}while(null!==d&&d!==i);null===l?o=n:l.next=s,un(n,t.memoizedState)||(Ba=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=l,r.lastRenderedState=n}return[t.memoizedState,r.dispatch]}function ha(e){var t=da(),r=t.queue;if(null===r)throw Error(a(311));r.lastRenderedReducer=e;var n=r.dispatch,i=r.pending,o=t.memoizedState;if(null!==i){r.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);un(o,t.memoizedState)||(Ba=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),r.lastRenderedState=o}return[o,n]}function pa(e,t,r){var n=t._getVersion;n=n(t._source);var i=t._workInProgressVersionPrimary;if(null!==i?e=i===n:(e=e.mutableReadLanes,(e=(Qo&e)===e)&&(t._workInProgressVersionPrimary=n,$o.push(t))),e)return r(t._source);throw $o.push(t),Error(a(350))}function ga(e,t,r,n){var i=Ms;if(null===i)throw Error(a(349));var o=t._getVersion,s=o(t._source),l=Jo.current,d=l.useState((function(){return pa(i,t,r)})),u=d[1],c=d[0];d=ra;var h=e.memoizedState,p=h.refs,g=p.getSnapshot,f=h.source;h=h.subscribe;var m=ea;return e.memoizedState={refs:p,source:t,subscribe:n},l.useEffect((function(){p.getSnapshot=r,p.setSnapshot=u;var e=o(t._source);if(!un(s,e)){e=r(t._source),un(c,e)||(u(e),e=pl(m),i.mutableReadLanes|=e&i.pendingLanes),e=i.mutableReadLanes,i.entangledLanes|=e;for(var n=i.entanglements,a=e;0<a;){var l=31-Gt(a),d=1<<l;n[l]|=e,a&=~d}}}),[r,t,n]),l.useEffect((function(){return n(t._source,(function(){var e=p.getSnapshot,r=p.setSnapshot;try{r(e(t._source));var n=pl(m);i.mutableReadLanes|=n&i.pendingLanes}catch(o){r((function(){throw o}))}}))}),[t,n]),un(g,r)&&un(f,t)&&un(h,n)||((e={pending:null,dispatch:null,lastRenderedReducer:ua,lastRenderedState:c}).dispatch=u=Pa.bind(null,ea,e),d.queue=e,d.baseQueue=null,c=pa(i,t,r),d.memoizedState=d.baseState=c),c}function fa(e,t,r){return ga(da(),e,t,r)}function ma(e){var t=la();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:ua,lastRenderedState:e}).dispatch=Pa.bind(null,ea,e),[t.memoizedState,e]}function Ca(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},null===(t=ea.updateQueue)?(t={lastEffect:null},ea.updateQueue=t,t.lastEffect=e.next=e):null===(r=t.lastEffect)?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e),e}function ya(e){return e={current:e},la().memoizedState=e}function _a(){return da().memoizedState}function Ea(e,t,r,n){var i=la();ea.flags|=e,i.memoizedState=Ca(1|t,r,void 0,void 0===n?null:n)}function Ta(e,t,r,n){var i=da();n=void 0===n?null:n;var o=void 0;if(null!==ta){var a=ta.memoizedState;if(o=a.destroy,null!==n&&aa(n,a.deps))return void Ca(t,r,o,n)}ea.flags|=e,i.memoizedState=Ca(1|t,r,o,n)}function Oa(e,t){return Ea(516,4,e,t)}function va(e,t){return Ta(516,4,e,t)}function Sa(e,t){return Ta(4,2,e,t)}function ba(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Aa(e,t,r){return r=null!==r&&void 0!==r?r.concat([e]):null,Ta(4,2,ba.bind(null,t,e),r)}function Ia(){}function Ra(e,t){var r=da();t=void 0===t?null:t;var n=r.memoizedState;return null!==n&&null!==t&&aa(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function Da(e,t){var r=da();t=void 0===t?null:t;var n=r.memoizedState;return null!==n&&null!==t&&aa(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function Na(e,t){var r=Gi();Ki(98>r?98:r,(function(){e(!0)})),Ki(97<r?97:r,(function(){var r=Zo.transition;Zo.transition=1;try{e(!1),t()}finally{Zo.transition=r}}))}function Pa(e,t,r){var n=hl(),i=pl(e),o={lane:i,action:r,eagerReducer:null,eagerState:null,next:null},a=t.pending;if(null===a?o.next=o:(o.next=a.next,a.next=o),t.pending=o,a=e.alternate,e===ea||null!==a&&a===ea)ia=na=!0;else{if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,l=a(s,r);if(o.eagerReducer=a,o.eagerState=l,un(l,s))return}catch(d){}gl(e,i,n)}}var xa={readContext:ao,useCallback:oa,useContext:oa,useEffect:oa,useImperativeHandle:oa,useLayoutEffect:oa,useMemo:oa,useReducer:oa,useRef:oa,useState:oa,useDebugValue:oa,useDeferredValue:oa,useTransition:oa,useMutableSource:oa,useOpaqueIdentifier:oa,unstable_isNewReconciler:!1},Ma={readContext:ao,useCallback:function(e,t){return la().memoizedState=[e,void 0===t?null:t],e},useContext:ao,useEffect:Oa,useImperativeHandle:function(e,t,r){return r=null!==r&&void 0!==r?r.concat([e]):null,Ea(4,2,ba.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Ea(4,2,e,t)},useMemo:function(e,t){var r=la();return t=void 0===t?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=la();return t=void 0!==r?r(t):t,n.memoizedState=n.baseState=t,e=(e=n.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Pa.bind(null,ea,e),[n.memoizedState,e]},useRef:ya,useState:ma,useDebugValue:Ia,useDeferredValue:function(e){var t=ma(e),r=t[0],n=t[1];return Oa((function(){var t=Zo.transition;Zo.transition=1;try{n(e)}finally{Zo.transition=t}}),[e]),r},useTransition:function(){var e=ma(!1),t=e[0];return ya(e=Na.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,r){var n=la();return n.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:r},ga(n,e,t,r)},useOpaqueIdentifier:function(){if(Vo){var e=!1,t=function(e){return{$$typeof:w,toString:e,valueOf:e}}((function(){throw e||(e=!0,r("r:"+(qn++).toString(36))),Error(a(355))})),r=ma(t)[1];return 0===(2&ea.mode)&&(ea.flags|=516,Ca(5,(function(){r("r:"+(qn++).toString(36))}),void 0,null)),t}return ma(t="r:"+(qn++).toString(36)),t},unstable_isNewReconciler:!1},La={readContext:ao,useCallback:Ra,useContext:ao,useEffect:va,useImperativeHandle:Aa,useLayoutEffect:Sa,useMemo:Da,useReducer:ca,useRef:_a,useState:function(){return ca(ua)},useDebugValue:Ia,useDeferredValue:function(e){var t=ca(ua),r=t[0],n=t[1];return va((function(){var t=Zo.transition;Zo.transition=1;try{n(e)}finally{Zo.transition=t}}),[e]),r},useTransition:function(){var e=ca(ua)[0];return[_a().current,e]},useMutableSource:fa,useOpaqueIdentifier:function(){return ca(ua)[0]},unstable_isNewReconciler:!1},wa={readContext:ao,useCallback:Ra,useContext:ao,useEffect:va,useImperativeHandle:Aa,useLayoutEffect:Sa,useMemo:Da,useReducer:ha,useRef:_a,useState:function(){return ha(ua)},useDebugValue:Ia,useDeferredValue:function(e){var t=ha(ua),r=t[0],n=t[1];return va((function(){var t=Zo.transition;Zo.transition=1;try{n(e)}finally{Zo.transition=t}}),[e]),r},useTransition:function(){var e=ha(ua)[0];return[_a().current,e]},useMutableSource:fa,useOpaqueIdentifier:function(){return ha(ua)[0]},unstable_isNewReconciler:!1},ka=T.ReactCurrentOwner,Ba=!1;function ja(e,t,r,n){t.child=null===e?Ro(t,null,r,n):Io(t,e.child,r,n)}function Ua(e,t,r,n,i){r=r.render;var o=t.ref;return oo(t,i),n=sa(e,t,r,n,o,i),null===e||Ba?(t.flags|=1,ja(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,os(e,t,i))}function Fa(e,t,r,n,i,o){if(null===e){var a=r.type;return"function"!==typeof a||zl(a)||void 0!==a.defaultProps||null!==r.compare||void 0!==r.defaultProps?((e=Yl(r.type,null,n,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Wa(e,t,a,n,i,o))}return a=e.child,0===(i&o)&&(i=a.memoizedProps,(r=null!==(r=r.compare)?r:hn)(i,n)&&e.ref===t.ref)?os(e,t,o):(t.flags|=1,(e=Kl(a,n)).ref=t.ref,e.return=t,t.child=e)}function Wa(e,t,r,n,i,o){if(null!==e&&hn(e.memoizedProps,n)&&e.ref===t.ref){if(Ba=!1,0===(o&i))return t.lanes=e.lanes,os(e,t,o);0!==(16384&e.flags)&&(Ba=!0)}return Ga(e,t,r,n,o)}function Va(e,t,r){var n=t.pendingProps,i=n.children,o=null!==e?e.memoizedState:null;if("hidden"===n.mode||"unstable-defer-without-hiding"===n.mode)if(0===(4&t.mode))t.memoizedState={baseLanes:0},Ol(t,r);else{if(0===(1073741824&r))return e=null!==o?o.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},Ol(t,e),null;t.memoizedState={baseLanes:0},Ol(t,null!==o?o.baseLanes:r)}else null!==o?(n=o.baseLanes|r,t.memoizedState=null):n=r,Ol(t,n);return ja(e,t,i,r),t.child}function Ha(e,t){var r=t.ref;(null===e&&null!==r||null!==e&&e.ref!==r)&&(t.flags|=128)}function Ga(e,t,r,n,i){var o=Ci(r)?fi:pi.current;return o=mi(t,o),oo(t,i),r=sa(e,t,r,n,o,i),null===e||Ba?(t.flags|=1,ja(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,os(e,t,i))}function za(e,t,r,n,i){if(Ci(r)){var o=!0;Ti(t)}else o=!1;if(oo(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),Eo(t,r,n),Oo(t,r,n,i),n=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var l=a.context,d=r.contextType;"object"===typeof d&&null!==d?d=ao(d):d=mi(t,d=Ci(r)?fi:pi.current);var u=r.getDerivedStateFromProps,c="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;c||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==n||l!==d)&&To(t,a,n,d),so=!1;var h=t.memoizedState;a.state=h,go(t,n,a,i),l=t.memoizedState,s!==n||h!==l||gi.current||so?("function"===typeof u&&(Co(t,r,u,n),l=t.memoizedState),(s=so||_o(t,r,s,n,h,l,d))?(c||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4)):("function"===typeof a.componentDidMount&&(t.flags|=4),t.memoizedProps=n,t.memoizedState=l),a.props=n,a.state=l,a.context=d,n=s):("function"===typeof a.componentDidMount&&(t.flags|=4),n=!1)}else{a=t.stateNode,uo(e,t),s=t.memoizedProps,d=t.type===t.elementType?s:Ji(t.type,s),a.props=d,c=t.pendingProps,h=a.context,"object"===typeof(l=r.contextType)&&null!==l?l=ao(l):l=mi(t,l=Ci(r)?fi:pi.current);var p=r.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==c||h!==l)&&To(t,a,n,l),so=!1,h=t.memoizedState,a.state=h,go(t,n,a,i);var g=t.memoizedState;s!==c||h!==g||gi.current||so?("function"===typeof p&&(Co(t,r,p,n),g=t.memoizedState),(d=so||_o(t,r,d,n,h,g,l))?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(n,g,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(n,g,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=256),t.memoizedProps=n,t.memoizedState=g),a.props=n,a.state=g,a.context=l,n=d):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=256),n=!1)}return Ka(e,t,r,n,o,i)}function Ka(e,t,r,n,i,o){Ha(e,t);var a=0!==(64&t.flags);if(!n&&!a)return i&&Oi(t,r,!1),os(e,t,o);n=t.stateNode,ka.current=t;var s=a&&"function"!==typeof r.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&a?(t.child=Io(t,e.child,null,o),t.child=Io(t,null,s,o)):ja(e,t,s,o),t.memoizedState=n.state,i&&Oi(t,r,!0),t.child}function Ya(e){var t=e.stateNode;t.pendingContext?_i(0,t.pendingContext,t.pendingContext!==t.context):t.context&&_i(0,t.context,!1),Lo(e,t.containerInfo)}var Xa,$a,qa,Ja={dehydrated:null,retryLane:0};function Za(e,t,r){var n,i=t.pendingProps,o=jo.current,a=!1;return(n=0!==(64&t.flags))||(n=(null===e||null!==e.memoizedState)&&0!==(2&o)),n?(a=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(o|=1),ci(jo,1&o),null===e?(void 0!==i.fallback&&zo(t),e=i.children,o=i.fallback,a?(e=Qa(t,e,o,r),t.child.memoizedState={baseLanes:r},t.memoizedState=Ja,e):"number"===typeof i.unstable_expectedLoadTime?(e=Qa(t,e,o,r),t.child.memoizedState={baseLanes:r},t.memoizedState=Ja,t.lanes=33554432,e):((r=$l({mode:"visible",children:e},t.mode,r,null)).return=t,t.child=r)):(e.memoizedState,a?(i=ts(e,t,i.children,i.fallback,r),a=t.child,o=e.child.memoizedState,a.memoizedState=null===o?{baseLanes:r}:{baseLanes:o.baseLanes|r},a.childLanes=e.childLanes&~r,t.memoizedState=Ja,i):(r=es(e,t,i.children,r),t.memoizedState=null,r))}function Qa(e,t,r,n){var i=e.mode,o=e.child;return t={mode:"hidden",children:t},0===(2&i)&&null!==o?(o.childLanes=0,o.pendingProps=t):o=$l(t,i,0,null),r=Xl(r,i,n,null),o.return=e,r.return=e,o.sibling=r,e.child=o,r}function es(e,t,r,n){var i=e.child;return e=i.sibling,r=Kl(i,{mode:"visible",children:r}),0===(2&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=r}function ts(e,t,r,n,i){var o=t.mode,a=e.child;e=a.sibling;var s={mode:"hidden",children:r};return 0===(2&o)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=s,null!==(a=r.lastEffect)?(t.firstEffect=r.firstEffect,t.lastEffect=a,a.nextEffect=null):t.firstEffect=t.lastEffect=null):r=Kl(a,s),null!==e?n=Kl(e,n):(n=Xl(n,o,i,null)).flags|=2,n.return=t,r.return=t,r.sibling=n,t.child=r,n}function rs(e,t){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),io(e.return,t)}function ns(e,t,r,n,i,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i,lastEffect:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=n,a.tail=r,a.tailMode=i,a.lastEffect=o)}function is(e,t,r){var n=t.pendingProps,i=n.revealOrder,o=n.tail;if(ja(e,t,n.children,r),0!==(2&(n=jo.current)))n=1&n|2,t.flags|=64;else{if(null!==e&&0!==(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&rs(e,r);else if(19===e.tag)rs(e,r);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(ci(jo,n),0===(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(r=t.child,i=null;null!==r;)null!==(e=r.alternate)&&null===Uo(e)&&(i=r),r=r.sibling;null===(r=i)?(i=t.child,t.child=null):(i=r.sibling,r.sibling=null),ns(t,!1,i,r,o,t.lastEffect);break;case"backwards":for(r=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Uo(e)){t.child=i;break}e=i.sibling,i.sibling=r,r=i,i=e}ns(t,!0,r,null,o,t.lastEffect);break;case"together":ns(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function os(e,t,r){if(null!==e&&(t.dependencies=e.dependencies),Ws|=t.lanes,0!==(r&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(r=Kl(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=Kl(e,e.pendingProps)).return=t;r.sibling=null}return t.child}return null}function as(e,t){if(!Vo)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;null!==r;)null!==r.alternate&&(n=r),r=r.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function ss(e,t,r){var n=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return Ci(t.type)&&yi(),null;case 3:return wo(),ui(gi),ui(pi),qo(),(n=t.stateNode).pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(Yo(t)?t.flags|=4:n.hydrate||(t.flags|=256)),null;case 5:Bo(t);var o=Mo(xo.current);if(r=t.type,null!==e&&null!=t.stateNode)$a(e,t,r,n),e.ref!==t.ref&&(t.flags|=128);else{if(!n){if(null===t.stateNode)throw Error(a(166));return null}if(e=Mo(No.current),Yo(t)){n=t.stateNode,r=t.type;var s=t.memoizedProps;switch(n[Zn]=t,n[Qn]=s,r){case"dialog":Nn("cancel",n),Nn("close",n);break;case"iframe":case"object":case"embed":Nn("load",n);break;case"video":case"audio":for(e=0;e<An.length;e++)Nn(An[e],n);break;case"source":Nn("error",n);break;case"img":case"image":case"link":Nn("error",n),Nn("load",n);break;case"details":Nn("toggle",n);break;case"input":ee(n,s),Nn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},Nn("invalid",n);break;case"textarea":le(n,s),Nn("invalid",n)}for(var d in Se(r,s),e=null,s)s.hasOwnProperty(d)&&(o=s[d],"children"===d?"string"===typeof o?n.textContent!==o&&(e=["children",o]):"number"===typeof o&&n.textContent!==""+o&&(e=["children",""+o]):l.hasOwnProperty(d)&&null!=o&&"onScroll"===d&&Nn("scroll",n));switch(r){case"input":q(n),ne(n,s,!0);break;case"textarea":q(n),ue(n);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(n.onclick=Fn)}n=e,t.updateQueue=n,null!==n&&(t.flags|=4)}else{switch(d=9===o.nodeType?o:o.ownerDocument,e===ce&&(e=pe(r)),e===ce?"script"===r?((e=d.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof n.is?e=d.createElement(r,{is:n.is}):(e=d.createElement(r),"select"===r&&(d=e,n.multiple?d.multiple=!0:n.size&&(d.size=n.size))):e=d.createElementNS(e,r),e[Zn]=t,e[Qn]=n,Xa(e,t),t.stateNode=e,d=be(r,n),r){case"dialog":Nn("cancel",e),Nn("close",e),o=n;break;case"iframe":case"object":case"embed":Nn("load",e),o=n;break;case"video":case"audio":for(o=0;o<An.length;o++)Nn(An[o],e);o=n;break;case"source":Nn("error",e),o=n;break;case"img":case"image":case"link":Nn("error",e),Nn("load",e),o=n;break;case"details":Nn("toggle",e),o=n;break;case"input":ee(e,n),o=Q(e,n),Nn("invalid",e);break;case"option":o=oe(e,n);break;case"select":e._wrapperState={wasMultiple:!!n.multiple},o=i({},n,{value:void 0}),Nn("invalid",e);break;case"textarea":le(e,n),o=se(e,n),Nn("invalid",e);break;default:o=n}Se(r,o);var u=o;for(s in u)if(u.hasOwnProperty(s)){var c=u[s];"style"===s?Oe(e,c):"dangerouslySetInnerHTML"===s?null!=(c=c?c.__html:void 0)&&Ce(e,c):"children"===s?"string"===typeof c?("textarea"!==r||""!==c)&&ye(e,c):"number"===typeof c&&ye(e,""+c):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(l.hasOwnProperty(s)?null!=c&&"onScroll"===s&&Nn("scroll",e):null!=c&&E(e,s,c,d))}switch(r){case"input":q(e),ne(e,n,!1);break;case"textarea":q(e),ue(e);break;case"option":null!=n.value&&e.setAttribute("value",""+X(n.value));break;case"select":e.multiple=!!n.multiple,null!=(s=n.value)?ae(e,!!n.multiple,s,!1):null!=n.defaultValue&&ae(e,!!n.multiple,n.defaultValue,!0);break;default:"function"===typeof o.onClick&&(e.onclick=Fn)}Hn(r,n)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)qa(0,t,e.memoizedProps,n);else{if("string"!==typeof n&&null===t.stateNode)throw Error(a(166));r=Mo(xo.current),Mo(No.current),Yo(t)?(n=t.stateNode,r=t.memoizedProps,n[Zn]=t,n.nodeValue!==r&&(t.flags|=4)):((n=(9===r.nodeType?r:r.ownerDocument).createTextNode(n))[Zn]=t,t.stateNode=n)}return null;case 13:return ui(jo),n=t.memoizedState,0!==(64&t.flags)?(t.lanes=r,t):(n=null!==n,r=!1,null===e?void 0!==t.memoizedProps.fallback&&Yo(t):r=null!==e.memoizedState,n&&!r&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&jo.current)?0===js&&(js=3):(0!==js&&3!==js||(js=4),null===Ms||0===(134217727&Ws)&&0===(134217727&Vs)||yl(Ms,ws))),(n||r)&&(t.flags|=4),null);case 4:return wo(),null===e&&xn(t.stateNode.containerInfo),null;case 10:return no(t),null;case 19:if(ui(jo),null===(n=t.memoizedState))return null;if(s=0!==(64&t.flags),null===(d=n.rendering))if(s)as(n,!1);else{if(0!==js||null!==e&&0!==(64&e.flags))for(e=t.child;null!==e;){if(null!==(d=Uo(e))){for(t.flags|=64,as(n,!1),null!==(s=d.updateQueue)&&(t.updateQueue=s,t.flags|=4),null===n.lastEffect&&(t.firstEffect=null),t.lastEffect=n.lastEffect,n=r,r=t.child;null!==r;)e=n,(s=r).flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,null===(d=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=d.childLanes,s.lanes=d.lanes,s.child=d.child,s.memoizedProps=d.memoizedProps,s.memoizedState=d.memoizedState,s.updateQueue=d.updateQueue,s.type=d.type,e=d.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return ci(jo,1&jo.current|2),t.child}e=e.sibling}null!==n.tail&&Hi()>Ks&&(t.flags|=64,s=!0,as(n,!1),t.lanes=33554432)}else{if(!s)if(null!==(e=Uo(d))){if(t.flags|=64,s=!0,null!==(r=e.updateQueue)&&(t.updateQueue=r,t.flags|=4),as(n,!0),null===n.tail&&"hidden"===n.tailMode&&!d.alternate&&!Vo)return null!==(t=t.lastEffect=n.lastEffect)&&(t.nextEffect=null),null}else 2*Hi()-n.renderingStartTime>Ks&&1073741824!==r&&(t.flags|=64,s=!0,as(n,!1),t.lanes=33554432);n.isBackwards?(d.sibling=t.child,t.child=d):(null!==(r=n.last)?r.sibling=d:t.child=d,n.last=d)}return null!==n.tail?(r=n.tail,n.rendering=r,n.tail=r.sibling,n.lastEffect=t.lastEffect,n.renderingStartTime=Hi(),r.sibling=null,t=jo.current,ci(jo,s?1&t|2:1&t),r):null;case 23:case 24:return vl(),null!==e&&null!==e.memoizedState!==(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==n.mode&&(t.flags|=4),null}throw Error(a(156,t.tag))}function ls(e){switch(e.tag){case 1:Ci(e.type)&&yi();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(wo(),ui(gi),ui(pi),qo(),0!==(64&(t=e.flags)))throw Error(a(285));return e.flags=-4097&t|64,e;case 5:return Bo(e),null;case 13:return ui(jo),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return ui(jo),null;case 4:return wo(),null;case 10:return no(e),null;case 23:case 24:return vl(),null;default:return null}}function ds(e,t){try{var r="",n=t;do{r+=K(n),n=n.return}while(n);var i=r}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i}}function us(e,t){try{console.error(t.value)}catch(r){setTimeout((function(){throw r}))}}Xa=function(e,t){for(var r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}},$a=function(e,t,r,n){var o=e.memoizedProps;if(o!==n){e=t.stateNode,Mo(No.current);var a,s=null;switch(r){case"input":o=Q(e,o),n=Q(e,n),s=[];break;case"option":o=oe(e,o),n=oe(e,n),s=[];break;case"select":o=i({},o,{value:void 0}),n=i({},n,{value:void 0}),s=[];break;case"textarea":o=se(e,o),n=se(e,n),s=[];break;default:"function"!==typeof o.onClick&&"function"===typeof n.onClick&&(e.onclick=Fn)}for(c in Se(r,n),r=null,o)if(!n.hasOwnProperty(c)&&o.hasOwnProperty(c)&&null!=o[c])if("style"===c){var d=o[c];for(a in d)d.hasOwnProperty(a)&&(r||(r={}),r[a]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(l.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in n){var u=n[c];if(d=null!=o?o[c]:void 0,n.hasOwnProperty(c)&&u!==d&&(null!=u||null!=d))if("style"===c)if(d){for(a in d)!d.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in u)u.hasOwnProperty(a)&&d[a]!==u[a]&&(r||(r={}),r[a]=u[a])}else r||(s||(s=[]),s.push(c,r)),r=u;else"dangerouslySetInnerHTML"===c?(u=u?u.__html:void 0,d=d?d.__html:void 0,null!=u&&d!==u&&(s=s||[]).push(c,u)):"children"===c?"string"!==typeof u&&"number"!==typeof u||(s=s||[]).push(c,""+u):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(l.hasOwnProperty(c)?(null!=u&&"onScroll"===c&&Nn("scroll",e),s||d===u||(s=[])):"object"===typeof u&&null!==u&&u.$$typeof===w?u.toString():(s=s||[]).push(c,u))}r&&(s=s||[]).push("style",r);var c=s;(t.updateQueue=c)&&(t.flags|=4)}},qa=function(e,t,r,n){r!==n&&(t.flags|=4)};var cs="function"===typeof WeakMap?WeakMap:Map;function hs(e,t,r){(r=co(-1,r)).tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){qs||(qs=!0,Js=n),us(0,t)},r}function ps(e,t,r){(r=co(-1,r)).tag=3;var n=e.type.getDerivedStateFromError;if("function"===typeof n){var i=t.value;r.payload=function(){return us(0,t),n(i)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(r.callback=function(){"function"!==typeof n&&(null===Zs?Zs=new Set([this]):Zs.add(this),us(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),r}var gs="function"===typeof WeakSet?WeakSet:Set;function fs(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(r){Fl(e,r)}else t.current=null}function ms(e,t){switch(t.tag){case 0:case 11:case 15:case 22:case 5:case 6:case 4:case 17:return;case 1:if(256&t.flags&&null!==e){var r=e.memoizedProps,n=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?r:Ji(t.type,r),n),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Yn(t.stateNode.containerInfo))}throw Error(a(163))}function Cs(e,t,r){switch(r.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=r.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3===(3&e.tag)){var n=e.create;e.destroy=n()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=r.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var i=e;n=i.next,0!==(4&(i=i.tag))&&0!==(1&i)&&(Bl(r,e),kl(r,e)),e=n}while(e!==t)}return;case 1:return e=r.stateNode,4&r.flags&&(null===t?e.componentDidMount():(n=r.elementType===r.type?t.memoizedProps:Ji(r.type,t.memoizedProps),e.componentDidUpdate(n,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=r.updateQueue)&&fo(r,t,e));case 3:if(null!==(t=r.updateQueue)){if(e=null,null!==r.child)switch(r.child.tag){case 5:case 1:e=r.child.stateNode}fo(r,t,e)}return;case 5:return e=r.stateNode,void(null===t&&4&r.flags&&Hn(r.type,r.memoizedProps)&&e.focus());case 6:case 4:case 12:case 19:case 17:case 20:case 21:case 23:case 24:return;case 13:return void(null===r.memoizedState&&(r=r.alternate,null!==r&&(r=r.memoizedState,null!==r&&(r=r.dehydrated,null!==r&&Ot(r)))))}throw Error(a(163))}function ys(e,t){for(var r=e;;){if(5===r.tag){var n=r.stateNode;if(t)"function"===typeof(n=n.style).setProperty?n.setProperty("display","none","important"):n.display="none";else{n=r.stateNode;var i=r.memoizedProps.style;i=void 0!==i&&null!==i&&i.hasOwnProperty("display")?i.display:null,n.style.display=Te("display",i)}}else if(6===r.tag)r.stateNode.nodeValue=t?"":r.memoizedProps;else if((23!==r.tag&&24!==r.tag||null===r.memoizedState||r===e)&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)break;for(;null===r.sibling;){if(null===r.return||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}}function _s(e,t){if(Si&&"function"===typeof Si.onCommitFiberUnmount)try{Si.onCommitFiberUnmount(vi,t)}catch(o){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e=e.next;do{var n=r,i=n.destroy;if(n=n.tag,void 0!==i)if(0!==(4&n))Bl(t,r);else{n=t;try{i()}catch(o){Fl(n,o)}}r=r.next}while(r!==e)}break;case 1:if(fs(t),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(o){Fl(t,o)}break;case 5:fs(t);break;case 4:bs(e,t)}}function Es(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function Ts(e){return 5===e.tag||3===e.tag||4===e.tag}function Os(e){e:{for(var t=e.return;null!==t;){if(Ts(t))break e;t=t.return}throw Error(a(160))}var r=t;switch(t=r.stateNode,r.tag){case 5:var n=!1;break;case 3:case 4:t=t.containerInfo,n=!0;break;default:throw Error(a(161))}16&r.flags&&(ye(t,""),r.flags&=-17);e:t:for(r=e;;){for(;null===r.sibling;){if(null===r.return||Ts(r.return)){r=null;break e}r=r.return}for(r.sibling.return=r.return,r=r.sibling;5!==r.tag&&6!==r.tag&&18!==r.tag;){if(2&r.flags)continue t;if(null===r.child||4===r.tag)continue t;r.child.return=r,r=r.child}if(!(2&r.flags)){r=r.stateNode;break e}}n?vs(e,r,t):Ss(e,r,t)}function vs(e,t,r){var n=e.tag,i=5===n||6===n;if(i)e=i?e.stateNode:e.stateNode.instance,t?8===r.nodeType?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(8===r.nodeType?(t=r.parentNode).insertBefore(e,r):(t=r).appendChild(e),null!==(r=r._reactRootContainer)&&void 0!==r||null!==t.onclick||(t.onclick=Fn));else if(4!==n&&null!==(e=e.child))for(vs(e,t,r),e=e.sibling;null!==e;)vs(e,t,r),e=e.sibling}function Ss(e,t,r){var n=e.tag,i=5===n||6===n;if(i)e=i?e.stateNode:e.stateNode.instance,t?r.insertBefore(e,t):r.appendChild(e);else if(4!==n&&null!==(e=e.child))for(Ss(e,t,r),e=e.sibling;null!==e;)Ss(e,t,r),e=e.sibling}function bs(e,t){for(var r,n,i=t,o=!1;;){if(!o){o=i.return;e:for(;;){if(null===o)throw Error(a(160));switch(r=o.stateNode,o.tag){case 5:n=!1;break e;case 3:case 4:r=r.containerInfo,n=!0;break e}o=o.return}o=!0}if(5===i.tag||6===i.tag){e:for(var s=e,l=i,d=l;;)if(_s(s,d),null!==d.child&&4!==d.tag)d.child.return=d,d=d.child;else{if(d===l)break e;for(;null===d.sibling;){if(null===d.return||d.return===l)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}n?(s=r,l=i.stateNode,8===s.nodeType?s.parentNode.removeChild(l):s.removeChild(l)):r.removeChild(i.stateNode)}else if(4===i.tag){if(null!==i.child){r=i.stateNode.containerInfo,n=!0,i.child.return=i,i=i.child;continue}}else if(_s(e,i),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(o=!1)}i.sibling.return=i.return,i=i.sibling}}function As(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var n=r=r.next;do{3===(3&n.tag)&&(e=n.destroy,n.destroy=void 0,void 0!==e&&e()),n=n.next}while(n!==r)}return;case 1:case 12:case 17:return;case 5:if(null!=(r=t.stateNode)){n=t.memoizedProps;var i=null!==e?e.memoizedProps:n;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(r[Qn]=n,"input"===e&&"radio"===n.type&&null!=n.name&&te(r,n),be(e,i),t=be(e,n),i=0;i<o.length;i+=2){var s=o[i],l=o[i+1];"style"===s?Oe(r,l):"dangerouslySetInnerHTML"===s?Ce(r,l):"children"===s?ye(r,l):E(r,s,l,t)}switch(e){case"input":re(r,n);break;case"textarea":de(r,n);break;case"select":e=r._wrapperState.wasMultiple,r._wrapperState.wasMultiple=!!n.multiple,null!=(o=n.value)?ae(r,!!n.multiple,o,!1):e!==!!n.multiple&&(null!=n.defaultValue?ae(r,!!n.multiple,n.defaultValue,!0):ae(r,!!n.multiple,n.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(a(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((r=t.stateNode).hydrate&&(r.hydrate=!1,Ot(r.containerInfo)));case 13:return null!==t.memoizedState&&(zs=Hi(),ys(t.child,!0)),void Is(t);case 19:return void Is(t);case 23:case 24:return void ys(t,null!==t.memoizedState)}throw Error(a(163))}function Is(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var r=e.stateNode;null===r&&(r=e.stateNode=new gs),t.forEach((function(t){var n=Vl.bind(null,e,t);r.has(t)||(r.add(t),t.then(n,n))}))}}function Rs(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var Ds=Math.ceil,Ns=T.ReactCurrentDispatcher,Ps=T.ReactCurrentOwner,xs=0,Ms=null,Ls=null,ws=0,ks=0,Bs=di(0),js=0,Us=null,Fs=0,Ws=0,Vs=0,Hs=0,Gs=null,zs=0,Ks=1/0;function Ys(){Ks=Hi()+500}var Xs,$s=null,qs=!1,Js=null,Zs=null,Qs=!1,el=null,tl=90,rl=[],nl=[],il=null,ol=0,al=null,sl=-1,ll=0,dl=0,ul=null,cl=!1;function hl(){return 0!==(48&xs)?Hi():-1!==sl?sl:sl=Hi()}function pl(e){if(0===(2&(e=e.mode)))return 1;if(0===(4&e))return 99===Gi()?1:2;if(0===ll&&(ll=Fs),0!==qi.transition){0!==dl&&(dl=null!==Gs?Gs.pendingLanes:0),e=ll;var t=4186112&~dl;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=Gi(),0!==(4&xs)&&98===e?e=Ft(12,ll):e=Ft(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),ll),e}function gl(e,t,r){if(50<ol)throw ol=0,al=null,Error(a(185));if(null===(e=fl(e,t)))return null;Ht(e,t,r),e===Ms&&(Vs|=t,4===js&&yl(e,ws));var n=Gi();1===t?0!==(8&xs)&&0===(48&xs)?_l(e):(ml(e,r),0===xs&&(Ys(),Xi())):(0===(4&xs)||98!==n&&99!==n||(null===il?il=new Set([e]):il.add(e)),ml(e,r)),Gs=e}function fl(e,t){e.lanes|=t;var r=e.alternate;for(null!==r&&(r.lanes|=t),r=e,e=e.return;null!==e;)e.childLanes|=t,null!==(r=e.alternate)&&(r.childLanes|=t),r=e,e=e.return;return 3===r.tag?r.stateNode:null}function ml(e,t){for(var r=e.callbackNode,n=e.suspendedLanes,i=e.pingedLanes,o=e.expirationTimes,s=e.pendingLanes;0<s;){var l=31-Gt(s),d=1<<l,u=o[l];if(-1===u){if(0===(d&n)||0!==(d&i)){u=t,Bt(d);var c=kt;o[l]=10<=c?u+250:6<=c?u+5e3:-1}}else u<=t&&(e.expiredLanes|=d);s&=~d}if(n=jt(e,e===Ms?ws:0),t=kt,0===n)null!==r&&(r!==Bi&&Ii(r),e.callbackNode=null,e.callbackPriority=0);else{if(null!==r){if(e.callbackPriority===t)return;r!==Bi&&Ii(r)}15===t?(r=_l.bind(null,e),null===Ui?(Ui=[r],Fi=Ai(xi,$i)):Ui.push(r),r=Bi):14===t?r=Yi(99,_l.bind(null,e)):(r=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(a(358,e))}}(t),r=Yi(r,Cl.bind(null,e))),e.callbackPriority=t,e.callbackNode=r}}function Cl(e){if(sl=-1,dl=ll=0,0!==(48&xs))throw Error(a(327));var t=e.callbackNode;if(wl()&&e.callbackNode!==t)return null;var r=jt(e,e===Ms?ws:0);if(0===r)return null;var n=r,i=xs;xs|=16;var o=Al();for(Ms===e&&ws===n||(Ys(),Sl(e,n));;)try{Dl();break}catch(l){bl(e,l)}if(ro(),Ns.current=o,xs=i,null!==Ls?n=0:(Ms=null,ws=0,n=js),0!==(Fs&Vs))Sl(e,0);else if(0!==n){if(2===n&&(xs|=64,e.hydrate&&(e.hydrate=!1,Yn(e.containerInfo)),0!==(r=Ut(e))&&(n=Il(e,r))),1===n)throw t=Us,Sl(e,0),yl(e,r),ml(e,Hi()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=r,n){case 0:case 1:throw Error(a(345));case 2:case 5:xl(e);break;case 3:if(yl(e,r),(62914560&r)===r&&10<(n=zs+500-Hi())){if(0!==jt(e,0))break;if(((i=e.suspendedLanes)&r)!==r){hl(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=zn(xl.bind(null,e),n);break}xl(e);break;case 4:if(yl(e,r),(4186112&r)===r)break;for(n=e.eventTimes,i=-1;0<r;){var s=31-Gt(r);o=1<<s,(s=n[s])>i&&(i=s),r&=~o}if(r=i,10<(r=(120>(r=Hi()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Ds(r/1960))-r)){e.timeoutHandle=zn(xl.bind(null,e),r);break}xl(e);break;default:throw Error(a(329))}}return ml(e,Hi()),e.callbackNode===t?Cl.bind(null,e):null}function yl(e,t){for(t&=~Hs,t&=~Vs,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Gt(t),n=1<<r;e[r]=-1,t&=~n}}function _l(e){if(0!==(48&xs))throw Error(a(327));if(wl(),e===Ms&&0!==(e.expiredLanes&ws)){var t=ws,r=Il(e,t);0!==(Fs&Vs)&&(r=Il(e,t=jt(e,t)))}else r=Il(e,t=jt(e,0));if(0!==e.tag&&2===r&&(xs|=64,e.hydrate&&(e.hydrate=!1,Yn(e.containerInfo)),0!==(t=Ut(e))&&(r=Il(e,t))),1===r)throw r=Us,Sl(e,0),yl(e,t),ml(e,Hi()),r;return e.finishedWork=e.current.alternate,e.finishedLanes=t,xl(e),ml(e,Hi()),null}function El(e,t){var r=xs;xs|=1;try{return e(t)}finally{0===(xs=r)&&(Ys(),Xi())}}function Tl(e,t){var r=xs;xs&=-2,xs|=8;try{return e(t)}finally{0===(xs=r)&&(Ys(),Xi())}}function Ol(e,t){ci(Bs,ks),ks|=t,Fs|=t}function vl(){ks=Bs.current,ui(Bs)}function Sl(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(-1!==r&&(e.timeoutHandle=-1,Kn(r)),null!==Ls)for(r=Ls.return;null!==r;){var n=r;switch(n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&yi();break;case 3:wo(),ui(gi),ui(pi),qo();break;case 5:Bo(n);break;case 4:wo();break;case 13:case 19:ui(jo);break;case 10:no(n);break;case 23:case 24:vl()}r=r.return}Ms=e,Ls=Kl(e.current,null),ws=ks=Fs=t,js=0,Us=null,Hs=Vs=Ws=0}function bl(e,t){for(;;){var r=Ls;try{if(ro(),Jo.current=xa,na){for(var n=ea.memoizedState;null!==n;){var i=n.queue;null!==i&&(i.pending=null),n=n.next}na=!1}if(Qo=0,ra=ta=ea=null,ia=!1,Ps.current=null,null===r||null===r.return){js=1,Us=t,Ls=null;break}e:{var o=e,a=r.return,s=r,l=t;if(t=ws,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==l&&"object"===typeof l&&"function"===typeof l.then){var d=l;if(0===(2&s.mode)){var u=s.alternate;u?(s.updateQueue=u.updateQueue,s.memoizedState=u.memoizedState,s.lanes=u.lanes):(s.updateQueue=null,s.memoizedState=null)}var c=0!==(1&jo.current),h=a;do{var p;if(p=13===h.tag){var g=h.memoizedState;if(null!==g)p=null!==g.dehydrated;else{var f=h.memoizedProps;p=void 0!==f.fallback&&(!0!==f.unstable_avoidThisFallback||!c)}}if(p){var m=h.updateQueue;if(null===m){var C=new Set;C.add(d),h.updateQueue=C}else m.add(d);if(0===(2&h.mode)){if(h.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var y=co(-1,1);y.tag=2,ho(s,y)}s.lanes|=1;break e}l=void 0,s=t;var _=o.pingCache;if(null===_?(_=o.pingCache=new cs,l=new Set,_.set(d,l)):void 0===(l=_.get(d))&&(l=new Set,_.set(d,l)),!l.has(s)){l.add(s);var E=Wl.bind(null,o,d,s);d.then(E,E)}h.flags|=4096,h.lanes=t;break e}h=h.return}while(null!==h);l=Error((Y(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==js&&(js=2),l=ds(l,s),h=a;do{switch(h.tag){case 3:o=l,h.flags|=4096,t&=-t,h.lanes|=t,po(h,hs(0,o,t));break e;case 1:o=l;var T=h.type,O=h.stateNode;if(0===(64&h.flags)&&("function"===typeof T.getDerivedStateFromError||null!==O&&"function"===typeof O.componentDidCatch&&(null===Zs||!Zs.has(O)))){h.flags|=4096,t&=-t,h.lanes|=t,po(h,ps(h,o,t));break e}}h=h.return}while(null!==h)}Pl(r)}catch(v){t=v,Ls===r&&null!==r&&(Ls=r=r.return);continue}break}}function Al(){var e=Ns.current;return Ns.current=xa,null===e?xa:e}function Il(e,t){var r=xs;xs|=16;var n=Al();for(Ms===e&&ws===t||Sl(e,t);;)try{Rl();break}catch(i){bl(e,i)}if(ro(),xs=r,Ns.current=n,null!==Ls)throw Error(a(261));return Ms=null,ws=0,js}function Rl(){for(;null!==Ls;)Nl(Ls)}function Dl(){for(;null!==Ls&&!Ri();)Nl(Ls)}function Nl(e){var t=Xs(e.alternate,e,ks);e.memoizedProps=e.pendingProps,null===t?Pl(e):Ls=t,Ps.current=null}function Pl(e){var t=e;do{var r=t.alternate;if(e=t.return,0===(2048&t.flags)){if(null!==(r=ss(r,t,ks)))return void(Ls=r);if(24!==(r=t).tag&&23!==r.tag||null===r.memoizedState||0!==(1073741824&ks)||0===(4&r.mode)){for(var n=0,i=r.child;null!==i;)n|=i.lanes|i.childLanes,i=i.sibling;r.childLanes=n}null!==e&&0===(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(r=ls(t)))return r.flags&=2047,void(Ls=r);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Ls=t);Ls=t=e}while(null!==t);0===js&&(js=5)}function xl(e){var t=Gi();return Ki(99,Ml.bind(null,e,t)),null}function Ml(e,t){do{wl()}while(null!==el);if(0!==(48&xs))throw Error(a(327));var r=e.finishedWork;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(a(177));e.callbackNode=null;var n=r.lanes|r.childLanes,i=n,o=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;for(var s=e.eventTimes,l=e.expirationTimes;0<o;){var d=31-Gt(o),u=1<<d;i[d]=0,s[d]=-1,l[d]=-1,o&=~u}if(null!==il&&0===(24&n)&&il.has(e)&&il.delete(e),e===Ms&&(Ls=Ms=null,ws=0),1<r.flags?null!==r.lastEffect?(r.lastEffect.nextEffect=r,n=r.firstEffect):n=r:n=r.firstEffect,null!==n){if(i=xs,xs|=32,Ps.current=null,Wn=$t,Cn(s=mn())){if("selectionStart"in s)l={start:s.selectionStart,end:s.selectionEnd};else e:if(l=(l=s.ownerDocument)&&l.defaultView||window,(u=l.getSelection&&l.getSelection())&&0!==u.rangeCount){l=u.anchorNode,o=u.anchorOffset,d=u.focusNode,u=u.focusOffset;try{l.nodeType,d.nodeType}catch(A){l=null;break e}var c=0,h=-1,p=-1,g=0,f=0,m=s,C=null;t:for(;;){for(var y;m!==l||0!==o&&3!==m.nodeType||(h=c+o),m!==d||0!==u&&3!==m.nodeType||(p=c+u),3===m.nodeType&&(c+=m.nodeValue.length),null!==(y=m.firstChild);)C=m,m=y;for(;;){if(m===s)break t;if(C===l&&++g===o&&(h=c),C===d&&++f===u&&(p=c),null!==(y=m.nextSibling))break;C=(m=C).parentNode}m=y}l=-1===h||-1===p?null:{start:h,end:p}}else l=null;l=l||{start:0,end:0}}else l=null;Vn={focusedElem:s,selectionRange:l},$t=!1,ul=null,cl=!1,$s=n;do{try{Ll()}catch(A){if(null===$s)throw Error(a(330));Fl($s,A),$s=$s.nextEffect}}while(null!==$s);ul=null,$s=n;do{try{for(s=e;null!==$s;){var _=$s.flags;if(16&_&&ye($s.stateNode,""),128&_){var E=$s.alternate;if(null!==E){var T=E.ref;null!==T&&("function"===typeof T?T(null):T.current=null)}}switch(1038&_){case 2:Os($s),$s.flags&=-3;break;case 6:Os($s),$s.flags&=-3,As($s.alternate,$s);break;case 1024:$s.flags&=-1025;break;case 1028:$s.flags&=-1025,As($s.alternate,$s);break;case 4:As($s.alternate,$s);break;case 8:bs(s,l=$s);var O=l.alternate;Es(l),null!==O&&Es(O)}$s=$s.nextEffect}}catch(A){if(null===$s)throw Error(a(330));Fl($s,A),$s=$s.nextEffect}}while(null!==$s);if(T=Vn,E=mn(),_=T.focusedElem,s=T.selectionRange,E!==_&&_&&_.ownerDocument&&fn(_.ownerDocument.documentElement,_)){null!==s&&Cn(_)&&(E=s.start,void 0===(T=s.end)&&(T=E),"selectionStart"in _?(_.selectionStart=E,_.selectionEnd=Math.min(T,_.value.length)):(T=(E=_.ownerDocument||document)&&E.defaultView||window).getSelection&&(T=T.getSelection(),l=_.textContent.length,O=Math.min(s.start,l),s=void 0===s.end?O:Math.min(s.end,l),!T.extend&&O>s&&(l=s,s=O,O=l),l=gn(_,O),o=gn(_,s),l&&o&&(1!==T.rangeCount||T.anchorNode!==l.node||T.anchorOffset!==l.offset||T.focusNode!==o.node||T.focusOffset!==o.offset)&&((E=E.createRange()).setStart(l.node,l.offset),T.removeAllRanges(),O>s?(T.addRange(E),T.extend(o.node,o.offset)):(E.setEnd(o.node,o.offset),T.addRange(E))))),E=[];for(T=_;T=T.parentNode;)1===T.nodeType&&E.push({element:T,left:T.scrollLeft,top:T.scrollTop});for("function"===typeof _.focus&&_.focus(),_=0;_<E.length;_++)(T=E[_]).element.scrollLeft=T.left,T.element.scrollTop=T.top}$t=!!Wn,Vn=Wn=null,e.current=r,$s=n;do{try{for(_=e;null!==$s;){var v=$s.flags;if(36&v&&Cs(_,$s.alternate,$s),128&v){E=void 0;var S=$s.ref;if(null!==S){var b=$s.stateNode;$s.tag,E=b,"function"===typeof S?S(E):S.current=E}}$s=$s.nextEffect}}catch(A){if(null===$s)throw Error(a(330));Fl($s,A),$s=$s.nextEffect}}while(null!==$s);$s=null,ji(),xs=i}else e.current=r;if(Qs)Qs=!1,el=e,tl=t;else for($s=n;null!==$s;)t=$s.nextEffect,$s.nextEffect=null,8&$s.flags&&((v=$s).sibling=null,v.stateNode=null),$s=t;if(0===(n=e.pendingLanes)&&(Zs=null),1===n?e===al?ol++:(ol=0,al=e):ol=0,r=r.stateNode,Si&&"function"===typeof Si.onCommitFiberRoot)try{Si.onCommitFiberRoot(vi,r,void 0,64===(64&r.current.flags))}catch(A){}if(ml(e,Hi()),qs)throw qs=!1,e=Js,Js=null,e;return 0!==(8&xs)||Xi(),null}function Ll(){for(;null!==$s;){var e=$s.alternate;cl||null===ul||(0!==(8&$s.flags)?et($s,ul)&&(cl=!0):13===$s.tag&&Rs(e,$s)&&et($s,ul)&&(cl=!0));var t=$s.flags;0!==(256&t)&&ms(e,$s),0===(512&t)||Qs||(Qs=!0,Yi(97,(function(){return wl(),null}))),$s=$s.nextEffect}}function wl(){if(90!==tl){var e=97<tl?97:tl;return tl=90,Ki(e,jl)}return!1}function kl(e,t){rl.push(t,e),Qs||(Qs=!0,Yi(97,(function(){return wl(),null})))}function Bl(e,t){nl.push(t,e),Qs||(Qs=!0,Yi(97,(function(){return wl(),null})))}function jl(){if(null===el)return!1;var e=el;if(el=null,0!==(48&xs))throw Error(a(331));var t=xs;xs|=32;var r=nl;nl=[];for(var n=0;n<r.length;n+=2){var i=r[n],o=r[n+1],s=i.destroy;if(i.destroy=void 0,"function"===typeof s)try{s()}catch(d){if(null===o)throw Error(a(330));Fl(o,d)}}for(r=rl,rl=[],n=0;n<r.length;n+=2){i=r[n],o=r[n+1];try{var l=i.create;i.destroy=l()}catch(d){if(null===o)throw Error(a(330));Fl(o,d)}}for(l=e.current.firstEffect;null!==l;)e=l.nextEffect,l.nextEffect=null,8&l.flags&&(l.sibling=null,l.stateNode=null),l=e;return xs=t,Xi(),!0}function Ul(e,t,r){ho(e,t=hs(0,t=ds(r,t),1)),t=hl(),null!==(e=fl(e,1))&&(Ht(e,1,t),ml(e,t))}function Fl(e,t){if(3===e.tag)Ul(e,e,t);else for(var r=e.return;null!==r;){if(3===r.tag){Ul(r,e,t);break}if(1===r.tag){var n=r.stateNode;if("function"===typeof r.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===Zs||!Zs.has(n))){var i=ps(r,e=ds(t,e),1);if(ho(r,i),i=hl(),null!==(r=fl(r,1)))Ht(r,1,i),ml(r,i);else if("function"===typeof n.componentDidCatch&&(null===Zs||!Zs.has(n)))try{n.componentDidCatch(t,e)}catch(o){}break}}r=r.return}}function Wl(e,t,r){var n=e.pingCache;null!==n&&n.delete(t),t=hl(),e.pingedLanes|=e.suspendedLanes&r,Ms===e&&(ws&r)===r&&(4===js||3===js&&(62914560&ws)===ws&&500>Hi()-zs?Sl(e,0):Hs|=r),ml(e,t)}function Vl(e,t){var r=e.stateNode;null!==r&&r.delete(t),0===(t=0)&&(0===(2&(t=e.mode))?t=1:0===(4&t)?t=99===Gi()?1:2:(0===ll&&(ll=Fs),0===(t=Wt(62914560&~ll))&&(t=4194304))),r=hl(),null!==(e=fl(e,t))&&(Ht(e,t,r),ml(e,r))}function Hl(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Gl(e,t,r,n){return new Hl(e,t,r,n)}function zl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Kl(e,t){var r=e.alternate;return null===r?((r=Gl(e.tag,t,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.nextEffect=null,r.firstEffect=null,r.lastEffect=null),r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Yl(e,t,r,n,i,o){var s=2;if(n=e,"function"===typeof e)zl(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Xl(r.children,i,o,t);case k:s=8,i|=16;break;case b:s=8,i|=1;break;case A:return(e=Gl(12,r,t,8|i)).elementType=A,e.type=A,e.lanes=o,e;case N:return(e=Gl(13,r,t,i)).type=N,e.elementType=N,e.lanes=o,e;case P:return(e=Gl(19,r,t,i)).elementType=P,e.lanes=o,e;case B:return $l(r,i,o,t);case j:return(e=Gl(24,r,t,i)).elementType=j,e.lanes=o,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case I:s=10;break e;case R:s=9;break e;case D:s=11;break e;case x:s=14;break e;case M:s=16,n=null;break e;case L:s=22;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Gl(s,r,t,i)).elementType=e,t.type=n,t.lanes=o,t}function Xl(e,t,r,n){return(e=Gl(7,e,n,t)).lanes=r,e}function $l(e,t,r,n){return(e=Gl(23,e,n,t)).elementType=B,e.lanes=r,e}function ql(e,t,r){return(e=Gl(6,e,null,t)).lanes=r,e}function Jl(e,t,r){return(t=Gl(4,null!==e.children?e.children:[],e.key,t)).lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Zl(e,t,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=r,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Vt(0),this.expirationTimes=Vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vt(0),this.mutableSourceEagerHydrationData=null}function Ql(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:v,key:null==n?null:""+n,children:e,containerInfo:t,implementation:r}}function ed(e,t,r,n){var i=t.current,o=hl(),s=pl(i);e:if(r){t:{if(qe(r=r._reactInternals)!==r||1!==r.tag)throw Error(a(170));var l=r;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(Ci(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(a(171))}if(1===r.tag){var d=r.type;if(Ci(d)){r=Ei(r,d,l);break e}}r=l}else r=hi;return null===t.context?t.context=r:t.pendingContext=r,(t=co(o,s)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),ho(i,t),gl(i,s,o),s}function td(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function rd(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var r=e.retryLane;e.retryLane=0!==r&&r<t?r:t}}function nd(e,t){rd(e,t),(e=e.alternate)&&rd(e,t)}function id(e,t,r){var n=null!=r&&null!=r.hydrationOptions&&r.hydrationOptions.mutableSources||null;if(r=new Zl(e,t,null!=r&&!0===r.hydrate),t=Gl(3,null,null,2===t?7:1===t?3:0),r.current=t,t.stateNode=r,lo(t),e[ei]=r.current,xn(8===e.nodeType?e.parentNode:e),n)for(e=0;e<n.length;e++){var i=(t=n[e])._getVersion;i=i(t._source),null==r.mutableSourceEagerHydrationData?r.mutableSourceEagerHydrationData=[t,i]:r.mutableSourceEagerHydrationData.push(t,i)}this._internalRoot=r}function od(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function ad(e,t,r,n,i){var o=r._reactRootContainer;if(o){var a=o._internalRoot;if("function"===typeof i){var s=i;i=function(){var e=td(a);s.call(e)}}ed(t,a,e,i)}else{if(o=r._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var r;r=e.lastChild;)e.removeChild(r);return new id(e,0,t?{hydrate:!0}:void 0)}(r,n),a=o._internalRoot,"function"===typeof i){var l=i;i=function(){var e=td(a);l.call(e)}}Tl((function(){ed(t,a,e,i)}))}return td(a)}function sd(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!od(t))throw Error(a(200));return Ql(e,t,null,r)}Xs=function(e,t,r){var n=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||gi.current)Ba=!0;else{if(0===(r&n)){switch(Ba=!1,t.tag){case 3:Ya(t),Xo();break;case 5:ko(t);break;case 1:Ci(t.type)&&Ti(t);break;case 4:Lo(t,t.stateNode.containerInfo);break;case 10:n=t.memoizedProps.value;var i=t.type._context;ci(Zi,i._currentValue),i._currentValue=n;break;case 13:if(null!==t.memoizedState)return 0!==(r&t.child.childLanes)?Za(e,t,r):(ci(jo,1&jo.current),null!==(t=os(e,t,r))?t.sibling:null);ci(jo,1&jo.current);break;case 19:if(n=0!==(r&t.childLanes),0!==(64&e.flags)){if(n)return is(e,t,r);t.flags|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),ci(jo,jo.current),n)break;return null;case 23:case 24:return t.lanes=0,Va(e,t,r)}return os(e,t,r)}Ba=0!==(16384&e.flags)}else Ba=!1;switch(t.lanes=0,t.tag){case 2:if(n=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=mi(t,pi.current),oo(t,r),i=sa(null,t,n,e,i,r),t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ci(n)){var o=!0;Ti(t)}else o=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,lo(t);var s=n.getDerivedStateFromProps;"function"===typeof s&&Co(t,n,s,e),i.updater=yo,t.stateNode=i,i._reactInternals=t,Oo(t,n,e,r),t=Ka(null,t,n,!0,o,r)}else t.tag=0,ja(null,t,i,r),t=t.child;return t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(o=i._init)(i._payload),t.type=i,o=t.tag=function(e){if("function"===typeof e)return zl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===D)return 11;if(e===x)return 14}return 2}(i),e=Ji(i,e),o){case 0:t=Ga(null,t,i,e,r);break e;case 1:t=za(null,t,i,e,r);break e;case 11:t=Ua(null,t,i,e,r);break e;case 14:t=Fa(null,t,i,Ji(i.type,e),n,r);break e}throw Error(a(306,i,""))}return t;case 0:return n=t.type,i=t.pendingProps,Ga(e,t,n,i=t.elementType===n?i:Ji(n,i),r);case 1:return n=t.type,i=t.pendingProps,za(e,t,n,i=t.elementType===n?i:Ji(n,i),r);case 3:if(Ya(t),n=t.updateQueue,null===e||null===n)throw Error(a(282));if(n=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,uo(e,t),go(t,n,null,r),(n=t.memoizedState.element)===i)Xo(),t=os(e,t,r);else{if((o=(i=t.stateNode).hydrate)&&(Wo=Xn(t.stateNode.containerInfo.firstChild),Fo=t,o=Vo=!0),o){if(null!=(e=i.mutableSourceEagerHydrationData))for(i=0;i<e.length;i+=2)(o=e[i])._workInProgressVersionPrimary=e[i+1],$o.push(o);for(r=Ro(t,null,n,r),t.child=r;r;)r.flags=-3&r.flags|1024,r=r.sibling}else ja(e,t,n,r),Xo();t=t.child}return t;case 5:return ko(t),null===e&&zo(t),n=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,Gn(n,i)?s=null:null!==o&&Gn(n,o)&&(t.flags|=16),Ha(e,t),ja(e,t,s,r),t.child;case 6:return null===e&&zo(t),null;case 13:return Za(e,t,r);case 4:return Lo(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=Io(t,null,n,r):ja(e,t,n,r),t.child;case 11:return n=t.type,i=t.pendingProps,Ua(e,t,n,i=t.elementType===n?i:Ji(n,i),r);case 7:return ja(e,t,t.pendingProps,r),t.child;case 8:case 12:return ja(e,t,t.pendingProps.children,r),t.child;case 10:e:{n=t.type._context,i=t.pendingProps,s=t.memoizedProps,o=i.value;var l=t.type._context;if(ci(Zi,l._currentValue),l._currentValue=o,null!==s)if(l=s.value,0===(o=un(l,o)?0:0|("function"===typeof n._calculateChangedBits?n._calculateChangedBits(l,o):1073741823))){if(s.children===i.children&&!gi.current){t=os(e,t,r);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var d=l.dependencies;if(null!==d){s=l.child;for(var u=d.firstContext;null!==u;){if(u.context===n&&0!==(u.observedBits&o)){1===l.tag&&((u=co(-1,r&-r)).tag=2,ho(l,u)),l.lanes|=r,null!==(u=l.alternate)&&(u.lanes|=r),io(l.return,r),d.lanes|=r;break}u=u.next}}else s=10===l.tag&&l.type===t.type?null:l.child;if(null!==s)s.return=l;else for(s=l;null!==s;){if(s===t){s=null;break}if(null!==(l=s.sibling)){l.return=s.return,s=l;break}s=s.return}l=s}ja(e,t,i.children,r),t=t.child}return t;case 9:return i=t.type,n=(o=t.pendingProps).children,oo(t,r),n=n(i=ao(i,o.unstable_observedBits)),t.flags|=1,ja(e,t,n,r),t.child;case 14:return o=Ji(i=t.type,t.pendingProps),Fa(e,t,i,o=Ji(i.type,o),n,r);case 15:return Wa(e,t,t.type,t.pendingProps,n,r);case 17:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Ji(n,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,Ci(n)?(e=!0,Ti(t)):e=!1,oo(t,r),Eo(t,n,i),Oo(t,n,i,r),Ka(null,t,n,!0,e,r);case 19:return is(e,t,r);case 23:case 24:return Va(e,t,r)}throw Error(a(156,t.tag))},id.prototype.render=function(e){ed(e,this._internalRoot,null,null)},id.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;ed(null,e,null,(function(){t[ei]=null}))},tt=function(e){13===e.tag&&(gl(e,4,hl()),nd(e,4))},rt=function(e){13===e.tag&&(gl(e,67108864,hl()),nd(e,67108864))},nt=function(e){if(13===e.tag){var t=hl(),r=pl(e);gl(e,r,t),nd(e,r)}},it=function(e,t){return t()},Ie=function(e,t,r){switch(t){case"input":if(re(e,r),t=r.name,"radio"===r.type&&null!=t){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var i=oi(n);if(!i)throw Error(a(90));J(n),re(n,i)}}}break;case"textarea":de(e,r);break;case"select":null!=(t=r.value)&&ae(e,!!r.multiple,t,!1)}},Me=El,Le=function(e,t,r,n,i){var o=xs;xs|=4;try{return Ki(98,e.bind(null,t,r,n,i))}finally{0===(xs=o)&&(Ys(),Xi())}},we=function(){0===(49&xs)&&(function(){if(null!==il){var e=il;il=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,ml(e,Hi())}))}Xi()}(),wl())},ke=function(e,t){var r=xs;xs|=2;try{return e(t)}finally{0===(xs=r)&&(Ys(),Xi())}};var ld={Events:[ni,ii,oi,Pe,xe,wl,{current:!1}]},dd={findFiberByHostInstance:ri,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},ud={bundleType:dd.bundleType,version:dd.version,rendererPackageName:dd.rendererPackageName,rendererConfig:dd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:T.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Qe(e))?null:e.stateNode},findFiberByHostInstance:dd.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var cd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cd.isDisabled&&cd.supportsFiber)try{vi=cd.inject(ud),Si=cd}catch(me){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ld,t.createPortal=sd,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw Error(a(268,Object.keys(e)))}return e=null===(e=Qe(t))?null:e.stateNode},t.flushSync=function(e,t){var r=xs;if(0!==(48&r))return e(t);xs|=1;try{if(e)return Ki(99,e.bind(null,t))}finally{xs=r,Xi()}},t.hydrate=function(e,t,r){if(!od(t))throw Error(a(200));return ad(null,e,t,!0,r)},t.render=function(e,t,r){if(!od(t))throw Error(a(200));return ad(null,e,t,!1,r)},t.unmountComponentAtNode=function(e){if(!od(e))throw Error(a(40));return!!e._reactRootContainer&&(Tl((function(){ad(null,null,e,!1,(function(){e._reactRootContainer=null,e[ei]=null}))})),!0)},t.unstable_batchedUpdates=El,t.unstable_createPortal=function(e,t){return sd(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!od(r))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return ad(e,t,r,!1,n)},t.version="17.0.2"},4164:function(e,t,r){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=r(4463)},6048:function(module,__unused_webpack_exports,__webpack_require__){var t;t=function(__WEBPACK_EXTERNAL_MODULE__98__){return function(){var __webpack_modules__={759:function(e,t,r){"use strict";r.d(t,{Z:function(){return p}});var n,i=r(98),o=r.n(i),a=r(697),s=r.n(a);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l.apply(this,arguments)}e=r.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var d=function(e){var t=e.breakLabel,r=e.breakClassName,n=e.breakLinkClassName,i=e.breakHandler,a=e.getEventListener,s=r||"break";return o().createElement("li",{className:s},o().createElement("a",l({className:n,role:"button",tabIndex:"0",onKeyPress:i},a(i)),t))};d.propTypes={breakLabel:s().oneOfType([s().string,s().node]),breakClassName:s().string,breakLinkClassName:s().string,breakHandler:s().func.isRequired,getEventListener:s().func.isRequired};var u,c,h=d,p=h;(u="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(u.register(d,"BreakView","/home/yoan/work/oss/react-paginate/react_components/BreakView.js"),u.register(h,"default","/home/yoan/work/oss/react-paginate/react_components/BreakView.js")),(c="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&c(e)},770:function(e,t,r){"use strict";r.d(t,{Z:function(){return p}});var n,i=r(98),o=r.n(i),a=r(697),s=r.n(a);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l.apply(this,arguments)}e=r.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var d=function(e){var t=e.pageClassName,r=e.pageLinkClassName,n=e.page,i=e.selected,a=e.activeClassName,s=e.activeLinkClassName,d=e.getEventListener,u=e.pageSelectedHandler,c=e.href,h=e.extraAriaContext,p=e.pageLabelBuilder,g=e.rel,f=e.ariaLabel||"Page "+n+(h?" "+h:""),m=null;return i&&(m="page",f=e.ariaLabel||"Page "+n+" is your current page",t=void 0!==t?t+" "+a:a,void 0!==r?void 0!==s&&(r=r+" "+s):r=s),o().createElement("li",{className:t},o().createElement("a",l({rel:g,role:c?void 0:"button",className:r,href:c,tabIndex:i?"-1":"0","aria-label":f,"aria-current":m,onKeyPress:u},d(u)),p(n)))};d.propTypes={pageSelectedHandler:s().func.isRequired,selected:s().bool.isRequired,pageClassName:s().string,pageLinkClassName:s().string,activeClassName:s().string,activeLinkClassName:s().string,extraAriaContext:s().string,href:s().string,ariaLabel:s().string,page:s().number.isRequired,getEventListener:s().func.isRequired,pageLabelBuilder:s().func.isRequired,rel:s().string};var u,c,h=d,p=h;(u="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(u.register(d,"PageView","/home/yoan/work/oss/react-paginate/react_components/PageView.js"),u.register(h,"default","/home/yoan/work/oss/react-paginate/react_components/PageView.js")),(c="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&c(e)},214:function _(module,__webpack_exports__,__nested_webpack_require_5475__){"use strict";__nested_webpack_require_5475__.d(__webpack_exports__,{Z:function(){return PaginationBoxView}});var react__WEBPACK_IMPORTED_MODULE_0__=__nested_webpack_require_5475__(98),react__WEBPACK_IMPORTED_MODULE_0___default=__nested_webpack_require_5475__.n(react__WEBPACK_IMPORTED_MODULE_0__),prop_types__WEBPACK_IMPORTED_MODULE_1__=__nested_webpack_require_5475__(697),prop_types__WEBPACK_IMPORTED_MODULE_1___default=__nested_webpack_require_5475__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__),_PageView__WEBPACK_IMPORTED_MODULE_2__=__nested_webpack_require_5475__(770),_BreakView__WEBPACK_IMPORTED_MODULE_3__=__nested_webpack_require_5475__(759),_utils__WEBPACK_IMPORTED_MODULE_4__=__nested_webpack_require_5475__(923),enterModule;function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _extends(){return _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends.apply(this,arguments)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}module=__nested_webpack_require_5475__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},PaginationBoxView=function(_Component){_inherits(PaginationBoxView,_Component);var _super=_createSuper(PaginationBoxView);function PaginationBoxView(e){var t,r;return _classCallCheck(this,PaginationBoxView),_defineProperty(_assertThisInitialized(t=_super.call(this,e)),"handlePreviousPage",(function(e){var r=t.state.selected;t.handleClick(e,null,r>0?r-1:void 0,{isPrevious:!0})})),_defineProperty(_assertThisInitialized(t),"handleNextPage",(function(e){var r=t.state.selected,n=t.props.pageCount;t.handleClick(e,null,r<n-1?r+1:void 0,{isNext:!0})})),_defineProperty(_assertThisInitialized(t),"handlePageSelected",(function(e,r){if(t.state.selected===e)return t.callActiveCallback(e),void t.handleClick(r,null,void 0,{isActive:!0});t.handleClick(r,null,e)})),_defineProperty(_assertThisInitialized(t),"handlePageChange",(function(e){t.state.selected!==e&&(t.setState({selected:e}),t.callCallback(e))})),_defineProperty(_assertThisInitialized(t),"getEventListener",(function(e){return _defineProperty({},t.props.eventListener,e)})),_defineProperty(_assertThisInitialized(t),"handleClick",(function(e,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=i.isPrevious,a=void 0!==o&&o,s=i.isNext,l=void 0!==s&&s,d=i.isBreak,u=void 0!==d&&d,c=i.isActive,h=void 0!==c&&c;e.preventDefault?e.preventDefault():e.returnValue=!1;var p=t.state.selected,g=t.props.onClick,f=n;if(g){var m=g({index:r,selected:p,nextSelectedPage:n,event:e,isPrevious:a,isNext:l,isBreak:u,isActive:h});if(!1===m)return;Number.isInteger(m)&&(f=m)}void 0!==f&&t.handlePageChange(f)})),_defineProperty(_assertThisInitialized(t),"handleBreakClick",(function(e,r){var n=t.state.selected;t.handleClick(r,e,n<e?t.getForwardJump():t.getBackwardJump(),{isBreak:!0})})),_defineProperty(_assertThisInitialized(t),"callCallback",(function(e){void 0!==t.props.onPageChange&&"function"==typeof t.props.onPageChange&&t.props.onPageChange({selected:e})})),_defineProperty(_assertThisInitialized(t),"callActiveCallback",(function(e){void 0!==t.props.onPageActive&&"function"==typeof t.props.onPageActive&&t.props.onPageActive({selected:e})})),_defineProperty(_assertThisInitialized(t),"getElementPageRel",(function(e){var r=t.state.selected,n=t.props,i=n.nextPageRel,o=n.prevPageRel,a=n.selectedPageRel;return r-1===e?o:r===e?a:r+1===e?i:void 0})),_defineProperty(_assertThisInitialized(t),"pagination",(function(){var e=[],r=t.props,n=r.pageRangeDisplayed,i=r.pageCount,o=r.marginPagesDisplayed,a=r.breakLabel,s=r.breakClassName,l=r.breakLinkClassName,d=t.state.selected;if(i<=n)for(var u=0;u<i;u++)e.push(t.getPageElement(u));else{var c=n/2,h=n-c;d>i-n/2?c=n-(h=i-d):d<n/2&&(h=n-(c=d));var p,g,f=function(e){return t.getPageElement(e)},m=[];for(p=0;p<i;p++){var C=p+1;C<=o||C>i-o||p>=d-c&&p<=d+(0===d&&n>1?h-1:h)?m.push({type:"page",index:p,display:f(p)}):a&&m.length>0&&m[m.length-1].display!==g&&(n>0||o>0)&&(g=react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_BreakView__WEBPACK_IMPORTED_MODULE_3__.Z,{key:p,breakLabel:a,breakClassName:s,breakLinkClassName:l,breakHandler:t.handleBreakClick.bind(null,p),getEventListener:t.getEventListener}),m.push({type:"break",index:p,display:g}))}m.forEach((function(t,r){var n=t;"break"===t.type&&m[r-1]&&"page"===m[r-1].type&&m[r+1]&&"page"===m[r+1].type&&m[r+1].index-m[r-1].index<=2&&(n={type:"page",index:t.index,display:f(t.index)}),e.push(n.display)}))}return e})),void 0!==e.initialPage&&void 0!==e.forcePage&&console.warn("(react-paginate): Both initialPage (".concat(e.initialPage,") and forcePage (").concat(e.forcePage,") props are provided, which is discouraged.")+" Use exclusively forcePage prop for a controlled component.\nSee https://reactjs.org/docs/forms.html#controlled-components"),r=e.initialPage?e.initialPage:e.forcePage?e.forcePage:0,t.state={selected:r},t}return _createClass(PaginationBoxView,[{key:"componentDidMount",value:function(){var e=this.props,t=e.initialPage,r=e.disableInitialCallback,n=e.extraAriaContext,i=e.pageCount,o=e.forcePage;void 0===t||r||this.callCallback(t),n&&console.warn("DEPRECATED (react-paginate): The extraAriaContext prop is deprecated. You should now use the ariaLabelBuilder instead."),Number.isInteger(i)||console.warn("(react-paginate): The pageCount prop value provided is not an integer (".concat(i,"). Did you forget a Math.ceil()?")),void 0!==t&&t>i-1&&console.warn("(react-paginate): The initialPage prop provided is greater than the maximum page index from pageCount prop (".concat(t," > ").concat(i-1,").")),void 0!==o&&o>i-1&&console.warn("(react-paginate): The forcePage prop provided is greater than the maximum page index from pageCount prop (".concat(o," > ").concat(i-1,")."))}},{key:"componentDidUpdate",value:function(e){void 0!==this.props.forcePage&&this.props.forcePage!==e.forcePage&&(this.props.forcePage>this.props.pageCount-1&&console.warn("(react-paginate): The forcePage prop provided is greater than the maximum page index from pageCount prop (".concat(this.props.forcePage," > ").concat(this.props.pageCount-1,").")),this.setState({selected:this.props.forcePage})),Number.isInteger(e.pageCount)&&!Number.isInteger(this.props.pageCount)&&console.warn("(react-paginate): The pageCount prop value provided is not an integer (".concat(this.props.pageCount,"). Did you forget a Math.ceil()?"))}},{key:"getForwardJump",value:function(){var e=this.state.selected,t=this.props,r=t.pageCount,n=e+t.pageRangeDisplayed;return n>=r?r-1:n}},{key:"getBackwardJump",value:function(){var e=this.state.selected-this.props.pageRangeDisplayed;return e<0?0:e}},{key:"getElementHref",value:function(e){var t=this.props,r=t.hrefBuilder,n=t.pageCount,i=t.hrefAllControls;if(r)return i||e>=0&&e<n?r(e+1,n,this.state.selected):void 0}},{key:"ariaLabelBuilder",value:function(e){var t=e===this.state.selected;if(this.props.ariaLabelBuilder&&e>=0&&e<this.props.pageCount){var r=this.props.ariaLabelBuilder(e+1,t);return this.props.extraAriaContext&&!t&&(r=r+" "+this.props.extraAriaContext),r}}},{key:"getPageElement",value:function(e){var t=this.state.selected,r=this.props,n=r.pageClassName,i=r.pageLinkClassName,o=r.activeClassName,a=r.activeLinkClassName,s=r.extraAriaContext,l=r.pageLabelBuilder;return react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_PageView__WEBPACK_IMPORTED_MODULE_2__.Z,{key:e,pageSelectedHandler:this.handlePageSelected.bind(null,e),selected:t===e,rel:this.getElementPageRel(e),pageClassName:n,pageLinkClassName:i,activeClassName:o,activeLinkClassName:a,extraAriaContext:s,href:this.getElementHref(e),ariaLabel:this.ariaLabelBuilder(e),page:e+1,pageLabelBuilder:l,getEventListener:this.getEventListener})}},{key:"render",value:function(){var e=this.props.renderOnZeroPageCount;if(0===this.props.pageCount&&void 0!==e)return e?e(this.props):e;var t=this.props,r=t.disabledClassName,n=t.disabledLinkClassName,i=t.pageCount,o=t.className,a=t.containerClassName,s=t.previousLabel,l=t.previousClassName,d=t.previousLinkClassName,u=t.previousAriaLabel,c=t.prevRel,h=t.nextLabel,p=t.nextClassName,g=t.nextLinkClassName,f=t.nextAriaLabel,m=t.nextRel,C=this.state.selected,y=0===C,_=C===i-1,E="".concat((0,_utils__WEBPACK_IMPORTED_MODULE_4__.m)(l)).concat(y?" ".concat((0,_utils__WEBPACK_IMPORTED_MODULE_4__.m)(r)):""),T="".concat((0,_utils__WEBPACK_IMPORTED_MODULE_4__.m)(p)).concat(_?" ".concat((0,_utils__WEBPACK_IMPORTED_MODULE_4__.m)(r)):""),O="".concat((0,_utils__WEBPACK_IMPORTED_MODULE_4__.m)(d)).concat(y?" ".concat((0,_utils__WEBPACK_IMPORTED_MODULE_4__.m)(n)):""),v="".concat((0,_utils__WEBPACK_IMPORTED_MODULE_4__.m)(g)).concat(_?" ".concat((0,_utils__WEBPACK_IMPORTED_MODULE_4__.m)(n)):""),S=y?"true":"false",b=_?"true":"false";return react__WEBPACK_IMPORTED_MODULE_0___default().createElement("ul",{className:o||a},react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li",{className:E},react__WEBPACK_IMPORTED_MODULE_0___default().createElement("a",_extends({className:O,href:this.getElementHref(C-1),tabIndex:y?"-1":"0",role:"button",onKeyPress:this.handlePreviousPage,"aria-disabled":S,"aria-label":u,rel:c},this.getEventListener(this.handlePreviousPage)),s)),this.pagination(),react__WEBPACK_IMPORTED_MODULE_0___default().createElement("li",{className:T},react__WEBPACK_IMPORTED_MODULE_0___default().createElement("a",_extends({className:v,href:this.getElementHref(C+1),tabIndex:_?"-1":"0",role:"button",onKeyPress:this.handleNextPage,"aria-disabled":b,"aria-label":f,rel:m},this.getEventListener(this.handleNextPage)),h)))}},{key:"__reactstandin__regenerateByEval",value:function __reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}]),PaginationBoxView}(react__WEBPACK_IMPORTED_MODULE_0__.Component),reactHotLoader,leaveModule;_defineProperty(PaginationBoxView,"propTypes",{pageCount:prop_types__WEBPACK_IMPORTED_MODULE_1___default().number.isRequired,pageRangeDisplayed:prop_types__WEBPACK_IMPORTED_MODULE_1___default().number,marginPagesDisplayed:prop_types__WEBPACK_IMPORTED_MODULE_1___default().number,previousLabel:prop_types__WEBPACK_IMPORTED_MODULE_1___default().node,previousAriaLabel:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,prevPageRel:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,prevRel:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,nextLabel:prop_types__WEBPACK_IMPORTED_MODULE_1___default().node,nextAriaLabel:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,nextPageRel:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,nextRel:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,breakLabel:prop_types__WEBPACK_IMPORTED_MODULE_1___default().oneOfType([prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,prop_types__WEBPACK_IMPORTED_MODULE_1___default().node]),hrefBuilder:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,hrefAllControls:prop_types__WEBPACK_IMPORTED_MODULE_1___default().bool,onPageChange:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,onPageActive:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,onClick:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,initialPage:prop_types__WEBPACK_IMPORTED_MODULE_1___default().number,forcePage:prop_types__WEBPACK_IMPORTED_MODULE_1___default().number,disableInitialCallback:prop_types__WEBPACK_IMPORTED_MODULE_1___default().bool,containerClassName:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,className:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,pageClassName:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,pageLinkClassName:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,pageLabelBuilder:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,activeClassName:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,activeLinkClassName:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,previousClassName:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,nextClassName:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,previousLinkClassName:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,nextLinkClassName:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,disabledClassName:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,disabledLinkClassName:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,breakClassName:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,breakLinkClassName:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,extraAriaContext:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,ariaLabelBuilder:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,eventListener:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,renderOnZeroPageCount:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,selectedPageRel:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string}),_defineProperty(PaginationBoxView,"defaultProps",{pageRangeDisplayed:2,marginPagesDisplayed:3,activeClassName:"selected",previousLabel:"Previous",previousClassName:"previous",previousAriaLabel:"Previous page",prevPageRel:"prev",prevRel:"prev",nextLabel:"Next",nextClassName:"next",nextAriaLabel:"Next page",nextPageRel:"next",nextRel:"next",breakLabel:"...",disabledClassName:"disabled",disableInitialCallback:!1,pageLabelBuilder:function(e){return e},eventListener:"onClick",renderOnZeroPageCount:void 0,selectedPageRel:"canonical",hrefAllControls:!1}),reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&reactHotLoader.register(PaginationBoxView,"PaginationBoxView","/home/yoan/work/oss/react-paginate/react_components/PaginationBoxView.js"),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)},351:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var n,i=r(214);e=r.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var o,a,s=i.Z,l=s;(o="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&o.register(s,"default","/home/yoan/work/oss/react-paginate/react_components/index.js"),(a="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&a(e)},923:function(e,t,r){"use strict";var n,i,o;function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return null!=e?e:t}r.d(t,{m:function(){return a}}),e=r.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature,(i="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&i.register(a,"classNameIfDefined","/home/yoan/work/oss/react-paginate/react_components/utils.js"),(o="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&o(e)},703:function(e,t,r){"use strict";var n=r(414);function i(){}function o(){}o.resetWarningCache=i,e.exports=function(){function e(e,t,r,i,o,a){if(a!==n){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var r={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:i};return r.PropTypes=r,r}},697:function(e,t,r){e.exports=r(703)()},414:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},98:function(e){"use strict";e.exports=__WEBPACK_EXTERNAL_MODULE__98__}},__webpack_module_cache__={};function __nested_webpack_require_32585__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e](r,r.exports,__nested_webpack_require_32585__),r.loaded=!0,r.exports}__nested_webpack_require_32585__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __nested_webpack_require_32585__.d(t,{a:t}),t},__nested_webpack_require_32585__.d=function(e,t){for(var r in t)__nested_webpack_require_32585__.o(t,r)&&!__nested_webpack_require_32585__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__nested_webpack_require_32585__.hmd=function(e){return(e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e},__nested_webpack_require_32585__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__nested_webpack_require_32585__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__=__nested_webpack_require_32585__(351);return __webpack_exports__}()},module.exports=t(__webpack_require__(2791))},6374:function(e,t,r){"use strict";r(1725);var n=r(2791),i=60103;if(t.Fragment=60107,"function"===typeof Symbol&&Symbol.for){var o=Symbol.for;i=o("react.element"),t.Fragment=o("react.fragment")}var a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,l={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,r){var n,o={},d=null,u=null;for(n in void 0!==r&&(d=""+r),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,n)&&!l.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===o[n]&&(o[n]=t[n]);return{$$typeof:i,type:e,key:d,ref:u,props:o,_owner:a.current}}t.jsx=d,t.jsxs=d},9117:function(e,t,r){"use strict";var n=r(1725),i=60103,o=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var a=60109,s=60110,l=60112;t.Suspense=60113;var d=60115,u=60116;if("function"===typeof Symbol&&Symbol.for){var c=Symbol.for;i=c("react.element"),o=c("react.portal"),t.Fragment=c("react.fragment"),t.StrictMode=c("react.strict_mode"),t.Profiler=c("react.profiler"),a=c("react.provider"),s=c("react.context"),l=c("react.forward_ref"),t.Suspense=c("react.suspense"),d=c("react.memo"),u=c("react.lazy")}var h="function"===typeof Symbol&&Symbol.iterator;function p(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f={};function m(e,t,r){this.props=e,this.context=t,this.refs=f,this.updater=r||g}function C(){}function y(e,t,r){this.props=e,this.context=t,this.refs=f,this.updater=r||g}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(p(85));this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},C.prototype=m.prototype;var _=y.prototype=new C;_.constructor=y,n(_,m.prototype),_.isPureReactComponent=!0;var E={current:null},T=Object.prototype.hasOwnProperty,O={key:!0,ref:!0,__self:!0,__source:!0};function v(e,t,r){var n,o={},a=null,s=null;if(null!=t)for(n in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)T.call(t,n)&&!O.hasOwnProperty(n)&&(o[n]=t[n]);var l=arguments.length-2;if(1===l)o.children=r;else if(1<l){for(var d=Array(l),u=0;u<l;u++)d[u]=arguments[u+2];o.children=d}if(e&&e.defaultProps)for(n in l=e.defaultProps)void 0===o[n]&&(o[n]=l[n]);return{$$typeof:i,type:e,key:a,ref:s,props:o,_owner:E.current}}function S(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var b=/\/+/g;function A(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function I(e,t,r,n,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case i:case o:l=!0}}if(l)return a=a(l=e),e=""===n?"."+A(l,0):n,Array.isArray(a)?(r="",null!=e&&(r=e.replace(b,"$&/")+"/"),I(a,t,r,"",(function(e){return e}))):null!=a&&(S(a)&&(a=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(b,"$&/")+"/")+e)),t.push(a)),1;if(l=0,n=""===n?".":n+":",Array.isArray(e))for(var d=0;d<e.length;d++){var u=n+A(s=e[d],d);l+=I(s,t,r,u,a)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),d=0;!(s=e.next()).done;)l+=I(s=s.value,t,r,u=n+A(s,d++),a);else if("object"===s)throw t=""+e,Error(p(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return l}function R(e,t,r){if(null==e)return e;var n=[],i=0;return I(e,n,"","",(function(e){return t.call(r,e,i++)})),n}function D(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var N={current:null};function P(){var e=N.current;if(null===e)throw Error(p(321));return e}var x={ReactCurrentDispatcher:N,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:E,IsSomeRendererActing:{current:!1},assign:n};t.Children={map:R,forEach:function(e,t,r){R(e,(function(){t.apply(this,arguments)}),r)},count:function(e){var t=0;return R(e,(function(){t++})),t},toArray:function(e){return R(e,(function(e){return e}))||[]},only:function(e){if(!S(e))throw Error(p(143));return e}},t.Component=m,t.PureComponent=y,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=x,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error(p(267,e));var o=n({},e.props),a=e.key,s=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,l=E.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var d=e.type.defaultProps;for(u in t)T.call(t,u)&&!O.hasOwnProperty(u)&&(o[u]=void 0===t[u]&&void 0!==d?d[u]:t[u])}var u=arguments.length-2;if(1===u)o.children=r;else if(1<u){d=Array(u);for(var c=0;c<u;c++)d[c]=arguments[c+2];o.children=d}return{$$typeof:i,type:e.type,key:a,ref:s,props:o,_owner:l}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:s,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=v,t.createFactory=function(e){var t=v.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:D}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return P().useCallback(e,t)},t.useContext=function(e,t){return P().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return P().useEffect(e,t)},t.useImperativeHandle=function(e,t,r){return P().useImperativeHandle(e,t,r)},t.useLayoutEffect=function(e,t){return P().useLayoutEffect(e,t)},t.useMemo=function(e,t){return P().useMemo(e,t)},t.useReducer=function(e,t,r){return P().useReducer(e,t,r)},t.useRef=function(e){return P().useRef(e)},t.useState=function(e){return P().useState(e)},t.version="17.0.2"},2791:function(e,t,r){"use strict";e.exports=r(9117)},184:function(e,t,r){"use strict";e.exports=r(6374)},9727:function(e){var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,i="function"===typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(P){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof m?t:m,o=Object.create(i.prototype),a=new R(n||[]);return o._invoke=function(e,t,r){var n=c;return function(i,o){if(n===p)throw new Error("Generator is already running");if(n===g){if("throw"===i)throw o;return N()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=b(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===c)throw n=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var l=u(e,t,r);if("normal"===l.type){if(n=r.done?g:h,l.arg===f)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n=g,r.method="throw",r.arg=l.arg)}}}(e,r,a),o}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(P){return{type:"throw",arg:P}}}e.wrap=d;var c="suspendedStart",h="suspendedYield",p="executing",g="completed",f={};function m(){}function C(){}function y(){}var _={};l(_,o,(function(){return this}));var E=Object.getPrototypeOf,T=E&&E(E(D([])));T&&T!==r&&n.call(T,o)&&(_=T);var O=y.prototype=m.prototype=Object.create(_);function v(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function r(i,o,a,s){var l=u(e[i],e,o);if("throw"!==l.type){var d=l.arg,c=d.value;return c&&"object"===typeof c&&n.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(c).then((function(e){d.value=e,a(d)}),(function(e){return r("throw",e,a,s)}))}s(l.arg)}var i;this._invoke=function(e,n){function o(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(o,o):o()}}function b(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,b(e,r),"throw"===r.method))return f;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var i=u(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,f;var o=i.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function D(e){if(e){var r=e[o];if(r)return r.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:N}}function N(){return{value:t,done:!0}}return C.prototype=y,l(O,"constructor",y),l(y,"constructor",C),C.displayName=l(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===C||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,s,"GeneratorFunction")),e.prototype=Object.create(O),e},e.awrap=function(e){return{__await:e}},v(S.prototype),l(S.prototype,a,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new S(d(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},v(O),l(O,s,"Generator"),l(O,o,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=D,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),d=n.call(a,"finallyLoc");if(l&&d){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),I(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;I(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:D(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),f}},e}(e.exports);try{regeneratorRuntime=t}catch(r){"object"===typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},6813:function(e,t){"use strict";var r,n,i,o;if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}if("undefined"===typeof window||"function"!==typeof MessageChannel){var d=null,u=null,c=function e(){if(null!==d)try{var r=t.unstable_now();d(!0,r),d=null}catch(n){throw setTimeout(e,0),n}};r=function(e){null!==d?setTimeout(r,0,e):(d=e,setTimeout(c,0))},n=function(e,t){u=setTimeout(e,t)},i=function(){clearTimeout(u)},t.unstable_shouldYield=function(){return!1},o=t.unstable_forceFrameRate=function(){}}else{var h=window.setTimeout,p=window.clearTimeout;if("undefined"!==typeof console){var g=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!==typeof g&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var f=!1,m=null,C=-1,y=5,_=0;t.unstable_shouldYield=function(){return t.unstable_now()>=_},o=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):y=0<e?Math.floor(1e3/e):5};var E=new MessageChannel,T=E.port2;E.port1.onmessage=function(){if(null!==m){var e=t.unstable_now();_=e+y;try{m(!0,e)?T.postMessage(null):(f=!1,m=null)}catch(r){throw T.postMessage(null),r}}else f=!1},r=function(e){m=e,f||(f=!0,T.postMessage(null))},n=function(e,r){C=h((function(){e(t.unstable_now())}),r)},i=function(){p(C),C=-1}}function O(e,t){var r=e.length;e.push(t);e:for(;;){var n=r-1>>>1,i=e[n];if(!(void 0!==i&&0<b(i,t)))break e;e[n]=t,e[r]=i,r=n}}function v(e){return void 0===(e=e[0])?null:e}function S(e){var t=e[0];if(void 0!==t){var r=e.pop();if(r!==t){e[0]=r;e:for(var n=0,i=e.length;n<i;){var o=2*(n+1)-1,a=e[o],s=o+1,l=e[s];if(void 0!==a&&0>b(a,r))void 0!==l&&0>b(l,a)?(e[n]=l,e[s]=r,n=s):(e[n]=a,e[o]=r,n=o);else{if(!(void 0!==l&&0>b(l,r)))break e;e[n]=l,e[s]=r,n=s}}}return t}return null}function b(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}var A=[],I=[],R=1,D=null,N=3,P=!1,x=!1,M=!1;function L(e){for(var t=v(I);null!==t;){if(null===t.callback)S(I);else{if(!(t.startTime<=e))break;S(I),t.sortIndex=t.expirationTime,O(A,t)}t=v(I)}}function w(e){if(M=!1,L(e),!x)if(null!==v(A))x=!0,r(k);else{var t=v(I);null!==t&&n(w,t.startTime-e)}}function k(e,r){x=!1,M&&(M=!1,i()),P=!0;var o=N;try{for(L(r),D=v(A);null!==D&&(!(D.expirationTime>r)||e&&!t.unstable_shouldYield());){var a=D.callback;if("function"===typeof a){D.callback=null,N=D.priorityLevel;var s=a(D.expirationTime<=r);r=t.unstable_now(),"function"===typeof s?D.callback=s:D===v(A)&&S(A),L(r)}else S(A);D=v(A)}if(null!==D)var l=!0;else{var d=v(I);null!==d&&n(w,d.startTime-r),l=!1}return l}finally{D=null,N=o,P=!1}}var B=o;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){x||P||(x=!0,r(k))},t.unstable_getCurrentPriorityLevel=function(){return N},t.unstable_getFirstCallbackNode=function(){return v(A)},t.unstable_next=function(e){switch(N){case 1:case 2:case 3:var t=3;break;default:t=N}var r=N;N=t;try{return e()}finally{N=r}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=B,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=N;N=e;try{return t()}finally{N=r}},t.unstable_scheduleCallback=function(e,o,a){var s=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?s+a:s:a=s,e){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return e={id:R++,callback:o,priorityLevel:e,startTime:a,expirationTime:l=a+l,sortIndex:-1},a>s?(e.sortIndex=a,O(I,e),null===v(A)&&e===v(I)&&(M?i():M=!0,n(w,a-s))):(e.sortIndex=l,O(A,e),x||P||(x=!0,r(k))),e},t.unstable_wrapCallback=function(e){var t=N;return function(){var r=N;N=t;try{return e.apply(this,arguments)}finally{N=r}}}},5296:function(e,t,r){"use strict";e.exports=r(6813)},1641:function(e,t,r){var n=r(5879),i=r(9128),o=r(4310),a=!("undefined"===typeof window||!window.document||!window.document.createElement),s={Version:"1.0.0"};s.Drawer=n,s.Parser=i,s.SvgDrawer=o,s.clean=function(e){return e.replace(/[^A-Za-z0-9@\.\+\-\?!\(\)\[\]\{\}/\\=#\$:\*]/g,"")},s.apply=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"canvas[data-smiles]",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"light",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=new n(e),a=document.querySelectorAll(t),l=function(){var e=a[d];s.parse(e.getAttribute("data-smiles"),(function(t){o.draw(t,e,r,!1)}),(function(e){i&&i(e)}))},d=0;d<a.length;d++)l()},s.parse=function(e,t,r){try{t&&t(i.parse(e))}catch(n){r&&r(n)}},a&&(window.SmilesDrawer=s),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(null==this)throw new TypeError("this is null or not defined");for(var t=Object(this),r=t.length>>>0,n=arguments[1],i=n>>0,o=i<0?Math.max(r+i,0):Math.min(i,r),a=arguments[2],s=void 0===a?r:a>>0,l=s<0?Math.max(r+s,0):Math.min(s,r);o<l;)t[o]=e,o++;return t}}),e.exports=s},9521:function(e,t,r){var n=r(4575).default,i=r(3913).default,o=function(){"use strict";function e(){n(this,e)}return i(e,null,[{key:"clone",value:function(t){var r=Array.isArray(t)?Array():{};for(var n in t){var i=t[n];"function"===typeof i.clone?r[n]=i.clone():r[n]="object"===typeof i?e.clone(i):i}return r}},{key:"equals",value:function(e,t){if(e.length!==t.length)return!1;for(var r=e.slice().sort(),n=t.slice().sort(),i=0;i<r.length;i++)if(r[i]!==n[i])return!1;return!0}},{key:"print",value:function(e){if(0==e.length)return"";for(var t="(",r=0;r<e.length;r++)t+=e[r].id?e[r].id+", ":e[r]+", ";return(t=t.substring(0,t.length-2))+")"}},{key:"each",value:function(e,t){for(var r=0;r<e.length;r++)t(e[r])}},{key:"get",value:function(e,t,r){for(var n=0;n<e.length;n++)if(e[n][t]==r)return e[n]}},{key:"contains",value:function(e,t){if(t.property||t.func){if(t.func){for(var r=0;r<e.length;r++)if(t.func(e[r]))return!0}else for(var n=0;n<e.length;n++)if(e[n][t.property]==t.value)return!0}else for(var i=0;i<e.length;i++)if(e[i]==t.value)return!0;return!1}},{key:"intersection",value:function(e,t){for(var r=new Array,n=0;n<e.length;n++)for(var i=0;i<t.length;i++)e[n]===t[i]&&r.push(e[n]);return r}},{key:"unique",value:function(e){var t={};return e.filter((function(e){return void 0===t[e]&&(t[e]=!0)}))}},{key:"count",value:function(e,t){for(var r=0,n=0;n<e.length;n++)e[n]===t&&r++;return r}},{key:"toggle",value:function(e,t){for(var r=Array(),n=!1,i=0;i<e.length;i++)e[i]!==t?r.push(e[i]):n=!0;return n||r.push(t),r}},{key:"remove",value:function(e,t){for(var r=Array(),n=0;n<e.length;n++)e[n]!==t&&r.push(e[n]);return r}},{key:"removeUnique",value:function(e,t){var r=e.indexOf(t);return r>-1&&e.splice(r,1),e}},{key:"removeAll",value:function(e,t){return e.filter((function(e){return-1===t.indexOf(e)}))}},{key:"merge",value:function(e,t){for(var r=new Array(e.length+t.length),n=0;n<e.length;n++)r[n]=e[n];for(var i=0;i<t.length;i++)r[e.length+i]=t[i];return r}},{key:"containsAll",value:function(e,t){for(var r=0,n=0;n<e.length;n++)for(var i=0;i<t.length;i++)e[n]===t[i]&&r++;return r===t.length}},{key:"sortByAtomicNumberDesc",value:function(e){var t=e.map((function(e,t){return{index:t,value:e.atomicNumber.split(".").map(Number)}}));return t.sort((function(e,t){for(var r=Math.min(t.value.length,e.value.length),n=0;n<r&&t.value[n]===e.value[n];)n++;return n===r?t.value.length-e.value.length:t.value[n]-e.value[n]})),t.map((function(t){return e[t.index]}))}},{key:"deepCopy",value:function(t){for(var r=Array(),n=0;n<t.length;n++){var i=t[n];r[n]=i instanceof Array?e.deepCopy(i):i}return r}}]),e}();e.exports=o},8666:function(e,t,r){var n=r(4575).default,i=r(3913).default,o=r(9521),a=(r(1965),r(648),function(){"use strict";function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";n(this,e),this.element=1===t.length?t.toUpperCase():t,this.drawExplicit=!1,this.ringbonds=Array(),this.rings=Array(),this.bondType=r,this.branchBond=null,this.isBridge=!1,this.isBridgeNode=!1,this.originalRings=Array(),this.bridgedRing=null,this.anchoredRings=Array(),this.bracket=null,this.plane=0,this.attachedPseudoElements={},this.hasAttachedPseudoElements=!1,this.isDrawn=!0,this.isConnectedToRing=!1,this.neighbouringElements=Array(),this.isPartOfAromaticRing=t!==this.element,this.bondCount=0,this.chirality="",this.isStereoCenter=!1,this.priority=0,this.mainChain=!1,this.hydrogenDirection="down",this.subtreeDepth=1,this.hasHydrogen=!1}return i(e,[{key:"addNeighbouringElement",value:function(e){this.neighbouringElements.push(e)}},{key:"attachPseudoElement",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;null===r&&(r=0),null===n&&(n=0);var i=r+e+n;this.attachedPseudoElements[i]?this.attachedPseudoElements[i].count+=1:this.attachedPseudoElements[i]={element:e,count:1,hydrogenCount:r,previousElement:t,charge:n},this.hasAttachedPseudoElements=!0}},{key:"getAttachedPseudoElements",value:function(){var e={},t=this;return Object.keys(this.attachedPseudoElements).sort().forEach((function(r){e[r]=t.attachedPseudoElements[r]})),e}},{key:"getAttachedPseudoElementsCount",value:function(){return Object.keys(this.attachedPseudoElements).length}},{key:"isHeteroAtom",value:function(){return"C"!==this.element&&"H"!==this.element}},{key:"addAnchoredRing",value:function(e){o.contains(this.anchoredRings,{value:e})||this.anchoredRings.push(e)}},{key:"getRingbondCount",value:function(){return this.ringbonds.length}},{key:"backupRings",value:function(){this.originalRings=Array(this.rings.length);for(var e=0;e<this.rings.length;e++)this.originalRings[e]=this.rings[e]}},{key:"restoreRings",value:function(){this.rings=Array(this.originalRings.length);for(var e=0;e<this.originalRings.length;e++)this.rings[e]=this.originalRings[e]}},{key:"haveCommonRingbond",value:function(e,t){for(var r=0;r<e.ringbonds.length;r++)for(var n=0;n<t.ringbonds.length;n++)if(e.ringbonds[r].id==t.ringbonds[n].id)return!0;return!1}},{key:"neighbouringElementsEqual",value:function(e){if(e.length!==this.neighbouringElements.length)return!1;e.sort(),this.neighbouringElements.sort();for(var t=0;t<this.neighbouringElements.length;t++)if(e[t]!==this.neighbouringElements[t])return!1;return!0}},{key:"getAtomicNumber",value:function(){return e.atomicNumbers[this.element]}},{key:"getMaxBonds",value:function(){return e.maxBonds[this.element]}}],[{key:"maxBonds",get:function(){return{H:1,C:4,N:3,O:2,P:3,S:2,B:3,F:1,I:1,Cl:1,Br:1}}},{key:"atomicNumbers",get:function(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}},{key:"mass",get:function(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}}]),e}());e.exports=a},8888:function(e,t,r){var n=r(4575).default,i=r(3913).default,o=r(5013),a=r(8357),s=(r(1423),r(1965),r(648),r(2914).getChargeText),l=function(){"use strict";function e(t,r,i){n(this,e),this.canvas="string"===typeof t||t instanceof String?document.getElementById(t):t,this.ctx=this.canvas.getContext("2d"),this.themeManager=r,this.opts=i,this.drawingWidth=0,this.drawingHeight=0,this.offsetX=0,this.offsetY=0,this.fontLarge=this.opts.fontSizeLarge+"pt Helvetica, Arial, sans-serif",this.fontSmall=this.opts.fontSizeSmall+"pt Helvetica, Arial, sans-serif",this.updateSize(this.opts.width,this.opts.height),this.ctx.font=this.fontLarge,this.hydrogenWidth=this.ctx.measureText("H").width,this.halfHydrogenWidth=this.hydrogenWidth/2,this.halfBondThickness=this.opts.bondThickness/2}return i(e,[{key:"updateSize",value:function(e,t){this.devicePixelRatio=window.devicePixelRatio||1,this.backingStoreRatio=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,this.ratio=this.devicePixelRatio/this.backingStoreRatio,1!==this.ratio?(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0)):(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio)}},{key:"setTheme",value:function(e){this.colors=e}},{key:"scale",value:function(e){for(var t=-Number.MAX_VALUE,r=-Number.MAX_VALUE,n=Number.MAX_VALUE,i=Number.MAX_VALUE,o=0;o<e.length;o++)if(e[o].value.isDrawn){var a=e[o].position;t<a.x&&(t=a.x),r<a.y&&(r=a.y),n>a.x&&(n=a.x),i>a.y&&(i=a.y)}var s=this.opts.padding;t+=s,r+=s,n-=s,i-=s,this.drawingWidth=t-n,this.drawingHeight=r-i;var l=this.canvas.offsetWidth/this.drawingWidth,d=this.canvas.offsetHeight/this.drawingHeight,u=l<d?l:d;this.ctx.scale(u,u),this.offsetX=-n,this.offsetY=-i,l<d?this.offsetY+=this.canvas.offsetHeight/(2*u)-this.drawingHeight/2:this.offsetX+=this.canvas.offsetWidth/(2*u)-this.drawingWidth/2}},{key:"reset",value:function(){this.ctx.setTransform(1,0,0,1,0,0)}},{key:"getColor",value:function(e){return(e=e.toUpperCase())in this.colors?this.colors[e]:this.colors.C}},{key:"drawCircle",value:function(e,t,r,n){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",l=this.ctx,d=this.offsetX,u=this.offsetY;l.save(),l.lineWidth=1.5,l.beginPath(),l.arc(e+d,t+u,r,0,o.twoPI,!0),l.closePath(),a?(i?(l.fillStyle="#f00",l.fill()):(l.strokeStyle="#f00",l.stroke()),this.drawDebugText(e,t,s)):i?(l.fillStyle=n,l.fill()):(l.strokeStyle=n,l.stroke()),l.restore()}},{key:"drawLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.ctx,i=this.offsetX,o=this.offsetY,a=e.clone().shorten(4),s=a.getLeftVector().clone(),l=a.getRightVector().clone();s.x+=i,s.y+=o,l.x+=i,l.y+=o,t||(n.save(),n.globalCompositeOperation="destination-out",n.beginPath(),n.moveTo(s.x,s.y),n.lineTo(l.x,l.y),n.lineCap="round",n.lineWidth=this.opts.bondThickness+1.2,n.strokeStyle=this.themeManager.getColor("BACKGROUND"),n.stroke(),n.globalCompositeOperation="source-over",n.restore()),s=e.getLeftVector().clone(),l=e.getRightVector().clone(),s.x+=i,s.y+=o,l.x+=i,l.y+=o,n.save(),n.beginPath(),n.moveTo(s.x,s.y),n.lineTo(l.x,l.y),n.lineCap="round",n.lineWidth=this.opts.bondThickness;var d=this.ctx.createLinearGradient(s.x,s.y,l.x,l.y);d.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),d.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),t&&(n.setLineDash([1,1.5]),n.lineWidth=this.opts.bondThickness/1.5),r<1&&(n.globalAlpha=r),n.strokeStyle=d,n.stroke(),n.restore()}},{key:"drawWedge",value:function(e){if(!(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))){var t=this.ctx,r=this.offsetX,n=this.offsetY,i=e.clone().shorten(5),o=i.getLeftVector().clone(),s=i.getRightVector().clone();o.x+=r,o.y+=n,s.x+=r,s.y+=n,o=e.getLeftVector().clone(),s=e.getRightVector().clone(),o.x+=r,o.y+=n,s.x+=r,s.y+=n,t.save();var l=a.normals(o,s);l[0].normalize(),l[1].normalize();var d=e.getRightChiral(),u=o,c=s;d&&(u=s,c=o);var h=a.add(u,a.multiplyScalar(l[0],this.halfBondThickness)),p=a.add(c,a.multiplyScalar(l[0],1.5+this.halfBondThickness)),g=a.add(c,a.multiplyScalar(l[1],1.5+this.halfBondThickness)),f=a.add(u,a.multiplyScalar(l[1],this.halfBondThickness));t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(p.x,p.y),t.lineTo(g.x,g.y),t.lineTo(f.x,f.y);var m=this.ctx.createRadialGradient(s.x,s.y,this.opts.bondLength,s.x,s.y,0);m.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),m.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),t.fillStyle=m,t.fill(),t.restore()}}},{key:"drawDashedWedge",value:function(e){if(!(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))){var t=this.ctx,r=this.offsetX,n=this.offsetY,i=e.getLeftVector().clone(),o=e.getRightVector().clone();i.x+=r,i.y+=n,o.x+=r,o.y+=n,t.save();var s=a.normals(i,o);s[0].normalize(),s[1].normalize();var l,d,u,c,h=e.getRightChiral(),p=e.clone();h?(l=o,d=i,p.shortenRight(1),u=p.getRightVector().clone(),c=p.getLeftVector().clone()):(l=i,d=o,p.shortenLeft(1),u=p.getLeftVector().clone(),c=p.getRightVector().clone()),u.x+=r,u.y+=n,c.x+=r,c.y+=n;var g=a.subtract(d,l).normalize();t.strokeStyle=this.themeManager.getColor("C"),t.lineCap="round",t.lineWidth=this.opts.bondThickness,t.beginPath();for(var f=e.getLength(),m=1.25/(f/(3*this.opts.bondThickness)),C=!1,y=0;y<1;y+=m){var _=a.multiplyScalar(g,y*f),E=a.add(l,_),T=1.5*y,O=a.multiplyScalar(s[0],T);!C&&y>.5&&(t.stroke(),t.beginPath(),t.strokeStyle=this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C"),C=!0),E.subtract(O),t.moveTo(E.x,E.y),E.add(a.multiplyScalar(O,2)),t.lineTo(E.x,E.y)}t.stroke(),t.restore()}}},{key:"drawDebugText",value:function(e,t,r){var n=this.ctx;n.save(),n.font="5px Droid Sans, sans-serif",n.textAlign="start",n.textBaseline="top",n.fillStyle="#ff0000",n.fillText(r,e+this.offsetX,t+this.offsetY),n.restore()}},{key:"drawBall",value:function(e,t,r){var n=this.ctx;n.save(),n.beginPath(),n.arc(e+this.offsetX,t+this.offsetY,this.opts.bondLength/4.5,0,o.twoPI,!1),n.fillStyle=this.themeManager.getColor(r),n.fill(),n.restore()}},{key:"drawPoint",value:function(e,t,r){var n=this.ctx,i=this.offsetX,a=this.offsetY;n.save(),n.globalCompositeOperation="destination-out",n.beginPath(),n.arc(e+i,t+a,1.5,0,o.twoPI,!0),n.closePath(),n.fill(),n.globalCompositeOperation="source-over",n.beginPath(),n.arc(e+this.offsetX,t+this.offsetY,.75,0,o.twoPI,!1),n.fillStyle=this.themeManager.getColor(r),n.fill(),n.restore()}},{key:"drawText",value:function(e,t,r,n,i,a,l,d){var u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{},c=this.ctx,h=this.offsetX,p=this.offsetY;c.save(),c.textAlign="start",c.textBaseline="alphabetic";var g=!1,f="",m=0;l&&(f=s(l),c.font=this.fontSmall,m=c.measureText(f).width);var C="0",y=0;d>0&&(C=d.toString(),c.font=this.fontSmall,y=c.measureText(C).width),1===l&&"N"===r&&u.hasOwnProperty("0O")&&u.hasOwnProperty("0O-1")&&(u={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},l=0),c.font=this.fontLarge,c.fillStyle=this.themeManager.getColor("BACKGROUND");var _=c.measureText(r);_.totalWidth=_.width+m,_.height=parseInt(this.fontLarge,10);var E=_.width>this.opts.fontSizeLarge?_.width:this.opts.fontSizeLarge;E/=1.5,c.globalCompositeOperation="destination-out",c.beginPath(),c.arc(e+h,t+p,E,0,o.twoPI,!0),c.closePath(),c.fill(),c.globalCompositeOperation="source-over";var T=-_.width/2,O=-_.width/2;c.fillStyle=this.themeManager.getColor(r),c.fillText(r,e+h+T,t+this.opts.halfFontSizeLarge+p),T+=_.width,l&&(c.font=this.fontSmall,c.fillText(f,e+h+T,t-this.opts.fifthFontSizeSmall+p),T+=m),d>0&&(c.font=this.fontSmall,c.fillText(C,e+h+O-y,t-this.opts.fifthFontSizeSmall+p),O-=y),c.font=this.fontLarge;var v=0,S=0;if(1===n){var b=e+h,A=t+p+this.opts.halfFontSizeLarge;O-=v=this.hydrogenWidth,"left"===i?b+=O:"right"===i||"up"===i&&a||"down"===i&&a?b+=T:"up"!==i||a?"down"!==i||a||(A+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,b-=this.halfHydrogenWidth):(A-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,b-=this.halfHydrogenWidth),c.fillText("H",b,A),T+=v}else if(n>1){var I=e+h,R=t+p+this.opts.halfFontSizeLarge;v=this.hydrogenWidth,c.font=this.fontSmall,O-=v+(S=c.measureText(n).width),"left"===i?I+=O:"right"===i||"up"===i&&a||"down"===i&&a?I+=T:"up"!==i||a?"down"!==i||a||(R+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,I-=this.halfHydrogenWidth):(R-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,I-=this.halfHydrogenWidth),c.font=this.fontLarge,c.fillText("H",I,R),c.font=this.fontSmall,c.fillText(n,I+this.halfHydrogenWidth+S,R+this.opts.fifthFontSizeSmall),T+=v+this.halfHydrogenWidth+S}if(g)c.restore();else{for(var D in u)if(u.hasOwnProperty(D)){var N=0,P=0,x=u[D].element,M=u[D].count,L=u[D].hydrogenCount,w=u[D].charge;c.font=this.fontLarge,M>1&&L>0&&(N=c.measureText("(").width,P=c.measureText(")").width);var k=c.measureText(x).width,B=0,j="",U=0;v=0,L>0&&(v=this.hydrogenWidth),c.font=this.fontSmall,M>1&&(B=c.measureText(M).width),0!==w&&(j=s(w),U=c.measureText(j).width),S=0,L>1&&(S=c.measureText(L).width),c.font=this.fontLarge;var F=e+h,W=t+p+this.opts.halfFontSizeLarge;c.fillStyle=this.themeManager.getColor(x),M>0&&(O-=B),M>1&&L>0&&("left"===i?(O-=P,c.fillText(")",F+O,W)):(c.fillText("(",F+T,W),T+=N)),"left"===i?(O-=k,c.fillText(x,F+O,W)):(c.fillText(x,F+T,W),T+=k),L>0&&("left"===i?(O-=v+S,c.fillText("H",F+O,W),L>1&&(c.font=this.fontSmall,c.fillText(L,F+O+v,W+this.opts.fifthFontSizeSmall))):(c.fillText("H",F+T,W),T+=v,L>1&&(c.font=this.fontSmall,c.fillText(L,F+T,W+this.opts.fifthFontSizeSmall),T+=S))),c.font=this.fontLarge,M>1&&L>0&&("left"===i?(O-=N,c.fillText("(",F+O,W)):(c.fillText(")",F+T,W),T+=P)),c.font=this.fontSmall,M>1&&("left"===i?c.fillText(M,F+O+N+P+v+S+k,W+this.opts.fifthFontSizeSmall):(c.fillText(M,F+T,W+this.opts.fifthFontSizeSmall),T+=B)),0!==w&&("left"===i?c.fillText(j,F+O+N+P+v+S+k,t-this.opts.fifthFontSizeSmall+p):(c.fillText(j,F+T,t-this.opts.fifthFontSizeSmall+p),T+=U))}c.restore()}}},{key:"getChargeText",value:function(e){return 1===e?"+":2===e?"2+":-1===e?"-":-2===e?"2-":""}},{key:"drawDebugPoint",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#f00";this.drawCircle(e,t,2,n,!0,!0,r)}},{key:"drawAromaticityRing",value:function(e){var t=this.ctx,r=o.apothemFromSideLength(this.opts.bondLength,e.getSize());t.save(),t.strokeStyle=this.themeManager.getColor("C"),t.lineWidth=this.opts.bondThickness,t.beginPath(),t.arc(e.center.x+this.offsetX,e.center.y+this.offsetY,r-this.opts.bondSpacing,0,2*Math.PI,!0),t.closePath(),t.stroke(),t.restore()}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}}]),e}();e.exports=l},5879:function(e,t,r){var n=r(3269).default,i=r(319).default,o=r(4575).default,a=r(3913).default,s=r(5013),l=r(9521),d=r(8357),u=r(1423),c=(r(1965),r(8674)),h=r(8666),p=r(648),g=r(6733),f=r(8888),m=r(5901),C=r(1105),y=r(496),_=function(){"use strict";function e(t){o(this,e),this.graph=null,this.doubleBondConfigCount=0,this.doubleBondConfig=null,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.canvasWrapper=null,this.totalOverlapScore=0,this.defaultOptions={width:500,height:500,bondThickness:.6,bondLength:15,shortBondLength:.85,bondSpacing:.18*15,atomVisualization:"default",isomeric:!0,debug:!1,terminalCarbons:!1,explicitHydrogens:!0,overlapSensitivity:.42,overlapResolutionIterations:1,compactDrawing:!0,fontSizeLarge:5,fontSizeSmall:3,padding:20,experimentalSSSR:!1,kkThreshold:.1,kkInnerThreshold:.1,kkMaxIteration:2e4,kkMaxInnerIteration:50,kkMaxEnergy:1e9,themes:{dark:{C:"#fff",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#fff",BACKGROUND:"#141414"},light:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#222",BACKGROUND:"#fff"}}},this.opts=this.extend(!0,this.defaultOptions,t),this.opts.halfBondSpacing=this.opts.bondSpacing/2,this.opts.bondLengthSq=this.opts.bondLength*this.opts.bondLength,this.opts.halfFontSizeLarge=this.opts.fontSizeLarge/2,this.opts.quarterFontSizeLarge=this.opts.fontSizeLarge/4,this.opts.fifthFontSizeSmall=this.opts.fontSizeSmall/5,this.theme=this.opts.themes.dark}return a(e,[{key:"extend",value:function(){var e=this,t={},r=!1,n=0,i=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(r=arguments[0],n++);for(var o=function(n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r&&"[object Object]"===Object.prototype.toString.call(n[i])?t[i]=e.extend(!0,t[i],n[i]):t[i]=n[i])};n<i;n++){var a=arguments[n];o(a)}return t}},{key:"draw",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"light",n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.initDraw(e,r,n),this.infoOnly||(this.themeManager=new y(this.opts.themes,r),this.canvasWrapper=new f(t,this.themeManager,this.opts)),n||(this.processGraph(),this.canvasWrapper.scale(this.graph.vertices),this.drawEdges(this.opts.debug),this.drawVertices(this.opts.debug),this.canvasWrapper.reset(),this.opts.debug&&(console.log(this.graph),console.log(this.rings),console.log(this.ringConnections)))}},{key:"edgeRingCount",value:function(e){var t=this.graph.edges[e],r=this.graph.vertices[t.sourceId],n=this.graph.vertices[t.targetId];return Math.min(r.value.rings.length,n.value.rings.length)}},{key:"getBridgedRings",value:function(){for(var e=Array(),t=0;t<this.rings.length;t++)this.rings[t].isBridged&&e.push(this.rings[t]);return e}},{key:"getFusedRings",value:function(){for(var e=Array(),t=0;t<this.rings.length;t++)this.rings[t].isFused&&e.push(this.rings[t]);return e}},{key:"getSpiros",value:function(){for(var e=Array(),t=0;t<this.rings.length;t++)this.rings[t].isSpiro&&e.push(this.rings[t]);return e}},{key:"printRingInfo",value:function(){for(var e="",t=0;t<this.rings.length;t++){var r=this.rings[t];e+=r.id+";",e+=r.members.length+";",e+=r.neighbours.length+";",e+=r.isSpiro?"true;":"false;",e+=r.isFused?"true;":"false;",e+=r.isBridged?"true;":"false;",e+=r.rings.length+";",e+="\n"}return e}},{key:"rotateDrawing",value:function(){for(var e=0,t=0,r=0,n=0;n<this.graph.vertices.length;n++){var i=this.graph.vertices[n];if(i.value.isDrawn)for(var o=n+1;o<this.graph.vertices.length;o++){var a=this.graph.vertices[o];if(a.value.isDrawn){var s=i.position.distanceSq(a.position);s>r&&(r=s,e=n,t=o)}}}var l=-d.subtract(this.graph.vertices[e].position,this.graph.vertices[t].position).angle();if(!isNaN(l)){var u=l%.523599;u<.2617995?l-=u:l+=.523599-u;for(n=0;n<this.graph.vertices.length;n++)n!==t&&this.graph.vertices[n].position.rotateAround(l,this.graph.vertices[t].position);for(n=0;n<this.rings.length;n++)this.rings[n].center.rotateAround(l,this.graph.vertices[t].position)}}},{key:"getTotalOverlapScore",value:function(){return this.totalOverlapScore}},{key:"getRingCount",value:function(){return this.rings.length}},{key:"hasBridgedRing",value:function(){return this.bridgedRing}},{key:"getHeavyAtomCount",value:function(){for(var e=0,t=0;t<this.graph.vertices.length;t++)"H"!==this.graph.vertices[t].value.element&&e++;return e}},{key:"getMolecularFormula",value:function(){for(var e="",t=new Map,r=0;r<this.graph.vertices.length;r++){var n=this.graph.vertices[r].value;if(t.has(n.element)?t.set(n.element,t.get(n.element)+1):t.set(n.element,1),n.bracket&&!n.bracket.chirality&&(t.has("H")?t.set("H",t.get("H")+n.bracket.hcount):t.set("H",n.bracket.hcount)),!n.bracket){var i=h.maxBonds[n.element]-n.bondCount;n.isPartOfAromaticRing&&i--,t.has("H")?t.set("H",t.get("H")+i):t.set("H",i)}}if(t.has("C")){var o=t.get("C");e+="C"+(o>1?o:""),t.delete("C")}if(t.has("H")){var a=t.get("H");e+="H"+(a>1?a:""),t.delete("H")}return Object.keys(h.atomicNumbers).sort().map((function(r){if(t.has(r)){var n=t.get(r);e+=r+(n>1?n:"")}})),e}},{key:"getRingbondType",value:function(e,t){if(e.value.getRingbondCount()<1||t.value.getRingbondCount()<1)return null;for(var r=0;r<e.value.ringbonds.length;r++)for(var n=0;n<t.value.ringbonds.length;n++)if(e.value.ringbonds[r].id===t.value.ringbonds[n].id)return"-"===e.value.ringbonds[r].bondType?t.value.ringbonds[n].bond:e.value.ringbonds[r].bond;return null}},{key:"initDraw",value:function(e,t,r){this.data=e,this.infoOnly=r,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.graph=new m(e,this.opts.isomeric),this.rings=Array(),this.ringConnections=Array(),this.originalRings=Array(),this.originalRingConnections=Array(),this.bridgedRing=!1,this.doubleBondConfigCount=null,this.doubleBondConfig=null,this.initRings(),this.initHydrogens()}},{key:"processGraph",value:function(){this.position(),this.restoreRingInformation(),this.resolvePrimaryOverlaps();var e=this.getOverlapScore();this.totalOverlapScore=this.getOverlapScore().total;for(var t=0;t<this.opts.overlapResolutionIterations;t++)for(var r=0;r<this.graph.edges.length;r++){var n=this.graph.edges[r];if(this.isEdgeRotatable(n)){var i=this.graph.getTreeDepth(n.sourceId,n.targetId),o=this.graph.getTreeDepth(n.targetId,n.sourceId),a=n.targetId,l=n.sourceId;if(i>o&&(a=n.sourceId,l=n.targetId),this.getSubtreeOverlapScore(l,a,e.vertexScores).value>this.opts.overlapSensitivity){var d=this.graph.vertices[a],u=this.graph.vertices[l],c=u.getNeighbours(a);if(1===c.length){var h=this.graph.vertices[c[0]],p=h.position.getRotateAwayFromAngle(d.position,u.position,s.toRad(120));this.rotateSubtree(h.id,u.id,p,u.position);var g=this.getOverlapScore().total;g>this.totalOverlapScore?this.rotateSubtree(h.id,u.id,-p,u.position):this.totalOverlapScore=g}else if(2===c.length){if(0!==u.value.rings.length&&0!==d.value.rings.length)continue;var f=this.graph.vertices[c[0]],m=this.graph.vertices[c[1]];if(1===f.value.rings.length&&1===m.value.rings.length){if(f.value.rings[0]!==m.value.rings[0])continue}else{if(0!==f.value.rings.length||0!==m.value.rings.length)continue;var C=f.position.getRotateAwayFromAngle(d.position,u.position,s.toRad(120)),y=m.position.getRotateAwayFromAngle(d.position,u.position,s.toRad(120));this.rotateSubtree(f.id,u.id,C,u.position),this.rotateSubtree(m.id,u.id,y,u.position);var _=this.getOverlapScore().total;_>this.totalOverlapScore?(this.rotateSubtree(f.id,u.id,-C,u.position),this.rotateSubtree(m.id,u.id,-y,u.position)):this.totalOverlapScore=_}}e=this.getOverlapScore()}}}this.resolveSecondaryOverlaps(e.scores),this.opts.isomeric&&this.annotateStereochemistry(),this.opts.compactDrawing&&"default"===this.opts.atomVisualization&&this.initPseudoElements(),this.rotateDrawing()}},{key:"initRings",value:function(){for(var e=new Map,t=this.graph.vertices.length-1;t>=0;t--){var r=this.graph.vertices[t];if(0!==r.value.ringbonds.length)for(var n=0;n<r.value.ringbonds.length;n++){var o=r.value.ringbonds[n].id,a=r.value.ringbonds[n].bond;if(e.has(o)){var s=r.id,l=e.get(o)[0],d=e.get(o)[1],u=new c(s,l,1);u.setBondType(d||a||"-");var h=this.graph.addEdge(u),f=this.graph.vertices[l];r.addRingbondChild(l,n),r.value.addNeighbouringElement(f.value.element),f.addRingbondChild(s,n),f.value.addNeighbouringElement(r.value.element),r.edges.push(h),f.edges.push(h),e.delete(o)}else e.set(o,[r.id,a])}}var m=C.getRings(this.graph,this.opts.experimentalSSSR);if(null!==m){for(t=0;t<m.length;t++){var y=i(m[t]),_=this.addRing(new p(y));for(n=0;n<y.length;n++)this.graph.vertices[y[n]].value.rings.push(_)}for(t=0;t<this.rings.length-1;t++)for(n=t+1;n<this.rings.length;n++){var E=this.rings[t],T=this.rings[n],O=new g(E,T);O.vertices.size>0&&this.addRingConnection(O)}for(t=0;t<this.rings.length;t++){var v=this.rings[t];v.neighbours=g.getNeighbours(this.ringConnections,v.id)}for(t=0;t<this.rings.length;t++){var S=this.rings[t];this.graph.vertices[S.members[0]].value.addAnchoredRing(S.id)}for(this.backupRingInformation();this.rings.length>0;){var b=-1;for(t=0;t<this.rings.length;t++){var A=this.rings[t];this.isPartOfBridgedRing(A.id)&&!A.isBridged&&(b=A.id)}if(-1===b)break;var I=this.getRing(b),R=this.getBridgedRingRings(I.id);this.bridgedRing=!0,this.createBridgedRing(R,I.members[0]);for(t=0;t<R.length;t++)this.removeRing(R[t])}}}},{key:"initHydrogens",value:function(){if(!this.opts.explicitHydrogens)for(var e=0;e<this.graph.vertices.length;e++){var t=this.graph.vertices[e];if("H"===t.value.element){var r=this.graph.vertices[t.neighbours[0]];r.value.hasHydrogen=!0,(!r.value.isStereoCenter||r.value.rings.length<2&&!r.value.bridgedRing||r.value.bridgedRing&&r.value.originalRings.length<2)&&(t.value.isDrawn=!1)}}}},{key:"getBridgedRingRings",value:function(e){var t=Array(),r=this;return function e(n){var i=r.getRing(n);t.push(n);for(var o=0;o<i.neighbours.length;o++){var a=i.neighbours[o];-1===t.indexOf(a)&&a!==n&&g.isBridge(r.ringConnections,r.graph.vertices,n,a)&&e(a)}}(e),l.unique(t)}},{key:"isPartOfBridgedRing",value:function(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].containsRing(e)&&this.ringConnections[t].isBridge(this.graph.vertices))return!0;return!1}},{key:"createBridgedRing",value:function(e,t){for(var r=new Set,o=new Set,a=new Set,s=0;s<e.length;s++){var d=this.getRing(e[s]);d.isPartOfBridged=!0;for(var u=0;u<d.members.length;u++)o.add(d.members[u]);for(u=0;u<d.neighbours.length;u++){var c=d.neighbours[u];-1===e.indexOf(c)&&a.add(d.neighbours[u])}}var h,g=new Set,f=n(o);try{for(f.s();!(h=f.n()).done;){var m=h.value,C=this.graph.vertices[m],y=l.intersection(e,C.value.rings);1===C.value.rings.length||1===y.length?r.add(C.id):g.add(C.id)}}catch(w){f.e(w)}finally{f.f()}Array();var _,E=Array(),T=n(g);try{for(T.s();!(_=T.n()).done;){for(var O=_.value,v=this.graph.vertices[O],S=!1,b=0;b<v.edges.length;b++)1===this.edgeRingCount(v.edges[b])&&(S=!0);S?(v.value.isBridgeNode=!0,r.add(v.id)):(v.value.isBridge=!0,r.add(v.id))}}catch(w){T.e(w)}finally{T.f()}var A=new p(i(r));this.addRing(A),A.isBridged=!0,A.neighbours=i(a);for(s=0;s<e.length;s++)A.rings.push(this.getRing(e[s]).clone());for(s=0;s<A.members.length;s++)this.graph.vertices[A.members[s]].value.bridgedRing=A.id;for(s=0;s<E.length;s++){this.graph.vertices[E[s]].value.rings=Array()}var I,R=n(r);try{for(R.s();!(I=R.n()).done;){var D=I.value,N=this.graph.vertices[D];N.value.rings=l.removeAll(N.value.rings,e),N.value.rings.push(A.id)}}catch(w){R.e(w)}finally{R.f()}for(s=0;s<e.length;s++)for(u=s+1;u<e.length;u++)this.removeRingConnectionsBetween(e[s],e[u]);var P,x=n(a);try{for(x.s();!(P=x.n()).done;){var M=P.value,L=this.getRingConnections(M,e);for(u=0;u<L.length;u++)this.getRingConnection(L[u]).updateOther(A.id,M);this.getRing(M).neighbours.push(A.id)}}catch(w){x.e(w)}finally{x.f()}return A}},{key:"areVerticesInSameRing",value:function(e,t){for(var r=0;r<e.value.rings.length;r++)for(var n=0;n<t.value.rings.length;n++)if(e.value.rings[r]===t.value.rings[n])return!0;return!1}},{key:"getCommonRings",value:function(e,t){for(var r=Array(),n=0;n<e.value.rings.length;n++)for(var i=0;i<t.value.rings.length;i++)e.value.rings[n]==t.value.rings[i]&&r.push(e.value.rings[n]);return r}},{key:"getLargestOrAromaticCommonRing",value:function(e,t){for(var r=this.getCommonRings(e,t),n=0,i=null,o=0;o<r.length;o++){var a=this.getRing(r[o]),s=a.getSize();if(a.isBenzeneLike(this.graph.vertices))return a;s>n&&(n=s,i=a)}return i}},{key:"getVerticesAt",value:function(e,t,r){for(var n=Array(),i=0;i<this.graph.vertices.length;i++){var o=this.graph.vertices[i];if(o.id!==r&&o.positioned)e.distanceSq(o.position)<=t*t&&n.push(o.id)}return n}},{key:"getClosestVertex",value:function(e){for(var t=99999,r=null,n=0;n<this.graph.vertices.length;n++){var i=this.graph.vertices[n];if(i.id!==e.id){var o=e.position.distanceSq(i.position);o<t&&(t=o,r=i)}}return r}},{key:"addRing",value:function(e){return e.id=this.ringIdCounter++,this.rings.push(e),e.id}},{key:"removeRing",value:function(e){this.rings=this.rings.filter((function(t){return t.id!==e})),this.ringConnections=this.ringConnections.filter((function(t){return t.firstRingId!==e&&t.secondRingId!==e}));for(var t=0;t<this.rings.length;t++){var r=this.rings[t];r.neighbours=r.neighbours.filter((function(t){return t!==e}))}}},{key:"getRing",value:function(e){for(var t=0;t<this.rings.length;t++)if(this.rings[t].id==e)return this.rings[t]}},{key:"addRingConnection",value:function(e){return e.id=this.ringConnectionIdCounter++,this.ringConnections.push(e),e.id}},{key:"removeRingConnection",value:function(e){this.ringConnections=this.ringConnections.filter((function(t){return t.id!==e}))}},{key:"removeRingConnectionsBetween",value:function(e,t){for(var r=Array(),n=0;n<this.ringConnections.length;n++){var i=this.ringConnections[n];(i.firstRingId===e&&i.secondRingId===t||i.firstRingId===t&&i.secondRingId===e)&&r.push(i.id)}for(n=0;n<r.length;n++)this.removeRingConnection(r[n])}},{key:"getRingConnection",value:function(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].id==e)return this.ringConnections[t]}},{key:"getRingConnections",value:function(e,t){for(var r=Array(),n=0;n<this.ringConnections.length;n++)for(var i=this.ringConnections[n],o=0;o<t.length;o++){var a=t[o];(i.firstRingId===e&&i.secondRingId===a||i.firstRingId===a&&i.secondRingId===e)&&r.push(i.id)}return r}},{key:"getOverlapScore",value:function(){for(var e=0,t=new Float32Array(this.graph.vertices.length),r=0;r<this.graph.vertices.length;r++)t[r]=0;for(r=0;r<this.graph.vertices.length;r++)for(var n=this.graph.vertices.length;--n>r;){var i=this.graph.vertices[r],o=this.graph.vertices[n];if(i.value.isDrawn&&o.value.isDrawn){var a=d.subtract(i.position,o.position).lengthSq();if(a<this.opts.bondLengthSq){var s=(this.opts.bondLength-Math.sqrt(a))/this.opts.bondLength;e+=s,t[r]+=s,t[n]+=s}}}var l=Array();for(r=0;r<this.graph.vertices.length;r++)l.push({id:r,score:t[r]});return l.sort((function(e,t){return t.score-e.score})),{total:e,scores:l,vertexScores:t}}},{key:"chooseSide",value:function(e,t,r){for(var n=e.getNeighbours(t.id),i=t.getNeighbours(e.id),o=n.length,a=i.length,s=l.merge(n,i),d=[0,0],u=0;u<s.length;u++){this.graph.vertices[s[u]].position.sameSideAs(e.position,t.position,r[0])?d[0]++:d[1]++}var c=[0,0];for(u=0;u<this.graph.vertices.length;u++){this.graph.vertices[u].position.sameSideAs(e.position,t.position,r[0])?c[0]++:c[1]++}return{totalSideCount:c,totalPosition:c[0]>c[1]?0:1,sideCount:d,position:d[0]>d[1]?0:1,anCount:o,bnCount:a}}},{key:"setRingCenter",value:function(e){for(var t=e.getSize(),r=new d(0,0),n=0;n<t;n++)r.add(this.graph.vertices[e.members[n]].position);e.center=r.divide(t)}},{key:"getSubringCenter",value:function(e,t){for(var r=t.value.originalRings,n=e.center,i=Number.MAX_VALUE,o=0;o<r.length;o++)for(var a=0;a<e.rings.length;a++)r[o]===e.rings[a].id&&e.rings[a].getSize()<i&&(n=e.rings[a].center,i=e.rings[a].getSize());return n}},{key:"drawEdges",value:function(e){var t=this,r=Array(this.graph.edges.length);if(r.fill(!1),this.graph.traverseBF(0,(function(n){for(var i=t.graph.getEdges(n.id),o=0;o<i.length;o++){var a=i[o];r[a]||(r[a]=!0,t.drawEdge(a,e))}})),!this.bridgedRing)for(var n=0;n<this.rings.length;n++){var i=this.rings[n];this.isRingAromatic(i)&&this.canvasWrapper.drawAromaticityRing(i)}}},{key:"drawEdge",value:function(e,t){var r=this,n=this.graph.edges[e],i=this.graph.vertices[n.sourceId],o=this.graph.vertices[n.targetId],a=i.value.element,s=o.value.element;if(i.value.isDrawn&&o.value.isDrawn||"default"!==this.opts.atomVisualization){var c=i.position,h=o.position,p=this.getEdgeNormals(n),g=l.clone(p);if(g[0].multiplyScalar(10).add(c),g[1].multiplyScalar(10).add(c),"="===n.bondType||"="===this.getRingbondType(i,o)||n.isPartOfAromaticRing&&this.bridgedRing){var f=this.areVerticesInSameRing(i,o),m=this.chooseSide(i,o,g);if(f){var C=this.getLargestOrAromaticCommonRing(i,o).center;p[0].multiplyScalar(r.opts.bondSpacing),p[1].multiplyScalar(r.opts.bondSpacing);var y=null;(y=C.sameSideAs(i.position,o.position,d.add(c,p[0]))?new u(d.add(c,p[0]),d.add(h,p[0]),a,s):new u(d.add(c,p[1]),d.add(h,p[1]),a,s)).shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),n.isPartOfAromaticRing?this.canvasWrapper.drawLine(y,!0):this.canvasWrapper.drawLine(y),this.canvasWrapper.drawLine(new u(c,h,a,s))}else if(n.center||i.isTerminal()&&o.isTerminal()){p[0].multiplyScalar(r.opts.halfBondSpacing),p[1].multiplyScalar(r.opts.halfBondSpacing);var _=new u(d.add(c,p[0]),d.add(h,p[0]),a,s),E=new u(d.add(c,p[1]),d.add(h,p[1]),a,s);this.canvasWrapper.drawLine(_),this.canvasWrapper.drawLine(E)}else if(0==m.anCount&&m.bnCount>1||0==m.bnCount&&m.anCount>1){p[0].multiplyScalar(r.opts.halfBondSpacing),p[1].multiplyScalar(r.opts.halfBondSpacing);var T=new u(d.add(c,p[0]),d.add(h,p[0]),a,s),O=new u(d.add(c,p[1]),d.add(h,p[1]),a,s);this.canvasWrapper.drawLine(T),this.canvasWrapper.drawLine(O)}else if(m.sideCount[0]>m.sideCount[1]){p[0].multiplyScalar(r.opts.bondSpacing),p[1].multiplyScalar(r.opts.bondSpacing);var v=new u(d.add(c,p[0]),d.add(h,p[0]),a,s);v.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(v),this.canvasWrapper.drawLine(new u(c,h,a,s))}else if(m.sideCount[0]<m.sideCount[1]){p[0].multiplyScalar(r.opts.bondSpacing),p[1].multiplyScalar(r.opts.bondSpacing);var S=new u(d.add(c,p[1]),d.add(h,p[1]),a,s);S.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(new u(c,h,a,s))}else if(m.totalSideCount[0]>m.totalSideCount[1]){p[0].multiplyScalar(r.opts.bondSpacing),p[1].multiplyScalar(r.opts.bondSpacing);var b=new u(d.add(c,p[0]),d.add(h,p[0]),a,s);b.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(b),this.canvasWrapper.drawLine(new u(c,h,a,s))}else if(m.totalSideCount[0]<=m.totalSideCount[1]){p[0].multiplyScalar(r.opts.bondSpacing),p[1].multiplyScalar(r.opts.bondSpacing);var A=new u(d.add(c,p[1]),d.add(h,p[1]),a,s);A.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(A),this.canvasWrapper.drawLine(new u(c,h,a,s))}}else if("#"===n.bondType){p[0].multiplyScalar(r.opts.bondSpacing/1.5),p[1].multiplyScalar(r.opts.bondSpacing/1.5);var I=new u(d.add(c,p[0]),d.add(h,p[0]),a,s),R=new u(d.add(c,p[1]),d.add(h,p[1]),a,s);this.canvasWrapper.drawLine(I),this.canvasWrapper.drawLine(R),this.canvasWrapper.drawLine(new u(c,h,a,s))}else if("."===n.bondType);else{var D=i.value.isStereoCenter,N=o.value.isStereoCenter;"up"===n.wedge?this.canvasWrapper.drawWedge(new u(c,h,a,s,D,N)):"down"===n.wedge?this.canvasWrapper.drawDashedWedge(new u(c,h,a,s,D,N)):this.canvasWrapper.drawLine(new u(c,h,a,s,D,N))}if(t){var P=d.midpoint(c,h);this.canvasWrapper.drawDebugText(P.x,P.y,"e: "+e)}}}},{key:"drawVertices",value:function(e){var t=this.graph.vertices.length;for(t=0;t<this.graph.vertices.length;t++){var r=this.graph.vertices[t],n=r.value,i=0,o=0,a=r.value.bondCount,s=n.element,u=h.maxBonds[s]-a,c=r.getTextDirection(this.graph.vertices),p=!(!this.opts.terminalCarbons&&"C"===s&&!n.hasAttachedPseudoElements)&&r.isTerminal(),g="C"===n.element;if("N"===n.element&&n.isPartOfAromaticRing&&(u=0),n.bracket&&(u=n.bracket.hcount,i=n.bracket.charge,o=n.bracket.isotope),"allballs"===this.opts.atomVisualization)this.canvasWrapper.drawBall(r.position.x,r.position.y,s);else if(n.isDrawn&&(!g||n.drawExplicit||p||n.hasAttachedPseudoElements)||1===this.graph.vertices.length)"default"===this.opts.atomVisualization?this.canvasWrapper.drawText(r.position.x,r.position.y,s,u,c,p,i,o,n.getAttachedPseudoElements()):"balls"===this.opts.atomVisualization&&this.canvasWrapper.drawBall(r.position.x,r.position.y,s);else if(2===r.getNeighbourCount()&&1==r.forcePositioned){var f=this.graph.vertices[r.neighbours[0]].position,m=this.graph.vertices[r.neighbours[1]].position,C=d.threePointangle(r.position,f,m);Math.abs(Math.PI-C)<.1&&this.canvasWrapper.drawPoint(r.position.x,r.position.y,s)}if(e){var y="v: "+r.id+" "+l.print(n.ringbonds);this.canvasWrapper.drawDebugText(r.position.x,r.position.y,y)}}if(this.opts.debug)for(t=0;t<this.rings.length;t++){var _=this.rings[t].center;this.canvasWrapper.drawDebugPoint(_.x,_.y,"r: "+this.rings[t].id)}}},{key:"position",value:function(){for(var e=null,t=0;t<this.graph.vertices.length;t++)if(null!==this.graph.vertices[t].value.bridgedRing){e=this.graph.vertices[t];break}for(t=0;t<this.rings.length;t++)this.rings[t].isBridged&&(e=this.graph.vertices[this.rings[t].members[0]]);this.rings.length>0&&null===e&&(e=this.graph.vertices[this.rings[0].members[0]]),null===e&&(e=this.graph.vertices[0]),this.createNextBond(e,null,0)}},{key:"backupRingInformation",value:function(){this.originalRings=Array(),this.originalRingConnections=Array();for(var e=0;e<this.rings.length;e++)this.originalRings.push(this.rings[e]);for(e=0;e<this.ringConnections.length;e++)this.originalRingConnections.push(this.ringConnections[e]);for(e=0;e<this.graph.vertices.length;e++)this.graph.vertices[e].value.backupRings()}},{key:"restoreRingInformation",value:function(){var e=this.getBridgedRings();this.rings=Array(),this.ringConnections=Array();for(var t=0;t<e.length;t++)for(var r=e[t],n=0;n<r.rings.length;n++){var i=r.rings[n];this.originalRings[i.id].center=i.center}for(t=0;t<this.originalRings.length;t++)this.rings.push(this.originalRings[t]);for(t=0;t<this.originalRingConnections.length;t++)this.ringConnections.push(this.originalRingConnections[t]);for(t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.restoreRings()}},{key:"createRing",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!e.positioned){t=t||new d(0,0);var i=e.getOrderedNeighbours(this.ringConnections),o=r?d.subtract(r.position,t).angle():0,a=s.polyCircumradius(this.opts.bondLength,e.getSize()),l=s.centralAngle(e.getSize());e.centralAngle=l;var u=o,c=this,h=r?r.id:null;if(-1===e.members.indexOf(h)&&(r&&(r.positioned=!1),h=e.members[0]),e.isBridged){this.graph.kkLayout(e.members.slice(),t,r.id,e,this.opts.bondLength,this.opts.kkThreshold,this.opts.kkInnerThreshold,this.opts.kkMaxIteration,this.opts.kkMaxInnerIteration,this.opts.kkMaxEnergy),e.positioned=!0,this.setRingCenter(e),t=e.center;for(var p=0;p<e.rings.length;p++)this.setRingCenter(e.rings[p])}else e.eachMember(this.graph.vertices,(function(r){var n=c.graph.vertices[r];n.positioned||n.setPosition(t.x+Math.cos(u)*a,t.y+Math.sin(u)*a),u+=l,(!e.isBridged||e.rings.length<3)&&(n.angle=u,n.positioned=!0)}),h,n?n.id:null);e.positioned=!0,e.center=t;for(p=0;p<i.length;p++){var f=this.getRing(i[p].neighbour);if(!f.positioned){var m=g.getVertices(this.ringConnections,e.id,f.id);if(2===m.length){e.isFused=!0,f.isFused=!0;var C=this.graph.vertices[m[0]],y=this.graph.vertices[m[1]],_=d.midpoint(C.position,y.position),E=d.normals(C.position,y.position);E[0].normalize(),E[1].normalize();var T=s.polyCircumradius(this.opts.bondLength,f.getSize()),O=s.apothem(T,f.getSize());E[0].multiplyScalar(O).add(_),E[1].multiplyScalar(O).add(_);var v=E[0];d.subtract(t,E[1]).lengthSq()>d.subtract(t,E[0]).lengthSq()&&(v=E[1]);var S=d.subtract(C.position,v),b=d.subtract(y.position,v);-1===S.clockwise(b)?f.positioned||this.createRing(f,v,C,y):f.positioned||this.createRing(f,v,y,C)}else if(1===m.length){e.isSpiro=!0,f.isSpiro=!0;var A=this.graph.vertices[m[0]],I=d.subtract(t,A.position);I.invert(),I.normalize();var R=s.polyCircumradius(this.opts.bondLength,f.getSize());I.multiplyScalar(R),I.add(A.position),f.positioned||this.createRing(f,I,A)}}}for(p=0;p<e.members.length;p++)for(var D=this.graph.vertices[e.members[p]],N=D.neighbours,P=0;P<N.length;P++){var x=this.graph.vertices[N[P]];x.positioned||(x.value.isConnectedToRing=!0,this.createNextBond(x,D,0))}}}},{key:"rotateSubtree",value:function(e,t,r,n){var i=this;this.graph.traverseTree(e,t,(function(e){e.position.rotateAround(r,n);for(var t=0;t<e.value.anchoredRings.length;t++){var o=i.rings[e.value.anchoredRings[t]];o&&o.center.rotateAround(r,n)}}))}},{key:"getSubtreeOverlapScore",value:function(e,t,r){var n=this,i=0,o=new d(0,0),a=0;return this.graph.traverseTree(e,t,(function(e){if(e.value.isDrawn){var t=r[e.id];t>n.opts.overlapSensitivity&&(i+=t,a++);var s=n.graph.vertices[e.id].position.clone();s.multiplyScalar(t),o.add(s)}})),o.divide(i),{value:i/a,center:o}}},{key:"getCurrentCenterOfMass",value:function(){for(var e=new d(0,0),t=0,r=0;r<this.graph.vertices.length;r++){var n=this.graph.vertices[r];n.positioned&&(e.add(n.position),t++)}return e.divide(t)}},{key:"getCurrentCenterOfMassInNeigbourhood",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2*this.opts.bondLength,r=new d(0,0),n=0,i=t*t,o=0;o<this.graph.vertices.length;o++){var a=this.graph.vertices[o];a.positioned&&e.distanceSq(a.position)<i&&(r.add(a.position),n++)}return r.divide(n)}},{key:"resolvePrimaryOverlaps",value:function(){for(var e=Array(),t=Array(this.graph.vertices.length),r=0;r<this.rings.length;r++)for(var n=this.rings[r],i=0;i<n.members.length;i++){var o=this.graph.vertices[n.members[i]];if(!t[o.id]){t[o.id]=!0;var a=this.getNonRingNeighbours(o.id);if(a.length>1){for(var s=Array(),l=0;l<o.value.rings.length;l++)s.push(o.value.rings[l]);e.push({common:o,rings:s,vertices:a})}else if(1===a.length&&2===o.value.rings.length){var d=Array();for(l=0;l<o.value.rings.length;l++)d.push(o.value.rings[l]);e.push({common:o,rings:d,vertices:a})}}}for(r=0;r<e.length;r++){var u=e[r];if(2===u.vertices.length){var c=u.vertices[0],h=u.vertices[1];if(!c.value.isDrawn||!h.value.isDrawn)continue;var p=(2*Math.PI-this.getRing(u.rings[0]).getAngle())/6;this.rotateSubtree(c.id,u.common.id,p,u.common.position),this.rotateSubtree(h.id,u.common.id,-p,u.common.position);var g=this.getOverlapScore(),f=this.getSubtreeOverlapScore(c.id,u.common.id,g.vertexScores),m=this.getSubtreeOverlapScore(h.id,u.common.id,g.vertexScores),C=f.value+m.value;this.rotateSubtree(c.id,u.common.id,-2*p,u.common.position),this.rotateSubtree(h.id,u.common.id,2*p,u.common.position),g=this.getOverlapScore(),f=this.getSubtreeOverlapScore(c.id,u.common.id,g.vertexScores),m=this.getSubtreeOverlapScore(h.id,u.common.id,g.vertexScores),f.value+m.value>C&&(this.rotateSubtree(c.id,u.common.id,2*p,u.common.position),this.rotateSubtree(h.id,u.common.id,-2*p,u.common.position))}else 1===u.vertices.length&&u.rings.length}}},{key:"resolveSecondaryOverlaps",value:function(e){for(var t=0;t<e.length;t++)if(e[t].score>this.opts.overlapSensitivity){var r=this.graph.vertices[e[t].id];if(r.isTerminal()){var n=this.getClosestVertex(r);if(n){var i=null;i=n.isTerminal()?0===n.id?this.graph.vertices[1].position:n.previousPosition:0===n.id?this.graph.vertices[1].position:n.position;var o=0===r.id?this.graph.vertices[1].position:r.previousPosition;r.position.rotateAwayFrom(i,o,s.toRad(20))}}}}},{key:"getLastVertexWithAngle",value:function(e){for(var t=0,r=null;!t&&e;)t=(r=this.graph.vertices[e]).angle,e=r.parentVertexId;return r}},{key:"createNextBond",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!e.positioned||i){var o=!1;if(t){var a=this.graph.getEdge(e.id,t.id);"/"!==a.bondType&&"\\"!==a.bondType||++this.doubleBondConfigCount%2!==1||null===this.doubleBondConfig&&(this.doubleBondConfig=a.bondType,o=!0,null===t.parentVertexId&&e.value.branchBond&&("/"===this.doubleBondConfig?this.doubleBondConfig="\\":"\\"===this.doubleBondConfig&&(this.doubleBondConfig="/")))}if(!i)if(t)if(t.value.rings.length>0){var u=t.neighbours,c=null,h=new d(0,0);if(null===t.value.bridgedRing&&t.value.rings.length>1)for(var p=0;p<u.length;p++){var g=this.graph.vertices[u[p]];if(l.containsAll(g.value.rings,t.value.rings)){c=g;break}}if(null===c){for(p=0;p<u.length;p++){var f=this.graph.vertices[u[p]];f.positioned&&this.areVerticesInSameRing(f,t)&&h.add(d.subtract(f.position,t.position))}h.invert().normalize().multiplyScalar(this.opts.bondLength).add(t.position)}else h=c.position.clone().rotateAround(Math.PI,t.position);e.previousPosition=t.position,e.setPositionFromVector(h),e.positioned=!0}else{var m=new d(this.opts.bondLength,0);m.rotate(r),m.add(t.position),e.setPositionFromVector(m),e.previousPosition=t.position,e.positioned=!0}else{var C=new d(this.opts.bondLength,0);C.rotate(s.toRad(-60)),e.previousPosition=C,e.setPosition(this.opts.bondLength,0),e.angle=s.toRad(-60),null===e.value.bridgedRing&&(e.positioned=!0)}if(null!==e.value.bridgedRing){var y=this.getRing(e.value.bridgedRing);if(!y.positioned){var _=d.subtract(e.previousPosition,e.position);_.invert(),_.normalize();var E=s.polyCircumradius(this.opts.bondLength,y.members.length);_.multiplyScalar(E),_.add(e.position),this.createRing(y,_,e)}}else if(e.value.rings.length>0){var T=this.getRing(e.value.rings[0]);if(!T.positioned){var O=d.subtract(e.previousPosition,e.position);O.invert(),O.normalize();var v=s.polyCircumradius(this.opts.bondLength,T.getSize());O.multiplyScalar(v),O.add(e.position),this.createRing(T,O,e)}}else{e.value.isStereoCenter;var S=e.getNeighbours(),b=Array();for(p=0;p<S.length;p++)this.graph.vertices[S[p]].value.isDrawn&&b.push(S[p]);t&&(b=l.remove(b,t.id));var A=e.getAngle();if(1===b.length){var I=this.graph.vertices[b[0]];if("#"===e.value.bondType||t&&"#"===t.value.bondType||"="===e.value.bondType&&t&&0===t.value.rings.length&&"="===t.value.bondType&&"-"!==e.value.branchBond){if(e.value.drawExplicit=!1,t){var R=this.graph.getEdge(e.id,t.id);R.center=!0}var D=this.graph.getEdge(e.id,I.id);D.center=!0,("#"===e.value.bondType||t&&"#"===t.value.bondType)&&(I.angle=0),I.drawExplicit=!0,this.createNextBond(I,e,A+I.angle)}else if(t&&t.value.rings.length>0){var N=s.toRad(60),P=-N,x=new d(this.opts.bondLength,0),M=new d(this.opts.bondLength,0);x.rotate(N).add(e.position),M.rotate(P).add(e.position);var L=this.getCurrentCenterOfMass(),w=x.distanceSq(L),k=M.distanceSq(L);I.angle=w<k?P:N,this.createNextBond(I,e,A+I.angle)}else{var B=e.angle;if(t&&t.neighbours.length>3)B=B>0?Math.min(1.0472,B):B<0?Math.max(-1.0472,B):1.0472;else if(!B){var j=this.getLastVertexWithAngle(e.id);(B=j.angle)||(B=1.0472)}if(t&&!o){var U=this.graph.getEdge(e.id,I.id).bondType;"/"===U?("/"===this.doubleBondConfig||"\\"===this.doubleBondConfig&&(B=-B),this.doubleBondConfig=null):"\\"===U&&("/"===this.doubleBondConfig?B=-B:this.doubleBondConfig,this.doubleBondConfig=null)}I.angle=n?B:-B,this.createNextBond(I,e,A+I.angle)}}else if(2===b.length){var F=e.angle;F||(F=1.0472);var W=this.graph.getTreeDepth(b[0],e.id),V=this.graph.getTreeDepth(b[1],e.id),H=this.graph.vertices[b[0]],G=this.graph.vertices[b[1]];H.value.subtreeDepth=W,G.value.subtreeDepth=V;var z=this.graph.getTreeDepth(t?t.id:null,e.id);t&&(t.value.subtreeDepth=z);var K=0,Y=1;"C"===G.value.element&&"C"!==H.value.element&&V>1&&W<5?(K=1,Y=0):"C"!==G.value.element&&"C"===H.value.element&&W>1&&V<5?(K=0,Y=1):V>W&&(K=1,Y=0);var X=this.graph.vertices[b[K]],$=this.graph.vertices[b[Y]],q=(this.graph.getEdge(e.id,X.id),this.graph.getEdge(e.id,$.id),!1);z<W&&z<V&&(q=!0),$.angle=F,X.angle=-F,"\\"===this.doubleBondConfig?"\\"===$.value.branchBond&&($.angle=-F,X.angle=F):"/"===this.doubleBondConfig&&"/"===$.value.branchBond&&($.angle=-F,X.angle=F),this.createNextBond($,e,A+$.angle,q),this.createNextBond(X,e,A+X.angle,q)}else if(3===b.length){var J=this.graph.getTreeDepth(b[0],e.id),Z=this.graph.getTreeDepth(b[1],e.id),Q=this.graph.getTreeDepth(b[2],e.id),ee=this.graph.vertices[b[0]],te=this.graph.vertices[b[1]],re=this.graph.vertices[b[2]];ee.value.subtreeDepth=J,te.value.subtreeDepth=Z,re.value.subtreeDepth=Q,Z>J&&Z>Q?(ee=this.graph.vertices[b[1]],te=this.graph.vertices[b[0]],re=this.graph.vertices[b[2]]):Q>J&&Q>Z&&(ee=this.graph.vertices[b[2]],te=this.graph.vertices[b[0]],re=this.graph.vertices[b[1]]),t&&t.value.rings.length<1&&ee.value.rings.length<1&&te.value.rings.length<1&&re.value.rings.length<1&&1===this.graph.getTreeDepth(te.id,e.id)&&1===this.graph.getTreeDepth(re.id,e.id)&&this.graph.getTreeDepth(ee.id,e.id)>1?(ee.angle=-e.angle,e.angle>=0?(te.angle=s.toRad(30),re.angle=s.toRad(90)):(te.angle=-s.toRad(30),re.angle=-s.toRad(90)),this.createNextBond(ee,e,A+ee.angle),this.createNextBond(te,e,A+te.angle),this.createNextBond(re,e,A+re.angle)):(ee.angle=0,te.angle=s.toRad(90),re.angle=-s.toRad(90),this.createNextBond(ee,e,A+ee.angle),this.createNextBond(te,e,A+te.angle),this.createNextBond(re,e,A+re.angle))}else if(4===b.length){var ne=this.graph.getTreeDepth(b[0],e.id),ie=this.graph.getTreeDepth(b[1],e.id),oe=this.graph.getTreeDepth(b[2],e.id),ae=this.graph.getTreeDepth(b[3],e.id),se=this.graph.vertices[b[0]],le=this.graph.vertices[b[1]],de=this.graph.vertices[b[2]],ue=this.graph.vertices[b[3]];se.value.subtreeDepth=ne,le.value.subtreeDepth=ie,de.value.subtreeDepth=oe,ue.value.subtreeDepth=ae,ie>ne&&ie>oe&&ie>ae?(se=this.graph.vertices[b[1]],le=this.graph.vertices[b[0]],de=this.graph.vertices[b[2]],ue=this.graph.vertices[b[3]]):oe>ne&&oe>ie&&oe>ae?(se=this.graph.vertices[b[2]],le=this.graph.vertices[b[0]],de=this.graph.vertices[b[1]],ue=this.graph.vertices[b[3]]):ae>ne&&ae>ie&&ae>oe&&(se=this.graph.vertices[b[3]],le=this.graph.vertices[b[0]],de=this.graph.vertices[b[1]],ue=this.graph.vertices[b[2]]),se.angle=-s.toRad(36),le.angle=s.toRad(36),de.angle=-s.toRad(108),ue.angle=s.toRad(108),this.createNextBond(se,e,A+se.angle),this.createNextBond(le,e,A+le.angle),this.createNextBond(de,e,A+de.angle),this.createNextBond(ue,e,A+ue.angle)}}}}},{key:"getCommonRingbondNeighbour",value:function(e){for(var t=e.neighbours,r=0;r<t.length;r++){var n=this.graph.vertices[t[r]];if(l.containsAll(n.value.rings,e.value.rings))return n}return null}},{key:"isPointInRing",value:function(e){for(var t=0;t<this.rings.length;t++){var r=this.rings[t];if(r.positioned){var n=s.polyCircumradius(this.opts.bondLength,r.getSize()),i=n*n;if(e.distanceSq(r.center)<i)return!0}}return!1}},{key:"isEdgeInRing",value:function(e){var t=this.graph.vertices[e.sourceId],r=this.graph.vertices[e.targetId];return this.areVerticesInSameRing(t,r)}},{key:"isEdgeRotatable",value:function(e){var t=this.graph.vertices[e.sourceId],r=this.graph.vertices[e.targetId];return"-"===e.bondType&&(!t.isTerminal()&&!r.isTerminal()&&!(t.value.rings.length>0&&r.value.rings.length>0&&this.areVerticesInSameRing(t,r)))}},{key:"isRingAromatic",value:function(e){for(var t=0;t<e.members.length;t++){if(!this.graph.vertices[e.members[t]].value.isPartOfAromaticRing)return!1}return!0}},{key:"getEdgeNormals",value:function(e){var t=this.graph.vertices[e.sourceId].position,r=this.graph.vertices[e.targetId].position;return d.units(t,r)}},{key:"getNonRingNeighbours",value:function(e){for(var t=Array(),r=this.graph.vertices[e],n=r.neighbours,i=0;i<n.length;i++){var o=this.graph.vertices[n[i]];0===l.intersection(r.value.rings,o.value.rings).length&&0==o.value.isBridge&&t.push(o)}return t}},{key:"annotateStereochemistry",value:function(){for(var e=0;e<this.graph.vertices.length;e++){var t=this.graph.vertices[e];if(t.value.isStereoCenter){for(var r=t.getNeighbours(),n=r.length,i=Array(n),o=0;o<n;o++){var a=new Uint8Array(this.graph.vertices.length),l=Array(Array());a[t.id]=1,this.visitStereochemistry(r[o],t.id,a,l,10,0);for(var d=0;d<l.length;d++)l[d].sort((function(e,t){return t-e}));i[o]=[o,l]}var u=0,c=0;for(o=0;o<i.length;o++){i[o][1].length>u&&(u=i[o][1].length);for(d=0;d<i[o][1].length;d++)i[o][1][d].length>c&&(c=i[o][1][d].length)}for(o=0;o<i.length;o++){var h=u-i[o][1].length;for(d=0;d<h;d++)i[o][1].push([]);i[o][1].push([r[o]]);for(d=0;d<i[o][1].length;d++)for(var p=c-i[o][1][d].length,g=0;g<p;g++)i[o][1][d].push(0)}i.sort((function(e,t){for(var r=0;r<e[1].length;r++)for(var n=0;n<e[1][r].length;n++){if(e[1][r][n]>t[1][r][n])return-1;if(e[1][r][n]<t[1][r][n])return 1}return 0}));var f=new Uint8Array(n);for(o=0;o<n;o++)f[o]=i[o][0],t.value.priority=o;var m=this.graph.vertices[r[f[0]]].position,C=this.graph.vertices[r[f[1]]].position,y=this.graph.vertices[r[f[2]]].position,_=m.relativeClockwise(C,t.position),E=(m.relativeClockwise(y,t.position),-1===_),T="@"===t.value.bracket.chirality?-1:1,O=s.parityOfPermutation(f)*T===1?"R":"S",v="down",S="up";(E&&"R"!==O||!E&&"S"!==O)&&(t.value.hydrogenDirection="up",v="up",S="down"),t.value.hasHydrogen&&(this.graph.getEdge(t.id,r[f[f.length-1]]).wedge=v);var b=new Array(r.length-1),A=t.value.rings.length>1&&t.value.hasHydrogen,I=t.value.hasHydrogen?1:0;for(o=0;o<f.length-I;o++){b[o]=new Uint32Array(2);var R=this.graph.vertices[r[f[o]]];b[o][0]+=R.value.isStereoCenter?0:1e5,b[o][0]+=this.areVerticesInSameRing(R,t)?0:1e4,b[o][0]+=R.value.isHeteroAtom()?1e3:0,b[o][0]-=0===R.value.subtreeDepth?1e3:0,b[o][0]+=1e3-R.value.subtreeDepth,b[o][1]=r[f[o]]}if(b.sort((function(e,t){return e[0]>t[0]?-1:e[0]<t[0]?1:0})),!A){var D=b[0][1];if(t.value.hasHydrogen)this.graph.getEdge(t.id,D).wedge=S;else{var N=S;for(o=f.length-1;o>=0&&(N=N===v?S:v,r[f[o]]!==D);o--);this.graph.getEdge(t.id,D).wedge=N}}t.value.chirality=O}}}},{key:"visitStereochemistry",value:function(e,t,r,n,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;r[e]=1;var s=this.graph.vertices[e],l=s.value.getAtomicNumber();n.length<=o&&n.push(Array());for(var d=0;d<this.graph.getEdge(e,t).weight;d++)n[o].push(1e3*a+l);var u=this.graph.vertices[e].neighbours;for(d=0;d<u.length;d++)1!==r[u[d]]&&o<i-1&&this.visitStereochemistry(u[d],e,r.slice(),n,i,o+1,l);if(o<i-1){var c=0;for(d=0;d<u.length;d++)c+=this.graph.getEdge(e,u[d]).weight;for(d=0;d<s.value.getMaxBonds()-c;d++)n.length<=o+1&&n.push(Array()),n[o+1].push(1e3*l+1)}}},{key:"initPseudoElements",value:function(){for(var e=0;e<this.graph.vertices.length;e++){for(var t=this.graph.vertices[e],r=t.neighbours,n=Array(r.length),i=0;i<r.length;i++)n[i]=this.graph.vertices[r[i]];if(!(t.getNeighbourCount()<3||t.value.rings.length>0)&&("P"!==t.value.element&&("C"!==t.value.element||3!==n.length||"N"!==n[0].value.element||"N"!==n[1].value.element||"N"!==n[2].value.element))){var o=0,a=0;for(i=0;i<n.length;i++){var s=n[i],l=s.value.element,d=s.getNeighbourCount();"C"!==l&&"H"!==l&&1===d&&o++,d>1&&a++}if(!(a>1||o<2)){var u=null;for(i=0;i<n.length;i++){var c=n[i];c.getNeighbourCount()>1&&(u=c)}for(i=0;i<n.length;i++){var p=n[i];if(!(p.getNeighbourCount()>1)){p.value.isDrawn=!1;var g=h.maxBonds[p.value.element]-p.value.bondCount,f="";p.value.bracket&&(g=p.value.bracket.hcount,f=p.value.bracket.charge||0),t.value.attachPseudoElement(p.value.element,u?u.value.element:null,g,f)}}}}}for(e=0;e<this.graph.vertices.length;e++){var m=this.graph.vertices[e],C=m.value,y=C.element;if("C"!==y&&"H"!==y&&C.isDrawn){var _=m.neighbours,E=Array(_.length);for(i=0;i<_.length;i++)E[i]=this.graph.vertices[_[i]];for(i=0;i<E.length;i++){var T=E[i].value;if(T.hasAttachedPseudoElements&&2===T.getAttachedPseudoElementsCount()){var O=T.getAttachedPseudoElements();O.hasOwnProperty("0O")&&O.hasOwnProperty("3C")&&(T.isDrawn=!1,m.value.attachPseudoElement("Ac","",0))}}}}}}]),e}();e.exports=_},8674:function(e,t,r){var n=r(4575).default,i=r(3913).default,o=function(){"use strict";function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;n(this,e),this.id=null,this.sourceId=t,this.targetId=r,this.weight=i,this.bondType="-",this.isPartOfAromaticRing=!1,this.center=!1,this.wedge=""}return i(e,[{key:"setBondType",value:function(t){this.bondType=t,this.weight=e.bonds[t]}}],[{key:"bonds",get:function(){return{"-":1,"/":1,"\\":1,"=":2,"#":3,$:4}}}]),e}();e.exports=o},5901:function(e,t,r){var n=r(3038).default,i=r(4575).default,o=r(3913).default,a=r(5013),s=(r(8357),r(1965)),l=r(8674),d=(r(648),r(8666)),u=function(){"use strict";function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i(this,e),this.vertices=Array(),this.edges=Array(),this.vertexIdsToEdgeId={},this.isomeric=r,this._time=0,this._init(t)}return o(e,[{key:"_init",value:function(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=new d(e.atom.element?e.atom.element:e.atom,e.bond);n.branchBond=e.branchBond,n.ringbonds=e.ringbonds,n.bracket=e.atom.element?e.atom:null;var i=new s(n),o=this.vertices[t];if(this.addVertex(i),null!==t){i.setParentVertexId(t),i.value.addNeighbouringElement(o.value.element),o.addChild(i.id),o.value.addNeighbouringElement(n.element),o.spanningTreeChildren.push(i.id);var a=new l(t,i.id,1);r?(a.setBondType(i.value.branchBond||"-"),i.id,a.setBondType(i.value.branchBond||"-"),i.id):(a.setBondType(o.value.bondType||"-"),o.id);this.addEdge(a)}var u=e.ringbondCount+1;n.bracket&&(u+=n.bracket.hcount);var c=0;if(n.bracket&&n.bracket.chirality){n.isStereoCenter=!0,c=n.bracket.hcount;for(var h=0;h<c;h++)this._init({atom:"H",isBracket:"false",branches:Array(),branchCount:0,ringbonds:Array(),ringbondCount:!1,next:null,hasNext:!1,bond:"-"},h,i.id,!0)}for(h=0;h<e.branchCount;h++)this._init(e.branches[h],h+u,i.id,!0);e.hasNext&&this._init(e.next,e.branchCount+u,i.id)}},{key:"clear",value:function(){this.vertices=Array(),this.edges=Array(),this.vertexIdsToEdgeId={}}},{key:"addVertex",value:function(e){return e.id=this.vertices.length,this.vertices.push(e),e.id}},{key:"addEdge",value:function(e){var t=this.vertices[e.sourceId],r=this.vertices[e.targetId];return e.id=this.edges.length,this.edges.push(e),this.vertexIdsToEdgeId[e.sourceId+"_"+e.targetId]=e.id,this.vertexIdsToEdgeId[e.targetId+"_"+e.sourceId]=e.id,e.isPartOfAromaticRing=t.value.isPartOfAromaticRing&&r.value.isPartOfAromaticRing,t.value.bondCount+=e.weight,r.value.bondCount+=e.weight,t.edges.push(e.id),r.edges.push(e.id),e.id}},{key:"getEdge",value:function(e,t){var r=this.vertexIdsToEdgeId[e+"_"+t];return void 0===r?null:this.edges[r]}},{key:"getEdges",value:function(e){for(var t=Array(),r=this.vertices[e],n=0;n<r.neighbours.length;n++)t.push(this.vertexIdsToEdgeId[e+"_"+r.neighbours[n]]);return t}},{key:"hasEdge",value:function(e,t){return void 0!==this.vertexIdsToEdgeId[e+"_"+t]}},{key:"getVertexList",value:function(){for(var e=[this.vertices.length],t=0;t<this.vertices.length;t++)e[t]=this.vertices[t].id;return e}},{key:"getEdgeList",value:function(){for(var e=Array(this.edges.length),t=0;t<this.edges.length;t++)e[t]=[this.edges[t].sourceId,this.edges[t].targetId];return e}},{key:"getAdjacencyMatrix",value:function(){for(var e=this.vertices.length,t=Array(e),r=0;r<e;r++)t[r]=new Array(e),t[r].fill(0);for(r=0;r<this.edges.length;r++){var n=this.edges[r];t[n.sourceId][n.targetId]=1,t[n.targetId][n.sourceId]=1}return t}},{key:"getComponentsAdjacencyMatrix",value:function(){for(var e=this.vertices.length,t=Array(e),r=this.getBridges(),n=0;n<e;n++)t[n]=new Array(e),t[n].fill(0);for(n=0;n<this.edges.length;n++){var i=this.edges[n];t[i.sourceId][i.targetId]=1,t[i.targetId][i.sourceId]=1}for(n=0;n<r.length;n++)t[r[n][0]][r[n][1]]=0,t[r[n][1]][r[n][0]]=0;return t}},{key:"getSubgraphAdjacencyMatrix",value:function(e){for(var t=e.length,r=Array(t),n=0;n<t;n++){r[n]=new Array(t),r[n].fill(0);for(var i=0;i<t;i++)n!==i&&this.hasEdge(e[n],e[i])&&(r[n][i]=1)}return r}},{key:"getDistanceMatrix",value:function(){for(var e=this.vertices.length,t=this.getAdjacencyMatrix(),r=Array(e),n=0;n<e;n++)r[n]=Array(e),r[n].fill(1/0);for(n=0;n<e;n++)for(var i=0;i<e;i++)1===t[n][i]&&(r[n][i]=1);for(var o=0;o<e;o++)for(n=0;n<e;n++)for(i=0;i<e;i++)r[n][i]>r[n][o]+r[o][i]&&(r[n][i]=r[n][o]+r[o][i]);return r}},{key:"getSubgraphDistanceMatrix",value:function(e){for(var t=e.length,r=this.getSubgraphAdjacencyMatrix(e),n=Array(t),i=0;i<t;i++)n[i]=Array(t),n[i].fill(1/0);for(i=0;i<t;i++)for(var o=0;o<t;o++)1===r[i][o]&&(n[i][o]=1);for(var a=0;a<t;a++)for(i=0;i<t;i++)for(o=0;o<t;o++)n[i][o]>n[i][a]+n[a][o]&&(n[i][o]=n[i][a]+n[a][o]);return n}},{key:"getAdjacencyList",value:function(){for(var e=this.vertices.length,t=Array(e),r=0;r<e;r++){t[r]=[];for(var n=0;n<e;n++)r!==n&&this.hasEdge(this.vertices[r].id,this.vertices[n].id)&&t[r].push(n)}return t}},{key:"getSubgraphAdjacencyList",value:function(e){for(var t=e.length,r=Array(t),n=0;n<t;n++){r[n]=Array();for(var i=0;i<t;i++)n!==i&&this.hasEdge(e[n],e[i])&&r[n].push(i)}return r}},{key:"getBridges",value:function(){var e=this.vertices.length,t=new Array(e),r=new Array(e),n=new Array(e),i=new Array(e),o=this.getAdjacencyList(),a=Array();t.fill(!1),i.fill(null),this._time=0;for(var s=0;s<e;s++)t[s]||this._bridgeDfs(s,t,r,n,i,o,a);return a}},{key:"traverseBF",value:function(e,t){var r=this.vertices.length,n=new Array(r);n.fill(!1);for(var i=[e];i.length>0;){var o=i.shift(),a=this.vertices[o];t(a);for(var s=0;s<a.neighbours.length;s++){var l=a.neighbours[s];n[l]||(n[l]=!0,i.push(l))}}}},{key:"getTreeDepth",value:function(e,t){if(null===e||null===t)return 0;for(var r=this.vertices[e].getSpanningTreeNeighbours(t),n=0,i=0;i<r.length;i++){var o=r[i],a=this.getTreeDepth(o,e);a>n&&(n=a)}return n+1}},{key:"traverseTree",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:999999,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(null===a&&(a=new Uint8Array(this.vertices.length)),!(o>n+1||1===a[e])){a[e]=1;var s=this.vertices[e],l=s.getNeighbours(t);(!i||o>1)&&r(s);for(var d=0;d<l.length;d++)this.traverseTree(l[d],e,r,n,i,o+1,a)}}},{key:"kkLayout",value:function(e,t,r,i,o){for(var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.1,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.1,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2e3,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:50,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1e9,h=o,p=e.length;p--;)var g=this.vertices[e[p]],f=g.neighbours.length;var m=this.getSubgraphDistanceMatrix(e),C=e.length,y=a.polyCircumradius(500,C),_=a.centralAngle(C),E=0,T=new Float32Array(C),O=new Float32Array(C),v=Array(C);for(p=C;p--;){var S=this.vertices[e[p]];S.positioned?(T[p]=S.position.x,O[p]=S.position.y):(T[p]=t.x+Math.cos(E)*y,O[p]=t.y+Math.sin(E)*y),v[p]=S.positioned,E+=_}var b=Array(C);for(p=C;p--;){b[p]=new Array(C);for(f=C;f--;)b[p][f]=o*m[p][f]}var A=Array(C);for(p=C;p--;){A[p]=Array(C);for(f=C;f--;)A[p][f]=h*Math.pow(m[p][f],-2)}var I,R,D,N,P,x,M,L=Array(C),w=new Float32Array(C),k=new Float32Array(C);for(p=C;p--;)L[p]=Array(C);for(p=C;p--;){I=T[p],R=O[p],D=0,N=0;for(var B=C;B--;)p!==B&&(P=T[B],x=O[B],M=1/Math.sqrt((I-P)*(I-P)+(R-x)*(R-x)),L[p][B]=[A[p][B]*(I-P-b[p][B]*(I-P)*M),A[p][B]*(R-x-b[p][B]*(R-x)*M)],L[B][p]=L[p][B],D+=L[p][B][0],N+=L[p][B][1]);w[p]=D,k[p]=N}for(var j=function(e){return[w[e]*w[e]+k[e]*k[e],w[e],k[e]]},U=function(){var e=0,t=0,r=0,i=0;for(p=C;p--;){var o=j(p),a=n(o,3),s=a[0],l=a[1],d=a[2];s>e&&!1===v[p]&&(e=s,t=p,r=l,i=d)}return[t,e,r,i]},F=function(e,t,r){var n=0,i=0,o=0,a=T[e],s=O[e],l=b[e],d=A[e];for(p=C;p--;)if(p!==e){var u=T[p],c=O[p],h=l[p],g=d[p],f=(a-u)*(a-u),m=1/Math.pow(f+(s-c)*(s-c),1.5);n+=g*(1-h*(s-c)*(s-c)*m),i+=g*(1-h*f*m),o+=g*(h*(a-u)*(s-c)*m)}0===n&&(n=.1),0===i&&(i=.1),0===o&&(o=.1);var y=t/n+r/o,_=-(o*(y/=o/n-i/o)+t)/n;T[e]+=_,O[e]+=y;var E,v,S,I,R,D=L[e];for(t=0,r=0,a=T[e],s=O[e],p=C;p--;)e!==p&&(E=T[p],v=O[p],S=D[p][0],I=D[p][1],R=1/Math.sqrt((a-E)*(a-E)+(s-v)*(s-v)),_=d[p]*(a-E-l[p]*(a-E)*R),y=d[p]*(s-v-l[p]*(s-v)*R),D[p]=[_,y],t+=_,r+=y,w[p]+=_-S,k[p]+=y-I);w[e]=t,k[e]=r},W=0,V=0,H=0,G=0,z=0,K=0;c>s&&d>z;){z++;var Y=U(),X=n(Y,4);for(W=X[0],c=X[1],V=X[2],H=X[3],G=c,K=0;G>l&&u>K;){K++,F(W,V,H);var $=j(W),q=n($,3);G=q[0],V=q[1],H=q[2]}}for(p=C;p--;){var J=e[p],Z=this.vertices[J];Z.position.x=T[p],Z.position.y=O[p],Z.positioned=!0,Z.forcePositioned=!0}}},{key:"_bridgeDfs",value:function(e,t,r,n,i,o,a){t[e]=!0,r[e]=n[e]=++this._time;for(var s=0;s<o[e].length;s++){var l=o[e][s];t[l]?l!==i[e]&&(n[e]=Math.min(n[e],r[l])):(i[l]=e,this._bridgeDfs(l,t,r,n,i,o,a),n[e]=Math.min(n[e],n[l]),n[l]>r[e]&&a.push([e,l]))}}}],[{key:"getConnectedComponents",value:function(t){var r=t.length,n=new Array(r),i=new Array;n.fill(!1);for(var o=0;o<r;o++)if(!n[o]){var a=Array();n[o]=!0,a.push(o),e._ccGetDfs(o,n,t,a),a.length>1&&i.push(a)}return i}},{key:"getConnectedComponentCount",value:function(t){var r=t.length,n=new Array(r),i=0;n.fill(!1);for(var o=0;o<r;o++)n[o]||(n[o]=!0,i++,e._ccCountDfs(o,n,t));return i}},{key:"_ccCountDfs",value:function(t,r,n){for(var i=0;i<n[t].length;i++){n[t][i]&&!r[i]&&t!==i&&(r[i]=!0,e._ccCountDfs(i,r,n))}}},{key:"_ccGetDfs",value:function(t,r,n,i){for(var o=0;o<n[t].length;o++){n[t][o]&&!r[o]&&t!==o&&(r[o]=!0,i.push(o),e._ccGetDfs(o,r,n,i))}}}]),e}();e.exports=u},1423:function(e,t,r){var n=r(4575).default,i=r(3913).default,o=r(8357),a=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o(0,0),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o(0,0),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];n(this,e),this.from=t,this.to=r,this.elementFrom=i,this.elementTo=a,this.chiralFrom=s,this.chiralTo=l}return i(e,[{key:"clone",value:function(){return new e(this.from.clone(),this.to.clone(),this.elementFrom,this.elementTo)}},{key:"getLength",value:function(){return Math.sqrt(Math.pow(this.to.x-this.from.x,2)+Math.pow(this.to.y-this.from.y,2))}},{key:"getAngle",value:function(){return o.subtract(this.getRightVector(),this.getLeftVector()).angle()}},{key:"getRightVector",value:function(){return this.from.x<this.to.x?this.to:this.from}},{key:"getLeftVector",value:function(){return this.from.x<this.to.x?this.from:this.to}},{key:"getRightElement",value:function(){return this.from.x<this.to.x?this.elementTo:this.elementFrom}},{key:"getLeftElement",value:function(){return this.from.x<this.to.x?this.elementFrom:this.elementTo}},{key:"getRightChiral",value:function(){return this.from.x<this.to.x?this.chiralTo:this.chiralFrom}},{key:"getLeftChiral",value:function(){return this.from.x<this.to.x?this.chiralFrom:this.chiralTo}},{key:"setRightVector",value:function(e,t){return this.from.x<this.to.x?(this.to.x=e,this.to.y=t):(this.from.x=e,this.from.y=t),this}},{key:"setLeftVector",value:function(e,t){return this.from.x<this.to.x?(this.from.x=e,this.from.y=t):(this.to.x=e,this.to.y=t),this}},{key:"rotateToXAxis",value:function(){var e=this.getLeftVector();return this.setRightVector(e.x+this.getLength(),e.y),this}},{key:"rotate",value:function(e){var t=this.getLeftVector(),r=this.getRightVector(),n=Math.sin(e),i=Math.cos(e),o=i*(r.x-t.x)-n*(r.y-t.y)+t.x,a=n*(r.x-t.x)-i*(r.y-t.y)+t.y;return this.setRightVector(o,a),this}},{key:"shortenFrom",value:function(e){var t=o.subtract(this.to,this.from);return t.normalize(),t.multiplyScalar(e),this.from.add(t),this}},{key:"shortenTo",value:function(e){var t=o.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e),this.to.add(t),this}},{key:"shortenRight",value:function(e){return this.from.x<this.to.x?this.shortenTo(e):this.shortenFrom(e),this}},{key:"shortenLeft",value:function(e){return this.from.x<this.to.x?this.shortenFrom(e):this.shortenTo(e),this}},{key:"shorten",value:function(e){var t=o.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e/2),this.to.add(t),this.from.subtract(t),this}}]),e}();e.exports=a},5013:function(e,t,r){var n=r(4575).default,i=r(3913).default,o=function(){"use strict";function e(){n(this,e)}return i(e,null,[{key:"round",value:function(e,t){return t=t||1,Number(Math.round(e+"e"+t)+"e-"+t)}},{key:"meanAngle",value:function(e){for(var t=0,r=0,n=0;n<e.length;n++)t+=Math.sin(e[n]),r+=Math.cos(e[n]);return Math.atan2(t/e.length,r/e.length)}},{key:"innerAngle",value:function(t){return e.toRad(180*(t-2)/t)}},{key:"polyCircumradius",value:function(e,t){return e/(2*Math.sin(Math.PI/t))}},{key:"apothem",value:function(e,t){return e*Math.cos(Math.PI/t)}},{key:"apothemFromSideLength",value:function(t,r){var n=e.polyCircumradius(t,r);return e.apothem(n,r)}},{key:"centralAngle",value:function(t){return e.toRad(360/t)}},{key:"toDeg",value:function(t){return t*e.degFactor}},{key:"toRad",value:function(t){return t*e.radFactor}},{key:"parityOfPermutation",value:function(e){for(var t=new Uint8Array(e.length),r=0,n=function r(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 1===t[n]?i:(i++,t[n]=1,r(e[n],i))},i=0;i<e.length;i++){if(1!==t[i])r+=1-n(i)%2}return r%2?-1:1}},{key:"radFactor",get:function(){return Math.PI/180}},{key:"degFactor",get:function(){return 180/Math.PI}},{key:"twoPI",get:function(){return 2*Math.PI}}]),e}();e.exports=o},9128:function(e){e.exports=function(){"use strict";function e(t,r,n,i){this.message=t,this.expected=r,this.found=n,this.location=i,this.name="SyntaxError","function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){var r={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?o(e.parts[t][0])+"-"+o(e.parts[t][1]):o(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function o(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}return"Expected "+function(e){var t,n,i,o=new Array(e.length);for(t=0;t<e.length;t++)o[t]=(i=e[t],r[i.type](i));if(o.sort(),o.length>0){for(t=1,n=1;t<o.length;t++)o[t-1]!==o[t]&&(o[n]=o[t],n++);o.length=n}switch(o.length){case 1:return o[0];case 2:return o[0]+" or "+o[1];default:return o.slice(0,-1).join(", ")+", or "+o[o.length-1]}}(e)+" but "+function(e){return e?'"'+i(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,r){if(r=void 0!==r?r:{},t.split("(").length-1!==t.split(")").length-1)throw ge("The number of opening parentheses does not match the number of closing parentheses.",0);var n,i={},o={chain:me},a=me,s=de("(",!1),l=de(")",!1),d=/^[\-=#$:\/\\.]/,u=ue(["-","=","#","$",":","/","\\","."],!1,!1),c=de("[",!1),h="se",p=de("se",!1),g="as",f=de("as",!1),m=de("]",!1),C=de("B",!1),y=de("r",!1),_=de("C",!1),E=de("l",!1),T=/^[NOPSFI]/,O=ue(["N","O","P","S","F","I"],!1,!1),v=/^[bcnops]/,S=ue(["b","c","n","o","p","s"],!1,!1),b=de("*",!1),A=/^[A-Z]/,I=ue([["A","Z"]],!1,!1),R=/^[a-z]/,D=ue([["a","z"]],!1,!1),N=de("%",!1),P=/^[1-9]/,x=ue([["1","9"]],!1,!1),M=/^[0-9]/,L=ue([["0","9"]],!1,!1),w="@",k=de("@",!1),B="TH",j=de("TH",!1),U=/^[12]/,F=ue(["1","2"],!1,!1),W="AL",V=de("AL",!1),H="SP",G=de("SP",!1),z=/^[1-3]/,K=ue([["1","3"]],!1,!1),Y="TB",X=de("TB",!1),$="OH",q=de("OH",!1),J="+",Z=de("+",!1),Q="-",ee=de("-",!1),te=de("H",!1),re=de(":",!1),ne=/^[0]/,ie=ue(["0"],!1,!1),oe=0,ae=[{line:1,column:1}],se=0,le=[];if("startRule"in r){if(!(r.startRule in o))throw new Error("Can't start parsing from rule \""+r.startRule+'".');a=o[r.startRule]}function de(e,t){return{type:"literal",text:e,ignoreCase:t}}function ue(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function ce(e){var r,n=ae[e];if(n)return n;for(r=e-1;!ae[r];)r--;for(n={line:(n=ae[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return ae[e]=n,n}function he(e,t){var r=ce(e),n=ce(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function pe(e){oe<se||(oe>se&&(se=oe,le=[]),le.push(e))}function ge(t,r){return new e(t,null,null,r)}function fe(t,r,n){return new e(e.buildMessage(t,r),t,r,n)}function me(){var e,r,n,o,a,s,l,d,u,v;if(e=oe,r=oe,n=function(){var e,r;e=oe,r=function(){var e,r,n,o;e=oe,r=oe,66===t.charCodeAt(oe)?(n="B",oe++):(n=i,pe(C));n!==i?(114===t.charCodeAt(oe)?(o="r",oe++):(o=i,pe(y)),o===i&&(o=null),o!==i?r=n=[n,o]:(oe=r,r=i)):(oe=r,r=i);r===i&&(r=oe,67===t.charCodeAt(oe)?(n="C",oe++):(n=i,pe(_)),n!==i?(108===t.charCodeAt(oe)?(o="l",oe++):(o=i,pe(E)),o===i&&(o=null),o!==i?r=n=[n,o]:(oe=r,r=i)):(oe=r,r=i),r===i&&(T.test(t.charAt(oe))?(r=t.charAt(oe),oe++):(r=i,pe(O))));r!==i&&(e,r=(a=r).length>1?a.join(""):a);var a;return e=r}(),r===i&&(r=_e())===i&&(r=function(){var e,r,n,o,a,s,l,d,u,C;e=oe,r=oe,91===t.charCodeAt(oe)?(n="[",oe++):(n=i,pe(c));n!==i?(o=function(){var e,r,n,o,a;e=oe,r=oe,P.test(t.charAt(oe))?(n=t.charAt(oe),oe++):(n=i,pe(x));n!==i?(M.test(t.charAt(oe))?(o=t.charAt(oe),oe++):(o=i,pe(L)),o===i&&(o=null),o!==i?(M.test(t.charAt(oe))?(a=t.charAt(oe),oe++):(a=i,pe(L)),a===i&&(a=null),a!==i?r=n=[n,o,a]:(oe=r,r=i)):(oe=r,r=i)):(oe=r,r=i);r!==i&&(e,r=Number(r.join("")));return e=r}(),o===i&&(o=null),o!==i?(t.substr(oe,2)===h?(a=h,oe+=2):(a=i,pe(p)),a===i&&(t.substr(oe,2)===g?(a=g,oe+=2):(a=i,pe(f)),a===i&&(a=_e())===i&&(a=function(){var e,r,n,o;e=oe,r=oe,A.test(t.charAt(oe))?(n=t.charAt(oe),oe++):(n=i,pe(I));n!==i?(R.test(t.charAt(oe))?(o=t.charAt(oe),oe++):(o=i,pe(D)),o===i&&(o=null),o!==i?r=n=[n,o]:(oe=r,r=i)):(oe=r,r=i);r!==i&&(e,r=r.join(""));return e=r}(),a===i&&(a=Ee()))),a!==i?(s=function(){var e,r,n,o,a,s,l;e=oe,r=oe,64===t.charCodeAt(oe)?(n=w,oe++):(n=i,pe(k));n!==i?(64===t.charCodeAt(oe)?(o=w,oe++):(o=i,pe(k)),o===i&&(o=oe,t.substr(oe,2)===B?(a=B,oe+=2):(a=i,pe(j)),a!==i?(U.test(t.charAt(oe))?(s=t.charAt(oe),oe++):(s=i,pe(F)),s!==i?o=a=[a,s]:(oe=o,o=i)):(oe=o,o=i),o===i&&(o=oe,t.substr(oe,2)===W?(a=W,oe+=2):(a=i,pe(V)),a!==i?(U.test(t.charAt(oe))?(s=t.charAt(oe),oe++):(s=i,pe(F)),s!==i?o=a=[a,s]:(oe=o,o=i)):(oe=o,o=i),o===i&&(o=oe,t.substr(oe,2)===H?(a=H,oe+=2):(a=i,pe(G)),a!==i?(z.test(t.charAt(oe))?(s=t.charAt(oe),oe++):(s=i,pe(K)),s!==i?o=a=[a,s]:(oe=o,o=i)):(oe=o,o=i),o===i&&(o=oe,t.substr(oe,2)===Y?(a=Y,oe+=2):(a=i,pe(X)),a!==i?(P.test(t.charAt(oe))?(s=t.charAt(oe),oe++):(s=i,pe(x)),s!==i?(M.test(t.charAt(oe))?(l=t.charAt(oe),oe++):(l=i,pe(L)),l===i&&(l=null),l!==i?o=a=[a,s,l]:(oe=o,o=i)):(oe=o,o=i)):(oe=o,o=i),o===i&&(o=oe,t.substr(oe,2)===$?(a=$,oe+=2):(a=i,pe(q)),a!==i?(P.test(t.charAt(oe))?(s=t.charAt(oe),oe++):(s=i,pe(x)),s!==i?(M.test(t.charAt(oe))?(l=t.charAt(oe),oe++):(l=i,pe(L)),l===i&&(l=null),l!==i?o=a=[a,s,l]:(oe=o,o=i)):(oe=o,o=i)):(oe=o,o=i)))))),o===i&&(o=null),o!==i?r=n=[n,o]:(oe=r,r=i)):(oe=r,r=i);r!==i&&(e,r=(d=r)[1]?"@"==d[1]?"@@":d[1].join("").replace(",",""):"@");var d;return e=r}(),s===i&&(s=null),s!==i?(l=function(){var e,r,n,o;e=oe,r=oe,72===t.charCodeAt(oe)?(n="H",oe++):(n=i,pe(te));n!==i?(M.test(t.charAt(oe))?(o=t.charAt(oe),oe++):(o=i,pe(L)),o===i&&(o=null),o!==i?r=n=[n,o]:(oe=r,r=i)):(oe=r,r=i);r!==i&&(e,r=(a=r)[1]?Number(a[1]):1);var a;return e=r}(),l===i&&(l=null),l!==i?(d=function(){var e,r;e=oe,r=function(){var e,r,n,o,a,s;e=oe,r=oe,43===t.charCodeAt(oe)?(n=J,oe++):(n=i,pe(Z));n!==i?(43===t.charCodeAt(oe)?(o=J,oe++):(o=i,pe(Z)),o===i&&(o=oe,P.test(t.charAt(oe))?(a=t.charAt(oe),oe++):(a=i,pe(x)),a!==i?(M.test(t.charAt(oe))?(s=t.charAt(oe),oe++):(s=i,pe(L)),s===i&&(s=null),s!==i?o=a=[a,s]:(oe=o,o=i)):(oe=o,o=i)),o===i&&(o=null),o!==i?r=n=[n,o]:(oe=r,r=i)):(oe=r,r=i);r!==i&&(e,r=(l=r)[1]?"+"!=l[1]?Number(l[1].join("")):2:1);var l;return e=r}(),r===i&&(r=function(){var e,r,n,o,a,s;e=oe,r=oe,45===t.charCodeAt(oe)?(n=Q,oe++):(n=i,pe(ee));n!==i?(45===t.charCodeAt(oe)?(o=Q,oe++):(o=i,pe(ee)),o===i&&(o=oe,P.test(t.charAt(oe))?(a=t.charAt(oe),oe++):(a=i,pe(x)),a!==i?(M.test(t.charAt(oe))?(s=t.charAt(oe),oe++):(s=i,pe(L)),s===i&&(s=null),s!==i?o=a=[a,s]:(oe=o,o=i)):(oe=o,o=i)),o===i&&(o=null),o!==i?r=n=[n,o]:(oe=r,r=i)):(oe=r,r=i);r!==i&&(e,r=(l=r)[1]?"-"!=l[1]?-Number(l[1].join("")):-2:-1);var l;return e=r}());r!==i&&e;return e=r}(),d===i&&(d=null),d!==i?(u=function(){var e,r,n,o,a,s,l;e=oe,r=oe,58===t.charCodeAt(oe)?(n=":",oe++):(n=i,pe(re));if(n!==i){if(o=oe,P.test(t.charAt(oe))?(a=t.charAt(oe),oe++):(a=i,pe(x)),a!==i){for(s=[],M.test(t.charAt(oe))?(l=t.charAt(oe),oe++):(l=i,pe(L));l!==i;)s.push(l),M.test(t.charAt(oe))?(l=t.charAt(oe),oe++):(l=i,pe(L));s!==i?o=a=[a,s]:(oe=o,o=i)}else oe=o,o=i;o===i&&(ne.test(t.charAt(oe))?(o=t.charAt(oe),oe++):(o=i,pe(ie))),o!==i?r=n=[n,o]:(oe=r,r=i)}else oe=r,r=i;r!==i&&(e,d=r,r=Number(d[1][0]+d[1][1].join("")));var d;return e=r}(),u===i&&(u=null),u!==i?(93===t.charCodeAt(oe)?(C="]",oe++):(C=i,pe(m)),C!==i?r=n=[n,o,a,s,l,d,u,C]:(oe=r,r=i)):(oe=r,r=i)):(oe=r,r=i)):(oe=r,r=i)):(oe=r,r=i)):(oe=r,r=i)):(oe=r,r=i)):(oe=r,r=i);r!==i&&(e,r={isotope:(y=r)[1],element:y[2],chirality:y[3],hcount:y[4],charge:y[5],class:y[6]});var y;return e=r}(),r===i&&(r=Ee()));r!==i&&e;return e=r}(),n!==i){for(o=[],a=Ce();a!==i;)o.push(a),a=Ce();if(o!==i){for(a=[],s=oe,(l=ye())===i&&(l=null),l!==i&&(d=Te())!==i?s=l=[l,d]:(oe=s,s=i);s!==i;)a.push(s),s=oe,(l=ye())===i&&(l=null),l!==i&&(d=Te())!==i?s=l=[l,d]:(oe=s,s=i);if(a!==i){for(s=[],l=Ce();l!==i;)s.push(l),l=Ce();if(s!==i)if((l=ye())===i&&(l=null),l!==i)if((d=me())===i&&(d=null),d!==i){for(u=[],v=Ce();v!==i;)u.push(v),v=Ce();u!==i?r=n=[n,o,a,s,l,d,u]:(oe=r,r=i)}else oe=r,r=i;else oe=r,r=i;else oe=r,r=i}else oe=r,r=i}else oe=r,r=i}else oe=r,r=i;return r!==i&&(e,r=function(e){for(var t=[],r=[],n=0;n<e[1].length;n++)t.push(e[1][n]);for(n=0;n<e[2].length;n++){var i=e[2][n][0]?e[2][n][0]:"-";r.push({bond:i,id:e[2][n][1]})}for(n=0;n<e[3].length;n++)t.push(e[3][n]);for(n=0;n<e[6].length;n++)t.push(e[6][n]);return{atom:e[0],isBracket:!!e[0].element,branches:t,branchCount:t.length,ringbonds:r,ringbondCount:r.length,bond:e[4]?e[4]:"-",next:e[5],hasNext:!!e[5]}}(r)),e=r}function Ce(){var e,r,n,o,a,d;return e=oe,r=oe,40===t.charCodeAt(oe)?(n="(",oe++):(n=i,pe(s)),n!==i?((o=ye())===i&&(o=null),o!==i&&(a=me())!==i?(41===t.charCodeAt(oe)?(d=")",oe++):(d=i,pe(l)),d!==i?r=n=[n,o,a,d]:(oe=r,r=i)):(oe=r,r=i)):(oe=r,r=i),r!==i&&(e,r=function(e){var t=e[1]?e[1]:"-";return e[2].branchBond=t,e[2]}(r)),e=r}function ye(){var e,r;if(e=oe,d.test(t.charAt(oe))){if((r=t.charAt(oe))===t.charAt(oe+1))throw r=i,ge("The parser encountered a bond repetition.",oe+1);oe++}else r=i,pe(u);return r!==i&&e,e=r}function _e(){var e,r;return e=oe,v.test(t.charAt(oe))?(r=t.charAt(oe),oe++):(r=i,pe(S)),r!==i&&e,e=r}function Ee(){var e,r;return e=oe,42===t.charCodeAt(oe)?(r="*",oe++):(r=i,pe(b)),r!==i&&e,e=r}function Te(){var e,r,n,o,a,s;return e=oe,r=oe,37===t.charCodeAt(oe)?(n="%",oe++):(n=i,pe(N)),n!==i?(P.test(t.charAt(oe))?(o=t.charAt(oe),oe++):(o=i,pe(x)),o!==i?(M.test(t.charAt(oe))?(a=t.charAt(oe),oe++):(a=i,pe(L)),a!==i?r=n=[n,o,a]:(oe=r,r=i)):(oe=r,r=i)):(oe=r,r=i),r===i&&(M.test(t.charAt(oe))?(r=t.charAt(oe),oe++):(r=i,pe(L))),r!==i&&(e,r=1==(s=r).length?Number(s):Number(s.join("").replace("%",""))),e=r}if((n=a())!==i&&oe===t.length)return n;throw n!==i&&oe<t.length&&pe({type:"end"}),fe(le,se<t.length?t.charAt(se):null,se<t.length?he(se,se+1):he(se,se))}}}()},648:function(e,t,r){var n=r(4575).default,i=r(3913).default,o=r(9521),a=r(8357),s=(r(1965),r(6733)),l=function(){"use strict";function e(t){n(this,e),this.id=null,this.members=t,this.edges=[],this.insiders=[],this.neighbours=[],this.positioned=!1,this.center=new a(0,0),this.rings=[],this.isBridged=!1,this.isPartOfBridged=!1,this.isSpiro=!1,this.isFused=!1,this.centralAngle=0,this.canFlip=!0}return i(e,[{key:"clone",value:function(){var t=new e(this.members);return t.id=this.id,t.insiders=o.clone(this.insiders),t.neighbours=o.clone(this.neighbours),t.positioned=this.positioned,t.center=this.center.clone(),t.rings=o.clone(this.rings),t.isBridged=this.isBridged,t.isPartOfBridged=this.isPartOfBridged,t.isSpiro=this.isSpiro,t.isFused=this.isFused,t.centralAngle=this.centralAngle,t.canFlip=this.canFlip,t}},{key:"getSize",value:function(){return this.members.length}},{key:"getPolygon",value:function(e){for(var t=[],r=0;r<this.members.length;r++)t.push(e[this.members[r]].position);return t}},{key:"getAngle",value:function(){return Math.PI-this.centralAngle}},{key:"eachMember",value:function(e,t,r,n){for(var i=r=r||0===r?r:this.members[0],o=0;null!=i&&o<100;){var a=i;t(a),i=e[i].getNextInRing(e,this.id,n),n=a,i==r&&(i=null),o++}}},{key:"getOrderedNeighbours",value:function(e){for(var t=Array(this.neighbours.length),r=0;r<this.neighbours.length;r++){var n=s.getVertices(e,this.id,this.neighbours[r]);t[r]={n:n.length,neighbour:this.neighbours[r]}}return t.sort((function(e,t){return t.n-e.n})),t}},{key:"isBenzeneLike",value:function(e){var t=this.getDoubleBondCount(e),r=this.members.length;return 3===t&&6===r||2===t&&5===r}},{key:"getDoubleBondCount",value:function(e){for(var t=0,r=0;r<this.members.length;r++){var n=e[this.members[r]].value;"="!==n.bondType&&"="!==n.branchBond||t++}return t}},{key:"contains",value:function(e){for(var t=0;t<this.members.length;t++)if(this.members[t]==e)return!0;return!1}}]),e}();e.exports=l},6733:function(e,t,r){var n=r(319).default,i=r(3269).default,o=r(4575).default,a=r(3913).default,s=(r(1965),r(648),function(){"use strict";function e(t,r){o(this,e),this.id=null,this.firstRingId=t.id,this.secondRingId=r.id,this.vertices=new Set;for(var n=0;n<t.members.length;n++)for(var i=t.members[n],a=0;a<r.members.length;a++){i===r.members[a]&&this.addVertex(i)}}return a(e,[{key:"addVertex",value:function(e){this.vertices.add(e)}},{key:"updateOther",value:function(e,t){this.firstRingId===t?this.secondRingId=e:this.firstRingId=e}},{key:"containsRing",value:function(e){return this.firstRingId===e||this.secondRingId===e}},{key:"isBridge",value:function(e){if(this.vertices.size>2)return!0;var t,r=i(this.vertices);try{for(r.s();!(t=r.n()).done;){if(e[t.value].value.rings.length>2)return!0}}catch(n){r.e(n)}finally{r.f()}return!1}}],[{key:"isBridge",value:function(e,t,r,n){for(var i=null,o=0;o<e.length;o++)if((i=e[o]).firstRingId===r&&i.secondRingId===n||i.firstRingId===n&&i.secondRingId===r)return i.isBridge(t);return!1}},{key:"getNeighbours",value:function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];i.firstRingId===t?r.push(i.secondRingId):i.secondRingId===t&&r.push(i.firstRingId)}return r}},{key:"getVertices",value:function(e,t,r){for(var i=0;i<e.length;i++){var o=e[i];if(o.firstRingId===t&&o.secondRingId===r||o.firstRingId===r&&o.secondRingId===t)return n(o.vertices)}}}]),e}());e.exports=s},1105:function(e,t,r){var n=r(3269).default,i=r(319).default,o=r(4575).default,a=r(3913).default,s=r(5901),l=function(){"use strict";function e(){o(this,e)}return a(e,null,[{key:"getRings",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=t.getComponentsAdjacencyMatrix();if(0===o.length)return null;for(var a=s.getConnectedComponents(o),l=Array(),d=0;d<a.length;d++){for(var u=a[d],c=t.getSubgraphAdjacencyMatrix(i(u)),h=new Uint16Array(c.length),p=new Uint16Array(c.length),g=0;g<c.length;g++){p[g]=0,h[g]=0;for(var f=0;f<c[g].length;f++)h[g]+=c[g][f]}var m=0;for(g=0;g<c.length;g++)for(f=g+1;f<c.length;f++)m+=c[g][f];var C=m-c.length+1,y=!0;for(g=0;g<h.length;g++)3!==h[g]&&(y=!1);if(y&&(C=2+m-c.length),1!==C){r&&(C=999);var _=e.getPathIncludedDistanceMatrices(c),E=_.d,T=_.pe,O=_.pe_prime,v=e.getRingCandidates(E,T,O),S=e.getSSSR(v,E,c,T,O,h,p,C);for(g=0;g<S.length;g++){var b,A=Array(S[g].size),I=0,R=n(S[g]);try{for(R.s();!(b=R.n()).done;){var D=b.value;A[I++]=u[D]}}catch(N){R.e(N)}finally{R.f()}l.push(A)}}else l.push(i(u))}return l}},{key:"matrixToString",value:function(e){for(var t="",r=0;r<e.length;r++){for(var n=0;n<e[r].length;n++)t+=e[r][n]+" ";t+="\n"}return t}},{key:"getPathIncludedDistanceMatrices",value:function(e){for(var t=e.length,r=Array(t),n=Array(t),i=Array(t),o=0,a=0,s=0,l=t;l--;){r[l]=Array(t),n[l]=Array(t),i[l]=Array(t);for(var d=t;d--;)r[l][d]=l===d||1===e[l][d]?e[l][d]:Number.POSITIVE_INFINITY,1===r[l][d]?n[l][d]=[[[l,d]]]:n[l][d]=Array(),i[l][d]=Array()}for(var u=t;u--;)for(l=t;l--;)for(d=t;d--;){var c=r[l][d],h=r[l][u]+r[u][d];if(c>h){if(c===h+1)for(i[l][d]=[n[l][d].length],o=n[l][d].length;o--;)for(i[l][d][o]=[n[l][d][o].length],a=n[l][d][o].length;a--;)for(i[l][d][o][a]=[n[l][d][o][a].length],s=n[l][d][o][a].length;s--;)i[l][d][o][a][s]=[n[l][d][o][a][0],n[l][d][o][a][1]];else i[l][d]=Array();for(r[l][d]=h,n[l][d]=[[]],o=n[l][u][0].length;o--;)n[l][d][0].push(n[l][u][0][o]);for(o=n[u][d][0].length;o--;)n[l][d][0].push(n[u][d][0][o])}else if(c===h){if(n[l][u].length&&n[u][d].length)if(n[l][d].length){var p=Array();for(o=n[l][u][0].length;o--;)p.push(n[l][u][0][o]);for(o=n[u][d][0].length;o--;)p.push(n[u][d][0][o]);n[l][d].push(p)}else{var g=Array();for(o=n[l][u][0].length;o--;)g.push(n[l][u][0][o]);for(o=n[u][d][0].length;o--;)g.push(n[u][d][0][o]);n[l][d][0]=g}}else if(c===h-1){if(i[l][d].length){var f=Array();for(o=n[l][u][0].length;o--;)f.push(n[l][u][0][o]);for(o=n[u][d][0].length;o--;)f.push(n[u][d][0][o]);i[l][d].push(f)}else{var m=Array();for(o=n[l][u][0].length;o--;)m.push(n[l][u][0][o]);for(o=n[u][d][0].length;o--;)m.push(n[u][d][0][o]);i[l][d][0]=m}}}return{d:r,pe:n,pe_prime:i}}},{key:"getRingCandidates",value:function(e,t,r){for(var n=e.length,i=Array(),o=0,a=0;a<n;a++)for(var s=0;s<n;s++)0===e[a][s]||1===t[a][s].length&&0===r[a][s]||(o=0!==r[a][s].length?2*(e[a][s]+.5):2*e[a][s])!==1/0&&i.push([o,t[a][s],r[a][s]]);return i.sort((function(e,t){return e[0]-t[0]})),i}},{key:"getSSSR",value:function(t,r,n,i,o,a,s,l){for(var d=Array(),u=Array(),c=0;c<t.length;c++)if(t[c][0]%2!==0)for(var h=0;h<t[c][2].length;h++){for(var p=t[c][1][0].concat(t[c][2][h]),g=0;g<p.length;g++)p[g][0].constructor===Array&&(p[g]=p[g][0]);var f=e.bondsToAtoms(p);if(e.getBondCount(f,n)!==f.size||e.pathSetsContain(d,f,p,u,a,s)||(d.push(f),u=u.concat(p)),d.length>l)return d}else for(var m=0;m<t[c][1].length-1;m++){var C=t[c][1][m].concat(t[c][1][m+1]);for(g=0;g<C.length;g++)C[g][0].constructor===Array&&(C[g]=C[g][0]);var y=e.bondsToAtoms(C);if(e.getBondCount(y,n)!==y.size||e.pathSetsContain(d,y,C,u,a,s)||(d.push(y),u=u.concat(C)),d.length>l)return d}return d}},{key:"getEdgeCount",value:function(e){for(var t=0,r=e.length,n=r-1;n--;)for(var i=r;i--;)1===e[n][i]&&t++;return t}},{key:"getEdgeList",value:function(e){for(var t=e.length,r=Array(),n=t-1;n--;)for(var i=t;i--;)1===e[n][i]&&r.push([n,i]);return r}},{key:"bondsToAtoms",value:function(e){for(var t=new Set,r=e.length;r--;)t.add(e[r][0]),t.add(e[r][1]);return t}},{key:"getBondCount",value:function(e,t){var r,i=0,o=n(e);try{for(o.s();!(r=o.n()).done;){var a,s=r.value,l=n(e);try{for(l.s();!(a=l.n()).done;){var d=a.value;s!==d&&(i+=t[s][d])}}catch(u){l.e(u)}finally{l.f()}}}catch(u){o.e(u)}finally{o.f()}return i/2}},{key:"pathSetsContain",value:function(t,r,i,o,a,s){for(var l=t.length;l--;){if(e.isSupersetOf(r,t[l]))return!0;if(t[l].size===r.size&&e.areSetsEqual(t[l],r))return!0}var d=0,u=!1;for(l=i.length;l--;)for(var c=o.length;c--;)(i[l][0]===o[c][0]&&i[l][1]===o[c][1]||i[l][1]===o[c][0]&&i[l][0]===o[c][1])&&d++,d===i.length&&(u=!0);var h=!1;if(u){var p,g=n(r);try{for(g.s();!(p=g.n()).done;){var f=p.value;if(s[f]<a[f]){h=!0;break}}}catch(y){g.e(y)}finally{g.f()}}if(u&&!h)return!0;var m,C=n(r);try{for(C.s();!(m=C.n()).done;){s[m.value]++}}catch(y){C.e(y)}finally{C.f()}return!1}},{key:"areSetsEqual",value:function(e,t){if(e.size!==t.size)return!1;var r,i=n(e);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(!t.has(o))return!1}}catch(a){i.e(a)}finally{i.f()}return!0}},{key:"isSupersetOf",value:function(e,t){var r,i=n(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(!e.has(o))return!1}}catch(a){i.e(a)}finally{i.f()}return!0}}]),e}();e.exports=l},4310:function(e,t,r){var n=r(4575).default,i=r(3913).default,o=r(9521),a=r(8666),s=r(5879),l=(r(5901),r(1423)),d=r(3907),u=r(496),c=r(8357),h=function(){"use strict";function e(t){n(this,e),this.preprocessor=new s(t)}return i(e,[{key:"draw",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"light",n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.preprocessor;return i.initDraw(e,r,n),n||(this.themeManager=new u(this.preprocessor.opts.themes,r),this.svgWrapper=new d(this.themeManager,t,this.preprocessor.opts)),i.processGraph(),this.svgWrapper.determineDimensions(i.graph.vertices),this.drawEdges(i.opts.debug),this.drawVertices(i.opts.debug),i.opts.debug&&(console.log(i.graph),console.log(i.rings),console.log(i.ringConnections)),this.svgWrapper.constructSvg()}},{key:"drawAromaticityRing",value:function(e){var t=this.ctx,r=MathHelper.apothemFromSideLength(this.opts.bondLength,e.getSize());t.save(),t.strokeStyle=this.getColor("C"),t.lineWidth=this.opts.bondThickness,t.beginPath(),t.arc(e.center.x+this.offsetX,e.center.y+this.offsetY,r-this.opts.bondSpacing,0,2*Math.PI,!0),t.closePath(),t.stroke(),t.restore()}},{key:"drawEdges",value:function(e){var t=this,r=this.preprocessor,n=r.graph,i=r.rings,o=Array(this.preprocessor.graph.edges.length);if(o.fill(!1),n.traverseBF(0,(function(r){for(var i=n.getEdges(r.id),a=0;a<i.length;a++){var s=i[a];o[s]||(o[s]=!0,t.drawEdge(s,e))}})),!this.bridgedRing)for(var a=0;a<i.length;a++){var s=i[a];r.isRingAromatic(s)&&this.drawAromaticityRing(s)}}},{key:"drawEdge",value:function(e,t){var r=this.preprocessor,n=r.opts,i=this.svgWrapper,a=r.graph.edges[e],s=r.graph.vertices[a.sourceId],d=r.graph.vertices[a.targetId],u=s.value.element,h=d.value.element;if(s.value.isDrawn&&d.value.isDrawn||"default"!==r.opts.atomVisualization){var p=s.position,g=d.position,f=r.getEdgeNormals(a),m=o.clone(f);if(m[0].multiplyScalar(10).add(p),m[1].multiplyScalar(10).add(p),"="===a.bondType||"="===r.getRingbondType(s,d)||a.isPartOfAromaticRing&&r.bridgedRing){var C=r.areVerticesInSameRing(s,d),y=r.chooseSide(s,d,m);if(C){var _=r.getLargestOrAromaticCommonRing(s,d).center;f[0].multiplyScalar(n.bondSpacing),f[1].multiplyScalar(n.bondSpacing);var E=null;(E=_.sameSideAs(s.position,d.position,c.add(p,f[0]))?new l(c.add(p,f[0]),c.add(g,f[0]),u,h):new l(c.add(p,f[1]),c.add(g,f[1]),u,h)).shorten(n.bondLength-n.shortBondLength*n.bondLength),a.isPartOfAromaticRing?i.drawLine(E,!0):i.drawLine(E),i.drawLine(new l(p,g,u,h))}else if(a.center||s.isTerminal()&&d.isTerminal()||0==y.anCount&&y.bnCount>1||0==y.bnCount&&y.anCount>1){this.multiplyNormals(f,n.halfBondSpacing);var T=new l(c.add(p,f[0]),c.add(g,f[0]),u,h),O=new l(c.add(p,f[1]),c.add(g,f[1]),u,h);i.drawLine(T),i.drawLine(O)}else if(y.sideCount[0]>y.sideCount[1]||y.totalSideCount[0]>y.totalSideCount[1]){this.multiplyNormals(f,n.bondSpacing);var v=new l(c.add(p,f[0]),c.add(g,f[0]),u,h);v.shorten(n.bondLength-n.shortBondLength*n.bondLength),i.drawLine(v),i.drawLine(new l(p,g,u,h))}else if(y.sideCount[0]<y.sideCount[1]||y.totalSideCount[0]<=y.totalSideCount[1]){this.multiplyNormals(f,n.bondSpacing);var S=new l(c.add(p,f[1]),c.add(g,f[1]),u,h);S.shorten(n.bondLength-n.shortBondLength*n.bondLength),i.drawLine(S),i.drawLine(new l(p,g,u,h))}}else if("#"===a.bondType){f[0].multiplyScalar(n.bondSpacing/1.5),f[1].multiplyScalar(n.bondSpacing/1.5);var b=new l(c.add(p,f[0]),c.add(g,f[0]),u,h),A=new l(c.add(p,f[1]),c.add(g,f[1]),u,h);i.drawLine(b),i.drawLine(A),i.drawLine(new l(p,g,u,h))}else if("."===a.bondType);else{var I=s.value.isStereoCenter,R=d.value.isStereoCenter;"up"===a.wedge?i.drawWedge(new l(p,g,u,h,I,R)):"down"===a.wedge?i.drawDashedWedge(new l(p,g,u,h,I,R)):i.drawLine(new l(p,g,u,h,I,R))}if(t){var D=c.midpoint(p,g);i.drawDebugText(D.x,D.y,"e: "+e)}}}},{key:"drawVertices",value:function(e){var t=this.preprocessor,r=t.opts,n=t.graph,i=t.rings,s=this.svgWrapper,l=n.vertices.length;for(l=0;l<n.vertices.length;l++){var d=n.vertices[l],u=d.value,h=0,p=0,g=d.value.bondCount,f=u.element,m=a.maxBonds[f]-g,C=d.getTextDirection(n.vertices),y=!(!r.terminalCarbons&&"C"===f&&!u.hasAttachedPseudoElements)&&d.isTerminal(),_="C"===u.element;if("N"===u.element&&u.isPartOfAromaticRing&&(m=0),u.bracket&&(m=u.bracket.hcount,h=u.bracket.charge,p=u.bracket.isotope),"allballs"===r.atomVisualization)s.drawBall(d.position.x,d.position.y,f);else if(u.isDrawn&&(!_||u.drawExplicit||y||u.hasAttachedPseudoElements)||1===n.vertices.length)"default"===r.atomVisualization?s.drawText(d.position.x,d.position.y,f,m,C,y,h,p,u.getAttachedPseudoElements()):"balls"===r.atomVisualization&&s.drawBall(d.position.x,d.position.y,f);else if(2===d.getNeighbourCount()&&1==d.forcePositioned){var E=n.vertices[d.neighbours[0]].position,T=n.vertices[d.neighbours[1]].position,O=c.threePointangle(d.position,E,T);Math.abs(Math.PI-O)<.1&&s.drawPoint(d.position.x,d.position.y,f)}if(e){var v="v: "+d.id+" "+o.print(u.ringbonds);s.drawDebugText(d.position.x,d.position.y,v)}else s.drawDebugText(d.position.x,d.position.y,d.value.chirality)}if(r.debug)for(l=0;l<i.length;l++){var S=i[l].center;s.drawDebugPoint(S.x,S.y,"r: "+i[l].id)}}},{key:"getTotalOverlapScore",value:function(){return this.preprocessor.getTotalOverlapScore()}},{key:"getMolecularFormula",value:function(){return this.preprocessor.getMolecularFormula()}},{key:"multiplyNormals",value:function(e,t){e[0].multiplyScalar(t),e[1].multiplyScalar(t)}}]),e}();e.exports=h},3907:function(e,t,r){var n=r(3269).default,i=r(4575).default,o=r(3913).default,a=r(2914).getChargeText,s=r(1423),l=r(8357),d=function(){"use strict";function e(t,r,n){i(this,e),this.svg=document.getElementById(r),this.opts=n,this.gradientId=0,this.paths=[],this.vertices=[],this.gradients=[],this.offsetX=0,this.offsetY=0,this.drawingWidth=0,this.drawingHeight=0,this.halfBondThickness=this.opts.bondThickness/2,this.themeManager=t,this.maskElements=[];var o=document.createElementNS("http://www.w3.org/2000/svg","rect");for(o.setAttributeNS(null,"x",0),o.setAttributeNS(null,"y",0),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"fill","white"),this.maskElements.push(o);this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild)}return o(e,[{key:"constructSvg",value:function(){var e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t=document.createElementNS("http://www.w3.org/2000/svg","mask"),r=document.createElementNS("http://www.w3.org/2000/svg","style"),i=document.createElementNS("http://www.w3.org/2000/svg","g"),o=document.createElementNS("http://www.w3.org/2000/svg","g"),a=this.paths;t.setAttributeNS(null,"id","text-mask"),r.appendChild(document.createTextNode("\n                .element {\n                    font: ".concat(this.opts.fontSizeLarge,"pt Helvetica, Arial, sans-serif;\n                    alignment-baseline: 'middle';\n                }\n                .sub {\n                    font: ").concat(this.opts.fontSizeSmall,"pt Helvetica, Arial, sans-serif;\n                }\n            ")));var s,l=n(a);try{for(l.s();!(s=l.n()).done;){var d=s.value;i.appendChild(d)}}catch(E){l.e(E)}finally{l.f()}var u,c=n(this.vertices);try{for(c.s();!(u=c.n()).done;){var h=u.value;o.appendChild(h)}}catch(E){c.e(E)}finally{c.f()}var p,g=n(this.maskElements);try{for(g.s();!(p=g.n()).done;){var f=p.value;t.appendChild(f)}}catch(E){g.e(E)}finally{g.f()}var m,C=n(this.gradients);try{for(C.s();!(m=C.n()).done;){var y=m.value;e.appendChild(y)}}catch(E){C.e(E)}finally{C.f()}if(i.setAttributeNS(null,"mask","url(#text-mask)"),this.svg)return this.svg.appendChild(e),this.svg.appendChild(t),this.svg.appendChild(r),this.svg.appendChild(i),this.svg.appendChild(o),this.svg;var _=document.createElementNS("http://www.w3.org/2000/svg","g");return _.appendChild(e),_.appendChild(t),_.appendChild(r),_.appendChild(i),_.appendChild(o),_}},{key:"createGradient",value:function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),r="line-".concat(this.gradientId++),n=e.getLeftVector(),i=e.getRightVector(),o=n.x+this.offsetX,a=n.y+this.offsetY,s=i.x+this.offsetX,l=i.y+this.offsetY;t.setAttributeNS(null,"id",r),t.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),t.setAttributeNS(null,"x1",o),t.setAttributeNS(null,"y1",a),t.setAttributeNS(null,"x2",s),t.setAttributeNS(null,"y2",l);var d=document.createElementNS("http://www.w3.org/2000/svg","stop");d.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),d.setAttributeNS(null,"offset","20%");var u=document.createElementNS("http://www.w3.org/2000/svg","stop");return u.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getRightElement()||this.themeManager.getColor("C"))),u.setAttributeNS(null,"offset","100%"),t.appendChild(d),t.appendChild(u),this.gradients.push(t),r}},{key:"createSubSuperScripts",value:function(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return r.setAttributeNS(null,"baseline-shift",t),r.appendChild(document.createTextNode(e)),r.setAttributeNS(null,"class","sub"),r}},{key:"determineDimensions",value:function(e){for(var t=-Number.MAX_VALUE,r=-Number.MAX_VALUE,n=Number.MAX_VALUE,i=Number.MAX_VALUE,o=0;o<e.length;o++)if(e[o].value.isDrawn){var a=e[o].position;t<a.x&&(t=a.x),r<a.y&&(r=a.y),n>a.x&&(n=a.x),i>a.y&&(i=a.y)}var s=this.opts.padding;t+=s,r+=s,n-=s,i-=s,this.drawingWidth=t-n,this.drawingHeight=r-i;var l=this.svg.clientWidth/this.drawingWidth,d=this.svg.clientHeight/this.drawingHeight,u=l<d?l:d,c=Math.round(this.drawingWidth>this.drawingHeight?this.drawingWidth:this.drawingHeight);this.svg.setAttributeNS(null,"viewBox","0 0 ".concat(c," ").concat(c)),this.offsetX=-n,this.offsetY=-i,l<d?this.offsetY+=this.svg.clientHeight/(2*u)-this.drawingHeight/2:this.offsetX+=this.svg.clientWidth/(2*u)-this.drawingWidth/2}},{key:"drawBall",value:function(e,t,r){var n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttributeNS(null,"cx",e+this.offsetX),n.setAttributeNS(null,"cy",t+this.offsetY),n.setAttributeNS(null,"r",this.opts.bondLength/4.5),n.setAttributeNS(null,"fill",this.themeManager.getColor(r)),this.vertices.push(n)}},{key:"drawDashedWedge",value:function(e){if(!(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))){this.offsetX,this.offsetY;var t,r,n=e.getLeftVector().clone(),i=e.getRightVector().clone(),o=l.normals(n,i);o[0].normalize(),o[1].normalize(),e.getRightChiral()?(t=i,r=n):(t=n,r=i);for(var a=l.subtract(r,t).normalize(),d=e.getLength(),u=1.25/(d/(3*this.opts.bondThickness)),c=this.createGradient(e),h=0;h<1;h+=u){var p=l.multiplyScalar(a,h*d),g=l.add(t,p),f=1.5*h,m=l.multiplyScalar(o[0],f);g.subtract(m);var C=g.clone();C.add(l.multiplyScalar(m,2)),this.drawLine(new s(g,C),null,c)}}}},{key:"drawDebugPoint",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttributeNS(null,"cx",e+this.offsetX),n.setAttributeNS(null,"cy",t+this.offsetY),n.setAttributeNS(null,"r","2"),n.setAttributeNS(null,"fill","#f00"),this.vertices.push(n),this.drawDebugText(e,t,r)}},{key:"drawDebugText",value:function(e,t,r){var n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttributeNS(null,"x",e+this.offsetX),n.setAttributeNS(null,"y",t+this.offsetY),n.setAttributeNS(null,"class","debug"),n.setAttributeNS(null,"fill","#ff0000"),n.setAttributeNS(null,"style","\n                font: 5px Droid Sans, sans-serif;\n            "),n.appendChild(document.createTextNode(r)),this.vertices.push(n)}},{key:"drawLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=(this.opts,[["stroke-linecap","round"],["stroke-dasharray",t?"5, 5":"none"]]),i=e.getLeftVector(),o=e.getRightVector(),a=i.x+this.offsetX,s=i.y+this.offsetY,l=o.x+this.offsetX,d=o.y+this.offsetY,u=n.map((function(e){return e.join(":")})).join(";"),c=document.createElementNS("http://www.w3.org/2000/svg","line");c.setAttributeNS(null,"x1",a),c.setAttributeNS(null,"y1",s),c.setAttributeNS(null,"x2",l),c.setAttributeNS(null,"y2",d),c.setAttributeNS(null,"style",u),this.paths.push(c),null==r&&(r=this.createGradient(e,a,s,l,d)),c.setAttributeNS(null,"stroke","url('#".concat(r,"')"))}},{key:"drawPoint",value:function(e,t,r){this.ctx;var n=this.offsetX,i=this.offsetY,o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttributeNS(null,"cx",e+n),o.setAttributeNS(null,"cy",t+i),o.setAttributeNS(null,"r","1.5"),o.setAttributeNS(null,"fill","black"),this.maskElements.push(o);var a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttributeNS(null,"cx",e+n),a.setAttributeNS(null,"cy",t+i),a.setAttributeNS(null,"r","0.75"),a.setAttributeNS(null,"fill",this.themeManager.getColor(r)),this.vertices.push(a)}},{key:"drawText",value:function(e,t,r,n,i,o,s,l){var d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{},u=this.offsetX,c=this.offsetY,h={x:e+u,y:t+c},p=document.createElementNS("http://www.w3.org/2000/svg","text"),g="horizontal-tb",f="normal",m="mixed",C="direction: ltr;",y=-2,_=2.5,E=document.createElementNS("http://www.w3.org/2000/svg","circle");E.setAttributeNS(null,"cx",h.x),E.setAttributeNS(null,"cy",h.y),E.setAttributeNS(null,"r","3.5"),E.setAttributeNS(null,"fill","black"),this.maskElements.push(E),/up|down/.test(i)&&!o&&(g="vertical-rl",m="upright",f="-1px"),"down"!==i||o?"up"!==i||o?"left"===i&&(y=2):y=.5:(y=0,_=-2),("left"===i||"up"===i&&!o)&&(C="direction: rtl; unicode-bidi: bidi-override;"),p.setAttributeNS(null,"x",h.x+y),p.setAttributeNS(null,"y",h.y+_),p.setAttributeNS(null,"class","element"),p.setAttributeNS(null,"fill",this.themeManager.getColor(r)),p.setAttributeNS(null,"style","\n                text-anchor: start;\n                writing-mode: ".concat(g,";\n                text-orientation: ").concat(m,";\n                letter-spacing: ").concat(f,";\n                ").concat(C,"\n            "));var T=document.createElementNS("http://www.w3.org/2000/svg","tspan");if(r.length>1){var O=/up|down/.test(i)?"middle":"start";T.setAttributeNS(null,"style","\n                unicode-bidi: plaintext;\n                writing-mode: lr-tb;\n                letter-spacing: normal;\n                text-anchor: ".concat(O,";\n            "))}if(T.appendChild(document.createTextNode(r)),p.appendChild(T),s){var v=this.createSubSuperScripts(a(s),"super");T.appendChild(v)}if(l>0){var S=this.createSubSuperScripts(l.toString(),"super");T.appendChild(S)}if(1===s&&"N"===r&&d.hasOwnProperty("0O")&&d.hasOwnProperty("0O-1")&&(d={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},s=0),n>0){var b=document.createElementNS("http://www.w3.org/2000/svg","tspan");if(b.setAttributeNS(null,"style","unicode-bidi: plaintext;"),b.appendChild(document.createTextNode("H")),p.appendChild(b),n>1){var A=this.createSubSuperScripts(n,"sub");b.appendChild(A)}}for(var I in d)if(d.hasOwnProperty(I)){var R=d[I].element,D=d[I].count,N=d[I].hydrogenCount,P=d[I].charge,x=document.createElementNS("http://www.w3.org/2000/svg","tspan");if(x.setAttributeNS(null,"style","unicode-bidi: plaintext;"),x.appendChild(document.createTextNode(R)),x.setAttributeNS(null,"fill",this.themeManager.getColor(R)),0!==P){var M=this.createSubSuperScripts(a(P),"super");x.appendChild(M)}if(N>0){var L=document.createElementNS("http://www.w3.org/2000/svg","tspan");if(L.setAttributeNS(null,"style","unicode-bidi: plaintext;"),L.appendChild(document.createTextNode("H")),x.appendChild(L),N>1){var w=this.createSubSuperScripts(N,"sub");L.appendChild(w)}}if(D>1){var k=this.createSubSuperScripts(D,"sub");x.appendChild(k)}p.appendChild(x)}this.vertices.push(p)}},{key:"drawWedge",value:function(e){var t=this.offsetX,r=this.offsetY,n=e.getLeftVector().clone(),i=e.getRightVector().clone();n.x+=t,n.y+=r,i.x+=t,i.y+=r;var o=l.normals(n,i);o[0].normalize(),o[1].normalize();var a=n,s=i;e.getRightChiral()&&(a=i,s=n);var d=l.add(a,l.multiplyScalar(o[0],this.halfBondThickness)),u=l.add(s,l.multiplyScalar(o[0],1.5+this.halfBondThickness)),c=l.add(s,l.multiplyScalar(o[1],1.5+this.halfBondThickness)),h=l.add(a,l.multiplyScalar(o[1],this.halfBondThickness)),p=document.createElementNS("http://www.w3.org/2000/svg","polygon"),g=this.createGradient(e,n.x,n.y,i.x,i.y);p.setAttributeNS(null,"points","".concat(d.x,",").concat(d.y," ").concat(u.x,",").concat(u.y," ").concat(c.x,",").concat(c.y," ").concat(h.x,",").concat(h.y)),p.setAttributeNS(null,"fill","url('#".concat(g,"')")),this.paths.push(p)}}]),e}();e.exports=d},496:function(e,t,r){var n=r(4575).default,i=r(3913).default,o=function(){"use strict";function e(t,r){n(this,e),this.colors=t,this.theme=this.colors[r]}return i(e,[{key:"getColor",value:function(e){return e&&(e=e.toUpperCase())in this.theme?this.theme[e]:this.theme.C}},{key:"setTheme",value:function(e){this.colors.hasOwnProperty(e)&&(this.theme=this.colors[e])}}]),e}();e.exports=o},2914:function(e){e.exports={getChargeText:function(e){return console.log("in the utility version of getChargeText"),1===e?"+":2===e?"2+":-1===e?"-":-2===e?"2-":""}}},8357:function(e,t,r){var n=r(4575).default,i=r(3913).default,o=function(){"use strict";function e(t,r){n(this,e),0==arguments.length?(this.x=0,this.y=0):1==arguments.length?(this.x=t.x,this.y=t.y):(this.x=t,this.y=r)}return i(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"toString",value:function(){return"("+this.x+","+this.y+")"}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"subtract",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"divide",value:function(e){return this.x/=e,this.y/=e,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"invert",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"distance",value:function(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))}},{key:"distanceSq",value:function(e){return(e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y)}},{key:"clockwise",value:function(e){var t=this.y*e.x,r=this.x*e.y;return t>r?-1:t===r?0:1}},{key:"relativeClockwise",value:function(e,t){var r=(this.y-e.y)*(t.x-e.x),n=(this.x-e.x)*(t.y-e.y);return r>n?-1:r===n?0:1}},{key:"rotate",value:function(t){var r=new e(0,0),n=Math.cos(t),i=Math.sin(t);return r.x=this.x*n-this.y*i,r.y=this.x*i+this.y*n,this.x=r.x,this.y=r.y,this}},{key:"rotateAround",value:function(e,t){var r=Math.sin(e),n=Math.cos(e);this.x-=t.x,this.y-=t.y;var i=this.x*n-this.y*r,o=this.x*r+this.y*n;return this.x=i+t.x,this.y=o+t.y,this}},{key:"rotateTo",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x+=.001,this.y-=.001;var i=e.subtract(this,r),o=e.subtract(t,r),a=e.angle(o,i);return this.rotateAround(a+n,r),this}},{key:"rotateAwayFrom",value:function(e,t,r){this.rotateAround(r,t);var n=this.distanceSq(e);this.rotateAround(-2*r,t),this.distanceSq(e)<n&&this.rotateAround(2*r,t)}},{key:"getRotateAwayFromAngle",value:function(e,t,r){var n=this.clone();n.rotateAround(r,t);var i=n.distanceSq(e);return n.rotateAround(-2*r,t),n.distanceSq(e)<i?r:-r}},{key:"getRotateTowardsAngle",value:function(e,t,r){var n=this.clone();n.rotateAround(r,t);var i=n.distanceSq(e);return n.rotateAround(-2*r,t),n.distanceSq(e)>i?r:-r}},{key:"getRotateToAngle",value:function(t,r){var n=e.subtract(this,r),i=e.subtract(t,r),o=e.angle(i,n);return Number.isNaN(o)?0:o}},{key:"isInPolygon",value:function(e){for(var t=!1,r=0,n=e.length-1;r<e.length;n=r++)e[r].y>this.y!=e[n].y>this.y&&this.x<(e[n].x-e[r].x)*(this.y-e[r].y)/(e[n].y-e[r].y)+e[r].x&&(t=!t);return t}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"normalize",value:function(){return this.divide(this.length()),this}},{key:"normalized",value:function(){return e.divideScalar(this,this.length())}},{key:"whichSide",value:function(e,t){return(this.x-e.x)*(t.y-e.y)-(this.y-e.y)*(t.x-e.x)}},{key:"sameSideAs",value:function(e,t,r){var n=this.whichSide(e,t),i=r.whichSide(e,t);return n<0&&i<0||0==n&&0==i||n>0&&i>0}}],[{key:"add",value:function(t,r){return new e(t.x+r.x,t.y+r.y)}},{key:"subtract",value:function(t,r){return new e(t.x-r.x,t.y-r.y)}},{key:"multiply",value:function(t,r){return new e(t.x*r.x,t.y*r.y)}},{key:"multiplyScalar",value:function(t,r){return new e(t.x,t.y).multiplyScalar(r)}},{key:"midpoint",value:function(t,r){return new e((t.x+r.x)/2,(t.y+r.y)/2)}},{key:"normals",value:function(t,r){var n=e.subtract(r,t);return[new e(-n.y,n.x),new e(n.y,-n.x)]}},{key:"units",value:function(t,r){var n=e.subtract(r,t);return[new e(-n.y,n.x).normalize(),new e(n.y,-n.x).normalize()]}},{key:"divide",value:function(t,r){return new e(t.x/r.x,t.y/r.y)}},{key:"divideScalar",value:function(t,r){return new e(t.x/r,t.y/r)}},{key:"dot",value:function(e,t){return e.x*t.x+e.y*t.y}},{key:"angle",value:function(t,r){var n=e.dot(t,r);return Math.acos(n/(t.length()*r.length()))}},{key:"threePointangle",value:function(t,r,n){var i=e.subtract(r,t),o=e.subtract(n,r),a=t.distance(r),s=r.distance(n);return Math.acos(e.dot(i,o)/(a*s))}},{key:"scalarProjection",value:function(t,r){var n=r.normalized();return e.dot(t,n)}},{key:"averageDirection",value:function(t){for(var r=new e(0,0),n=0;n<t.length;n++){var i=t[n];r.add(i)}return r.normalize()}}]),e}();e.exports=o},1965:function(e,t,r){var n=r(4575).default,i=r(3913).default,o=r(5013),a=r(9521),s=r(8357),l=(r(8666),function(){"use strict";function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,e),this.id=null,this.value=t,this.position=new s(r||0,i||0),this.previousPosition=new s(0,0),this.parentVertexId=null,this.children=Array(),this.spanningTreeChildren=Array(),this.edges=Array(),this.positioned=!1,this.angle=null,this.dir=1,this.neighbourCount=0,this.neighbours=Array(),this.neighbouringElements=Array(),this.forcePositioned=!1}return i(e,[{key:"setPosition",value:function(e,t){this.position.x=e,this.position.y=t}},{key:"setPositionFromVector",value:function(e){this.position.x=e.x,this.position.y=e.y}},{key:"addChild",value:function(e){this.children.push(e),this.neighbours.push(e),this.neighbourCount++}},{key:"addRingbondChild",value:function(e,t){if(this.children.push(e),this.value.bracket){var r=1;0===this.id&&0===this.value.bracket.hcount&&(r=0),1===this.value.bracket.hcount&&0===t&&(r=2),1===this.value.bracket.hcount&&1===t&&(r=this.neighbours.length<3?2:3),null===this.value.bracket.hcount&&0===t&&(r=1),null===this.value.bracket.hcount&&1===t&&(r=this.neighbours.length<3?1:2),this.neighbours.splice(r,0,e)}else this.neighbours.push(e);this.neighbourCount++}},{key:"setParentVertexId",value:function(e){this.neighbourCount++,this.parentVertexId=e,this.neighbours.push(e)}},{key:"isTerminal",value:function(){return!!this.value.hasAttachedPseudoElements||(null===this.parentVertexId&&this.children.length<2||0===this.children.length)}},{key:"clone",value:function(){var t=new e(this.value,this.position.x,this.position.y);return t.id=this.id,t.previousPosition=new s(this.previousPosition.x,this.previousPosition.y),t.parentVertexId=this.parentVertexId,t.children=a.clone(this.children),t.spanningTreeChildren=a.clone(this.spanningTreeChildren),t.edges=a.clone(this.edges),t.positioned=this.positioned,t.angle=this.angle,t.forcePositioned=this.forcePositioned,t}},{key:"equals",value:function(e){return this.id===e.id}},{key:"getAngle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null;return r=e?s.subtract(this.position,e):s.subtract(this.position,this.previousPosition),t?o.toDeg(r.angle()):r.angle()}},{key:"getTextDirection",value:function(e){for(var t=this.getDrawnNeighbours(e),r=Array(),n=0;n<t.length;n++)r.push(this.getAngle(e[t[n]].position));var i=o.meanAngle(r),a=Math.PI/2;return 2===(i=Math.round(Math.round(i/a)*a))?"down":-2===i?"up":0===i||-0===i?"right":3===i||-3===i?"left":"down"}},{key:"getNeighbours",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===e)return this.neighbours.slice();for(var t=Array(),r=0;r<this.neighbours.length;r++)this.neighbours[r]!==e&&t.push(this.neighbours[r]);return t}},{key:"getDrawnNeighbours",value:function(e){for(var t=Array(),r=0;r<this.neighbours.length;r++)e[this.neighbours[r]].value.isDrawn&&t.push(this.neighbours[r]);return t}},{key:"getNeighbourCount",value:function(){return this.neighbourCount}},{key:"getSpanningTreeNeighbours",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Array(),r=0;r<this.spanningTreeChildren.length;r++)void 0!==e&&e==this.spanningTreeChildren[r]||t.push(this.spanningTreeChildren[r]);return null!=this.parentVertexId&&(void 0!==e&&e==this.parentVertexId||t.push(this.parentVertexId)),t}},{key:"getNextInRing",value:function(e,t,r){for(var n=this.getNeighbours(),i=0;i<n.length;i++)if(a.contains(e[n[i]].value.rings,{value:t})&&n[i]!=r)return n[i];return null}}]),e}());e.exports=l},2391:function(e){"use strict";var t=function(){};e.exports=t},5398:function(e){function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=5398,e.exports=t},8512:function(e,t,r){"use strict";r.r(t),t.default={}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=function(e,t){for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},__webpack_require__.p="/";var __webpack_exports__={};!function(){"use strict";var e,t=__webpack_require__(2791),r=__webpack_require__(4164),n=__webpack_require__(1641),i=__webpack_require__.n(n);function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){if(e){if("string"===typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(l){s=!0,i=l}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));var d=function(e){return e};var u="beforeunload",c="popstate";function h(t){void 0===t&&(t={});var r=t.window,n=void 0===r?document.defaultView:r,i=n.history;function o(){var e=n.location,t=e.pathname,r=e.search,o=e.hash,a=i.state||{};return[a.idx,d({pathname:t,search:r,hash:o,state:a.usr||null,key:a.key||"default"})]}var a=null;n.addEventListener(c,(function(){if(a)T.call(a),a=null;else{var t=e.Pop,r=o(),n=r[0],i=r[1];if(T.length){if(null!=n){var s=y-n;s&&(a={action:t,location:i,retry:function(){I(-1*s)}},I(s))}}else A(t)}}));var s=e.Pop,h=o(),y=h[0],_=h[1],E=g(),T=g();function O(e){return"string"===typeof e?e:m(e)}function v(e,t){return void 0===t&&(t=null),d(l({pathname:_.pathname,hash:"",search:""},"string"===typeof e?C(e):e,{state:t,key:f()}))}function S(e,t){return[{usr:e.state,key:e.key,idx:t},O(e)]}function b(e,t,r){return!T.length||(T.call({action:e,location:t,retry:r}),!1)}function A(e){s=e;var t=o();y=t[0],_=t[1],E.call({action:s,location:_})}function I(e){i.go(e)}null==y&&(y=0,i.replaceState(l({},i.state,{idx:y}),""));var R={get action(){return s},get location(){return _},createHref:O,push:function t(r,o){var a=e.Push,s=v(r,o);if(b(a,s,(function(){t(r,o)}))){var l=S(s,y+1),d=l[0],u=l[1];try{i.pushState(d,"",u)}catch(c){n.location.assign(u)}A(a)}},replace:function t(r,n){var o=e.Replace,a=v(r,n);if(b(o,a,(function(){t(r,n)}))){var s=S(a,y),l=s[0],d=s[1];i.replaceState(l,"",d),A(o)}},go:I,back:function(){I(-1)},forward:function(){I(1)},listen:function(e){return E.push(e)},block:function(e){var t=T.push(e);return 1===T.length&&n.addEventListener(u,p),function(){t(),T.length||n.removeEventListener(u,p)}}};return R}function p(e){e.preventDefault(),e.returnValue=""}function g(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}function f(){return Math.random().toString(36).substr(2,8)}function m(e){var t=e.pathname,r=void 0===t?"/":t,n=e.search,i=void 0===n?"":n,o=e.hash,a=void 0===o?"":o;return i&&"?"!==i&&(r+="?"===i.charAt(0)?i:"?"+i),a&&"#"!==a&&(r+="#"===a.charAt(0)?a:"#"+a),r}function C(e){var t={};if(e){var r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));var n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function y(e,t){if(!e)throw new Error(t)}var _=(0,t.createContext)(null);var E=(0,t.createContext)(null);var T=(0,t.createContext)({outlet:null,matches:[]});function O(e){var r=e.to,n=e.replace,i=e.state;I()||y(!1);var o=N();return(0,t.useEffect)((function(){o(r,{replace:n,state:i})})),null}function v(e){y(!1)}function S(r){var n=r.basename,i=void 0===n?"/":n,o=r.children,a=void 0===o?null:o,s=r.location,l=r.navigationType,d=void 0===l?e.Pop:l,u=r.navigator,c=r.static,h=void 0!==c&&c;I()&&y(!1);var p=H(i),g=(0,t.useMemo)((function(){return{basename:p,navigator:u,static:h}}),[p,u,h]);"string"===typeof s&&(s=C(s));var f=s,m=f.pathname,T=void 0===m?"/":m,O=f.search,v=void 0===O?"":O,S=f.hash,b=void 0===S?"":S,A=f.state,R=void 0===A?null:A,D=f.key,N=void 0===D?"default":D,P=(0,t.useMemo)((function(){var e=W(T,p);return null==e?null:{pathname:e,search:v,hash:b,state:R,key:N}}),[p,T,v,b,R,N]);return null==P?null:(0,t.createElement)(_.Provider,{value:g},(0,t.createElement)(E.Provider,{children:a,value:{location:P,navigationType:d}}))}function b(e){var r=e.children,n=e.location;return function(e,r){I()||y(!1);var n=(0,t.useContext)(T).matches,i=n[n.length-1],o=i?i.params:{},a=(i&&i.pathname,i?i.pathnameBase:"/");i&&i.route;0;var s,l=R();if(r){var d,u="string"===typeof r?C(r):r;"/"===a||(null==(d=u.pathname)?void 0:d.startsWith(a))||y(!1),s=u}else s=l;var c=s.pathname||"/",h="/"===a?c:c.slice(a.length)||"/",p=function(e,t,r){void 0===r&&(r="/");var n=W(("string"===typeof t?C(t):t).pathname||"/",r);if(null==n)return null;var i=M(e);!function(e){e.sort((function(e,t){return e.score!==t.score?t.score-e.score:function(e,t){var r=e.length===t.length&&e.slice(0,-1).every((function(e,r){return e===t[r]}));return r?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((function(e){return e.childrenIndex})),t.routesMeta.map((function(e){return e.childrenIndex})))}))}(i);for(var o=null,a=0;null==o&&a<i.length;++a)o=B(i[a],n);return o}(e,{pathname:h});0;return j(p&&p.map((function(e){return Object.assign({},e,{params:Object.assign({},o,e.params),pathname:V([a,e.pathname]),pathnameBase:"/"===e.pathnameBase?a:V([a,e.pathnameBase])})})),n)}(x(r),n)}function A(e){I()||y(!1);var r=(0,t.useContext)(_),n=r.basename,i=r.navigator,o=P(e),a=o.hash,s=o.pathname,l=o.search,d=s;if("/"!==n){var u=function(e){return""===e||""===e.pathname?"/":"string"===typeof e?C(e).pathname:e.pathname}(e),c=null!=u&&u.endsWith("/");d="/"===s?n+(c?"/":""):V([n,s])}return i.createHref({pathname:d,search:l,hash:a})}function I(){return null!=(0,t.useContext)(E)}function R(){return I()||y(!1),(0,t.useContext)(E).location}function D(e){I()||y(!1);var r=R().pathname;return(0,t.useMemo)((function(){return U(e,r)}),[r,e])}function N(){I()||y(!1);var e=(0,t.useContext)(_),r=e.basename,n=e.navigator,i=(0,t.useContext)(T).matches,o=R().pathname,a=JSON.stringify(i.map((function(e){return e.pathnameBase}))),s=(0,t.useRef)(!1);(0,t.useEffect)((function(){s.current=!0}));var l=(0,t.useCallback)((function(e,t){if(void 0===t&&(t={}),s.current)if("number"!==typeof e){var i=F(e,JSON.parse(a),o);"/"!==r&&(i.pathname=V([r,i.pathname])),(t.replace?n.replace:n.push)(i,t.state)}else n.go(e)}),[r,n,a,o]);return l}function P(e){var r=(0,t.useContext)(T).matches,n=R().pathname,i=JSON.stringify(r.map((function(e){return e.pathnameBase})));return(0,t.useMemo)((function(){return F(e,JSON.parse(i),n)}),[e,i,n])}function x(e){var r=[];return t.Children.forEach(e,(function(e){if((0,t.isValidElement)(e))if(e.type!==t.Fragment){e.type!==v&&y(!1);var n={caseSensitive:e.props.caseSensitive,element:e.props.element,index:e.props.index,path:e.props.path};e.props.children&&(n.children=x(e.props.children)),r.push(n)}else r.push.apply(r,x(e.props.children))})),r}function M(e,t,r,n){return void 0===t&&(t=[]),void 0===r&&(r=[]),void 0===n&&(n=""),e.forEach((function(e,i){var o={relativePath:e.path||"",caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};o.relativePath.startsWith("/")&&(o.relativePath.startsWith(n)||y(!1),o.relativePath=o.relativePath.slice(n.length));var a=V([n,o.relativePath]),s=r.concat(o);e.children&&e.children.length>0&&(!0===e.index&&y(!1),M(e.children,t,s,a)),(null!=e.path||e.index)&&t.push({path:a,score:k(a,e.index),routesMeta:s})})),t}var L=/^:\w+$/,w=function(e){return"*"===e};function k(e,t){var r=e.split("/"),n=r.length;return r.some(w)&&(n+=-2),t&&(n+=2),r.filter((function(e){return!w(e)})).reduce((function(e,t){return e+(L.test(t)?3:""===t?1:10)}),n)}function B(e,t){for(var r=e.routesMeta,n={},i="/",o=[],a=0;a<r.length;++a){var s=r[a],l=a===r.length-1,d="/"===i?t:t.slice(i.length)||"/",u=U({path:s.relativePath,caseSensitive:s.caseSensitive,end:l},d);if(!u)return null;Object.assign(n,u.params);var c=s.route;o.push({params:n,pathname:V([i,u.pathname]),pathnameBase:H(V([i,u.pathnameBase])),route:c}),"/"!==u.pathnameBase&&(i=V([i,u.pathnameBase]))}return o}function j(e,r){return void 0===r&&(r=[]),null==e?null:e.reduceRight((function(n,i,o){return(0,t.createElement)(T.Provider,{children:void 0!==i.route.element?i.route.element:n,value:{outlet:n,matches:r.concat(e.slice(0,o+1))}})}),null)}function U(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});var r=function(e,t,r){void 0===t&&(t=!1);void 0===r&&(r=!0);var n=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/:(\w+)/g,(function(e,t){return n.push(t),"([^\\/]+)"}));e.endsWith("*")?(n.push("*"),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):i+=r?"\\/*$":"(?:(?=[.~-]|%[0-9A-F]{2})|\\b|\\/|$)";return[new RegExp(i,t?void 0:"i"),n]}(e.path,e.caseSensitive,e.end),n=s(r,2),i=n[0],o=n[1],a=t.match(i);if(!a)return null;var l=a[0],d=l.replace(/(.)\/+$/,"$1"),u=a.slice(1);return{params:o.reduce((function(e,t,r){if("*"===t){var n=u[r]||"";d=l.slice(0,l.length-n.length).replace(/(.)\/+$/,"$1")}return e[t]=function(e,t){try{return decodeURIComponent(e)}catch(r){return e}}(u[r]||""),e}),{}),pathname:l,pathnameBase:d,pattern:e}}function F(e,t,r){var n,i="string"===typeof e?C(e):e,o=""===e||""===i.pathname?"/":i.pathname;if(null==o)n=r;else{var a=t.length-1;if(o.startsWith("..")){for(var s=o.split("/");".."===s[0];)s.shift(),a-=1;i.pathname=s.join("/")}n=a>=0?t[a]:"/"}var l=function(e,t){void 0===t&&(t="/");var r="string"===typeof e?C(e):e,n=r.pathname,i=r.search,o=void 0===i?"":i,a=r.hash,s=void 0===a?"":a,l=n?n.startsWith("/")?n:function(e,t){var r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((function(e){".."===e?r.length>1&&r.pop():"."!==e&&r.push(e)})),r.length>1?r.join("/"):"/"}(n,t):t;return{pathname:l,search:G(o),hash:z(s)}}(i,n);return o&&"/"!==o&&o.endsWith("/")&&!l.pathname.endsWith("/")&&(l.pathname+="/"),l}function W(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;var r=e.charAt(t.length);return r&&"/"!==r?null:e.slice(t.length)||"/"}var V=function(e){return e.join("/").replace(/\/\/+/g,"/")},H=function(e){return e.replace(/\/+$/,"").replace(/^\/*/,"/")},G=function(e){return e&&"?"!==e?e.startsWith("?")?e:"?"+e:""},z=function(e){return e&&"#"!==e?e.startsWith("#")?e:"#"+e:""};function K(){return K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},K.apply(this,arguments)}function Y(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}var X=["onClick","reloadDocument","replace","state","target","to"];function $(e){var r=e.basename,n=e.children,i=e.window,o=(0,t.useRef)();null==o.current&&(o.current=h({window:i}));var a=o.current,l=s((0,t.useState)({action:a.action,location:a.location}),2),d=l[0],u=l[1];return(0,t.useLayoutEffect)((function(){return a.listen(u)}),[a]),(0,t.createElement)(S,{basename:r,children:n,location:d.location,navigationType:d.action,navigator:a})}var q=(0,t.forwardRef)((function(e,r){var n=e.onClick,i=e.reloadDocument,o=e.replace,a=void 0!==o&&o,s=e.state,l=e.target,d=e.to,u=Y(e,X),c=A(d),h=function(e,r){var n=void 0===r?{}:r,i=n.target,o=n.replace,a=n.state,s=N(),l=R(),d=P(e);return(0,t.useCallback)((function(t){if(0===t.button&&(!i||"_self"===i)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(t)){t.preventDefault();var r=!!o||m(l)===m(d);s(e,{replace:r,state:a})}}),[l,s,d,o,a,i,e])}(d,{replace:a,state:s,target:l});return(0,t.createElement)("a",K({},u,{href:c,onClick:function(e){n&&n(e),e.defaultPrevented||i||h(e)},ref:r,target:l}))}));function J(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach((function(t){J(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ee(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function te(e,t){if(null==e)return{};var r,n,i=ee(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var re=__webpack_require__(1694),ne=__webpack_require__.n(re),ie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!=e?String(e):t||null},oe=t.createContext(null);__webpack_require__(2176);function ae(e){return"default"+e.charAt(0).toUpperCase()+e.substr(1)}function se(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function le(e,r,n){var i=(0,t.useRef)(void 0!==e),o=(0,t.useState)(r),a=o[0],s=o[1],l=void 0!==e,d=i.current;return i.current=l,!l&&d&&a!==r&&s(r),[l?e:a,(0,t.useCallback)((function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n&&n.apply(void 0,[e].concat(r)),s(e)}),[n])]}function de(e,t){return Object.keys(t).reduce((function(r,n){var i,o=r,a=o[ae(n)],s=o[n],d=ee(o,[ae(n),n].map(se)),u=t[n],c=le(s,a,e[u]),h=c[0],p=c[1];return l({},d,((i={})[n]=h,i[u]=p,i))}),e)}function ue(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!==e&&void 0!==e&&this.setState(e)}function ce(e){this.setState(function(t){var r=this.constructor.getDerivedStateFromProps(e,t);return null!==r&&void 0!==r?r:null}.bind(this))}function he(e,t){try{var r=this.props,n=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(r,n)}finally{this.props=r,this.state=n}}ue.__suppressDeprecationWarning=!0,ce.__suppressDeprecationWarning=!0,he.__suppressDeprecationWarning=!0;var pe=/-(.)/g;var ge=__webpack_require__(184),fe=["xxl","xl","lg","md","sm","xs"],me=t.createContext({prefixes:{},breakpoints:fe});me.Consumer,me.Provider;function Ce(e,r){var n=(0,t.useContext)(me).prefixes;return e||n[r]||r}function ye(){return(0,t.useContext)(me).breakpoints}function _e(){return"rtl"===(0,t.useContext)(me).dir}var Ee=["className","bsPrefix","as"],Te=function(e){return e[0].toUpperCase()+(t=e,t.replace(pe,(function(e,t){return t.toUpperCase()}))).slice(1);var t};function Oe(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.displayName,i=void 0===n?Te(e):n,o=r.Component,a=r.defaultProps,s=t.forwardRef((function(t,r){var n=t.className,i=t.bsPrefix,a=t.as,s=void 0===a?o||"div":a,l=te(t,Ee),d=Ce(i,e);return(0,ge.jsx)(s,Q({ref:r,className:ne()(n,d)},l))}));return s.defaultProps=a,s.displayName=i,s}var ve=["bsPrefix","className","as"],Se=t.forwardRef((function(e,t){var r=e.bsPrefix,n=e.className,i=e.as,o=te(e,ve);r=Ce(r,"navbar-brand");var a=i||(o.href?"a":"span");return(0,ge.jsx)(a,Q(Q({},o),{},{ref:t,className:ne()(n,r)}))}));Se.displayName="NavbarBrand";var be=Se;function Ae(e){return e&&e.ownerDocument||document}function Ie(e,t){return function(e){var t=Ae(e);return t&&t.defaultView||window}(e).getComputedStyle(e,t)}var Re=/([A-Z])/g;var De=/^ms-/;function Ne(e){return function(e){return e.replace(Re,"-$1").toLowerCase()}(e).replace(De,"-ms-")}var Pe=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;var xe=function(e,t){var r="",n="";if("string"===typeof t)return e.style.getPropertyValue(Ne(t))||Ie(e).getPropertyValue(Ne(t));Object.keys(t).forEach((function(i){var o=t[i];o||0===o?!function(e){return!(!e||!Pe.test(e))}(i)?r+=Ne(i)+": "+o+";":n+=i+"("+o+") ":e.style.removeProperty(Ne(i))})),n&&(r+="transform: "+n+";"),e.style.cssText+=";"+r};function Me(e,t){return Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Me(e,t)}var Le=!1,we=t.createContext(null),ke="unmounted",Be="exited",je="entering",Ue="entered",Fe="exiting",We=function(e){var n,i;function o(t,r){var n;n=e.call(this,t,r)||this;var i,o=r&&!r.isMounting?t.enter:t.appear;return n.appearStatus=null,t.in?o?(i=Be,n.appearStatus=je):i=Ue:i=t.unmountOnExit||t.mountOnEnter?ke:Be,n.state={status:i},n.nextCallback=null,n}i=e,(n=o).prototype=Object.create(i.prototype),n.prototype.constructor=n,Me(n,i),o.getDerivedStateFromProps=function(e,t){return e.in&&t.status===ke?{status:Be}:null};var a=o.prototype;return a.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},a.componentDidUpdate=function(e){var t=null;if(e!==this.props){var r=this.state.status;this.props.in?r!==je&&r!==Ue&&(t=je):r!==je&&r!==Ue||(t=Fe)}this.updateStatus(!1,t)},a.componentWillUnmount=function(){this.cancelNextCallback()},a.getTimeouts=function(){var e,t,r,n=this.props.timeout;return e=t=r=n,null!=n&&"number"!==typeof n&&(e=n.exit,t=n.enter,r=void 0!==n.appear?n.appear:t),{exit:e,enter:t,appear:r}},a.updateStatus=function(e,t){void 0===e&&(e=!1),null!==t?(this.cancelNextCallback(),t===je?this.performEnter(e):this.performExit()):this.props.unmountOnExit&&this.state.status===Be&&this.setState({status:ke})},a.performEnter=function(e){var t=this,n=this.props.enter,i=this.context?this.context.isMounting:e,o=this.props.nodeRef?[i]:[r.findDOMNode(this),i],a=o[0],s=o[1],l=this.getTimeouts(),d=i?l.appear:l.enter;!e&&!n||Le?this.safeSetState({status:Ue},(function(){t.props.onEntered(a)})):(this.props.onEnter(a,s),this.safeSetState({status:je},(function(){t.props.onEntering(a,s),t.onTransitionEnd(d,(function(){t.safeSetState({status:Ue},(function(){t.props.onEntered(a,s)}))}))})))},a.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts(),i=this.props.nodeRef?void 0:r.findDOMNode(this);t&&!Le?(this.props.onExit(i),this.safeSetState({status:Fe},(function(){e.props.onExiting(i),e.onTransitionEnd(n.exit,(function(){e.safeSetState({status:Be},(function(){e.props.onExited(i)}))}))}))):this.safeSetState({status:Be},(function(){e.props.onExited(i)}))},a.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},a.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},a.setNextCallback=function(e){var t=this,r=!0;return this.nextCallback=function(n){r&&(r=!1,t.nextCallback=null,e(n))},this.nextCallback.cancel=function(){r=!1},this.nextCallback},a.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=this.props.nodeRef?this.props.nodeRef.current:r.findDOMNode(this),i=null==e&&!this.props.addEndListener;if(n&&!i){if(this.props.addEndListener){var o=this.props.nodeRef?[this.nextCallback]:[n,this.nextCallback],a=o[0],s=o[1];this.props.addEndListener(a,s)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},a.render=function(){var e=this.state.status;if(e===ke)return null;var r=this.props,n=r.children,i=(r.in,r.mountOnEnter,r.unmountOnExit,r.appear,r.enter,r.exit,r.timeout,r.addEndListener,r.onEnter,r.onEntering,r.onEntered,r.onExit,r.onExiting,r.onExited,r.nodeRef,ee(r,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return t.createElement(we.Provider,{value:null},"function"===typeof n?n(e,i):t.cloneElement(t.Children.only(n),i))},o}(t.Component);function Ve(){}We.contextType=we,We.propTypes={},We.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Ve,onEntering:Ve,onEntered:Ve,onExit:Ve,onExiting:Ve,onExited:Ve},We.UNMOUNTED=ke,We.EXITED=Be,We.ENTERING=je,We.ENTERED=Ue,We.EXITING=Fe;var He=We,Ge=!("undefined"===typeof window||!window.document||!window.document.createElement),ze=!1,Ke=!1;try{var Ye={get passive(){return ze=!0},get once(){return Ke=ze=!0}};Ge&&(window.addEventListener("test",Ye,Ye),window.removeEventListener("test",Ye,!0))}catch(ha){}var Xe=function(e,t,r,n){if(n&&"boolean"!==typeof n&&!Ke){var i=n.once,o=n.capture,a=r;!Ke&&i&&(a=r.__once||function e(n){this.removeEventListener(t,e,o),r.call(this,n)},r.__once=a),e.addEventListener(t,a,ze?n:o)}e.addEventListener(t,r,n)};var $e=function(e,t,r,n){var i=n&&"boolean"!==typeof n?n.capture:n;e.removeEventListener(t,r,i),r.__once&&e.removeEventListener(t,r.__once,i)};var qe=function(e,t,r,n){return Xe(e,t,r,n),function(){$e(e,t,r,n)}};function Je(e,t,r){void 0===r&&(r=5);var n=!1,i=setTimeout((function(){n||function(e,t,r,n){if(void 0===r&&(r=!1),void 0===n&&(n=!0),e){var i=document.createEvent("HTMLEvents");i.initEvent(t,r,n),e.dispatchEvent(i)}}(e,"transitionend",!0)}),t+r),o=qe(e,"transitionend",(function(){n=!0}),{once:!0});return function(){clearTimeout(i),o()}}function Ze(e,t,r,n){null==r&&(r=function(e){var t=xe(e,"transitionDuration")||"",r=-1===t.indexOf("ms")?1e3:1;return parseFloat(t)*r}(e)||0);var i=Je(e,r,n),o=qe(e,"transitionend",t);return function(){i(),o()}}function Qe(e,t){var r=xe(e,t)||"",n=-1===r.indexOf("ms")?1e3:1;return parseFloat(r)*n}function et(e,t){var r=Qe(e,"transitionDuration"),n=Qe(e,"transitionDelay"),i=Ze(e,(function(r){r.target===e&&(i(),t(r))}),r+n)}var tt=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((function(e){return null!=e})).reduce((function(e,t){if("function"!==typeof t)throw new Error("Invalid Argument Type, must only provide functions, undefined, or null.");return null===e?t:function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n),t.apply(this,n)}}),null)};function rt(e){e.offsetHeight}var nt=function(e){return e&&"function"!==typeof e?function(t){e.current=t}:e};var it=function(e,r){return(0,t.useMemo)((function(){return function(e,t){var r=nt(e),n=nt(t);return function(e){r&&r(e),n&&n(e)}}(e,r)}),[e,r])};var ot,at=["onEnter","onEntering","onEntered","onExit","onExiting","onExited","addEndListener","children","childRef"],st=t.forwardRef((function(e,n){var i=e.onEnter,o=e.onEntering,a=e.onEntered,s=e.onExit,l=e.onExiting,d=e.onExited,u=e.addEndListener,c=e.children,h=e.childRef,p=te(e,at),g=(0,t.useRef)(null),f=it(g,h),m=function(e){var t;f((t=e)&&"setState"in t?r.findDOMNode(t):null!=t?t:null)},C=function(e){return function(t){e&&g.current&&e(g.current,t)}},y=(0,t.useCallback)(C(i),[i]),_=(0,t.useCallback)(C(o),[o]),E=(0,t.useCallback)(C(a),[a]),T=(0,t.useCallback)(C(s),[s]),O=(0,t.useCallback)(C(l),[l]),v=(0,t.useCallback)(C(d),[d]),S=(0,t.useCallback)(C(u),[u]);return(0,ge.jsx)(He,Q(Q({ref:n},p),{},{onEnter:y,onEntered:E,onEntering:_,onExit:T,onExited:v,onExiting:O,addEndListener:S,nodeRef:g,children:"function"===typeof c?function(e,t){return c(e,Q(Q({},t),{},{ref:m}))}:t.cloneElement(c,{ref:m})}))})),lt=st,dt=["onEnter","onEntering","onEntered","onExit","onExiting","className","children","dimension","getDimensionValue"],ut={height:["marginTop","marginBottom"],width:["marginLeft","marginRight"]};function ct(e,t){var r=t["offset".concat(e[0].toUpperCase()).concat(e.slice(1))],n=ut[e];return r+parseInt(xe(t,n[0]),10)+parseInt(xe(t,n[1]),10)}var ht=(J(ot={},Be,"collapse"),J(ot,Fe,"collapsing"),J(ot,je,"collapsing"),J(ot,Ue,"collapse show"),ot),pt={in:!1,timeout:300,mountOnEnter:!1,unmountOnExit:!1,appear:!1,getDimensionValue:ct},gt=t.forwardRef((function(e,r){var n=e.onEnter,i=e.onEntering,o=e.onEntered,a=e.onExit,s=e.onExiting,l=e.className,d=e.children,u=e.dimension,c=void 0===u?"height":u,h=e.getDimensionValue,p=void 0===h?ct:h,g=te(e,dt),f="function"===typeof c?c():c,m=(0,t.useMemo)((function(){return tt((function(e){e.style[f]="0"}),n)}),[f,n]),C=(0,t.useMemo)((function(){return tt((function(e){var t="scroll".concat(f[0].toUpperCase()).concat(f.slice(1));e.style[f]="".concat(e[t],"px")}),i)}),[f,i]),y=(0,t.useMemo)((function(){return tt((function(e){e.style[f]=null}),o)}),[f,o]),_=(0,t.useMemo)((function(){return tt((function(e){e.style[f]="".concat(p(f,e),"px"),rt(e)}),a)}),[a,p,f]),E=(0,t.useMemo)((function(){return tt((function(e){e.style[f]=null}),s)}),[f,s]);return(0,ge.jsx)(lt,Q(Q({ref:r,addEndListener:et},g),{},{"aria-expanded":g.role?g.in:null,onEnter:m,onEntering:C,onEntered:y,onExit:_,onExiting:E,childRef:d.ref,children:function(e,r){return t.cloneElement(d,Q(Q({},r),{},{className:ne()(l,d.props.className,ht[e],"width"===f&&"collapse-horizontal")}))}}))}));gt.defaultProps=pt;var ft=gt,mt=t.createContext(null);mt.displayName="NavbarContext";var Ct=mt,yt=["children","bsPrefix"],_t=t.forwardRef((function(e,r){var n=e.children,i=e.bsPrefix,o=te(e,yt);i=Ce(i,"navbar-collapse");var a=(0,t.useContext)(Ct);return(0,ge.jsx)(ft,Q(Q({in:!(!a||!a.expanded)},o),{},{children:(0,ge.jsx)("div",{ref:r,className:i,children:n})}))}));_t.displayName="NavbarCollapse";var Et=_t;var Tt=function(e){var r=(0,t.useRef)(e);return(0,t.useEffect)((function(){r.current=e}),[e]),r};function Ot(e){var r=Tt(e);return(0,t.useCallback)((function(){return r.current&&r.current.apply(r,arguments)}),[r])}var vt=["bsPrefix","className","children","label","as","onClick"],St=t.forwardRef((function(e,r){var n=e.bsPrefix,i=e.className,o=e.children,a=e.label,s=e.as,l=void 0===s?"button":s,d=e.onClick,u=te(e,vt);n=Ce(n,"navbar-toggler");var c=(0,t.useContext)(Ct)||{},h=c.onToggle,p=c.expanded,g=Ot((function(e){d&&d(e),h&&h()}));return"button"===l&&(u.type="button"),(0,ge.jsx)(l,Q(Q({},u),{},{ref:r,onClick:g,"aria-label":a,className:ne()(i,n,!p&&"collapsed"),children:o||(0,ge.jsx)("span",{className:"".concat(n,"-icon")})}))}));St.displayName="NavbarToggle",St.defaultProps={label:"Toggle navigation"};var bt=St;function At(e){void 0===e&&(e=Ae());try{var t=e.activeElement;return t&&t.nodeName?t:null}catch(ha){return e.body}}function It(e,t){return e.contains?e.contains(t):e.compareDocumentPosition?e===t||!!(16&e.compareDocumentPosition(t)):void 0}function Rt(){var e=(0,t.useRef)(!0),r=(0,t.useRef)((function(){return e.current}));return(0,t.useEffect)((function(){return function(){e.current=!1}}),[]),r.current}function Dt(e){var r=function(e){var r=(0,t.useRef)(e);return r.current=e,r}(e);(0,t.useEffect)((function(){return function(){return r.current()}}),[])}function Nt(e){var r=(0,t.useRef)(null);return(0,t.useEffect)((function(){r.current=e})),r.current}function Pt(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Mt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Lt(e,t,r){return t&&Mt(e.prototype,t),r&&Mt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function wt(e){return"".concat("data-rr-ui-").concat(e)}var kt=wt("modal-open"),Bt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.ownerDocument,n=t.handleContainerOverflow,i=void 0===n||n,o=t.isRTL,a=void 0!==o&&o;xt(this,e),this.handleContainerOverflow=i,this.isRTL=a,this.modals=[],this.ownerDocument=r}return Lt(e,[{key:"getScrollbarWidth",value:function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=e.defaultView;return Math.abs(t.innerWidth-e.documentElement.clientWidth)}(this.ownerDocument)}},{key:"getElement",value:function(){return(this.ownerDocument||document).body}},{key:"setModalAttributes",value:function(e){}},{key:"removeModalAttributes",value:function(e){}},{key:"setContainerStyle",value:function(e){var t={overflow:"hidden"},r=this.isRTL?"paddingLeft":"paddingRight",n=this.getElement();e.style=J({overflow:n.style.overflow},r,n.style[r]),e.scrollBarWidth&&(t[r]="".concat(parseInt(xe(n,r)||"0",10)+e.scrollBarWidth,"px")),n.setAttribute(kt,""),xe(n,t)}},{key:"reset",value:function(){var e=this;Pt(this.modals).forEach((function(t){return e.remove(t)}))}},{key:"removeContainerStyle",value:function(e){var t=this.getElement();t.removeAttribute(kt),Object.assign(t.style,e.style)}},{key:"add",value:function(e){var t=this.modals.indexOf(e);return-1!==t?t:(t=this.modals.length,this.modals.push(e),this.setModalAttributes(e),0!==t||(this.state={scrollBarWidth:this.getScrollbarWidth(),style:{}},this.handleContainerOverflow&&this.setContainerStyle(this.state)),t)}},{key:"remove",value:function(e){var t=this.modals.indexOf(e);-1!==t&&(this.modals.splice(t,1),!this.modals.length&&this.handleContainerOverflow&&this.removeContainerStyle(this.state),this.removeModalAttributes(e))}},{key:"isTopModal",value:function(e){return!!this.modals.length&&this.modals[this.modals.length-1]===e}}]),e}(),jt=Bt,Ut=(0,t.createContext)(Ge?window:void 0);Ut.Provider;function Ft(){return(0,t.useContext)(Ut)}var Wt=function(e,t){var r;return Ge?null==e?(t||Ae()).body:("function"===typeof e&&(e=e()),e&&"current"in e&&(e=e.current),null!=(r=e)&&r.nodeType&&e||null):null};var Vt,Ht=["show","role","className","style","children","backdrop","keyboard","onBackdropClick","onEscapeKeyDown","transition","backdropTransition","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","renderDialog","renderBackdrop","manager","container","onShow","onHide","onExit","onExited","onExiting","onEnter","onEntering","onEntered"];function Gt(e){var r=Ft(),n=e||function(e){return Vt||(Vt=new jt({ownerDocument:null==e?void 0:e.document})),Vt}(r),i=(0,t.useRef)({dialog:null,backdrop:null});return Object.assign(i.current,{add:function(){return n.add(i.current)},remove:function(){return n.remove(i.current)},isTopModal:function(){return n.isTopModal(i.current)},setDialogRef:(0,t.useCallback)((function(e){i.current.dialog=e}),[]),setBackdropRef:(0,t.useCallback)((function(e){i.current.backdrop=e}),[])})}var zt=(0,t.forwardRef)((function(e,n){var i=e.show,o=void 0!==i&&i,a=e.role,l=void 0===a?"dialog":a,d=e.className,u=e.style,c=e.children,h=e.backdrop,p=void 0===h||h,g=e.keyboard,f=void 0===g||g,m=e.onBackdropClick,C=e.onEscapeKeyDown,y=e.transition,_=e.backdropTransition,E=e.autoFocus,T=void 0===E||E,O=e.enforceFocus,v=void 0===O||O,S=e.restoreFocus,b=void 0===S||S,A=e.restoreFocusOptions,I=e.renderDialog,R=e.renderBackdrop,D=void 0===R?function(e){return(0,ge.jsx)("div",Object.assign({},e))}:R,N=e.manager,P=e.container,x=e.onShow,M=e.onHide,L=void 0===M?function(){}:M,w=e.onExit,k=e.onExited,B=e.onExiting,j=e.onEnter,U=e.onEntering,F=e.onEntered,W=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,Ht),V=function(e,r){var n=Ft(),i=s((0,t.useState)((function(){return Wt(e,null==n?void 0:n.document)})),2),o=i[0],a=i[1];if(!o){var l=Wt(e);l&&a(l)}return(0,t.useEffect)((function(){r&&o&&r(o)}),[r,o]),(0,t.useEffect)((function(){var t=Wt(e);t!==o&&a(t)}),[e,o]),o}(P),H=Gt(N),G=Rt(),z=Nt(o),K=s((0,t.useState)(!o),2),Y=K[0],X=K[1],$=(0,t.useRef)(null);(0,t.useImperativeHandle)(n,(function(){return H}),[H]),Ge&&!z&&o&&($.current=At()),y||o||Y?o&&Y&&X(!1):X(!0);var q=Ot((function(){if(H.add(),re.current=qe(document,"keydown",ee),te.current=qe(document,"focus",(function(){return setTimeout(Z)}),!0),x&&x(),T){var e=At(document);H.dialog&&e&&!It(H.dialog,e)&&($.current=e,H.dialog.focus())}})),J=Ot((function(){var e;(H.remove(),null==re.current||re.current(),null==te.current||te.current(),b)&&(null==(e=$.current)||null==e.focus||e.focus(A),$.current=null)}));(0,t.useEffect)((function(){o&&V&&q()}),[o,V,q]),(0,t.useEffect)((function(){Y&&J()}),[Y,J]),Dt((function(){J()}));var Z=Ot((function(){if(v&&G()&&H.isTopModal()){var e=At();H.dialog&&e&&!It(H.dialog,e)&&H.dialog.focus()}})),Q=Ot((function(e){e.target===e.currentTarget&&(null==m||m(e),!0===p&&L())})),ee=Ot((function(e){f&&27===e.keyCode&&H.isTopModal()&&(null==C||C(e),e.defaultPrevented||L())})),te=(0,t.useRef)(),re=(0,t.useRef)(),ne=y;if(!V||!(o||ne&&!Y))return null;var ie=Object.assign({role:l,ref:H.setDialogRef,"aria-modal":"dialog"===l||void 0},W,{style:u,className:d,tabIndex:-1}),oe=I?I(ie):(0,ge.jsx)("div",Object.assign({},ie,{children:t.cloneElement(c,{role:"document"})}));ne&&(oe=(0,ge.jsx)(ne,{appear:!0,unmountOnExit:!0,in:!!o,onExit:w,onExiting:B,onExited:function(){X(!0),null==k||k.apply(void 0,arguments)},onEnter:j,onEntering:U,onEntered:F,children:oe}));var ae=null;if(p){var se=_;ae=D({ref:H.setBackdropRef,onClick:Q}),se&&(ae=(0,ge.jsx)(se,{appear:!0,in:!!o,children:ae}))}return(0,ge.jsx)(ge.Fragment,{children:r.createPortal((0,ge.jsxs)(ge.Fragment,{children:[ae,oe]}),V)})}));zt.displayName="Modal";var Kt,Yt=Object.assign(zt,{Manager:jt}),Xt=["className","children","transitionClasses"],$t=(J(Kt={},je,"show"),J(Kt,Ue,"show"),Kt),qt=t.forwardRef((function(e,r){var n=e.className,i=e.children,o=e.transitionClasses,a=void 0===o?{}:o,s=te(e,Xt),l=(0,t.useCallback)((function(e,t){rt(e),null==s.onEnter||s.onEnter(e,t)}),[s]);return(0,ge.jsx)(lt,Q(Q({ref:r,addEndListener:et},s),{},{onEnter:l,childRef:i.ref,children:function(e,r){return t.cloneElement(i,Q(Q({},r),{},{className:ne()("fade",n,i.props.className,$t[e],a[e])}))}}))}));qt.defaultProps={in:!1,timeout:300,mountOnEnter:!1,unmountOnExit:!1,appear:!1},qt.displayName="Fade";var Jt,Zt=qt,Qt=Oe("offcanvas-body"),er=["bsPrefix","className","children"],tr=(J(Jt={},je,"show"),J(Jt,Ue,"show"),Jt),rr=t.forwardRef((function(e,r){var n=e.bsPrefix,i=e.className,o=e.children,a=te(e,er);return n=Ce(n,"offcanvas"),(0,ge.jsx)(lt,Q(Q({ref:r,addEndListener:et},a),{},{childRef:o.ref,children:function(e,r){return t.cloneElement(o,Q(Q({},r),{},{className:ne()(i,o.props.className,(e===je||e===Fe)&&"".concat(n,"-toggling"),tr[e])}))}}))}));rr.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1},rr.displayName="OffcanvasToggling";var nr=rr,ir=t.createContext({onHide:function(){}}),or=__webpack_require__(2007),ar=__webpack_require__.n(or),sr=["className","variant"],lr={"aria-label":ar().string,onClick:ar().func,variant:ar().oneOf(["white"])},dr=t.forwardRef((function(e,t){var r=e.className,n=e.variant,i=te(e,sr);return(0,ge.jsx)("button",Q({ref:t,type:"button",className:ne()("btn-close",n&&"btn-close-".concat(n),r)},i))}));dr.displayName="CloseButton",dr.propTypes=lr,dr.defaultProps={"aria-label":"Close"};var ur=dr,cr=["closeLabel","closeVariant","closeButton","onHide","children"],hr=t.forwardRef((function(e,r){var n=e.closeLabel,i=e.closeVariant,o=e.closeButton,a=e.onHide,s=e.children,l=te(e,cr),d=(0,t.useContext)(ir),u=Ot((function(){null==d||d.onHide(),null==a||a()}));return(0,ge.jsxs)("div",Q(Q({ref:r},l),{},{children:[s,o&&(0,ge.jsx)(ur,{"aria-label":n,variant:i,onClick:u})]}))}));hr.defaultProps={closeLabel:"Close",closeButton:!1};var pr=hr,gr=["bsPrefix","className"],fr=t.forwardRef((function(e,t){var r=e.bsPrefix,n=e.className,i=te(e,gr);return r=Ce(r,"offcanvas-header"),(0,ge.jsx)(pr,Q(Q({ref:t},i),{},{className:ne()(n,r)}))}));fr.displayName="OffcanvasHeader",fr.defaultProps={closeLabel:"Close",closeButton:!1};var mr=fr,Cr=function(e){return t.forwardRef((function(t,r){return(0,ge.jsx)("div",Q(Q({},t),{},{ref:r,className:ne()(t.className,e)}))}))},yr=Oe("offcanvas-title",{Component:Cr("h5")});function _r(e){return _r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_r(e)}function Er(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_r(e)););return e}function Tr(){return Tr="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=Er(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},Tr.apply(this,arguments)}function Or(e){return Or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Or(e)}function vr(e,t){if(t&&("object"===Or(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Sr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(ha){return!1}}();return function(){var r,n=_r(e);if(t){var i=_r(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return vr(this,r)}}var br=Function.prototype.bind.call(Function.prototype.call,[].slice);function Ar(e,t){return br(e.querySelectorAll(t))}function Ir(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}var Rr,Dr=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Nr=".sticky-top",Pr=".navbar-toggler",xr=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Me(e,t)}(r,e);var t=Sr(r);function r(){return xt(this,r),t.apply(this,arguments)}return Lt(r,[{key:"adjustAndStore",value:function(e,t,r){var n=t.style[e];t.dataset[e]=n,xe(t,J({},e,"".concat(parseFloat(xe(t,e))+r,"px")))}},{key:"restore",value:function(e,t){var r=t.dataset[e];void 0!==r&&(delete t.dataset[e],xe(t,J({},e,r)))}},{key:"setContainerStyle",value:function(e){var t=this;Tr(_r(r.prototype),"setContainerStyle",this).call(this,e);var n,i,o=this.getElement();if(i="modal-open",(n=o).classList?n.classList.add(i):function(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}(n,i)||("string"===typeof n.className?n.className=n.className+" "+i:n.setAttribute("class",(n.className&&n.className.baseVal||"")+" "+i)),e.scrollBarWidth){var a=this.isRTL?"paddingLeft":"paddingRight",s=this.isRTL?"marginLeft":"marginRight";Ar(o,Dr).forEach((function(r){return t.adjustAndStore(a,r,e.scrollBarWidth)})),Ar(o,Nr).forEach((function(r){return t.adjustAndStore(s,r,-e.scrollBarWidth)})),Ar(o,Pr).forEach((function(r){return t.adjustAndStore(s,r,e.scrollBarWidth)}))}}},{key:"removeContainerStyle",value:function(e){var t=this;Tr(_r(r.prototype),"removeContainerStyle",this).call(this,e);var n,i,o=this.getElement();i="modal-open",(n=o).classList?n.classList.remove(i):"string"===typeof n.className?n.className=Ir(n.className,i):n.setAttribute("class",Ir(n.className&&n.className.baseVal||"",i));var a=this.isRTL?"paddingLeft":"paddingRight",s=this.isRTL?"marginLeft":"marginRight";Ar(o,Dr).forEach((function(e){return t.restore(a,e)})),Ar(o,Nr).forEach((function(e){return t.restore(s,e)})),Ar(o,Pr).forEach((function(e){return t.restore(s,e)}))}}]),r}(jt);function Mr(e){return Rr||(Rr=new xr(e)),Rr}var Lr=xr,wr=["bsPrefix","className","children","aria-labelledby","placement","show","backdrop","keyboard","scroll","onEscapeKeyDown","onShow","onHide","container","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","onEntered","onExit","onExiting","onEnter","onEntering","onExited","backdropClassName","manager"];function kr(e){return(0,ge.jsx)(nr,Q({},e))}function Br(e){return(0,ge.jsx)(Zt,Q({},e))}var jr=t.forwardRef((function(e,r){var n=e.bsPrefix,i=e.className,o=e.children,a=e["aria-labelledby"],s=e.placement,l=e.show,d=e.backdrop,u=e.keyboard,c=e.scroll,h=e.onEscapeKeyDown,p=e.onShow,g=e.onHide,f=e.container,m=e.autoFocus,C=e.enforceFocus,y=e.restoreFocus,_=e.restoreFocusOptions,E=e.onEntered,T=e.onExit,O=e.onExiting,v=e.onEnter,S=e.onEntering,b=e.onExited,A=e.backdropClassName,I=e.manager,R=te(e,wr),D=(0,t.useRef)();n=Ce(n,"offcanvas");var N=((0,t.useContext)(Ct)||{}).onToggle,P=Ot((function(){null==N||N(),null==g||g()})),x=(0,t.useMemo)((function(){return{onHide:P}}),[P]);var M=(0,t.useCallback)((function(e){return(0,ge.jsx)("div",Q(Q({},e),{},{className:ne()("".concat(n,"-backdrop"),A)}))}),[A,n]);return(0,ge.jsx)(ir.Provider,{value:x,children:(0,ge.jsx)(Yt,{show:l,ref:r,backdrop:d,container:f,keyboard:u,autoFocus:m,enforceFocus:C&&!c,restoreFocus:y,restoreFocusOptions:_,onEscapeKeyDown:h,onShow:p,onHide:P,onEnter:function(e){e&&(e.style.visibility="visible");for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];null==v||v.apply(void 0,[e].concat(r))},onEntering:S,onEntered:E,onExit:T,onExiting:O,onExited:function(e){e&&(e.style.visibility="");for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];null==b||b.apply(void 0,r)},manager:I||(c?(D.current||(D.current=new Lr({handleContainerOverflow:!1})),D.current):Mr()),transition:kr,backdropTransition:Br,renderBackdrop:M,renderDialog:function(e){return(0,ge.jsx)("div",Q(Q(Q({role:"dialog"},e),R),{},{className:ne()(i,n,"".concat(n,"-").concat(s)),"aria-labelledby":a,children:o}))}})})}));jr.displayName="Offcanvas",jr.defaultProps={show:!1,backdrop:!0,keyboard:!0,scroll:!1,autoFocus:!0,enforceFocus:!0,restoreFocus:!0,placement:"start"};var Ur=Object.assign(jr,{Body:Qt,Header:mr,Title:yr}),Fr=t.forwardRef((function(e,r){var n=(0,t.useContext)(Ct);return(0,ge.jsx)(Ur,Q({ref:r,show:!(null==n||!n.expanded)},e))}));Fr.displayName="NavbarOffcanvas";var Wr=Fr,Vr=["bsPrefix","expand","variant","bg","fixed","sticky","className","as","expanded","onToggle","onSelect","collapseOnSelect"],Hr=Oe("navbar-text",{Component:"span"}),Gr=t.forwardRef((function(e,r){var n=de(e,{expanded:"onToggle"}),i=n.bsPrefix,o=n.expand,a=n.variant,s=n.bg,l=n.fixed,d=n.sticky,u=n.className,c=n.as,h=void 0===c?"nav":c,p=n.expanded,g=n.onToggle,f=n.onSelect,m=n.collapseOnSelect,C=te(n,Vr),y=Ce(i,"navbar"),_=(0,t.useCallback)((function(){null==f||f.apply(void 0,arguments),m&&p&&(null==g||g(!1))}),[f,m,p,g]);void 0===C.role&&"nav"!==h&&(C.role="navigation");var E="".concat(y,"-expand");"string"===typeof o&&(E="".concat(E,"-").concat(o));var T=(0,t.useMemo)((function(){return{onToggle:function(){return null==g?void 0:g(!p)},bsPrefix:y,expanded:!!p}}),[y,p,g]);return(0,ge.jsx)(Ct.Provider,{value:T,children:(0,ge.jsx)(oe.Provider,{value:_,children:(0,ge.jsx)(h,Q(Q({ref:r},C),{},{className:ne()(u,y,o&&E,a&&"".concat(y,"-").concat(a),s&&"bg-".concat(s),d&&"sticky-".concat(d),l&&"fixed-".concat(l))}))})})}));Gr.defaultProps={expand:!0,variant:"light",collapseOnSelect:!1},Gr.displayName="Navbar";var zr=Object.assign(Gr,{Brand:be,Collapse:Et,Offcanvas:Wr,Text:Hr,Toggle:bt}),Kr=["bsPrefix","fluid","as","className"],Yr=t.forwardRef((function(e,t){var r=e.bsPrefix,n=e.fluid,i=e.as,o=void 0===i?"div":i,a=e.className,s=te(e,Kr),l=Ce(r,"container"),d="string"===typeof n?"-".concat(n):"-fluid";return(0,ge.jsx)(o,Q(Q({ref:t},s),{},{className:ne()(a,n?"".concat(l).concat(d):l)}))}));Yr.displayName="Container",Yr.defaultProps={fluid:!1};var Xr=Yr;__webpack_require__(3573);function $r(){return(0,t.useReducer)((function(e){return!e}),!1)[1]}var qr=t.createContext(null);qr.displayName="NavContext";var Jr=qr,Zr=t.createContext(null),Qr=["as","disabled"];function en(e){var t=e.tagName,r=e.disabled,n=e.href,i=e.target,o=e.rel,a=e.onClick,s=e.tabIndex,l=void 0===s?0:s,d=e.type;t||(t=null!=n||null!=i||null!=o?"a":"button");var u={tagName:t};if("button"===t)return[{type:d||"button",disabled:r},u];var c=function(e){(r||"a"===t&&function(e){return!e||"#"===e.trim()}(n))&&e.preventDefault(),r?e.stopPropagation():null==a||a(e)};return"a"===t&&(n||(n="#"),r&&(n=void 0)),[{role:"button",disabled:void 0,tabIndex:r?void 0:l,href:n,target:"a"===t?i:void 0,"aria-disabled":r||void 0,rel:"a"===t?o:void 0,onClick:c,onKeyDown:function(e){" "===e.key&&(e.preventDefault(),c(e))}},u]}var tn=t.forwardRef((function(e,t){var r=e.as,n=e.disabled,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,Qr),o=s(en(Object.assign({tagName:r,disabled:n},i)),2),a=o[0],l=o[1].tagName;return(0,ge.jsx)(l,Object.assign({},i,a,{ref:t}))}));tn.displayName="Button";var rn=tn,nn=["as","active","eventKey"];function on(e){var r=e.key,n=e.onClick,i=e.active,o=e.id,a=e.role,s=e.disabled,l=(0,t.useContext)(oe),d=(0,t.useContext)(Jr),u=(0,t.useContext)(Zr),c=i,h={role:a};if(d){a||"tablist"!==d.role||(h.role="tab");var p=d.getControllerId(null!=r?r:null),g=d.getControlledId(null!=r?r:null);h[wt("event-key")]=r,h.id=p||o,!(c=null==i&&null!=r?d.activeKey===r:i)&&(null!=u&&u.unmountOnExit||null!=u&&u.mountOnEnter)||(h["aria-controls"]=g)}return"tab"===h.role&&(s&&(h.tabIndex=-1,h["aria-disabled"]=!0),c?h["aria-selected"]=c:h.tabIndex=-1),h.onClick=Ot((function(e){s||(null==n||n(e),null!=r&&l&&!e.isPropagationStopped()&&l(r,e))})),[h,{isActive:c}]}var an=t.forwardRef((function(e,t){var r=e.as,n=void 0===r?rn:r,i=e.active,o=e.eventKey,a=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,nn),l=s(on(Object.assign({key:ie(o,a.href),active:i},a)),2),d=l[0],u=l[1];return d[wt("active")]=u.isActive,(0,ge.jsx)(n,Object.assign({},a,d,{ref:t}))}));an.displayName="NavItem";var sn=an,ln=["as","onSelect","activeKey","role","onKeyDown"];var dn=function(){},un=wt("event-key"),cn=t.forwardRef((function(e,r){var n,i,o=e.as,a=void 0===o?"div":o,s=e.onSelect,l=e.activeKey,d=e.role,u=e.onKeyDown,c=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,ln),h=$r(),p=(0,t.useRef)(!1),g=(0,t.useContext)(oe),f=(0,t.useContext)(Zr);f&&(d=d||"tablist",l=f.activeKey,n=f.getControlledId,i=f.getControllerId);var m=(0,t.useRef)(null),C=function(e){var t=m.current;if(!t)return null;var r=Ar(t,"[".concat(un,"]:not([aria-disabled=true])")),n=t.querySelector("[aria-selected=true]");if(!n||n!==document.activeElement)return null;var i=r.indexOf(n);if(-1===i)return null;var o=i+e;return o>=r.length&&(o=0),o<0&&(o=r.length-1),r[o]},y=function(e,t){null!=e&&(null==s||s(e,t),null==g||g(e,t))};(0,t.useEffect)((function(){if(m.current&&p.current){var e=m.current.querySelector("[".concat(un,"][aria-selected=true]"));null==e||e.focus()}p.current=!1}));var _=it(r,m);return(0,ge.jsx)(oe.Provider,{value:y,children:(0,ge.jsx)(Jr.Provider,{value:{role:d,activeKey:ie(l),getControlledId:n||dn,getControllerId:i||dn},children:(0,ge.jsx)(a,Object.assign({},c,{onKeyDown:function(e){if(null==u||u(e),f){var t,r;switch(e.key){case"ArrowLeft":case"ArrowUp":t=C(-1);break;case"ArrowRight":case"ArrowDown":t=C(1);break;default:return}if(t)e.preventDefault(),y(t.dataset[(r="EventKey","".concat("rrUi").concat(r))]||null,e),p.current=!0,h()}},ref:_,role:d}))})})}));cn.displayName="Nav";var hn=Object.assign(cn,{Item:sn}),pn=t.createContext(null);pn.displayName="CardHeaderContext";var gn=pn,fn=Oe("nav-item");function mn(){return(0,t.useState)(null)}var Cn="undefined"!==typeof __webpack_require__.g&&__webpack_require__.g.navigator&&"ReactNative"===__webpack_require__.g.navigator.product,yn="undefined"!==typeof document||Cn?t.useLayoutEffect:t.useEffect;new WeakMap;var _n=["onKeyDown"];var En=t.forwardRef((function(e,t){var r,n=e.onKeyDown,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,_n),o=s(en(Object.assign({tagName:"a"},i)),1)[0],a=Ot((function(e){o.onKeyDown(e),null==n||n(e)}));return((r=i.href)&&"#"!==r.trim()||i.role)&&"button"!==i.role?(0,ge.jsx)("a",Object.assign({ref:t},i,{onKeyDown:n})):(0,ge.jsx)("a",Object.assign({ref:t},i,o,{onKeyDown:a}))}));En.displayName="Anchor";var Tn=En,On=["bsPrefix","className","as","active","eventKey"],vn=t.forwardRef((function(e,t){var r=e.bsPrefix,n=e.className,i=e.as,o=void 0===i?Tn:i,a=e.active,l=e.eventKey,d=te(e,On);r=Ce(r,"nav-link");var u=s(on(Q({key:ie(l,d.href),active:a},d)),2),c=u[0],h=u[1];return(0,ge.jsx)(o,Q(Q(Q({},d),c),{},{ref:t,className:ne()(n,r,d.disabled&&"disabled",h.isActive&&"active")}))}));vn.displayName="NavLink",vn.defaultProps={disabled:!1};var Sn=vn,bn=["as","bsPrefix","variant","fill","justify","navbar","navbarScroll","className","activeKey"],An=t.forwardRef((function(e,r){var n,i,o,a=de(e,{activeKey:"onSelect"}),s=a.as,l=void 0===s?"div":s,d=a.bsPrefix,u=a.variant,c=a.fill,h=a.justify,p=a.navbar,g=a.navbarScroll,f=a.className,m=a.activeKey,C=te(a,bn),y=Ce(d,"nav"),_=!1,E=(0,t.useContext)(Ct),T=(0,t.useContext)(gn);return E?(i=E.bsPrefix,_=null==p||p):T&&(o=T.cardHeaderBsPrefix),(0,ge.jsx)(hn,Q({as:l,ref:r,activeKey:m,className:ne()(f,(n={},J(n,y,!_),J(n,"".concat(i,"-nav"),_),J(n,"".concat(i,"-nav-scroll"),_&&g),J(n,"".concat(o,"-").concat(u),!!o),J(n,"".concat(y,"-").concat(u),!!u),J(n,"".concat(y,"-fill"),c),J(n,"".concat(y,"-justified"),h),n))},C))}));An.displayName="Nav",An.defaultProps={justify:!1,fill:!1};var In=Object.assign(An,{Item:fn,Link:Sn}),Rn=t.createContext(null);function Dn(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=a(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}var Nn=Object.prototype.hasOwnProperty;function Pn(e,t,r){var n,i=Dn(e.keys());try{for(i.s();!(n=i.n()).done;)if(xn(r=n.value,t))return r}catch(o){i.e(o)}finally{i.f()}}function xn(e,t){var r,n,i;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return e.toString()===t.toString();if(r===Array){if((n=e.length)===t.length)for(;n--&&xn(e[n],t[n]););return-1===n}if(r===Set){if(e.size!==t.size)return!1;var o,a=Dn(e);try{for(a.s();!(o=a.n()).done;){if((i=n=o.value)&&"object"===typeof i&&!(i=Pn(t,i)))return!1;if(!t.has(i))return!1}}catch(d){a.e(d)}finally{a.f()}return!0}if(r===Map){if(e.size!==t.size)return!1;var s,l=Dn(e);try{for(l.s();!(s=l.n()).done;){if((i=(n=s.value)[0])&&"object"===typeof i&&!(i=Pn(t,i)))return!1;if(!xn(n[1],t.get(i)))return!1}}catch(d){l.e(d)}finally{l.f()}return!0}if(r===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(r===DataView){if((n=e.byteLength)===t.byteLength)for(;n--&&e.getInt8(n)===t.getInt8(n););return-1===n}if(ArrayBuffer.isView(e)){if((n=e.byteLength)===t.byteLength)for(;n--&&e[n]===t[n];);return-1===n}if(!r||"object"===typeof e){for(r in n=0,e){if(Nn.call(e,r)&&++n&&!Nn.call(t,r))return!1;if(!(r in t)||!xn(e[r],t[r]))return!1}return Object.keys(t).length===n}}return e!==e&&t!==t}var Mn=function(e){var r=Rt();return[e[0],(0,t.useCallback)((function(t){if(r())return e[1](t)}),[r,e[1]])]};function Ln(e){return e.split("-")[0]}function wn(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function kn(e){return e instanceof wn(e).Element||e instanceof Element}function Bn(e){return e instanceof wn(e).HTMLElement||e instanceof HTMLElement}function jn(e){return"undefined"!==typeof ShadowRoot&&(e instanceof wn(e).ShadowRoot||e instanceof ShadowRoot)}var Un=Math.max,Fn=Math.min,Wn=Math.round;function Vn(e,t){void 0===t&&(t=!1);var r=e.getBoundingClientRect(),n=1,i=1;if(Bn(e)&&t){var o=e.offsetHeight,a=e.offsetWidth;a>0&&(n=Wn(r.width)/a||1),o>0&&(i=Wn(r.height)/o||1)}return{width:r.width/n,height:r.height/i,top:r.top/i,right:r.right/n,bottom:r.bottom/i,left:r.left/n,x:r.left/n,y:r.top/i}}function Hn(e){var t=Vn(e),r=e.offsetWidth,n=e.offsetHeight;return Math.abs(t.width-r)<=1&&(r=t.width),Math.abs(t.height-n)<=1&&(n=t.height),{x:e.offsetLeft,y:e.offsetTop,width:r,height:n}}function Gn(e,t){var r=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(r&&jn(r)){var n=t;do{if(n&&e.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function zn(e){return e?(e.nodeName||"").toLowerCase():null}function Kn(e){return wn(e).getComputedStyle(e)}function Yn(e){return["table","td","th"].indexOf(zn(e))>=0}function Xn(e){return((kn(e)?e.ownerDocument:e.document)||window.document).documentElement}function $n(e){return"html"===zn(e)?e:e.assignedSlot||e.parentNode||(jn(e)?e.host:null)||Xn(e)}function qn(e){return Bn(e)&&"fixed"!==Kn(e).position?e.offsetParent:null}function Jn(e){for(var t=wn(e),r=qn(e);r&&Yn(r)&&"static"===Kn(r).position;)r=qn(r);return r&&("html"===zn(r)||"body"===zn(r)&&"static"===Kn(r).position)?t:r||function(e){var t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&Bn(e)&&"fixed"===Kn(e).position)return null;for(var r=$n(e);Bn(r)&&["html","body"].indexOf(zn(r))<0;){var n=Kn(r);if("none"!==n.transform||"none"!==n.perspective||"paint"===n.contain||-1!==["transform","perspective"].indexOf(n.willChange)||t&&"filter"===n.willChange||t&&n.filter&&"none"!==n.filter)return r;r=r.parentNode}return null}(e)||t}function Zn(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Qn(e,t,r){return Un(e,Fn(t,r))}function ei(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function ti(e,t){return t.reduce((function(t,r){return t[r]=e,t}),{})}var ri="top",ni="bottom",ii="right",oi="left",ai="auto",si=[ri,ni,ii,oi],li="start",di="end",ui="viewport",ci="popper",hi=si.reduce((function(e,t){return e.concat([t+"-"+li,t+"-"+di])}),[]),pi=[].concat(si,[ai]).reduce((function(e,t){return e.concat([t,t+"-"+li,t+"-"+di])}),[]),gi=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];var fi={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,r=e.state,n=e.name,i=e.options,o=r.elements.arrow,a=r.modifiersData.popperOffsets,s=Ln(r.placement),l=Zn(s),d=[oi,ii].indexOf(s)>=0?"height":"width";if(o&&a){var u=function(e,t){return ei("number"!==typeof(e="function"===typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:ti(e,si))}(i.padding,r),c=Hn(o),h="y"===l?ri:oi,p="y"===l?ni:ii,g=r.rects.reference[d]+r.rects.reference[l]-a[l]-r.rects.popper[d],f=a[l]-r.rects.reference[l],m=Jn(o),C=m?"y"===l?m.clientHeight||0:m.clientWidth||0:0,y=g/2-f/2,_=u[h],E=C-c[d]-u[p],T=C/2-c[d]/2+y,O=Qn(_,T,E),v=l;r.modifiersData[n]=((t={})[v]=O,t.centerOffset=O-T,t)}},effect:function(e){var t=e.state,r=e.options.element,n=void 0===r?"[data-popper-arrow]":r;null!=n&&("string"!==typeof n||(n=t.elements.popper.querySelector(n)))&&Gn(t.elements.popper,n)&&(t.elements.arrow=n)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function mi(e){return e.split("-")[1]}var Ci={top:"auto",right:"auto",bottom:"auto",left:"auto"};function yi(e){var t,r=e.popper,n=e.popperRect,i=e.placement,o=e.variation,a=e.offsets,s=e.position,l=e.gpuAcceleration,d=e.adaptive,u=e.roundOffsets,c=e.isFixed,h=a.x,p=void 0===h?0:h,g=a.y,f=void 0===g?0:g,m="function"===typeof u?u({x:p,y:f}):{x:p,y:f};p=m.x,f=m.y;var C=a.hasOwnProperty("x"),y=a.hasOwnProperty("y"),_=oi,E=ri,T=window;if(d){var O=Jn(r),v="clientHeight",S="clientWidth";if(O===wn(r)&&"static"!==Kn(O=Xn(r)).position&&"absolute"===s&&(v="scrollHeight",S="scrollWidth"),i===ri||(i===oi||i===ii)&&o===di)E=ni,f-=(c&&T.visualViewport?T.visualViewport.height:O[v])-n.height,f*=l?1:-1;if(i===oi||(i===ri||i===ni)&&o===di)_=ii,p-=(c&&T.visualViewport?T.visualViewport.width:O[S])-n.width,p*=l?1:-1}var b,A=Object.assign({position:s},d&&Ci),I=!0===u?function(e){var t=e.x,r=e.y,n=window.devicePixelRatio||1;return{x:Wn(t*n)/n||0,y:Wn(r*n)/n||0}}({x:p,y:f}):{x:p,y:f};return p=I.x,f=I.y,l?Object.assign({},A,((b={})[E]=y?"0":"",b[_]=C?"0":"",b.transform=(T.devicePixelRatio||1)<=1?"translate("+p+"px, "+f+"px)":"translate3d("+p+"px, "+f+"px, 0)",b)):Object.assign({},A,((t={})[E]=y?f+"px":"",t[_]=C?p+"px":"",t.transform="",t))}var _i={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,r=e.options,n=r.gpuAcceleration,i=void 0===n||n,o=r.adaptive,a=void 0===o||o,s=r.roundOffsets,l=void 0===s||s,d={placement:Ln(t.placement),variation:mi(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,yi(Object.assign({},d,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,yi(Object.assign({},d,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},Ei={passive:!0};var Ti={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,r=e.instance,n=e.options,i=n.scroll,o=void 0===i||i,a=n.resize,s=void 0===a||a,l=wn(t.elements.popper),d=[].concat(t.scrollParents.reference,t.scrollParents.popper);return o&&d.forEach((function(e){e.addEventListener("scroll",r.update,Ei)})),s&&l.addEventListener("resize",r.update,Ei),function(){o&&d.forEach((function(e){e.removeEventListener("scroll",r.update,Ei)})),s&&l.removeEventListener("resize",r.update,Ei)}},data:{}},Oi={left:"right",right:"left",bottom:"top",top:"bottom"};function vi(e){return e.replace(/left|right|bottom|top/g,(function(e){return Oi[e]}))}var Si={start:"end",end:"start"};function bi(e){return e.replace(/start|end/g,(function(e){return Si[e]}))}function Ai(e){var t=wn(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function Ii(e){return Vn(Xn(e)).left+Ai(e).scrollLeft}function Ri(e){var t=Kn(e),r=t.overflow,n=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(r+i+n)}function Di(e){return["html","body","#document"].indexOf(zn(e))>=0?e.ownerDocument.body:Bn(e)&&Ri(e)?e:Di($n(e))}function Ni(e,t){var r;void 0===t&&(t=[]);var n=Di(e),i=n===(null==(r=e.ownerDocument)?void 0:r.body),o=wn(n),a=i?[o].concat(o.visualViewport||[],Ri(n)?n:[]):n,s=t.concat(a);return i?s:s.concat(Ni($n(a)))}function Pi(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function xi(e,t){return t===ui?Pi(function(e){var t=wn(e),r=Xn(e),n=t.visualViewport,i=r.clientWidth,o=r.clientHeight,a=0,s=0;return n&&(i=n.width,o=n.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(a=n.offsetLeft,s=n.offsetTop)),{width:i,height:o,x:a+Ii(e),y:s}}(e)):kn(t)?function(e){var t=Vn(e);return t.top=t.top+e.clientTop,t.left=t.left+e.clientLeft,t.bottom=t.top+e.clientHeight,t.right=t.left+e.clientWidth,t.width=e.clientWidth,t.height=e.clientHeight,t.x=t.left,t.y=t.top,t}(t):Pi(function(e){var t,r=Xn(e),n=Ai(e),i=null==(t=e.ownerDocument)?void 0:t.body,o=Un(r.scrollWidth,r.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),a=Un(r.scrollHeight,r.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),s=-n.scrollLeft+Ii(e),l=-n.scrollTop;return"rtl"===Kn(i||r).direction&&(s+=Un(r.clientWidth,i?i.clientWidth:0)-o),{width:o,height:a,x:s,y:l}}(Xn(e)))}function Mi(e,t,r){var n="clippingParents"===t?function(e){var t=Ni($n(e)),r=["absolute","fixed"].indexOf(Kn(e).position)>=0&&Bn(e)?Jn(e):e;return kn(r)?t.filter((function(e){return kn(e)&&Gn(e,r)&&"body"!==zn(e)})):[]}(e):[].concat(t),i=[].concat(n,[r]),o=i[0],a=i.reduce((function(t,r){var n=xi(e,r);return t.top=Un(n.top,t.top),t.right=Fn(n.right,t.right),t.bottom=Fn(n.bottom,t.bottom),t.left=Un(n.left,t.left),t}),xi(e,o));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function Li(e){var t,r=e.reference,n=e.element,i=e.placement,o=i?Ln(i):null,a=i?mi(i):null,s=r.x+r.width/2-n.width/2,l=r.y+r.height/2-n.height/2;switch(o){case ri:t={x:s,y:r.y-n.height};break;case ni:t={x:s,y:r.y+r.height};break;case ii:t={x:r.x+r.width,y:l};break;case oi:t={x:r.x-n.width,y:l};break;default:t={x:r.x,y:r.y}}var d=o?Zn(o):null;if(null!=d){var u="y"===d?"height":"width";switch(a){case li:t[d]=t[d]-(r[u]/2-n[u]/2);break;case di:t[d]=t[d]+(r[u]/2-n[u]/2)}}return t}function wi(e,t){void 0===t&&(t={});var r=t,n=r.placement,i=void 0===n?e.placement:n,o=r.boundary,a=void 0===o?"clippingParents":o,s=r.rootBoundary,l=void 0===s?ui:s,d=r.elementContext,u=void 0===d?ci:d,c=r.altBoundary,h=void 0!==c&&c,p=r.padding,g=void 0===p?0:p,f=ei("number"!==typeof g?g:ti(g,si)),m=u===ci?"reference":ci,C=e.rects.popper,y=e.elements[h?m:u],_=Mi(kn(y)?y:y.contextElement||Xn(e.elements.popper),a,l),E=Vn(e.elements.reference),T=Li({reference:E,element:C,strategy:"absolute",placement:i}),O=Pi(Object.assign({},C,T)),v=u===ci?O:E,S={top:_.top-v.top+f.top,bottom:v.bottom-_.bottom+f.bottom,left:_.left-v.left+f.left,right:v.right-_.right+f.right},b=e.modifiersData.offset;if(u===ci&&b){var A=b[i];Object.keys(S).forEach((function(e){var t=[ii,ni].indexOf(e)>=0?1:-1,r=[ri,ni].indexOf(e)>=0?"y":"x";S[e]+=A[r]*t}))}return S}var ki={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,r=e.options,n=e.name;if(!t.modifiersData[n]._skip){for(var i=r.mainAxis,o=void 0===i||i,a=r.altAxis,s=void 0===a||a,l=r.fallbackPlacements,d=r.padding,u=r.boundary,c=r.rootBoundary,h=r.altBoundary,p=r.flipVariations,g=void 0===p||p,f=r.allowedAutoPlacements,m=t.options.placement,C=Ln(m),y=l||(C===m||!g?[vi(m)]:function(e){if(Ln(e)===ai)return[];var t=vi(e);return[bi(e),t,bi(t)]}(m)),_=[m].concat(y).reduce((function(e,r){return e.concat(Ln(r)===ai?function(e,t){void 0===t&&(t={});var r=t,n=r.placement,i=r.boundary,o=r.rootBoundary,a=r.padding,s=r.flipVariations,l=r.allowedAutoPlacements,d=void 0===l?pi:l,u=mi(n),c=u?s?hi:hi.filter((function(e){return mi(e)===u})):si,h=c.filter((function(e){return d.indexOf(e)>=0}));0===h.length&&(h=c);var p=h.reduce((function(t,r){return t[r]=wi(e,{placement:r,boundary:i,rootBoundary:o,padding:a})[Ln(r)],t}),{});return Object.keys(p).sort((function(e,t){return p[e]-p[t]}))}(t,{placement:r,boundary:u,rootBoundary:c,padding:d,flipVariations:g,allowedAutoPlacements:f}):r)}),[]),E=t.rects.reference,T=t.rects.popper,O=new Map,v=!0,S=_[0],b=0;b<_.length;b++){var A=_[b],I=Ln(A),R=mi(A)===li,D=[ri,ni].indexOf(I)>=0,N=D?"width":"height",P=wi(t,{placement:A,boundary:u,rootBoundary:c,altBoundary:h,padding:d}),x=D?R?ii:oi:R?ni:ri;E[N]>T[N]&&(x=vi(x));var M=vi(x),L=[];if(o&&L.push(P[I]<=0),s&&L.push(P[x]<=0,P[M]<=0),L.every((function(e){return e}))){S=A,v=!1;break}O.set(A,L)}if(v)for(var w=function(e){var t=_.find((function(t){var r=O.get(t);if(r)return r.slice(0,e).every((function(e){return e}))}));if(t)return S=t,"break"},k=g?3:1;k>0;k--){if("break"===w(k))break}t.placement!==S&&(t.modifiersData[n]._skip=!0,t.placement=S,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Bi(e,t,r){return void 0===r&&(r={x:0,y:0}),{top:e.top-t.height-r.y,right:e.right-t.width+r.x,bottom:e.bottom-t.height+r.y,left:e.left-t.width-r.x}}function ji(e){return[ri,ii,ni,oi].some((function(t){return e[t]>=0}))}var Ui={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,r=e.options,n=e.name,i=r.offset,o=void 0===i?[0,0]:i,a=pi.reduce((function(e,r){return e[r]=function(e,t,r){var n=Ln(e),i=[oi,ri].indexOf(n)>=0?-1:1,o="function"===typeof r?r(Object.assign({},t,{placement:e})):r,a=o[0],s=o[1];return a=a||0,s=(s||0)*i,[oi,ii].indexOf(n)>=0?{x:s,y:a}:{x:a,y:s}}(r,t.rects,o),e}),{}),s=a[t.placement],l=s.x,d=s.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=d),t.modifiersData[n]=a}};var Fi={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,r=e.options,n=e.name,i=r.mainAxis,o=void 0===i||i,a=r.altAxis,s=void 0!==a&&a,l=r.boundary,d=r.rootBoundary,u=r.altBoundary,c=r.padding,h=r.tether,p=void 0===h||h,g=r.tetherOffset,f=void 0===g?0:g,m=wi(t,{boundary:l,rootBoundary:d,padding:c,altBoundary:u}),C=Ln(t.placement),y=mi(t.placement),_=!y,E=Zn(C),T="x"===E?"y":"x",O=t.modifiersData.popperOffsets,v=t.rects.reference,S=t.rects.popper,b="function"===typeof f?f(Object.assign({},t.rects,{placement:t.placement})):f,A="number"===typeof b?{mainAxis:b,altAxis:b}:Object.assign({mainAxis:0,altAxis:0},b),I=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,R={x:0,y:0};if(O){if(o){var D,N="y"===E?ri:oi,P="y"===E?ni:ii,x="y"===E?"height":"width",M=O[E],L=M+m[N],w=M-m[P],k=p?-S[x]/2:0,B=y===li?v[x]:S[x],j=y===li?-S[x]:-v[x],U=t.elements.arrow,F=p&&U?Hn(U):{width:0,height:0},W=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},V=W[N],H=W[P],G=Qn(0,v[x],F[x]),z=_?v[x]/2-k-G-V-A.mainAxis:B-G-V-A.mainAxis,K=_?-v[x]/2+k+G+H+A.mainAxis:j+G+H+A.mainAxis,Y=t.elements.arrow&&Jn(t.elements.arrow),X=Y?"y"===E?Y.clientTop||0:Y.clientLeft||0:0,$=null!=(D=null==I?void 0:I[E])?D:0,q=M+K-$,J=Qn(p?Fn(L,M+z-$-X):L,M,p?Un(w,q):w);O[E]=J,R[E]=J-M}if(s){var Z,Q="x"===E?ri:oi,ee="x"===E?ni:ii,te=O[T],re="y"===T?"height":"width",ne=te+m[Q],ie=te-m[ee],oe=-1!==[ri,oi].indexOf(C),ae=null!=(Z=null==I?void 0:I[T])?Z:0,se=oe?ne:te-v[re]-S[re]-ae+A.altAxis,le=oe?te+v[re]+S[re]-ae-A.altAxis:ie,de=p&&oe?function(e,t,r){var n=Qn(e,t,r);return n>r?r:n}(se,te,le):Qn(p?se:ne,te,p?le:ie);O[T]=de,R[T]=de-te}t.modifiersData[n]=R}},requiresIfExists:["offset"]};function Wi(e,t,r){void 0===r&&(r=!1);var n=Bn(t),i=Bn(t)&&function(e){var t=e.getBoundingClientRect(),r=Wn(t.width)/e.offsetWidth||1,n=Wn(t.height)/e.offsetHeight||1;return 1!==r||1!==n}(t),o=Xn(t),a=Vn(e,i),s={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!r)&&(("body"!==zn(t)||Ri(o))&&(s=function(e){return e!==wn(e)&&Bn(e)?{scrollLeft:(t=e).scrollLeft,scrollTop:t.scrollTop}:Ai(e);var t}(t)),Bn(t)?((l=Vn(t,!0)).x+=t.clientLeft,l.y+=t.clientTop):o&&(l.x=Ii(o))),{x:a.left+s.scrollLeft-l.x,y:a.top+s.scrollTop-l.y,width:a.width,height:a.height}}function Vi(e){var t=new Map,r=new Set,n=[];function i(e){r.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!r.has(e)){var n=t.get(e);n&&i(n)}})),n.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){r.has(e.name)||i(e)})),n}function Hi(e){var t;return function(){return t||(t=new Promise((function(r){Promise.resolve().then((function(){t=void 0,r(e())}))}))),t}}var Gi={placement:"bottom",modifiers:[],strategy:"absolute"};function zi(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return!t.some((function(e){return!(e&&"function"===typeof e.getBoundingClientRect)}))}function Ki(e){void 0===e&&(e={});var t=e,r=t.defaultModifiers,n=void 0===r?[]:r,i=t.defaultOptions,o=void 0===i?Gi:i;return function(e,t,r){void 0===r&&(r=o);var i={placement:"bottom",orderedModifiers:[],options:Object.assign({},Gi,o),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},a=[],s=!1,l={state:i,setOptions:function(r){var s="function"===typeof r?r(i.options):r;d(),i.options=Object.assign({},o,i.options,s),i.scrollParents={reference:kn(e)?Ni(e):e.contextElement?Ni(e.contextElement):[],popper:Ni(t)};var u=function(e){var t=Vi(e);return gi.reduce((function(e,r){return e.concat(t.filter((function(e){return e.phase===r})))}),[])}(function(e){var t=e.reduce((function(e,t){var r=e[t.name];return e[t.name]=r?Object.assign({},r,t,{options:Object.assign({},r.options,t.options),data:Object.assign({},r.data,t.data)}):t,e}),{});return Object.keys(t).map((function(e){return t[e]}))}([].concat(n,i.options.modifiers)));return i.orderedModifiers=u.filter((function(e){return e.enabled})),i.orderedModifiers.forEach((function(e){var t=e.name,r=e.options,n=void 0===r?{}:r,o=e.effect;if("function"===typeof o){var s=o({state:i,name:t,instance:l,options:n}),d=function(){};a.push(s||d)}})),l.update()},forceUpdate:function(){if(!s){var e=i.elements,t=e.reference,r=e.popper;if(zi(t,r)){i.rects={reference:Wi(t,Jn(r),"fixed"===i.options.strategy),popper:Hn(r)},i.reset=!1,i.placement=i.options.placement,i.orderedModifiers.forEach((function(e){return i.modifiersData[e.name]=Object.assign({},e.data)}));for(var n=0;n<i.orderedModifiers.length;n++)if(!0!==i.reset){var o=i.orderedModifiers[n],a=o.fn,d=o.options,u=void 0===d?{}:d,c=o.name;"function"===typeof a&&(i=a({state:i,options:u,name:c,instance:l})||i)}else i.reset=!1,n=-1}}},update:Hi((function(){return new Promise((function(e){l.forceUpdate(),e(i)}))})),destroy:function(){d(),s=!0}};if(!zi(e,t))return l;function d(){a.forEach((function(e){return e()})),a=[]}return l.setOptions(r).then((function(e){!s&&r.onFirstUpdate&&r.onFirstUpdate(e)})),l}}var Yi=Ki({defaultModifiers:[{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,r=e.name,n=t.rects.reference,i=t.rects.popper,o=t.modifiersData.preventOverflow,a=wi(t,{elementContext:"reference"}),s=wi(t,{altBoundary:!0}),l=Bi(a,n),d=Bi(s,i,o),u=ji(l),c=ji(d);t.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:d,isReferenceHidden:u,hasPopperEscaped:c},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":c})}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,r=e.name;t.modifiersData[r]=Li({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},_i,Ti,Ui,ki,Fi,fi]}),Xi=["enabled","placement","strategy","modifiers"];function $i(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}var qi={name:"applyStyles",enabled:!1,phase:"afterWrite",fn:function(){}},Ji={name:"ariaDescribedBy",enabled:!0,phase:"afterWrite",effect:function(e){var t=e.state;return function(){var e=t.elements,r=e.reference,n=e.popper;if("removeAttribute"in r){var i=(r.getAttribute("aria-describedby")||"").split(",").filter((function(e){return e.trim()!==n.id}));i.length?r.setAttribute("aria-describedby",i.join(",")):r.removeAttribute("aria-describedby")}}},fn:function(e){var t,r=e.state.elements,n=r.popper,i=r.reference,o=null==(t=n.getAttribute("role"))?void 0:t.toLowerCase();if(n.id&&"tooltip"===o&&"setAttribute"in i){var a=i.getAttribute("aria-describedby");if(a&&-1!==a.split(",").indexOf(n.id))return;i.setAttribute("aria-describedby",a?"".concat(a,",").concat(n.id):n.id)}}},Zi=[];var Qi=function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.enabled,o=void 0===i||i,a=n.placement,l=void 0===a?"bottom":a,d=n.strategy,u=void 0===d?"absolute":d,c=n.modifiers,h=void 0===c?Zi:c,p=$i(n,Xi),g=(0,t.useRef)(h),f=(0,t.useRef)(),m=(0,t.useCallback)((function(){var e;null==(e=f.current)||e.update()}),[]),C=(0,t.useCallback)((function(){var e;null==(e=f.current)||e.forceUpdate()}),[]),y=Mn((0,t.useState)({placement:l,update:m,forceUpdate:C,attributes:{},styles:{popper:{},arrow:{}}})),_=s(y,2),E=_[0],T=_[1],O=(0,t.useMemo)((function(){return{name:"updateStateModifier",enabled:!0,phase:"write",requires:["computeStyles"],fn:function(e){var t=e.state,r={},n={};Object.keys(t.elements).forEach((function(e){r[e]=t.styles[e],n[e]=t.attributes[e]})),T({state:t,styles:r,attributes:n,update:m,forceUpdate:C,placement:t.placement})}}}),[m,C,T]),v=(0,t.useMemo)((function(){return xn(g.current,h)||(g.current=h),g.current}),[h]);return(0,t.useEffect)((function(){f.current&&o&&f.current.setOptions({placement:l,strategy:u,modifiers:[].concat(Pt(v),[O,qi])})}),[u,l,O,o,v]),(0,t.useEffect)((function(){if(o&&null!=e&&null!=r)return f.current=Yi(e,r,Object.assign({},p,{placement:l,strategy:u,modifiers:[].concat(Pt(v),[Ji,O])})),function(){null!=f.current&&(f.current.destroy(),f.current=void 0,T((function(e){return Object.assign({},e,{attributes:{},styles:{popper:{}}})})))}}),[o,e,r]),E},eo=__webpack_require__(2391),to=__webpack_require__.n(eo),ro=function(){};function no(e){return 0===e.button}function io(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}var oo=function(e){return e&&("current"in e?e.current:e)};var ao=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ro,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.disabled,o=n.clickTrigger,a=void 0===o?"click":o,s=(0,t.useRef)(!1),l=(0,t.useCallback)((function(t){var r=oo(e);to()(!!r,"ClickOutside captured a close event but does not have a ref to compare it to. useClickOutside(), should be passed a ref that resolves to a DOM node"),s.current=!r||io(t)||!no(t)||!!It(r,t.target)}),[e]),d=Ot((function(e){s.current||r(e)}));(0,t.useEffect)((function(){if(!i&&null!=e){var t=Ae(oo(e)),r=(t.defaultView||window).event,n=qe(t,a,l,!0),o=qe(t,a,(function(e){e!==r?d(e):r=void 0})),s=[];return"ontouchstart"in t.documentElement&&(s=[].slice.call(t.body.children).map((function(e){return qe(e,"mousemove",ro)}))),function(){n(),o(),s.forEach((function(e){return e()}))}}}),[e,i,a,l,d])};function so(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Array.isArray(e)?e:Object.keys(e).map((function(t){return e[t].name=t,e[t]}))}function lo(e){var t,r,n,i,o=e.enabled,a=e.enableEvents,s=e.placement,l=e.flip,d=e.offset,u=e.fixed,c=e.containerPadding,h=e.arrowElement,p=e.popperConfig,g=void 0===p?{}:p,f=function(e){var t={};return Array.isArray(e)?(null==e||e.forEach((function(e){t[e.name]=e})),t):e||t}(g.modifiers);return Object.assign({},g,{placement:s,enabled:o,strategy:u?"fixed":g.strategy,modifiers:so(Object.assign({},f,{eventListeners:{enabled:a},preventOverflow:Object.assign({},f.preventOverflow,{options:c?Object.assign({padding:c},null==(t=f.preventOverflow)?void 0:t.options):null==(r=f.preventOverflow)?void 0:r.options}),offset:{options:Object.assign({offset:d},null==(n=f.offset)?void 0:n.options)},arrow:Object.assign({},f.arrow,{enabled:!!h,options:Object.assign({},null==(i=f.arrow)?void 0:i.options,{element:h})}),flip:Object.assign({enabled:!!l},f.flip)}))})}var uo=["children"];var co=function(){};function ho(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,t.useContext)(Rn),n=mn(),i=s(n,2),o=i[0],a=i[1],l=(0,t.useRef)(!1),d=e.flip,u=e.offset,c=e.rootCloseEvent,h=e.fixed,p=void 0!==h&&h,g=e.placement,f=e.popperConfig,m=void 0===f?{}:f,C=e.enableEventListeners,y=void 0===C||C,_=e.usePopper,E=void 0===_?!!r:_,T=null==(null==r?void 0:r.show)?!!e.show:r.show;T&&!l.current&&(l.current=!0);var O=function(e){null==r||r.toggle(!1,e)},v=r||{},S=v.placement,b=v.setMenu,A=v.menuElement,I=v.toggleElement,R=Qi(I,A,lo({placement:g||S||"bottom-start",enabled:E,enableEvents:null==y?T:y,offset:u,flip:d,fixed:p,arrowElement:o,popperConfig:m})),D=Object.assign({ref:b||co,"aria-labelledby":null==I?void 0:I.id},R.attributes.popper,{style:R.styles.popper}),N={show:T,placement:S,hasShown:l.current,toggle:null==r?void 0:r.toggle,popper:E?R:null,arrowProps:E?Object.assign({ref:a},R.attributes.arrow,{style:R.styles.arrow}):{}};return ao(A,O,{clickTrigger:c,disabled:!T}),[D,N]}function po(e){var t=e.children,r=s(ho(function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,uo)),2),n=r[0],i=r[1];return(0,ge.jsx)(ge.Fragment,{children:t(n,i)})}po.displayName="DropdownMenu",po.defaultProps={usePopper:!0};var go=po;function fo(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var mo={};fo(mo,"SSRProvider",(function(){return _o})),fo(mo,"useSSRSafeId",(function(){return To})),fo(mo,"useIsSSR",(function(){return Oo}));var Co={prefix:String(Math.round(1e10*Math.random())),current:0},yo=t.createContext(Co);function _o(e){var r=(0,t.useContext)(yo),n=(0,t.useMemo)((function(){return{prefix:r===Co?"":"".concat(r.prefix,"-").concat(++r.current),current:0}}),[r]);return t.createElement(yo.Provider,{value:n},e.children)}var Eo=Boolean("undefined"!==typeof window&&window.document&&window.document.createElement);function To(e){var r=(0,t.useContext)(yo);return r!==Co||Eo||console.warn("When server rendering, you must wrap your application in an <SSRProvider> to ensure consistent ids are generated between the client and server."),(0,t.useMemo)((function(){return e||"react-aria".concat(r.prefix,"-").concat(++r.current)}),[e])}function Oo(){var e=(0,t.useContext)(yo)!==Co,r=s((0,t.useState)(e),2),n=r[0],i=r[1];return"undefined"!==typeof window&&e&&(0,t.useLayoutEffect)((function(){i(!1)}),[]),n}var vo=function(e){var t;return"menu"===(null==(t=e.getAttribute("role"))?void 0:t.toLowerCase())},So=function(){};function bo(){var e=To(),r=(0,t.useContext)(Rn)||{},n=r.show,i=void 0!==n&&n,o=r.toggle,a=void 0===o?So:o,s=r.setToggle,l=r.menuElement,d=(0,t.useCallback)((function(e){a(!i,e)}),[i,a]),u={id:e,ref:s||So,onClick:d,"aria-expanded":!!i};return l&&vo(l)&&(u["aria-haspopup"]=!0),[u,{show:i,toggle:a}]}function Ao(e){var t=e.children,r=s(bo(),2),n=r[0],i=r[1];return(0,ge.jsx)(ge.Fragment,{children:t(n,i)})}Ao.displayName="DropdownToggle";var Io=Ao,Ro=["eventKey","disabled","onClick","active","as"];function Do(e){var r=e.key,n=e.href,i=e.active,o=e.disabled,a=e.onClick,s=(0,t.useContext)(oe),l=((0,t.useContext)(Jr)||{}).activeKey,d=ie(r,n),u=null==i&&null!=r?ie(l)===d:i;return[J({onClick:Ot((function(e){o||(null==a||a(e),s&&!e.isPropagationStopped()&&s(d,e))})),"aria-disabled":o||void 0,"aria-selected":u},wt("dropdown-item"),""),{isActive:u}]}var No=t.forwardRef((function(e,t){var r=e.eventKey,n=e.disabled,i=e.onClick,o=e.active,a=e.as,l=void 0===a?rn:a,d=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,Ro),u=s(Do({key:r,href:d.href,disabled:n,onClick:i,active:o}),1)[0];return(0,ge.jsx)(l,Object.assign({},d,{ref:t},u))}));No.displayName="DropdownItem";var Po=No;function xo(){var e=$r(),r=(0,t.useRef)(null),n=(0,t.useCallback)((function(t){r.current=t,e()}),[e]);return[r,n]}function Mo(e){var r=e.defaultShow,n=e.show,i=e.onSelect,o=e.onToggle,a=e.itemSelector,l=void 0===a?"* [".concat(wt("dropdown-item"),"]"):a,d=e.focusFirstItemOnShow,u=e.placement,c=void 0===u?"bottom-start":u,h=e.children,p=Ft(),g=s(le(n,r,o),2),f=g[0],m=g[1],C=s(xo(),2),y=C[0],_=C[1],E=y.current,T=s(xo(),2),O=T[0],v=T[1],S=O.current,b=Nt(f),A=(0,t.useRef)(null),I=(0,t.useRef)(!1),R=(0,t.useContext)(oe),D=(0,t.useCallback)((function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null==t?void 0:t.type;m(e,{originalEvent:t,source:r})}),[m]),N=Ot((function(e,t){null==i||i(e,t),D(!1,t,"select"),t.isPropagationStopped()||null==R||R(e,t)})),P=(0,t.useMemo)((function(){return{toggle:D,placement:c,show:f,menuElement:E,toggleElement:S,setMenu:_,setToggle:v}}),[D,c,f,E,S,_,v]);E&&b&&!f&&(I.current=E.contains(E.ownerDocument.activeElement));var x=Ot((function(){S&&S.focus&&S.focus()})),M=Ot((function(){var e=A.current,t=d;if(null==t&&(t=!(!y.current||!vo(y.current))&&"keyboard"),!1!==t&&("keyboard"!==t||/^key.+$/.test(e))){var r=Ar(y.current,l)[0];r&&r.focus&&r.focus()}}));(0,t.useEffect)((function(){f?M():I.current&&(I.current=!1,x())}),[f,I,x,M]),(0,t.useEffect)((function(){A.current=null}));var L=function(e,t){if(!y.current)return null;var r=Ar(y.current,l),n=r.indexOf(e)+t;return r[n=Math.max(0,Math.min(n,r.length))]};return function(e,r,n,i){void 0===i&&(i=!1);var o=Ot(n);(0,t.useEffect)((function(){var t="function"===typeof e?e():e;return t.addEventListener(r,o,i),function(){return t.removeEventListener(r,o,i)}}),[e])}((0,t.useCallback)((function(){return p.document}),[p]),"keydown",(function(e){var t,r,n=e.key,i=e.target,o=null==(t=y.current)?void 0:t.contains(i),a=null==(r=O.current)?void 0:r.contains(i);if((!/input|textarea/i.test(i.tagName)||!(" "===n||"Escape"!==n&&o||"Escape"===n&&"search"===i.type))&&(o||a)&&("Tab"!==n||y.current&&f)){A.current=e.type;var s={originalEvent:e,source:e.type};switch(n){case"ArrowUp":var l=L(i,-1);return l&&l.focus&&l.focus(),void e.preventDefault();case"ArrowDown":if(e.preventDefault(),f){var d=L(i,1);d&&d.focus&&d.focus()}else m(!0,s);return;case"Tab":Xe(i.ownerDocument,"keyup",(function(e){var t;("Tab"!==e.key||e.target)&&null!=(t=y.current)&&t.contains(e.target)||m(!1,s)}),{once:!0});break;case"Escape":"Escape"===n&&(e.preventDefault(),e.stopPropagation()),m(!1,s)}}})),(0,ge.jsx)(oe.Provider,{value:N,children:(0,ge.jsx)(Rn.Provider,{value:P,children:h})})}Mo.displayName="Dropdown",Mo.Menu=go,Mo.Toggle=Io,Mo.Item=Po;var Lo=Mo,wo=t.createContext({});wo.displayName="DropdownContext";var ko=wo,Bo=["bsPrefix","className","eventKey","disabled","onClick","active","as"],jo=t.forwardRef((function(e,t){var r=e.bsPrefix,n=e.className,i=e.eventKey,o=e.disabled,a=void 0!==o&&o,l=e.onClick,d=e.active,u=e.as,c=void 0===u?Tn:u,h=te(e,Bo),p=Ce(r,"dropdown-item"),g=s(Do({key:i,href:h.href,disabled:a,onClick:l,active:d}),2),f=g[0],m=g[1];return(0,ge.jsx)(c,Q(Q(Q({},h),f),{},{ref:t,className:ne()(n,p,m.isActive&&"active",a&&"disabled")}))}));jo.displayName="DropdownItem";var Uo=jo,Fo=t.createContext(null);Fo.displayName="InputGroupContext";var Wo=Fo;function Vo(e,t){return e}var Ho=["bsPrefix","className","align","rootCloseEvent","flip","show","renderOnMount","as","popperConfig","variant"];function Go(e,t,r){var n=e?r?"bottom-start":"bottom-end":r?"bottom-end":"bottom-start";return"up"===t?n=e?r?"top-start":"top-end":r?"top-end":"top-start":"end"===t?n=e?r?"left-end":"right-end":r?"left-start":"right-start":"start"===t&&(n=e?r?"right-end":"left-end":r?"right-start":"left-start"),n}var zo=t.forwardRef((function(e,r){var n=e.bsPrefix,i=e.className,o=e.align,a=e.rootCloseEvent,l=e.flip,d=e.show,u=e.renderOnMount,c=e.as,h=void 0===c?"div":c,p=e.popperConfig,g=e.variant,f=te(e,Ho),m=!1,C=(0,t.useContext)(Ct),y=Ce(n,"dropdown-menu"),_=(0,t.useContext)(ko),E=_.align,T=_.drop,O=_.isRTL;o=o||E;var v=(0,t.useContext)(Wo),S=[];if(o)if("object"===typeof o){var b=Object.keys(o);if(b.length){var A=b[0],I=o[A];m="start"===I,S.push("".concat(y,"-").concat(A,"-").concat(I))}}else"end"===o&&(m=!0);var R=Go(m,T,O),D=s(ho({flip:l,rootCloseEvent:a,show:d,usePopper:!C&&0===S.length,offset:[0,2],popperConfig:p,placement:R}),2),N=D[0],P=D[1],x=P.hasShown,M=P.popper,L=P.show,w=P.toggle;if(N.ref=it(Vo(r),N.ref),yn((function(){L&&(null==M||M.update())}),[L]),!x&&!u&&!v)return null;"string"!==typeof h&&(N.show=L,N.close=function(){return null==w?void 0:w(!1)},N.align=o);var k=f.style;return null!=M&&M.placement&&(k=Q(Q({},f.style),N.style),f["x-placement"]=M.placement),(0,ge.jsx)(h,Q(Q(Q(Q({},f),N),{},{style:k},(S.length||C)&&{"data-bs-popper":"static"}),{},{className:ne().apply(void 0,[i,y,L&&"show",m&&"".concat(y,"-end"),g&&"".concat(y,"-").concat(g)].concat(S))}))}));zo.displayName="DropdownMenu",zo.defaultProps={flip:!0};var Ko=zo,Yo=["as","bsPrefix","variant","size","active","className"],Xo=t.forwardRef((function(e,t){var r=e.as,n=e.bsPrefix,i=e.variant,o=e.size,a=e.active,l=e.className,d=te(e,Yo),u=Ce(n,"btn"),c=s(en(Q({tagName:r},d)),2),h=c[0],p=c[1].tagName;return(0,ge.jsx)(p,Q(Q(Q({},h),d),{},{ref:t,className:ne()(l,u,a&&"active",i&&"".concat(u,"-").concat(i),o&&"".concat(u,"-").concat(o),d.href&&d.disabled&&"disabled")}))}));Xo.displayName="Button",Xo.defaultProps={variant:"primary",active:!1,disabled:!1};var $o=Xo,qo=["bsPrefix","split","className","childBsPrefix","as"],Jo=t.forwardRef((function(e,r){var n=e.bsPrefix,i=e.split,o=e.className,a=e.childBsPrefix,l=e.as,d=void 0===l?$o:l,u=te(e,qo),c=Ce(n,"dropdown-toggle"),h=(0,t.useContext)(Rn),p=(0,t.useContext)(Wo);void 0!==a&&(u.bsPrefix=a);var g=s(bo(),1)[0];return g.ref=it(g.ref,Vo(r)),(0,ge.jsx)(d,Q(Q({className:ne()(o,c,i&&"".concat(c,"-split"),!!p&&(null==h?void 0:h.show)&&"show")},g),u))}));Jo.displayName="DropdownToggle";var Zo=Jo,Qo=["bsPrefix","drop","show","className","align","onSelect","onToggle","focusFirstItemOnShow","as","navbar","autoClose"],ea=Oe("dropdown-header",{defaultProps:{role:"heading"}}),ta=Oe("dropdown-divider",{Component:"hr",defaultProps:{role:"separator"}}),ra=Oe("dropdown-item-text",{Component:"span"}),na=t.forwardRef((function(e,r){var n=de(e,{show:"onToggle"}),i=n.bsPrefix,o=n.drop,a=n.show,s=n.className,l=n.align,d=n.onSelect,u=n.onToggle,c=n.focusFirstItemOnShow,h=n.as,p=void 0===h?"div":h,g=(n.navbar,n.autoClose),f=te(n,Qo),m=(0,t.useContext)(Wo),C=Ce(i,"dropdown"),y=_e(),_=Ot((function(e,t){var r;t.originalEvent.currentTarget!==document||"keydown"===t.source&&"Escape"!==t.originalEvent.key||(t.source="rootClose"),r=t.source,(!1===g?"click"===r:"inside"===g?"rootClose"!==r:"outside"!==g||"select"!==r)&&(null==u||u(e,t))})),E=Go("end"===l,o,y),T=(0,t.useMemo)((function(){return{align:l,drop:o,isRTL:y}}),[l,o,y]);return(0,ge.jsx)(ko.Provider,{value:T,children:(0,ge.jsx)(Lo,{placement:E,show:a,onSelect:d,onToggle:_,focusFirstItemOnShow:c,itemSelector:".".concat(C,"-item:not(.disabled):not(:disabled)"),children:m?f.children:(0,ge.jsx)(p,Q(Q({},f),{},{ref:r,className:ne()(s,a&&"show",(!o||"down"===o)&&C,"up"===o&&"dropup","end"===o&&"dropend","start"===o&&"dropstart")}))})})}));na.displayName="Dropdown",na.defaultProps={navbar:!1,align:"start",autoClose:!0};var ia=Object.assign(na,{Toggle:Zo,Menu:Ko,Item:Uo,ItemText:ra,Divider:ta,Header:ea}),oa=["id","title","children","bsPrefix","className","rootCloseEvent","menuRole","disabled","active","renderMenuOnMount","menuVariant"],aa=t.forwardRef((function(e,t){var r=e.id,n=e.title,i=e.children,o=e.bsPrefix,a=e.className,s=e.rootCloseEvent,l=e.menuRole,d=e.disabled,u=e.active,c=e.renderMenuOnMount,h=e.menuVariant,p=te(e,oa),g=Ce(void 0,"nav-item");return(0,ge.jsxs)(ia,Q(Q({ref:t},p),{},{className:ne()(a,g),children:[(0,ge.jsx)(ia.Toggle,{id:r,eventKey:null,active:u,disabled:d,childBsPrefix:o,as:Sn,children:n}),(0,ge.jsx)(ia.Menu,{role:l,renderOnMount:c,rootCloseEvent:s,variant:h,children:i})]}))}));aa.displayName="NavDropdown";var sa=Object.assign(aa,{Item:ia.Item,ItemText:ia.ItemText,Divider:ia.Divider,Header:ia.Header});function la(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(d){return void r(d)}s.done?t(l):Promise.resolve(l).then(n,i)}function da(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){la(o,n,i,a,s,"next",e)}function s(e){la(o,n,i,a,s,"throw",e)}a(void 0)}))}}var ua=__webpack_require__(7757),ca=__webpack_require__.n(ua);function ha(e){this.message=e}ha.prototype=new Error,ha.prototype.name="InvalidCharacterError";var pa="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new ha("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,i=0,o=0,a="";n=t.charAt(o++);~n&&(r=i%4?64*r+n:n,i++%4)?a+=String.fromCharCode(255&r>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return a};function ga(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(pa(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return pa(t)}}function fa(e){this.message=e}fa.prototype=new Error,fa.prototype.name="InvalidTokenError";var ma=function(e,t){if("string"!=typeof e)throw new fa("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(ga(e.split(".")[r]))}catch(e){throw new fa("Invalid token specified: "+e.message)}},Ca=(0,t.createContext)(),ya=Ca,_a=function(e){var r=e.children,n=s((0,t.useState)(!0),2),i=n[0],o=n[1],a=s((0,t.useState)(!1),2),l=a[0],d=a[1],u=s((0,t.useState)((function(){return localStorage.getItem("authTokens")?JSON.parse(localStorage.getItem("authTokens")):null})),2),c=u[0],p=u[1],g=s((0,t.useState)((function(){return function(){if(localStorage.getItem("authTokens")){var e=JSON.parse(localStorage.getItem("authTokens")),t=ma(e.access);return console.log("user "+t),t}return console.log("no user"),null}()})),2),f=g[0],m=g[1];console.log(f);var C=h(),y=function(){var e=da(ca().mark((function e(t){var r,n;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,fetch("/api/token/",{method:"POST",headers:{"Content-type":"application/JSON"},body:JSON.stringify({email:t.target.formBasicEmail.value,password:t.target.formBasicPassword.value})});case 3:return r=e.sent,e.next=6,r.json();case 6:n=e.sent,200===r.status?(p(n),m(ma(n.access)),localStorage.setItem("authTokens",JSON.stringify(n)),localStorage.setItem("access_created_time",Date.now()),C.push("/"),window.location.reload()):d(!0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=da(ca().mark((function e(){var t,r,n;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("updateToken called."),6e5,!(t=localStorage.getItem("access_created_time"))){e.next=8;break}if(!(Date.now()-t<6e5)){e.next=8;break}return console.log("no need to update token"),o(!1),e.abrupt("return");case 8:return e.next=10,fetch("/api/token/refresh/",{method:"POST",headers:{"Content-type":"application/JSON"},body:JSON.stringify({refresh:null===c||void 0===c?void 0:c.refresh})});case 10:if(500!==(r=e.sent).status){e.next=15;break}return console.log("Error connecting to server (server may not be running)."),i&&o(!1),e.abrupt("return");case 15:return e.next=17,r.json();case 17:n=e.sent,r.ok?(p(n),m(ma(n.access)),localStorage.setItem("authTokens",JSON.stringify(n)),localStorage.setItem("access_created_time",Date.now()),i&&o(!1)):400!==r.status&&E(),i&&o(!1);case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(){console.log("logged out user."),p(null),m(null),localStorage.removeItem("authTokens"),localStorage.removeItem("access_created_time")},T={authTokens:c,user:f,loginUser:y,logoutUser:E,error:l,setError:d};return(0,t.useEffect)((function(){i&&localStorage.getItem("authTokens")&&_();var e=24e4*(Math.random()+1),t=setInterval((function(){localStorage.getItem("authTokens")&&_()}),e);return function(){return clearInterval(t)}}),[c,i]),(0,ge.jsx)(Ca.Provider,{value:T,children:r})},Ea=__webpack_require__.p+"static/media/cgem_logo.c87ba545b71379740aba.png",Ta=function(){var e=(0,t.useContext)(ya),r=e.user,n=e.logoutUser;return(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsx)(zr,{className:"nav header",variant:"light",expand:"lg",fixed:"top",children:(0,ge.jsxs)(Xr,{children:[(0,ge.jsxs)(zr.Brand,{href:"/",children:[(0,ge.jsx)("img",{alt:"",height:"50",width:"auto",src:Ea,className:"d-inline-block align-top headerImage"})," "]}),(0,ge.jsx)(zr.Toggle,{"aria-controls":"basic-navbar-nav"}),(0,ge.jsx)(zr.Collapse,{className:"justify-content-end",children:(0,ge.jsxs)(In,{className:"justify-content-end",children:[(0,ge.jsx)(In.Link,{href:"/about",children:"About"}),(0,ge.jsxs)(sa,{title:"Actions",id:"basic-nav-dropdown",children:[(0,ge.jsx)(sa.Item,{href:"/all-reactions",children:"Browse All Reactions"}),(0,ge.jsx)(sa.Item,{href:"/draw-structures",children:"Substructure Search"}),(0,ge.jsx)(sa.Item,{href:"/advanced",children:"Advanced Search"}),(0,ge.jsx)(sa.Item,{href:"/reaction-drafts",children:"Reaction drafts"}),(0,ge.jsx)(sa.Divider,{}),(0,ge.jsx)(sa.Item,{href:"/contribute",children:"Contribute"})]}),null===r?(0,ge.jsx)(In.Link,{href:"/sign-in",children:"Sign in"}):(0,ge.jsxs)(sa,{title:"Account",id:"basic-nav-dropdown",children:[(0,ge.jsx)(sa.Item,{href:"/my-account",children:"Your account"}),(0,ge.jsx)(sa.Item,{href:"/my-reactions",children:"Your reactions"}),(0,ge.jsx)(sa.Divider,{}),(0,ge.jsx)(sa.Item,{onClick:function(){return n()},children:" Sign out"})]})]})})]})}),(0,ge.jsx)("br",{}),(0,ge.jsx)("br",{})]})},Oa=["bsPrefix","className","as"],va=t.forwardRef((function(e,t){var r=e.bsPrefix,n=e.className,i=e.as,o=void 0===i?"div":i,a=te(e,Oa),s=Ce(r,"row"),l=ye(),d="".concat(s,"-cols"),u=[];return l.forEach((function(e){var t,r=a[e];delete a[e],t=null!=r&&"object"===typeof r?r.cols:r;var n="xs"!==e?"-".concat(e):"";null!=t&&u.push("".concat(d).concat(n,"-").concat(t))})),(0,ge.jsx)(o,Q(Q({ref:t},a),{},{className:ne().apply(void 0,[n,s].concat(u))}))}));va.displayName="Row";var Sa=va,ba=["as","bsPrefix","className"],Aa=["className"];var Ia=t.forwardRef((function(e,t){var r=function(e){var t=e.as,r=e.bsPrefix,n=e.className,i=te(e,ba);r=Ce(r,"col");var o=ye(),a=[],s=[];return o.forEach((function(e){var t,n,o,l=i[e];delete i[e],"object"===typeof l&&null!=l?(t=l.span,n=l.offset,o=l.order):t=l;var d="xs"!==e?"-".concat(e):"";t&&a.push(!0===t?"".concat(r).concat(d):"".concat(r).concat(d,"-").concat(t)),null!=o&&s.push("order".concat(d,"-").concat(o)),null!=n&&s.push("offset".concat(d,"-").concat(n))})),[Q(Q({},i),{},{className:ne().apply(void 0,[n].concat(a,s))}),{as:t,bsPrefix:r,spans:a}]}(e),n=s(r,2),i=n[0],o=i.className,a=te(i,Aa),l=n[1],d=l.as,u=void 0===d?"div":d,c=l.bsPrefix,h=l.spans;return(0,ge.jsx)(u,Q(Q({},a),{},{ref:t,className:ne()(o,!h.length&&c)}))}));Ia.displayName="Col";var Ra=Ia,Da=["as","className","type","tooltip"],Na={type:ar().string,tooltip:ar().bool,as:ar().elementType},Pa=t.forwardRef((function(e,t){var r=e.as,n=void 0===r?"div":r,i=e.className,o=e.type,a=void 0===o?"valid":o,s=e.tooltip,l=void 0!==s&&s,d=te(e,Da);return(0,ge.jsx)(n,Q(Q({},d),{},{ref:t,className:ne()(i,"".concat(a,"-").concat(l?"tooltip":"feedback"))}))}));Pa.displayName="Feedback",Pa.propTypes=Na;var xa=Pa,Ma=t.createContext({}),La=["id","bsPrefix","className","type","isValid","isInvalid","as"],wa=t.forwardRef((function(e,r){var n=e.id,i=e.bsPrefix,o=e.className,a=e.type,s=void 0===a?"checkbox":a,l=e.isValid,d=void 0!==l&&l,u=e.isInvalid,c=void 0!==u&&u,h=e.as,p=void 0===h?"input":h,g=te(e,La),f=(0,t.useContext)(Ma).controlId;return i=Ce(i,"form-check-input"),(0,ge.jsx)(p,Q(Q({},g),{},{ref:r,type:s,id:n||f,className:ne()(o,i,d&&"is-valid",c&&"is-invalid")}))}));wa.displayName="FormCheckInput";var ka=wa,Ba=["bsPrefix","className","htmlFor"],ja=t.forwardRef((function(e,r){var n=e.bsPrefix,i=e.className,o=e.htmlFor,a=te(e,Ba),s=(0,t.useContext)(Ma).controlId;return n=Ce(n,"form-check-label"),(0,ge.jsx)("label",Q(Q({},a),{},{ref:r,htmlFor:o||s,className:ne()(i,n)}))}));ja.displayName="FormCheckLabel";var Ua=ja;function Fa(e,r){var n=0;return t.Children.map(e,(function(e){return t.isValidElement(e)?r(e,n++):e}))}var Wa=["id","bsPrefix","bsSwitchPrefix","inline","disabled","isValid","isInvalid","feedbackTooltip","feedback","feedbackType","className","style","title","type","label","children","as"],Va=t.forwardRef((function(e,r){var n=e.id,i=e.bsPrefix,o=e.bsSwitchPrefix,a=e.inline,s=void 0!==a&&a,l=e.disabled,d=void 0!==l&&l,u=e.isValid,c=void 0!==u&&u,h=e.isInvalid,p=void 0!==h&&h,g=e.feedbackTooltip,f=void 0!==g&&g,m=e.feedback,C=e.feedbackType,y=e.className,_=e.style,E=e.title,T=void 0===E?"":E,O=e.type,v=void 0===O?"checkbox":O,S=e.label,b=e.children,A=e.as,I=void 0===A?"input":A,R=te(e,Wa);i=Ce(i,"form-check"),o=Ce(o,"form-switch");var D=(0,t.useContext)(Ma).controlId,N=(0,t.useMemo)((function(){return{controlId:n||D}}),[D,n]),P=!b&&null!=S&&!1!==S||function(e,r){return t.Children.toArray(e).some((function(e){return t.isValidElement(e)&&e.type===r}))}(b,Ua),x=(0,ge.jsx)(ka,Q(Q({},R),{},{type:"switch"===v?"checkbox":v,ref:r,isValid:c,isInvalid:p,disabled:d,as:I}));return(0,ge.jsx)(Ma.Provider,{value:N,children:(0,ge.jsx)("div",{style:_,className:ne()(y,P&&i,s&&"".concat(i,"-inline"),"switch"===v&&o),children:b||(0,ge.jsxs)(ge.Fragment,{children:[x,P&&(0,ge.jsx)(Ua,{title:T,children:S}),m&&(0,ge.jsx)(xa,{type:C,tooltip:f,children:m})]})})})}));Va.displayName="FormCheck";var Ha=Object.assign(Va,{Input:ka,Label:Ua}),Ga=["bsPrefix","type","size","htmlSize","id","className","isValid","isInvalid","plaintext","readOnly","as"],za=t.forwardRef((function(e,r){var n,i,o=e.bsPrefix,a=e.type,s=e.size,l=e.htmlSize,d=e.id,u=e.className,c=e.isValid,h=void 0!==c&&c,p=e.isInvalid,g=void 0!==p&&p,f=e.plaintext,m=e.readOnly,C=e.as,y=void 0===C?"input":C,_=te(e,Ga),E=(0,t.useContext)(Ma).controlId;(o=Ce(o,"form-control"),f)?n=J({},"".concat(o,"-plaintext"),!0):(J(i={},o,!0),J(i,"".concat(o,"-").concat(s),s),n=i);return(0,ge.jsx)(y,Q(Q({},_),{},{type:a,size:l,ref:r,readOnly:m,id:d||E,className:ne()(u,n,h&&"is-valid",g&&"is-invalid","color"===a&&"".concat(o,"-color"))}))}));za.displayName="FormControl";var Ka=Object.assign(za,{Feedback:xa}),Ya=Oe("form-floating"),Xa=["controlId","as"],$a=t.forwardRef((function(e,r){var n=e.controlId,i=e.as,o=void 0===i?"div":i,a=te(e,Xa),s=(0,t.useMemo)((function(){return{controlId:n}}),[n]);return(0,ge.jsx)(Ma.Provider,{value:s,children:(0,ge.jsx)(o,Q(Q({},a),{},{ref:r}))})}));$a.displayName="FormGroup";var qa=$a,Ja=["as","bsPrefix","column","visuallyHidden","className","htmlFor"],Za=t.forwardRef((function(e,r){var n=e.as,i=void 0===n?"label":n,o=e.bsPrefix,a=e.column,s=e.visuallyHidden,l=e.className,d=e.htmlFor,u=te(e,Ja),c=(0,t.useContext)(Ma).controlId;o=Ce(o,"form-label");var h="col-form-label";"string"===typeof a&&(h="".concat(h," ").concat(h,"-").concat(a));var p=ne()(l,o,s&&"visually-hidden",a&&h);return d=d||c,a?(0,ge.jsx)(Ra,Q({ref:r,as:"label",className:p,htmlFor:d},u)):(0,ge.jsx)(i,Q({ref:r,className:p,htmlFor:d},u))}));Za.displayName="FormLabel",Za.defaultProps={column:!1,visuallyHidden:!1};var Qa=Za,es=["bsPrefix","className","id"],ts=t.forwardRef((function(e,r){var n=e.bsPrefix,i=e.className,o=e.id,a=te(e,es),s=(0,t.useContext)(Ma).controlId;return n=Ce(n,"form-range"),(0,ge.jsx)("input",Q(Q({},a),{},{type:"range",ref:r,className:ne()(i,n),id:o||s}))}));ts.displayName="FormRange";var rs=ts,ns=["bsPrefix","size","htmlSize","className","isValid","isInvalid","id"],is=t.forwardRef((function(e,r){var n=e.bsPrefix,i=e.size,o=e.htmlSize,a=e.className,s=e.isValid,l=void 0!==s&&s,d=e.isInvalid,u=void 0!==d&&d,c=e.id,h=te(e,ns),p=(0,t.useContext)(Ma).controlId;return n=Ce(n,"form-select"),(0,ge.jsx)("select",Q(Q({},h),{},{size:o,ref:r,className:ne()(a,n,i&&"".concat(n,"-").concat(i),l&&"is-valid",u&&"is-invalid"),id:c||p}))}));is.displayName="FormSelect";var os=is,as=["bsPrefix","className","as","muted"],ss=t.forwardRef((function(e,t){var r=e.bsPrefix,n=e.className,i=e.as,o=void 0===i?"small":i,a=e.muted,s=te(e,as);return r=Ce(r,"form-text"),(0,ge.jsx)(o,Q(Q({},s),{},{ref:t,className:ne()(n,r,a&&"text-muted")}))}));ss.displayName="FormText";var ls=ss,ds=t.forwardRef((function(e,t){return(0,ge.jsx)(Ha,Q(Q({},e),{},{ref:t,type:"switch"}))}));ds.displayName="Switch";var us=Object.assign(ds,{Input:Ha.Input,Label:Ha.Label}),cs=["bsPrefix","className","children","controlId","label"],hs=t.forwardRef((function(e,t){var r=e.bsPrefix,n=e.className,i=e.children,o=e.controlId,a=e.label,s=te(e,cs);return r=Ce(r,"form-floating"),(0,ge.jsxs)(qa,Q(Q({ref:t,className:ne()(n,r),controlId:o},s),{},{children:[i,(0,ge.jsx)("label",{htmlFor:o,children:a})]}))}));hs.displayName="FloatingLabel";var ps=hs,gs=["className","validated","as"],fs={_ref:ar().any,validated:ar().bool,as:ar().elementType},ms=t.forwardRef((function(e,t){var r=e.className,n=e.validated,i=e.as,o=void 0===i?"form":i,a=te(e,gs);return(0,ge.jsx)(o,Q(Q({},a),{},{ref:t,className:ne()(r,n&&"was-validated")}))}));ms.displayName="Form",ms.propTypes=fs;var Cs=Object.assign(ms,{Group:qa,Control:Ka,Floating:Ya,Check:Ha,Switch:us,Label:Qa,Text:ls,Range:rs,Select:os,FloatingLabel:ps}),ys=["bsPrefix","variant","animation","size","as","className"],_s=t.forwardRef((function(e,t){var r=e.bsPrefix,n=e.variant,i=e.animation,o=e.size,a=e.as,s=void 0===a?"div":a,l=e.className,d=te(e,ys);r=Ce(r,"spinner");var u="".concat(r,"-").concat(i);return(0,ge.jsx)(s,Q(Q({ref:t},d),{},{className:ne()(l,u,o&&"".concat(u,"-").concat(o),n&&"text-".concat(n))}))}));_s.displayName="Spinner";var Es=_s,Ts=function(e){var t=e.reaction,r=(e.verbose,e.nolink),n=e.drafts;return(0,ge.jsxs)("tr",{className:"text-center",children:[(0,ge.jsx)("td",{children:r?(0,ge.jsx)("div",{style:{textDecoration:"none",color:"maroon"},children:t.monomer}):(0,ge.jsx)(q,{to:"/".concat(!0===n?"reaction-drafts/":"reaction/").concat(t.id),className:"Link",style:{textDecoration:"none",color:"maroon"},target:"_blank",children:t.monomer})}),(0,ge.jsxs)("td",{children:[" ",t.flexizyme," "]}),(0,ge.jsxs)("td",{children:[" ",t.synthetase," "]}),(0,ge.jsxs)("td",{children:[" ",t.n_term_percent||t.n_term_incorporation||"not recorded"," "]}),(0,ge.jsxs)("td",{children:[" ",t.internal_percent||t.internal_incorporation||"not recorded"," "]}),(0,ge.jsxs)("td",{children:[" ",null!==t.acylation_yield?t.acylation_yield:null!=t.flexizyme?"not measured":""," "]})]})},Os=["bsPrefix","className","striped","bordered","borderless","hover","size","variant","responsive"],vs=t.forwardRef((function(e,t){var r=e.bsPrefix,n=e.className,i=e.striped,o=e.bordered,a=e.borderless,s=e.hover,l=e.size,d=e.variant,u=e.responsive,c=te(e,Os),h=Ce(r,"table"),p=ne()(n,h,d&&"".concat(h,"-").concat(d),l&&"".concat(h,"-").concat(l),i&&"".concat(h,"-striped"),o&&"".concat(h,"-bordered"),a&&"".concat(h,"-borderless"),s&&"".concat(h,"-hover")),g=(0,ge.jsx)("table",Q(Q({},c),{},{className:p,ref:t}));if(u){var f="".concat(h,"-responsive");return"string"===typeof u&&(f="".concat(f,"-").concat(u)),(0,ge.jsx)("div",{className:f,children:g})}return g})),Ss=vs,bs=function(e){var t,r,n,i,o=e.reaction,a=e.drafts;return(0,ge.jsxs)("tr",{className:"text-center",children:[(0,ge.jsx)("td",{children:(0,ge.jsx)(q,{to:"/".concat(!0===a?"reaction-drafts/":"reaction/").concat(o.id),className:"Link",style:{textDecoration:"none",color:"maroon"},target:"_blank",children:o.monomer.monomer_name||o.monomer.monomer_smiles})}),(0,ge.jsxs)("td",{children:[" ",null===(t=o.flexizyme)||void 0===t?void 0:t.flex_name," "]}),(0,ge.jsxs)("td",{children:[" ",null===(r=o.synthetase)||void 0===r?void 0:r.synth_common_name," "]}),(0,ge.jsxs)("td",{children:[" ",o.n_term_percent||o.n_term_incorporation||"not recorded"," "]}),(0,ge.jsxs)("td",{children:[" ",o.internal_percent||o.internal_incorporation||"not recorded"," "]}),(0,ge.jsxs)("td",{children:[" ",void 0!==(null===(n=o.assay)||void 0===n?void 0:n.acylation_yield)&&null!==(null===(i=o.assay)||void 0===i?void 0:i.acylation_yield)?o.assay.acylation_yield:null!=o.flexizyme?"not measured":""," "]})]})},As=function(e){var t=e.reactions,r=e.verbose,n=e.nolink,i=e.drafts;return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsx)("div",{className:"text-center",children:(0,ge.jsx)("div",{className:"reaction-list",children:(0,ge.jsxs)(Ss,{striped:!0,bordered:!0,hover:!0,size:"lg",responsive:"md",children:[(0,ge.jsx)("thead",{children:(0,ge.jsxs)("tr",{children:[(0,ge.jsx)("th",{children:"Name or SMILES"}),(0,ge.jsx)("th",{children:"Flexizyme"}),(0,ge.jsx)("th",{children:"Synthetase"}),(0,ge.jsx)("th",{children:"N-terminal incorporation"}),(0,ge.jsx)("th",{children:"Internal incorporation"}),(0,ge.jsx)("th",{children:"Acylation yield (flexizymes)"})]})}),(0,ge.jsx)("tbody",{children:t?!0===r?t.map((function(e,t){return(0,ge.jsx)(bs,{reaction:e,drafts:i},e.id||t)})):t.map((function(e,t){return(0,ge.jsx)(Ts,{reaction:e,nolink:n,drafts:i},e.id||t)})):(0,ge.jsx)(ge.Fragment,{})})]})})})})},Is=["bsPrefix","className","variant","as"],Rs=t.forwardRef((function(e,t){var r=e.bsPrefix,n=e.className,i=e.variant,o=e.as,a=void 0===o?"img":o,s=te(e,Is),l=Ce(r,"card-img");return(0,ge.jsx)(a,Q({ref:t,className:ne()(i?"".concat(l,"-").concat(i):l,n)},s))}));Rs.displayName="CardImg";var Ds=Rs,Ns=["bsPrefix","className","as"],Ps=t.forwardRef((function(e,r){var n=e.bsPrefix,i=e.className,o=e.as,a=void 0===o?"div":o,s=te(e,Ns),l=Ce(n,"card-header"),d=(0,t.useMemo)((function(){return{cardHeaderBsPrefix:l}}),[l]);return(0,ge.jsx)(gn.Provider,{value:d,children:(0,ge.jsx)(a,Q(Q({ref:r},s),{},{className:ne()(i,l)}))})}));Ps.displayName="CardHeader";var xs=Ps,Ms=["bsPrefix","className","bg","text","border","body","children","as"],Ls=Cr("h5"),ws=Cr("h6"),ks=Oe("card-body"),Bs=Oe("card-title",{Component:Ls}),js=Oe("card-subtitle",{Component:ws}),Us=Oe("card-link",{Component:"a"}),Fs=Oe("card-text",{Component:"p"}),Ws=Oe("card-footer"),Vs=Oe("card-img-overlay"),Hs=t.forwardRef((function(e,t){var r=e.bsPrefix,n=e.className,i=e.bg,o=e.text,a=e.border,s=e.body,l=e.children,d=e.as,u=void 0===d?"div":d,c=te(e,Ms),h=Ce(r,"card");return(0,ge.jsx)(u,Q(Q({ref:t},c),{},{className:ne()(n,h,i&&"bg-".concat(i),o&&"text-".concat(o),a&&"border-".concat(a)),children:s?(0,ge.jsx)(ks,{children:l}):l}))}));Hs.displayName="Card",Hs.defaultProps={body:!1};var Gs=Object.assign(Hs,{Img:Ds,Title:Bs,Subtitle:js,Body:ks,Link:Us,Text:Fs,Header:xs,Footer:Ws,ImgOverlay:Vs}),zs=function(e){var r=e.draw,n=e.width,i=e.height,o=(0,t.useRef)();return(0,t.useEffect)((function(){var e=o.current;r(e)}),[r]),(0,ge.jsx)("canvas",{ref:o,width:n,height:i})},Ks=function(e){var t=e.id,r=e.smiles,n=e.width,o=e.height,a=e.name,s=e.flexizyme,l=e.synthetase,d=e.acylation_yield,u=e.nolink,c=e.drafts,h=1.666*o,p=1.2*n,g=(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsxs)(Gs.Header,{children:[(0,ge.jsx)("strong",{children:a}),(0,ge.jsx)("br",{}),s?s+". acylation yield: "+(null!==d?d:"not measured"):l||"chemical acylation",(0,ge.jsx)("br",{})]}),(0,ge.jsx)(Gs.Body,{children:(0,ge.jsx)(zs,{draw:function(e){console.log=function(){};var t=new(i().Drawer)({width:n,height:o});null!==e&&r&&i().parse(r,(function(r){t.draw(r,e,"light",!1)}),(function(e){console.log(e)}))},width:n,height:o})})]});return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsx)(Gs,{className:"m-1 hoverCard mb-3",style:{width:p,height:h},children:!0===u?g:(0,ge.jsx)(q,{to:"/".concat(!0===c?"reaction-drafts/":"reaction/").concat(t),className:"Link",style:{textDecoration:"none",color:"black"},target:"_blank",children:g})})})},Ys=function(e){var t=e.reactions,r=e.nolink,n=e.verbose,i=e.drafts;return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsx)(Sa,{className:"g-0 structure-list",lg:3,md:2,sm:1,children:t.map((function(e,t){var o,a,s,l;return(0,ge.jsx)(Ra,{children:!0===n?(0,ge.jsx)(Ks,{id:null===e||void 0===e?void 0:e.id,name:e.monomer.monomer_name||e.monomer.monomer_smiles,flexizyme:null===(o=e.flexizyme)||void 0===o?void 0:o.flex_name,synthetase:null===(a=e.synthetase)||void 0===a?void 0:a.synth_common_name,acylation_yield:null===(s=e.assay)||void 0===s?void 0:s.acylation_yield,smiles:null===(l=e.monomer)||void 0===l?void 0:l.monomer_smiles,width:340,height:200,nolink:r,drafts:i}):(0,ge.jsx)(Ks,{id:null===e||void 0===e?void 0:e.id,name:e.monomer,flexizyme:e.flexizyme,synthetase:e.synthetase,acylation_yield:e.acylation_yield,smiles:e.monomer_smiles,width:340,height:200,nolink:r,drafts:i})},e.id||t)}))})})})},Xs=function(e){var r=e.cardView,n=e.reactions,i=e.verbose,o=e.nolink,a=e.drafts;return(0,t.useEffect)((function(){}),[r]),(0,ge.jsx)(ge.Fragment,{children:!1===r?(0,ge.jsx)(As,{reactions:n,verbose:i,nolink:o,drafts:a}):(0,ge.jsx)(Ys,{reactions:n,verbose:i,nolink:o,drafts:a})})},$s=__webpack_require__(6048),qs=__webpack_require__.n($s),Js=function(){var e=s((0,t.useState)([]),2),r=e[0],n=e[1],i=s((0,t.useState)([]),2),o=i[0],a=i[1],l=s((0,t.useState)(""),2),d=l[0],u=l[1],c=s((0,t.useState)(!1),2),h=c[0],p=c[1],g=s((0,t.useState)(1),2),f=g[0],m=g[1],C=s((0,t.useState)(12),2),y=C[0],_=C[1],E=s((0,t.useState)(!0),2),T=E[0],O=E[1],v=function(){var e=da(ca().mark((function e(){var t,r,i;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O(!0),e.next=3,fetch("/api/?limit=".concat(y,"&ordering=").concat(d));case 3:return t=e.sent,O(!1),e.next=7,t.json();case 7:r=e.sent,n(r.results),i=r.count,m(Math.ceil(i/y)),a(r);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,t.useEffect)((function(){v()}),[d,y]),(0,t.useEffect)((function(){}),[h]);var S=function(){var e=da(ca().mark((function e(t){var r,i;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.selected+1,e.next=3,b(r);case 3:i=e.sent,n(i),window.scrollTo(0,document.body.scrollHeight);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=da(ca().mark((function e(t){var r,n,i;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(t-1)*y,e.next=3,fetch("/api/?limit=".concat(y,"&offset=").concat(r,"&ordering=").concat(d));case 3:return n=e.sent,e.next=6,n.json();case 6:return i=e.sent,a(i),e.abrupt("return",i.results);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsxs)(Xr,{className:"mb-4 mt-4",children:[(0,ge.jsx)(Sa,{as:"h4",className:"mt-3 mb-3",children:" Reactions Table "}),(0,ge.jsx)(Sa,{className:"mt-3",children:" This is a table containing all reactions in the database. "}),(0,ge.jsxs)(Sa,{className:"mt-3 align-items-center",children:[" Order results by:",(0,ge.jsx)("div",{style:{width:300},children:(0,ge.jsxs)("select",{onChange:function(e){return u(e.target.value)},className:"form-select",children:[(0,ge.jsx)("option",{value:"id",children:"Database ID (default)"}),(0,ge.jsx)("option",{value:"-internal_percent&internal_incorporation=Y",children:"Internal incorporation %"}),(0,ge.jsx)("option",{value:"-n_term_percent&n_term_incorporation=Y",children:"N-terminal incorporation %"}),(0,ge.jsx)("option",{value:"-assay__acylation_yield&synthetase__isnull=true",children:"Microhelix assay acylation yield"})]})}),(0,ge.jsx)(Ra,{children:(0,ge.jsx)("div",{children:(0,ge.jsx)(Cs.Check,{type:"switch",id:"custom-switch",label:"View structures",onClick:function(){p(!h)}})})})]}),(0,ge.jsxs)(Sa,{className:"mt-3 align-items-center",children:[(0,ge.jsxs)("div",{style:{width:300,padding:0,display:"flex",justifyContent:"start",alignItems:"center"},children:["Number of results: ",null===o||void 0===o?void 0:o.count]}),(0,ge.jsxs)(Ra,{style:{width:300,display:"flex",justifyContent:"start",alignItems:"center"},children:["Show",(0,ge.jsxs)(Cs.Select,{size:"sm",style:{width:100,marginLeft:"0.5em",marginRight:"0.5em"},onChange:function(e){return _(e.target.value)},children:[(0,ge.jsx)("option",{value:12,children:"12"}),(0,ge.jsx)("option",{value:25,children:"25"}),(0,ge.jsx)("option",{value:50,children:"50"}),(0,ge.jsx)("option",{value:f*y,children:"All"})]}),"entries per page"]})]}),!0===T?(0,ge.jsxs)(Sa,{className:"align-items-center justify-content-center mt-5",children:[" ",(0,ge.jsx)(Es,{animation:"border",className:"mx-3"}),"Waiting for data to load... "]}):(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsx)(Sa,{className:"mt-4",children:(0,ge.jsx)(Xs,{reactions:r,cardView:h,verbose:!1})})}),(0,ge.jsx)(qs(),{previousLabel:"previous",nextLabel:"next",breakLabel:"...",pageCount:f,marginPagesDisplayed:1,pageRangeDisplayed:3,onPageChange:S,containerClassName:"pagination justify-content-end mt-3",pageClassName:"page-item",pageLinkClassName:"page-link",previousClassName:"page-item",previousLinkClassName:"page-link",nextClassName:"page-item",nextLinkClassName:"page-link",breakClassName:"page-item",breakLinkClassName:"page-link",activeClassName:"active"})]})})},Zs=function(e){var r=e.smiles,n=e.width,o=e.height,a=s((0,t.useState)(null),2),l=a[0],d=a[1],u=function(e){console.log=function(){};var t=new(i().Drawer)({width:n,height:o});null!==e&&r&&i().parse(r,(function(r){t.draw(r,e,"light",!1),d(null)}),(function(e){d(1)}))};return(0,ge.jsx)(ge.Fragment,{children:null===l?(0,ge.jsx)(zs,{draw:u,width:n,height:o}):(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsx)(zs,{draw:u,width:0,height:0}),(0,ge.jsx)("div",{className:"text-center mb-3",children:" Please enter a valid SMILES. "})]})})},Qs=function(e){var t,r=e.synthetase,n=e.flexizyme,i=e.readout;return null!=r?(0,ge.jsxs)(Gs,{id:"flexsynth",style:{width:400},className:"px-0",children:[(0,ge.jsxs)(Gs.Header,{children:[" ",(0,ge.jsx)("strong",{children:"Synthetase"})]}),(0,ge.jsxs)(Gs.Body,{children:[(0,ge.jsxs)(Gs.Subtitle,{className:"mb-2",children:["Common name: ",r.synth_common_name," "]}),(0,ge.jsxs)(Gs.Subtitle,{className:"mb-2",children:["Parent synthetase: ",(null===(t=r.parent_synthetase)||void 0===t?void 0:t.parent_name)||"no parent recorded"," "]}),(0,ge.jsxs)(Gs.Text,{children:[(0,ge.jsx)("br",{}),(0,ge.jsx)("span",{style:{fontWeight:"600"},children:"Organism(s): "}),r.organisms.map((function(e){return e.organism_name+"; "})),(0,ge.jsx)("br",{}),(0,ge.jsx)("br",{}),(0,ge.jsx)("span",{style:{fontWeight:"600"},children:"Readout: "}),i,(0,ge.jsx)("br",{}),(0,ge.jsx)("br",{}),(0,ge.jsx)("span",{style:{fontWeight:"600"},children:"Mutations: "}),r.mutations.map((function(e){return e.mutation_name+"; "}))]})]})]}):null!=n?(0,ge.jsxs)(Gs,{id:"flexsynth",style:{width:400},className:"px-0",children:[(0,ge.jsxs)(Gs.Header,{children:[" ",(0,ge.jsx)("strong",{children:"Flexizyme"})]}),(0,ge.jsxs)(Gs.Body,{children:[(0,ge.jsxs)(Gs.Subtitle,{className:"mb-2",children:["name: ",n.flex_name," "]}),(0,ge.jsxs)(Gs.Text,{children:[(0,ge.jsx)("br",{}),(0,ge.jsx)("span",{style:{fontWeight:"600"},children:"Sequence: "}),n.flex_sequence||"No sequence recorded",(0,ge.jsx)("br",{})]})]})]}):(0,ge.jsx)(Gs,{id:"flexsynth",style:{width:400},className:"mx-3",children:(0,ge.jsx)(Gs.Body,{children:(0,ge.jsx)(Gs.Text,{children:"Chemical acylation used (no flexizyme or synthetase)."})})})},el=function(e){var t=e.reaction;return(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsxs)(Ss,{size:"sm",responsive:"md",striped:!0,bordered:!0,children:[(0,ge.jsx)("thead",{children:(0,ge.jsxs)("tr",{children:[(0,ge.jsx)("th",{children:"Ribosome name"}),(0,ge.jsx)("th",{children:"N-term incorporation"}),(0,ge.jsx)("th",{children:"Internal incorporation"})]})}),(0,ge.jsx)("tbody",{children:(0,ge.jsxs)("tr",{children:[(0,ge.jsx)("td",{children:t.ribosome_name}),(0,ge.jsxs)("td",{children:[" ",t.n_term_percent||t.n_term_incorporation||"not recorded"," "]}),(0,ge.jsxs)("td",{children:[" ",t.internal_percent||t.internal_incorporation||"not recorded"," "]})]})})]}),(0,ge.jsxs)("div",{children:[(0,ge.jsxs)("p",{children:[(0,ge.jsx)("span",{style:{fontWeight:"bold"},children:"Ribosomal incorporation notes: "}),t.rib_incorporation_notes||"None recorded."]}),(0,ge.jsxs)("p",{children:[(0,ge.jsx)("span",{style:{fontWeight:"bold"},children:"Readout: "}),t.rib_readout||"None recorded."]})]})]})},tl=function(e){var t,r,n,i=e.reaction;return null==i.assay?(0,ge.jsx)(ge.Fragment,{}):(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsx)("div",{children:(0,ge.jsxs)("p",{children:[(0,ge.jsx)("span",{style:{fontWeight:"bold"},children:"Microhelix Assay yield: "}),null===(t=i.assay)||void 0===t?void 0:t.acylation_yield]})}),(0,ge.jsx)("div",{children:(0,ge.jsxs)("p",{children:[(0,ge.jsx)("span",{style:{fontWeight:"bold"},children:"Conditions: "})," ",null===(r=i.assay)||void 0===r?void 0:r.conditions]})}),(0,ge.jsx)("div",{children:(0,ge.jsxs)("p",{children:[(0,ge.jsx)("span",{style:{fontWeight:"bold"},children:"Assay notes: "}),null===(n=i.assay)||void 0===n?void 0:n.assay_notes]})})]})},rl=function(e){var t=e.trna;return null==t?(0,ge.jsx)(ge.Fragment,{}):(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsxs)(Gs,{id:"trna",style:{width:400},className:"mx-3 px-0",children:[(0,ge.jsx)(Gs.Header,{children:(0,ge.jsx)("strong",{children:t.tRNA_name})}),(0,ge.jsx)(Gs.Body,{children:(0,ge.jsx)(Gs.Text,{children:t.tRNA_seq||"No sequence recorded."})})]})})},nl=function(e){var t=e.reference,r=e.number,n=function(e){return e.startsWith("https://doi.org/")?e:e.startsWith("doi.org/")?"https://"+e:"https://doi.org/"+e}(t.DOI);return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsxs)(Xr,{children:[r,". ",(0,ge.jsx)("span",{className:"hoverable",onClick:function(){return window.open(n,"_blank")},style:{textDecoration:"none",color:"maroon"},children:n}),"."]})})},il=function(e){var t=e.references;return t?(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsxs)("h6",{className:"mt-3 mb-3",children:[" ",(0,ge.jsx)("strong",{children:" References: "})," "]}),(0,ge.jsx)("p",{}),t.map((function(e,t){return(0,ge.jsx)(nl,{number:t+1,reference:e},e.id)})),(0,ge.jsx)("p",{})]}):(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsx)("h6",{children:" No references recorded for this reaction. "})})},ol=["bsPrefix","size","hasValidation","className","as"],al=Oe("input-group-text",{Component:"span"}),sl=t.forwardRef((function(e,r){var n=e.bsPrefix,i=e.size,o=e.hasValidation,a=e.className,s=e.as,l=void 0===s?"div":s,d=te(e,ol);n=Ce(n,"input-group");var u=(0,t.useMemo)((function(){return{}}),[]);return(0,ge.jsx)(Wo.Provider,{value:u,children:(0,ge.jsx)(l,Q(Q({ref:r},d),{},{className:ne()(a,n,i&&"".concat(n,"-").concat(i),o&&"has-validation")}))})}));sl.displayName="InputGroup";var ll,dl=Object.assign(sl,{Text:al,Radio:function(e){return(0,ge.jsx)(al,{children:(0,ge.jsx)(ka,Q({type:"radio"},e))})},Checkbox:function(e){return(0,ge.jsx)(al,{children:(0,ge.jsx)(ka,Q({type:"checkbox"},e))})}});function ul(e){if((!ll&&0!==ll||e)&&Ge){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),ll=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return ll}var cl=Oe("modal-body"),hl=["bsPrefix","className","contentClassName","centered","size","fullscreen","children","scrollable"],pl=t.forwardRef((function(e,t){var r=e.bsPrefix,n=e.className,i=e.contentClassName,o=e.centered,a=e.size,s=e.fullscreen,l=e.children,d=e.scrollable,u=te(e,hl);r=Ce(r,"modal");var c="".concat(r,"-dialog"),h="string"===typeof s?"".concat(r,"-fullscreen-").concat(s):"".concat(r,"-fullscreen");return(0,ge.jsx)("div",Q(Q({},u),{},{ref:t,className:ne()(c,n,a&&"".concat(r,"-").concat(a),o&&"".concat(c,"-centered"),d&&"".concat(c,"-scrollable"),s&&h),children:(0,ge.jsx)("div",{className:ne()("".concat(r,"-content"),i),children:l})}))}));pl.displayName="ModalDialog";var gl=pl,fl=Oe("modal-footer"),ml=["bsPrefix","className"],Cl=t.forwardRef((function(e,t){var r=e.bsPrefix,n=e.className,i=te(e,ml);return r=Ce(r,"modal-header"),(0,ge.jsx)(pr,Q(Q({ref:t},i),{},{className:ne()(n,r)}))}));Cl.displayName="ModalHeader",Cl.defaultProps={closeLabel:"Close",closeButton:!1};var yl=Cl,_l=Oe("modal-title",{Component:Cr("h4")}),El=["bsPrefix","className","style","dialogClassName","contentClassName","children","dialogAs","aria-labelledby","show","animation","backdrop","keyboard","onEscapeKeyDown","onShow","onHide","container","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","onEntered","onExit","onExiting","onEnter","onEntering","onExited","backdropClassName","manager"],Tl={show:!1,backdrop:!0,keyboard:!0,autoFocus:!0,enforceFocus:!0,restoreFocus:!0,animation:!0,dialogAs:gl};function Ol(e){return(0,ge.jsx)(Zt,Q(Q({},e),{},{timeout:null}))}function vl(e){return(0,ge.jsx)(Zt,Q(Q({},e),{},{timeout:null}))}var Sl=t.forwardRef((function(e,r){var n=e.bsPrefix,i=e.className,o=e.style,a=e.dialogClassName,l=e.contentClassName,d=e.children,u=e.dialogAs,c=e["aria-labelledby"],h=e.show,p=e.animation,g=e.backdrop,f=e.keyboard,m=e.onEscapeKeyDown,C=e.onShow,y=e.onHide,_=e.container,E=e.autoFocus,T=e.enforceFocus,O=e.restoreFocus,v=e.restoreFocusOptions,S=e.onEntered,b=e.onExit,A=e.onExiting,I=e.onEnter,R=e.onEntering,D=e.onExited,N=e.backdropClassName,P=e.manager,x=te(e,El),M=s((0,t.useState)({}),2),L=M[0],w=M[1],k=s((0,t.useState)(!1),2),B=k[0],j=k[1],U=(0,t.useRef)(!1),F=(0,t.useRef)(!1),W=(0,t.useRef)(null),V=s(mn(),2),H=V[0],G=V[1],z=it(r,G),K=Ot(y),Y=_e();n=Ce(n,"modal");var X=(0,t.useMemo)((function(){return{onHide:K}}),[K]);function $(){return P||Mr({isRTL:Y})}function q(e){if(Ge){var t=$().getScrollbarWidth()>0,r=e.scrollHeight>Ae(e).documentElement.clientHeight;w({paddingRight:t&&!r?ul():void 0,paddingLeft:!t&&r?ul():void 0})}}var J=Ot((function(){H&&q(H.dialog)}));Dt((function(){$e(window,"resize",J),null==W.current||W.current()}));var Z=function(){U.current=!0},ee=function(e){U.current&&H&&e.target===H.dialog&&(F.current=!0),U.current=!1},re=function(){j(!0),W.current=Ze(H.dialog,(function(){j(!1)}))},ie=function(e){"static"!==g?F.current||e.target!==e.currentTarget?F.current=!1:null==y||y():function(e){e.target===e.currentTarget&&re()}(e)},oe=(0,t.useCallback)((function(e){return(0,ge.jsx)("div",Q(Q({},e),{},{className:ne()("".concat(n,"-backdrop"),N,!p&&"show")}))}),[p,N,n]),ae=Q(Q({},o),L);p||(ae.display="block");return(0,ge.jsx)(ir.Provider,{value:X,children:(0,ge.jsx)(Yt,{show:h,ref:z,backdrop:g,container:_,keyboard:!0,autoFocus:E,enforceFocus:T,restoreFocus:O,restoreFocusOptions:v,onEscapeKeyDown:function(e){f||"static"!==g?f&&m&&m(e):(e.preventDefault(),re())},onShow:C,onHide:y,onEnter:function(e,t){e&&(e.style.display="block",q(e)),null==I||I(e,t)},onEntering:function(e,t){null==R||R(e,t),Xe(window,"resize",J)},onEntered:S,onExit:function(e){null==W.current||W.current(),null==b||b(e)},onExiting:A,onExited:function(e){e&&(e.style.display=""),null==D||D(e),$e(window,"resize",J)},manager:$(),transition:p?Ol:void 0,backdropTransition:p?vl:void 0,renderBackdrop:oe,renderDialog:function(e){return(0,ge.jsx)("div",Q(Q({role:"dialog"},e),{},{style:ae,className:ne()(i,n,B&&"".concat(n,"-static")),onClick:g?ie:void 0,onMouseUp:ee,"aria-labelledby":c,children:(0,ge.jsx)(u,Q(Q({},x),{},{onMouseDown:Z,className:a,contentClassName:l,children:d}))}))}})})}));Sl.displayName="Modal",Sl.defaultProps=Tl;var bl=Object.assign(Sl,{Body:cl,Header:yl,Title:_l,Footer:fl,Dialog:gl,TRANSITION_DURATION:300,BACKDROP_TRANSITION_DURATION:150}),Al=function(e){var r=e.show,n=e.onHide,i=(e.reactionId,e.authTokens,e.initialReactionData),o=s((0,t.useState)(i),2),a=o[0],l=o[1];return(0,ge.jsxs)(bl,{show:r,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,onHide:n,children:[(0,ge.jsx)(bl.Header,{closeButton:!0,children:(0,ge.jsx)(bl.Title,{id:"contained-modal-title-vcenter",children:"Edit reaction information"})}),(0,ge.jsx)(bl.Body,{style:{overflowWrap:"break-word"},children:(0,ge.jsxs)(Cs,{children:[Object.keys(i).map((function(e){var t={};return t[e]=i[e],(0,ge.jsxs)(dl,{className:"m-1",children:[(0,ge.jsxs)(dl.Text,{id:"basic-addon1",children:[" ",e," "]}),(0,ge.jsx)(Cs.Control,{defaultValue:"object"===typeof t[e]?JSON.stringify(t[e]):t[e],"aria-label":"Username","aria-describedby":"basic-addon1",onChange:function(t){l(Q(Q({},a),{},J({},e,t.target.value)))}})]})})),JSON.stringify(a)]})}),(0,ge.jsxs)(bl.Footer,{children:[(0,ge.jsx)("button",{className:"btn btn-outline-danger",onClick:n,children:"Cancel"}),(0,ge.jsx)("button",{className:"btn btn-outline-primary",onClick:n,children:"Save and Submit"})]})]})},Il=function(e){var t=e.show,r=e.reactionId,n=e.onHide,i=e.authTokens,o=e.draft,a=h(),s=function(){var e=da(ca().mark((function e(){return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/".concat(!0===o?"drafts":"single","/").concat(r),{method:"delete",headers:{"Content-Type":"application/json",Authorization:"Bearer "+String(i.access)}}).catch((function(e){console.error(e)}));case 2:e.sent.ok&&(alert("success!"),a.push("/all-reactions"),window.location.reload());case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,ge.jsxs)(bl,{show:t,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,onHide:n,children:[(0,ge.jsx)(bl.Header,{closeButton:!0,children:(0,ge.jsx)(bl.Title,{id:"contained-modal-title-vcenter",children:"Delete this reaction"})}),(0,ge.jsxs)(bl.Body,{children:[(0,ge.jsx)("h5",{children:"Are you sure you want to delete this entry from the database?"}),(0,ge.jsx)("p",{children:"This reaction and its associated assays will be deleted."})]}),(0,ge.jsxs)(bl.Footer,{children:[(0,ge.jsx)("button",{className:"btn btn-outline-secondary",onClick:n,children:"Cancel"}),(0,ge.jsx)("button",{className:"btn btn-outline-danger",onClick:s,children:"Yes, delete"})]})]})},Rl=function(e){var t=e.show,r=e.onHide;return(0,ge.jsxs)(bl,{show:t,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,onHide:r,children:[(0,ge.jsx)(bl.Header,{closeButton:!0,children:(0,ge.jsx)(bl.Title,{id:"contained-modal-title-vcenter",children:"Sign in to modify this reaction."})}),(0,ge.jsx)(bl.Body,{style:{overflowWrap:"break-word"},children:"You must be signed in and authorized to edit or delete reactions."}),(0,ge.jsx)(bl.Footer,{children:(0,ge.jsx)("button",{className:"btn btn-outline-primary",onClick:r,children:"Close"})})]})},Dl=function(){var e=D({path:"/reaction/:id/",strict:!0,sensitive:!0}).params.id,r=s((0,t.useState)({}),2),n=r[0],i=r[1],o=s((0,t.useState)(150),2),a=o[0],l=o[1],d=s((0,t.useState)(!0),2),u=d[0],c=d[1],h=s((0,t.useState)(0),2),p=h[0],g=h[1],f=s((0,t.useState)(!1),2),m=f[0],C=f[1],y=s((0,t.useState)(!1),2),_=y[0],E=y[1],T=s((0,t.useState)(!1),2),O=T[0],v=T[1],S=(0,t.useContext)(ya),b=S.authTokens,A=S.user;(0,t.useEffect)((function(){x()}),[]),(0,t.useEffect)((function(){n&&Object.keys(n).length>1&&c(!1)}),[n]),(0,t.useEffect)((function(){if(document.getElementById("figRow")){var e=document.getElementById("figRow").clientHeight;l(e-50)}}),[u]);var I,R,N,P,x=function(){var t=da(ca().mark((function t(){var r,n;return ca().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/api/single/".concat(e));case 2:if(500!==(r=t.sent).status){t.next=8;break}console.log("Error connecting to server to fetch reactioninfo (server may not be running)."),g(500),t.next=17;break;case 8:if(!(r.status>=404)){t.next=13;break}console.log("reaction not found."),g(r.status),t.next=17;break;case 13:return t.next=15,r.json();case 15:n=t.sent,i(n);case 17:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return u?(0,ge.jsx)("div",{className:"mt-5 text-center",children:(0,ge.jsx)("strong",{children:p>=404?"Wrong page! Nothing to see here...":(0,ge.jsxs)("div",{className:"d-flex justify-content-center align-items-center",children:["Waiting for reaction information to load...",(0,ge.jsx)(Es,{animation:"border",className:"mx-2"})]})})}):(0,ge.jsxs)(Xr,{className:"mb-3",children:[(0,ge.jsxs)(Sa,{className:"mt-4 mb-4 align-items-center justify-content-between",children:[(0,ge.jsxs)("h5",{style:{color:"maroon",width:300},children:["Reaction CGEM ID: ",null===n||void 0===n?void 0:n.id]}),(0,ge.jsxs)("div",{style:{width:450,display:"flex",justifyContent:"between"},children:[(0,ge.jsx)("button",{className:"btn btn-outline-primary mx-1",disabled:null===A,style:{width:200},onClick:function(){A?v(!0):C(!0)},children:"Edit this reaction"}),(0,ge.jsx)("button",{className:"btn btn-outline-danger mx-1",style:{width:200},disabled:null===A,onClick:function(){A?E(!0):C(!0)},children:"Delete this reaction"})]})]}),(0,ge.jsx)(Al,{show:O,onHide:function(){return v(!1)},reactionId:e,authTokens:b,initialReactionData:n}),(0,ge.jsx)(Il,{show:_,onHide:function(){return E(!1)},reactionId:e,authTokens:b}),(0,ge.jsx)(Rl,{show:m,onHide:function(){return C(!1)}}),(0,ge.jsxs)(Ss,{responsive:"sm",striped:!0,bordered:!0,children:[(0,ge.jsx)("thead",{children:(0,ge.jsxs)("tr",{children:[(0,ge.jsx)("th",{children:"Monomer Name"}),(0,ge.jsx)("th",{children:"SMILES"}),(0,ge.jsx)("th",{children:"Leaving Group"})]})}),(0,ge.jsx)("tbody",{children:(0,ge.jsxs)("tr",{children:[(0,ge.jsx)("td",{children:null===n||void 0===n||null===(I=n.monomer)||void 0===I?void 0:I.monomer_name}),(0,ge.jsx)("td",{children:null===n||void 0===n||null===(R=n.monomer)||void 0===R?void 0:R.monomer_smiles}),(0,ge.jsx)("td",{children:null===n||void 0===n||null===(N=n.monomer)||void 0===N?void 0:N.monomer_LG})]})})]}),(0,ge.jsx)("br",{}),(0,ge.jsxs)(Sa,{id:"figRow",className:"figureRow",children:[(0,ge.jsxs)(Gs,{className:"reactionPageCard px-0",id:"rxnCard",style:{width:400,height:"100%"},children:[(0,ge.jsxs)(Gs.Header,{children:[" ",(0,ge.jsx)("strong",{children:"Monomer Structure"})]}),(0,ge.jsx)(Gs.Body,{children:(0,ge.jsx)(Zs,{smiles:null===n||void 0===n||null===(P=n.monomer)||void 0===P?void 0:P.monomer_smiles,width:"350",height:a})})]}),(0,ge.jsx)(Qs,{synthetase:null===n||void 0===n?void 0:n.synthetase,flexizyme:null===n||void 0===n?void 0:n.flexizyme,readout:null===n||void 0===n?void 0:n.rib_readout}),(0,ge.jsx)(rl,{trna:null===n||void 0===n?void 0:n.tRNA})]}),(0,ge.jsx)("br",{}),(0,ge.jsx)(tl,{reaction:n}),(0,ge.jsx)("br",{}),(0,ge.jsx)("div",{children:(0,ge.jsx)(el,{reaction:n})}),(0,ge.jsx)("div",{children:(0,ge.jsx)(il,{references:null===n||void 0===n?void 0:n.references})})]})},Nl=function(){var e=s((0,t.useState)([]),2),r=e[0],n=e[1],i=s((0,t.useState)(""),2),o=i[0],a=i[1],l="";(0,t.useEffect)((function(){}),[o]);var d=function(){var e=da(ca().mark((function e(){var t,r;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.length>0&&(l=(l=(l=(l=(l=(l=o).split("=").join("%3D")).split("#").join("%23")).split("(").join("%28")).split(")").join("%29")).split("+").join("%2B")),e.next=3,fetch("/api/?monomer__monomer_smiles__substruct=".concat(l)).catch((function(e){return console.log(e)}));case 3:if(500!==(t=e.sent).status&&t.ok){e.next=7;break}return a("serverError"),e.abrupt("return");case 7:return e.next=9,t.json();case 9:r=e.sent,t.ok&&n(r.results);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsxs)(Xr,{children:[(0,ge.jsx)(Sa,{as:"h4",className:"mt-4 mb-3",children:"Substructure Search"}),(0,ge.jsx)(Sa,{className:"mt-3",children:"Enter a valid SMILES string below. This will return all monomers which contain the given molecule as a substructure."}),(0,ge.jsxs)(Sa,{className:"mt-3 mb-3",style:{display:"flex",alignItems:"center"},children:["Substructure SMILES:",(0,ge.jsx)("div",{style:{width:700},children:(0,ge.jsx)(Cs.Control,{onChange:function(e){return a(e.target.value)},onSubmit:function(){return d()},onKeyPress:function(e){"Enter"===e.key&&d()},type:"text",placeholder:"SMILES"})}),(0,ge.jsx)("div",{className:"btn btn-outline-primary mb-3 mt-3 w-25",onClick:d,onSubmit:d,children:"Search"})]}),""!==o?(0,ge.jsx)(Sa,{style:{display:"flex",justifyContent:"center"},children:(0,ge.jsx)(Zs,{smiles:o,width:Math.min(300+20*o.length,1e3),height:300})}):(0,ge.jsx)(Sa,{className:"mb-3"}),r===[]?(0,ge.jsx)(ge.Fragment,{children:" Waiting for data to load... "}):"serverError"===o?(0,ge.jsx)("div",{className:"text-center mb-3",children:"  An error occurred! Your SMILES may not be valid. "}):(0,ge.jsx)(Ys,{reactions:r,verbose:!1})]})})},Pl=function(){return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsx)(zr,{className:"nav",variant:"dark",expand:"md",fixed:"bottom"})})},xl=function(){var e=h(),r=s((0,t.useState)(""),2),n=r[0],i=r[1];return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsx)(Xr,{children:(0,ge.jsx)(Sa,{className:"justify-content-center",children:(0,ge.jsxs)("div",{className:"searchBox",children:[(0,ge.jsx)(Sa,{className:"mt-5 mb-3",children:(0,ge.jsx)("h5",{className:"text-center",children:"Find a Reaction"})}),(0,ge.jsx)(Sa,{className:"align-items-center mx-auto",style:{width:"90%"},children:(0,ge.jsx)(Cs,{className:"mt-3",children:(0,ge.jsx)(Cs.Control,{size:"md",type:"text",placeholder:"Search by Monomer, Flexizyme, Synthetase, tRNA, SMILES...",onChange:function(e){i(e.target.value)},onSubmit:function(e){return e.preventDefault()},onKeyPress:function(t){"Enter"===t.key&&n&&(e.push("/search/".concat(n.replaceAll(" ","+"))),window.location.reload())}})})}),(0,ge.jsxs)(Sa,{className:"mb-5 justify-content-center mx-auto",lg:3,md:1,sm:1,xs:1,style:{width:"50vw",marginTop:"2vw"},children:[(0,ge.jsxs)(Ra,{className:"mt-3 mx-4",style:{width:"auto"},children:[" ",(0,ge.jsx)(q,{to:"/advanced",className:"gray-link mt-3",children:" Advanced Search "})," "]}),(0,ge.jsxs)(Ra,{className:"mt-3 mx-4",style:{width:"auto"},children:[" ",(0,ge.jsx)(q,{to:"/draw-structures",className:"gray-link mt-3",children:" Substructure Search "})," "]}),(0,ge.jsxs)(Ra,{className:"mt-3 mx-4",style:{width:"auto"},children:[" ",(0,ge.jsx)(q,{to:"/all-reactions",className:"gray-link mt-3",children:" Browse All Reactions "})," "]})]})]})})})})},Ml=function(){var e=D({path:"/search/:id",strict:!0,sensitive:!0}).params.id,r=s((0,t.useState)([]),2),n=r[0],i=r[1],o=s((0,t.useState)(!1),2),a=o[0],l=o[1],d=s((0,t.useState)(0),2),u=d[0],c=d[1],h=s((0,t.useState)(12),2),p=h[0],g=h[1],f=s((0,t.useState)(0),2),m=f[0],C=f[1];(0,t.useEffect)((function(){y()}),[p]);var y=function(){var t=da(ca().mark((function t(){var r,n,o;return ca().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=12;break}return"?"===e.charAt(e.length-1)&&e.slice(0,-1),t.next=4,fetch("/api/?limit=".concat(p,"&search=").concat(e));case 4:return r=t.sent,t.next=7,r.json();case 7:n=t.sent,o=n.count,C(Math.ceil(o/p)),c(o),i(n.results);case 12:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),_=function(){var e=da(ca().mark((function e(t){var r,n;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.selected+1,e.next=3,E(r);case 3:n=e.sent,i(n),window.scrollTo(0,document.body.scrollHeight);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var t=da(ca().mark((function t(r){var n,i,o;return ca().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(r-1)*p,t.next=3,fetch("/api/?limit=".concat(p,"&offset=").concat(n,"&search=").concat(e));case 3:return i=t.sent,t.next=6,i.json();case 6:return o=t.sent,t.abrupt("return",o.results);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return e?(0,ge.jsxs)(Xr,{children:[(0,ge.jsx)(Sa,{className:"mb-4 mt-5",children:(0,ge.jsxs)("h4",{className:"text-center",children:['Search Results for "',e,'": ']})}),(0,ge.jsxs)(Sa,{className:"mb-4 mt-4 align-items-center",children:[(0,ge.jsxs)("div",{style:{padding:0,width:"200px"},children:["Number of results: ",u]}),(0,ge.jsx)(Cs.Check,{style:{width:200},className:"mx-4",inline:!0,type:"switch",id:"custom-switch",label:"View structures",onClick:function(){l(!a)}}),"Show",(0,ge.jsxs)(Cs.Select,{size:"sm",style:{width:100,marginLeft:"0.5em",marginRight:"0.5em"},onChange:function(e){return g(e.target.value)},children:[(0,ge.jsx)("option",{value:12,children:"12"}),(0,ge.jsx)("option",{value:25,children:"25"}),(0,ge.jsx)("option",{value:50,children:"50"}),(0,ge.jsx)("option",{value:m*p,children:"All"})]}),"entries per page"]}),(0,ge.jsx)(Xs,{cardView:a,reactions:n,verbose:!1}),(0,ge.jsx)(qs(),{previousLabel:"previous",nextLabel:"next",breakLabel:"...",pageCount:m,marginPagesDisplayed:1,pageRangeDisplayed:3,onPageChange:_,containerClassName:"pagination justify-content-end mt-3",pageClassName:"page-item",pageLinkClassName:"page-link",previousClassName:"page-item",previousLinkClassName:"page-link",nextClassName:"page-item",nextLinkClassName:"page-link",breakClassName:"page-item",breakLinkClassName:"page-link",activeClassName:"active"})]}):(0,ge.jsx)(ge.Fragment,{})},Ll=__webpack_require__(8472),wl=function(e){var r,n=e.reactions,i=e.name,o=[],a=Dn(n);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(s.synthetase){var l="";if(s.synthetase.mutations){var d,u,c=Dn(null===s||void 0===s||null===(d=s.synthetase)||void 0===d?void 0:d.mutations);try{for(c.s();!(u=c.n()).done;){var h=u.value;l+=(null===h||void 0===h?void 0:h.mutation_name)+"; "}}catch(C){c.e(C)}finally{c.f()}}s.synthetase.muts=l;var p,g="",f=Dn(s.synthetase.organisms);try{for(f.s();!(p=f.n()).done;){g+=p.value.organism_name+"; "}}catch(C){f.e(C)}finally{f.f()}s.synthetase.orgs=g,o.push(s)}else o.push(s)}}catch(C){a.e(C)}finally{a.f()}var m=(0,t.useRef)();return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsx)(Ll.CSVLink,{headers:[{label:"DOI",key:"DOI"},{label:"Flexizyme name",key:"flexizyme.flex_name"},{label:"Flexizyme sequence",key:"flexizyme.flex_sequence"},{label:"Assay conditions",key:"assay.conditions"},{label:"Assay acylation yield",key:"assay.acylation_yield"},{label:"Acylation assay notes",key:"assay.assay_notes"},{label:"Synthetase common name",key:"synthetase.synth_common_name"},{label:"Parent synthetase",key:"synthetase.parent_synthetase.parent_name"},{label:"Accession ID",key:"synthetase.accession_id"},{label:"Organism",key:"synthetase.orgs"},{label:"Mutations",key:"synthetase.muts"},{label:"Crystal structure PDB code",key:"synthetase.pbd_id"},{label:"Monomer name",key:"monomer.monomer_name"},{label:"Monomer SMILES",key:"monomer.monomer_smiles"},{label:"Monomer leaving group",key:"monomer.monomer_LG"},{label:"tRNA name",key:"tRNA.tRNA_name"},{label:"tRNA sequence",key:"tRNA.tRNA_seq"},{label:"Ribosome name",key:"ribosome_name"},{label:"N-terminal incorporation?",key:"n_term_incorporation"},{label:"N-terminal incorporation percent",key:"n_term_percent"},{label:"Internal incorporation?",key:"internal_incorporation"},{label:"Internal incorporation percent",key:"internal_percent"},{label:"Readout",key:"rib_readout"},{label:"Ribosomal incorporation notes",key:"rib_incorporation_notes"},{label:"Yield of reaction",key:"reaction_yield"},{label:"Km (mM)",key:"reaction_Km"},{label:"Kcat (min^-1)",key:"reaction_Kcat"},{label:"Notes",key:""}],data:o,filename:"".concat(i,".csv"),target:"_blank",className:"mt-1 mb-4",ref:m,children:(0,ge.jsx)("button",{className:"btn btn-outline-secondary",children:"Download all results (CSV file)"})})})},kl=function(e){var r=e.queries,n=e.setQueries,i=e.filterID,o=(e.selected,e.setSelected,s((0,t.useState)("n_term_percent"),2)),a=o[0],l=o[1],d=s((0,t.useState)("exact"),2),u=d[0],c=d[1],h=s((0,t.useState)(""),2),p=h[0],g=h[1],f=s((0,t.useState)(""),2),m=f[0],C=f[1];(0,t.useEffect)((function(){c(y[a][0])}),[a]),(0,t.useEffect)((function(){C("exact"!==u?a+"__"+u:a)}),[a,u,p]),(0,t.useEffect)((function(){var e=Q({},r);e["".concat(i)]=["".concat(m),p],n(e)}),[m,p]),(0,t.useEffect)((function(){return function(){return console.log("unmount")}}),[]);var y={n_term_percent:["exact","gte","lte"],internal_percent:["exact","gte","lte"],assay__acylation_yield:["exact","gte","lte"],flexizyme:["isnull"],flexizyme__flex_name:["iexact","icontains"],synthetase:["isnull"],synthetase__synth_common_name:["iexact","icontains"],synthetase__parent_synthetase__parent_name:["iexact","icontains"],synthetase__organisms__organism_name:["iexact","icontains"],synthetase__mutations__mutation_name:["iexact","icontains"],monomer__monomer_name:["iexact","icontains"],monomer__monomer_smiles:["substruct"],monomer__monomer_LG:["iexact","icontains"],date_added:["exact"],rib_readout:["iexact","icontains"],references__DOI:["iexact","icontains"],rib_incorporation_notes:["iexact","icontains"],id:["exact","gte","lte"]},_={n_term_percent:"n-terminal incorporation percent",internal_percent:"internal incorporation percent",assay__acylation_yield:"microhelix assay acylation yield",flexizyme:"flexizyme",flexizyme__flex_name:"flexizyme name",synthetase:"synthetase",synthetase__synth_common_name:"synthetase common name",synthetase__parent_synthetase__parent_name:"parent synthetase name",synthetase__organisms__organism_name:"organism name",synthetase__mutations__mutation_name:"synthetase mutation name",monomer__monomer_name:"monomer name",monomer__monomer_smiles:"substructure SMILES",monomer__monomer_LG:"monomer leaving group",date_added:"date added",rib_readout:"ribosomal readout",references__DOI:"reference DOI",rib_incorporation_notes:"ribosomal incorporation notes",id:"reaction ID"},E=function(e){if("date_added"===a)return"is exactly (YYYY-MM-DD)";switch(e){case"":case"iexact":case"substruct":case"exact":return"is exactly";case"icontains":return"contains";case"gte":return"is greater than or equal to";case"lte":return"is less than or equal to";case"isnull":return"true or false";default:return e}};return(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsx)(Cs.Select,{className:"mt-3",size:"md",style:{width:325},onChange:function(e){return l(e.target.value)},children:Object.keys(y).map((function(e){return(0,ge.jsx)("option",{value:e,children:_[e]},e)}))}),(0,ge.jsx)(Cs.Select,{className:"mt-3",size:"md",style:{width:325},onChange:function(e){c(e.target.value),C("exact"!==u?a+"__"+u:a)},children:y[a].map((function(e,t){return(0,ge.jsx)("option",{value:e,children:E(e)},t)}))}),(0,ge.jsx)(Cs.Control,{className:"mt-3",size:"md",style:{width:325},onChange:function(e){if("synthetase"===a||"flexizyme"===a)"true"===e.target.value?g("false"):"false"===e.target.value&&g("true");else if("monomer__monomer_smiles"===a||"monomer__monomer_name"===a){var t=e.target.value;t.length>0&&(t=(t=(t=(t=(t=(t=t.split("=").join("%3D")).split("#").join("%23")).split("(").join("%28")).split(")").join("%29")).split("+").join("%2B")).split("@").join("%40")),g(t)}else g(e.target.value);C("exact"!==u?a+"__"+u:a)}})]})},Bl=function(){var e=s((0,t.useState)({}),2),r=e[0],n=e[1],i=s((0,t.useState)(""),2),o=i[0],a=i[1],l=s((0,t.useState)("&ordering=id"),2),d=l[0],u=l[1],c=s((0,t.useState)([]),2),h=c[0],p=c[1],g=s((0,t.useState)(!1),2),f=g[0],m=g[1],C=s((0,t.useState)(12),2),y=C[0],_=C[1],E=s((0,t.useState)(0),2),T=E[0],O=E[1],v=s((0,t.useState)(1),2),S=v[0],b=v[1],A=s((0,t.useState)([1]),2),I=A[0],R=A[1],D=s((0,t.useState)(1),2),N=D[0],P=D[1],x=s((0,t.useState)(!1),2),M=x[0],L=x[1],w=function(){var e=da(ca().mark((function e(){var t,n,i,a,l,u,c,h;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(L(!0),t="",n=0,i=Object.entries(r);n<i.length;n++)a=s(i[n],2),a[0],l=a[1],t+="&"+l[0]+"="+l[1];return console.log(t),e.next=6,fetch("/api/single/?limit=".concat(y).concat(d)+t+o);case 6:if((u=e.sent)&&L(!1),500!==u.status){e.next=13;break}return p("serverError"),e.abrupt("return");case 13:if(!(u.status>=400)){e.next=16;break}return p("blank"),e.abrupt("return");case 16:return e.next=18,u.json();case 18:return c=e.sent,p(c.results),0===(h=c.count)&&p("blank"),b(Math.ceil(h/y)),O(h),e.next=26,c.length;case 26:0===e.sent&&p("blank");case 28:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,t.useEffect)((function(){0!==h.length&&w()}),[y]);var k=function(){var e=da(ca().mark((function e(t){var r,n;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.selected+1,e.next=3,B(r);case 3:n=e.sent,p(n),window.scrollTo(0,document.body.scrollHeight);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=da(ca().mark((function e(t){var n,i,a,l,u,c,h,p;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(L(!0),n="",i=0,a=Object.entries(r);i<a.length;i++)l=s(a[i],2),l[0],u=l[1],n+="&"+u[0]+"="+u[1];return c=(t-1)*y,e.next=6,fetch("/api/single/?limit=".concat(y,"&offset=").concat(c).concat(d)+n+o);case 6:return h=e.sent,e.next=9,h.json();case 9:return p=e.sent,L(!1),e.abrupt("return",p.results);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=da(ca().mark((function e(){var t,n,i,a,l;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t="",n=0,i=Object.entries(r);n<i.length;n++)a=s(i[n],2),a[0],l=a[1],t+="&"+l[0]+"="+l[1];return e.next=4,fetch("/api/single/?{ordering}"+t+o);case 4:e.sent;case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsxs)(Xr,{onKeyPress:function(e){"Enter"===e.key&&w()},children:[(0,ge.jsx)(Sa,{as:"h4",className:"mt-4 mb-2",children:"Advanced Reaction Search"}),(0,ge.jsx)(Sa,{className:"mt-3 mb-2",children:' This will return all reactions that meet the selected criteria (every additional filter will be joined with an AND statement). Filters are not case sensitive. To search for multiple mutations, write them in the "Other search terms" box. '}),(0,ge.jsx)(Sa,{}),(0,ge.jsx)("div",{className:"wrapper mt-2",children:(0,ge.jsxs)("div",{className:"insidewrapper",children:[I.map((function(e){return(0,ge.jsxs)(Sa,{className:"align-items-center search-filter justify-content-between",style:{width:"100%",marginLeft:0},children:[(0,ge.jsx)(kl,{setQueries:n,queries:r,filterID:e},e),(0,ge.jsx)("button",{className:"btn btn-outline-danger mt-3",style:{width:"8em"},onClick:function(){I.length>=1&&(delete r[e],R((function(t){return t.filter((function(t){return t!=e}))})))},children:"Remove"})]},e)})),(0,ge.jsx)("button",{className:"btn btn-outline-success mt-3",style:{width:"10em"},onClick:function(){R((function(e){return[].concat(Pt(e),[N+1])})),P(N+1)},children:"+ Add Filter"})]})}),(0,ge.jsx)("hr",{className:"mt-4 mb-2",style:{color:"black",backgroundColor:"black"}}),(0,ge.jsxs)(Sa,{className:"align-items-center justify-content-center",children:[(0,ge.jsx)(Ra,{className:"mt-3",children:(0,ge.jsx)("div",{style:{width:495},children:(0,ge.jsx)(Cs.Control,{onChange:function(e){return a("&search="+e.target.value)},onSubmit:function(e){return a("&search="+e.target.value)},type:"text",placeholder:"Other search terms"})})}),(0,ge.jsx)(Ra,{className:"mt-3",children:"Order results by:"}),(0,ge.jsx)(Ra,{className:"mt-3",children:(0,ge.jsx)("div",{style:{width:300},children:(0,ge.jsxs)("select",{onChange:function(e){return u("&ordering="+e.target.value)},onSubmit:function(e){return u("&ordering="+e.target.value)},className:"form-select",children:[(0,ge.jsx)("option",{value:"id",children:"Database ID (default)"}),(0,ge.jsx)("option",{value:"-internal_percent",children:"Internal incorporation %"}),(0,ge.jsx)("option",{value:"-n_term_percent",children:"N-terminal incorporation %"}),(0,ge.jsx)("option",{value:"-assay__acylation_yield",children:"Microhelix assay yield"})]})})}),(0,ge.jsx)(Ra,{className:"mt-3",children:(0,ge.jsx)("div",{style:{width:300},children:(0,ge.jsx)(Cs.Check,{type:"switch",id:"custom-switch",label:"View structures",onClick:function(){m(!f)}})})})]}),(0,ge.jsxs)(Sa,{className:"justify-content-between",children:[(0,ge.jsx)(Ra,{children:(0,ge.jsx)("button",{className:"btn btn-outline-primary mb-3 mt-4",onClick:w,onSubmit:w,style:{width:250},children:"Search"})}),!0===M?(0,ge.jsx)(Es,{className:"mt-4",animation:"border",variant:"success"}):(0,ge.jsx)(ge.Fragment,{})]})]}),0!==h.length?"blank"===h?(0,ge.jsx)("h6",{className:"text-center mt-3",children:"No reactions with those parameters found."}):"serverError"===h?(0,ge.jsx)("h6",{className:"text-center mt-3",children:"Server error (server may not be running)."}):(0,ge.jsxs)(Xr,{children:[(0,ge.jsxs)(Sa,{className:"mb-4 mt-4 align-items-center",children:[(0,ge.jsxs)("div",{style:{padding:0,width:"200px"},children:["Number of results: ",T]}),"Show",(0,ge.jsxs)(Cs.Select,{size:"sm",style:{width:100,marginLeft:"0.5em",marginRight:"0.5em"},onChange:function(e){return _(e.target.value)},children:[(0,ge.jsx)("option",{value:12,children:"12"}),(0,ge.jsx)("option",{value:25,children:"25"}),(0,ge.jsx)("option",{value:50,children:"50"}),(0,ge.jsx)("option",{value:S*y,children:"All"})]}),"entries per page"]}),(0,ge.jsx)(Sa,{className:"mt-3",children:(0,ge.jsx)(Xs,{reactions:h,cardView:f,verbose:!0})}),(0,ge.jsx)(qs(),{previousLabel:"previous",nextLabel:"next",breakLabel:"...",pageCount:S,marginPagesDisplayed:1,pageRangeDisplayed:3,onPageChange:k,containerClassName:"pagination justify-content-end mt-3",pageClassName:"page-item",pageLinkClassName:"page-link",previousClassName:"page-item",previousLinkClassName:"page-link",nextClassName:"page-item",nextLinkClassName:"page-link",breakClassName:"page-item",breakLinkClassName:"page-link",activeClassName:"active"}),(0,ge.jsx)(Sa,{children:(0,ge.jsx)(wl,{reactions:h,name:"cgemdb_adv_search_results",onClick:j})})]}):(0,ge.jsx)(ge.Fragment,{})]})},jl=function(){return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsx)("div",{children:(0,ge.jsx)(Ll.CSVLink,{data:[["DOI (required)","Flexizyme name","Monomer name","Monomer SMILES (required)","Monomer leaving group","Assay conditions","Assay acylation yield","Acylation assay notes","tRNA name (required)","tRNA sequence (required)","Ribosome name (required)","N-terminal incorporation","Internal incorporation","Readout","Ribosomal incorporation notes","Notes"],[]],filename:"CGEMDB_Flexizyme_submissions_blank.CSV",target:"_blank",style:{textDecoration:"none"},children:(0,ge.jsx)("button",{className:"btn btn-outline-secondary",children:"Download blank flexizymes template"})})})})},Ul=function(){return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsx)("div",{children:(0,ge.jsx)(Ll.CSVLink,{data:[["DOI (required)","Synthetase common name","Parent synthetase","Accession ID","Organism","Mutations","Crystal structure PDB code","Monomer name","Monomer SMILES (required)","Monomer leaving group","tRNA name (required)","tRNA sequence (required)","Ribosome name (required)","N-terminal incorporation","Internal incorporation","Readout","Ribosomal incorporation notes","Yield of reaction","Km (mM)","Kcat (min^-1)","Notes"],[]],filename:"CGEMDB_Synthetase_submissions_blank.CSV",target:"_blank",style:{textDecoration:"none"},children:(0,ge.jsx)("button",{className:"btn btn-outline-secondary",children:"Download blank synthetases template"})})})})},Fl=__webpack_require__(1025),Wl=["min","now","max","label","visuallyHidden","striped","animated","className","style","variant","bsPrefix"],Vl=["isChild"],Hl=["min","now","max","label","visuallyHidden","striped","animated","bsPrefix","variant","className","children"];function Gl(e,t,r){var n=(e-t)/(r-t)*100;return Math.round(1e3*n)/1e3}function zl(e,t){var r,n=e.min,i=e.now,o=e.max,a=e.label,s=e.visuallyHidden,l=e.striped,d=e.animated,u=e.className,c=e.style,h=e.variant,p=e.bsPrefix,g=te(e,Wl);return(0,ge.jsx)("div",Q(Q({ref:t},g),{},{role:"progressbar",className:ne()(u,"".concat(p,"-bar"),(r={},J(r,"bg-".concat(h),h),J(r,"".concat(p,"-bar-animated"),d),J(r,"".concat(p,"-bar-striped"),d||l),r)),style:Q({width:"".concat(Gl(i,n,o),"%")},c),"aria-valuenow":i,"aria-valuemin":n,"aria-valuemax":o,children:s?(0,ge.jsx)("span",{className:"visually-hidden",children:a}):a}))}var Kl=t.forwardRef((function(e,r){var n=e.isChild,i=te(e,Vl);if(i.bsPrefix=Ce(i.bsPrefix,"progress"),n)return zl(i,r);var o=i.min,a=i.now,s=i.max,l=i.label,d=i.visuallyHidden,u=i.striped,c=i.animated,h=i.bsPrefix,p=i.variant,g=i.className,f=i.children,m=te(i,Hl);return(0,ge.jsx)("div",Q(Q({ref:r},m),{},{className:ne()(g,h),children:f?Fa(f,(function(e){return(0,t.cloneElement)(e,{isChild:!0})})):zl({min:o,now:a,max:s,label:l,visuallyHidden:d,striped:u,animated:c,bsPrefix:h,variant:p},r)}))}));Kl.displayName="ProgressBar",Kl.defaultProps={min:0,max:100,animated:!1,isChild:!1,visuallyHidden:!1,striped:!1};var Yl=Kl,Xl=function(e){var t=e.show,r=e.onHide,n=e.headerText,i=e.bodyText;return(0,ge.jsxs)(bl,{show:t,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,onHide:r,children:[(0,ge.jsx)(bl.Header,{closeButton:!0,children:(0,ge.jsx)(bl.Title,{id:"contained-modal-title-vcenter",children:n})}),(0,ge.jsx)(bl.Body,{children:i}),(0,ge.jsx)(bl.Footer,{children:(0,ge.jsx)("button",{className:"btn btn-outline-secondary",onClick:r,children:"Close"})})]})},$l=function(){var e,r,n,i,o=s((0,t.useState)(null),2),a=o[0],l=o[1],d=s((0,t.useState)([]),2),u=d[0],c=d[1],p=s((0,t.useState)([]),2),g=p[0],f=p[1],m=(0,t.useRef)(null),C=h(),y=(0,t.useContext)(ya),_=y.authTokens,E=y.user,T=s((0,t.useState)([!1,"message"]),2),O=T[0],v=T[1],S=s((0,t.useState)(""),2),b=S[0],A=S[1],I=s((0,t.useState)([!1,"message"]),2),R=I[0],D=I[1],N=s((0,t.useState)([!1,"message"]),2),P=N[0],x=N[1],M=s((0,t.useState)(!1),2),L=M[0],w=M[1],k=s((0,t.useState)(!1),2),B=(k[0],k[1]),j=s((0,t.useState)(0),2),U=j[0],F=j[1],W=s((0,t.useState)(0),2),V=W[0],H=W[1],G=function(){c([]),f([]),m.current.value=null},z=function(){var e=da(ca().mark((function e(t){var r,n,i,o;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:if(r=e.sent,n=(0,Fl.parse)(r,{header:!0}),i=Y(n.data)){e.next=7;break}return e.abrupt("return");case 7:H(i.length),o=i.map((function(e){var t;return{flexizyme:null!=e.flexizyme?e.flexizyme.flex_name:null,synthetase:null!=e.synthetase?e.synthetase.synth_common_name:null,monomer:e.monomer.monomer_smiles||e.monomer.monomer_name,monomer_smiles:e.monomer.monomer_smiles,n_term_incorporation:e.n_term_incorporation,n_term_percent:e.n_term_percent,internal_incorporation:e.internal_incorporation,internal_percent:e.internal_percent,acylation_yield:(null===(t=e.assay)||void 0===t?void 0:t.acylation_yield)||null}})),c(o),f(i);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=da(ca().mark((function e(){var t,r,n,i,o;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B(!0),t=1,r=Dn(g),e.prev=3,r.s();case 5:if((n=r.n()).done){e.next=32;break}if(i=n.value,F(t+=1),o=void 0,!E.is_admin){e.next=16;break}return e.next=13,fetch("/api/single/",{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer "+String(_.access)},body:JSON.stringify(i)});case 13:o=e.sent,e.next=19;break;case 16:return e.next=18,fetch("/api/drafts/",{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer "+String(_.access)},body:JSON.stringify({reactionDraft:i,truncatedReactionDraft:u[t-2]})});case 18:o=e.sent;case 19:if(o.ok){e.next=30;break}return v([!0,"Error submitting data from row ".concat(t,". ")+"Any rows prior to row ".concat(t," were submitted successfully. ")+"Please double-check your data including and following row ".concat(t,", and resubmit those rows.")]),e.t0=A,e.t1="Error message at row ".concat(t,": "),e.next=25,o.text();case 25:return e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),(0,e.t0)(e.t3),B(!1),e.abrupt("return");case 30:e.next=5;break;case 32:e.next=37;break;case 34:e.prev=34,e.t4=e.catch(3),r.e(e.t4);case 37:return e.prev=37,r.f(),e.finish(37);case 40:return B(!1),D([!0,"Successfully submitted all reactions".concat(E.is_admin?"!":" to reaction-drafts!")]),F(0),e.abrupt("return");case 44:case"end":return e.stop()}}),e,null,[[3,34,37,40]])})));return function(){return e.apply(this,arguments)}}(),Y=function(e){var t,r=[],n=Dn(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;try{if(!("DOI (required)"in i&&"Monomer SMILES (required)"in i&&"tRNA name (required)"in i&&"tRNA sequence (required)"in i&&"Ribosome name (required)"in i))return void x([!0,"CSV is missing a required column."]);if("Flexizyme name"in i&&"Synthetase common name"in i)return void x([!0,"Please submit separate files for synthetase and flexizyme reactions."]);if(i["Monomer SMILES (required)"].includes("."))return void x([!0,"The monomer field should contain only 1 molecule per entry. There should be no periods in the Monomer SMILES parameter."]);if((parseFloat(i["Assay acylation yield"])||0)>2||(parseFloat(i["N-terminal incorporation"])||0)>2||(parseFloat(i["Internal incorporation"])||0)>2)return void x([!0,"Percentages should be expressed as decimal numbers between 0 and 1."]);var o={};"Flexizyme name"in i?(o.synthetase=null,o.flexizyme={flex_name:i["Flexizyme name"]},o.assay={conditions:i["Assay conditions"],acylation_yield:parseFloat(i["Assay acylation yield"])||null,assay_notes:i["Acylation assay notes"]}):"Synthetase common name"in i?(o.flexizyme=null,o.assay=null,o.synthetase={synth_common_name:i["Synthetase common name"],parent_synthetase:{parent_name:i["Parent synthetase"],parent_pbd_id:""},accession_id:i["Accession ID"],pbd_id:i["Crystal structure PDB code"],organisms:i.Organism.split("; ").map((function(e){return{organism_name:e}})),mutations:i.Mutations.split("; ").map((function(e){return{mutation_name:e}}))},o.reaction_yield=parseFloat(i["Yield of reaction"])||null,o.reaction_Kcat=parseFloat(i["Kcat (min^-1)"])||null,o.reaction_Km=parseFloat(i["Km (mM)"])||null):(o.flexizyme=null,o.assay=null,o.synthetase=null),o.monomer={monomer_smiles:i["Monomer SMILES (required)"].split(".")[0],monomer_name:i["Monomer name"],monomer_LG:i["Monomer leaving group"]},o.tRNA={tRNA_name:i["tRNA name (required)"],tRNA_seq:i["tRNA sequence (required)"]},o.references=i["DOI (required)"].split("; ").map((function(e){return{DOI:e,title:"",publication_date:null,journal:"",authors:null}}));try{o.n_term_percent=parseFloat(i["N-terminal incorporation"]),o.n_term_incorporation=o.n_term_percent||"Yes"===i["N-terminal incorporation"]||"Y"===i["N-terminal incorporation"]?"Y":"No"===i["N-terminal incorporation"]||"N"===i["N-terminal incorporation"]?"N":""}catch(a){o.n_term_percent=null,o.n_term_incorporation=o.n_term_percent||"Yes"===i["N-terminal incorporation"]||"Y"===i["N-terminal incorporation"]?"Y":"No"===i["N-terminal incorporation"]||"N"===i["N-terminal incorporation"]?"N":""}try{o.internal_percent=parseFloat(i["Internal incorporation"]),o.internal_incorporation=o.internal_percent||"Yes"===i["Internal incorporation"]||"Y"===i["Internal incorporation"]?"Y":"No"===i["Internal incorporation"]||"N"===i["Internal incorporation"]?"N":""}catch(s){o.internal_percent=null,o.internal_incorporation=o.internal_percent||"Yes"===i["Internal incorporation"]||"Y"===i["Internal incorporation"]?"Y":"No"===i["Internal incorporation"]||"N"===i["Internal incorporation"]?"N":""}o.ribosome_name=i["Ribosome name (required)"],o.rib_readout=i.Readout,o.rib_incorporation_notes=i["Ribosomal incorporation notes"],r.push(o)}catch(l){return x([!0,l.message]),void console.log(l)}}}catch(l){n.e(l)}finally{n.f()}return r};return(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsxs)("div",{className:"m-3 mb-4 mt-3 align-items-center",children:[(0,ge.jsx)("label",{className:"mx-3",children:"Choose file to upload:"}),(0,ge.jsx)("input",{ref:m,onChange:function(){var e;if(null!==(e=m.current)&&void 0!==e&&e.files){l(m.current.files[0].name);var t=Array.from(m.current.files).filter((function(e){return"text/csv"===e.type}));z(t[0])}},className:"d-none",type:"file"}),(0,ge.jsx)("button",{onClick:function(){var e;null===(e=m.current)||void 0===e||e.click()},className:"mx-3 btn btn-outline-".concat(a?"success":"primary"),children:a||"Upload CSV"}),(0,ge.jsx)("button",{className:"btn btn-outline-".concat(a&&"text/csv"===(null===(e=m.current)||void 0===e||null===(r=e.files[0])||void 0===r?void 0:r.type)?"primary":"secondary"),onClick:K,disabled:!(a&&"text/csv"===(null===(n=m.current)||void 0===n||null===(i=n.files[0])||void 0===i?void 0:i.type)),children:"Submit"}),(0,ge.jsx)(Cs.Check,{style:{width:200},className:"mx-4",inline:!0,type:"switch",id:"custom-switch",label:"View structures",onClick:function(){w(!L)}}),0!==U&&0!==V?(0,ge.jsx)(Yl,{className:"mt-3",now:U,role:"status",striped:!0,variant:"success",max:V,min:0}):(0,ge.jsx)(ge.Fragment,{})]}),(0,ge.jsx)(Xl,{headerText:"Error formatting data for submission.",bodyText:P[1],show:!0===P[0],onHide:function(){G(),x([!1,"message"])}}),(0,ge.jsx)(Xl,{headerText:b,bodyText:O[1],show:!0===O[0],onHide:function(){G(),v([!1,"message"])}}),(0,ge.jsx)(Xl,{headerText:"Submission successful.",bodyText:R[1],show:!0===R[0],onHide:function(){E.is_admin?(C.push("/my-reactions"),window.location.reload()):(C.push("/reaction-drafts"),window.location.reload())}}),0!==u.length?!0===L?(0,ge.jsx)(Ys,{reactions:u,verbose:!1,nolink:!0}):(0,ge.jsx)(As,{reactions:u,verbose:!1,nolink:!0}):(0,ge.jsx)(ge.Fragment,{})]})},ql=function(){return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsxs)(Xr,{className:"mb-5 mt-4",children:[(0,ge.jsx)("h4",{className:"mt-3 mb-3",children:" Contribute to the CGEM database "}),(0,ge.jsxs)(Sa,{className:"mb-3",children:[" ",(0,ge.jsx)("p",{children:"To submit new reactions, please download and edit the relevant template files so that your entries are in a usable format. If your data does not include flexizymes or synthetases, you can use either format. For multiple mutations (or organisms) corresponding to the same synthetase, separate each mutation with a semicolon."}),(0,ge.jsxs)("p",{children:["Confirm that every row of your submission has the following required fields:",(0,ge.jsx)("span",{style:{fontWeight:"bold"},children:" DOI, monomer SMILES, tRNA name, tRNA sequence, ribosome (name or WT)"}),"."]})]}),(0,ge.jsx)($l,{}),(0,ge.jsxs)(Sa,{className:"mb-3",lg:5,md:3,sm:1,children:[(0,ge.jsx)(jl,{}),(0,ge.jsx)(Ul,{})]})]})})},Jl=function(){var e=(0,ge.jsx)(q,{to:"/create-account",children:"here"}),r=(0,t.useContext)(ya),n=r.loginUser,i=r.error,o=r.setError,a=s((0,t.useState)(!1),2),l=(a[0],a[1]);return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsxs)(Xr,{children:[(0,ge.jsxs)(Gs,{style:{width:600},className:"signInCard my-auto mx-auto mt-5",children:[(0,ge.jsx)("h4",{className:"mt-5 mb-3 text-center",children:" Sign in "}),(0,ge.jsxs)(Cs,{onSubmit:n,className:"mx-3",children:[(0,ge.jsxs)(Cs.Group,{className:"mx-5 mb-3",controlId:"formBasicEmail",children:[(0,ge.jsx)(Cs.Label,{children:"Email"}),(0,ge.jsx)(Cs.Control,{type:"email",placeholder:"user123@domain.com",required:!0})]}),(0,ge.jsxs)(Cs.Group,{className:"mx-5 mt-3 mb-4",controlId:"formBasicPassword",children:[(0,ge.jsx)(Cs.Label,{children:"Password"}),(0,ge.jsx)(Cs.Control,{type:"password",placeholder:"password",required:!0})]}),(0,ge.jsx)(Cs.Group,{className:"mx-5 mt-3 mb-3",children:(0,ge.jsx)("button",{className:"btn btn-outline-success",variant:"primary",type:"submit",children:"Submit"})}),(0,ge.jsx)(Cs.Group,{className:"mx-5 mt-2 mb-5",children:(0,ge.jsxs)(Cs.Text,{muted:!0,children:["Don't have an account but want to contribute? Create a new account ",e,"."]})})]})]}),(0,ge.jsx)(Xl,{headerText:"Login Error",bodyText:"Something went wrong! Check that you are using the correct email and not a username to log in.",show:!0===i,onHide:function(){l(!1),o(!1)}})]})})},Zl=function(){var e=s((0,t.useState)(""),2),r=e[0],n=e[1],i=s((0,t.useState)(""),2),o=i[0],a=i[1],l=s((0,t.useState)(!1),2),d=l[0],u=l[1],c=(0,ge.jsx)(q,{to:"/sign-in",children:"here"}),p=h(),g=function(){var e=da(ca().mark((function e(t){var r,i;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,fetch("/api/account/register",{method:"POST",headers:{"Content-type":"application/JSON"},body:JSON.stringify({email:t.target.formBasicEmail.value,username:t.target.formBasicUsername.value,password:t.target.formBasicPassword.value,password2:t.target.formBasicPassword2.value,institution:t.target.institution.value,orcid_id:t.target.orcid_id.value})});case 3:return r=e.sent,e.next=6,r.json();case 6:if(i=e.sent,!r.ok){e.next=18;break}if(i.response&&"successfully registered new user."===i.response){e.next=13;break}return a("Email address error"),n("".concat(i.email)),u(!0),e.abrupt("return");case 13:a("Success!"),n("sign in to your account on the login page."),u(!0),e.next=20;break;case 18:console.log(i),alert("something went wrong!");case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsxs)(Xr,{children:[(0,ge.jsxs)(Gs,{style:{width:"50vw"},className:"signInCard my-auto mx-auto mt-5",children:[(0,ge.jsx)("h4",{className:"mt-5 mb-3 text-center",children:" Create an Account "}),(0,ge.jsxs)(Cs,{onSubmit:g,children:[(0,ge.jsxs)(Cs.Group,{className:"mx-5 mb-3",controlId:"formBasicEmail",children:[(0,ge.jsxs)(Cs.Label,{children:["Email ",(0,ge.jsx)("span",{style:{color:"red",fontWeight:"bold"},children:"*"})]}),(0,ge.jsx)(Cs.Control,{type:"email",placeholder:"name@address.com",required:!0}),(0,ge.jsx)(Cs.Control.Feedback,{type:"invalid",children:"Please provide a valid email."})]}),(0,ge.jsxs)(Cs.Group,{className:"mx-5 mb-3",controlId:"formBasicUsername",children:[(0,ge.jsxs)(Cs.Label,{children:[" Name ",(0,ge.jsx)("span",{style:{color:"red",fontWeight:"bold"},children:"*"})," "]}),(0,ge.jsx)(Cs.Control,{type:"username",placeholder:"my name",required:!0})]}),(0,ge.jsxs)(Cs.Group,{className:"mx-5 mb-3",default:"",controlId:"institution",children:[(0,ge.jsx)(Cs.Label,{children:"Institution"}),(0,ge.jsx)(Cs.Control,{type:"institution",placeholder:"institution (not required)"})]}),(0,ge.jsxs)(Cs.Group,{className:"mx-5 mb-3",default:"",controlId:"orcid_id",children:[(0,ge.jsx)(Cs.Label,{children:"ORCID iD"}),(0,ge.jsx)(Cs.Control,{type:"orcid",placeholder:"16-digit ORCID id (not required)"})]}),(0,ge.jsxs)(Cs.Group,{className:"px-10 mx-5 mt-3 mb-3",controlId:"formBasicPassword",children:[(0,ge.jsxs)(Cs.Label,{children:["Password ",(0,ge.jsx)("span",{style:{color:"red",fontWeight:"bold"},children:"*"})]}),(0,ge.jsx)(Cs.Control,{type:"password",placeholder:"password",required:!0})]}),(0,ge.jsxs)(Cs.Group,{className:"px-10 mx-5 mt-3 mb-3",controlId:"formBasicPassword2",children:[(0,ge.jsxs)(Cs.Label,{children:["Confirm Password ",(0,ge.jsx)("span",{style:{color:"red",fontWeight:"bold"},children:"*"})]}),(0,ge.jsx)(Cs.Control,{type:"password",placeholder:"password again",required:!0})]}),(0,ge.jsx)(Cs.Group,{className:"px-10 mx-5 mt-3 mb-3",children:(0,ge.jsx)("button",{style:{width:"100px"},className:"btn btn-outline-success mt-3 mb-3",variant:"primary",type:"submit",children:"Submit"})}),(0,ge.jsx)(Cs.Group,{className:"mx-5 mt-2 mb-5",children:(0,ge.jsxs)(Cs.Text,{muted:!0,children:["Already have an account? Sign in ",c,"."]})})]})]}),(0,ge.jsx)(Xl,{show:d,onHide:function(){u(!1),a(""),"Success!"===o&&(p.push("/sign-in"),window.location.reload())},headerText:o,bodyText:r})]})})},Ql=["children"],ed=function(e){var r=e.children;te(e,Ql);return null!==(0,t.useContext)(ya).user?r:(0,ge.jsx)(O,{to:"/sign-in"})},td=function(){var e=s((0,t.useState)([]),2),r=e[0],n=e[1],i=s((0,t.useState)(""),2),o=i[0],a=i[1],l=s((0,t.useState)(!1),2),d=l[0],u=l[1],c=s((0,t.useState)(0),2),h=c[0],p=c[1],g=s((0,t.useState)(1),2),f=g[0],m=g[1],C=s((0,t.useState)(12),2),y=C[0],_=C[1],E=s((0,t.useState)(!0),2),T=E[0],O=E[1],v=(0,t.useContext)(ya),S=v.authTokens,b=v.logoutUser,A=v.user;(0,t.useEffect)((function(){I()}),[o,y]),(0,t.useEffect)((function(){}),[d]);var I=function(){var e=da(ca().mark((function e(){var t,r,i;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O(!0),e.next=3,fetch("/api/myreactions/?limit=".concat(y,"&ordering=").concat(o),{headers:{"Content-Type":"application/json",Authorization:"Bearer "+String(S.access)}}).catch((function(e){console.error(e)}));case 3:return t=e.sent,e.next=6,t.json();case 6:r=e.sent,console.log(r),t.ok?(n(r.results),i=r.count,m(Math.ceil(i/y)),p(i)):"Unauthorized"===t.statusText&&b(),O(!1);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=da(ca().mark((function e(t){var r,i;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.selected+1,e.next=3,D(r);case 3:i=e.sent,n(i),window.scrollTo(0,document.body.scrollHeight);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=da(ca().mark((function e(t){var r,n,i;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(t-1)*y,e.next=3,fetch("/api/?limit=".concat(y,"&offset=").concat(r,"&ordering=").concat(o));case 3:return n=e.sent,e.next=6,n.json();case 6:return i=e.sent,e.abrupt("return",i.results);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsxs)(Xr,{className:"mb-4 mt-4",children:[(0,ge.jsxs)(Sa,{className:"mt-3",as:"h4",children:[" Your reactions: ",A.username]}),(0,ge.jsx)(Sa,{className:"mt-3",children:" These are all of the reactions you have added. "}),(0,ge.jsxs)(Sa,{className:"mt-3 align-items-center",children:[" Order results by:",(0,ge.jsx)("div",{style:{width:300},children:(0,ge.jsxs)("select",{onChange:function(e){return a(e.target.value)},onSubmit:function(e){return a(e.target.value)},className:"form-select",children:[(0,ge.jsx)("option",{value:"id",children:"Database ID (default)"}),(0,ge.jsx)("option",{value:"-internal_percent&internal_incorporation=Y",children:"Internal incorporation %"}),(0,ge.jsx)("option",{value:"-n_term_percent&n_term_incorporation=Y",children:"N-terminal incorporation %"}),(0,ge.jsx)("option",{value:"-assay__acylation_yield&synthetase__isnull=true",children:"Microhelix assay acylation yield"})]})}),(0,ge.jsx)(Ra,{children:(0,ge.jsx)("div",{children:(0,ge.jsx)(Cs.Check,{type:"switch",id:"custom-switch",label:"View structures",onClick:function(){u(!d)}})})})]}),(0,ge.jsxs)(Sa,{className:"mt-3 align-items-center",children:[(0,ge.jsxs)("div",{style:{width:300,padding:0},children:["Number of results: ",h]}),"Show",(0,ge.jsxs)(Cs.Select,{size:"sm",style:{width:100,marginLeft:"0.5em",marginRight:"0.5em"},onChange:function(e){return _(e.target.value)},children:[(0,ge.jsx)("option",{value:12,children:"12"}),(0,ge.jsx)("option",{value:25,children:"25"}),(0,ge.jsx)("option",{value:50,children:"50"}),(0,ge.jsx)("option",{value:f*y,children:"All"})]}),"entries per page"]}),!0===T?(0,ge.jsxs)(Sa,{className:"align-items-center justify-content-center mt-5",children:[" ",(0,ge.jsx)(Es,{animation:"border",className:"mx-3"}),"Waiting for data to load... "]}):(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsx)(Sa,{className:"mt-4",children:(0,ge.jsx)(Xs,{reactions:r,cardView:d,verbose:!1})})}),(0,ge.jsx)(qs(),{previousLabel:"previous",nextLabel:"next",breakLabel:"...",pageCount:f,marginPagesDisplayed:1,pageRangeDisplayed:3,onPageChange:R,containerClassName:"pagination justify-content-end mt-3",pageClassName:"page-item",pageLinkClassName:"page-link",previousClassName:"page-item",previousLinkClassName:"page-link",nextClassName:"page-item",nextLinkClassName:"page-link",breakClassName:"page-item",breakLinkClassName:"page-link",activeClassName:"active"})]})})},rd=function(){var e=__webpack_require__(3093).Kekule,r=(0,t.useRef)(),n=s((0,t.useState)([]),2),i=n[0],o=n[1],a=s((0,t.useState)(null),2),l=a[0],d=a[1],u=s((0,t.useState)(null),2),c=u[0],h=u[1],p=s((0,t.useState)(!1),2),g=p[0],f=p[1],m=s((0,t.useState)(1),2),C=m[0],y=m[1],_=s((0,t.useState)(12),2),E=_[0],T=_[1],O=s((0,t.useState)(!1),2),v=O[0],S=O[1],b="";(0,t.useEffect)((function(){null!==l&&A()}),[l,E]),(0,t.useEffect)((function(){!function(){var t=new e.Editor.Composer(r.current);t.setCommonToolButtons(["loadData","saveData","zoomIn","zoomOut","reset","undo","redo","copy","cut","paste"]),t.setChemToolButtons(["erase","manipulate","bond","atomAndFormula","ring","charge"]),h(t),document.getElementById("custom-switch").click()}()}),[]);var A=function(){var e=da(ca().mark((function e(){var t,r,n;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S(!0),"Error. More than one structure drawn."!==l){e.next=4;break}return S(!1),e.abrupt("return");case 4:return l.length>0&&(b=(b=(b=(b=(b=(b=(b=l).split("=").join("%3D")).split("#").join("%23")).split("(").join("%28")).split(")").join("%29")).split("+").join("%2B")).split("@").join("%40")),e.next=7,fetch("/api/?limit=".concat(E,"&monomer__monomer_smiles__substruct=").concat(b)).catch((function(e){return console.log(e)}));case 7:if(500!==(t=e.sent).status&&t.ok){e.next=12;break}return d("serverError"),S(!1),e.abrupt("return");case 12:return e.next=14,t.json();case 14:r=e.sent,t.ok&&(o(r.results),n=r.count,y(Math.ceil(n/E))),S(!1);case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=da(ca().mark((function e(t){var r,n;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.selected+1,e.next=3,R(r);case 3:n=e.sent,o(n),window.scrollTo(0,document.body.scrollHeight);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=da(ca().mark((function e(t){var r,n,i;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Error. More than one structure drawn."!==l){e.next=2;break}return e.abrupt("return");case 2:return l.length>0&&(b=(b=(b=(b=(b=(b=l).split("=").join("%3D")).split("#").join("%23")).split("(").join("%28")).split(")").join("%29")).split("+").join("%2B")),r=(t-1)*E,e.next=6,fetch("/api/?limit=".concat(E,"&offset=").concat(r,"&monomer__monomer_smiles__substruct=").concat(b));case 6:return n=e.sent,e.next=9,n.json();case 9:return i=e.sent,e.abrupt("return",i.results);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsxs)(Xr,{children:[(0,ge.jsx)(Sa,{as:"h4",className:"mt-4 mb-3",children:"Substructure Search"}),(0,ge.jsx)(Sa,{className:"mt-2 mb-1",children:" Draw the substructure you want to search for below. "}),(0,ge.jsx)(Sa,{className:"justify-content-start",style:{width:"100%"},children:(0,ge.jsx)("div",{id:"composer",className:"mt-4",ref:r,style:{width:"90%"}})}),(0,ge.jsxs)(Sa,{className:"mx-3 mb-3 align-items-center justify-content-start",children:[(0,ge.jsx)("button",{className:"btn btn-outline-primary mb-3 mt-3 w-25 mx-2",onClick:function(){var t=c.getChemObj(),r=e.IO.saveFormatData(t,"smi");r.includes(".")&&(r="Error. More than one structure drawn.",o([])),d(r)},children:"Search"}),(0,ge.jsx)("div",{className:"mb-3 mt-3 mx-2 w-25",children:""!==l&&null!==l?"Molecule SMILES: "+l:""}),(0,ge.jsx)(Ra,{className:"mb-3 mt-3 mx-2 w-25",children:(0,ge.jsx)(Cs.Check,{type:"switch",id:"custom-switch",label:"View structures",onClick:function(){f(!g)}})}),(0,ge.jsxs)(Ra,{style:{width:300,display:"flex",justifyContent:"start",alignItems:"center"},children:["Show",(0,ge.jsxs)(Cs.Select,{size:"sm",style:{width:100,marginLeft:"0.5em",marginRight:"0.5em"},onChange:function(e){return T(e.target.value)},children:[(0,ge.jsx)("option",{value:12,children:"12"}),(0,ge.jsx)("option",{value:25,children:"25"}),(0,ge.jsx)("option",{value:50,children:"50"}),(0,ge.jsx)("option",{value:C*E,children:"All"})]}),"entries"]})]}),"Error. More than one structure drawn."===l?void 0:"serverError"===l?(0,ge.jsx)("div",{className:"text-center mb-3",children:"  An error occurred! Your SMILES may not be valid. "}):null!==l?(0,ge.jsxs)(ge.Fragment,{children:[!0===v?(0,ge.jsxs)(Sa,{className:"align-items-center justify-content-center",children:[" ",(0,ge.jsx)(Es,{animation:"border",className:"mx-3"}),"Waiting for data to load... "]}):!0===g?(0,ge.jsx)(Ys,{reactions:i,verbose:!1}):(0,ge.jsx)(As,{reactions:i,verbose:!1}),(0,ge.jsx)(qs(),{previousLabel:"previous",nextLabel:"next",breakLabel:"...",pageCount:C,marginPagesDisplayed:1,pageRangeDisplayed:3,onPageChange:I,containerClassName:"pagination justify-content-end",pageClassName:"page-item",pageLinkClassName:"page-link",previousClassName:"page-item",previousLinkClassName:"page-link",nextClassName:"page-item",nextLinkClassName:"page-link",breakClassName:"page-item",breakLinkClassName:"page-link",activeClassName:"active"})]}):(0,ge.jsx)(ge.Fragment,{})]})})},nd=function(){return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsxs)(Xr,{children:[(0,ge.jsx)(Sa,{as:"h4",className:"mt-4 mb-3",children:"About the C-GEM ribosomal reactions database"}),(0,ge.jsxs)(Sa,{className:"mt-3",children:[" ",(0,ge.jsxs)("p",{style:{padding:0},children:[" See the code on GitHub at ",(0,ge.jsxs)("span",{className:"hoverable",style:{textDecoration:"none",color:"maroon"},onClick:function(){return window.open("https://github.com/Jareddvw/CGEM-DB")},children:["https://github.com/Jareddvw/CGEM-DB","."]})]})]})]})})},id=function(e){var t=e.show,r=e.onHide,n=e.authTokens,i=e.userInfo,o=function(){var e=da(ca().mark((function e(t){return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),console.log("update user called"),e.next=4,fetch("/api/account/details/update",{method:"put",headers:{"Content-Type":"application/json",Authorization:"Bearer "+String(n.access)},body:JSON.stringify({email:t.target.formBasicEmail.value,username:t.target.formBasicUsername.value,institution:t.target.formBasicInstitution.value,orcid_id:t.target.formBasicOrcid.value})}).catch((function(e){console.error(e)}));case 4:e.sent.ok&&window.location.reload();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,ge.jsxs)(bl,{show:t,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,onHide:r,children:[(0,ge.jsx)(bl.Header,{closeButton:!0,children:(0,ge.jsx)(bl.Title,{id:"contained-modal-title-vcenter",children:"Update account information"})}),(0,ge.jsx)(bl.Body,{children:(0,ge.jsxs)(Cs,{id:"modalform",onSubmit:o,children:[(0,ge.jsxs)(Cs.Group,{className:"mx-5 mb-3",controlId:"formBasicEmail",children:[(0,ge.jsx)(Cs.Label,{children:"Email"}),(0,ge.jsx)(Cs.Control,{type:"email",defaultValue:i.email||""})]}),(0,ge.jsxs)(Cs.Group,{className:"mx-5 mt-3 mb-4",controlId:"formBasicUsername",children:[(0,ge.jsx)(Cs.Label,{children:"Name"}),(0,ge.jsx)(Cs.Control,{type:"username",defaultValue:i.username||""})]}),(0,ge.jsxs)(Cs.Group,{className:"mx-5 mt-3 mb-4",controlId:"formBasicInstitution",children:[(0,ge.jsx)(Cs.Label,{children:"Institution"}),(0,ge.jsx)(Cs.Control,{type:"institution",defaultValue:i.institution||""})]}),(0,ge.jsxs)(Cs.Group,{className:"mx-5 mt-3 mb-4",controlId:"formBasicOrcid",children:[(0,ge.jsx)(Cs.Label,{children:"ORCID ID"}),(0,ge.jsx)(Cs.Control,{type:"orcid_id",defaultValue:i.orcid_id||""})]})]})}),(0,ge.jsxs)(bl.Footer,{children:[(0,ge.jsx)("button",{className:"btn btn-outline-danger",onClick:r,children:"Cancel"}),(0,ge.jsx)("button",{className:"btn btn-outline-primary",form:"modalform",type:"submit",children:"Save and submit"})]})]})},od=function(){var e=s((0,t.useState)({}),2),r=e[0],n=e[1],i=s((0,t.useState)(!1),2),o=i[0],a=i[1],l=s((0,t.useState)(!0),2),d=l[0],u=l[1],c=(0,t.useContext)(ya).authTokens,h=function(){var e=da(ca().mark((function e(){var t,r;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/account/details",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+String(c.access)}}).catch((function(e){console.error(e)}));case 2:return t=e.sent,e.next=5,t.json();case 5:r=e.sent,n(r),u(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,t.useEffect)((function(){h(),console.log(r)}),[]),!0===d?(0,ge.jsxs)("div",{className:"mt-5 text-center",children:[(0,ge.jsx)(Es,{animation:"border"}),(0,ge.jsx)("strong",{children:"Waiting for account information to load..."})]}):(0,ge.jsxs)(Xr,{className:"mt-5",children:["Name: "," "+r.username,(0,ge.jsx)("p",{}),"Email: "," "+r.email,(0,ge.jsx)("p",{}),"Institution: "," "+r.institution,(0,ge.jsx)("p",{}),"ORCID ID: "," "+r.orcid_id,(0,ge.jsx)("p",{}),"Admin user? ",!0===r.is_admin?"Yes":"No",(0,ge.jsx)("p",{}),"Staff user? ",!0===r.is_staff?"Yes":"No",(0,ge.jsx)("p",{}),"Date joined: "," "+r.date_joined,(0,ge.jsx)("p",{}),(0,ge.jsx)("button",{className:"mt-3 btn btn-outline-secondary",onClick:function(){return a(!0)},children:"Edit my account details"}),(0,ge.jsx)(id,{show:o,onHide:function(){return a(!1)},authTokens:c,userInfo:r})]})},ad=function(){var e=s((0,t.useState)([]),2),r=e[0],n=e[1],i=s((0,t.useState)([]),2),o=i[0],a=i[1],l=s((0,t.useState)(!1),2),d=l[0],u=l[1],c=s((0,t.useState)(1),2),h=c[0],p=c[1],g=s((0,t.useState)(12),2),f=g[0],m=g[1],C=s((0,t.useState)(!0),2),y=C[0],_=C[1],E=function(){var e=da(ca().mark((function e(){var t,r,i,o,s,l,d;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _(!0),e.next=3,fetch("/api/drafts/?limit=".concat(f));case 3:return t=e.sent,e.next=6,t.json();case 6:r=e.sent,i=[],o=Dn(r.results);try{for(o.s();!(s=o.n()).done;)(l=s.value).truncatedReactionDraft.id=l.id,i.push(l.truncatedReactionDraft)}catch(u){o.e(u)}finally{o.f()}console.log(i),n(i),d=r.count,p(Math.ceil(d/f)),a(r),_(!1);case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,t.useEffect)((function(){E()}),[f]),(0,t.useEffect)((function(){}),[d]);var T=function(){var e=da(ca().mark((function e(t){var r,i;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.selected+1,e.next=3,O(r);case 3:i=e.sent,n(i),window.scrollTo(0,document.body.scrollHeight);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=da(ca().mark((function e(t){var r,i,o,a,s,l,d;return ca().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(t-1)*f,e.next=3,fetch("/api/drafts/?limit=".concat(f,"&offset=").concat(r));case 3:return i=e.sent,e.next=6,i.json();case 6:o=e.sent,a=[],s=Dn(o.results);try{for(s.s();!(l=s.n()).done;)d=l.value,a.push(d.truncatedReactionDraft)}catch(u){s.e(u)}finally{s.f()}return n(a),e.abrupt("return",a);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsxs)(Xr,{className:"mb-4 mt-4",children:[(0,ge.jsx)(Sa,{as:"h4",className:"mt-3 mb-3",children:" Reaction Drafts "}),(0,ge.jsx)(Sa,{className:"mt-3",children:" The following reactions were added by unverified users, and have not yet been verified by an admin user. "}),(0,ge.jsxs)(Sa,{className:"mt-3 align-items-center",children:[(0,ge.jsx)(Ra,{children:(0,ge.jsx)("div",{children:(0,ge.jsx)(Cs.Check,{type:"switch",id:"custom-switch",label:"View structures",onClick:function(){u(!d)}})})}),(0,ge.jsxs)("div",{style:{width:300,padding:0},children:["Number of results: ",null===o||void 0===o?void 0:o.count]}),"Show",(0,ge.jsxs)(Cs.Select,{size:"sm",style:{width:100,marginLeft:"0.5em",marginRight:"0.5em"},onChange:function(e){return m(e.target.value)},children:[(0,ge.jsx)("option",{value:12,children:"12"}),(0,ge.jsx)("option",{value:25,children:"25"}),(0,ge.jsx)("option",{value:50,children:"50"}),(0,ge.jsx)("option",{value:h*f,children:"All"})]}),"entries per page"]}),!0===y?(0,ge.jsxs)(Sa,{className:"align-items-center justify-content-center mt-5",children:[" ",(0,ge.jsx)(Es,{animation:"border",className:"mx-3"}),"Waiting for data to load... "]}):(0,ge.jsx)(ge.Fragment,{children:(0,ge.jsx)(Sa,{className:"mt-4",children:(0,ge.jsx)(Xs,{reactions:r,cardView:d,verbose:!1,drafts:!0})})}),(0,ge.jsx)(qs(),{previousLabel:"previous",nextLabel:"next",breakLabel:"...",pageCount:h,marginPagesDisplayed:1,pageRangeDisplayed:3,onPageChange:T,containerClassName:"pagination justify-content-end mt-3",pageClassName:"page-item",pageLinkClassName:"page-link",previousClassName:"page-item",previousLinkClassName:"page-link",nextClassName:"page-item",nextLinkClassName:"page-link",breakClassName:"page-item",breakLinkClassName:"page-link",activeClassName:"active"})]})})},sd=function(){var e=D({path:"/reaction-drafts/:id/",strict:!0,sensitive:!0}).params.id,r=s((0,t.useState)({}),2),n=r[0],i=r[1],o=s((0,t.useState)(150),2),a=o[0],l=o[1],d=s((0,t.useState)(!0),2),u=d[0],c=d[1],h=s((0,t.useState)(0),2),p=h[0],g=h[1],f=s((0,t.useState)(!1),2),m=f[0],C=f[1],y=s((0,t.useState)(!1),2),_=y[0],E=y[1],T=s((0,t.useState)(!1),2),O=T[0],v=T[1],S=(0,t.useContext)(ya),b=S.authTokens,A=S.user;(0,t.useEffect)((function(){x()}),[]),(0,t.useEffect)((function(){n&&Object.keys(n).length>1&&c(!1)}),[n]),(0,t.useEffect)((function(){if(document.getElementById("figRow")){var e=document.getElementById("figRow").clientHeight;l(e-50)}}),[u]);var I,R,N,P,x=function(){var t=da(ca().mark((function t(){var r,n;return ca().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/api/drafts/".concat(e));case 2:if(500!==(r=t.sent).status){t.next=8;break}console.log("Error connecting to server to fetch reactioninfo (server may not be running)."),g(500),t.next=18;break;case 8:if(!(r.status>=404)){t.next=13;break}console.log("reaction not found."),g(r.status),t.next=18;break;case 13:return t.next=15,r.json();case 15:(n=t.sent).reactionDraft.id=n.id,i(n.reactionDraft);case 18:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return u?(0,ge.jsx)("div",{className:"mt-5 text-center",children:(0,ge.jsx)("strong",{children:p>=404?"Wrong page! Nothing to see here...":(0,ge.jsxs)("div",{className:"d-flex justify-content-center align-items-center",children:["Waiting for reaction information to load...",(0,ge.jsx)(Es,{animation:"border",className:"mx-2"})]})})}):(0,ge.jsxs)(Xr,{className:"mb-3",children:[(0,ge.jsxs)(Sa,{className:"mt-4 mb-4 align-items-center justify-content-between",children:[(0,ge.jsx)("h5",{style:{color:"maroon",width:300},children:"Reaction draft (not yet approved)"}),(0,ge.jsxs)("div",{style:{width:450,display:"flex",justifyContent:"between"},children:[(0,ge.jsx)("button",{className:"btn btn-outline-success mx-1",disabled:null===A,style:{width:200},onClick:function(){A||C(!0)},children:"Approve this draft"}),(0,ge.jsx)("button",{className:"btn btn-outline-danger mx-1",style:{width:200},disabled:null===A,onClick:function(){A?E(!0):C(!0)},children:"Delete this draft"})]})]}),(0,ge.jsx)(Al,{show:O,onHide:function(){return v(!1)},reactionId:e,authTokens:b,initialReactionData:n}),(0,ge.jsx)(Il,{show:_,onHide:function(){return E(!1)},reactionId:e,draft:!0,authTokens:b}),(0,ge.jsx)(Rl,{show:m,onHide:function(){return C(!1)}}),(0,ge.jsxs)(Ss,{responsive:"sm",striped:!0,bordered:!0,children:[(0,ge.jsx)("thead",{children:(0,ge.jsxs)("tr",{children:[(0,ge.jsx)("th",{children:"Monomer Name"}),(0,ge.jsx)("th",{children:"SMILES"}),(0,ge.jsx)("th",{children:"Leaving Group"})]})}),(0,ge.jsx)("tbody",{children:(0,ge.jsxs)("tr",{children:[(0,ge.jsx)("td",{children:null===n||void 0===n||null===(I=n.monomer)||void 0===I?void 0:I.monomer_name}),(0,ge.jsx)("td",{children:null===n||void 0===n||null===(R=n.monomer)||void 0===R?void 0:R.monomer_smiles}),(0,ge.jsx)("td",{children:null===n||void 0===n||null===(N=n.monomer)||void 0===N?void 0:N.monomer_LG})]})})]}),(0,ge.jsx)("br",{}),(0,ge.jsxs)(Sa,{id:"figRow",className:"figureRow",children:[(0,ge.jsxs)(Gs,{className:"reactionPageCard px-0",id:"rxnCard",style:{width:400,height:"100%"},children:[(0,ge.jsxs)(Gs.Header,{children:[" ",(0,ge.jsx)("strong",{children:"Monomer Structure"})]}),(0,ge.jsx)(Gs.Body,{children:(0,ge.jsx)(Zs,{smiles:null===n||void 0===n||null===(P=n.monomer)||void 0===P?void 0:P.monomer_smiles,width:"350",height:a})})]}),(0,ge.jsx)(Qs,{synthetase:null===n||void 0===n?void 0:n.synthetase,flexizyme:null===n||void 0===n?void 0:n.flexizyme,readout:null===n||void 0===n?void 0:n.rib_readout}),(0,ge.jsx)(rl,{trna:null===n||void 0===n?void 0:n.tRNA})]}),(0,ge.jsx)("br",{}),(0,ge.jsx)(tl,{reaction:n}),(0,ge.jsx)("br",{}),(0,ge.jsx)("div",{children:(0,ge.jsx)(el,{reaction:n})}),(0,ge.jsx)("div",{children:(0,ge.jsx)(il,{references:null===n||void 0===n?void 0:n.references})})]})};var ld=function(){return(0,ge.jsx)("div",{className:"App",children:(0,ge.jsx)($,{children:(0,ge.jsxs)(_a,{children:[(0,ge.jsx)(Ta,{}),(0,ge.jsx)("br",{}),(0,ge.jsxs)(b,{children:[(0,ge.jsx)(v,{path:"/",exact:!0,element:(0,ge.jsx)(xl,{})}),(0,ge.jsx)(v,{path:"/about",exact:!0,element:(0,ge.jsx)(nd,{})}),(0,ge.jsx)(v,{path:"/sign-in",exact:!0,element:(0,ge.jsx)(Jl,{})}),(0,ge.jsx)(v,{path:"/create-account",exact:!0,element:(0,ge.jsx)(Zl,{})}),(0,ge.jsx)(v,{path:"/all-reactions",exact:!0,element:(0,ge.jsx)(Js,{})}),(0,ge.jsx)(v,{path:"/smiles-structures",exact:!0,element:(0,ge.jsx)(Nl,{})}),(0,ge.jsx)(v,{path:"/draw-structures",exact:!0,element:(0,ge.jsx)(rd,{})}),(0,ge.jsx)(v,{path:"/reaction/:id",exact:!0,element:(0,ge.jsx)(Dl,{})}),(0,ge.jsx)(v,{path:"/search/:searchTerm",exact:!0,element:(0,ge.jsx)(Ml,{})}),(0,ge.jsx)(v,{path:"/advanced",exact:!0,element:(0,ge.jsx)(Bl,{})}),(0,ge.jsx)(v,{path:"/reaction-drafts",exact:!0,element:(0,ge.jsx)(ad,{})}),(0,ge.jsx)(v,{path:"/reaction-drafts/:id",exact:!0,element:(0,ge.jsx)(sd,{})}),(0,ge.jsx)(v,{exact:!0,path:"/contribute",element:(0,ge.jsx)(ed,{children:(0,ge.jsx)(ql,{})})}),(0,ge.jsx)(v,{exact:!0,path:"/my-reactions",element:(0,ge.jsx)(ed,{children:(0,ge.jsx)(td,{})})}),(0,ge.jsx)(v,{exact:!0,path:"/my-account",element:(0,ge.jsx)(ed,{children:(0,ge.jsx)(od,{})})})]}),(0,ge.jsx)("br",{}),(0,ge.jsx)(Pl,{})]})})})};r.render((0,ge.jsx)(t.StrictMode,{children:(0,ge.jsx)(ld,{})}),document.getElementById("root"),i().apply())}()})();
//# sourceMappingURL=main.cbca6cd6.js.map